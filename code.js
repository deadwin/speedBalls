var requirejs,require,define;!function(global,setTimeout){function commentReplace(e,t){return t||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){var i;if(e)for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}function eachReverse(e,t){var i;if(e)for(i=e.length-1;-1<i&&(!e[i]||!t(e[i],i,e));i-=1);}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(i,e,n,a){return e&&eachProp(e,function(e,t){!n&&hasProp(i,t)||(!a||"object"!=typeof e||!e||isArray(e)||isFunction(e)||e instanceof RegExp?i[t]=e:(i[t]||(i[t]={}),mixin(i[t],e,n,a)))}),i}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,i,n){var a=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return a.requireType=e,a.requireModules=n,i&&(a.originalError=i),a}function newContext(l){function _(e,t,i){var n,a,r,s,o,l,h,c,u,d,_=t&&t.split("/"),p=w.map,f=p&&p["*"];if(e&&(l=(e=e.split("/")).length-1,w.nodeIdCompat&&jsSuffixRegExp.test(e[l])&&(e[l]=e[l].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&_&&(e=_.slice(0,_.length-1).concat(e)),function(e){var t,i;for(t=0;t<e.length;t++)if("."===(i=e[t]))e.splice(t,1),t-=1;else if(".."===i){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;0<t&&(e.splice(t-1,2),t-=2)}}(e),e=e.join("/")),i&&p&&(_||f)){e:for(r=(a=e.split("/")).length;0<r;r-=1){if(o=a.slice(0,r).join("/"),_)for(s=_.length;0<s;s-=1)if((n=getOwn(p,_.slice(0,s).join("/")))&&(n=getOwn(n,o))){h=n,c=r;break e}!u&&f&&getOwn(f,o)&&(u=getOwn(f,o),d=r)}!h&&u&&(h=u,c=d),h&&(a.splice(0,c,h),e=a.join("/"))}return getOwn(w.pkgs,e)||e}function h(t){isBrowser&&each(scripts(),function(e){if(e.getAttribute("data-requiremodule")===t&&e.getAttribute("data-requirecontext")===S.contextName)return e.parentNode.removeChild(e),!0})}function c(e){var t=getOwn(w.paths,e);if(t&&isArray(t)&&1<t.length)return t.shift(),S.require.undef(e),S.makeRequire(null,{skipMap:!0})([e]),!0}function p(e){var t,i=e?e.indexOf("!"):-1;return-1<i&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function u(e,t,i,n){var a,r,s,o,l=null,h=t?t.name:null,c=e,u=!0,d="";return e||(u=!1,e="_@r"+(D+=1)),l=(o=p(e))[0],e=o[1],l&&(l=_(l,h,n),r=getOwn(L,l)),e&&(l?d=i?e:r&&r.normalize?r.normalize(e,function(e){return _(e,h,n)}):-1===e.indexOf("!")?_(e,h,n):e:(l=(o=p(d=_(e,h,n)))[0],d=o[1],i=!0,a=S.nameToUrl(d))),{prefix:l,name:d,parentMap:t,unnormalized:!!(s=!l||r||i?"":"_unnormalized"+(P+=1)),url:a,originalName:c,isDefine:u,id:(l?l+"!"+d:d)+s}}function d(e){var t=e.id,i=getOwn(M,t);return i=i||(M[t]=new S.Module(e))}function f(e,t,i){var n=e.id,a=getOwn(M,n);!hasProp(L,n)||a&&!a.defineEmitComplete?(a=d(e)).error&&"error"===t?i(a.error):a.on(t,i):"defined"===t&&i(L[n])}function m(i,e){var t=i.requireModules,n=!1;e?e(i):(each(t,function(e){var t=getOwn(M,e);t&&(t.error=i,t.events.error&&(n=!0,t.emit("error",i)))}),n||req.onError(i))}function g(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(S.defQueueMap[t]=!0),R.push(e)}),globalDefQueue=[])}function v(e){delete M[e],delete b[e]}function y(){var e,n,t=1e3*w.waitSeconds,a=t&&S.startTime+t<(new Date).getTime(),r=[],s=[],o=!1,l=!0;if(!E){if(E=!0,eachProp(b,function(e){var t=e.map,i=t.id;if(e.enabled&&(t.isDefine||s.push(e),!e.error))if(!e.inited&&a)c(i)?o=n=!0:(r.push(i),h(i));else if(!e.inited&&e.fetched&&t.isDefine&&(o=!0,!t.prefix))return l=!1}),a&&r.length)return(e=makeError("timeout","Load timeout for modules: "+r,null,r)).contextName=S.contextName,m(e);l&&each(s,function(e){!function a(r,s,o){var e=r.map.id;r.error?r.emit("error",r.error):(s[e]=!0,each(r.depMaps,function(e,t){var i=e.id,n=getOwn(M,i);!n||r.depMatched[t]||o[i]||(getOwn(s,i)?(r.defineDep(t,L[i]),r.check()):a(n,s,o))}),o[e]=!0)}(e,{},{})}),a&&!n||!o||!isBrowser&&!isWebWorker||T||(T=setTimeout(function(){T=0,y()},50)),E=!1}}function s(e){hasProp(L,e[0])||d(u(e[0],null,!0)).init(e[1],e[2])}function i(e,t,i,n){e.detachEvent&&!isOpera?n&&e.detachEvent(n,t):e.removeEventListener(i,t,!1)}function a(e){var t=e.currentTarget||e.srcElement;return i(t,S.onScriptLoad,"load","onreadystatechange"),i(t,S.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function C(){var e;for(g();R.length;){if(null===(e=R.shift())[0])return m(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));s(e)}S.defQueueMap={}}var E,e,S,x,T,w={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},M={},b={},n={},R=[],L={},A={},I={},D=1,P=1;return x={require:function(e){return e.require?e.require:e.require=S.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?L[e.map.id]=e.exports:e.exports=L[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(w.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},(e=function(e){this.events=getOwn(n,e.id)||{},this.map=e,this.shim=getOwn(w.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(e,t,i,n){n=n||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,S.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();S.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;A[e]||(A[e]=!0,S.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,n=this.depExports,a=this.exports,r=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(r)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{a=S.execCb(i,r,n,a)}catch(t){e=t}else a=S.execCb(i,r,n,a);if(this.map.isDefine&&void 0===a&&((t=this.module)?a=t.exports:this.usingExports&&(a=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",m(this.error=e)}else a=r;if(this.exports=a,this.map.isDefine&&!this.ignore&&(L[i]=a,req.onResourceLoad)){var s=[];each(this.depMaps,function(e){s.push(e.normalizedMap||e)}),req.onResourceLoad(S,this.map,s)}v(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(S.defQueueMap,i)||this.fetch()}},callPlugin:function(){var l=this.map,h=l.id,e=u(l.prefix);this.depMaps.push(e),f(e,"defined",bind(this,function(e){var r,t,i,n=getOwn(I,this.map.id),a=this.map.name,s=this.map.parentMap?this.map.parentMap.name:null,o=S.makeRequire(l.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(e.normalize&&(a=e.normalize(a,function(e){return _(e,s,!0)})||""),f(t=u(l.prefix+"!"+a,this.map.parentMap,!0),"defined",bind(this,function(e){this.map.normalizedMap=t,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),void((i=getOwn(M,t.id))&&(this.depMaps.push(t),this.events.error&&i.on("error",bind(this,function(e){this.emit("error",e)})),i.enable()))):n?(this.map.url=S.nameToUrl(n),void this.load()):((r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})})).error=bind(this,function(e){this.inited=!0,(this.error=e).requireModules=[h],eachProp(M,function(e){0===e.map.id.indexOf(h+"_unnormalized")&&v(e.map.id)}),m(e)}),r.fromText=bind(this,function(e,t){var i=l.name,n=u(i),a=useInteractive;t&&(e=t),a&&(useInteractive=!1),d(n),hasProp(w.config,h)&&(w.config[i]=w.config[h]);try{req.exec(e)}catch(e){return m(makeError("fromtexteval","fromText eval for "+h+" failed: "+e,e,[h]))}a&&(useInteractive=!0),this.depMaps.push(n),S.completeLoad(i),o([i],r)}),void e.load(l.name,o,r,w))})),S.enable(e,this),this.pluginMaps[e.id]=e},enable:function(){(b[this.map.id]=this).enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,n,a;if("string"==typeof e){if(e=u(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,a=getOwn(x,e.id))return void(this.depExports[t]=a(this));this.depCount+=1,f(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?f(e,"error",bind(this,this.errback)):this.events.error&&f(e,"error",bind(this,function(e){this.emit("error",e)}))}i=e.id,n=M[i],hasProp(x,i)||!n||n.enabled||S.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(M,e.id);t&&!t.enabled&&S.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];(i=i||(this.events[e]=[])).push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},(S={config:w,contextName:l,registry:M,defined:L,urlFetched:A,defQueue:R,defQueueMap:{},Module:e,makeModuleMap:u,nextTick:req.nextTick,onError:m,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var i=e.urlArgs;e.urlArgs=function(e,t){return(-1===t.indexOf("?")?"?":"&")+i}}var n=w.shim,a={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){a[t]?(w[t]||(w[t]={}),mixin(w[t],e,!0,!0)):w[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(I[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=S.makeShimExports(e)),n[t]=e}),w.shim=n),e.packages&&each(e.packages,function(e){var t;t=(e="string"==typeof e?{name:e}:e).name,e.location&&(w.paths[t]=e.location),w.pkgs[t]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(M,function(e,t){e.inited||e.map.unnormalized||(e.map=u(t,null,!0))}),(e.deps||e.callback)&&S.require(e.deps||[],e.callback)},makeShimExports:function(t){return function(){var e;return t.init&&(e=t.init.apply(global,arguments)),e||t.exports&&getGlobal(t.exports)}},makeRequire:function(r,s){function o(e,t,i){var n,a;return s.enableBuildCallback&&t&&isFunction(t)&&(t.__requireJsBuild=!0),"string"==typeof e?isFunction(t)?m(makeError("requireargs","Invalid require call"),i):r&&hasProp(x,e)?x[e](M[r.id]):req.get?req.get(S,e,r,o):(n=u(e,r,!1,!0).id,hasProp(L,n)?L[n]:m(makeError("notloaded",'Module name "'+n+'" has not been loaded yet for context: '+l+(r?"":". Use require([])")))):(C(),S.nextTick(function(){C(),(a=d(u(null,r))).skipMap=s.skipMap,a.init(e,t,i,{enabled:!0}),y()}),o)}return s=s||{},mixin(o,{isBrowser:isBrowser,toUrl:function(e){var t,i=e.lastIndexOf("."),n=e.split("/")[0];return-1!==i&&(!("."===n||".."===n)||1<i)&&(t=e.substring(i,e.length),e=e.substring(0,i)),S.nameToUrl(_(e,r&&r.id,!0),t,!0)},defined:function(e){return hasProp(L,u(e,r,!1,!0).id)},specified:function(e){return e=u(e,r,!1,!0).id,hasProp(L,e)||hasProp(M,e)}}),r||(o.undef=function(i){g();var e=u(i,r,!0),t=getOwn(M,i);t.undefed=!0,h(i),delete L[i],delete A[e.url],delete n[i],eachReverse(R,function(e,t){e[0]===i&&R.splice(t,1)}),delete S.defQueueMap[i],t&&(t.events.defined&&(n[i]=t.events),v(i))}),o},enable:function(e){getOwn(M,e.id)&&d(e).enable()},completeLoad:function(e){var t,i,n,a=getOwn(w.shim,e)||{},r=a.exports;for(g();R.length;){if(null===(i=R.shift())[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);s(i)}if(S.defQueueMap={},n=getOwn(M,e),!t&&!hasProp(L,e)&&n&&!n.inited){if(!(!w.enforceDefine||r&&getGlobal(r)))return c(e)?void 0:m(makeError("nodefine","No define call for "+e,null,[e]));s([e,a.deps||[],a.exportsFn])}y()},nameToUrl:function(e,t,i){var n,a,r,s,o,l,h=getOwn(w.pkgs,e);if(h&&(e=h),l=getOwn(I,e))return S.nameToUrl(l,t,i);if(req.jsExtRegExp.test(e))s=e+(t||"");else{for(n=w.paths,r=(a=e.split("/")).length;0<r;r-=1)if(o=getOwn(n,a.slice(0,r).join("/"))){isArray(o)&&(o=o[0]),a.splice(0,r,o);break}s=a.join("/"),s=("/"===(s+=t||(/^data\:|^blob\:|\?/.test(s)||i?"":".js")).charAt(0)||s.match(/^[\w\+\.\-]+:/)?"":w.baseUrl)+s}return w.urlArgs&&!/^blob\:/.test(s)?s+w.urlArgs(e,s):s},load:function(e,t){req.load(S,e,t)},execCb:function(e,t,i,n){return t.apply(n,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=a(e);S.completeLoad(t.id)}},onScriptError:function(e){var i=a(e);if(!c(i.id)){var n=[];return eachProp(M,function(e,t){0!==t.indexOf("_@r")&&each(e.depMaps,function(e){if(e.id===i.id)return n.push(t),!0})}),m(makeError("scripterror",'Script error for "'+i.id+(n.length?'", needed by: '+n.join(", "):'"'),e,[i.id]))}}}).require=S.makeRequire(),S}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState||eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.4",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,n){var a,r,s=defContextName;return isArray(e)||"string"==typeof e||(r=e,isArray(t)?(e=t,t=i,i=n):e=[]),r&&r.context&&(s=r.context),(a=getOwn(contexts,s))||(a=contexts[s]=req.s.newContext(s)),r&&a.configure(r),a.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick=void 0!==setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require=require||req,req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(t){req[t]=function(){var e=contexts[defContextName];return e.require[t].apply(e,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],(baseElement=document.getElementsByTagName("base")[0])&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,i){var n=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return n.type=e.scriptType||"text/javascript",n.charset="utf-8",n.async=!0,n},req.load=function(e,t,i){var n,a=e&&e.config||{};if(isBrowser)return(n=req.createNode(a,t,i)).setAttribute("data-requirecontext",e.contextName),n.setAttribute("data-requiremodule",t),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",e.onScriptLoad,!1),n.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",e.onScriptLoad)),n.src=i,a.onNodeCreated&&a.onNodeCreated(n,a,t,i),currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n;if(isWebWorker)try{setTimeout(function(){},0),importScripts(i),e.completeLoad(t)}catch(n){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+i,n,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head=head||e.parentNode,dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(mainScript=(src=mainScript.split("/")).pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,i,t){var n,a;"string"!=typeof e&&(t=i,i=e,e=null),isArray(i)||(t=i,i=null),!i&&isFunction(t)&&(i=[],t.length&&(t.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,t){i.push(t)}),i=(1===t.length?["require"]:["require","exports","module"]).concat(i))),useInteractive&&(n=currentlyAddingScript||getInteractiveScript())&&(e=e||n.getAttribute("data-requiremodule"),a=contexts[n.getAttribute("data-requirecontext")]),a?(a.defQueue.push([e,i,t]),a.defQueueMap[e]=!0):globalDefQueue.push([e,i,t])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this,"undefined"==typeof setTimeout?void 0:setTimeout);var testOnshow=function(){function e(){window.wx&&window.wx.onShow(this.show_t)}return _proto=e.prototype,_proto.show_t=function(e){console.log("test"),window.wxOnshow_test=e},e}(),Laya=window.Laya=function(h){var c={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(e,t){return 1==arguments.length?c.__presubstr.call(this,e):c.__presubstr.call(this,e,0<t?t:this.length+t)},__init:function(e){e.forEach(function(e){e.__init$&&e.__init$()})},__isClass:function(e){return e&&(e.__isclass||e==Object||e==String||e==Array)},__newvec:function(e,t){var i=[];i.length=e;for(var n=0;n<e;n++)i[n]=t;return i},__extend:function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var n=Object.getOwnPropertyDescriptor(t,i),a=n.get,r=n.set;a||r?a&&r?Object.defineProperty(e,i,n):(a&&Object.defineProperty(e,i,a),r&&Object.defineProperty(e,i,r)):e[i]=t[i]}function s(){c.un(this,"constructor",e)}s.prototype=t.prototype,e.prototype=new s,c.un(e.prototype,"__imps",c.__copy({},t.prototype.__imps))},__copy:function(e,t){if(!t)return null;for(var i in e=e||{},t)e[i]=t[i];return e},__package:function(e,t){if(!c.__packages[e]){c.__packages[e]=!0;var i=h,n=e.split(".");if(1<n.length)for(var a=0,r=n.length-1;a<r;a++){var s=i[n[a]];i=s||(i[n[a]]={})}i[n[n.length-1]]||(i[n[n.length-1]]=t||{})}},__hasOwnProperty:function(e,t){return t=t||this,Object.hasOwnProperty.call(t,e)||function e(t,i){if(Object.hasOwnProperty.call(i.prototype,t))return!0;var n=i.prototype.__super;return null==n?null:e(t,n)}(e,t.__class)},__typeof:function(e,t){if(!e||!t)return!1;if(t===String)return"string"==typeof e;if(t===Number)return"number"==typeof e;if(t.__interface__)t=t.__interface__;else if("string"!=typeof t)return e instanceof t;return e.__imps&&e.__imps[t]||e.__class==t},__as:function(e,t){return this.__typeof(e,t)?e:null},__int:function(e){return e?parseInt(e):0},interface:function(e,t){c.__package(e,{});var i=c.__internals,n=i[e]=i[e]||{self:e};if(t){var a=t.split(",");n.extend=[];for(var r=0;r<a.length;r++){var s=a[r];i[s]=i[s]||{self:s},n.extend.push(i[s])}}var o=h,l=e.split(".");for(r=0;r<l.length-1;r++)o=o[l[r]];o[l[l.length-1]]={__interface__:e}},class:function(e,t,i,n){if(i&&c.__extend(e,i),t)if(c.__package(t,e),c.__classmap[t]=e,0<t.indexOf(".")){if(0==t.indexOf("laya.")){var a=t.split(".");n=n||a[a.length-1],c[n]&&console.log("Warning!,this class["+n+"] already exist:",c[n]),c[n]=e}}else"Main"==t?h.Main=e:(c[t]&&console.log("Error!,this class["+t+"] already exist:",c[t]),c[t]=e);var r=c.un,s=e.prototype;r(s,"hasOwnProperty",c.__hasOwnProperty),r(s,"__class",e),r(s,"__super",i),r(s,"__className",t),r(e,"__super",i),r(e,"__className",t),r(e,"__isclass",!0),r(e,"super",function(e){this.__super.call(e)})},imps:function(e,t){if(!t)return null;var a=e.__imps||c.un(e,"__imps",{});function r(e){var t,i;if((t=c.__internals[e])&&(a[e]=!0,i=t.extend))for(var n=0;n<i.length;n++)r(i[n].self)}for(var i in t)r(i)},superSet:function(e,t,i,n){var a=e.prototype["_$set_"+i];a&&a.call(t,n)},superGet:function(e,t,i){var n=e.prototype["_$get_"+i];return n?n.call(t):null},getset:function(e,t,i,n,a){e?(n&&(t["_$GET_"+i]=n),a&&(t["_$SET_"+i]=a)):(n&&c.un(t,"_$get_"+i,n),a&&c.un(t,"_$set_"+i,a)),n&&a?Object.defineProperty(t,i,{get:n,set:a,enumerable:!1,configurable:!0}):(n&&Object.defineProperty(t,i,{get:n,enumerable:!1,configurable:!0}),a&&Object.defineProperty(t,i,{set:a,enumerable:!1,configurable:!0}))},static:function(i,n){for(var a=0,e=n.length;a<e;a+=2)if("length"==n[a])i.length=n[a+1].call(i);else{function t(){var t=n[a],e=n[a+1];Object.defineProperty(i,t,{get:function(){return delete this[t],this[t]=e.call(this)},set:function(e){delete this[t],this[t]=e},enumerable:!0,configurable:!0})}t()}},un:function(e,t,i){return i=i||e[t],c.__propun.value=i,Object.defineProperty(e,t,c.__propun),i},uns:function(t,e){e.forEach(function(e){c.un(t,e)})}};return h.console=h.console||{log:function(){}},h.trace=h.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),c}(window,document);!function(e,t,i){i.un,i.uns,i.static,i.class,i.getset,i.__newvec}(window,document,Laya),function(r,t,x){x.un,x.uns;var l=x.static,f=x.class,c=x.getset;x.__newvec;x.interface("laya.runtime.IMarket"),x.interface("laya.filters.IFilter"),x.interface("laya.display.ILayout"),x.interface("laya.resource.IDispose"),x.interface("laya.runtime.IPlatform"),x.interface("laya.resource.IDestroy"),x.interface("laya.runtime.IConchNode"),x.interface("laya.filters.IFilterAction"),x.interface("laya.runtime.ICPlatformClass"),x.interface("laya.resource.ICreateResource"),x.interface("laya.runtime.IConchRenderObject"),x.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var L=(f(s,"laya.utils.RunDriver"),s.FILTER_ACTIONS=[],s.pixelRatio=-1,s._charSizeTestDiv=null,s.now=function(){return Date.now()},s.getWindow=function(){return r},s.getPixelRatio=function(){if(s.pixelRatio<0){var e=Q.context,t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;(s.pixelRatio=(Q.window.devicePixelRatio||1)/t)<1&&(s.pixelRatio=1)}return s.pixelRatio},s.getIncludeStr=function(e){return null},s.createShaderCondition=function(e){var t="(function() {return "+e+";})";return x._runScript(t)},s.fontMap=[],s.measureText=function(e,t){var i=s.hanzi.test(e);if(i&&s.fontMap[t])return s.fontMap[t];var n=Q.context;n.font=t;var a=n.measureText(e);return i&&(s.fontMap[t]=a),a},s.getWebGLContext=function(e){},s.beginFlush=function(){},s.endFinish=function(){},s.addToAtlas=null,s.flashFlushImage=function(e){},s.drawToCanvas=function(e,t,i,n,a,r){var s=ze.create("2D"),o=new j(i,n,s);return Y.renders[t]._fun(e,o,a,r),s},s.createParticleTemplate2D=null,s.createGLTextur=null,s.createWebGLContext2D=null,s.changeWebGLSize=function(e,t){},s.createRenderSprite=function(e,t){return new Y(e,t)},s.createFilterAction=function(e){return new w},s.createGraphics=function(){return new d},s.clear=function(e){X._context.ctx.clear()},s.cancelLoadByUrl=function(e){},s.clearAtlas=function(e){},s.isAtlas=function(e){return!1},s.addTextureToAtlas=function(e){},s.getTexturePixels=function(e,t,i,n,a){return null},s.skinAniSprite=function(){return null},s.update3DLoop=function(){},l(s,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),s);function s(){}c(1,x,"alertGlobalError",null,function(e){var r=0;Q.window.onerror=e?function(e,t,i,n,a){r++<5&&a&&alert("出错啦，请把此信息截图给研发商\n"+e+"\n"+a.stack||a)}:null}),x.init=function(e,t,i){for(var n=[],a=2,r=arguments.length;a<r;a++)n.push(arguments[a]);if(!x._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=x._arrayBufferSlice),x._isinit=!0,Q.__init__(),K.__init__(),d.__init__(),x.timer=new me,x.scaleTimer=new me,x.loader=new Ie,Ee.__init__(),a=0;for(var s=n.length;a<s;a++)n[a].enable&&n[a].enable();return h.__init__(),o.__init__(),q.__init__(),ee.beginCheck(),x._currentStage=x.stage=new Ue,x.stage.conchModel&&x.stage.conchModel.setRootNode(),x._getUrlPath(),x.render=new X(0,0),x.stage.size(e,t),Y.__init__(),g.__init__(),E.instance.__init__(x.stage,X.canvas),je.__init__(),V.autoStopMusic=!0,H.__init__(),X.canvas}},x._getUrlPath=function(){var e=Q.window.location,t=e.pathname;t=":"==t.charAt(2)?t.substring(1):t,W.rootPath=W.basePath=W.getPath("file:"==e.protocol?t:e.protocol+"//"+e.host+e.pathname)},x._arrayBufferSlice=function(e,t){var i=new Uint8Array(this,e,t-e),n=new Uint8Array(i.length);return n.set(i),n.buffer},x._runScript=function(e){return Q.window[x._evcode](e)},x.stage=null,x.timer=null,x.scaleTimer=null,x.loader=null,x.version="1.7.22beta",x.render=null,x._currentStage=null,x._isinit=!1,x.MiniAdpter={init:function(){r.navigator&&r.navigator.userAgent&&-1<r.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},l(x,["conchMarket",function(){return this.conchMarket=r.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=r.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]);var n=(f(e,"Config"),e.WebGLTextCacheCount=500,e.atlasEnable=!1,e.showCanvasMark=!1,e.animationInterval=50,e.isAntialias=!1,e.isAlpha=!1,e.premultipliedAlpha=!0,e.isStencil=!0,e.preserveDrawingBuffer=!1,e);function e(){}var i=function(){var l;function t(){this._events=null}f(t,"laya.events.EventDispatcher");var e=t.prototype;return e.hasListener=function(e){return!!(this._events&&this._events[e])},e.event=function(e,t){if(!this._events||!this._events[e])return!1;var i=this._events[e];if(i.run)i.once&&delete this._events[e],null!=t?i.runWith(t):i.run();else{for(var n=0,a=i.length;n<a;n++){var r=i[n];r&&(null!=t?r.runWith(t):r.run()),r&&!r.once||(i.splice(n,1),n--,a--)}0===i.length&&this._events&&delete this._events[e]}return!0},e.on=function(e,t,i,n){return this._createListener(e,t,i,n,!1)},e.once=function(e,t,i,n){return this._createListener(e,t,i,n,!0)},e._createListener=function(e,t,i,n,a,r){void 0===r&&(r=!0),r&&this.off(e,t,i,a);var s=l.create(t||this,i,n,a);this._events||(this._events={});var o=this._events;return o[e]?o[e].run?o[e]=[o[e],s]:o[e].push(s):o[e]=s,this},e.off=function(e,t,i,n){if(void 0===n&&(n=!1),!this._events||!this._events[e])return this;var a=this._events[e];if(null!=i)if(a.run)t&&a.caller!==t||a.method!==i||n&&!a.once||(delete this._events[e],a.recover());else{for(var r=0,s=0,o=a.length;s<o;s++){var l=a[s];l?!l||t&&l.caller!==t||l.method!==i||n&&!l.once||(r++,a[s]=null,l.recover()):r++}r===o&&delete this._events[e]}return this},e.offAll=function(e){var t=this._events;if(!t)return this;if(e)this._recoverHandlers(t[e]),delete t[e];else{for(var i in t)this._recoverHandlers(t[i]);this._events=null}return this},e._recoverHandlers=function(e){if(e)if(e.run)e.recover();else for(var t=e.length-1;-1<t;t--)e[t]&&(e[t].recover(),e[t]=null)},e.isMouseEvent=function(e){return t.MOUSE_EVENTS[e]},t.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},t.__init$=function(){function a(e,t,i,n){a.__super.call(this,e,t,i,n)}Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0}),f(a,"",v),a.prototype.recover=function(){0<this._id&&(this._id=0,a._pool.push(this.clear()))},a.create=function(e,t,i,n){return void 0===n&&(n=!0),a._pool.length?a._pool.pop().setTo(e,t,i,n):new a(e,t,i,n)},a._pool=[],l=a},t}(),v=function(){function a(e,t,i,n){this.once=!1,void(this._id=0)===n&&(n=!1),this.setTo(e,t,i,n)}f(a,"laya.utils.Handler");var e=a.prototype;return e.setTo=function(e,t,i,n){return this._id=a._gid++,this.caller=e,this.method=t,this.args=i,this.once=n,this},e.run=function(){if(null==this.method)return null;var e=this._id,t=this.method.apply(this.caller,this.args);return this._id===e&&this.once&&this.recover(),t},e.runWith=function(e){if(null==this.method)return null;var t=this._id;if(null==e)var i=this.method.apply(this.caller,this.args);else i=this.args||e.unshift?this.args?this.method.apply(this.caller,this.args.concat(e)):this.method.apply(this.caller,e):this.method.call(this.caller,e);return this._id===t&&this.once&&this.recover(),i},e.clear=function(){return this.caller=null,this.method=null,this.args=null,this},e.recover=function(){0<this._id&&(this._id=0,a._pool.push(this.clear()))},a.create=function(e,t,i,n){return void 0===n&&(n=!0),a._pool.length?a._pool.pop().setTo(e,t,i,n):new a(e,t,i,n)},a._pool=[],a._gid=1,a}(),b=function(){function e(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}f(e,"laya.display.BitmapFont");var t=e.prototype;return t.loadFont=function(e,t){this._path=e,this._complete=t,x.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],v.create(this,this.onLoaded))},t.onLoaded=function(){this.parseFont(Ae.getRes(this._path),Ae.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},t.parseFont=function(e,t){if(null!=e&&null!=t){this._texture=t;var i=e.getElementsByTagName("info");if(!i[0].getAttributeNode)return this.parseFont2(e,t);this.fontSize=parseInt(i[0].getAttributeNode("size").nodeValue);var n,a=i[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(a[0]),parseInt(a[1]),parseInt(a[2]),parseInt(a[3])],n=e.getElementsByTagName("char");var r=0;for(r=0;r<n.length;r++){var s=n[r],o=parseInt(s.getAttributeNode("id").nodeValue),l=parseInt(s.getAttributeNode("xoffset").nodeValue)/1,h=parseInt(s.getAttributeNode("yoffset").nodeValue)/1,c=parseInt(s.getAttributeNode("xadvance").nodeValue)/1,u=new k;u.x=parseInt(s.getAttributeNode("x").nodeValue),u.y=parseInt(s.getAttributeNode("y").nodeValue),u.width=parseInt(s.getAttributeNode("width").nodeValue),u.height=parseInt(s.getAttributeNode("height").nodeValue);var d=Pe.create(t,u.x,u.y,u.width,u.height,l,h);this._maxWidth=Math.max(this._maxWidth,c+this.letterSpacing),this._fontCharDic[o]=d,this._fontWidthMap[o]=c}}},t.parseFont2=function(e,t){if(null!=e&&null!=t){this._texture=t;var i=e.getElementsByTagName("info");this.fontSize=parseInt(i[0].attributes.size.nodeValue);var n=i[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];var a=e.getElementsByTagName("char"),r=0;for(r=0;r<a.length;r++){var s=a[r].attributes,o=parseInt(s.id.nodeValue),l=parseInt(s.xoffset.nodeValue)/1,h=parseInt(s.yoffset.nodeValue)/1,c=parseInt(s.xadvance.nodeValue)/1,u=new k;u.x=parseInt(s.x.nodeValue),u.y=parseInt(s.y.nodeValue),u.width=parseInt(s.width.nodeValue),u.height=parseInt(s.height.nodeValue);var d=Pe.create(t,u.x,u.y,u.width,u.height,l,h);this._maxWidth=Math.max(this._maxWidth,c+this.letterSpacing),this._fontCharDic[o]=d,this._fontWidthMap[o]=c}}},t.getCharTexture=function(e){return this._fontCharDic[e.charCodeAt(0)]},t.destroy=function(){if(this._texture){for(var e in this._fontCharDic){var t=this._fontCharDic[e];t&&t.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},t.setSpaceWidth=function(e){this._spaceWidth=e},t.getCharWidth=function(e){var t=e.charCodeAt(0);return this._fontWidthMap[t]?this._fontWidthMap[t]+this.letterSpacing:" "==e?this._spaceWidth+this.letterSpacing:0},t.getTextWidth=function(e){for(var t=0,i=0,n=e.length;i<n;i++)t+=this.getCharWidth(e.charAt(i));return t},t.getMaxWidth=function(){return this._maxWidth},t.getMaxHeight=function(){return this.fontSize},t.drawText=function(e,t,i,n,a,r){var s,o=this.getTextWidth(e),l=0;"center"===a&&(l=(r-o)/2),"right"===a&&(l=r-o);for(var h=0,c=0,u=e.length;c<u;c++)(s=this.getCharTexture(e.charAt(c)))&&(t.graphics.drawTexture(s,i+h+l,n),h+=this.getCharWidth(e.charAt(c)))},e}(),o=function(){function i(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=i._TF_EMPTY}f(i,"laya.display.css.Style");var e=i.prototype;return e.getTransform=function(){return this._tf},e.setTransform=function(e){this._tf="none"!==e&&e?e:i._TF_EMPTY},e.setTranslateX=function(e){this._tf===i._TF_EMPTY&&(this._tf=new a),this._tf.translateX=e},e.setTranslateY=function(e){this._tf===i._TF_EMPTY&&(this._tf=new a),this._tf.translateY=e},e.setScaleX=function(e){this._tf===i._TF_EMPTY&&(this._tf=new a),this._tf.scaleX=e},e.setScale=function(e,t){this._tf===i._TF_EMPTY&&(this._tf=new a),this._tf.scaleX=e,this._tf.scaleY=t},e.setScaleY=function(e){this._tf===i._TF_EMPTY&&(this._tf=new a),this._tf.scaleY=e},e.setRotate=function(e){this._tf===i._TF_EMPTY&&(this._tf=new a),this._tf.rotate=e},e.setSkewX=function(e){this._tf===i._TF_EMPTY&&(this._tf=new a),this._tf.skewX=e},e.setSkewY=function(e){this._tf===i._TF_EMPTY&&(this._tf=new a),this._tf.skewY=e},e.destroy=function(){this.scrollRect=null},e.render=function(e,t,i,n){},e.getCSSStyle=function(){return Te.EMPTY},e._enableLayout=function(){return!1},c(0,e,"scaleX",function(){return this._tf.scaleX},function(e){this.setScaleX(e)}),c(0,e,"transform",function(){return this.getTransform()},function(e){this.setTransform(e)}),c(0,e,"translateX",function(){return this._tf.translateX},function(e){this.setTranslateX(e)}),c(0,e,"translateY",function(){return this._tf.translateY},function(e){this.setTranslateY(e)}),c(0,e,"scaleY",function(){return this._tf.scaleY},function(e){this.setScaleY(e)}),c(0,e,"block",function(){return 0!=(1&this._type)}),c(0,e,"skewY",function(){return this._tf.skewY},function(e){this.setSkewY(e)}),c(0,e,"rotate",function(){return this._tf.rotate},function(e){this.setRotate(e)}),c(0,e,"skewX",function(){return this._tf.skewX},function(e){this.setSkewX(e)}),c(0,e,"paddingLeft",function(){return 0}),c(0,e,"paddingTop",function(){return 0}),c(0,e,"absolute",function(){return!0}),i.__init__=function(){i._TF_EMPTY=new a,i.EMPTY=new i},i.EMPTY=null,i._TF_EMPTY=null,i}(),h=function(){function t(e){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=ae.create(t.defaultColor),this.family=t.defaultFamily,this.stroke=t._STROKE,this.size=t.defaultSize,e&&e!==t.EMPTY&&e.copyTo(this)}f(t,"laya.display.css.Font");var e=t.prototype;return e.set=function(e){this._text=null;for(var t=e.split(" "),i=0,n=t.length;i<n;i++){var a=t[i];switch(a){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<a.indexOf("px")&&(this.size=parseInt(a),this.family=t[i+1],i++)}},e.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},e.copyTo=function(e){e._type=this._type,e._text=this._text,e._weight=this._weight,e._color=this._color,e.family=this.family,e.stroke=this.stroke!=t._STROKE?this.stroke.slice():t._STROKE,e.indent=this.indent,e.size=this.size},c(0,e,"password",function(){return 0!=(1024&this._type)},function(e){e?this._type|=1024:this._type&=-1025}),c(0,e,"color",function(){return this._color.strColor},function(e){this._color=ae.create(e)}),c(0,e,"italic",function(){return 0!=(512&this._type)},function(e){e?this._type|=512:this._type&=-513}),c(0,e,"bold",function(){return 0!=(2048&this._type)},function(e){e?this._type|=2048:this._type&=-2049}),c(0,e,"weight",function(){return""+this._weight},function(e){var t=0;switch(e){case"normal":break;case"bold":this.bold=!0,t=700;break;case"bolder":t=800;break;case"lighter":t=100;break;default:t=parseInt(e)}this._weight=t,this._text=null}),c(0,e,"decoration",function(){return this._decoration?this._decoration.value:null},function(e){var t=e.split(" ");switch(this._decoration||(this._decoration={}),t[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=t[0]}t[1]&&(this._decoration.color=ae.create(t)),this._decoration.value=e}),t.__init__=function(){t.EMPTY=new t(null)},t.EMPTY=null,t.defaultColor="#000000",t.defaultSize=12,t.defaultFamily="Arial",t.defaultFont="12px Arial",t._STROKE=[0,"#000000"],t._ITALIC=512,t._PASSWORD=1024,t._BOLD=2048,t}(),a=(f(u,"laya.display.css.TransformInfo"),u);function u(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}var d=function(){function u(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,X.isConchNode){this._nativeObj=new r._conchGraphics,this.id=this._nativeObj.conchID}}f(u,"laya.display.Graphics");var e=u.prototype;return e.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},e.clear=function(e){void 0===e&&(e=!1);var t=0,i=0;if(e){var n=this._one;if(this._cmds){for(i=this._cmds.length,t=0;t<i;t++)!(n=this._cmds[t])||n.callee!==X._context._drawTexture&&n.callee!==X._context._drawTextureWithTransform||(n[0]=null,u._cache.push(n));this._cmds.length=0}else n&&(!n||n.callee!==X._context._drawTexture&&n.callee!==X._context._drawTextureWithTransform||(n[0]=null,u._cache.push(n)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(t=0,i=this._vectorgraphArray.length;t<i;t++)Ce.getInstance().deleteShape(this._vectorgraphArray[t]);this._vectorgraphArray.length=0}},e._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},e._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new _,this._graphicBounds._graphics=this)},e._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},e._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},e.getBounds=function(e){return void 0===e&&(e=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(e)},e.getBoundPoints=function(e){return void 0===e&&(e=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(e)},e._addCmd=function(e){this._cmds=this._cmds||[],e.callee=e.shift(),this._cmds.push(e)},e.setFilters=function(e){this._saveToCmd(X._context._setFilters,e)},e.drawTexture=function(e,t,i,n,a,r,s){if(void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===a&&(a=0),void 0===s&&(s=1),!e||s<.01)return null;n=n||e.sourceWidth,a=a||e.sourceHeight,s=s<0?0:1<s?1:s;var o,l=!X.isWebGL&&(Q.onFirefox||Q.onEdge||Q.onIE||Q.onSafari)?.5:0,h=n/e.sourceWidth,c=a/e.sourceHeight;return n=e.width*h,a=e.height*c,e.loaded&&(n<=0||a<=0)?null:(t+=e.offsetX*h,i+=e.offsetY*c,this._sp&&(this._sp._renderType|=512),t-=l,i-=l,n+=2*l,a+=2*l,u._cache.length?((o=u._cache.pop())[0]=e,o[1]=t,o[2]=i,o[3]=n,o[4]=a,o[5]=r,o[6]=s):o=[e,t,i,n,a,r,s],o.callee=r||1!=s?X._context._drawTextureWithTransform:X._context._drawTexture,null!=this._one||r||1!=s?this._saveToCmd(o.callee,o):(this._one=o,this._render=this._renderOneImg),e.loaded||e.once("loaded",this,this._textureLoaded,[e,o]),this._repaint(),o)},e.cleanByTexture=function(e,t,i,n,a){if(void 0===n&&(n=0),void 0===a&&(a=0),!e)return this.clear();if(this._one&&this._render===this._renderOneImg){n=n||e.sourceWidth,a=a||e.sourceHeight;var r=n/e.sourceWidth,s=a/e.sourceHeight;n=e.width*r,a=e.height*s,t+=e.offsetX*r,i+=e.offsetY*s,this._one[0]=e,this._one[1]=t,this._one[2]=i,this._one[3]=n,this._one[4]=a,this._repaint()}else this.clear(),e&&this.drawTexture(e,t,i,n,a)},e.drawTextures=function(e,t){e&&this._saveToCmd(X._context._drawTextures,[e,t])},e.fillTexture=function(e,t,i,n,a,r,s){if(void 0===n&&(n=0),void 0===a&&(a=0),void 0===r&&(r="repeat"),e){var o=[e,t,i,n,a,r,s||O.EMPTY,{}];e.loaded||e.once("loaded",this,this._textureLoaded,[e,o]),this._saveToCmd(X._context._fillTexture,o)}},e._textureLoaded=function(e,t){t[3]=t[3]||e.width,t[4]=t[4]||e.height,this._repaint()},e.fillCircle=function(e,t,i,n,a,r,s){i.bitmap.enableMerageInAtlas=!1;var o=new Float32Array(2*(s+1)),l=new Float32Array(2*(s+1)),h=new Uint16Array(3*s),c=2*Math.PI/s,u=0;o[0]=n,o[1]=a,l[0]=n/i.width,l[1]=a/i.height;for(var d=2,_=0;_<s;_++){var p=r*Math.cos(u)+n,f=r*Math.sin(u)+a;o[d]=p,o[d+1]=f,l[d]=p/i.width,l[d+1]=f/i.height,u+=c,d+=2}for(_=d=0;_<s;_++)h[d++]=0,h[d++]=_+1,h[d++]=s+1<=_+2?1:_+2;this.drawTriangles(i,e,t,o,l,h)},e.drawTriangles=function(e,t,i,n,a,r,s,o,l,h){void 0===o&&(o=1),this._saveToCmd(X._context.drawTriangles,[e,t,i,n,a,r,s,o,l,h])},e._saveToCmd=function(e,t){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=t,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(t)),t.callee=e,this._repaint(),t},e.clipRect=function(e,t,i,n){this._saveToCmd(X._context._clipRect,[e,t,i,n])},e.fillText=function(e,t,i,n,a,r,s){void 0===s&&(s=0),this._saveToCmd(X._context._fillText,[e,t,i,n||h.defaultFont,a,r])},e.fillBorderText=function(e,t,i,n,a,r,s,o){this._saveToCmd(X._context._fillBorderText,[e,t,i,n||h.defaultFont,a,r,s,o])},e.strokeText=function(e,t,i,n,a,r,s){this._saveToCmd(X._context._strokeText,[e,t,i,n||h.defaultFont,a,r,s])},e.alpha=function(e){e=e<0?0:1<e?1:e,this._saveToCmd(X._context._alpha,[e])},e.setAlpha=function(e){e=e<0?0:1<e?1:e,this._saveToCmd(X._context._setAlpha,[e])},e.transform=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),this._saveToCmd(X._context._transform,[e,t,i])},e.rotate=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),this._saveToCmd(X._context._rotate,[e,t,i])},e.scale=function(e,t,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this._saveToCmd(X._context._scale,[e,t,i,n])},e.translate=function(e,t){this._saveToCmd(X._context._translate,[e,t])},e.save=function(){this._saveToCmd(X._context._save,[])},e.restore=function(){this._saveToCmd(X._context._restore,[])},e.replaceText=function(e){this._repaint();var t=this._cmds;if(t){for(var i=t.length-1;-1<i;i--)if(this._isTextCmd(t[i].callee))return t[i][0].toUpperCase?t[i][0]=e:t[i][0].setText(e),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=e:this._one[0].setText(e),!0;return!1},e._isTextCmd=function(e){return e===X._context._fillText||e===X._context._fillBorderText||e===X._context._strokeText},e.replaceTextColor=function(e){this._repaint();var t=this._cmds;if(t)for(var i=t.length-1;-1<i;i--)this._isTextCmd(t[i].callee)&&(t[i][4]=e,t[i][0].toUpperCase||(t[i][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=e,this._one[0].toUpperCase||(this._one[0].changed=!0))},e.loadImage=function(e,t,i,n,a,r){var s=this;void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===a&&(a=0);var o=Ae.getRes(e);function l(e){e&&(s.drawTexture(e,t,i,n,a),null!=r&&r.call(s._sp,e))}o?l(o):x.loader.load(e,v.create(null,l),null,"image")},e._renderEmpty=function(e,t,i,n){},e._renderAll=function(e,t,i,n){for(var a,r=this._cmds,s=0,o=r.length;s<o;s++)(a=r[s]).callee.call(t,i,n,a)},e._renderOne=function(e,t,i,n){this._one.callee.call(t,i,n,this._one)},e._renderOneImg=function(e,t,i,n){this._one.callee.call(t,i,n,this._one),2305!==e._renderType&&(e._renderType|=1)},e.drawLine=function(e,t,i,n,a,r){void 0===r&&(r=1);var s=0;X.isWebGL&&(s=Ce.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(s));var o=r%2==0?0:.5,l=[e+o,t+o,i+o,n+o,a,r,s];this._saveToCmd(X._context._drawLine,l)},e.drawLines=function(e,t,i,n,a){void 0===a&&(a=1);var r=0;if(i&&!(i.length<4)){X.isWebGL&&(r=Ce.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(r));var s=a%2==0?0:.5,o=[e+s,t+s,i,n,a,r];this._saveToCmd(X._context._drawLines,o)}},e.drawCurves=function(e,t,i,n,a){void 0===a&&(a=1);var r=[e,t,i,n,a];this._saveToCmd(X._context._drawCurves,r)},e.drawRect=function(e,t,i,n,a,r,s){void 0===s&&(s=1);var o=r?s/2:0,l=r?s:0,h=[e+o,t+o,i-l,n-l,a,r,s];this._saveToCmd(X._context._drawRect,h)},e.drawCircle=function(e,t,i,n,a,r){void 0===r&&(r=1);var s=a?r/2:0,o=0;X.isWebGL&&(o=Ce.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(o));var l=[e,t,i-s,n,a,r,o];this._saveToCmd(X._context._drawCircle,l)},e.drawPie=function(e,t,i,n,a,r,s,o){void 0===o&&(o=1);var l=s?o/2:0,h=s?o:0,c=0;X.isWebGL&&(c=Ce.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(c));var u=[e+l,t+l,i-h,n,a,r,s,o,c];u[3]=ve.toRadian(n),u[4]=ve.toRadian(a),this._saveToCmd(X._context._drawPie,u)},e.drawPoly=function(e,t,i,n,a,r){void 0===r&&(r=1);var s=0,o=!1;X.isWebGL&&(s=Ce.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(s),o=!(6<i.length));var l=a?r%2==0?0:.5:0,h=[e+l,t+l,i,n,a,r,s,o];this._saveToCmd(X._context._drawPoly,h)},e.drawPath=function(e,t,i,n,a){var r=[e,t,i,n,a];this._saveToCmd(X._context._drawPath,r)},c(0,e,"cmds",function(){return this._cmds},function(e){this._sp&&(this._sp._renderType|=512),this._cmds=e,this._render=this._renderAll,this._repaint()}),u.__init__=function(){if(X.isConchNode){for(var e=laya.display.Graphics.prototype,t=Q.window.ConchGraphics.prototype,i=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],n=0,a=i.length;n<=a;n++){var r=i[n];e[r]=t[r]}e._saveToCmd=null,t.drawImageS&&(e.drawTextures=function(e,t){if(e&&e.loaded&&e.bitmap&&e.source){var i=e.uv,n=e.bitmap.width,a=e.bitmap.height;this.drawImageS(e.bitmap.source,i[0]*n,i[1]*a,(i[2]-i[0])*n,(i[5]-i[3])*a,e.offsetX,e.offsetY,e.width,e.height,t)}}),e.drawTexture=function(e,t,i,n,a,r,s){if(void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===a&&(a=0),void 0===s&&(s=1),e)if(e.loaded){if(e.loaded&&e.bitmap&&e.source&&(n=n||e.sourceWidth,a=a||e.sourceHeight,s=s<0?0:1<s?1:s,n=n-e.sourceWidth+e.width,a=a-e.sourceHeight+e.height,!(n<=0||a<=0))){t+=e.offsetX,i+=e.offsetY;var o=e.uv,l=e.bitmap.width,h=e.bitmap.height;o[4]<o[0]&&o[5]<o[1]?this.drawImageM(e.bitmap.source,o[4]*l,o[5]*h,(o[0]-o[4])*l,(o[1]-o[5])*h,t,i,n,a,r,s):this.drawImageM(e.bitmap.source,o[0]*l,o[1]*h,(o[2]-o[0])*l,(o[5]-o[3])*h,t,i,n,a,r,s),this._repaint()}}else e.once("loaded",this,function(){this.drawTexture(e,t,i,n,a,r)})},e.fillTexture=function(e,t,i,n,a,r,s){if(void 0===n&&(n=0),void 0===a&&(a=0),void 0===r&&(r="repeat"),e&&e.loaded){var o,l=X._context.ctx,h=e.bitmap.width,c=e.bitmap.height,u=e.uv;o=e.uv!=Pe.DEF_UV?l.createPattern(e.bitmap.source,r,u[0]*h,u[1]*c,(u[2]-u[0])*h,(u[5]-u[3])*c):l.createPattern(e.bitmap.source,r);var d=0,_=0;s&&(t+=s.x%e.width,i+=s.y%e.height,d-=s.x%e.width,_-=s.y%e.height),this._fillImage(o,t,i,d,_,n,a)}}}},u._cache=[],u}(),_=function(){function y(){this._cacheBoundsType=!1}f(y,"laya.display.GraphicsBounds");var e=y.prototype;return e.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},e.reset=function(){this._temp&&(this._temp.length=0)},e.getBounds=function(e){return void 0===e&&(e=!1),this._bounds&&this._temp&&!(this._temp.length<1)&&e==this._cacheBoundsType||(this._bounds=k._getWrapRec(this.getBoundPoints(e),this._bounds)),this._cacheBoundsType=e,this._bounds},e.getBoundPoints=function(e){return void 0===e&&(e=!1),(!this._temp||this._temp.length<1||e!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(e)),this._cacheBoundsType=e,this._rstBoundPoints=ve.copyArray(this._rstBoundPoints,this._temp)},e._getCmdPoints=function(e){void 0===e&&(e=!1);var t,i,n=X._context,a=this._graphics.cmds;if((t=this._temp||(this._temp=[])).length=0,a||null==this._graphics._one||(y._tempCmds.length=0,y._tempCmds.push(this._graphics._one),a=y._tempCmds),!a)return t;(i=y._tempMatrixArrays).length=0;var r=y._initMatrix;r.identity();for(var s,o,l=y._tempMatrix,h=NaN,c=NaN,u=NaN,d=NaN,_=NaN,p=NaN,f=0,m=a.length;f<m;f++)if((s=a[f]).callee)switch(s.callee){case n._save:case 7:i.push(r),r=r.clone();break;case n._restore:case 8:r=i.pop();break;case n._scale:case 5:l.identity(),l.translate(-s[2],-s[3]),l.scale(s[0],s[1]),l.translate(s[2],s[3]),this._switchMatrix(r,l);break;case n._rotate:case 3:l.identity(),l.translate(-s[1],-s[2]),l.rotate(s[0]),l.translate(s[1],s[2]),this._switchMatrix(r,l);break;case n._translate:case 6:l.identity(),l.translate(s[0],s[1]),this._switchMatrix(r,l);break;case n._transform:case 4:l.identity(),l.translate(-s[1],-s[2]),l.concat(s[0]),l.translate(s[1],s[2]),this._switchMatrix(r,l);break;case 16:case 24:y._addPointArrToRst(t,k._getBoundPointS(s[0],s[1],s[2],s[3]),r);break;case 17:r.copyTo(l),l.concat(s[4]),y._addPointArrToRst(t,k._getBoundPointS(s[0],s[1],s[2],s[3]),l);break;case n._drawTexture:o=s[0],e?s[3]&&s[4]?y._addPointArrToRst(t,k._getBoundPointS(s[1],s[2],s[3],s[4]),r):(o=s[0],y._addPointArrToRst(t,k._getBoundPointS(s[1],s[2],o.width,o.height),r)):(h=(s[3]||o.sourceWidth)/o.width,c=(s[4]||o.sourceHeight)/o.height,u=h*o.sourceWidth,d=c*o.sourceHeight,_=0<o.offsetX?o.offsetX:0,p=0<o.offsetY?o.offsetY:0,_*=h,p*=c,y._addPointArrToRst(t,k._getBoundPointS(s[1]-_,s[2]-p,u,d),r));break;case n._fillTexture:s[3]&&s[4]?y._addPointArrToRst(t,k._getBoundPointS(s[1],s[2],s[3],s[4]),r):(o=s[0],y._addPointArrToRst(t,k._getBoundPointS(s[1],s[2],o.width,o.height),r));break;case n._drawTextureWithTransform:var g;g=s[5]?(r.copyTo(l),l.concat(s[5]),l):r,e?s[3]&&s[4]?y._addPointArrToRst(t,k._getBoundPointS(s[1],s[2],s[3],s[4]),g):(o=s[0],y._addPointArrToRst(t,k._getBoundPointS(s[1],s[2],o.width,o.height),g)):(o=s[0],h=(s[3]||o.sourceWidth)/o.width,c=(s[4]||o.sourceHeight)/o.height,u=h*o.sourceWidth,d=c*o.sourceHeight,_=0<o.offsetX?o.offsetX:0,p=0<o.offsetY?o.offsetY:0,_*=h,p*=c,y._addPointArrToRst(t,k._getBoundPointS(s[1]-_,s[2]-p,u,d),g));break;case n._drawRect:case 13:y._addPointArrToRst(t,k._getBoundPointS(s[0],s[1],s[2],s[3]),r);break;case n._drawCircle:case n._fillCircle:case 14:y._addPointArrToRst(t,k._getBoundPointS(s[0]-s[2],s[1]-s[2],s[2]+s[2],s[2]+s[2]),r);break;case n._drawLine:case 20:y._tempPoints.length=0;var v;v=.5*s[5],s[0]==s[2]?y._tempPoints.push(s[0]+v,s[1],s[2]+v,s[3],s[0]-v,s[1],s[2]-v,s[3]):s[1]==s[3]?y._tempPoints.push(s[0],s[1]+v,s[2],s[3]+v,s[0],s[1]-v,s[2],s[3]-v):y._tempPoints.push(s[0],s[1],s[2],s[3]),y._addPointArrToRst(t,y._tempPoints,r);break;case n._drawCurves:case 22:y._addPointArrToRst(t,R.I.getBezierPoints(s[2]),r,s[0],s[1]);break;case n._drawPoly:case n._drawLines:case 18:y._addPointArrToRst(t,s[2],r,s[0],s[1]);break;case n._drawPath:case 19:y._addPointArrToRst(t,this._getPathPoints(s[2]),r,s[0],s[1]);break;case n._drawPie:case 15:y._addPointArrToRst(t,this._getPiePoints(s[0],s[1],s[2],s[3],s[4]),r)}return 200<t.length?t=ve.copyArray(t,k._getWrapRec(t)._getBoundPoints()):8<t.length&&(t=A.scanPList(t)),t},e._switchMatrix=function(e,t){t.concat(e),t.copyTo(e)},e._getPiePoints=function(e,t,i,n,a){var r=y._tempPoints;y._tempPoints.length=0,r.push(e,t);var s=(a-n)%(2*Math.PI)/10,o=NaN,l=n;for(o=0;o<=10;o++)r.push(e+i*Math.cos(l),t+i*Math.sin(l)),l+=s;return r},e._getPathPoints=function(e){var t,i,n=0,a=y._tempPoints;for(a.length=0,t=e.length,n=0;n<t;n++)1<(i=e[n]).length&&(a.push(i[1],i[2]),3<i.length&&a.push(i[3],i[4]));return a},y._addPointArrToRst=function(e,t,i,n,a){void 0===n&&(n=0),void 0===a&&(a=0);var r,s=0;for(r=t.length,s=0;s<r;s+=2)y._addPointToRst(e,t[s]+n,t[s+1]+a,i)},y._addPointToRst=function(e,t,i,n){var a=O.TEMP;a.setTo(t||0,i||0),n.transformPoint(a),e.push(a.x,a.y)},y._tempPoints=[],y._tempMatrixArrays=[],y._tempCmds=[],l(y,["_tempMatrix",function(){return this._tempMatrix=new N},"_initMatrix",function(){return this._initMatrix=new N}]),y}(),m=function(){function e(){}f(e,"laya.events.Event");var t=e.prototype;return t.setTo=function(e,t,i){return this.type=e,this.currentTarget=t,this.target=i,this},t.stopPropagation=function(){this._stoped=!0},c(0,t,"stageY",function(){return x.stage.mouseY}),c(0,t,"charCode",function(){return this.nativeEvent.charCode}),c(0,t,"touches",function(){var e=this.nativeEvent.touches;if(e)for(var t=x.stage,i=0,n=e.length;i<n;i++){var a=e[i],r=O.TEMP;r.setTo(a.clientX,a.clientY),t._canvasTransform.invertTransformPoint(r),t.transform.invertTransformPoint(r),a.stageX=r.x,a.stageY=r.y}return e}),c(0,t,"keyLocation",function(){return this.nativeEvent.keyLocation}),c(0,t,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),c(0,t,"altKey",function(){return this.nativeEvent.altKey}),c(0,t,"shiftKey",function(){return this.nativeEvent.shiftKey}),c(0,t,"stageX",function(){return x.stage.mouseX}),e.EMPTY=new e,e.MOUSE_DOWN="mousedown",e.MOUSE_UP="mouseup",e.CLICK="click",e.RIGHT_MOUSE_DOWN="rightmousedown",e.RIGHT_MOUSE_UP="rightmouseup",e.RIGHT_CLICK="rightclick",e.MOUSE_MOVE="mousemove",e.MOUSE_OVER="mouseover",e.MOUSE_OUT="mouseout",e.MOUSE_WHEEL="mousewheel",e.ROLL_OVER="mouseover",e.ROLL_OUT="mouseout",e.DOUBLE_CLICK="doubleclick",e.CHANGE="change",e.CHANGED="changed",e.RESIZE="resize",e.ADDED="added",e.REMOVED="removed",e.DISPLAY="display",e.UNDISPLAY="undisplay",e.ERROR="error",e.COMPLETE="complete",e.LOADED="loaded",e.PROGRESS="progress",e.INPUT="input",e.RENDER="render",e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.KEY_DOWN="keydown",e.KEY_PRESS="keypress",e.KEY_UP="keyup",e.FRAME="enterframe",e.DRAG_START="dragstart",e.DRAG_MOVE="dragmove",e.DRAG_END="dragend",e.ENTER="enter",e.SELECT="select",e.BLUR="blur",e.FOCUS="focus",e.VISIBILITY_CHANGE="visibilitychange",e.FOCUS_CHANGE="focuschange",e.PLAYED="played",e.PAUSED="paused",e.STOPPED="stopped",e.START="start",e.END="end",e.ENABLE_CHANGED="enablechanged",e.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",e.COMPONENT_ADDED="componentadded",e.COMPONENT_REMOVED="componentremoved",e.LAYER_CHANGED="layerchanged",e.HIERARCHY_LOADED="hierarchyloaded",e.RECOVERED="recovered",e.RELEASED="released",e.LINK="link",e.LABEL="label",e.FULL_SCREEN_CHANGE="fullscreenchange",e.DEVICE_LOST="devicelost",e.MESH_CHANGED="meshchanged",e.MATERIAL_CHANGED="materialchanged",e.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",e.ANIMATION_CHANGED="animationchanged",e.TRIGGER_ENTER="triggerenter",e.TRIGGER_STAY="triggerstay",e.TRIGGER_EXIT="triggerexit",e.TRAIL_FILTER_CHANGE="trailfilterchange",e.DOMINO_FILTER_CHANGE="dominofilterchange",e}();f(p,"laya.events.Keyboard"),p.NUMBER_0=48,p.NUMBER_1=49,p.NUMBER_2=50,p.NUMBER_3=51,p.NUMBER_4=52,p.NUMBER_5=53,p.NUMBER_6=54,p.NUMBER_7=55,p.NUMBER_8=56,p.NUMBER_9=57,p.A=65,p.B=66,p.C=67,p.D=68,p.E=69,p.F=70,p.G=71,p.H=72,p.I=73,p.J=74,p.K=75,p.L=76,p.M=77,p.N=78,p.O=79,p.P=80,p.Q=81,p.R=82,p.S=83,p.T=84,p.U=85,p.V=86,p.W=87,p.X=88,p.Y=89,p.Z=90,p.F1=112,p.F2=113,p.F3=114,p.F4=115,p.F5=116,p.F6=117,p.F7=118,p.F8=119,p.F9=120,p.F10=121,p.F11=122,p.F12=123,p.F13=124,p.F14=125,p.F15=126,p.NUMPAD=21,p.NUMPAD_0=96,p.NUMPAD_1=97,p.NUMPAD_2=98,p.NUMPAD_3=99,p.NUMPAD_4=100,p.NUMPAD_5=101,p.NUMPAD_6=102,p.NUMPAD_7=103,p.NUMPAD_8=104,p.NUMPAD_9=105,p.NUMPAD_ADD=107,p.NUMPAD_DECIMAL=110,p.NUMPAD_DIVIDE=111,p.NUMPAD_ENTER=108,p.NUMPAD_MULTIPLY=106,p.NUMPAD_SUBTRACT=109,p.SEMICOLON=186,p.EQUAL=187,p.COMMA=188,p.MINUS=189,p.PERIOD=190,p.SLASH=191,p.BACKQUOTE=192,p.LEFTBRACKET=219,p.BACKSLASH=220,p.RIGHTBRACKET=221,p.QUOTE=222,p.ALTERNATE=18,p.BACKSPACE=8,p.CAPS_LOCK=20,p.COMMAND=15,p.CONTROL=17,p.DELETE=46,p.ENTER=13,p.ESCAPE=27,p.PAGE_UP=33,p.PAGE_DOWN=34,p.END=35,p.HOME=36,p.LEFT=37,p.UP=38,p.RIGHT=39,p.DOWN=40,p.SHIFT=16,p.SPACE=32,p.TAB=9,p.INSERT=45;function p(){}var g=(f(y,"laya.events.KeyBoardManager"),y.__init__=function(){y._addEvent("keydown"),y._addEvent("keypress"),y._addEvent("keyup")},y._addEvent=function(t){Q.document.addEventListener(t,function(e){laya.events.KeyBoardManager._dispatch(e,t)},!0)},y._dispatch=function(e,t){if(y.enabled){y._event._stoped=!1,y._event.nativeEvent=e,y._event.keyCode=e.keyCode||e.which||e.charCode,"keydown"===t?y._pressKeys[y._event.keyCode]=!0:"keyup"===t&&(y._pressKeys[y._event.keyCode]=null);for(var i=x.stage.focus&&null!=x.stage.focus.event&&x.stage.focus.displayedInStage?x.stage.focus:x.stage,n=i;n;)n.event(t,y._event.setTo(t,n,i)),n=n.parent}},y.hasKeyDown=function(e){return y._pressKeys[e]},y._pressKeys={},y.enabled=!0,l(y,["_event",function(){return this._event=new m}]),y);function y(){}f(C,"laya.events.KeyLocation"),C.STANDARD=0,C.LEFT=1,C.RIGHT=2,C.NUM_PAD=3;function C(){}var E=function(){function c(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new m,this._matrix=new N,this._point=new O,this._rect=new k,this._prePoint=new O,this._curTouchID=NaN}f(c,"laya.events.MouseManager");var e=c.prototype;return e.__init__=function(e,t){var i=this;this._stage=e;var n=this,a=this._eventList;t.oncontextmenu=function(e){if(c.enabled)return!1},t.addEventListener("mousedown",function(e){c.enabled&&(Q.onIE||e.preventDefault(),a.push(e),n.mouseDownTime=Q.now())}),t.addEventListener("mouseup",function(e){c.enabled&&(e.preventDefault(),a.push(e),n.mouseDownTime=-Q.now())},!0),t.addEventListener("mousemove",function(e){if(c.enabled){e.preventDefault();var t=Q.now();if(t-n._lastMoveTimer<10)return;n._lastMoveTimer=t,a.push(e)}},!0),t.addEventListener("mouseout",function(e){c.enabled&&a.push(e)}),t.addEventListener("mouseover",function(e){c.enabled&&a.push(e)}),t.addEventListener("touchstart",function(e){c.enabled&&(a.push(e),c._isFirstTouch||je.isInputting||e.preventDefault(),n.mouseDownTime=Q.now())}),t.addEventListener("touchend",function(e){c.enabled?(c._isFirstTouch||je.isInputting||e.preventDefault(),c._isFirstTouch=!1,a.push(e),n.mouseDownTime=-Q.now()):i._curTouchID=NaN},!0),t.addEventListener("touchmove",function(e){c.enabled&&(e.preventDefault(),a.push(e))},!0),t.addEventListener("touchcancel",function(e){c.enabled?(e.preventDefault(),a.push(e)):i._curTouchID=NaN},!0),t.addEventListener("mousewheel",function(e){c.enabled&&a.push(e)}),t.addEventListener("DOMMouseScroll",function(e){c.enabled&&a.push(e)})},e.initEvent=function(e,t){var i,n=this;n._event._stoped=!1,n._event.nativeEvent=t||e,n._target=null,this._point.setTo(e.pageX||e.clientX,e.pageY||e.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),n.mouseX=this._point.x,n.mouseY=this._point.y,n._event.touchId=e.identifier||0,this._tTouchID=n._event.touchId,(i=S.I._event)._stoped=!1,i.nativeEvent=n._event.nativeEvent,i.touchId=n._event.touchId},e.checkMouseWheel=function(e){this._event.delta=e.wheelDelta?.025*e.wheelDelta:-e.detail;for(var t=S.I.getLastOvers(),i=0,n=t.length;i<n;i++){var a=t[i];a.event("mousewheel",this._event.setTo("mousewheel",a,this._target))}},e.onMouseMove=function(e){S.I.onMouseMove(e,this._tTouchID)},e.onMouseDown=function(e){if(je.isInputting&&x.stage.focus&&x.stage.focus.focus&&!x.stage.focus.contains(this._target)){var t=x.stage.focus._tf||x.stage.focus,i=e._tf||e;i instanceof laya.display.Input&&i.multiline==t.multiline?t._focusOut():t.focus=!1}S.I.onMouseDown(e,this._tTouchID,this._isLeftMouse)},e.onMouseUp=function(e){S.I.onMouseUp(e,this._tTouchID,this._isLeftMouse)},e.check=function(e,t,i,n){this._point.setTo(t,i),e.fromParentPoint(this._point),t=this._point.x,i=this._point.y;var a=e.scrollRect;if(a&&(this._rect.setTo(a.x,a.y,a.width,a.height),!this._rect.contains(t,i)))return!1;if(!this.disableMouseEvent){if(e.hitTestPrior&&!e.mouseThrough&&!this.hitTest(e,t,i))return!1;for(var r=e._childs.length-1;-1<r;r--){var s=e._childs[r];if(!s.destroyed&&s.mouseEnabled&&s.visible&&this.check(s,t,i,n))return!0}}var o=!(!e.hitTestPrior||e.mouseThrough||this.disableMouseEvent)||this.hitTest(e,t,i);return o?(this._target=e,n.call(this,e)):n===this.onMouseUp&&e===this._stage&&(this._target=this._stage,n.call(this,this._target)),o},e.hitTest=function(e,t,i){var n=!1;if(e.scrollRect&&(t-=e.scrollRect.x,i-=e.scrollRect.y),e.hitArea instanceof laya.utils.HitArea)return e.hitArea.isHit(t,i);if(0<e.width&&0<e.height||e.mouseThrough||e.hitArea)if(e.mouseThrough)n=e.getGraphicBounds().contains(t,i);else{var a=this._rect;e.hitArea?a=e.hitArea:a.setTo(0,0,e.width,e.height),n=a.contains(t,i)}return n},e.runEvent=function(){var e=this._eventList.length;if(e){for(var t,i=this,n=0,a=0,r=0;n<e;){var s=this._eventList[n];switch("mousemove"!==s.type&&(this._prePoint.x=this._prePoint.y=-1e6),s.type){case"mousedown":this._touchIDs[0]=this._id++,c._isTouchRespond?c._isTouchRespond=!1:(i._isLeftMouse=0===s.button,i.initEvent(s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseDown));break;case"mouseup":i._isLeftMouse=0===s.button,i.initEvent(s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-s.clientX)+Math.abs(this._prePoint.y-s.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=s.clientX,this._prePoint.y=s.clientY,i.initEvent(s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseMove));break;case"touchstart":c._isTouchRespond=!0,i._isLeftMouse=!0;var o=s.changedTouches;for(a=0,r=o.length;a<r;a++)t=o[a],(c.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=t.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[t.identifier]=this._id++,i.initEvent(t,s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseDown));break;case"touchend":case"touchcancel":c._isTouchRespond=!0,i._isLeftMouse=!0;var l=s.changedTouches;for(a=0,r=l.length;a<r;a++)if(t=l[a],c.multiTouchEnabled||t.identifier==this._curTouchID){this._curTouchID=NaN,i.initEvent(t,s);i.check(i._stage,i.mouseX,i.mouseY,i.onMouseUp)||i.onMouseUp(null)}break;case"touchmove":var h=s.changedTouches;for(a=0,r=h.length;a<r;a++)t=h[a],!c.multiTouchEnabled&&t.identifier!=this._curTouchID||(i.initEvent(t,s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":i.checkMouseWheel(s);break;case"mouseout":S.I.stageMouseOut();break;case"mouseover":i._stage.event("mouseover",i._event.setTo("mouseover",i._stage,i._stage))}n++}this._eventList.length=0}},c.enabled=!0,c.multiTouchEnabled=!0,c._isTouchRespond=!1,c._isFirstTouch=!0,l(c,["instance",function(){return this.instance=new c}]),c}(),S=function(){function p(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new m}f(p,"laya.events.TouchManager");var e=p.prototype;return e._clearTempArrs=function(){p._oldArr.length=0,p._newArr.length=0,p._tEleArr.length=0},e.getTouchFromArr=function(e,t){var i,n,a=0;for(i=t.length,a=0;a<i;a++)if((n=t[a]).id==e)return n;return null},e.removeTouchFromArr=function(e,t){var i=0;for(i=t.length-1;0<=i;i--)t[i].id==e&&t.splice(i,1)},e.createTouchO=function(e,t){var i;return(i=de.getItem("TouchData")||{}).id=t,i.tar=e,i},e.onMouseDown=function(e,t,i){var n,a,r,s;void 0===i&&(i=!1),this.enable&&(n=this.getTouchFromArr(t,this.preOvers),r=this.getEles(e,null,p._tEleArr),n?n.tar=e:(a=this.createTouchO(e,t),this.preOvers.push(a)),Q.onMobile&&this.sendEvents(r,"mouseover"),s=i?this.preDowns:this.preRightDowns,(n=this.getTouchFromArr(t,s))?n.tar=e:(a=this.createTouchO(e,t),s.push(a)),this.sendEvents(r,i?"mousedown":"rightmousedown"),this._clearTempArrs())},e.sendEvents=function(e,t){var i,n,a,r=0;for(i=e.length,this._event._stoped=!1,n=e[0],r=0;r<i;r++){if((a=e[r]).destroyed)return;if(a.event(t,this._event.setTo(t,a,n)),this._event._stoped)break}},e.getEles=function(e,t,i){for(i?i.length=0:i=[];e&&e!=t;)i.push(e),e=e.parent;return i},e.checkMouseOutAndOverOfMove=function(e,t,i){if(void 0===i&&(i=0),t!=e){var n,a,r=0,s=0;if(t.contains(e))a=this.getEles(e,t,p._tEleArr),this.sendEvents(a,"mouseover");else if(e.contains(t))a=this.getEles(t,e,p._tEleArr),this.sendEvents(a,"mouseout");else{var o,l;(a=p._tEleArr).length=0,o=this.getEles(t,null,p._oldArr),l=this.getEles(e,null,p._newArr),s=o.length;var h=0;for(r=0;r<s;r++){if(n=o[r],0<=(h=l.indexOf(n))){l.splice(h,l.length-h);break}a.push(n)}0<a.length&&this.sendEvents(a,"mouseout"),0<l.length&&this.sendEvents(l,"mouseover")}}},e.onMouseMove=function(e,t){var i,n;this.enable&&((i=this.getTouchFromArr(t,this.preOvers))?(this.checkMouseOutAndOverOfMove(e,i.tar),i.tar=e,n=this.getEles(e,null,p._tEleArr)):(n=this.getEles(e,null,p._tEleArr),this.sendEvents(n,"mouseover"),this.preOvers.push(this.createTouchO(e,t))),this.sendEvents(n,"mousemove"),this._clearTempArrs())},e.getLastOvers=function(){return(p._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,p._tEleArr):(p._tEleArr.push(x.stage),p._tEleArr)},e.stageMouseOut=function(){var e;e=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(e,"mouseout")},e.onMouseUp=function(e,t,i){if(void 0===i&&(i=!1),this.enable){var n,a,r,s,o,l,h=0,c=0,u=Q.onMobile;if(a=this.getEles(e,null,p._tEleArr),this.sendEvents(a,i?"mouseup":"rightmouseup"),l=i?this.preDowns:this.preRightDowns,n=this.getTouchFromArr(t,l)){var d,_=Q.now();if(d=_-this._lastClickTime<300,this._lastClickTime=_,e==n.tar)o=a;else for(r=this.getEles(n.tar,null,p._oldArr),(o=p._newArr).length=0,c=r.length,h=0;h<c;h++)s=r[h],0<=a.indexOf(s)&&o.push(s);0<o.length&&this.sendEvents(o,i?"click":"rightclick"),i&&d&&this.sendEvents(o,"doubleclick"),this.removeTouchFromArr(t,l),n.tar=null,de.recover("TouchData",n)}else;(n=this.getTouchFromArr(t,this.preOvers))&&u&&((o=this.getEles(n.tar,null,o))&&0<o.length&&this.sendEvents(o,"mouseout"),this.removeTouchFromArr(t,this.preOvers),n.tar=null,de.recover("TouchData",n)),this._clearTempArrs()}},p._oldArr=[],p._newArr=[],p._tEleArr=[],l(p,["I",function(){return this.I=new p}]),p}(),T=function(){function e(){this._action=null}f(e,"laya.filters.Filter");var t=e.prototype;return x.imps(t,{"laya.filters.IFilter":!0}),t.callNative=function(e){},c(0,t,"type",function(){return-1}),c(0,t,"action",function(){return this._action}),e.BLUR=16,e.COLOR=32,e.GLOW=8,e._filterStart=null,e._filterEnd=null,e._EndTarget=null,e._recycleScope=null,e._filter=null,e._useSrc=null,e._endSrc=null,e._useOut=null,e._endOut=null,e}(),w=function(){function e(){this.data=null}f(e,"laya.filters.ColorFilterAction");var t=e.prototype;return x.imps(t,{"laya.filters.IFilterAction":!0}),t.apply=function(e){var t=e.ctx.ctx,i=e.ctx.ctx.canvas;if(0==i.width||0==i.height)return i;for(var n,a=t.getImageData(0,0,i.width,i.height),r=a.data,s=0,o=r.length;s<o;s+=4)n=this.getColor(r[s],r[s+1],r[s+2],r[s+3]),0!=r[s+3]&&(r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2],r[s+3]=n[3]);return t.putImageData(a,0,0),e},t.getColor=function(e,t,i,n){var a=[];if(this.data._mat&&this.data._alpha){var r=this.data._mat,s=this.data._alpha;a[0]=r[0]*e+r[1]*t+r[2]*i+r[3]*n+s[0],a[1]=r[4]*e+r[5]*t+r[6]*i+r[7]*n+s[1],a[2]=r[8]*e+r[9]*t+r[10]*i+r[11]*n+s[2],a[3]=r[12]*e+r[13]*t+r[14]*i+r[15]*n+s[3]}return a},e}();f(M,"laya.maths.Arith"),M.formatR=function(e){return e>Math.PI&&(e-=2*Math.PI),e<-Math.PI&&(e+=2*Math.PI),e},M.isPOT=function(e,t){return 0<e&&0==(e&e-1)&&0<t&&0==(t&t-1)},M.setMatToArray=function(e,t){e.a,e.b,e.c,e.d,e.tx,e.ty,t[0]=e.a,t[1]=e.b,t[4]=e.c,t[5]=e.d,t[12]=e.tx,t[13]=e.ty};function M(){}var R=function(){function e(){this._controlPoints=[new O,new O,new O],this._calFun=this.getPoint2}f(e,"laya.maths.Bezier");var t=e.prototype;return t._switchPoint=function(e,t){var i=this._controlPoints.shift();i.setTo(e,t),this._controlPoints.push(i)},t.getPoint2=function(e,t){var i=this._controlPoints[0],n=this._controlPoints[1],a=this._controlPoints[2],r=Math.pow(1-e,2)*i.x+2*e*(1-e)*n.x+Math.pow(e,2)*a.x,s=Math.pow(1-e,2)*i.y+2*e*(1-e)*n.y+Math.pow(e,2)*a.y;t.push(r,s)},t.getPoint3=function(e,t){var i=this._controlPoints[0],n=this._controlPoints[1],a=this._controlPoints[2],r=this._controlPoints[3],s=Math.pow(1-e,3)*i.x+3*n.x*e*(1-e)*(1-e)+3*a.x*e*e*(1-e)+r.x*Math.pow(e,3),o=Math.pow(1-e,3)*i.y+3*n.y*e*(1-e)*(1-e)+3*a.y*e*e*(1-e)+r.y*Math.pow(e,3);t.push(s,o)},t.insertPoints=function(e,t){var i,n=NaN;for(i=1/(e=0<e?e:5),n=0;n<=1;n+=i)this._calFun(n,t)},t.getBezierPoints=function(e,t,i){void 0===t&&(t=5),void 0===i&&(i=2);var n,a,r=0;if((n=e.length)<2*(i+1))return[];switch(a=[],i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=i;)this._controlPoints.push(new O);for(r=0;r<2*i;r+=2)this._switchPoint(e[r],e[r+1]);for(r=2*i;r<n;r+=2)this._switchPoint(e[r],e[r+1]),r/2%i==0&&this.insertPoints(t,a);return a},l(e,["I",function(){return this.I=new e}]),e}(),A=(f(I,"laya.maths.GrahamScan"),I.multiply=function(e,t,i){return(e.x-i.x)*(t.y-i.y)-(t.x-i.x)*(e.y-i.y)},I.dis=function(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)},I._getPoints=function(e,t,i){for(void 0===t&&(t=!1),I._mPointList||(I._mPointList=[]);I._mPointList.length<e;)I._mPointList.push(new O);return(i=i||[]).length=0,t?I.getFrom(i,I._mPointList,e):I.getFromR(i,I._mPointList,e),i},I.getFrom=function(e,t,i){var n=0;for(n=0;n<i;n++)e.push(t[n]);return e},I.getFromR=function(e,t,i){var n=0;for(n=0;n<i;n++)e.push(t.pop());return e},I.pListToPointList=function(e,t){void 0===t&&(t=!1);var i=0,n=e.length/2,a=I._getPoints(n,t,I._tempPointList);for(i=0;i<n;i++)a[i].setTo(e[i+i],e[i+i+1]);return a},I.pointListToPlist=function(e){var t,i=0,n=e.length,a=I._temPList;for(i=a.length=0;i<n;i++)t=e[i],a.push(t.x,t.y);return a},I.scanPList=function(e){return ve.copyArray(e,I.pointListToPlist(I.scan(I.pListToPointList(e,!0))))},I.scan=function(e){var t,i,n,a=0,r=0,s=0,o=e.length,l={};for((i=I._temArr).length=0,a=(o=e.length)-1;0<=a;a--)n=(t=e[a]).x+"_"+t.y,l.hasOwnProperty(n)||(l[n]=!0,i.push(t));for(o=i.length,ve.copyArray(e,i),a=1;a<o;a++)(e[a].y<e[s].y||e[a].y==e[s].y&&e[a].x<e[s].x)&&(s=a);for(t=e[0],e[0]=e[s],e[s]=t,a=1;a<o-1;a++){for(r=(s=a)+1;r<o;r++)(0<I.multiply(e[r],e[s],e[0])||0==I.multiply(e[r],e[s],e[0])&&I.dis(e[0],e[r])<I.dis(e[0],e[s]))&&(s=r);t=e[a],e[a]=e[s],e[s]=t}if((i=I._temArr).length=0,e.length<3)return ve.copyArray(i,e);for(i.push(e[0],e[1],e[2]),a=3;a<o;a++){for(;2<=i.length&&0<=I.multiply(e[a],i[i.length-1],i[i.length-2]);)i.pop();e[a]&&i.push(e[a])}return i},I._mPointList=null,I._tempPointList=[],I._temPList=[],I._temArr=[],I);function I(){}var D=(f(P,"laya.maths.MathUtil"),P.subtractVector3=function(e,t,i){i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2]},P.lerp=function(e,t,i){return e*(1-i)+t*i},P.scaleVector3=function(e,t,i){i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t},P.lerpVector3=function(e,t,i,n){var a=e[0],r=e[1],s=e[2];n[0]=a+i*(t[0]-a),n[1]=r+i*(t[1]-r),n[2]=s+i*(t[2]-s)},P.lerpVector4=function(e,t,i,n){var a=e[0],r=e[1],s=e[2],o=e[3];n[0]=a+i*(t[0]-a),n[1]=r+i*(t[1]-r),n[2]=s+i*(t[2]-s),n[3]=o+i*(t[3]-o)},P.slerpQuaternionArray=function(e,t,i,n,a,r,s){var o,l,h,c,u,d=e[t+0],_=e[t+1],p=e[t+2],f=e[t+3],m=i[n+0],g=i[n+1],v=i[n+2],y=i[n+3];return(l=d*m+_*g+p*v+f*y)<0&&(l=-l,m=-m,g=-g,v=-v,y=-y),u=1e-6<1-l?(o=Math.acos(l),h=Math.sin(o),c=Math.sin((1-a)*o)/h,Math.sin(a*o)/h):(c=1-a,a),r[s+0]=c*d+u*m,r[s+1]=c*_+u*g,r[s+2]=c*p+u*v,r[s+3]=c*f+u*y,r},P.getRotation=function(e,t,i,n){return Math.atan2(n-t,i-e)/Math.PI*180},P.sortBigFirst=function(e,t){return e==t?0:e<t?1:-1},P.sortSmallFirst=function(e,t){return e==t?0:e<t?-1:1},P.sortNumBigFirst=function(e,t){return parseFloat(t)-parseFloat(e)},P.sortNumSmallFirst=function(e,t){return parseFloat(e)-parseFloat(t)},P.sortByKey=function(i,e,t){var n;return void 0===e&&(e=!1),void 0===t&&(t=!0),n=e?t?P.sortNumBigFirst:P.sortBigFirst:t?P.sortNumSmallFirst:P.sortSmallFirst,function(e,t){return n(e[i],t[i])}},P);function P(){}var N=function(){function i(e,t,i,n,a,r){this.inPool=!1,this.bTransform=!1,void 0===e&&(e=1),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===a&&(a=0),void 0===r&&(r=0),this.a=e,this.b=t,this.c=i,this.d=n,this.tx=a,this.ty=r,this._checkTransform()}f(i,"laya.maths.Matrix");var e=i.prototype;return e.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},e._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},e.setTranslate=function(e,t){return this.tx=e,this.ty=t,this},e.translate=function(e,t){return this.tx+=e,this.ty+=t,this},e.scale=function(e,t){this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this.bTransform=!0},e.rotate=function(e){var t=Math.cos(e),i=Math.sin(e),n=this.a,a=this.c,r=this.tx;this.a=n*t-this.b*i,this.b=n*i+this.b*t,this.c=a*t-this.d*i,this.d=a*i+this.d*t,this.tx=r*t-this.ty*i,this.ty=r*i+this.ty*t,this.bTransform=!0},e.skew=function(e,t){var i=Math.tan(e),n=Math.tan(t),a=this.a,r=this.b;return this.a+=n*this.c,this.b+=n*this.d,this.c+=i*a,this.d+=i*r,this},e.invertTransformPoint=function(e){var t=this.a,i=this.b,n=this.c,a=this.d,r=this.tx,s=t*a-i*n,o=a/s,l=-i/s,h=-n/s,c=t/s,u=(n*this.ty-a*r)/s,d=-(t*this.ty-i*r)/s;return e.setTo(o*e.x+h*e.y+u,l*e.x+c*e.y+d)},e.transformPoint=function(e){return e.setTo(this.a*e.x+this.c*e.y+this.tx,this.b*e.x+this.d*e.y+this.ty)},e.transformPointN=function(e){return e.setTo(this.a*e.x+this.c*e.y,this.b*e.x+this.d*e.y)},e.transformPointArray=function(e,t){for(var i=e.length,n=0;n<i;n+=2){var a=e[n],r=e[n+1];t[n]=this.a*a+this.c*r+this.tx,t[n+1]=this.b*a+this.d*r+this.ty}return t},e.transformPointArrayScale=function(e,t){for(var i=e.length,n=0;n<i;n+=2){var a=e[n],r=e[n+1];t[n]=this.a*a+this.c*r,t[n+1]=this.b*a+this.d*r}return t},e.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},e.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},e.invert=function(){var e=this.a,t=this.b,i=this.c,n=this.d,a=this.tx,r=e*n-t*i;return this.a=n/r,this.b=-t/r,this.c=-i/r,this.d=e/r,this.tx=(i*this.ty-n*a)/r,this.ty=-(e*this.ty-t*a)/r,this},e.setTo=function(e,t,i,n,a,r){return this.a=e,this.b=t,this.c=i,this.d=n,this.tx=a,this.ty=r,this},e.concat=function(e){var t=this.a,i=this.c,n=this.tx;return this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d,this.tx=n*e.a+this.ty*e.c+e.tx,this.ty=n*e.b+this.ty*e.d+e.ty,this},e.scaleEx=function(e,t){var i=this.a,n=this.b,a=this.c,r=this.d;0!==n||0!==a?(this.a=e*i,this.b=e*n,this.c=t*a):(this.a=e*i,this.b=0*r,this.c=0*i),this.d=t*r,this.bTransform=!0},e.rotateEx=function(e){var t=Math.cos(e),i=Math.sin(e),n=this.a,a=this.b,r=this.c,s=this.d;0!==a||0!==r?(this.a=t*n+i*r,this.b=t*a+i*s,this.c=-i*n+t*r,this.d=-i*a+t*s):(this.a=t*n,this.b=i*s,this.c=-i*n,this.d=t*s),this.bTransform=!0},e.clone=function(){var e=i.create();return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e.bTransform=this.bTransform,e},e.copyTo=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e.bTransform=this.bTransform,e},e.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},e.destroy=function(){if(!this.inPool){var e=i._cache;this.inPool=!0,e._length||(e._length=0),(e[e._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},i.mul=function(e,t,i){var n=e.a,a=e.b,r=e.c,s=e.d,o=e.tx,l=e.ty,h=t.a,c=t.b,u=t.c,d=t.d,_=t.tx,p=t.ty;return 0!==c||0!==u?(i.a=n*h+a*u,i.b=n*c+a*d,i.c=r*h+s*u,i.d=r*c+s*d,i.tx=h*o+u*l+_,i.ty=c*o+d*l+p):(i.a=n*h,i.b=a*d,i.c=r*h,i.d=s*d,i.tx=h*o+_,i.ty=d*l+p),i},i.mul16=function(e,t,i){var n=e.a,a=e.b,r=e.c,s=e.d,o=e.tx,l=e.ty,h=t.a,c=t.b,u=t.c,d=t.d,_=t.tx,p=t.ty;return 0!==c||0!==u?(i[0]=n*h+a*u,i[1]=n*c+a*d,i[4]=r*h+s*u,i[5]=r*c+s*d,i[12]=h*o+u*l+_,i[13]=c*o+d*l+p):(i[0]=n*h,i[1]=a*d,i[4]=r*h,i[5]=s*d,i[12]=h*o+_,i[13]=d*l+p),i},i.mulPre=function(e,t,i,n,a,r,s,o){var l=e.a,h=e.b,c=e.c,u=e.d,d=e.tx,_=e.ty;return 0!==i||0!==n?(o.a=l*t+h*n,o.b=l*i+h*a,o.c=c*t+u*n,o.d=c*i+u*a,o.tx=t*d+n*_+r,o.ty=i*d+a*_+s):(o.a=l*t,o.b=h*a,o.c=c*t,o.d=u*a,o.tx=t*d+r,o.ty=a*_+s),o},i.mulPos=function(e,t,i,n,a,r,s,o){var l=e.a,h=e.b,c=e.c,u=e.d,d=e.tx,_=e.ty;return 0!==h||0!==c?(o.a=t*l+i*c,o.b=t*h+i*u,o.c=n*l+a*c,o.d=n*h+a*u,o.tx=l*r+c*s+d,o.ty=h*r+u*s+_):(o.a=t*l,o.b=i*u,o.c=n*l,o.d=a*u,o.tx=l*r+d,o.ty=u*s+_),o},i.preMul=function(e,t,i){var n=e.a,a=e.b,r=e.c,s=e.d,o=t.a,l=t.b,h=t.c,c=t.d,u=t.tx,d=t.ty;return i.a=o*n,i.b=i.c=0,i.d=c*s,i.tx=u*n+e.tx,i.ty=d*s+e.ty,0===l&&0===h&&0===a&&0===r||(i.a+=l*r,i.d+=h*a,i.b+=o*a+l*s,i.c+=h*n+c*r,i.tx+=d*r,i.ty+=u*a),i},i.preMulXY=function(e,t,i,n){var a=e.a,r=e.b,s=e.c,o=e.d;return n.a=a,n.b=r,n.c=s,n.d=o,n.tx=t*a+e.tx+i*s,n.ty=i*o+e.ty+t*r,n},i.create=function(){var e=i._cache,t=e._length?e[--e._length]:new i;return t.inPool=!1,t},i.EMPTY=new i,i.TEMP=new i,i._cache=[],i}(),O=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}f(e,"laya.maths.Point");var t=e.prototype;return t.setTo=function(e,t){return this.x=e,this.y=t,this},t.distance=function(e,t){return Math.sqrt((this.x-e)*(this.x-e)+(this.y-t)*(this.y-t))},t.toString=function(){return this.x+","+this.y},t.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(0<e){var t=1/e;this.x*=t,this.y*=t}},e.TEMP=new e,e.EMPTY=new e,e}(),k=function(){function h(e,t,i,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=e,this.y=t,this.width=i,this.height=n}f(h,"laya.maths.Rectangle");var e=h.prototype;return e.setTo=function(e,t,i,n){return this.x=e,this.y=t,this.width=i,this.height=n,this},e.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},e.contains=function(e,t){return!(this.width<=0||this.height<=0)&&(e>=this.x&&e<this.right&&t>=this.y&&t<this.bottom)},e.intersects=function(e){return!(e.x>this.x+this.width||e.x+e.width<this.x||e.y>this.y+this.height||e.y+e.height<this.y)},e.intersection=function(e,t){return this.intersects(e)?((t=t||new h).x=Math.max(this.x,e.x),t.y=Math.max(this.y,e.y),t.width=Math.min(this.right,e.right)-t.x,t.height=Math.min(this.bottom,e.bottom)-t.y,t):null},e.union=function(e,t){return t=t||new h,this.clone(t),e.width<=0||e.height<=0?t:(t.addPoint(e.x,e.y),t.addPoint(e.right,e.bottom),this)},e.clone=function(e){return(e=e||new h).x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},e.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},e.equals=function(e){return!(!e||e.x!==this.x||e.y!==this.y||e.width!==this.width||e.height!==this.height)},e.addPoint=function(e,t){return this.x>e&&(this.width+=this.x-e,this.x=e),this.y>t&&(this.height+=this.y-t,this.y=t),this.width<e-this.x&&(this.width=e-this.x),this.height<t-this.y&&(this.height=t-this.y),this},e._getBoundPoints=function(){var e=h._temB;return(e.length=0)==this.width||0==this.height||e.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),e},e.isEmpty=function(){return this.width<=0||this.height<=0},c(0,e,"right",function(){return this.x+this.width}),c(0,e,"bottom",function(){return this.y+this.height}),h._getBoundPointS=function(e,t,i,n){var a=h._temA;return(a.length=0)==i||0==n||a.push(e,t,e+i,t,e,t+n,e+i,t+n),a},h._getWrapRec=function(e,t){if(!e||e.length<1)return t?t.setTo(0,0,0,0):h.TEMP.setTo(0,0,0,0);t=t||new h;var i,n,a,r,s,o=e.length,l=O.TEMP;for(a=s=-(n=r=99999),i=0;i<o;i+=2)l.x=e[i],l.y=e[i+1],n=n<l.x?n:l.x,r=r<l.y?r:l.y,a=a>l.x?a:l.x,s=s>l.y?s:l.y;return t.setTo(n,r,a-n,s-r)},h.EMPTY=new h,h.TEMP=new h,h._temB=[],h._temA=[],h}(),V=(f(B,"laya.media.SoundManager"),c(1,B,"useAudioMusic",function(){return B._useAudioMusic},function(e){B._useAudioMusic=e,B._musicClass=e?we:null}),c(1,B,"autoStopMusic",function(){return B._autoStopMusic},function(e){x.stage.off("blur",null,B._stageOnBlur),x.stage.off("focus",null,B._stageOnFocus),x.stage.off("visibilitychange",null,B._visibilityChange),(B._autoStopMusic=e)&&(x.stage.on("blur",null,B._stageOnBlur),x.stage.on("focus",null,B._stageOnFocus),x.stage.on("visibilitychange",null,B._visibilityChange))}),c(1,B,"muted",function(){return B._muted},function(e){e!=B._muted&&(e&&B.stopAllSound(),B.musicMuted=e,B._muted=e)}),c(1,B,"musicMuted",function(){return B._musicMuted},function(e){e!=B._musicMuted&&(e?(B._tMusic&&B._musicChannel&&!B._musicChannel.isStopped?B._musicChannel.pause():B._musicChannel=null,B._musicMuted=e):(B._musicMuted=e,B._tMusic&&B._musicChannel&&B._musicChannel.resume()))}),c(1,B,"soundMuted",function(){return B._soundMuted},function(e){B._soundMuted=e}),B.addChannel=function(e){0<=B._channels.indexOf(e)||B._channels.push(e)},B.removeChannel=function(e){var t=0;for(t=B._channels.length-1;0<=t;t--)B._channels[t]==e&&B._channels.splice(t,1)},B.disposeSoundIfNotUsed=function(e){var t=0;for(t=B._channels.length-1;0<=t;t--)if(B._channels[t].url==e)return;B.destroySound(e)},B._visibilityChange=function(){x.stage.isVisibility?B._stageOnFocus():B._stageOnBlur()},B._stageOnBlur=function(){B._isActive=!1,B._musicChannel&&(B._musicChannel.isStopped||(B._blurPaused=!0,B._musicChannel.pause())),B.stopAllSound(),x.stage.once("mousedown",null,B._stageOnFocus)},B._recoverWebAudio=function(){Re.ctx&&"running"!=Re.ctx.state&&Re.ctx.resume&&Re.ctx.resume()},B._stageOnFocus=function(){B._isActive=!0,B._recoverWebAudio(),x.stage.off("mousedown",null,B._stageOnFocus),B._blurPaused&&B._musicChannel&&B._musicChannel.isStopped&&(B._blurPaused=!1,B._musicChannel.resume())},B.playSound=function(e,t,i,n,a){if(void 0===t&&(t=1),void 0===a&&(a=0),!B._isActive||!e)return null;if(B._muted)return null;if(B._recoverWebAudio(),(e=W.formatURL(e))==B._tMusic){if(B._musicMuted)return null}else{if(X.isConchApp){var r=ve.getFileExtension(e);if("wav"!=r&&"ogg"!=r)return alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document."),null}if(B._soundMuted)return null}var s,o;return Q.onMiniGame||(s=x.loader.getRes(e)),n=n||B._soundClass,s||((s=new n).load(e),Q.onMiniGame||Ae.cacheRes(e,s)),(o=s.play(a,t))?(o.url=e,o.volume=e==B._tMusic?B.musicVolume:B.soundVolume,o.completeHandler=i,o):null},B.destroySound=function(e){var t=x.loader.getRes(e);t&&(Ae.clearRes(e),t.dispose())},B.playMusic=function(e,t,i,n){return void 0===t&&(t=0),void 0===n&&(n=0),e=W.formatURL(e),B._tMusic=e,B._musicChannel&&B._musicChannel.stop(),B._musicChannel=B.playSound(e,t,i,B._musicClass,n)},B.stopSound=function(e){e=W.formatURL(e);var t,i=0;for(i=B._channels.length-1;0<=i;i--)(t=B._channels[i]).url==e&&t.stop()},B.stopAll=function(){B._tMusic=null;var e=0;for(e=B._channels.length-1;0<=e;e--)B._channels[e].stop()},B.stopAllSound=function(){var e,t=0;for(t=B._channels.length-1;0<=t;t--)(e=B._channels[t]).url!=B._tMusic&&e.stop()},B.stopMusic=function(){B._musicChannel&&B._musicChannel.stop(),B._tMusic=null},B.setSoundVolume=function(e,t){if(t)t=W.formatURL(t),B._setVolume(t,e);else{B.soundVolume=e;var i,n=0;for(n=B._channels.length-1;0<=n;n--)(i=B._channels[n]).url!=B._tMusic&&(i.volume=e)}},B.setMusicVolume=function(e){B.musicVolume=e,B._setVolume(B._tMusic,e)},B._setVolume=function(e,t){e=W.formatURL(e);var i,n=0;for(n=B._channels.length-1;0<=n;n--)(i=B._channels[n]).url==e&&(i.volume=t)},B.musicVolume=1,B.soundVolume=1,B.playbackRate=1,B._useAudioMusic=!0,B._muted=!1,B._soundMuted=!1,B._musicMuted=!1,B._tMusic=null,B._musicChannel=null,B._channels=[],B._autoStopMusic=!1,B._blurPaused=!1,B._isActive=!0,B._soundClass=null,B._musicClass=null,B.autoReleaseSound=!0,B);function B(){}var F,H=(f(U,"laya.net.LocalStorage"),U.__init__=function(){U._baseClass||(U._baseClass=F).init(),U.items=U._baseClass.items,U.support=U._baseClass.support},U.setItem=function(e,t){U._baseClass.setItem(e,t)},U.getItem=function(e){return U._baseClass.getItem(e)},U.setJSON=function(e,t){U._baseClass.setJSON(e,t)},U.getJSON=function(e){return U._baseClass.getJSON(e)},U.removeItem=function(e){U._baseClass.removeItem(e)},U.clear=function(){U._baseClass.clear()},U._baseClass=null,U.items=null,U.support=!1,U.__init$=function(){function i(){}f(i,""),i.init=function(){try{i.support=!0,i.items=r.localStorage,i.setItem("laya","1"),i.removeItem("laya")}catch(e){i.support=!1}i.support||console.log("LocalStorage is not supprot or browser is private mode.")},i.setItem=function(e,t){try{i.support&&i.items.setItem(e,t)}catch(e){console.warn("set localStorage failed",e)}},i.getItem=function(e){return i.support?i.items.getItem(e):null},i.setJSON=function(e,t){try{i.support&&i.items.setItem(e,JSON.stringify(t))}catch(e){console.warn("set localStorage failed",e)}},i.getJSON=function(e){return JSON.parse(i.support?i.items.getItem(e):null)},i.removeItem=function(e){i.support&&i.items.removeItem(e)},i.clear=function(){i.support&&i.items.clear()},i.items=null,i.support=!1,F=i},U);function U(){}f(G,"laya.net.ResourceVersion"),G.enable=function(e,t,i){void 0===i&&(i=2),laya.net.ResourceVersion.type=i,x.loader.load(e,v.create(null,G.onManifestLoaded,[t]),null,"json"),W.customFormat=G.addVersionPrefix},G.onManifestLoaded=function(e,t){G.manifest=t,e.run(),t||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},G.addVersionPrefix=function(e){return G.manifest&&G.manifest[e]?2==G.type?G.manifest[e]:G.manifest[e]+"/"+e:e},G.FOLDER_VERSION=1,G.FILENAME_VERSION=2,G.manifest=null,G.type=1;function G(){}var z=function(){function e(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}f(e,"laya.net.TTFLoader");var t=e.prototype;return t.load=function(e){var t=(this._url=e).split(".ttf")[0].split("/");this.fontName=t[t.length-1],Q.window.conch?this._loadConch():Q.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},t._loadConch=function(){this._http=new Le,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},t._onHttpLoaded=function(e){Q.window.conch.setFontFaceFromBuffer(this.fontName,e),this._clearHttp(),this._complete()},t._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},t._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},t._complete=function(){x.timer.clear(this,this._complete),x.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},t._checkComplete=function(){L.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},t._loadWithFontFace=function(){var e=new Q.window.FontFace(this.fontName,"url('"+this._url+"')");Q.window.document.fonts.add(e);var t=this;e.loaded.then(function(){t._complete()}),e.load()},t._createDiv=function(){this._div=Q.createElement("div"),this._div.innerHTML="laya";var e=this._div.style;e.fontFamily=this.fontName,e.position="absolute",e.left="-100px",e.top="-100px",Q.document.body.appendChild(this._div)},t._loadWithCSS=function(){var e=this,t=Q.createElement("style");t.type="text/css",Q.document.body.appendChild(t),t.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=L.measureText("LayaTTFFont",this._fontTxt).width;var i=this;t.onload=function(){x.timer.once(1e4,i,e._complete)},x.timer.loop(20,this,this._checkComplete),this._createDiv()},e._testString="LayaTTFFont",e}(),W=function(){function n(e){this._url=null,this._path=null,this._url=n.formatURL(e),this._path=n.getPath(e)}f(n,"laya.net.URL");var e=n.prototype;return c(0,e,"path",function(){return this._path}),c(0,e,"url",function(){return this._url}),n.formatURL=function(e,t){if(!e)return"null path";if(0<e.indexOf(":"))return e;null!=n.customFormat&&(e=n.customFormat(e,t));var i=e.charAt(0);if("."===i)return n.formatRelativePath((t||n.basePath)+e);if("~"===i)return n.rootPath+e.substring(1);if("d"===i){if(0===e.indexOf("data:image"))return e}else if("/"===i)return e;return(t||n.basePath)+e},n.formatRelativePath=function(e){for(var t=e.split("/"),i=0,n=t.length;i<n;i++)".."==t[i]&&(t.splice(i-1,2),i-=2);return t.join("/")},n.isAbsolute=function(e){return 0<e.indexOf(":")||"/"==e.charAt(0)},n.getPath=function(e){var t=e.lastIndexOf("/");return 0<t?e.substr(0,t+1):""},n.getFileName=function(e){var t=e.lastIndexOf("/");return 0<t?e.substr(t+1):e},n.version={},n.basePath="",n.rootPath="",n.customFormat=function(e){var t=n.version[e];return!X.isConchApp&&t&&(e+="?v="+t),e},n}(),X=function(){function a(e,t){this._timeId=0;var i=a._mainCanvas.source.style;i.position="absolute",i.top=i.left="0px",i.background="#000000",a._mainCanvas.source.id="layaCanvas";var n=laya.renders.Render.isWebGL;a._mainCanvas.source.width=e,a._mainCanvas.source.height=t,n&&a.WebGL.init(a._mainCanvas,e,t),Q.container.appendChild(a._mainCanvas.source),(a._context=new j(e,t,n?null:a._mainCanvas)).ctx.setIsMainContext(),Q.window.requestAnimationFrame(function e(t){x.stage._loop();Q.window.requestAnimationFrame(e)}),x.stage.on("visibilitychange",this,this._onVisibilitychange)}f(a,"laya.renders.Render");var e=a.prototype;return e._onVisibilitychange=function(){x.stage.isVisibility?0!=this._timeId&&Q.window.clearInterval(this._timeId):this._timeId=Q.window.setInterval(this._enterFrame,1e3)},e._enterFrame=function(e){x.stage._loop()},c(1,a,"context",function(){return a._context}),c(1,a,"canvas",function(){return a._mainCanvas.source}),a._context=null,a._mainCanvas=null,a.WebGL=null,a.isConchNode=!1,a.isConchApp=!1,a.isConchWebGL=!1,a.isWebGL=!1,a.is3DMode=!1,a.optimizeTextureMemory=function(e,t){return!0},a.__init$=function(){r.ConchRenderType=r.ConchRenderType||1,r.ConchRenderType|=r.conch?4:0,a.isConchNode=5==(5&r.ConchRenderType),a.isConchApp=4==(4&r.ConchRenderType),a.isConchWebGL=6==r.ConchRenderType},a}(),j=function(){function s(e,t,i){this.x=0,this.y=0,this._drawTexture=function(e,t,i){i[0].loaded&&this.ctx.drawTexture(i[0],i[1],i[2],i[3],i[4],e,t)},this._fillTexture=function(e,t,i){i[0].loaded&&this.ctx.fillTexture(i[0],i[1]+e,i[2]+t,i[3],i[4],i[5],i[6],i[7])},this._drawTextureWithTransform=function(e,t,i){i[0].loaded&&this.ctx.drawTextureWithTransform(i[0],i[1],i[2],i[3],i[4],i[5],e,t,i[6])},this._fillQuadrangle=function(e,t,i){this.ctx.fillQuadrangle(i[0],i[1],i[2],i[3],i[4])},this._drawRect=function(e,t,i){var n=this.ctx;null!=i[4]&&(n.fillStyle=i[4],n.fillRect(e+i[0],t+i[1],i[2],i[3],null)),null!=i[5]&&(n.strokeStyle=i[5],n.lineWidth=i[6],n.strokeRect(e+i[0],t+i[1],i[2],i[3],i[6]))},this._drawPie=function(e,t,i){var n=this.ctx;X.isWebGL&&n.setPathId(i[8]),n.beginPath(),X.isWebGL?(n.movePath(i[0]+e,i[1]+t),n.moveTo(0,0)):n.moveTo(e+i[0],t+i[1]),n.arc(e+i[0],t+i[1],i[2],i[3],i[4]),n.closePath(),this._fillAndStroke(i[5],i[6],i[7],!0)},this._clipRect=function(e,t,i){this.ctx.clipRect(e+i[0],t+i[1],i[2],i[3])},this._fillRect=function(e,t,i){this.ctx.fillRect(e+i[0],t+i[1],i[2],i[3],i[4])},this._drawCircle=function(e,t,i){var n=this.ctx;X.isWebGL&&n.setPathId(i[6]),pe.drawCall++,n.beginPath(),X.isWebGL&&n.movePath(i[0]+e,i[1]+t),n.arc(i[0]+e,i[1]+t,i[2],0,s.PI2),n.closePath(),this._fillAndStroke(i[3],i[4],i[5],!0)},this._fillCircle=function(e,t,i){pe.drawCall++;var n=this.ctx;n.beginPath(),n.fillStyle=i[3],n.arc(i[0]+e,i[1]+t,i[2],0,s.PI2),n.fill()},this._setShader=function(e,t,i){this.ctx.setShader(i[0])},this._drawLine=function(e,t,i){var n=this.ctx;X.isWebGL&&n.setPathId(i[6]),n.beginPath(),n.strokeStyle=i[4],n.lineWidth=i[5],X.isWebGL?(n.movePath(e,t),n.moveTo(i[0],i[1]),n.lineTo(i[2],i[3])):(n.moveTo(e+i[0],t+i[1]),n.lineTo(e+i[2],t+i[3])),n.stroke()},this._drawLines=function(e,t,i){var n=this.ctx;X.isWebGL&&n.setPathId(i[5]),n.beginPath(),e+=i[0],t+=i[1],X.isWebGL&&n.movePath(e,t),n.strokeStyle=i[3],n.lineWidth=i[4];var a=i[2],r=2,s=a.length;if(X.isWebGL)for(n.moveTo(a[0],a[1]);r<s;)n.lineTo(a[r++],a[r++]);else for(n.moveTo(e+a[0],t+a[1]);r<s;)n.lineTo(e+a[r++],t+a[r++]);n.stroke()},this._drawLinesWebGL=function(e,t,i){this.ctx.drawLines(e+this.x+i[0],t+this.y+i[1],i[2],i[3],i[4])},this._drawCurves=function(e,t,i){this.ctx.drawCurves(e,t,i)},this._draw=function(e,t,i){i[0].call(null,this,e,t)},this._transformByMatrix=function(e,t,i){this.ctx.transformByMatrix(i[0])},this._setTransform=function(e,t,i){this.ctx.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])},this._setTransformByMatrix=function(e,t,i){this.ctx.setTransformByMatrix(i[0])},this._save=function(e,t,i){this.ctx.save()},this._restore=function(e,t,i){this.ctx.restore()},this._translate=function(e,t,i){this.ctx.translate(i[0],i[1])},this._transform=function(e,t,i){this.ctx.translate(i[1]+e,i[2]+t);var n=i[0];this.ctx.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),this.ctx.translate(-e-i[1],-t-i[2])},this._rotate=function(e,t,i){this.ctx.translate(i[1]+e,i[2]+t),this.ctx.rotate(i[0]),this.ctx.translate(-e-i[1],-t-i[2])},this._scale=function(e,t,i){this.ctx.translate(i[2]+e,i[3]+t),this.ctx.scale(i[0],i[1]),this.ctx.translate(-e-i[2],-t-i[3])},this._alpha=function(e,t,i){this.ctx.globalAlpha*=i[0]},this._setAlpha=function(e,t,i){this.ctx.globalAlpha=i[0]},this._fillText=function(e,t,i){this.ctx.fillText(i[0],i[1]+e,i[2]+t,i[3],i[4],i[5])},this._strokeText=function(e,t,i){this.ctx.strokeText(i[0],i[1]+e,i[2]+t,i[3],i[4],i[5],i[6])},this._fillBorderText=function(e,t,i){this.ctx.fillBorderText(i[0],i[1]+e,i[2]+t,i[3],i[4],i[5],i[6],i[7])},this._blendMode=function(e,t,i){this.ctx.globalCompositeOperation=i[0]},this._beginClip=function(e,t,i){this.ctx.beginClip&&this.ctx.beginClip(e+i[0],t+i[1],i[2],i[3])},this._setIBVB=function(e,t,i){this.ctx.setIBVB(i[0]+e,i[1]+t,i[2],i[3],i[4],i[5],i[6],i[7])},this._fillTrangles=function(e,t,i){this.ctx.fillTrangles(i[0],i[1]+e,i[2]+t,i[3],i[4])},this._drawPath=function(e,t,i){var n=this.ctx;X.isWebGL&&n.setPathId(-1),n.beginPath(),e+=i[0],t+=i[1],X.isWebGL&&n.movePath(e,t);for(var a=i[2],r=0,s=a.length;r<s;r++){var o=a[r];switch(o[0]){case"moveTo":X.isWebGL?n.moveTo(o[1],o[2]):n.moveTo(e+o[1],t+o[2]);break;case"lineTo":X.isWebGL?n.lineTo(o[1],o[2]):n.lineTo(e+o[1],t+o[2]);break;case"arcTo":X.isWebGL?n.arcTo(o[1],o[2],o[3],o[4],o[5]):n.arcTo(e+o[1],t+o[2],e+o[3],t+o[4],o[5]);break;case"closePath":n.closePath()}}var l=i[3];null!=l&&(n.fillStyle=l.fillStyle,n.fill());var h=i[4];null!=h&&(n.strokeStyle=h.strokeStyle,n.lineWidth=h.lineWidth||1,n.lineJoin=h.lineJoin,n.lineCap=h.lineCap,n.miterLimit=h.miterLimit,n.stroke())},this.drawPoly=function(e,t,i){this.ctx.drawPoly(e+this.x+i[0],t+this.y+i[1],i[2],i[3],i[4],i[5],i[6])},this._drawPoly=function(e,t,i){var n=this.ctx,a=i[2],r=2,s=a.length;if(X.isWebGL)for(n.setPathId(i[6]),n.beginPath(),e+=i[0],t+=i[1],n.movePath(e,t),n.moveTo(a[0],a[1]);r<s;)n.lineTo(a[r++],a[r++]);else for(n.beginPath(),e+=i[0],t+=i[1],n.moveTo(e+a[0],t+a[1]);r<s;)n.lineTo(e+a[r++],t+a[r++]);n.closePath(),this._fillAndStroke(i[3],i[4],i[5],i[7])},this._drawSkin=function(e,t,i){var n=i[0];if(n){var a=this.ctx;n.render(a,e,t)}},this._drawParticle=function(e,t,i){this.ctx.drawParticle(e+this.x,t+this.y,i[0])},this._setFilters=function(e,t,i){this.ctx.setFilters(i)},i?this.ctx=i.getContext("2d"):(i=ze.create("3D"),this.ctx=L.createWebGLContext2D(i),i._setContext(this.ctx)),i.size(e,t),this.canvas=i}f(s,"laya.renders.RenderContext");var e=s.prototype;return e.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},e.drawTexture=function(e,t,i,n,a){e.loaded&&this.ctx.drawTexture(e,t,i,n,a,this.x,this.y)},e._drawTextures=function(e,t,i){i[0].loaded&&this.ctx.drawTextures(i[0],i[1],e+this.x,t+this.y)},e.drawTextureWithTransform=function(e,t,i,n,a,r,s){e.loaded&&this.ctx.drawTextureWithTransform(e,t,i,n,a,r,this.x,this.y,s)},e.fillQuadrangle=function(e,t,i,n,a){this.ctx.fillQuadrangle(e,t,i,n,a)},e.drawCanvas=function(e,t,i,n,a){this.ctx.drawCanvas(e,t+this.x,i+this.y,n,a)},e.drawRect=function(e,t,i,n,a,r){void 0===r&&(r=1);var s=this.ctx;s.strokeStyle=a,s.lineWidth=r,s.strokeRect(e+this.x,t+this.y,i,n,r)},e._fillAndStroke=function(e,t,i,n){void 0===n&&(n=!1);var a=this.ctx;null!=e&&(a.fillStyle=e,X.isWebGL?a.fill(n):a.fill()),null!=t&&0<i&&(a.strokeStyle=t,a.lineWidth=i,a.stroke())},e.clipRect=function(e,t,i,n){this.ctx.clipRect(e+this.x,t+this.y,i,n)},e.fillRect=function(e,t,i,n,a){this.ctx.fillRect(e+this.x,t+this.y,i,n,a)},e.drawCircle=function(e,t,i,n,a){void 0===a&&(a=1),pe.drawCall++;var r=this.ctx;r.beginPath(),r.strokeStyle=n,r.lineWidth=a,r.arc(e+this.x,t+this.y,i,0,s.PI2),r.stroke()},e.drawTriangles=function(e,t,i){if(X.isWebGL)this.ctx.drawTriangles(i[0],e+i[1],t+i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9]);else{var n=i[5],a=0,r=n.length,s=this.ctx;for(a=0;a<r;a+=3){var o=2*n[a],l=2*n[a+1],h=2*n[a+2];s.drawTriangle(i[0],i[3],i[4],o,l,h,i[6],!0)}}},e.fillCircle=function(e,t,i,n){pe.drawCall++;var a=this.ctx;a.beginPath(),a.fillStyle=n,a.arc(e+this.x,t+this.y,i,0,s.PI2),a.fill()},e.setShader=function(e){this.ctx.setShader(e)},e.drawLine=function(e,t,i,n,a,r){void 0===r&&(r=1);var s=this.ctx;s.beginPath(),s.strokeStyle=a,s.lineWidth=r,s.moveTo(this.x+e,this.y+t),s.lineTo(this.x+i,this.y+n),s.stroke()},e.clear=function(){this.ctx.clear()},e.transformByMatrix=function(e){this.ctx.transformByMatrix(e)},e.setTransform=function(e,t,i,n,a,r){this.ctx.setTransform(e,t,i,n,a,r)},e.setTransformByMatrix=function(e){this.ctx.setTransformByMatrix(e)},e.save=function(){this.ctx.save()},e.restore=function(){this.ctx.restore()},e.translate=function(e,t){this.ctx.translate(e,t)},e.transform=function(e,t,i,n,a,r){this.ctx.transform(e,t,i,n,a,r)},e.rotate=function(e){this.ctx.rotate(e)},e.scale=function(e,t){this.ctx.scale(e,t)},e.alpha=function(e){this.ctx.globalAlpha*=e},e.setAlpha=function(e){this.ctx.globalAlpha=e},e.fillWords=function(e,t,i,n,a,r){void 0===r&&(r=0),this.ctx.fillWords(e,t,i,n,a,r)},e.fillBorderWords=function(e,t,i,n,a,r,s){this.ctx.fillBorderWords(e,t,i,n,a,r,s)},e.fillText=function(e,t,i,n,a,r){this.ctx.fillText(e,t+this.x,i+this.y,n,a,r)},e.strokeText=function(e,t,i,n,a,r,s){this.ctx.strokeText(e,t+this.x,i+this.y,n,a,r,s)},e.blendMode=function(e){this.ctx.globalCompositeOperation=e},e.flush=function(){this.ctx.flush&&this.ctx.flush()},e.addRenderObject=function(e){this.ctx.addRenderObject(e)},e.beginClip=function(e,t,i,n){this.ctx.beginClip&&this.ctx.beginClip(e,t,i,n)},e.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},e.fillTrangles=function(e,t,i){this.ctx.fillTrangles(i[0],i[1],i[2],i[3],4<i.length?i[4]:null)},s.PI2=2*Math.PI,s}(),Y=function(){function s(e,t){switch(this._next=t||s.NORENDER,e){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=T._filter);case 69905:return void(this._fun=s._initRenderFun)}this.onCreate(e)}f(s,"laya.renders.RenderSprite");var e=s.prototype;return e.onCreate=function(e){},e._style=function(e,t,i,n){e._style.render(e,t,i,n);var a=this._next;a._fun.call(a,e,t,i,n)},e._no=function(e,t,i,n){},e._custom=function(e,t,i,n){e.customRender(t,i,n);var a=e._style._tf;this._next._fun.call(this._next,e,t,i-a.translateX,n-a.translateY)},e._clip=function(e,t,i,n){var a=this._next;if(a!=s.NORENDER){var r=e._style.scrollRect;t.ctx.save(),t.ctx.clipRect(i,n,r.width,r.height),a._fun.call(a,e,t,i-r.x,n-r.y),t.ctx.restore()}},e._blend=function(e,t,i,n){var a=e._style;a.blendMode&&(t.ctx.globalCompositeOperation=a.blendMode);var r=this._next;r._fun.call(r,e,t,i,n),t.ctx.globalCompositeOperation="source-over"},e._mask=function(e,t,i,n){var a=this._next;a._fun.call(a,e,t,i,n);var r=e.mask;r&&(t.ctx.globalCompositeOperation="destination-in",(0<r.numChildren||!r.graphics._isOnlyOne())&&(r.cacheAsBitmap=!0),r.render(t,i-e.pivotX,n-e.pivotY)),t.ctx.globalCompositeOperation="source-over"},e._graphics=function(e,t,i,n){var a=e._style._tf;e._graphics&&e._graphics._render(e,t,i-a.translateX,n-a.translateY);var r=this._next;r._fun.call(r,e,t,i,n)},e._image=function(e,t,i,n){var a=e._style;t.ctx.drawTexture2(i,n,a._tf.translateX,a._tf.translateY,e.transform,a.alpha,a.blendMode,e._graphics._one)},e._image2=function(e,t,i,n){var a=e._style._tf;t.ctx.drawTexture2(i,n,a.translateX,a.translateY,e.transform,1,null,e._graphics._one)},e._alpha=function(e,t,i,n){var a;if(.01<(a=e._style.alpha)||e._needRepaint()){var r=t.ctx.globalAlpha;t.ctx.globalAlpha*=a;var s=this._next;s._fun.call(s,e,t,i,n),t.ctx.globalAlpha=r}},e._transform=function(e,t,i,n){var a=e.transform,r=this._next;a&&r!=s.NORENDER?(t.save(),t.transform(a.a,a.b,a.c,a.d,a.tx+i,a.ty+n),r._fun.call(r,e,t,0,0),t.restore()):r._fun.call(r,e,t,i,n)},e._childs=function(e,t,i,n){var a=e._style,r=a._tf;if(i=i-r.translateX+a.paddingLeft,n=n-r.translateY+a.paddingTop,a._calculation){var s=e._getWords();if(s){var o=a;o&&(o.stroke?t.fillBorderWords(s,i,n,o.font,o.color,o.strokeColor,o.stroke):t.fillWords(s,i,n,o.font,o.color,"none"!=o.textDecoration&&o.underLine?1:0))}}var l,h=e._childs,c=h.length;if(e.viewport||e.optimizeScrollRect&&e._style.scrollRect){var u=e.viewport||e._style.scrollRect,d=u.x,_=u.y,p=u.right,f=u.bottom,m=NaN,g=NaN;for(v=0;v<c;++v)(l=h[v]).visible&&(m=l._x)<p&&m+l.width>d&&(g=l._y)<f&&g+l.height>_&&l.render(t,i,n)}else for(var v=0;v<c;++v)(l=h[v])._style.visible&&l.render(t,i,n)},e._canvas=function(e,t,i,n){var a=e._$P.cacheCanvas;if(a){"bitmap"===a.type?pe.canvasBitmap++:pe.canvasNormal++;var r=a.ctx;if(e._needRepaint()||!r)this._canvas_repaint(e,t,i,n);else{var s=a._cacheRec;t.drawCanvas(r.canvas,i+s.x,n+s.y,s.width,s.height)}}else this._next._fun.call(this._next,e,t,i,n)},e._canvas_repaint=function(e,t,i,n){var a=e._$P.cacheCanvas,r=this._next;if(a){var s,o,l,h,c=a.ctx,u=e._needRepaint()||!c,d=a.type;if("bitmap"===d?pe.canvasBitmap++:pe.canvasNormal++,u){var _,p;a._cacheRec||(a._cacheRec=new k),X.isWebGL&&"bitmap"!==d?a._cacheRec.setTo(-e.pivotX,-e.pivotY,1,1):((h=e.getSelfBounds()).x=h.x-e.pivotX,h.y=h.y-e.pivotY,h.x=h.x-16,h.y=h.y-16,h.width=h.width+32,h.height=h.height+32,h.x=Math.floor(h.x+i)-i,h.y=Math.floor(h.y+n)-n,h.width=Math.floor(h.width),h.height=Math.floor(h.height),a._cacheRec.copyFrom(h)),h=a._cacheRec;var f,m=X.isWebGL?1:Q.pixelRatio*x.stage.clientScaleX,g=X.isWebGL?1:Q.pixelRatio*x.stage.clientScaleY;if(!X.isWebGL){var v,y=1,C=1;for(v=e;v&&v!=x.stage;)y*=v.scaleX,C*=v.scaleY,v=v.parent;X.isWebGL?(y<1&&(m*=y),C<1&&(g*=C)):(1<y&&(m*=y),1<C&&(g*=C))}if(e.scrollRect){var E=e.scrollRect;h.x-=E.x,h.y-=E.y}if(_=h.width*m,p=h.height*g,o=h.x,l=h.y,X.isWebGL&&"bitmap"===d&&(2048<_||2048<p))return console.warn("cache bitmap size larger than 2048,cache ignored"),a.ctx&&(de.recover("RenderContext",a.ctx),a.ctx.canvas.size(0,0),a.ctx=null),void r._fun.call(r,e,t,i,n);if((c=c||(a.ctx=de.getItem("RenderContext")||new j(_,p,ze.create("AUTO")))).ctx.sprite=e,(s=c.canvas).clear(),s.width==_&&s.height==p||s.size(_,p),"bitmap"===d?s.context.asBitmap=!0:"normal"===d&&(s.context.asBitmap=!1),1!=m||1!=g){var S=c.ctx;S.save(),S.scale(m,g),!X.isConchWebGL&&X.isConchApp&&(f=e._$P.cf)&&S.setFilterMatrix&&S.setFilterMatrix(f._mat,f._alpha),r._fun.call(r,e,c,-o,-l),S.restore(),X.isConchApp&&!X.isConchWebGL||e._applyFilters()}else S=c.ctx,!X.isConchWebGL&&X.isConchApp&&(f=e._$P.cf)&&S.setFilterMatrix&&S.setFilterMatrix(f._mat,f._alpha),r._fun.call(r,e,c,-o,-l),X.isConchApp&&!X.isConchWebGL||e._applyFilters();e._$P.staticCache&&(a.reCache=!1),pe.canvasReCache++}else o=(h=a._cacheRec).x,l=h.y,s=c.canvas;t.drawCanvas(s,i+o,n+l,h.width,h.height)}else r._fun.call(r,e,c,i,n)},s.__init__=function(){var e,t,i=0;for(t=L.createRenderSprite(69905,null),e=s.renders.length=4096,i=0;i<e;i++)s.renders[i]=t;s.renders[0]=L.createRenderSprite(0,null),function(e,t){for(var i=0,n=0;n<e.length;n++)i|=e[n],s.renders[i]=t}([1,512,4,2],new s(1,null)),s.renders[513]=L.createRenderSprite(513,null),s.renders[517]=new s(517,null)},s._initRenderFun=function(e,t,i,n){var a=e._renderType;(s.renders[a]=s._getTypeRender(a))._fun(e,t,i,n)},s._getTypeRender=function(e){for(var t=null,i=2048;1<i;)i&e&&(t=L.createRenderSprite(i,t)),i>>=1;return t},s.IMAGE=1,s.ALPHA=2,s.TRANSFORM=4,s.BLEND=8,s.CANVAS=16,s.FILTERS=32,s.MASK=64,s.CLIP=128,s.STYLE=256,s.GRAPHICS=512,s.CUSTOM=1024,s.CHILDS=2048,s.INIT=69905,s.renders=[],s.NORENDER=new s(0,null),s}(),K=function(){function o(){this._repaint=!1}f(o,"laya.resource.Context");var e=o.prototype;return e.replaceReset=function(){var e,t,i=0;for(e=o.replaceKeys.length,i=0;i<e;i++)t=o.replaceKeys[i],this[o.newKeys[i]]=this[t]},e.replaceResotre=function(){this.__restore(),this.__reset()},e.setIsMainContext=function(){},e.drawTextures=function(e,t,i,n){pe.drawCall+=t.length/2;for(var a=e.width,r=e.height,s=0,o=t.length;s<o;s+=2)this.drawTexture(e,t[s],t[s+1],a,r,i,n)},e.drawCanvas=function(e,t,i,n,a){pe.drawCall++,this.drawImage(e.source,t,i,n,a)},e.fillRect=function(e,t,i,n,a){pe.drawCall++,a&&(this.fillStyle=a),this.__fillRect(e,t,i,n)},e.fillText=function(e,t,i,n,a,r){pe.drawCall++,3<arguments.length&&null!=n&&(this.font=n,this.fillStyle=a,this.textAlign=r,this.textBaseline="top"),this.__fillText(e,t,i)},e.fillBorderText=function(e,t,i,n,a,r,s,o){pe.drawCall++,this.font=n,this.fillStyle=a,this.textBaseline="top",this.strokeStyle=r,this.lineWidth=s,this.textAlign=o,this.__strokeText(e,t,i),this.__fillText(e,t,i)},e.strokeText=function(e,t,i,n,a,r,s){pe.drawCall++,3<arguments.length&&null!=n&&(this.font=n,this.strokeStyle=a,this.lineWidth=r,this.textAlign=s,this.textBaseline="top"),this.__strokeText(e,t,i)},e.transformByMatrix=function(e){this.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)},e.setTransformByMatrix=function(e){this.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty)},e.clipRect=function(e,t,i,n){pe.drawCall++,this.beginPath(),this.rect(e,t,i,n),this.clip()},e.drawTexture=function(e,t,i,n,a,r,s){pe.drawCall++;var o=e.uv,l=e.bitmap.width,h=e.bitmap.height;this.drawImage(e.source,o[0]*l,o[1]*h,(o[2]-o[0])*l,(o[5]-o[3])*h,t+r,i+s,n,a)},e.drawTextureWithTransform=function(e,t,i,n,a,r,s,o,l){pe.drawCall++;var h=e.uv,c=e.bitmap.width,u=e.bitmap.height;this.save(),1!=l&&(this.globalAlpha*=l),r?(this.transform(r.a,r.b,r.c,r.d,r.tx+s,r.ty+o),this.drawImage(e.source,h[0]*c,h[1]*u,(h[2]-h[0])*c,(h[5]-h[3])*u,t,i,n,a)):this.drawImage(e.source,h[0]*c,h[1]*u,(h[2]-h[0])*c,(h[5]-h[3])*u,t+s,i+o,n,a),this.restore()},e.drawTexture2=function(e,t,i,n,a,r,s,o){var l=o[0];if(l.loaded&&l.bitmap&&l.source){pe.drawCall++;var h=1!==r;if(h){var c=this.globalAlpha;this.globalAlpha*=r}var u=l.uv,d=l.bitmap.width,_=l.bitmap.height;a?(this.save(),this.transform(a.a,a.b,a.c,a.d,a.tx+e,a.ty+t),this.drawImage(l.source,u[0]*d,u[1]*_,(u[2]-u[0])*d,(u[5]-u[3])*_,o[1]-i,o[2]-n,o[3],o[4]),this.restore()):this.drawImage(l.source,u[0]*d,u[1]*_,(u[2]-u[0])*d,(u[5]-u[3])*_,o[1]-i+e,o[2]-n+t,o[3],o[4]),h&&(this.globalAlpha=c)}},e.fillTexture=function(e,t,i,n,a,r,s,o){if(!o.pat){if(e.uv!=Pe.DEF_UV){var l=new ze("2D");l.getContext("2d"),l.size(e.width,e.height),l.context.drawTexture(e,0,0,e.width,e.height,0,0),e=new Pe(l)}o.pat=this.createPattern(e.bitmap.source,r)}var h=t,c=i,u=0,d=0;s&&(h+=s.x%e.width,c+=s.y%e.height,u-=s.x%e.width,d-=s.y%e.height),this.translate(h,c),this.fillRect(u,d,n,a,o.pat),this.translate(-h,-c)},e.drawTriangle=function(e,t,i,n,a,r,s,o){var l=e.bitmap,h=l.source,c=e.width,u=e.height,d=l.width,_=l.height,p=i[n]*d,f=i[a]*d,m=i[r]*d,g=i[n+1]*_,v=i[a+1]*_,y=i[r+1]*_,C=t[n],E=t[a],S=t[r],x=t[n+1],T=t[a+1],w=t[r+1];if(o){var M=(C+E+S)/3,b=(x+T+w)/3,R=C-M,L=x-b,A=Math.sqrt(R*R+L*L);C=M+R/A*(A+1),x=b+L/A*(A+1),L=T-b,E=M+(R=E-M)/(A=Math.sqrt(R*R+L*L))*(A+1),T=b+L/A*(A+1),L=w-b,S=M+(R=S-M)/(A=Math.sqrt(R*R+L*L))*(A+1),w=b+L/A*(A+1)}this.save(),s&&this.transform(s.a,s.b,s.c,s.d,s.tx,s.ty),this.beginPath(),this.moveTo(C,x),this.lineTo(E,T),this.lineTo(S,w),this.closePath(),this.clip();var I=1/(p*v+g*m+f*y-v*m-g*f-p*y),D=C*v+g*S+E*y-v*S-g*E-C*y,P=p*E+C*m+f*S-E*m-C*f-p*S,N=p*v*S+g*E*m+C*f*y-C*v*m-g*f*S-p*E*y,O=x*v+g*w+T*y-v*w-g*T-x*y,k=p*T+x*m+f*w-T*m-x*f-p*w,V=p*v*w+g*T*m+x*f*y-x*v*m-g*f*w-p*T*y;this.transform(D*I,O*I,P*I,k*I,N*I,V*I),this.drawImage(h,e.uv[0]*d,e.uv[1]*_,c,u,e.uv[0]*d,e.uv[1]*_,c,u),this.restore()},e.flush=function(){return 0},e.fillWords=function(e,t,i,n,a,r){n&&(this.font=n),a&&(this.fillStyle=a);this.textBaseline="top",this.textAlign="left";for(var s=0,o=e.length;s<o;s++){var l=e[s];if(this.__fillText(l.char,l.x+t,l.y+i),1===r){var h=l.height,c=.5*l.style.letterSpacing;c=c||0,this.beginPath(),this.strokeStyle=a,this.lineWidth=1,this.moveTo(t+l.x-c+.5,i+l.y+h+.5),this.lineTo(t+l.x+l.width+c+.5,i+l.y+h+.5),this.stroke()}}},e.fillBorderWords=function(e,t,i,n,a,r,s){n&&(this.font=n),a&&(this.fillStyle=a),this.textBaseline="top",this.lineWidth=s,this.textAlign="left",this.strokeStyle=r;for(var o=0,l=e.length;o<l;o++){var h=e[o];this.__strokeText(h.char,h.x+t,h.y+i),this.__fillText(h.char,h.x+t,h.y+i)}},e.destroy=function(){this.canvas.width=this.canvas.height=0},e.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},e.drawCurves=function(e,t,i){this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var n=i[2];e+=i[0],t+=i[1],this.moveTo(e+n[0],t+n[1]);for(var a=2,r=n.length;a<r;)this.quadraticCurveTo(e+n[a++],t+n[a++],e+n[a++],t+n[a++]);this.stroke()},o.__init__=function(t){var i=laya.resource.Context.prototype;if(!(t=t||CanvasRenderingContext2D.prototype).inited){t.inited=!0,t.__fillText=t.fillText,t.__fillRect=t.fillRect,t.__strokeText=t.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(e){t[e]=i[e]})}},o.replaceCanvasGetSet=function(e,t){var i=Object.getOwnPropertyDescriptor(e,t);if(!i||!i.configurable)return!1;var n,a={};for(n in i)"set"!=n&&(a[n]=i[n]);var r=i.set;return a.set=function(e){r.call(this,e);var t=this.getContext("2d");t&&"__reset"in t&&t.__reset()},Object.defineProperty(e,t,a),!0},o.replaceGetSet=function(e,t){var i=Object.getOwnPropertyDescriptor(e,t);if(!i||!i.configurable)return!1;var n,a={};for(n in i)"set"!=n&&(a[n]=i[n]);var r=i.set,s="___"+t+"__";return o.newKeys.push(s),a.set=function(e){e!=this[s]&&(this[s]=e,r.call(this,e))},Object.defineProperty(e,t,a),!0},o._default=new o,o.newKeys=[],l(o,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),o}(),q=function(){function r(e){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++r._uniqueIDCounter,this._name=e||"Content Manager",r._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,r._resourceManagers.push(this),this._resources=[]}f(r,"laya.resource.ResourceManager");var e=r.prototype;return x.imps(e,{"laya.resource.IDispose":!0}),e.getResourceByIndex=function(e){return this._resources[e]},e.getResourcesLength=function(){return this._resources.length},e.addResource=function(e){return e.resourceManager&&e.resourceManager.removeResource(e),-1===this._resources.indexOf(e)&&((e._resourceManager=this)._resources.push(e),this.addSize(e.memorySize),!0)},e.removeResource=function(e){var t=this._resources.indexOf(e);return-1!==t&&(this._resources.splice(t,1),e._resourceManager=null,this._memorySize-=e.memorySize,!0)},e.unload=function(){for(var e=this._resources.slice(0,this._resources.length),t=0;t<e.length;t++){e[t].destroy()}e.length=0},e.dispose=function(){if(this===r._systemResourceManager)throw new Error("systemResourceManager不能被释放！");r._resourceManagers.splice(r._resourceManagers.indexOf(this),1),r._isResourceManagersSorted=!1;for(var e=this._resources.slice(0,this._resources.length),t=0;t<e.length;t++){var i=e[t];i.resourceManager.removeResource(i),i.destroy()}e.length=0},e.addSize=function(e){e&&(this.autoRelease&&0<e&&this._memorySize+e>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=e)},e.garbageCollection=function(e){var t=this._resources;(t=t.slice()).sort(function(e,t){if(!e||!t)throw new Error("a或b不能为空！");return e.released&&t.released?0:e.released?1:t.released?-1:e._lastUseFrameCount-t._lastUseFrameCount});for(var i=pe.loopCount,n=0,a=t.length;n<a;n++){var r=t[n];if(!(1<i-r._lastUseFrameCount))return void(this._memorySize>=e&&(this._isOverflow=!0));if(r.releaseResource(),this._memorySize<e)return void(this._isOverflow=!1)}},c(0,e,"id",function(){return this._id}),c(0,e,"name",function(){return this._name},function(e){!e&&""===e||this._name===e||(this._name=e,r._isResourceManagersSorted=!1)}),c(0,e,"memorySize",function(){return this._memorySize}),c(1,r,"systemResourceManager",function(){return r._systemResourceManager}),r.__init__=function(){r.currentResourceManager=r.systemResourceManager},r.getLoadedResourceManagerByIndex=function(e){return r._resourceManagers[e]},r.getLoadedResourceManagersCount=function(){return r._resourceManagers.length},r.recreateContentManagers=function(e){void 0===e&&(e=!1);for(var t=r.currentResourceManager,i=0;i<r._resourceManagers.length;i++){r.currentResourceManager=r._resourceManagers[i];for(var n=0;n<r.currentResourceManager._resources.length;n++)r.currentResourceManager._resources[n].releaseResource(e),r.currentResourceManager._resources[n].activeResource(e)}r.currentResourceManager=t},r.releaseContentManagers=function(e){void 0===e&&(e=!1);for(var t=r.currentResourceManager,i=0;i<r._resourceManagers.length;i++){r.currentResourceManager=r._resourceManagers[i];for(var n=0;n<r.currentResourceManager._resources.length;n++){var a=r.currentResourceManager._resources[n];a.released||a.releaseResource(e)}}r.currentResourceManager=t},r._uniqueIDCounter=0,r._isResourceManagersSorted=!1,r._resourceManagers=[],l(r,["_systemResourceManager",function(){return this._systemResourceManager=new r("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=r._systemResourceManager}]),r}();f(Z,"laya.system.System"),Z.changeDefinition=function(e,t){x[e]=t;var i=e+"=classObj";x._runScript(i)},Z.__init__=function(){X.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())};function Z(){}var Q=(f($,"laya.utils.Browser"),c(1,$,"pixelRatio",function(){return $.__init__(),-1<$.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:L.getPixelRatio()}),c(1,$,"height",function(){return $.__init__(),(x.stage&&x.stage.canvasRotation?$.clientWidth:$.clientHeight)*$.pixelRatio}),c(1,$,"clientWidth",function(){return $.__init__(),$.window.innerWidth||$.document.body.clientWidth}),c(1,$,"window",function(){return $.__init__(),$._window}),c(1,$,"clientHeight",function(){return $.__init__(),$.window.innerHeight||$.document.body.clientHeight||$.document.documentElement.clientHeight}),c(1,$,"width",function(){return $.__init__(),(x.stage&&x.stage.canvasRotation?$.clientHeight:$.clientWidth)*$.pixelRatio}),c(1,$,"container",function(){return $.__init__(),$._container||(($._container=$.createElement("div")).id="layaContainer",$.document.body.appendChild($._container)),$._container},function(e){$._container=e}),c(1,$,"document",function(){return $.__init__(),$._document}),$.__init__=function(){if(!$._window){$._window=L.getWindow(),$._document=$.window.document,$._window.addEventListener("message",function(e){laya.utils.Browser._onMessage(e)},!1),$.document.__createElement=$.document.createElement,r.requestAnimationFrame=r.requestAnimationFrame||r.webkitRequestAnimationFrame||r.mozRequestAnimationFrame||r.oRequestAnimationFrame||r.msRequestAnimationFrame||function(e){return r.setTimeout(e,1e3/60)};var e=r.document.body.style;e["-webkit-user-select"]="none",e["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",$.userAgent=$.window.navigator.userAgent,$.onIOS=!!($.u=$.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),$.onMobile=-1<$.u.indexOf("Mobile"),$.onIPhone=-1<$.u.indexOf("iPhone"),$.onMac=-1<$.u.indexOf("Mac OS X"),$.onIPad=-1<$.u.indexOf("iPad"),$.onAndroid=-1<$.u.indexOf("Android")||-1<$.u.indexOf("Adr"),$.onWP=-1<$.u.indexOf("Windows Phone"),$.onQQBrowser=-1<$.u.indexOf("QQBrowser"),$.onMQQBrowser=-1<$.u.indexOf("MQQBrowser")||-1<$.u.indexOf("Mobile")&&-1<$.u.indexOf("QQ"),$.onIE=!!$.window.ActiveXObject||"ActiveXObject"in $.window,$.onWeiXin=-1<$.u.indexOf("MicroMessenger"),$.onPC=!$.onMobile,$.onSafari=-1<$.u.indexOf("Safari"),$.onFirefox=-1<$.u.indexOf("Firefox"),$.onEdge=-1<$.u.indexOf("Edge"),$.onMiniGame=-1<$.u.indexOf("MiniGame"),$.onLimixiu=-1<$.u.indexOf("limixiu"),$.httpProtocol="http:"==$.window.location.protocol,$.onMiniGame&&null==$.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),$.webAudioEnabled=!!($.window.AudioContext||$.window.webkitAudioContext||$.window.mozAudioContext),$.soundType=$.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",be=$.webAudioEnabled?Re:we,$.webAudioEnabled&&Re.initWebAudio(),we._initMusicAudio(),$.enableTouch="ontouchstart"in r||r.DocumentTouch&&t instanceof DocumentTouch,r.focus(),V._soundClass=be,V._musicClass=we,X._mainCanvas=X._mainCanvas||ze.create("2D"),$.canvas||($.canvas=ze.create("2D"),$.context=$.canvas.getContext("2d"))}},$._onMessage=function(e){if(e.data&&"size"==e.data.name){if($.window.innerWidth=e.data.width,$.window.innerHeight=e.data.height,$.window.__innerHeight=e.data.clientHeight,!$.document.createEvent)return void console.warn("no document.createEvent");var t=$.document.createEvent("HTMLEvents");return t.initEvent("resize",!1,!1),void $.window.dispatchEvent(t)}},$.createElement=function(e){return $.__init__(),$.document.__createElement(e)},$.getElementById=function(e){return $.__init__(),$.document.getElementById(e)},$.removeElement=function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},$.now=function(){return L.now()},$._window=null,$._document=null,$._container=null,$.userAgent=null,$.u=null,$.onIOS=!1,$.onMac=!1,$.onMobile=!1,$.onIPhone=!1,$.onIPad=!1,$.onAndroid=!1,$.onWP=!1,$.onQQBrowser=!1,$.onMQQBrowser=!1,$.onSafari=!1,$.onFirefox=!1,$.onEdge=!1,$.onIE=!1,$.onWeiXin=!1,$.onMiniGame=!1,$.onLimixiu=!1,$.onPC=!1,$.httpProtocol=!1,$.webAudioEnabled=!1,$.soundType=null,$.enableTouch=!1,$.canvas=null,$.context=null,$.__init$=function(){},$);function $(){}var J=function(){function t(e){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,e?(this._u8d_=new Uint8Array(e),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}f(t,"laya.utils.Byte");var e=t.prototype;return e.___resizeBuffer=function(t){try{var e=new Uint8Array(t);null!=this._u8d_&&(this._u8d_.length<=t?e.set(this._u8d_):e.set(this._u8d_.subarray(0,t))),this._u8d_=e,this._d_=new DataView(e.buffer)}catch(e){throw"___resizeBuffer err:"+t}},e.getString=function(){return this.rUTF(this.getUint16())},e.getFloat32Array=function(e,t){var i=e+t;i=i>this._length?this._length:i;var n=new Float32Array(this._d_.buffer.slice(e,i));return this._pos_=i,n},e.getUint8Array=function(e,t){var i=e+t;i=i>this._length?this._length:i;var n=new Uint8Array(this._d_.buffer.slice(e,i));return this._pos_=i,n},e.getInt16Array=function(e,t){var i=e+t;i=i>this._length?this._length:i;var n=new Int16Array(this._d_.buffer.slice(e,i));return this._pos_=i,n},e.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var e=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,e},e.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var e=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,e},e.writeFloat32=function(e){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,e,this._xd_),this._pos_+=4},e.writeFloat64=function(e){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,e,this._xd_),this._pos_+=8},e.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var e=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,e},e.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var e=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,e},e.writeInt32=function(e){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,e,this._xd_),this._pos_+=4},e.writeUint32=function(e){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,e,this._xd_),this._pos_+=4},e.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var e=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,e},e.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var e=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,e},e.writeUint16=function(e){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,e,this._xd_),this._pos_+=2},e.writeInt16=function(e){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,e,this._xd_),this._pos_+=2},e.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},e.writeUint8=function(e){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,e),this._pos_++},e._getUInt8=function(e){return this._d_.getUint8(e)},e._getUint16=function(e){return this._d_.getUint16(e,this._xd_)},e._getMatrix=function(){return new N(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},e.rUTF=function(e){for(var t="",i=this._pos_+e,n=0,a=String.fromCharCode,r=this._u8d_;this._pos_<i;)(n=r[this._pos_++])<128?0!=n&&(t+=a(n)):t+=a(n<224?(63&n)<<6|127&r[this._pos_++]:n<240?(31&n)<<12|(127&r[this._pos_++])<<6|127&r[this._pos_++]:(15&n)<<18|(127&r[this._pos_++])<<12|r[this._pos_++]<<6&127|127&r[this._pos_++]),0;return t},e.getCustomString=function(e){for(var t="",i=0,n=0,a=String.fromCharCode,r=this._u8d_;0<e;)if((n=r[this._pos_])<128)t+=a(n),this._pos_++,e--;else for(i=n-128,this._pos_++,e-=i;0<i;)n=r[this._pos_++],t+=a(r[this._pos_++]<<8|n),i--;return t},e.clear=function(){this._pos_=0,this.length=0},e.__getBuffer=function(){return this._d_.buffer},e.writeUTFBytes=function(e){for(var t=0,i=(e+="").length;t<i;t++){var n=e.charCodeAt(t);n<=127?this.writeByte(n):n<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|n>>6,128|63&n],this._pos_),this._pos_+=2):n<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|n>>12,128|n>>6&63,128|63&n],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n],this._pos_),this._pos_+=4)}},e.writeUTFString=function(e){var t=this.pos;this.writeUint16(1),this.writeUTFBytes(e);var i=this.pos-t-2;if(65536<=i)throw"writeUTFString byte len more than 65536";this._d_.setUint16(t,i,this._xd_)},e.readUTFString=function(){return this.readUTFBytes(this.getUint16())},e.getUTFString=function(){return this.readUTFString()},e.readUTFBytes=function(e){if(void 0===e&&(e=-1),0==e)return"";var t=this.bytesAvailable;if(t<e)throw"readUTFBytes error - Out of bounds";return e=0<e?e:t,this.rUTF(e)},e.getUTFBytes=function(e){return void 0===e&&(e=-1),this.readUTFBytes(e)},e.writeByte=function(e){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,e),this._pos_+=1},e.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},e.getByte=function(){return this.readByte()},e.ensureWrite=function(e){this._length<e&&(this._length=e),this._allocated_<e&&(this.length=e)},e.writeArrayBuffer=function(e,t,i){if(void 0===t&&(t=0),void 0===i&&(i=0),t<0||i<0)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=e.byteLength-t),this.ensureWrite(this._pos_+i);var n=new Uint8Array(e);this._u8d_.set(n.subarray(t,t+i),this._pos_),this._pos_+=i},e.readArrayBuffer=function(e){var t;return t=this._u8d_.buffer.slice(this._pos_,this._pos_+e),this._pos_=this._pos_+e,t},c(0,e,"buffer",function(){var e=this._d_.buffer;return e.byteLength==this.length?e:e.slice(0,this.length)}),c(0,e,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(e){this._xd_="littleEndian"==e}),c(0,e,"length",function(){return this._length},function(e){this._allocated_<e?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(e,2*this._allocated_))):this._allocated_>e&&this.___resizeBuffer(this._allocated_=e),this._length=e}),c(0,e,"pos",function(){return this._pos_},function(e){this._pos_=e}),c(0,e,"bytesAvailable",function(){return this._length-this._pos_}),t.getSystemEndian=function(){if(!t._sysEndian){var e=new ArrayBuffer(2);new DataView(e).setInt16(0,256,!0),t._sysEndian=256===new Int16Array(e)[0]?"littleEndian":"bigEndian"}return t._sysEndian},t.BIG_ENDIAN="bigEndian",t.LITTLE_ENDIAN="littleEndian",t._sysEndian=null,t}(),ee=(f(te,"laya.utils.CacheManager"),te.regCacheByFunction=function(e,t){var i;te.unRegCacheByFunction(e,t),i={tryDispose:e,getCacheList:t},te._cacheList.push(i)},te.unRegCacheByFunction=function(e,t){var i,n=0;for(i=te._cacheList.length,n=0;n<i;n++)if(te._cacheList[n].tryDispose==e&&te._cacheList[n].getCacheList==t)return void te._cacheList.splice(n,1)},te.forceDispose=function(){var e=0,t=te._cacheList.length;for(e=0;e<t;e++)te._cacheList[e].tryDispose(!0)},te.beginCheck=function(e){void 0===e&&(e=15e3),x.timer.loop(e,null,te._checkLoop)},te.stopCheck=function(){x.timer.clear(null,te._checkLoop)},te._checkLoop=function(){var e=te._cacheList;if(!(e.length<1)){var t,i=Q.now(),n=0;for(t=n=e.length;0<n&&(e[te._index=++te._index%t].tryDispose(!1),!(Q.now()-i>te.loopTimeLimit));)n--}},te.loopTimeLimit=2,te._cacheList=[],te._index=0,te);function te(){}var ie=(f(ne,"laya.utils.ClassUtils"),ne.regClass=function(e,t){ne._classMap[e]=t},ne.getRegClass=function(e){return ne._classMap[e]},ne.getInstance=function(e){var t=ne.getClass(e);return t?new t:(console.warn("[error] Undefined class:",e),null)},ne.createByJson=function(e,t,i,n,a){"string"==typeof e&&(e=JSON.parse(e));var r=e.props;if(!t&&!(t=a?a.runWith(e):ne.getInstance(r.runtime||e.type)))return null;var s=e.child;if(s)for(var o=0,l=s.length;o<l;o++){var h=s[o];if("render"!==h.props.name&&"render"!==h.props.renderType||!t._$set_itemRender)if("Graphic"==h.type)ne.addGraphicsToSprite(h,t);else if(ne.isDrawType(h.type))ne.addGraphicToSprite(h,t,!0);else{var c=ne.createByJson(h,null,i,n,a);"Script"==h.type?c.hasOwnProperty("owner")?c.owner=t:c.hasOwnProperty("target")&&(c.target=t):"mask"==h.props.renderType?t.mask=c:t.addChild(c)}else t.itemRender=h}if(r)for(var u in r){var d=r[u];"var"===u&&i?i[d]=t:d instanceof Array&&"function"==typeof t[u]?t[u].apply(t,d):t[u]=d}return n&&e.customProps&&n.runWith([t,e]),t.created&&t.created(),t},ne.addGraphicsToSprite=function(e,t){var i;if((i=e.child)&&!(i.length<1)){var n;n=ne._getGraphicsFromSprite(e,t);var a=0,r=0;e.props&&(a=ne._getObjVar(e.props,"x",0),r=ne._getObjVar(e.props,"y",0)),0!=a&&0!=r&&n.translate(a,r);var s,o=0;for(s=i.length,o=0;o<s;o++)ne._addGraphicToGraphics(i[o],n);0!=a&&0!=r&&n.translate(-a,-r)}},ne.addGraphicToSprite=function(e,t,i){var n;void 0===i&&(i=!1),n=i?ne._getGraphicsFromSprite(e,t):t.graphics,ne._addGraphicToGraphics(e,n)},ne._getGraphicsFromSprite=function(e,t){var i,n;if(!e||!e.props)return t.graphics;switch(n=e.props.renderType){case"hit":case"unHit":var a;t.hitArea||(t.hitArea=new he),(a=t.hitArea)[n]||(a[n]=new d),i=a[n]}return i=i||t.graphics},ne._getTransformData=function(e){var t;(e.hasOwnProperty("pivotX")||e.hasOwnProperty("pivotY"))&&(t=t||new N).translate(-ne._getObjVar(e,"pivotX",0),-ne._getObjVar(e,"pivotY",0));var i=ne._getObjVar(e,"scaleX",1),n=ne._getObjVar(e,"scaleY",1),a=ne._getObjVar(e,"rotation",0);return ne._getObjVar(e,"skewX",0),ne._getObjVar(e,"skewY",0),1==i&&1==n&&0==a||((t=t||new N).scale(i,n),t.rotate(.0174532922222222*a)),t},ne._addGraphicToGraphics=function(e,t){var i,n;if((i=e.props)&&(n=ne.DrawTypeDic[e.type])){var a,r;a=t;var s=ne._getParams(i,n[1],n[2],n[3]);!(r=ne._tM)&&1==ne._alpha||(a.save(),r&&a.transform(r),1!=ne._alpha&&a.alpha(ne._alpha)),a[n[0]].apply(a,s),!r&&1==ne._alpha||a.restore()}},ne._adptLineData=function(e){return e[2]=parseFloat(e[0])+parseFloat(e[2]),e[3]=parseFloat(e[1])+parseFloat(e[3]),e},ne._adptTextureData=function(e){return e[0]=Ae.getRes(e[0]),e},ne._adptLinesData=function(e){return e[2]=ne._getPointListByStr(e[2]),e},ne.isDrawType=function(e){return"Image"!=e&&ne.DrawTypeDic.hasOwnProperty(e)},ne._getParams=function(e,t,i,n){var a;void 0===i&&(i=0),(a=ne._temParam).length=t.length;var r,s,o=0;for(r=t.length,o=0;o<r;o++)a[o]=ne._getObjVar(e,t[o][0],t[o][1]);return ne._alpha=ne._getObjVar(e,"alpha",1),s=ne._getTransformData(e),ne._tM=s?(i=i||0,s.translate(a[i],a[i+1]),a[i]=a[i+1]=0,s):null,n&&ne[n]&&(a=ne[n](a)),a},ne._getPointListByStr=function(e){var t,i,n=0;for(i=(t=e.split(",")).length,n=0;n<i;n++)t[n]=parseFloat(t[n]);return t},ne._getObjVar=function(e,t,i){return e.hasOwnProperty(t)?e[t]:i},ne._temParam=[],ne._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},ne.getClass=function(e){var t=ne._classMap[e]||e;return"string"==typeof t?x.__classmap[t]:t},ne._tM=null,ne._alpha=NaN,l(ne,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),ne);function ne(){}var ae=(f(re,"laya.utils.Color"),re._initDefault=function(){for(var e in re._DEFAULT={},re._COLOR_MAP)re._SAVE[e]=re._DEFAULT[e]=new re(re._COLOR_MAP[e]);return re._DEFAULT},re._initSaveMap=function(){for(var e in re._SAVE_SIZE=0,re._SAVE={},re._DEFAULT)re._SAVE[e]=re._DEFAULT[e]},re.create=function(e){var t=re._SAVE[e+""];return null!=t?t:(re._SAVE_SIZE<1e3||re._initSaveMap(),re._SAVE[e+""]=new re(e))},re._SAVE={},re._SAVE_SIZE=0,re._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},re._DEFAULT=re._initDefault(),re._COLODID=1,re);function re(e){if(this._color=[],"string"==typeof e){null===(this.strColor=e)&&(e="#000000"),"#"==e.charAt(0)&&(e=e.substr(1));var t=e.length;if(3==t||4==t){for(var i="",n=0;n<t;n++)i+=e[n]+e[n];e=i}var a=this.numColor=parseInt(e,16);if(8==e.length)return void(this._color=[parseInt(e.substr(0,2),16)/255,((16711680&a)>>16)/255,((65280&a)>>8)/255,(255&a)/255])}else a=this.numColor=e,this.strColor=ve.toHexColor(a);this._color=[((16711680&a)>>16)/255,((65280&a)>>8)/255,(255&a)/255,1],this._color.__id=++re._COLODID}!function(){function e(){this._values=[],this._keys=[]}f(e,"laya.utils.Dictionary");var t=e.prototype;t.set=function(e,t){var i=this.indexOf(e);0<=i?this._values[i]=t:(this._keys.push(e),this._values.push(t))},t.indexOf=function(e){var t=this._keys.indexOf(e);return 0<=t?t:(e="string"==typeof e?Number(e):"number"==typeof e?e.toString():e,this._keys.indexOf(e))},t.get=function(e){var t=this.indexOf(e);return t<0?null:this._values[t]},t.remove=function(e){var t=this.indexOf(e);return 0<=t&&(this._keys.splice(t,1),this._values.splice(t,1),!0)},t.clear=function(){this._values.length=0,this._keys.length=0},c(0,t,"values",function(){return this._values}),c(0,t,"keys",function(){return this._keys})}();var se=function(){function e(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}f(e,"laya.utils.Dragging");var t=e.prototype;return t.start=function(e,t,i,n,a,r,s,o){void 0===o&&(o=.92),this.clearTimer(),this.target=e,this.area=t,this.hasInertia=i,this.elasticDistance=t?n:0,this.elasticBackTime=a,this.data=r,this._disableMouseEvent=s,this.ratio=o,this._parent=e.parent,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,x.stage.on("mouseup",this,this.onStageMouseUp),x.stage.on("mouseout",this,this.onStageMouseUp),x.timer.frameLoop(1,this,this.loop)},t.clearTimer=function(){x.timer.clear(this,this.loop),x.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},t.stop=function(){this._dragging&&(E.instance.disableMouseEvent=!1,x.stage.off("mouseup",this,this.onStageMouseUp),x.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},t.loop=function(){var e=this._parent.getMousePoint(),t=e.x,i=e.y,n=t-this._lastX,a=i-this._lastY;if(this._clickOnly){if(!(1<Math.abs(n*x.stage._canvasTransform.getScaleX())||1<Math.abs(a*x.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),E.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(n,a);0==n&&0==a||(this._lastX=t,this._lastY=i,this.target.x+=n*this._elasticRateX,this.target.y+=a*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},t.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var e=this.area.x-this.target.x;else e=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-e/this.elasticDistance),this.target.y<this.area.y)var t=this.area.y-this.target.y;else t=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-t/this.elasticDistance)}},t.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},t.onStageMouseUp=function(e){if(E.instance.disableMouseEvent=!1,x.stage.off("mouseup",this,this.onStageMouseUp),x.stage.off("mouseout",this,this.onStageMouseUp),x.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var t=this._offsets.length,i=Math.min(t,6),n=this._offsets.length-i,a=t-1;n<a;a--)this._offsetY+=this._offsets[a--],this._offsetX+=this._offsets[a];this._offsetX=this._offsetX/i*2,this._offsetY=this._offsetY/i*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),x.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},t.checkElastic=function(){var e=NaN,t=NaN;if(this.target.x<this.area.x?e=this.area.x:this.target.x>this.area.x+this.area.width&&(e=this.area.x+this.area.width),this.target.y<this.area.y?t=this.area.y:this.target.y>this.area.y+this.area.height&&(t=this.area.y+this.area.height),isNaN(e)&&isNaN(t))this.clear();else{var i={};isNaN(e)||(i.x=e),isNaN(t)||(i.y=t),this._tween=ge.to(this.target,i,this.elasticBackTime,oe.sineOut,v.create(this,this.clear),0,!1,!1)}},t.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(x.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},t.clear=function(){if(this.target){this.clearTimer();var e=this.target;this.target=null,this._parent=null,e.event("dragend",this.data)}},e}(),oe=(f(le,"laya.utils.Ease"),le.linearNone=function(e,t,i,n){return i*e/n+t},le.linearIn=function(e,t,i,n){return i*e/n+t},le.linearInOut=function(e,t,i,n){return i*e/n+t},le.linearOut=function(e,t,i,n){return i*e/n+t},le.bounceIn=function(e,t,i,n){return i-le.bounceOut(n-e,0,i,n)+t},le.bounceInOut=function(e,t,i,n){return e<.5*n?.5*le.bounceIn(2*e,0,i,n)+t:.5*le.bounceOut(2*e-n,0,i,n)+.5*i+t},le.bounceOut=function(e,t,i,n){return(e/=n)<1/2.75?i*(7.5625*e*e)+t:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t},le.backIn=function(e,t,i,n,a){return void 0===a&&(a=1.70158),i*(e/=n)*e*((a+1)*e-a)+t},le.backInOut=function(e,t,i,n,a){return void 0===a&&(a=1.70158),(e/=.5*n)<1?.5*i*(e*e*((1+(a*=1.525))*e-a))+t:i/2*((e-=2)*e*((1+(a*=1.525))*e+a)+2)+t},le.backOut=function(e,t,i,n,a){return void 0===a&&(a=1.70158),i*((e=e/n-1)*e*((a+1)*e+a)+1)+t},le.elasticIn=function(e,t,i,n,a,r){var s;return void 0===a&&(a=0),void 0===r&&(r=0),0==e?t:1==(e/=n)?t+i:(r=r||.3*n,s=!a||0<i&&a<i||i<0&&a<-i?(a=i,r/4):r/le.PI2*Math.asin(i/a),-a*Math.pow(2,10*(e-=1))*Math.sin((e*n-s)*le.PI2/r)+t)},le.elasticInOut=function(e,t,i,n,a,r){var s;return void 0===a&&(a=0),void 0===r&&(r=0),0==e?t:2==(e/=.5*n)?t+i:(r=r||n*(.3*1.5),s=!a||0<i&&a<i||i<0&&a<-i?(a=i,r/4):r/le.PI2*Math.asin(i/a),e<1?a*Math.pow(2,10*(e-=1))*Math.sin((e*n-s)*le.PI2/r)*-.5+t:a*Math.pow(2,-10*(e-=1))*Math.sin((e*n-s)*le.PI2/r)*.5+i+t)},le.elasticOut=function(e,t,i,n,a,r){var s;return void 0===a&&(a=0),void 0===r&&(r=0),0==e?t:1==(e/=n)?t+i:(r=r||.3*n,s=!a||0<i&&a<i||i<0&&a<-i?(a=i,r/4):r/le.PI2*Math.asin(i/a),a*Math.pow(2,-10*e)*Math.sin((e*n-s)*le.PI2/r)+i+t)},le.strongIn=function(e,t,i,n){return i*(e/=n)*e*e*e*e+t},le.strongInOut=function(e,t,i,n){return(e/=.5*n)<1?.5*i*e*e*e*e*e+t:.5*i*((e-=2)*e*e*e*e+2)+t},le.strongOut=function(e,t,i,n){return i*((e=e/n-1)*e*e*e*e+1)+t},le.sineInOut=function(e,t,i,n){return.5*-i*(Math.cos(Math.PI*e/n)-1)+t},le.sineIn=function(e,t,i,n){return-i*Math.cos(e/n*le.HALF_PI)+i+t},le.sineOut=function(e,t,i,n){return i*Math.sin(e/n*le.HALF_PI)+t},le.quintIn=function(e,t,i,n){return i*(e/=n)*e*e*e*e+t},le.quintInOut=function(e,t,i,n){return(e/=.5*n)<1?.5*i*e*e*e*e*e+t:.5*i*((e-=2)*e*e*e*e+2)+t},le.quintOut=function(e,t,i,n){return i*((e=e/n-1)*e*e*e*e+1)+t},le.quartIn=function(e,t,i,n){return i*(e/=n)*e*e*e+t},le.quartInOut=function(e,t,i,n){return(e/=.5*n)<1?.5*i*e*e*e*e+t:.5*-i*((e-=2)*e*e*e-2)+t},le.quartOut=function(e,t,i,n){return-i*((e=e/n-1)*e*e*e-1)+t},le.cubicIn=function(e,t,i,n){return i*(e/=n)*e*e+t},le.cubicInOut=function(e,t,i,n){return(e/=.5*n)<1?.5*i*e*e*e+t:.5*i*((e-=2)*e*e+2)+t},le.cubicOut=function(e,t,i,n){return i*((e=e/n-1)*e*e+1)+t},le.quadIn=function(e,t,i,n){return i*(e/=n)*e+t},le.quadInOut=function(e,t,i,n){return(e/=.5*n)<1?.5*i*e*e+t:.5*-i*(--e*(e-2)-1)+t},le.quadOut=function(e,t,i,n){return-i*(e/=n)*(e-2)+t},le.expoIn=function(e,t,i,n){return 0==e?t:i*Math.pow(2,10*(e/n-1))+t-.001*i},le.expoInOut=function(e,t,i,n){return 0==e?t:e==n?t+i:(e/=.5*n)<1?.5*i*Math.pow(2,10*(e-1))+t:.5*i*(2-Math.pow(2,-10*--e))+t},le.expoOut=function(e,t,i,n){return e==n?t+i:i*(1-Math.pow(2,-10*e/n))+t},le.circIn=function(e,t,i,n){return-i*(Math.sqrt(1-(e/=n)*e)-1)+t},le.circInOut=function(e,t,i,n){return(e/=.5*n)<1?.5*-i*(Math.sqrt(1-e*e)-1)+t:.5*i*(Math.sqrt(1-(e-=2)*e)+1)+t},le.circOut=function(e,t,i,n){return i*Math.sqrt(1-(e=e/n-1)*e)+t},le.HALF_PI=.5*Math.PI,le.PI2=2*Math.PI,le);function le(){}var he=function(){function u(){this._hit=null,this._unHit=null}f(u,"laya.utils.HitArea");var e=u.prototype;return e.isHit=function(e,t){return!!u.isHitGraphic(e,t,this.hit)&&!u.isHitGraphic(e,t,this.unHit)},e.contains=function(e,t){return this.isHit(e,t)},c(0,e,"hit",function(){return this._hit||(this._hit=new d),this._hit},function(e){this._hit=e}),c(0,e,"unHit",function(){return this._unHit||(this._unHit=new d),this._unHit},function(e){this._unHit=e}),u.isHitGraphic=function(e,t,i){if(!i)return!1;var n;if(!(n=i.cmds)&&i._one&&((n=u._cmds).length=1,n[0]=i._one),!n)return!1;var a,r,s=0;for(a=n.length,s=0;s<a;s++)if(r=n[s]){var o=X._context;switch(r.callee){case o._translate:case 6:e-=r[0],t-=r[1]}if(u.isHitCmd(e,t,r))return!0}return!1},u.isHitCmd=function(e,t,i){if(!i)return!1;var n=X._context,a=!1;switch(i.callee){case n._drawRect:case 13:u._rec.setTo(i[0],i[1],i[2],i[3]),a=u._rec.contains(e,t);break;case n._drawCircle:case n._fillCircle:case 14:a=(e-=i[0])*e+(t-=i[1])*t<i[2]*i[2];break;case n._drawPoly:case 18:e-=i[0],t-=i[1],a=u.ptInPolygon(e,t,i[2])}return a},u.ptInPolygon=function(e,t,i){var n;(n=u._ptPoint).setTo(e,t);var a,r=0,s=NaN,o=NaN,l=NaN,h=NaN;a=i.length;for(var c=0;c<a;c+=2){if(s=i[c],o=i[c+1],l=i[(c+2)%a],o!=(h=i[(c+3)%a]))if(!(n.y<Math.min(o,h)))if(!(n.y>=Math.max(o,h)))(n.y-o)*(l-s)/(h-o)+s>n.x&&r++}return r%2==1},u._cmds=[],l(u,["_rec",function(){return this._rec=new k},"_ptPoint",function(){return this._ptPoint=new O}]),u}();(function(){function a(e,t,i,n){this.char=e,this.charNum=e.charCodeAt(0),this._x=this._y=0,this.width=t,this.height=i,this.style=n,this.isWord=!a._isWordRegExp.test(e)}f(a,"laya.utils.HTMLChar");var e=a.prototype;x.imps(e,{"laya.display.ILayout":!0}),e.setSprite=function(e){this._sprite=e},e.getSprite=function(){return this._sprite},e._isChar=function(){return!0},e._getCSSStyle=function(){return this.style},c(0,e,"width",function(){return this._w},function(e){this._w=e}),c(0,e,"x",function(){return this._x},function(e){this._sprite&&(this._sprite.x=e),this._x=e}),c(0,e,"y",function(){return this._y},function(e){this._sprite&&(this._sprite.y=e),this._y=e}),c(0,e,"height",function(){return this._h},function(e){this._h=e}),a._isWordRegExp=new RegExp("[\\w.]","")})(),f(ce,"laya.utils.Log"),ce.enable=function(){ce._logdiv||(ce._logdiv=Q.window.document.createElement("div"),Q.window.document.body.appendChild(ce._logdiv),ce._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},ce.toggle=function(){var e=ce._logdiv.style;"1px"==e.width?e.width=e.height="50%":e.width=e.height="1px"},ce.print=function(e){ce._logdiv&&(ce.maxCount<=ce._count&&ce.clear(),ce._count++,ce._logdiv.innerText+=e+"\n",ce._logdiv.scrollTop=ce._logdiv.scrollHeight)},ce.clear=function(){ce._logdiv.innerText="",ce._count=0},ce._logdiv=null,ce._count=0,ce.maxCount=20;function ce(){}f(ue,"laya.utils.Mouse"),c(1,ue,"cursor",function(){return ue._style.cursor},function(e){ue._style.cursor=e}),ue.hide=function(){"none"!=ue.cursor&&(ue._preCursor=ue.cursor,ue.cursor="none")},ue.show=function(){"none"==ue.cursor&&(ue.cursor=ue._preCursor?ue._preCursor:"auto")},ue._preCursor=null,l(ue,["_style",function(){return this._style=Q.document.body.style}]);function ue(){}var de=(f(_e,"laya.utils.Pool"),_e.getPoolBySign=function(e){return _e._poolDic[e]||(_e._poolDic[e]=[])},_e.clearBySign=function(e){_e._poolDic[e]&&(_e._poolDic[e].length=0)},_e.recover=function(e,t){t.__InPool||(t.__InPool=!0,_e.getPoolBySign(e).push(t))},_e.getItemByClass=function(e,t){var i=_e.getPoolBySign(e),n=i.length?i.pop():new t;return n.__InPool=!1,n},_e.getItemByCreateFun=function(e,t,i){var n=_e.getPoolBySign(e),a=n.length?n.pop():t.call(i);return a.__InPool=!1,a},_e.getItem=function(e){var t=_e.getPoolBySign(e),i=t.length?t.pop():null;return i&&(i.__InPool=!1),i},_e._poolDic={},_e.InPoolSign="__InPool",_e);function _e(){}!function(){function n(){this.sign=null,this.maxCount=1e3}f(n,"laya.utils.PoolCache");var e=n.prototype;e.getCacheList=function(){return de.getPoolBySign(this.sign)},e.tryDispose=function(e){var t;(t=de.getPoolBySign(this.sign)).length>this.maxCount&&t.splice(this.maxCount,t.length-this.maxCount)},n.addPoolCacheManager=function(e,t){var i;void 0===t&&(t=100),(i=new n).sign=e,i.maxCount=t,ee.regCacheByFunction(ve.bind(i.tryDispose,i),ve.bind(i.getCacheList,i))}}();var pe=(f(fe,"laya.utils.Stat"),c(1,fe,"onclick",null,function(e){fe._sp&&fe._sp.on("click",fe._sp,e),fe._canvas&&(fe._canvas.source.onclick=e,fe._canvas.source.style.pointerEvents="")}),fe.show=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),!X.isConchApp||X.isConchWebGL?(X.isConchWebGL||Q.onMiniGame||Q.onLimixiu||(fe._useCanvas=!0),fe._show=!0,fe._fpsData.length=60,fe._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},fe._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},fe._view[2]={title:"DrawCall",value:"drawCall",color:"white",units:"int"},fe._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},X.isWebGL?(fe._view[4]={title:"Shader",value:"shaderCall",color:"white",units:"int"},X.is3DMode?(fe._view[0].title="FPS(3D)",fe._view[5]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"},fe._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},fe._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"}):(fe._view[0].title="FPS(WebGL)",fe._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"})):fe._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"},fe._useCanvas?fe.createUIPre(e,t):fe.createUI(e,t),fe.enable()):Q.window.conch.showFPS&&Q.window.conch.showFPS(e,t)},fe.createUIPre=function(e,t){var i=Q.pixelRatio;fe._width=130*i,fe._vx=75*i,fe._height=i*(12*fe._view.length+3*i)+4,fe._fontSize=12*i;for(var n=0;n<fe._view.length;n++)fe._view[n].x=4,fe._view[n].y=n*fe._fontSize+2*i;fe._canvas||((fe._canvas=new ze("2D")).size(fe._width,fe._height),(fe._ctx=fe._canvas.getContext("2d")).textBaseline="top",fe._ctx.font=fe._fontSize+"px Sans-serif",fe._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+e+"px;top:"+t+"px;width:"+fe._width/i+"px;height:"+fe._height/i+"px;"),fe._first=!0,fe.loop(),fe._first=!1,Q.container.appendChild(fe._canvas.source)},fe.createUI=function(e,t){var i=fe._sp,n=Q.pixelRatio;i||(i=new Oe,(fe._leftText=new He).pos(5,5),fe._leftText.color="#ffffff",i.addChild(fe._leftText),(fe._txt=new He).pos(80*n,5),fe._txt.color="#ffffff",i.addChild(fe._txt),fe._sp=i),i.pos(e,t);for(var a="",r=0;r<fe._view.length;r++)a+=fe._view[r].title+"\n";fe._leftText.text=a;var s=138*n,o=n*(12*fe._view.length+3*n)+4;fe._txt.fontSize=fe._fontSize*n,fe._leftText.fontSize=fe._fontSize*n,i.size(s,o),i.graphics.clear(),i.graphics.setAlpha(.5),i.graphics.drawRect(0,0,s,o,"#999999"),i.graphics.setAlpha(1),fe.loop()},fe.enable=function(){x.timer.frameLoop(1,fe,fe.loop)},fe.hide=function(){fe._show=!1,x.timer.clear(fe,fe.loop),fe._canvas&&Q.removeElement(fe._canvas.source)},fe.clear=function(){fe.trianglesFaces=fe.drawCall=fe.shaderCall=fe.spriteCount=fe.spriteRenderUseCacheCount=fe.treeNodeCollision=fe.treeSpriteCollision=fe.canvasNormal=fe.canvasBitmap=fe.canvasReCache=0},fe.loop=function(){fe._count++;var e=Q.now();if(!(e-fe._timer<1e3)){var t=fe._count;if(fe.FPS=Math.round(1e3*t/(e-fe._timer)),fe._show){fe.trianglesFaces=Math.round(fe.trianglesFaces/t),fe.spriteCount=fe._useCanvas?(fe.drawCall=Math.round(fe.drawCall/t)-2,fe.shaderCall=Math.round(fe.shaderCall/t),Math.round(fe.spriteCount/t)-1):(fe.drawCall=Math.round(fe.drawCall/t)-2,fe.shaderCall=Math.round(fe.shaderCall/t)-4,Math.round(fe.spriteCount/t)-4),fe.spriteRenderUseCacheCount=Math.round(fe.spriteRenderUseCacheCount/t),fe.canvasNormal=Math.round(fe.canvasNormal/t),fe.canvasBitmap=Math.round(fe.canvasBitmap/t),fe.canvasReCache=Math.ceil(fe.canvasReCache/t),fe.treeNodeCollision=Math.round(fe.treeNodeCollision/t),fe.treeSpriteCollision=Math.round(fe.treeSpriteCollision/t);var i=0<fe.FPS?Math.floor(1e3/fe.FPS).toString():" ";fe._fpsStr=fe.FPS+(fe.renderSlow?" slow":"")+" "+i,fe._spriteStr=fe.spriteCount+(fe.spriteRenderUseCacheCount?"/"+fe.spriteRenderUseCacheCount:""),fe._canvasStr=fe.canvasReCache+"/"+fe.canvasNormal+"/"+fe.canvasBitmap,fe.currentMemorySize=q.systemResourceManager.memorySize,fe._useCanvas?fe.renderInfoPre():fe.renderInfo(),fe.clear()}fe._count=0,fe._timer=e}},fe.renderInfoPre=function(){if(fe._canvas){var e=fe._ctx;e.clearRect(fe._first?0:fe._vx,0,fe._width,fe._height);for(var t=0;t<fe._view.length;t++){var i=fe._view[t];fe._first&&(e.fillStyle="white",e.fillText(i.title,i.x,i.y,null,null,null)),e.fillStyle=i.color;var n=fe[i.value];"M"==i.units&&(n=Math.floor(n/1048576*100)/100+" M"),e.fillText(n+"",i.x+fe._vx,i.y,null,null,null)}}},fe.renderInfo=function(){for(var e="",t=0;t<fe._view.length;t++){var i=fe._view[t],n=fe[i.value];"M"==i.units&&(n=Math.floor(n/1048576*100)/100+" M"),"K"==i.units&&(n=Math.floor(n/1024*100)/100+" K"),e+=n+"\n"}fe._txt.text=e},fe.FPS=0,fe.loopCount=0,fe.shaderCall=0,fe.drawCall=0,fe.trianglesFaces=0,fe.spriteCount=0,fe.spriteRenderUseCacheCount=0,fe.treeNodeCollision=0,fe.treeSpriteCollision=0,fe.canvasNormal=0,fe.canvasBitmap=0,fe.canvasReCache=0,fe.renderSlow=!1,fe.currentMemorySize=0,fe._fpsStr=null,fe._canvasStr=null,fe._spriteStr=null,fe._fpsData=[],fe._timer=0,fe._count=0,fe._view=[],fe._fontSize=12,fe._txt=null,fe._leftText=null,fe._sp=null,fe._show=!1,fe._useCanvas=!1,fe._canvas=null,fe._ctx=null,fe._first=!1,fe._vx=NaN,fe._width=0,fe._height=100,fe);function fe(){}!function(){function e(){this._strsToID={},this._idToStrs=[],this._length=0}f(e,"laya.utils.StringKey");var t=e.prototype;t.add=function(e){var t=this._strsToID[e];return null!=t?t:(this._idToStrs[this._length]=e,this._strsToID[e]=this._length++)},t.getID=function(e){var t=this._strsToID[e];return null==t?-1:t},t.getName=function(e){var t=this._idToStrs[e];return null==t?void 0:t}}();var me=function(){var l;function h(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map=[],this._laters=[],this._handlers=[],this._temp=[],this._count=0,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}f(h,"laya.utils.Timer");var e=h.prototype;return e._init=function(){x.timer&&x.timer.frameLoop(1,this,this._update)},e._now=function(){return Date.now()},e._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var e=this.currFrame=this.currFrame+this.scale,t=this._now();this._delta=(t-this._lastTimer)*this.scale;var i=this.currTimer=this.currTimer+this._delta;this._lastTimer=t;var n=this._handlers;for(s=this._count=0,o=n.length;s<o;s++)if(null!==(l=n[s]).method){var a=l.userFrame?e:i;if(a>=l.exeTime)if(l.repeat)if(l.jumpFrame)for(;a>=l.exeTime;)l.exeTime+=l.delay,l.run(!1);else l.exeTime+=l.delay,l.run(!1),a>l.exeTime&&(l.exeTime+=Math.ceil((a-l.exeTime)/l.delay)*l.delay);else l.run(!0)}else this._count++;(30<this._count||e%200==0)&&this._clearHandlers();for(var r=this._laters,s=0,o=r.length-1;s<=o;s++){var l=r[s];null!==l.method&&(this._map[l.key]=null,l.run(!1)),this._recoverHandler(l),s===o&&(o=r.length-1)}r.length=0}},e._clearHandlers=function(){for(var e=this._handlers,t=0,i=e.length;t<i;t++){var n=e[t];null!==n.method?this._temp.push(n):this._recoverHandler(n)}this._handlers=this._temp,this._temp=e,this._temp.length=0},e._recoverHandler=function(e){this._map[e.key]==e&&(this._map[e.key]=null),e.clear(),h._pool.push(e)},e._create=function(e,t,i,n,a,r,s){if(!i)return a.apply(n,r),null;if(s){var o=this._getHandler(n,a);if(o)return o.repeat=t,o.userFrame=e,o.delay=i,o.caller=n,o.method=a,o.args=r,o.exeTime=i+(e?this.currFrame:this.currTimer+this._now()-this._lastTimer),o}return(o=0<h._pool.length?h._pool.pop():new l).repeat=t,o.userFrame=e,o.delay=i,o.caller=n,o.method=a,o.args=r,o.exeTime=i+(e?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(o),this._handlers.push(o),o},e._indexHandler=function(e){var t=e.caller,i=e.method,n=t?t.$_GID||(t.$_GID=ve.getGID()):0,a=i.$_TID||(i.$_TID=1e5*this._mid++);e.key=n+a,this._map[e.key]=e},e.once=function(e,t,i,n,a){void 0===a&&(a=!0),this._create(!1,!1,e,t,i,n,a)},e.loop=function(e,t,i,n,a,r){void 0===a&&(a=!0),void 0===r&&(r=!1);var s=this._create(!1,!0,e,t,i,n,a);s&&(s.jumpFrame=r)},e.frameOnce=function(e,t,i,n,a){void 0===a&&(a=!0),this._create(!0,!1,e,t,i,n,a)},e.frameLoop=function(e,t,i,n,a){void 0===a&&(a=!0),this._create(!0,!0,e,t,i,n,a)},e.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+h._pool.length},e.clear=function(e,t){var i=this._getHandler(e,t);i&&(this._map[i.key]=null,i.key=0,i.clear())},e.clearAll=function(e){if(e)for(var t=0,i=this._handlers.length;t<i;t++){var n=this._handlers[t];n.caller===e&&(this._map[n.key]=null,n.key=0,n.clear())}},e._getHandler=function(e,t){var i=e?e.$_GID||(e.$_GID=ve.getGID()):0,n=t.$_TID||(t.$_TID=1e5*this._mid++);return this._map[i+n]},e.callLater=function(e,t,i){if(null==this._getHandler(e,t)){if(h._pool.length)var n=h._pool.pop();else n=new l;n.caller=e,n.method=t,n.args=i,this._indexHandler(n),this._laters.push(n)}},e.runCallLater=function(e,t){var i=this._getHandler(e,t);i&&null!=i.method&&(this._map[i.key]=null,i.run(!0))},e.runTimer=function(e,t){this.runCallLater(e,t)},c(0,e,"delta",function(){return this._delta}),h._pool=[],h.__init$=function(){l=function(){function e(){this.key=0,this.repeat=!1,this.delay=0,this.userFrame=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}f(e,"");var t=e.prototype;return t.clear=function(){this.caller=null,this.method=null,this.args=null},t.run=function(e){var t=this.caller;if(t&&t.destroyed)return this.clear();var i=this.method,n=this.args;e&&this.clear(),null!=i&&(n?i.apply(t,n):i.call(t))},e}()},h}(),ge=function(){function u(){this.gid=0}f(u,"laya.utils.Tween");var e=u.prototype;return e.to=function(e,t,i,n,a,r,s){return void 0===r&&(r=0),void 0===s&&(s=!1),this._create(e,t,i,n,a,r,s,!0,!1,!0)},e.from=function(e,t,i,n,a,r,s){return void 0===r&&(r=0),void 0===s&&(s=!1),this._create(e,t,i,n,a,r,s,!1,!1,!0)},e._create=function(e,t,i,n,a,r,s,o,l,h){if(!e)throw new Error("Tween:target is null");this._target=e,this._duration=i,this._ease=n||t.ease||u.easeNone,this._complete=a||t.complete,this._delay=r,this._props=[],this._usedTimer=0,this._startTimer=Q.now(),this._usedPool=l,this._delayParam=null,this.update=t.update;var c=e.$_GID||(e.$_GID=ve.getGID());return u.tweenMap[c]?(s&&u.clearTween(e),u.tweenMap[c].push(this)):u.tweenMap[c]=[this],h?r<=0?this.firstStart(e,t,o):(this._delayParam=[e,t,o],x.scaleTimer.once(r,this,this.firstStart,this._delayParam)):this._initProps(e,t,o),this},e.firstStart=function(e,t,i){this._delayParam=null,e.destroyed?this.clear():(this._initProps(e,t,i),this._beginLoop())},e._initProps=function(e,t,i){for(var n in t)if("number"==typeof e[n]){var a=i?e[n]:t[n],r=i?t[n]:e[n];this._props.push([n,a,r-a]),i||(e[n]=a)}},e._beginLoop=function(){x.scaleTimer.frameLoop(1,this,this._doEase)},e._doEase=function(){this._updateEase(Q.now())},e._updateEase=function(e){var t=this._target;if(t){if(t.destroyed)return u.clearTween(t);var i=this._usedTimer=e-this._startTimer-this._delay;if(!(i<0)){if(i>=this._duration)return this.complete();for(var n=0<i?this._ease(i,0,1,this._duration):0,a=this._props,r=0,s=a.length;r<s;r++){var o=a[r];t[o[0]]=o[1]+n*o[2]}this.update&&this.update.run()}}},e.complete=function(){if(this._target){x.scaleTimer.runTimer(this,this.firstStart);for(var e=this._target,t=this._props,i=this._complete,n=0,a=t.length;n<a;n++){var r=t[n];e[r[0]]=r[1]+r[2]}this.update&&this.update.run(),this.clear(),i&&i.run()}},e.pause=function(){x.scaleTimer.clear(this,this._beginLoop),x.scaleTimer.clear(this,this._doEase),x.scaleTimer.clear(this,this.firstStart);var e;(e=Q.now()-this._startTimer-this._delay)<0&&(this._usedTimer=e)},e.setStartTime=function(e){this._startTimer=e},e.clear=function(){this._target&&(this._remove(),this._clear())},e._clear=function(){this.pause(),x.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,de.recover("tween",this))},e.recover=function(){this._usedPool=!0,this._clear()},e._remove=function(){var e=u.tweenMap[this._target.$_GID];if(e)for(var t=0,i=e.length;t<i;t++)if(e[t]===this){e.splice(t,1);break}},e.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=Q.now(),this._delayParam)x.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var e=this._props,t=0,i=e.length;t<i;t++){var n=e[t];this._target[n[0]]=n[1]}x.scaleTimer.once(this._delay,this,this._beginLoop)}},e.resume=function(){this._usedTimer>=this._duration||(this._startTimer=Q.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?x.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},c(0,e,"progress",null,function(e){var t=e*this._duration;this._startTimer=Q.now()-this._delay-t}),u.to=function(e,t,i,n,a,r,s,o){return void 0===r&&(r=0),void 0===s&&(s=!1),void 0===o&&(o=!0),de.getItemByClass("tween",u)._create(e,t,i,n,a,r,s,!0,o,!0)},u.from=function(e,t,i,n,a,r,s,o){return void 0===r&&(r=0),void 0===s&&(s=!1),void 0===o&&(o=!0),de.getItemByClass("tween",u)._create(e,t,i,n,a,r,s,!1,o,!0)},u.clearAll=function(e){if(e&&e.$_GID){var t=u.tweenMap[e.$_GID];if(t){for(var i=0,n=t.length;i<n;i++)t[i]._clear();t.length=0}}},u.clear=function(e){e.clear()},u.clearTween=function(e){u.clearAll(e)},u.easeNone=function(e,t,i,n){return i*e/n+t},u.tweenMap={},u}(),ve=(f(ye,"laya.utils.Utils"),ye.toRadian=function(e){return e*ye._pi2},ye.toAngle=function(e){return e*ye._pi},ye.toHexColor=function(e){if(e<0||isNaN(e))return null;for(var t=e.toString(16);t.length<6;)t="0"+t;return"#"+t},ye.getGID=function(){return ye._gid++},ye.concatArray=function(e,t){if(!t)return e;if(!e)return t;var i=0,n=t.length;for(i=0;i<n;i++)e.push(t[i]);return e},ye.clearArray=function(e){return e&&(e.length=0),e},ye.copyArray=function(e,t){if(e=e||[],!t)return e;e.length=t.length;var i=0,n=t.length;for(i=0;i<n;i++)e[i]=t[i];return e},ye.getGlobalRecByPoints=function(e,t,i,n,a){var r,s;return r=new O(t,i),r=e.localToGlobal(r),s=new O(n,a),s=e.localToGlobal(s),k._getWrapRec([r.x,r.y,s.x,s.y])},ye.getGlobalPosAndScale=function(e){return ye.getGlobalRecByPoints(e,0,0,1,1)},ye.bind=function(e,t){return e.bind(t)},ye.measureText=function(e,t){return L.measureText(e,t)},ye.updateOrder=function(e){if(!e||e.length<2)return!1;for(var t,i=1,n=0,a=e.length,r=NaN;i<a;){for(t=e[n=i],r=e[n]._zOrder;-1<--n&&e[n]._zOrder>r;)e[n+1]=e[n];e[n+1]=t,i++}var s=t.parent.conchModel;if(s)if(null!=s.updateZOrder)s.updateZOrder();else{for(i=0;i<a;i++)s.removeChild(e[i].conchModel);for(i=0;i<a;i++)s.addChildAt(e[i].conchModel,i)}return!0},ye.transPointList=function(e,t,i){var n=0,a=e.length;for(n=0;n<a;n+=2)e[n]+=t,e[n+1]+=i},ye.parseInt=function(e,t){void 0===t&&(t=0);var i=Q.window.parseInt(e,t);return isNaN(i)?0:i},ye.getFileExtension=function(e){ye._extReg.lastIndex=e.lastIndexOf(".");var t=ye._extReg.exec(e);return t&&1<t.length?t[1].toLowerCase():null},ye.getTransformRelativeToWindow=function(e,t,i){var n=x.stage,a=laya.utils.Utils.getGlobalPosAndScale(e),r=n._canvasTransform.clone(),s=r.tx,o=r.ty;r.rotate(-Math.PI/180*x.stage.canvasDegree),r.scale(x.stage.clientScaleX,x.stage.clientScaleY);var l=x.stage.canvasDegree%180!=0,h=NaN,c=NaN;l?(h=i+a.y,c=t+a.x,h*=r.d,c*=r.a,90==x.stage.canvasDegree?(h=s-h,c+=o):(h+=s,c=o-c)):(h=t+a.x,c=i+a.y,h*=r.a,c*=r.d,h+=s,c+=o);var u=NaN,d=NaN;return d=l?(u=r.d*a.height,r.a*a.width):(u=r.a*a.width,r.d*a.height),{x:h,y:c,scaleX:u,scaleY:d}},ye.fitDOMElementInArea=function(e,t,i,n,a,r){e._fitLayaAirInitialized||(e._fitLayaAirInitialized=!0,e.style.transformOrigin=e.style.webKittransformOrigin="left top",e.style.position="absolute");var s=ye.getTransformRelativeToWindow(t,i,n);e.style.transform=e.style.webkitTransform="scale("+s.scaleX+","+s.scaleY+") rotate("+x.stage.canvasDegree+"deg)",e.style.width=a+"px",e.style.height=r+"px",e.style.left=s.x+"px",e.style.top=s.y+"px"},ye.isOkTextureList=function(e){if(!e)return!1;var t,i=0,n=e.length;for(i=0;i<n;i++)if(!(t=e[i])||!t.source)return!1;return!0},ye.isOKCmdList=function(e){if(!e)return!1;var t,i,n=0,a=e.length,r=X._context;for(n=0;n<a;n++)switch((t=e[n]).callee){case r._drawTexture:case r._fillTexture:case r._drawTextureWithTransform:if(!(i=t[0])||!i.source)return!1}return!0},ye._gid=1,ye._pi=180/Math.PI,ye._pi2=Math.PI/180,ye._extReg=/\.(\w+)\??/g,ye.parseXMLFromString=function(e){var t;if(e=e.replace(/>\s+</g,"><"),-1<(t=(new DOMParser).parseFromString(e,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(t.firstChild.firstChild.textContent);return t},ye);function ye(){}var Ce=function(){function e(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],X.isWebGL&&ee.regCacheByFunction(ve.bind(this.startDispose,this),ve.bind(this.getCacheList,this))}f(e,"laya.utils.VectorGraphManager");var t=e.prototype;return t.getId=function(){return this._id++},t.addShape=function(e,t){this.shapeDic[e]=t,this.useDic[e]||(this.useDic[e]=!0)},t.addLine=function(e,t){this.shapeLineDic[e]=t,this.shapeLineDic[e]||(this.shapeLineDic[e]=!0)},t.getShape=function(e){this._checkKey&&null!=this.useDic[e]&&(this.useDic[e]=!0)},t.deleteShape=function(e){this.shapeDic[e]&&(this.shapeDic[e]=null,delete this.shapeDic[e]),this.shapeLineDic[e]&&(this.shapeLineDic[e]=null,delete this.shapeLineDic[e]),null!=this.useDic[e]&&delete this.useDic[e]},t.getCacheList=function(){var e,t=[];for(e in this.shapeDic)t.push(this.shapeDic[e]);for(e in this.shapeLineDic)t.push(this.shapeLineDic[e]);return t},t.startDispose=function(e){var t;for(t in this.useDic)this.useDic[t]=!1;this._checkKey=!0},t.endDispose=function(){if(this._checkKey){var e;for(e in this.useDic)this.useDic[e]||this.deleteShape(e);this._checkKey=!1}},e.getInstance=function(){return e.instance=e.instance||new e},e.instance=null,e}(),Ee=function(){function n(){this._obj=null,this._obj=n.supportWeakMap?new Q.window.WeakMap:{},n.supportWeakMap||n._maps.push(this)}f(n,"laya.utils.WeakObject");var e=n.prototype;return e.set=function(e,t){if(null!=e)if(n.supportWeakMap){var i=e;"string"!=typeof e&&"number"!=typeof e||(i=(i=n._keys[e])||(n._keys[e]={k:e})),this._obj.set(i,t)}else"string"==typeof e||"number"==typeof e?this._obj[e]=t:(e.$_GID||(e.$_GID=ve.getGID()),this._obj[e.$_GID]=t)},e.get=function(e){if(null==e)return null;if(n.supportWeakMap){var t="string"==typeof e||"number"==typeof e?n._keys[e]:e;return t?this._obj.get(t):null}return"string"==typeof e||"number"==typeof e?this._obj[e]:this._obj[e.$_GID]},e.del=function(e){if(null!=e)if(n.supportWeakMap){var t="string"==typeof e||"number"==typeof e?n._keys[e]:e;if(!t)return;this._obj.delete(t)}else"string"==typeof e||"number"==typeof e?delete this._obj[e]:delete this._obj[this._obj.$_GID]},e.has=function(e){if(null==e)return!1;if(n.supportWeakMap){var t="string"==typeof e||"number"==typeof e?n._keys[e]:e;return this._obj.has(t)}return"string"==typeof e||"number"==typeof e?null!=this._obj[e]:null!=this._obj[this._obj.$_GID]},n.__init__=function(){(n.supportWeakMap=null!=Q.window.WeakMap)||x.timer.loop(n.delInterval,null,n.clearCache)},n.clearCache=function(){for(var e=0,t=n._maps.length;e<t;e++){n._maps[e]._obj={}}},n.supportWeakMap=!1,n.delInterval=3e5,n._keys={},n._maps=[],l(n,["I",function(){return this.I=new n}]),n}(),Se=function(){function e(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}f(e,"laya.utils.WordText");var t=e.prototype;return t.setText=function(e){this.changed=!0,this._text=e},t.toString=function(){return this._text},t.charCodeAt=function(e){return this._text?this._text.charCodeAt(e):NaN},t.charAt=function(e){return this._text?this._text.charAt(e):null},c(0,t,"length",function(){return this._text?this._text.length:0}),e}(),xe=function(){function s(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,s.__super.call(this),this._childs=s.ARRAY_EMPTY,this._$P=s.PROP_EMPTY,this.timer=x.scaleTimer,this.conchModel=X.isConchNode?this.createConchModel():null}f(s,"laya.display.Node",i);var e=s.prototype;return e._setBit=function(e,t){1==e&&this._getBit(e)!=t&&this._updateDisplayedInstage();t?this._bits|=e:this._bits&=~e},e._getBit=function(e){return 0!=(this._bits&e)},e._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},e._setUpNoticeType=function(e){var t=this;for(t._setBit(e,!0),t=t.parent;t;){if(t._getBit(e))return;t._setBit(e,!0),t=t.parent}},e.on=function(e,t,i,n){return"display"!==e&&"undisplay"!==e||this._getBit(1)||this._setUpNoticeType(1),this._createListener(e,t,i,n,!1)},e.once=function(e,t,i,n){return"display"!==e&&"undisplay"!==e||this._getBit(1)||this._setUpNoticeType(1),this._createListener(e,t,i,n,!0)},e.createConchModel=function(){return null},e.destroy=function(e){void 0===e&&(e=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(e?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},e.destroyChildren=function(){if(this._childs)for(var e=this._childs.length-1;-1<e;e--)this._childs[e].destroy(!0)},e.addChild=function(e){if(!e||this.destroyed||e===this)return e;if(e.zOrder&&this._set$P("hasZorder",!0),e._parent===this){var t=this.getChildIndex(e);t!==this._childs.length-1&&(this._childs.splice(t,1),this._childs.push(e),this.conchModel&&(this.conchModel.removeChild(e.conchModel),this.conchModel.addChildAt(e.conchModel,this._childs.length-1)),this._childChanged())}else e.parent&&e.parent.removeChild(e),this._childs===s.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(e),this.conchModel&&this.conchModel.addChildAt(e.conchModel,this._childs.length-1),(e.parent=this)._childChanged();return e},e.addChildren=function(e){for(var t=arguments,i=0,n=t.length;i<n;)this.addChild(t[i++])},e.addChildAt=function(e,t){if(!e||this.destroyed||e===this)return e;if(e.zOrder&&this._set$P("hasZorder",!0),0<=t&&t<=this._childs.length){if(e._parent===this){var i=this.getChildIndex(e);this._childs.splice(i,1),this._childs.splice(t,0,e),this.conchModel&&(this.conchModel.removeChild(e.conchModel),this.conchModel.addChildAt(e.conchModel,t)),this._childChanged()}else e.parent&&e.parent.removeChild(e),this._childs===s.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(t,0,e),this.conchModel&&this.conchModel.addChildAt(e.conchModel,t),e.parent=this;return e}throw new Error("appendChildAt:The index is out of bounds")},e.getChildIndex=function(e){return this._childs.indexOf(e)},e.getChildByName=function(e){var t=this._childs;if(t)for(var i=0,n=t.length;i<n;i++){var a=t[i];if(a.name===e)return a}return null},e._get$P=function(e){return this._$P[e]},e._set$P=function(e,t){return this.destroyed||(this._$P===s.PROP_EMPTY&&(this._$P={}),this._$P[e]=t),t},e.getChildAt=function(e){return this._childs[e]},e.setChildIndex=function(e,t){var i=this._childs;if(t<0||t>=i.length)throw new Error("setChildIndex:The index is out of bounds.");var n=this.getChildIndex(e);if(n<0)throw new Error("setChildIndex:node is must child of this object.");return i.splice(n,1),i.splice(t,0,e),this.conchModel&&(this.conchModel.removeChild(e.conchModel),this.conchModel.addChildAt(e.conchModel,t)),this._childChanged(),e},e._childChanged=function(e){},e.removeChild=function(e){if(!this._childs)return e;var t=this._childs.indexOf(e);return this.removeChildAt(t)},e.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},e.removeChildByName=function(e){var t=this.getChildByName(e);return t&&this.removeChild(t),t},e.removeChildAt=function(e){var t=this.getChildAt(e);return t&&(this._childs.splice(e,1),this.conchModel&&this.conchModel.removeChild(t.conchModel),t.parent=null),t},e.removeChildren=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=2147483647),this._childs&&0<this._childs.length){var i=this._childs;if(0===e&&r<=t){var n=i;this._childs=s.ARRAY_EMPTY}else n=i.splice(e,t-e);for(var a=0,r=n.length;a<r;a++)n[a].parent=null,this.conchModel&&this.conchModel.removeChild(n[a].conchModel)}return this},e.replaceChild=function(e,t){var i=this._childs.indexOf(t);return-1<i?(this._childs.splice(i,1,e),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(e.conchModel,i)),t.parent=null,e.parent=this,e):null},e._updateDisplayedInstage=function(){var e;e=this;var t=x.stage;for(this._displayedInStage=!1;e;){if(e._getBit(1)){this._displayedInStage=e._displayedInStage;break}if(e==t||e._displayedInStage){this._displayedInStage=!0;break}e=e.parent}},e._setDisplay=function(e){this._displayedInStage!==e&&((this._displayedInStage=e)?this.event("display"):this.event("undisplay"))},e._displayChild=function(e,t){var i=e._childs;if(i)for(var n=0,a=i.length;n<a;n++){var r=i[n];r._getBit(1)&&(0<r._childs.length?this._displayChild(r,t):r._setDisplay(t))}e._setDisplay(t)},e.contains=function(e){if(e===this)return!0;for(;e;){if(e.parent===this)return!0;e=e.parent}return!1},e.timerLoop=function(e,t,i,n,a,r){void 0===a&&(a=!0),void 0===r&&(r=!1),this.timer.loop(e,t,i,n,a,r)},e.timerOnce=function(e,t,i,n,a){void 0===a&&(a=!0),this.timer._create(!1,!1,e,t,i,n,a)},e.frameLoop=function(e,t,i,n,a){void 0===a&&(a=!0),this.timer._create(!0,!0,e,t,i,n,a)},e.frameOnce=function(e,t,i,n,a){void 0===a&&(a=!0),this.timer._create(!0,!1,e,t,i,n,a)},e.clearTimer=function(e,t){this.timer.clear(e,t)},c(0,e,"numChildren",function(){return this._childs.length}),c(0,e,"destroyed",function(){return this._destroyed}),c(0,e,"parent",function(){return this._parent},function(e){this._parent!==e&&(e?(this._parent=e,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),e.displayedInStage&&this._displayChild(this,!0)),e._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=e))}),c(0,e,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),s.ARRAY_EMPTY=[],s.PROP_EMPTY={},s.NOTICE_DISPLAY=1,s.MOUSEENABLE=2,s}(),Te=function(e){function d(e){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,d.__super.call(this),this._padding=d._PADDING,this._spacing=d._SPACING,this._aligns=d._ALIGNS,this._font=h.EMPTY,this._ower=e}f(d,"laya.display.css.CSSStyle",e);var t=d.prototype;return t.destroy=function(){this._ower=null,this._font=null,this._rect=null},t.inherit=function(e){this._font=e._font,this._spacing=e._spacing===d._SPACING?d._SPACING:e._spacing.slice(),this.lineHeight=e.lineHeight},t._widthAuto=function(){return 0!=(262144&this._type)},t.widthed=function(e){return 0!=(8&this._type)},t._calculation=function(e,t){if(t.indexOf("%")<0)return!1;var n=this._ower,a=n.parent,r=this._rect;function s(e,t,i){return e*i[0]+t*i[1]+i[2]}function i(e){var t=a.width,i=n.width;r.width&&(n.width=s(t,i,r.width)),r.height&&(n.height=s(t,i,r.height)),r.left&&(n.x=s(t,i,r.left)),r.top&&(n.y=s(t,i,r.top))}null===r&&(a._getCSSStyle()._type|=524288,a.on("resize",this,i),this._rect=r={input:{}});var o=t.split(" ");return o[0]=parseFloat(o[0])/100,1==o.length?o[1]=o[2]=0:(o[1]=parseFloat(o[1])/100,o[2]=parseFloat(o[2])),r[e]=o,r.input[e]=t,i(),!0},t.heighted=function(e){return 0!=(8192&this._type)},t.size=function(e,t){var i=this._ower,n=!1;-1!==e&&e!=this._ower.width&&(this._type|=8,this._ower.width=e,n=!0),-1!==t&&t!=this._ower.height&&(this._type|=8192,this._ower.height=t,n=!0),n&&(i._layoutLater(),524288&this._type&&i.event("resize",this))},t._getAlign=function(){return this._aligns[0]},t._getValign=function(){return this._aligns[1]},t._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},t._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new h(this._font))},t.render=function(e,t,i,n){var a=e.width,r=e.height;i-=e.pivotX,n-=e.pivotY,this._bgground&&null!=this._bgground.color&&t.ctx.fillRect(i,n,a,r,this._bgground.color),this._border&&this._border.color&&t.drawRect(i,n,a,r,this._border.color.strColor,this._border.size)},t.getCSSStyle=function(){return this},t.cssText=function(e){this.attrs(d.parseOneCSS(e,";"))},t.attrs=function(e){if(e)for(var t=0,i=e.length;t<i;t++){var n=e[t];this[n[0]]=n[1]}},t.setTransform=function(e){"none"===e?this._tf=o._TF_EMPTY:this.attrs(d.parseOneCSS(e,","))},t.translate=function(e,t){this._tf===o._TF_EMPTY&&(this._tf=new a),this._tf.translateX=e,this._tf.translateY=t},t.scale=function(e,t){this._tf===o._TF_EMPTY&&(this._tf=new a),this._tf.scaleX=e,this._tf.scaleY=t},t._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},c(0,t,"block",e.prototype._$get_block,function(e){e?this._type|=1:this._type&=-2}),c(0,t,"valign",function(){return d._valigndef[this._aligns[1]]},function(e){this._aligns===d._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=d._valigndef[e]}),c(0,t,"height",null,function(e){if(this._type|=8192,"string"==typeof e){if(this._calculation("height",e))return;e=parseInt(e)}this.size(-1,e)}),c(0,t,"width",null,function(e){if(this._type|=8,"string"==typeof e){var t=e.indexOf("auto");if(0<=t&&(this._type|=262144,e=e.substr(0,t)),this._calculation("width",e))return;e=parseInt(e)}this.size(e,-1)}),c(0,t,"fontWeight",function(){return this._font.weight},function(e){this._createFont().weight=e}),c(0,t,"left",null,function(e){var t=this._ower;if("string"==typeof e){if("center"===e?e="50% -50% 0":"right"===e&&(e="100% -100% 0"),this._calculation("left",e))return;e=parseInt(e)}t.x=e}),c(0,t,"_translate",null,function(e){this.translate(e[0],e[1])}),c(0,t,"absolute",function(){return 0!=(4&this._type)}),c(0,t,"top",null,function(e){var t=this._ower;if("string"==typeof e){if("middle"===e?e="50% -50% 0":"bottom"===e&&(e="100% -100% 0"),this._calculation("top",e))return;e=parseInt(e)}t.y=e}),c(0,t,"align",function(){return d._aligndef[this._aligns[0]]},function(e){this._aligns===d._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=d._aligndef[e]}),c(0,t,"bold",function(){return this._font.bold},function(e){this._createFont().bold=e}),c(0,t,"padding",function(){return this._padding},function(e){this._padding=e}),c(0,t,"leading",function(){return this._spacing[1]},function(e){"string"==typeof e&&(e=parseInt(e+"")),this._spacing===d._SPACING&&(this._spacing=[0,0]),this._spacing[1]=e}),c(0,t,"lineElement",function(){return 0!=(65536&this._type)},function(e){e?this._type|=65536:this._type&=-65537}),c(0,t,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(e){this.lineElement=!1,"right"===e?this._type|=32768:this._type&=-32769}),c(0,t,"textDecoration",function(){return this._font.decoration},function(e){this._createFont().decoration=e}),c(0,t,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(e){"nowrap"===e&&(this._type|=131072),"none"===e&&(this._type&=-131073)}),c(0,t,"background",null,function(e){e?(this._bgground||(this._bgground={}),this._bgground.color=e,this._ower.conchModel&&this._ower.conchModel.bgColor(e),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),c(0,t,"wordWrap",function(){return 0==(131072&this._type)},function(e){e?this._type&=-131073:this._type|=131072}),c(0,t,"color",function(){return this._font.color},function(e){this._createFont().color=e}),c(0,t,"password",function(){return this._font.password},function(e){this._createFont().password=e}),c(0,t,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(e){"none"===e?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=e),this._ower.conchModel&&this._ower.conchModel.bgColor(e),this._ower._renderType|=256}),c(0,t,"font",function(){return this._font.toString()},function(e){this._createFont().set(e)}),c(0,t,"weight",null,function(e){this._createFont().weight=e}),c(0,t,"letterSpacing",function(){return this._spacing[0]},function(e){"string"==typeof e&&(e=parseInt(e+"")),this._spacing===d._SPACING&&(this._spacing=[0,0]),this._spacing[0]=e}),c(0,t,"fontSize",function(){return this._font.size},function(e){this._createFont().size=e}),c(0,t,"italic",function(){return this._font.italic},function(e){this._createFont().italic=e}),c(0,t,"fontFamily",function(){return this._font.family},function(e){this._createFont().family=e}),c(0,t,"stroke",function(){return this._font.stroke[0]},function(e){this._createFont().stroke===h._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=e}),c(0,t,"strokeColor",function(){return this._font.stroke[1]},function(e){this._createFont().stroke===h._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=e}),c(0,t,"border",function(){return this._border?this._border.value:""},function(e){if("none"!=e){this._border||(this._border={});var t=(this._border.value=e).split(" ");if(this._border.color=ae.create(t[t.length-1]),1==t.length)return this._border.size=1,void(this._border.type="solid");var i=0;0<t[0].indexOf("px")?(this._border.size=parseInt(t[0]),i++):this._border.size=1,this._border.type=t[i],this._ower._renderType|=256}else this._border=null}),c(0,t,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(e){e?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==e?null:ae.create(e),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),c(0,t,"position",function(){return 4&this._type?"absolute":""},function(e){"absolute"==e?this._type|=4:this._type&=-5}),c(0,t,"display",null,function(e){switch(e){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),c(0,t,"paddingLeft",function(){return this.padding[3]}),c(0,t,"paddingTop",function(){return this.padding[0]}),c(0,t,"_scale",null,function(e){this._ower.scale(e[0],e[1])}),c(0,t,"_rotate",null,function(e){this._ower.rotation=e}),d.parseOneCSS=function(e,t){for(var i,n=[],a=e.split(t),r=0,s=a.length;r<s;r++){var o=a[r],l=o.indexOf(":"),h=o.substr(0,l).replace(/^\s+|\s+$/g,"");if(0!=h.length){var c=o.substr(l+1).replace(/^\s+|\s+$/g,""),u=[h,c];switch(h){case"italic":case"bold":u[1]="true"==c;break;case"line-height":u[0]="lineHeight",u[1]=parseInt(c);break;case"font-size":u[0]="fontSize",u[1]=parseInt(c);break;case"padding":1<(i=c.split(" ")).length||(i[1]=i[2]=i[3]=i[0]),u[1]=[parseInt(i[0]),parseInt(i[1]),parseInt(i[2]),parseInt(i[3])];break;case"rotate":u[0]="_rotate",u[1]=parseFloat(c);break;case"scale":i=c.split(" "),u[0]="_scale",u[1]=[parseFloat(i[0]),parseFloat(i[1])];break;case"translate":i=c.split(" "),u[0]="_translate",u[1]=[parseInt(i[0]),parseInt(i[1])];break;default:(u[0]=d._CSSTOVALUE[h])||(u[0]=h)}n.push(u)}}return n},d.parseCSS=function(e,t){for(var i;null!=(i=d._parseCSSRegExp.exec(e));)d.styleSheets[i[1]]=d.parseOneCSS(i[2],";")},d.EMPTY=new d(null),d._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},d._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),d._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},d._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},d.styleSheets={},d.ALIGN_CENTER=1,d.ALIGN_RIGHT=2,d.VALIGN_MIDDLE=1,d.VALIGN_BOTTOM=2,d._CSS_BLOCK=1,d._DISPLAY_NONE=2,d._ABSOLUTE=4,d._WIDTH_SET=8,d._PADDING=[0,0,0,0],d._RECT=[-1,-1,-1,-1],d._SPACING=[0,0],d._ALIGNS=[0,0,0],d.ADDLAYOUTED=512,d._NEWFONT=4096,d._HEIGHT_SET=8192,d._BACKGROUND_SET=16384,d._FLOAT_RIGHT=32768,d._LINE_ELEMENT=65536,d._NOWARP=131072,d._WIDTHAUTO=262144,d._LISTERRESZIE=524288,d}(o),we=function(){function s(){this.url=null,this.audio=null,this.loaded=!1,s.__super.call(this)}f(s,"laya.media.h5audio.AudioSound",i);var e=s.prototype;return e.dispose=function(){var e=s._audioCache[this.url];e&&(e.src="",delete s._audioCache[this.url])},e.load=function(e){var t;if(e=W.formatURL(e),(this.url=e)==V._tMusic?(s._initMusicAudio(),(t=s._musicAudio).src!=e&&(s._audioCache[t.src]=null,t=null)):t=s._audioCache[e],t&&2<=t.readyState)this.event("complete");else{t||(t=e==V._tMusic?(s._initMusicAudio(),s._musicAudio):Q.createElement("audio"),(s._audioCache[e]=t).src=e),t.addEventListener("canplaythrough",n),t.addEventListener("error",a);var i=this;(this.audio=t).load?t.load():a()}function n(){r(),i.loaded=!0,i.event("complete")}function a(){t.load=null,r(),i.event("error")}function r(){t.removeEventListener("canplaythrough",n),t.removeEventListener("error",a)}},e.play=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=0),!this.url)return null;var i,n;if(!(i=this.url==V._tMusic?s._musicAudio:s._audioCache[this.url]))return null;n=de.getItem("audio:"+this.url),X.isConchApp?n||((n=Q.createElement("audio")).src=this.url):this.url==V._tMusic?(s._initMusicAudio(),(n=s._musicAudio).src=this.url):n=n||i.cloneNode(!0);var a=new ke(n);return a.url=this.url,a.loops=t,a.startTime=e,a.play(),V.addChannel(a),a},c(0,e,"duration",function(){var e;return(e=s._audioCache[this.url])?e.duration:0}),s._initMusicAudio=function(){s._musicAudio||(s._musicAudio||(s._musicAudio=Q.createElement("audio")),X.isConchApp||Q.document.addEventListener("mousedown",s._makeMusicOK))},s._makeMusicOK=function(){Q.document.removeEventListener("mousedown",s._makeMusicOK),s._musicAudio.src?s._musicAudio.play():(s._musicAudio.src="",s._musicAudio.load())},s._audioCache={},s._musicAudio=null,s}(),Me=function(){function e(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.completeHandler=null,e.__super.call(this)}f(e,"laya.media.SoundChannel",i);var t=e.prototype;return t.play=function(){},t.stop=function(){},t.pause=function(){},t.resume=function(){},t.__runComplete=function(e){e&&e.run()},c(0,t,"volume",function(){return 1},function(e){}),c(0,t,"position",function(){return 0}),c(0,t,"duration",function(){return 0}),e}(),be=function(){function e(){e.__super.call(this)}f(e,"laya.media.Sound",i);var t=e.prototype;return t.load=function(e){},t.play=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),null},t.dispose=function(){},c(0,t,"duration",function(){return 0}),e}(),Re=function(){function a(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,a.__super.call(this)}f(a,"laya.media.webaudio.WebAudioSound",i);var e=a.prototype;return e.load=function(e){var t=this;if(e=W.formatURL(e),this.url=e,this.audioBuffer=a._dataCache[e],this.audioBuffer)this._loaded(this.audioBuffer);else if(a.e.on("loaded:"+e,this,this._loaded),a.e.on("err:"+e,this,this._err),!a.__loadingSound[e]){a.__loadingSound[e]=!0;var i=new Q.window.XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){t._disposed?t._removeLoadEvents():(t.data=i.response,a.buffs.push({buffer:t.data,url:t.url}),a.decode())},i.onerror=function(e){t._err()},i.send()}},e._err=function(){if(this._removeLoadEvents(),a.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var e,t,i,n=0;for(e=(t=this.__toPlays).length,n=0;n<e;n++)(i=t[n])[2]&&!i[2].isStopped&&i[2].event("error");this.__toPlays.length=0}},e._loaded=function(e){this._removeLoadEvents(),this._disposed||(this.audioBuffer=e,a._dataCache[this.url]=this.audioBuffer,this.loaded=!0,this.event("complete"))},e._removeLoadEvents=function(){a.e.off("loaded:"+this.url,this,this._loaded),a.e.off("err:"+this.url,this,this._err)},e.__playAfterLoaded=function(){if(this.__toPlays){var e,t,i,n=0;for(e=(t=this.__toPlays).length,n=0;n<e;n++)(i=t[n])[2]&&!i[2].isStopped&&this.play(i[0],i[1],i[2]);this.__toPlays.length=0}},e.play=function(e,t,i){return void 0===e&&(e=0),void 0===t&&(t=0),i=i||new Ve,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([e,t,i]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),i.url=this.url,i.loops=t,i.audioBuffer=this.audioBuffer,i.startTime=e,i.play(),V.addChannel(i),i},e.dispose=function(){this._disposed=!0,delete a._dataCache[this.url],delete a.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},c(0,e,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),a.decode=function(){a.buffs.length<=0||a.isDecoding||(a.isDecoding=!0,a.tInfo=a.buffs.shift(),a.ctx.decodeAudioData(a.tInfo.buffer,a._done,a._fail))},a._done=function(e){a.e.event("loaded:"+a.tInfo.url,e),a.isDecoding=!1,a.decode()},a._fail=function(){a.e.event("err:"+a.tInfo.url,null),a.isDecoding=!1,a.decode()},a._playEmptySound=function(){if(null!=a.ctx){var e=a.ctx.createBufferSource();e.buffer=a._miniBuffer,e.connect(a.ctx.destination),e.start(0,0,0)}},a._unlock=function(){a._unlocked||(a._playEmptySound(),"running"==a.ctx.state&&(Q.document.removeEventListener("mousedown",a._unlock,!0),Q.document.removeEventListener("touchend",a._unlock,!0),Q.document.removeEventListener("touchstart",a._unlock,!0),a._unlocked=!0))},a.initWebAudio=function(){"running"!=a.ctx.state&&(a._unlock(),Q.document.addEventListener("mousedown",a._unlock,!0),Q.document.addEventListener("touchend",a._unlock,!0),Q.document.addEventListener("touchstart",a._unlock,!0))},a._dataCache={},a.buffs=[],a.isDecoding=!1,a._unlocked=!1,a.tInfo=null,a.__loadingSound={},l(a,["window",function(){return this.window=Q.window},"webAudioEnabled",function(){return this.webAudioEnabled=a.window.AudioContext||a.window.webkitAudioContext||a.window.mozAudioContext},"ctx",function(){return this.ctx=a.webAudioEnabled?new(a.window.AudioContext||a.window.webkitAudioContext||a.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=a.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new i}]),a}(),Le=function(){function e(){this._responseType=null,this._data=null,e.__super.call(this),this._http=new Q.window.XMLHttpRequest}f(e,"laya.net.HttpRequest",i);var t=e.prototype;return t.send=function(e,t,i,n,a){void 0===i&&(i="get"),void 0===n&&(n="text"),this._responseType=n,this._data=null;var r=this,s=this._http;if(s.open(i,e,!0),a)for(var o=0;o<a.length;o++)s.setRequestHeader(a[o++],a[o]);else X.isConchApp||(t&&"string"!=typeof t?s.setRequestHeader("Content-Type","application/json"):s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));s.responseType="arraybuffer"!==n?"text":"arraybuffer",s.onerror=function(e){r._onError(e)},s.onabort=function(e){r._onAbort(e)},s.onprogress=function(e){r._onProgress(e)},s.onload=function(e){r._onLoad(e)},s.send(t)},t._onProgress=function(e){e&&e.lengthComputable&&this.event("progress",e.loaded/e.total)},t._onAbort=function(e){this.error("Request was aborted by user")},t._onError=function(e){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},t._onLoad=function(e){var t=this._http,i=void 0!==t.status?t.status:200;200===i||204===i||0===i?this.complete():this.error("["+t.status+"]"+t.statusText+":"+t.responseURL)},t.error=function(e){this.clear(),this.event("error",e)},t.complete=function(){this.clear();var t=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=ve.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(e){t=!1,this.error(e.message)}t&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},t.clear=function(){var e=this._http;e.onerror=e.onabort=e.onprogress=e.onload=null},c(0,t,"url",function(){return this._http.responseURL}),c(0,t,"http",function(){return this._http}),c(0,t,"data",function(){return this._data}),e}(),Ae=function(){function M(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,M.__super.call(this)}f(M,"laya.net.Loader",i);var e=M.prototype;return e.load=function(e,t,i,n,a){if(void 0===i&&(i=!0),void 0===a&&(a=!1),0===(this._url=e).indexOf("data:image")?this._type=t="image":(this._type=t=t||this.getTypeFromUrl(e),e=W.formatURL(e)),this._cache=i,this._data=null,!a&&M.loadedMap[e])return this._data=M.loadedMap[e],this.event("progress",1),void this.event("complete",this._data);if(n&&M.setGroup(e,n),null!=M.parserMap[t])return this._customParse=!0,void(M.parserMap[t]instanceof laya.utils.Handler?M.parserMap[t].runWith(this):M.parserMap[t].call(null,this));if("image"===t||"htmlimage"===t||"nativeimage"===t)return this._loadImage(e);if("sound"===t)return this._loadSound(e);if("ttf"===t)return this._loadTTF(e);var r;switch(t){case"atlas":case"plf":r="json";break;case"font":r="xml";break;case"pkm":r="arraybuffer";break;default:r=t}M.preLoadedMap[e]?this.onLoaded(M.preLoadedMap[e]):(this._http||(this._http=new Le,this._http.on("progress",this,this.onProgress),this._http.on("error",this,this.onError),this._http.on("complete",this,this.onLoaded)),this._http.send(e,null,"get",r))},e.getTypeFromUrl=function(e){var t=ve.getFileExtension(e);return t?M.typeMap[t]:(console.warn("Not recognize the resources suffix",e),"text")},e._loadTTF=function(e){e=W.formatURL(e);var t=new z;t.complete=v.create(this,this.onLoaded),t.load(e)},e._loadImage=function(t){t=W.formatURL(t);var i,e=this;function n(){i.onload=null,i.onerror=null,delete M.imgCache[t]}function a(){n(),e.onLoaded(i)}function r(){n(),e.event("error","Load image failed")}"nativeimage"===this._type?((i=new Q.window.Image).crossOrigin="",i.onload=a,i.onerror=r,i.src=t,M.imgCache[t]=i):new Ye.create(t,{onload:a,onerror:r,onCreate:function(e){i=e,M.imgCache[t]=e}})},e._loadSound=function(e){var t=new V._soundClass,i=this;function n(){t.offAll()}t.on("complete",this,function(){n(),i.onLoaded(t)}),t.on("error",this,function(){n(),t.dispose(),i.event("error","Load sound failed")}),t.load(e)},e.onProgress=function(e){"atlas"===this._type?this.event("progress",.3*e):this.event("progress",e)},e.onError=function(e){this.event("error",e)},e.onLoaded=function(e){var t=this._type;if("plf"==t)this.parsePLFData(e),this.complete(e);else if("image"===t){var i=new Pe(e);i.url=this._url,this.complete(i)}else if("sound"===t||"htmlimage"===t||"nativeimage"===t)this.complete(e);else if("atlas"===t){if(!e.src&&!e._setContext){if(!this._data){if((this._data=e).meta&&e.meta.image)for(var n=e.meta.image.split(","),a=0<=this._url.indexOf("/")?"/":"\\",r=this._url.lastIndexOf(a),s=0<=r?this._url.substr(0,r+1):"",o=0,l=n.length;o<l;o++)n[o]=s+n[o];else n=[this._url.replace(".json",".png")];n.reverse(),e.toLoads=n,e.pics=[]}return this.event("progress",.3+1/n.length*.6),this._loadImage(n.pop())}if(this._data.pics.push(e),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var h=this._data.frames,c=this._url.split("?")[0],u=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:c.substring(0,c.lastIndexOf("."))+"/",d=this._data.pics,_=W.formatURL(this._url),p=M.atlasMap[_]||(M.atlasMap[_]=[]);p.dir=u;var f=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var m in f=parseFloat(this._data.meta.scale),h){var g,v=h[m],y=d[v.frame.idx?v.frame.idx:0],C=W.formatURL(u+m);y.scaleRate=f,g=Pe.create(y,v.frame.x,v.frame.y,v.frame.w,v.frame.h,v.spriteSourceSize.x,v.spriteSourceSize.y,v.sourceSize.w,v.sourceSize.h),M.cacheRes(C,g),g.url=C,p.push(C)}else for(m in h)y=d[(v=h[m]).frame.idx?v.frame.idx:0],C=W.formatURL(u+m),M.cacheRes(C,Pe.create(y,v.frame.x,v.frame.y,v.frame.w,v.frame.h,v.spriteSourceSize.x,v.spriteSourceSize.y,v.sourceSize.w,v.sourceSize.h)),M.loadedMap[C].url=C,p.push(C);delete this._data.pics,this.complete(this._data)}else if("font"==t){if(!e.src)return this._data=e,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var E=new b;E.parseFont(this._data,e);var S=this._url.split(".fnt")[0].split("/"),x=S[S.length-1];He.registerBitmapFont(x,E),this._data=E,this.complete(this._data)}else if("pkm"==t){var T=Ye.create(e,this._url),w=new Pe(T);w.url=this._url,this.complete(w)}else this.complete(e)},e.parsePLFData=function(e){var t,i,n;for(t in e)switch(n=e[t],t){case"json":case"text":for(i in n)M.preLoadedMap[W.formatURL(i)]=n[i];break;default:for(i in n)M.preLoadedMap[W.formatURL(i)]=n[i]}},e.complete=function(e){this._data=e,this._customParse?this.event("loaded",e instanceof Array?[e]:e):(M._loaders.push(this),M._isWorking||M.checkNext())},e.endLoad=function(e){e&&(this._data=e),this._cache&&M.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},c(0,e,"url",function(){return this._url}),c(0,e,"data",function(){return this._data}),c(0,e,"cache",function(){return this._cache}),c(0,e,"type",function(){return this._type}),M.checkNext=function(){M._isWorking=!0;for(var e=Q.now();M._startIndex<M._loaders.length;)if(Q.now(),M._loaders[M._startIndex].endLoad(),M._startIndex++,Q.now()-e>M.maxTimeOut)return console.warn("loader callback cost a long time:"+(Q.now()-e)+" url="+M._loaders[M._startIndex-1].url),void x.timer.frameOnce(1,null,M.checkNext);M._loaders.length=0,M._startIndex=0,M._isWorking=!1},M.clearRes=function(e,t){void 0===t&&(t=!1),e=W.formatURL(e);var i=M.getAtlas(e);if(i){for(var n=0,a=i.length;n<a;n++){var r=i[n],s=M.getRes(r);delete M.loadedMap[r],s&&s.destroy(t)}i.length=0,delete M.atlasMap[e],delete M.loadedMap[e]}else{var o=M.loadedMap[e];o&&(delete M.loadedMap[e],o instanceof laya.resource.Texture&&o.bitmap&&o.destroy(t))}},M.clearTextureRes=function(e){e=W.formatURL(e);var t=laya.net.Loader.getAtlas(e),i=t&&0<t.length?laya.net.Loader.getRes(t[0]):laya.net.Loader.getRes(e);i&&i.bitmap&&(X.isConchApp&&!X.isConchWebGL?i.bitmap.source.releaseTexture&&i.bitmap.source.releaseTexture():null==i.bitmap._atlaser&&i.bitmap.releaseResource(!0))},M.getRes=function(e){return M.loadedMap[W.formatURL(e)]},M.getAtlas=function(e){return M.atlasMap[W.formatURL(e)]},M.cacheRes=function(e,t){e=W.formatURL(e),null!=M.loadedMap[e]?console.warn("Resources already exist,is repeated loading:",e):M.loadedMap[e]=t},M.setGroup=function(e,t){M.groupMap[t]||(M.groupMap[t]=[]),M.groupMap[t].push(e)},M.clearResByGroup=function(e){if(M.groupMap[e]){var t=M.groupMap[e],i=0,n=t.length;for(i=0;i<n;i++)M.clearRes(t[i]);t.length=0}},M.TEXT="text",M.JSON="json",M.XML="xml",M.BUFFER="arraybuffer",M.IMAGE="image",M.SOUND="sound",M.ATLAS="atlas",M.FONT="font",M.TTF="ttf",M.PLF="plf",M.PKM="pkm",M.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf",ani:"json",sk:"arraybuffer"},M.parserMap={},M.groupMap={},M.maxTimeOut=100,M.loadedMap={},M.preLoadedMap={},M.atlasMap={},M._loaders=[],M._isWorking=!1,M._startIndex=0,M.imgCache={},M}(),Ie=function(){var d;function _(){this.retryNum=1,this.retryDelay=0,this.maxLoader=5,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},_.__super.call(this);for(var e=0;e<this._maxPriority;e++)this._resInfos[e]=[]}f(_,"laya.net.LoaderManager",i);var e=_.prototype;return e.create=function(e,i,t,n,a,r,s,o){if(void 0===r&&(r=1),void 0===s&&(s=!0),e instanceof Array){var l=e,h=l.length,c=0;if(t)var u=v.create(t.caller,t.method,t.args,!1);for(var d=0;d<h;d++){var _=l[d];"string"==typeof _&&(_=l[d]={url:_}),_.progress=0}for(d=0;d<h;d++){_=l[d];var p=t?v.create(null,g,[_],!1):null,f=t||i?v.create(null,m,[_]):null;this._create(_.url,f,p,_.clas||n,_.params||a,_.priority||r,s,_.group||o)}function m(e,t){c++,e.progress=1,c===h&&i&&i.run()}function g(e,t){e.progress=t;for(var i=0,n=0;n<h;n++){i+=l[n].progress}var a=i/h;u.runWith(a)}return!0}return this._create(e,i,t,n,a,r,s,o)},e._create=function(t,i,e,n,a,r,s,o){void 0===r&&(r=1),void 0===s&&(s=!0);var l=W.formatURL(t),h=this.getRes(l);if(h)!h.hasOwnProperty("loaded")||h.loaded?(e&&e.runWith(1),i&&i.run()):i&&x.loader._createListener(t,i.caller,i.method,i.args,!0,!1);else{var c=ve.getFileExtension(t),u=_.createMap[c];if(!u)throw new Error("LoaderManager:unknown file("+t+") extension with: "+c+".");n=n||u[0];var d=u[1];if("atlas"==c)this.load(t,i,e,d,r,s);else{n===Pe&&(d="htmlimage"),(h=n?new n:null).hasOwnProperty("_loaded")&&(h._loaded=!1),h._setUrl(t),o&&h._setGroup(o),this._createLoad(h,t,v.create(null,function(e){h&&!h.destroyed&&e&&h.onAsynLoaded.call(h,t,e,a),i&&i.run();x.loader.event(t)}),e,d,r,!1,o,!0),s&&this.cacheRes(l,h)}}return h},e.load=function(e,t,i,n,a,r,s,o){var l=this;if(void 0===a&&(a=1),void 0===r&&(r=!0),void 0===o&&(o=!1),e instanceof Array)return this._loadAssets(e,t,i,n,a,r,s);var h=Ae.getRes(e);if(null!=h)x.timer.frameOnce(1,null,function(){i&&i.runWith(1),t&&t.runWith(h),l._loaderCount||l.event("complete")});else{var c=_._resMap[e];c?(t&&c._createListener("complete",t.caller,t.method,t.args,!1,!1),i&&c._createListener("progress",i.caller,i.method,i.args,!1,!1)):((c=this._infoPool.length?this._infoPool.pop():new d).url=e,c.type=n,c.cache=r,c.group=s,c.ignoreCache=o,t&&c.on("complete",t.caller,t.method,t.args),i&&c.on("progress",i.caller,i.method,i.args),_._resMap[e]=c,a=a<this._maxPriority?a:this._maxPriority-1,this._resInfos[a].push(c),this._next())}return this},e._createLoad=function(e,t,i,n,a,r,s,o,l){var h=this;if(void 0===r&&(r=1),void 0===s&&(s=!0),void 0===l&&(l=!1),t instanceof Array)return this._loadAssets(t,i,n,a,r,s,o);var c=Ae.getRes(t);if(null!=c)x.timer.frameOnce(1,null,function(){n&&n.runWith(1),i&&i.runWith(c),h._loaderCount||h.event("complete")});else{var u=_._resMap[t];u?(i&&u._createListener("complete",i.caller,i.method,i.args,!1,!1),n&&u._createListener("progress",n.caller,n.method,n.args,!1,!1)):((u=this._infoPool.length?this._infoPool.pop():new d).url=t,u.clas=e,u.type=a,u.cache=s,u.group=o,u.ignoreCache=l,i&&u.on("complete",i.caller,i.method,i.args),n&&u.on("progress",n.caller,n.method,n.args),_._resMap[t]=u,r=r<this._maxPriority?r:this._maxPriority-1,this._resInfos[r].push(u),this._next())}return this},e._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var e=0;e<this._maxPriority;e++)for(var t=this._resInfos[e];0<t.length;){var i=t.shift();if(i)return this._doLoad(i)}this._loaderCount||this.event("complete")}},e._doLoad=function(t){this._loaderCount++;var i=this._loaders.length?this._loaders.pop():new Ae;i.on("complete",null,a),i.on("progress",null,function(e){t.event("progress",e)}),i.on("error",null,function(e){a(null)});var n=this;function a(e){i.offAll(),i._data=null,i._customParse=!1,n._loaders.push(i),n._endLoad(t,e instanceof Array?[e]:e),n._loaderCount--,n._next()}i._class=t.clas,i.load(t.url,t.type,t.cache,t.group,t.ignoreCache)},e._endLoad=function(e,t){var i=e.url;if(null==t){var n=this._failRes[i]||0;if(n<this.retryNum)return console.warn("[warn]Retry to load:",i),this._failRes[i]=n+1,void x.timer.once(this.retryDelay,this,this._addReTry,[e],!1);console.warn("[error]Failed to load:",i),this.event("error",i)}this._failRes[i]&&(this._failRes[i]=0),delete _._resMap[i],e.event("complete",t),e.offAll(),this._infoPool.push(e)},e._addReTry=function(e){this._resInfos[this._maxPriority-1].push(e),this._next()},e.clearRes=function(e,t){void 0===t&&(t=!1),Ae.clearRes(e,t)},e.getRes=function(e){return Ae.getRes(e)},e.cacheRes=function(e,t){Ae.cacheRes(e,t)},e.clearTextureRes=function(e){Ae.clearTextureRes(e)},e.setGroup=function(e,t){Ae.setGroup(e,t)},e.clearResByGroup=function(e){Ae.clearResByGroup(e)},e.clearUnLoaded=function(){for(var e=0;e<this._maxPriority;e++){for(var t=this._resInfos[e],i=t.length-1;-1<i;i--){var n=t[i];n&&(n.offAll(),this._infoPool.push(n))}t.length=0}this._loaderCount=0,_._resMap={}},e.cancelLoadByUrls=function(e){if(e)for(var t=0,i=e.length;t<i;t++)this.cancelLoadByUrl(e[t])},e.cancelLoadByUrl=function(e){for(var t=0;t<this._maxPriority;t++)for(var i=this._resInfos[t],n=i.length-1;-1<n;n--){var a=i[n];a&&a.url===e&&(i[n]=null,a.offAll(),this._infoPool.push(a))}_._resMap[e]&&delete _._resMap[e]},e._loadAssets=function(e,i,s,t,n,a,r){void 0===n&&(n=1),void 0===a&&(a=!0);for(var o=e.length,l=0,h=0,c=[],u=!0,d=0;d<o;d++){var _=e[d];"string"==typeof _&&(_={url:_,type:t,size:1,priority:n}),_.size||(_.size=1),_.progress=0,h+=_.size,c.push(_);var p=s?v.create(null,g,[_],!1):null,f=i||s?v.create(null,m,[_]):null;this.load(_.url,f,p,_.type,_.priority||1,a,_.group||r)}function m(e,t){l++,e.progress=1,t||(u=!1),l===o&&i&&i.runWith(u)}function g(e,t){if(null!=s){e.progress=t;for(var i=0,n=0;n<c.length;n++){var a=c[n];i+=a.size*a.progress}var r=i/h;s.runWith(r)}}return this},_.cacheRes=function(e,t){Ae.cacheRes(e,t)},_._resMap={},l(_,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),_.__init$=function(){function e(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,e.__super.call(this)}f(e,"",i),d=e},_}(),De=(function(){function a(e){a.__super.call(this),e=e||[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0],this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var t=0,i=0,n=0;n<20;n++)n%5!=4?this._mat[t++]=e[n]:this._alpha[i++]=e[n];this._action=L.createFilterAction(32),this._action.data=this}f(a,"laya.filters.ColorFilter",T);var e=a.prototype;x.imps(e,{"laya.filters.IFilter":!0}),e.callNative=function(e){e._$P.cf=this;e.conchModel&&e.conchModel.setFilterMatrix&&e.conchModel.setFilterMatrix(this._mat,this._alpha)},c(0,e,"type",function(){return 32}),c(0,e,"action",function(){return this._action})}(),function(){function n(e,t,i){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===t&&(t=0),n.__super.call(this),this._byteClass=i||J,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,e&&0<t&&t<65535&&this.connect(e,t)}f(n,"laya.net.Socket",i);var e=n.prototype;e.connect=function(e,t){var i="ws://"+e+":"+t;i="https:"==Q.window.location.protocol?"wss://"+e+":"+t:"ws://"+e+":"+t,this.connectByUrl(i)},e.connectByUrl=function(e){var t=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new Q.window.WebSocket(e,this.protocols):this._socket=new Q.window.WebSocket(e),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(e){t._onOpen(e)},this._socket.onmessage=function(e){t._onMessage(e)},this._socket.onclose=function(e){t._onClose(e)},this._socket.onerror=function(e){t._onError(e)}},e.cleanSocket=function(){try{this._socket.close()}catch(e){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},e.close=function(){if(null!=this._socket)try{this._socket.close()}catch(e){}},e._onOpen=function(e){this._connected=!0,this.event("open",e)},e._onMessage=function(e){if(e&&e.data){var t=e.data;if(this.disableInput&&t)this.event("message",t);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var i=this._input.pos;this._addInputPosition||(this._addInputPosition=0),this._input.pos=this._addInputPosition,t&&("string"==typeof t?this._input.writeUTFBytes(t):this._input.writeArrayBuffer(t),this._addInputPosition=this._input.pos,this._input.pos=i),this.event("message",t)}}},e._onClose=function(e){this._connected=!1,this.event("close",e)},e._onError=function(e){this.event("error",e)},e.send=function(e){this._socket.send(e)},e.flush=function(){if(this._output&&0<this._output.length){var t;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(e){t=e}this._output.endian=this.endian,this._output.clear(),t&&this.event("error",t)}},c(0,e,"input",function(){return this._input}),c(0,e,"output",function(){return this._output}),c(0,e,"connected",function(){return this._connected}),c(0,e,"endian",function(){return this._endian},function(e){this._endian=e,null!=this._input&&(this._input.endian=e),null!=this._output&&(this._output.endian=e)}),n.LITTLE_ENDIAN="littleEndian",n.BIG_ENDIAN="bigEndian"}(),function(){function a(){this.worker=null,a.__super.call(this);var t=this;this.worker=new Q.window.Worker(a.workerPath),this.worker.onmessage=function(e){t.workerMessage(e.data)}}f(a,"laya.net.WorkerLoader",i);var e=a.prototype;e.workerMessage=function(e){if(e)switch(e.type){case"Image":this.imageLoaded(e);break;case"Msg":this.event("image_msg",e.msg)}},e.imageLoaded=function(e){if(e&&e.buffer&&e.buffer.length<10)return a._enable=!1,this._myTrace("buffer lost when postmessage ,disable workerloader"),this.event(e.url,null),void this.event("image_err",e.url+"\n"+e.msg);if(!e.dataType)return this.event(e.url,null),void this.event("image_err",e.url+"\n"+e.msg);var t,i,n;switch(e.dataType){case"buffer":(n=(i=(t=new ze("2D")).source.getContext("2d")).createImageData(e.width,e.height)).data.set(e.buffer),t.size(n.width,n.height),i.putImageData(n,0,0),t.memorySize=0;break;case"imagedata":i=(t=new ze("2D")).source.getContext("2d"),n=e.imagedata,t.size(n.width,n.height),i.putImageData(n,0,0),n=e.imagedata,t.memorySize=0;break;case"imageBitmap":n=e.imageBitmap,X.isWebGL?t=n:(i=(t=new ze("2D")).source.getContext("2d"),t.size(n.width,n.height),i.drawImage(n,0,0),t.src=e.url)}X.isWebGL&&(t=new laya.webgl.resource.WebGLImage(t,e.url)),this.event(e.url,t)},e._myTrace=function(e){var t=arguments,i=[],n=0,a=t.length;for(n=0;n<a;n++)i.push(t[n]);this.event("image_msg",i.join(" "))},e.loadImage=function(e){var t;(t={type:"load"}).url=e,this.worker.postMessage(t)},e._loadImage=function(t){var i=this;if(!a._enable||t.toLowerCase().indexOf(".png")<0)a._preLoadFun.call(i,t);else{t=W.formatURL(t);var n=function(e){laya.net.WorkerLoader.I.off(t,i,n),e?i.onLoaded(e):a._preLoadFun.call(i,t)};laya.net.WorkerLoader.I.on(t,i,n),laya.net.WorkerLoader.I.loadImage(t)}},c(1,a,"enable",function(){return a._enable},function(e){a.disableJSDecode&&!Q.window.createImageBitmap||(a._enable=e)&&null==a._preLoadFun&&(a._enable=a.__init__())}),a.__init__=function(){return null==a._preLoadFun&&(!!Q.window.Worker&&(a._preLoadFun=Ae.prototype._loadImage,Ae.prototype._loadImage=a.prototype._loadImage,a.I||(a.I=new a),!0))},a.workerSupported=function(){return!!Q.window.Worker},a.IMAGE_LOADED="image_loaded",a.IMAGE_ERR="image_err",a.IMAGE_MSG="image_msg",a.I=null,a._preLoadFun=null,a._enable=!1,a.workerPath="libs/worker.js",a.disableJSDecode=!0}(),function(){function o(){o.__super.call(this),this._$1__id=++o._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(o._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,q.currentResourceManager&&q.currentResourceManager.addResource(this)}f(o,"laya.resource.Resource",i);var e=o.prototype;return x.imps(e,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),e._setUrl=function(e){var t;this._url!==e&&(this._url&&((t=o._urlResourcesMap[this._url]).splice(t.indexOf(this),1),0===t.length&&delete o._urlResourcesMap[this._url]),e&&((t=o._urlResourcesMap[e])||(o._urlResourcesMap[e]=t=[]),t.push(this)),this._url=e)},e._getGroup=function(){return this._group},e._setGroup=function(e){var t;this._group!==e&&(this._group&&((t=o._groupResourcesMap[this._group]).splice(t.indexOf(this),1),0===t.length&&delete o._groupResourcesMap[this._group]),e&&((t=o._groupResourcesMap[e])||(o._groupResourcesMap[e]=t=[]),t.push(this)),this._group=e)},e._addReference=function(){this._referenceCount++},e._removeReference=function(){this._referenceCount--},e._clearReference=function(){this._referenceCount=0},e._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},e.recreateResource=function(){this.completeCreate()},e.disposeResource=function(){},e.activeResource=function(e){void 0===e&&(e=!1),this._lastUseFrameCount=pe.loopCount,!this._destroyed&&this.__loaded&&(this._released||e)&&this.recreateResource()},e.releaseResource=function(e){return void 0===e&&(e=!1),!(!e&&this.lock)&&(!(this._released&&!e)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},e.onAsynLoaded=function(e,t,i){throw new Error("Resource: must override this function!")},e.destroy=function(){var e;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete o._idResourcesMap[this.id],this._url&&((e=o._urlResourcesMap[this._url])&&(e.splice(e.indexOf(this),1),0===e.length&&delete o._urlResourcesMap[this.url]),Ae.clearRes(this._url),this.__loaded||L.cancelLoadByUrl(this._url)),this._group&&((e=o._groupResourcesMap[this._group]).splice(e.indexOf(this),1),0===e.length&&delete o._groupResourcesMap[this.url]))},e.completeCreate=function(){this._released=!1,this.event("recovered",this)},e.dispose=function(){this.destroy()},c(0,e,"memorySize",function(){return this._memorySize},function(e){var t=e-this._memorySize;this._memorySize=e,this.resourceManager&&this.resourceManager.addSize(t)}),c(0,e,"_loaded",null,function(e){this.__loaded=e}),c(0,e,"loaded",function(){return this.__loaded}),c(0,e,"id",function(){return this._$1__id}),c(0,e,"destroyed",function(){return this._destroyed}),c(0,e,"group",function(){return this._getGroup()},function(e){this._setGroup(e)}),c(0,e,"resourceManager",function(){return this._resourceManager}),c(0,e,"url",function(){return this._url}),c(0,e,"released",function(){return this._released}),c(0,e,"referenceCount",function(){return this._referenceCount}),o.getResourceByID=function(e){return o._idResourcesMap[e]},o.getResourceByURL=function(e,t){return void 0===t&&(t=0),o._urlResourcesMap[e][t]},o.getResourceCountByURL=function(e){return o._urlResourcesMap[e].length},o.destroyUnusedResources=function(e){var t;if(e){var i=o._groupResourcesMap[e];if(i)for(var n=i.slice(),a=0,r=n.length;a<r;a++)(t=n[a]).lock||0!==t._referenceCount||t.destroy()}else for(var s in o._idResourcesMap)(t=o._idResourcesMap[s]).lock||0!==t._referenceCount||t.destroy()},o._uniqueIDCounter=0,o._idResourcesMap={},o._urlResourcesMap={},o._groupResourcesMap={},o}()),Pe=function(){function M(e,t){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,M.__super.call(this),e&&null!=e._addReference&&e._addReference(),this.setTo(e,t)}f(M,"laya.resource.Texture",i);var e=M.prototype;return e._setUrl=function(e){this.url=e},e.setTo=function(e,t){if(e instanceof r.HTMLElement){var i=ze.create("2D",e);this.bitmap=i}else this.bitmap=e;if(this.uv=t||M.DEF_UV,e){this._w=e.width,this._h=e.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var n=this;if(this._loaded)L.addToAtlas&&L.addToAtlas(n);else{var a=e;a instanceof laya.resource.HTMLImage&&a.image&&a.image.addEventListener("load",function(e){L.addToAtlas&&L.addToAtlas(n)},!1)}}},e.active=function(){this.bitmap&&this.bitmap.activeResource()},e.destroy=function(e){if(void 0===e&&(e=!1),this.bitmap&&0<this.bitmap.referenceCount){var t=this.bitmap;e?(X.isConchApp&&t.source&&t.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,t.dispose(),t._clearReference()):(t._removeReference(),0==t.referenceCount&&(X.isConchApp&&t.source&&t.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,t.dispose())),this.url&&this===x.loader.getRes(this.url)&&x.loader.clearRes(this.url,e),this._loaded=!1}},e.load=function(e){var t=this;this._loaded=!1,e=W.customFormat(e);var i=this.bitmap||(this.bitmap=Ye.create(e));i&&i._addReference();var n=this;i.onload=function(){i.onload=null,n._loaded=!0,t.sourceWidth=t._w=i.width,t.sourceHeight=t._h=i.height,n.event("loaded",this),L.addToAtlas&&L.addToAtlas(n)}},e.addTextureToAtlas=function(e){L.addTextureToAtlas(this)},e.getPixels=function(e,t,i,n){if(X.isConchApp){var a=this.bitmap;if(a.source&&a.source.getImageData){var r=a.source.getImageData(e,t,i,n),s=new Uint8Array(r);return Array.from(s)}return null}return X.isWebGL?L.getTexturePixels(this,e,t,i,n):(Q.canvas.size(i,n),Q.canvas.clear(),Q.context.drawTexture(this,-e,-t,this.width,this.height,0,0),Q.context.getImageData(0,0,i,n).data)},e.onAsynLoaded=function(e,t){t&&t._addReference(),this.setTo(t,this.uv)},c(0,e,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),c(0,e,"loaded",function(){return this._loaded}),c(0,e,"released",function(){return!this.bitmap||this.bitmap.released}),c(0,e,"width",function(){return this._w?this._w:this.uv&&this.uv!==M.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(e){this._w=e,this.sourceWidth||(this.sourceWidth=e)}),c(0,e,"repeat",function(){return!X.isWebGL||!this.bitmap||this.bitmap.repeat},function(e){e&&X.isWebGL&&this.bitmap&&(this.bitmap.repeat=e)&&(this.bitmap.enableMerageInAtlas=!1)}),c(0,e,"height",function(){return this._h?this._h:this.uv&&this.uv!==M.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(e){this._h=e,this.sourceHeight||(this.sourceHeight=e)}),c(0,e,"isLinearSampling",function(){return!X.isWebGL||9728!=this.bitmap.minFifter},function(e){!e&&X.isWebGL&&(e||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),M.moveUV=function(e,t,i){for(var n=0;n<8;n+=2)i[n]+=e,i[n+1]+=t;return i},M.create=function(e,t,i,n,a,r,s,o,l){void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===l&&(l=0);var h=e instanceof laya.resource.Texture,c=h?e.uv:M.DEF_UV,u=h?e.bitmap:e,d=L.isAtlas(u);if(d){var _=u._atlaser,p=e._atlasID;if(-1==p)throw new Error("create texture error");u=_._inAtlasTextureBitmapValue[p],c=_._inAtlasTextureOriUVValue[p]}var f=new M(u,null);u.width&&t+n>u.width&&(n=u.width-t),u.height&&i+a>u.height&&(a=u.height-i),f.width=n,f.height=a,f.offsetX=r,f.offsetY=s,f.sourceWidth=o||n,f.sourceHeight=l||a;var m=1/u.width,g=1/u.height;t*=m,i*=g,n*=m,a*=g;var v=f.uv[0],y=f.uv[1],C=f.uv[4],E=f.uv[5],S=C-v,x=E-y,T=M.moveUV(c[0],c[1],[t,i,t+n,i,t+n,i+a,t,i+a]);f.uv=[v+T[0]*S,y+T[1]*x,C-(1-T[2])*S,y+T[3]*x,C-(1-T[4])*S,E-(1-T[5])*x,v+T[6]*S,E-(1-T[7])*x],d&&f.addTextureToAtlas();var w=u.scaleRate;return w&&1!=w?(f.sourceWidth/=w,f.sourceHeight/=w,f.width/=w,f.height/=w,f.scaleRate=w,f.offsetX/=w,f.offsetY/=w):f.scaleRate=1,f},M.createFromTexture=function(e,t,i,n,a){var r=e.scaleRate;1!=r&&(t*=r,i*=r,n*=r,a*=r);var s=k.TEMP.setTo(t-e.offsetX,i-e.offsetY,n,a),o=s.intersection(M._rect1.setTo(0,0,e.width,e.height),M._rect2);if(!o)return null;var l=M.create(e,o.x,o.y,o.width,o.height,o.x-s.x,o.y-s.y,n,a);return l.bitmap._removeReference(),l},M.DEF_UV=[0,0,1,0,1,1,0,1],M.INV_UV=[0,1,1,1,1,0,0,0],M._rect1=new k,M._rect2=new k,M}(),Ne=function(){var o;function r(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,r.__super.call(this)}f(r,"laya.utils.TimeLine",i);var e=r.prototype;return e.to=function(e,t,i,n,a){return void 0===a&&(a=0),this._create(e,t,i,n,a,!0)},e.from=function(e,t,i,n,a){return void 0===a&&(a=0),this._create(e,t,i,n,a,!1)},e._create=function(e,t,i,n,a,r){var s=de.getItemByClass("tweenData",o);return s.isTo=r,s.type=0,s.target=e,s.duration=i,s.data=t,s.startTime=this._startTime+a,s.endTime=s.startTime+s.duration,s.ease=n,this._startTime=Math.max(s.endTime,this._startTime),this._tweenDataList.push(s),this._startTimeSort=!0,this._endTimeSort=!0,this},e.addLabel=function(e,t){var i=de.getItemByClass("tweenData",o);return i.type=1,i.data=e,i.endTime=i.startTime=this._startTime+t,this._labelDic||(this._labelDic={}),this._labelDic[e]=i,this._tweenDataList.push(i),this},e.removeLabel=function(e){if(this._labelDic&&this._labelDic[e]){var t=this._labelDic[e];if(t){var i=this._tweenDataList.indexOf(t);-1<i&&this._tweenDataList.splice(i,1)}delete this._labelDic[e]}},e.gotoTime=function(e){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var t,i,n,a;for(var r in this._firstTweenDic)if(i=this._firstTweenDic[r])for(var s in i)i.diyTarget.hasOwnProperty(s)&&(i.diyTarget[s]=i[s]);for(r in this._tweenDic)(t=this._tweenDic[r]).clear(),delete this._tweenDic[r];if(this._index=0,this._gidIndex=0,this._currTime=e,this._lastTime=Q.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=n=this._tweenDataList.concat(),n.sort(function(e,t){return e.endTime>t.endTime?1:e.endTime<t.endTime?-1:0})}else n=this._endTweenDataList;for(var o=0,l=n.length;o<l;o++)if(0==(a=n[o]).type){if(!(e>=a.endTime))break;this._index=Math.max(this._index,o+1);var h=a.data;if(a.isTo)for(var c in h)a.target[c]=h[c]}for(o=0,l=this._tweenDataList.length;o<l;o++)0==(a=this._tweenDataList[o]).type&&e>=a.startTime&&e<a.endTime&&(this._index=Math.max(this._index,o+1),this._gidIndex++,(t=de.getItemByClass("tween",ge))._create(a.target,a.data,a.duration,a.ease,v.create(this,this._animComplete,[this._gidIndex]),0,!1,a.isTo,!0,!1),t.setStartTime(this._currTime-(e-a.startTime)),t._updateEase(this._currTime),t.gid=this._gidIndex,this._tweenDic[this._gidIndex]=t)}},e.gotoLabel=function(e){if(null!=this._labelDic){var t=this._labelDic[e];t&&this.gotoTime(t.startTime)}},e.pause=function(){x.timer.clear(this,this._update)},e.resume=function(){this.play(this._currTime,this._loopKey)},e.play=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(e,t){return e.startTime>t.startTime?1:e.startTime<t.startTime?-1:0});for(var i=0,n=this._tweenDataList.length;i<n;i++){var a=this._tweenDataList[i];if(null!=a&&0==a.type){var r=a.target,s=r.$_GID||(r.$_GID=ve.getGID()),o=null;for(var l in null==this._firstTweenDic[s]?((o={}).diyTarget=r,this._firstTweenDic[s]=o):o=this._firstTweenDic[s],a.data)null==o[l]&&(o[l]=r[l])}}}"string"==typeof e?this.gotoLabel(e):this.gotoTime(e),this._loopKey=t,this._lastTime=Q.now(),x.timer.frameLoop(1,this,this._update)}},e._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var e in this._tweenDic)(t=this._tweenDic[e]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var t,i=Q.now(),n=i-this._lastTime,a=this._currTime+=n*this.scale;for(e in this._lastTime=i,this._tweenDic)(t=this._tweenDic[e])._updateEase(a);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var r=this._tweenDataList[this._index];a>=r.startTime&&(this._index++,0==r.type?(this._gidIndex++,(t=de.getItemByClass("tween",ge))._create(r.target,r.data,r.duration,r.ease,v.create(this,this._animComplete,[this._gidIndex]),0,!1,r.isTo,!0,!1),t.setStartTime(a),t.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=t)._updateEase(a)):this.event("label",r.data))}},e._animComplete=function(e){this._tweenDic[e]&&delete this._tweenDic[e]},e._complete=function(){this.event("complete")},e.reset=function(){var e;if(this._labelDic)for(e in this._labelDic)delete this._labelDic[e];for(e in this._tweenDic)this._tweenDic[e].clear(),delete this._tweenDic[e];for(e in this._firstTweenDic)delete this._firstTweenDic[e];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var t,i=0;for(t=this._tweenDataList.length,i=0;i<t;i++)this._tweenDataList[i]&&this._tweenDataList[i].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,x.timer.clear(this,this._update)},e.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},c(0,e,"index",function(){return this._frameIndex},function(e){this._frameIndex=e,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),c(0,e,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),r.to=function(e,t,i,n,a){return void 0===a&&(a=0),(new r).to(e,t,i,n,a)},r.from=function(e,t,i,n,a){return void 0===a&&(a=0),(new r).from(e,t,i,n,a)},r.__init$=function(){function e(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}f(e,""),e.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,de.recover("tweenData",this)},o=e},r}(),Oe=function(a){function i(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,i.__super.call(this),this._style=o.EMPTY}f(i,"laya.display.Sprite",a);var e=i.prototype;return x.imps(e,{"laya.display.ILayout":!0}),e.createConchModel=function(){return new ConchNode},e.destroy=function(e){void 0===e&&(e=!0),this._releaseMem(),a.prototype.destroy.call(this,e),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},e.updateZOrder=function(){ve.updateOrder(this._childs)&&this.repaint()},e.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},e.setBounds=function(e){this._set$P("uBounds",e)},e.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new k),k._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},e.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new k),k._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},e._boundPointsToParent=function(e){void 0===e&&(e=!1);var t=0,i=0;this._style&&(t=this._style._tf.translateX,i=this._style._tf.translateY,e=e||0!==this._style._tf.rotate,this._style.scrollRect&&(t+=this._style.scrollRect.x,i+=this._style.scrollRect.y));var n=this._getBoundPointsM(e);if(!n||n.length<1)return n;if(8!=n.length&&(n=e?A.scanPList(n):k._getWrapRec(n,k.TEMP)._getBoundPoints()),!this.transform)return ve.transPointList(n,this._x-t,this._y-i),n;var a=O.TEMP,r=0,s=n.length;for(r=0;r<s;r+=2)a.x=n[r],a.y=n[r+1],this.toParentPoint(a),n[r]=a.x,n[r+1]=a.y;return n},e.getGraphicBounds=function(e){return void 0===e&&(e=!1),this._graphics?this._graphics.getBounds(e):k.TEMP.setTo(0,0,0,0)},e._getBoundPointsM=function(e){if(void 0===e&&(e=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var t=ve.clearArray(this._$P.temBM),i=k.TEMP;return i.copyFrom(this.scrollRect),ve.concatArray(t,i._getBoundPoints()),t}for(var n,a,r,s=this._graphics?this._graphics.getBoundPoints():ve.clearArray(this._$P.temBM),o=0,l=(r=this._childs).length;o<l;o++)(n=r[o])instanceof laya.display.Sprite&&1==n.visible&&(a=n._boundPointsToParent(e))&&(s=s?ve.concatArray(s,a):a);return s},e.getStyle=function(){return this._style===o.EMPTY&&(this._style=new o),this._style},e.setStyle=function(e){this._style=e},e._adjustTransform=function(){this._tfChanged=!1;var e,t=this._style._tf,i=t.scaleX,n=t.scaleY;if(t.rotate||1!==i||1!==n||t.skewX||t.skewY){(e=this._transform||(this._transform=N.create())).bTransform=!0;var a=.0174532922222222*(t.rotate-t.skewX),r=.0174532922222222*(t.rotate+t.skewY),s=Math.cos(r),o=Math.sin(r),l=Math.sin(a),h=Math.cos(a);return e.a=i*s,e.b=i*o,e.c=-n*l,e.d=n*h,e.tx=e.ty=0,e}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,e},e.pos=function(e,t,i){if(void 0===i&&(i=!1),this._x!==e||this._y!==t){if(this.destroyed)return this;if(i){this._x=e,this._y=t,this.conchModel&&this.conchModel.pos(this._x,this._y);var n=this._parent;n&&0===n._repaint&&(n._repaint=1,n.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=e,this.y=t}return this},e.pivot=function(e,t){return this.pivotX=e,this.pivotY=t,this},e.size=function(e,t){return this.width=e,this.height=t,this},e.scale=function(e,t,i){void 0===i&&(i=!1);var n=this.getStyle(),a=n._tf;if(a.scaleX!=e||a.scaleY!=t){if(this.destroyed)return this;if(i){n.setScale(e,t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(e,t),this._renderType|=4;var r=this._parent;r&&0===r._repaint&&(r._repaint=1,r.parentRepaint())}else this.scaleX=e,this.scaleY=t}return this},e.skew=function(e,t){return this.skewX=e,this.skewY=t,this},e.render=function(e,t,i){pe.spriteCount++,Y.renders[this._renderType]._fun(this,e,t+this._x,i+this._y),this._repaint=0},e.drawToCanvas=function(e,t,i,n){if(X.isConchNode){var a=ze.create("2D");return new j(e,t,a).ctx.setCanvasType(1),this.conchModel.drawToCanvas(a.source,i,n),a}return L.drawToCanvas(this,this._renderType,e,t,i,n)},e.customRender=function(e,t,i){this._renderType|=1024},e._applyFilters=function(){var e;if(!X.isWebGL&&((e=this._$P.filters)&&!(e.length<1)))for(var t=0,i=e.length;t<i;t++)e[t].action.apply(this._$P.cacheCanvas)},e._isHaveGlowFilter=function(){var e,t=0;if(this.filters)for(t=0;t<this.filters.length;t++)if(8==this.filters[t].type)return!0;for(t=0,e=this._childs.length;t<e;t++)if(this._childs[t]._isHaveGlowFilter())return!0;return!1},e.localToGlobal=function(e,t){void 0===t&&(t=!1),!0===t&&(e=new O(e.x,e.y));for(var i=this;i&&i!=x.stage;)e=i.toParentPoint(e),i=i.parent;return e},e.globalToLocal=function(e,t){void 0===t&&(t=!1),t&&(e=new O(e.x,e.y));for(var i=this,n=[];i&&i!=x.stage;)n.push(i),i=i.parent;for(var a=n.length-1;0<=a;)e=(i=n[a]).fromParentPoint(e),a--;return e},e.toParentPoint=function(e){if(!e)return e;e.x-=this.pivotX,e.y-=this.pivotY,this.transform&&this._transform.transformPoint(e),e.x+=this._x,e.y+=this._y;var t=this._style.scrollRect;return t&&(e.x-=t.x,e.y-=t.y),e},e.fromParentPoint=function(e){if(!e)return e;e.x-=this._x,e.y-=this._y;var t=this._style.scrollRect;return t&&(e.x+=t.x,e.y+=t.y),this.transform&&this._transform.invertTransformPoint(e),e.x+=this.pivotX,e.y+=this.pivotY,e},e.on=function(e,t,i,n){return 1!==this._mouseEnableState&&this.isMouseEvent(e)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(e,t,i,n,!1)):a.prototype.on.call(this,e,t,i,n)},e.once=function(e,t,i,n){return 1!==this._mouseEnableState&&this.isMouseEvent(e)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(e,t,i,n,!0)):a.prototype.once.call(this,e,t,i,n)},e._$2__onDisplay=function(){if(1!==this._mouseEnableState){var e=this;for(e=e.parent;e&&1!==e._mouseEnableState&&!e._getBit(2);)e.mouseEnabled=!0,e._setBit(2,!0),e=e.parent}},e.loadImage=function(e,t,i,n,a,r){var s=this;return void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===a&&(a=0),this.graphics.loadImage(e,t,i,n,a,function(e){s.destroyed||(s.size(t+(n||e.width),i+(a||e.height)),s.repaint(),r&&r.runWith(e))}),this},e.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},e._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},e._childChanged=function(e){this._childs.length?this._renderType|=2048:this._renderType&=-2049,e&&this._get$P("hasZorder")&&x.timer.callLater(this,this.updateZOrder),this.repaint()},e.parentRepaint=function(){var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint())},e.startDrag=function(e,t,i,n,a,r,s){void 0===t&&(t=!1),void 0===i&&(i=0),void 0===n&&(n=300),void 0===r&&(r=!1),void 0===s&&(s=.92),this._$P.dragging||this._set$P("dragging",new se),this._$P.dragging.start(this,e,t,i,n,a,r,s)},e.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},e._releaseMem=function(){if(this._$P){var e=this._$P.cacheCanvas;e&&e.ctx&&(de.recover("RenderContext",e.ctx),e.ctx.canvas.size(0,0),e.ctx=null);var t=this._$P._filterCache;t&&(t.destroy(),t.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},e._setDisplay=function(e){e||this._releaseMem(),a.prototype._setDisplay.call(this,e)},e.hitTestPoint=function(e,t){var i=this.globalToLocal(O.TEMP.setTo(e,t));return e=i.x,t=i.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?k.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(e,t)},e.getMousePoint=function(){return this.globalToLocal(O.TEMP.setTo(x.stage.mouseX,x.stage.mouseY))},e._getWords=function(){return null},e._addChildsToLayout=function(n){var e=this._getWords();if(null==e&&0==this._childs.length)return!1;if(e)for(var t=0,i=e.length;t<i;t++)n.push(e[t]);return this._childs.forEach(function(e,t,i){e._style._enableLayout()&&e._addToLayout(n)}),!0},e._addToLayout=function(e){this._style.absolute||(this._style.block?e.push(this):this._addChildsToLayout(e)&&(this.x=this.y=0))},e._isChar=function(){return!1},e._getCSSStyle=function(){return this._style.getCSSStyle()},e._setAttributes=function(e,t){switch(e){case"x":this.x=parseFloat(t);break;case"y":this.y=parseFloat(t);break;case"width":this.width=parseFloat(t);break;case"height":this.height=parseFloat(t);break;default:this[e]=t}},e._layoutLater=function(){this.parent&&this.parent._layoutLater()},c(0,e,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(e){this._optimizeScrollRect!=e&&(this._optimizeScrollRect=e,this.conchModel&&this.conchModel.optimizeScrollRect(e))}),c(0,e,"customRenderEnable",null,function(e){if(e&&(this._renderType|=1024,X.isConchNode)){i.CustomList.push(this);var t=new ze("2d");t._setContext(new CanvasRenderingContext2D),this.customContext=new j(0,0,t),t.context.setCanvasType&&t.context.setCanvasType(2),this.conchModel.custom(t.context)}}),c(0,e,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(e){this.cacheAs=e?this._$P.hasFilter?"none":"normal":"none"}),c(0,e,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(e){var t=this._$P.cacheCanvas;if(e!==(t?t.type:"none")){if("none"!==e)this._getBit(1)||this._setUpNoticeType(1),(t=t||this._set$P("cacheCanvas",de.getItemByClass("cacheCanvas",Object))).type=e,t.reCache=!0,this._renderType|=16,"bitmap"==e&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(t){var i=t;i&&i.ctx&&(de.recover("RenderContext",i.ctx),i.ctx.canvas.size(0,0),i.ctx=null),de.recover("cacheCanvas",t)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),c(0,e,"zOrder",function(){return this._zOrder},function(e){this._zOrder!=e&&(this._zOrder=e,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(e),this._parent&&(e&&this._parent._set$P("hasZorder",!0),x.timer.callLater(this._parent,this.updateZOrder)))}),c(0,e,"rotation",function(){return this._style._tf.rotate},function(e){var t=this.getStyle();if(t._tf.rotate!==e){t.setRotate(e),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(e),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),c(0,e,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(e){this._width!==e&&(this._width=e,this.conchModel&&this.conchModel.size(e,this._height),this.repaint())}),c(0,e,"x",function(){return this._x},function(e){if(this._x!==e){if(this.destroyed)return;this._x=e,this.conchModel&&this.conchModel.pos(e,this._y);var t=this._parent;t&&0===t._repaint&&(t._repaint=1,t.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),c(0,e,"globalScaleY",function(){for(var e=1,t=this;t&&t!==x.stage;)e*=t.scaleY,t=t.parent;return e}),c(0,e,"hitArea",function(){return this._$P.hitArea},function(e){this._set$P("hitArea",e)}),c(0,e,"staticCache",function(){return this._$P.staticCache},function(e){this._set$P("staticCache",e),e||this.reCache()}),c(0,e,"texture",function(){return this._texture},function(e){this._texture!=e&&(this._texture=e,this.graphics.cleanByTexture(e,0,0))}),c(0,e,"y",function(){return this._y},function(e){if(this._y!==e){if(this.destroyed)return;this._y=e,this.conchModel&&this.conchModel.pos(this._x,e);var t=this._parent;t&&0===t._repaint&&(t._repaint=1,t.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),c(0,e,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(e){this._height!==e&&(this._height=e,this.conchModel&&this.conchModel.size(this._width,e),this.repaint())}),c(0,e,"blendMode",function(){return this._style.blendMode},function(e){this.getStyle().blendMode=e,this.conchModel&&this.conchModel.blendMode(e),e&&"source-over"!=e?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),c(0,e,"scaleX",function(){return this._style._tf.scaleX},function(e){var t=this.getStyle();if(t._tf.scaleX!==e){t.setScaleX(e),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(e,t._tf.scaleY),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),c(0,e,"scaleY",function(){return this._style._tf.scaleY},function(e){var t=this.getStyle();if(t._tf.scaleY!==e){t.setScaleY(e),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(t._tf.scaleX,e),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),c(0,e,"stage",function(){return x.stage}),c(0,e,"skewX",function(){return this._style._tf.skewX},function(e){var t=this.getStyle();if(t._tf.skewX!==e){t.setSkewX(e),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(e,t._tf.skewY),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),c(0,e,"scrollRect",function(){return this._style.scrollRect},function(e){this.getStyle().scrollRect=e,this.repaint(),e?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(e.x,e.y,e.width,e.height)):(this._renderType&=-129,this.conchModel&&(i.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),c(0,e,"skewY",function(){return this._style._tf.skewY},function(e){var t=this.getStyle();if(t._tf.skewY!==e){t.setSkewY(e),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(t._tf.skewX,e),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),c(0,e,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(e){this._tfChanged=!1,(this._transform=e)&&(this._x=e.tx,this._y=e.ty,e.tx=e.ty=0,this.conchModel&&this.conchModel.transform(e.a,e.b,e.c,e.d,this._x,this._y)),e?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),c(0,e,"pivotX",function(){return this._style._tf.translateX},function(e){this.getStyle().setTranslateX(e),this.conchModel&&this.conchModel.pivot(e,this._style._tf.translateY),this.repaint()}),c(0,e,"pivotY",function(){return this._style._tf.translateY},function(e){this.getStyle().setTranslateY(e),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,e),this.repaint()}),c(0,e,"alpha",function(){return this._style.alpha},function(e){this._style&&this._style.alpha!==e&&(e=e<0?0:1<e?1:e,this.getStyle().alpha=e,this.conchModel&&this.conchModel.alpha(e),1!==e?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),c(0,e,"visible",function(){return this._style.visible},function(e){this._style&&this._style.visible!==e&&(this.getStyle().visible=e,this.conchModel&&this.conchModel.visible(e),this.parentRepaint())}),c(0,e,"graphics",function(){return this._graphics||(this.graphics=L.createGraphics())},function(e){this._graphics&&(this._graphics._sp=null),(this._graphics=e)?(this._renderType&=-2,this._renderType|=512,(e._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(i.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),c(0,e,"filters",function(){return this._$P.filters},function(e){e&&0===e.length&&(e=null),this._$P.filters!=e&&(this._set$P("filters",e?e.slice():null),X.isConchApp&&(this.conchModel&&(i.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),X.isWebGL&&(e&&e.length?this._renderType|=32:this._renderType&=-33),e&&0<e.length?(this._getBit(1)||this._setUpNoticeType(1),X.isWebGL&&1==e.length&&e[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(X.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),c(0,e,"parent",a.prototype._$get_parent,function(e){x.superSet(xe,this,"parent",e),e&&this._getBit(2)&&this._$2__onDisplay()}),c(0,e,"mask",function(){return this._$P._mask},function(e){e&&this.mask&&this.mask._$P.maskParent||(e?(this.cacheAs="bitmap",this._set$P("_mask",e),e._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",e),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(e?e.conchModel:null),this._renderType|=64,this.parentRepaint())}),c(0,e,"mouseEnabled",function(){return 1<this._mouseEnableState},function(e){this._mouseEnableState=e?2:1}),c(0,e,"globalScaleX",function(){for(var e=1,t=this;t&&t!==x.stage;)e*=t.scaleX,t=t.parent;return e}),c(0,e,"mouseX",function(){return this.getMousePoint().x}),c(0,e,"mouseY",function(){return this.getMousePoint().y}),i.fromImage=function(e){return(new i).loadImage(e)},i.CustomList=[],l(i,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=r.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),i}(xe),ke=function(){function t(e){this._audio=null,this._onEnd=null,this._resumePlay=null,t.__super.call(this),this._onEnd=ve.bind(this.__onEnd,this),this._resumePlay=ve.bind(this.__resumePlay,this),e.addEventListener("ended",this._onEnd),this._audio=e}f(t,"laya.media.h5audio.AudioSoundChannel",Me);var e=t.prototype;return e.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(x.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},e.__resumePlay=function(){if(this._audio&&this._audio.removeEventListener("canplay",this._resumePlay),!this.isStopped)try{this._audio.currentTime=this.startTime,Q.container.appendChild(this._audio),this._audio.play()}catch(e){this.event("error")}},e.play=function(){if(this.isStopped=!1,this._audio){try{this._audio.playbackRate=V.playbackRate,this._audio.currentTime=this.startTime}catch(e){return void this._audio.addEventListener("canplay",this._resumePlay)}V.addChannel(this),Q.container.appendChild(this._audio),"play"in this._audio&&this._audio.play()}},e.stop=function(){this.isStopped=!0,V.removeChannel(this),this.completeHandler=null,this._audio&&("pause"in this._audio&&X.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),Q.onIE||this._audio!=we._musicAudio&&de.recover("audio:"+this.url,this._audio),Q.removeElement(this._audio),this._audio=null)},e.pause=function(){this.isStopped=!0,V.removeChannel(this),"pause"in this._audio&&this._audio.pause()},e.resume=function(){this._audio&&(this.isStopped=!1,V.addChannel(this),"play"in this._audio&&this._audio.play())},c(0,e,"position",function(){return this._audio?this._audio.currentTime:0}),c(0,e,"duration",function(){return this._audio?this._audio.duration:0}),c(0,e,"volume",function(){return this._audio?this._audio.volume:1},function(e){this._audio&&(this._audio.volume=e)}),t}(),Ve=function(){function t(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=Re.ctx,t.__super.call(this),this._onPlayEnd=ve.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}f(t,"laya.media.webaudio.WebAudioSoundChannel",Me);var e=t.prototype;return e.play=function(){if(V.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var e=this.context,t=this.gain,i=e.createBufferSource();(this.bufferSource=i).buffer=this.audioBuffer,i.connect(t),t&&t.disconnect(),t.connect(e.destination),i.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=Q.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.001):this.gain.gain.value=this._volume,0==this.loops&&(i.loop=!0),i.playbackRate.setTargetAtTime?i.playbackRate.setTargetAtTime(V.playbackRate,this.context.currentTime,.001):i.playbackRate.value=V.playbackRate,i.start(0,this.startTime),this._currentTime=0}},e.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(x.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},e._clearBufferSource=function(){if(this.bufferSource){var e=this.bufferSource;e.stop?e.stop(0):e.noteOff(0),e.disconnect(0),e.onended=null,t._tryCleanFailed||this._tryClearBuffer(e),this.bufferSource=null}},e._tryClearBuffer=function(e){if(Q.onMac)try{e.buffer=Re._miniBuffer}catch(e){t._tryCleanFailed=!0}else try{e.buffer=null}catch(e){t._tryCleanFailed=!0}},e.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,V.removeChannel(this),this.completeHandler=null,V.autoReleaseSound&&x.timer.once(5e3,null,V.disposeSoundIfNotUsed,[this.url],!1)},e.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,V.removeChannel(this),V.autoReleaseSound&&x.timer.once(5e3,null,V.disposeSoundIfNotUsed,[this.url],!1)},e.resume=function(){this.startTime=this._pauseTime,this.play()},c(0,e,"position",function(){return this.bufferSource?(Q.now()-this._startTime)/1e3+this.startTime:0}),c(0,e,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),c(0,e,"volume",function(){return this._volume},function(e){this.isStopped||(this._volume=e,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(e,this.context.currentTime,.001):this.gain.gain.value=e)}),t._tryCleanFailed=!1,t.SetTargetDelay=.001,t}(),Be=function(){function e(){e.__super.call(this),this._w=0,this._h=0}f(e,"laya.resource.Bitmap",De);var t=e.prototype;return c(0,t,"width",function(){return this._w}),c(0,t,"height",function(){return this._h}),c(0,t,"source",function(){return this._source}),e}(),Fe=function(t){function e(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,e.__super.call(this),this._interval=n.animationInterval,this._setUpNoticeType(1)}f(e,"laya.display.AnimationPlayerBase",t);var i=e.prototype;return i.play=function(e,t,i,n){void 0===e&&(e=0),void 0===t&&(t=!0),void 0===i&&(i=""),void 0===n&&(n=!0),this._isPlaying=!0,this.index="string"==typeof e?this._getFrameByLabel(e):e,this.loop=t,this._actionName=i,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},i._getFrameByLabel=function(e){var t=0;for(t=0;t<this._count;t++)if(this._labels[t]&&0<=this._labels[t].indexOf(e))return t;return 0},i._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},i._setControlNode=function(e){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=e)&&e!=this&&(e.on("display",this,this._checkResumePlaying),e.on("undisplay",this,this._checkResumePlaying))},i._setDisplay=function(e){t.prototype._setDisplay.call(this,e),this._checkResumePlaying()},i._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},i.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},i.addLabel=function(e,t){this._labels||(this._labels={}),this._labels[t]||(this._labels[t]=[]),this._labels[t].push(e)},i.removeLabel=function(e){if(e){if(this._labels)for(var t in this._labels)this._removeLabelFromLabelList(this._labels[t],e)}else this._labels=null},i._removeLabelFromLabelList=function(e,t){if(e)for(var i=e.length-1;0<=i;i--)e[i]==t&&e.splice(i,1)},i.gotoAndStop=function(e){this.index="string"==typeof e?this._getFrameByLabel(e):e,this.stop()},i._displayToIndex=function(e){},i.clear=function(){this.stop(),this._labels=null},c(0,i,"interval",function(){return this._interval},function(e){this._interval!=e&&(this._frameRateChanged=!0,this._interval=e,this._isPlaying&&0<e&&this.timerLoop(e,this,this._frameLoop,null,!0,!0))}),c(0,i,"isPlaying",function(){return this._isPlaying}),c(0,i,"index",function(){return this._index},function(e){if(this._index=e,this._displayToIndex(e),this._labels&&this._labels[e])for(var t=this._labels[e],i=0,n=t.length;i<n;i++)this.event("label",t[i])}),c(0,i,"count",function(){return this._count}),e.WRAP_POSITIVE=0,e.WRAP_REVERSE=1,e.WRAP_PINGPONG=2,e}(Oe),He=function(t){function _(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,_.__super.call(this),this.overflow=_.VISIBLE,this._style=new Te(this),this._style.wordWrap=!1}f(_,"laya.display.Text",t);var e=_.prototype;return e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._lines=null,this._words&&(this._words.length=0,this._words=null)},e._getBoundPointsM=function(e){void 0===e&&(e=!1);var t=k.TEMP;return t.setTo(0,0,this.width,this.height),t._getBoundPoints()},e.getGraphicBounds=function(e){void 0===e&&(e=!1);var t=k.TEMP;return t.setTo(0,0,this.width,this.height),t},e._getCSSStyle=function(){return this._style},e.lang=function(e,t,i,n,a,r,s,o,l,h,c){if(e=_.langPacks&&_.langPacks[e]?_.langPacks[e]:e,arguments.length<2)this._text=e;else{for(var u=0,d=arguments.length;u<d;u++)e=e.replace("{"+u+"}",arguments[u+1]);this._text=e}},e._isPassWordMode=function(){var e=this._style.password;return"prompt"in this&&this.prompt==this._text&&(e=!1),e},e._getPassWordTxt=function(e){var t;t="";for(var i=e.length;0<i;i--)t+="●";return t},e.renderText=function(e,t){var i=this.graphics;i.clear(!0);var n=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(Q.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);Q.context.font=n;var a=this.padding,r=a[3],s="left",o=this._lines,l=this.leading+this._charSize.height,h=this._currBitmapFont;h&&(l=this.leading+h.getMaxHeight());var c=a[0];if(!h&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(s="right",r=this._width-a[1]):"center"==this.align&&(s="center",r=.5*this._width+a[3]-a[1])),0<this._height){var u=this._textHeight>this._height?"top":this.valign;"middle"===u?c=.5*(this._height-t*l)+a[0]-a[2]:"bottom"===u&&(c=this._height-t*l-a[2])}var d=this._style;if(h&&h.autoScaleSize)var _=h.fontSize/this.fontSize;if(this._clipPoint)if(i.save(),h&&h.autoScaleSize){var p=0,f=0;p=this._width?this._width-a[3]-a[1]:this._textWidth,f=this._height?this._height-a[0]-a[2]:this._textHeight,p*=_,f*=_,i.clipRect(a[3],a[0],p,f)}else i.clipRect(a[3],a[0],this._width?this._width-a[3]-a[1]:this._textWidth,this._height?this._height-a[0]-a[2]:this._textHeight);var m=d.password;"prompt"in this&&this.prompt==this._text&&(m=!1);for(var g=0,v=0,y=Math.min(this._lines.length,t+e)||1,C=e;C<y;C++){var E,S=o[C];if(m){var x=S.length;S="";for(var T=x;0<T;T--)S+="●"}if(void 0===S&&(S=""),g=r-(this._clipPoint?this._clipPoint.x:0),v=c+l*C-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(s,g,v,C),h){var w=this.width;h.autoScaleSize&&(w=this.width*_),h.drawText(S,this,g,v,this.align,w)}else X.isWebGL?(this._words||(this._words=[]),(E=this._words.length>C-e?this._words[C-e]:new Se).setText(S)):E=S,d.stroke?i.fillBorderText(E,g,v,n,this.color,d.strokeColor,d.stroke,s):i.fillText(E,g,v,n,this.color,s)}if(h&&h.autoScaleSize){var M=1/_;this.scale(M,M)}this._clipPoint&&i.restore(),this._startX=r,this._startY=c},e.drawUnderline=function(e,t,i,n){var a=this._lineWidths[n];switch(e){case"center":t-=a/2;break;case"right":t-=a}i+=this._charSize.height,this._graphics.drawLine(t,i,t+a,i,this.underlineColor||this.color,1)},e.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);Q.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new O(0,0)):this._clipPoint=null;var e=this._lines.length;if(this.overflow!=_.VISIBLE){var t=this.overflow==_.HIDDEN?Math.floor:Math.ceil;e=Math.min(e,t((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var i=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(i,e),this.repaint()},e.evalTextSize=function(){var e,t=NaN;e=Math.max.apply(this,this._lineWidths),t=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],e==this._textWidth&&t==this._textHeight||(this._textWidth=e,this._textHeight=t,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},e.checkEnabledViewportOrNot=function(){return this.overflow==_.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},e.changeText=function(e){this._text!==e&&(this.lang(e+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},e.parseLines=function(e){var t=this.wordWrap||this.overflow==_.HIDDEN;if(t)var i=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var n=Q.context.measureText(_._testWord);X.isConchApp&&0===n.width&&0===n.height&&(n=Q.context.measureText("W")),this._charSize.width=n.width,this._charSize.height=n.height||this.fontSize}for(var a=e.replace(/\r\n/g,"\n").split("\n"),r=0,s=a.length;r<s;r++){var o=a[r];t?this.parseLine(o,i):(this._lineWidths.push(this.getTextWidth(o)),this._lines.push(o))}},e.parseLine=function(e,t){Q.context;var i,n=this._lines,a=0,r=NaN,s=NaN,o=0;if((r=this.getTextWidth(e))<=t)return n.push(e),void this._lineWidths.push(r);r=this._charSize.width,0==(a=Math.floor(t/r))&&(a=1),s=r=this.getTextWidth(e.substring(0,a));for(var l=a,h=e.length;l<h;l++)if(t<(s+=r=this.getTextWidth(e.charAt(l))))if(this.wordWrap){var c=e.substring(o,l);if(c.charCodeAt(c.length-1)<255?(i=/(?:\w|-)+$/.exec(c))&&(l=i.index+o,0==i.index?l+=c.length:c=e.substring(o,l)):_.RightToLeft&&(i=/([\u0600-\u06FF])+$/.exec(c))&&(l=i.index+o,0==i.index?l+=c.length:c=e.substring(o,l)),n.push(c),this._lineWidths.push(s-r),!((o=l)+a<h)){n.push(e.substring(o,h)),this._lineWidths.push(this.getTextWidth(n[n.length-1])),o=-1;break}l+=a,s=r=this.getTextWidth(e.substring(o,l)),l--}else if(this.overflow==_.HIDDEN)return n.push(e.substring(0,l)),void this._lineWidths.push(this.getTextWidth(n[n.length-1]));this.wordWrap&&-1!=o&&(n.push(e.substring(o,h)),this._lineWidths.push(this.getTextWidth(n[n.length-1])))},e.getTextWidth=function(e){return this._currBitmapFont?this._currBitmapFont.getTextWidth(e):Q.context.measureText(e).width},e.getWordWrapWidth=function(){var e=this.padding,t=NaN;return(t=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(t=this.wordWrap?100:Q.width),t<=0&&(t=100),t-e[3]-e[1]},e.getCharPoint=function(e,t){this._isChanged&&x.timer.runCallLater(this,this.typeset);for(var i=0,n=this._lines,a=0,r=0,s=n.length;r<s;r++){if(e<(i+=n[r].length)){var o=r;break}a=i}var l=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Q.context.font=l;var h=this.getTextWidth(this._text.substring(a,e));return(t||new O).setTo(this._startX+h-(this._clipPoint?this._clipPoint.x:0),this._startY+o*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},c(0,e,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(e){e!=this._width&&(x.superSet(Oe,this,"width",e),this.isChanged=!0)}),c(0,e,"textWidth",function(){return this._isChanged&&x.timer.runCallLater(this,this.typeset),this._textWidth}),c(0,e,"height",function(){return this._height?this._height:this.textHeight},function(e){e!=this._height&&(x.superSet(Oe,this,"height",e),this.isChanged=!0)}),c(0,e,"textHeight",function(){return this._isChanged&&x.timer.runCallLater(this,this.typeset),this._textHeight}),c(0,e,"padding",function(){return this._getCSSStyle().padding},function(e){this._getCSSStyle().padding=e,this.isChanged=!0}),c(0,e,"bold",function(){return this._getCSSStyle().bold},function(e){this._getCSSStyle().bold=e,this.isChanged=!0}),c(0,e,"text",function(){return this._text||""},function(e){this._text!==e&&(this.lang(e+""),this.isChanged=!0,this.event("change"))}),c(0,e,"color",function(){return this._getCSSStyle().color},function(e){this._getCSSStyle().color!=e&&(this._getCSSStyle().color=e,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),c(0,e,"font",function(){return this._getCSSStyle().fontFamily},function(e){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),_._bitmapFonts&&_._bitmapFonts[e]&&(this._currBitmapFont=_._bitmapFonts[e]),this._getCSSStyle().fontFamily=e,this.isChanged=!0}),c(0,e,"fontSize",function(){return this._getCSSStyle().fontSize},function(e){this._getCSSStyle().fontSize=e,this.isChanged=!0}),c(0,e,"italic",function(){return this._getCSSStyle().italic},function(e){this._getCSSStyle().italic=e,this.isChanged=!0}),c(0,e,"align",function(){return this._getCSSStyle().align},function(e){this._getCSSStyle().align=e,this.isChanged=!0}),c(0,e,"valign",function(){return this._getCSSStyle().valign},function(e){this._getCSSStyle().valign=e,this.isChanged=!0}),c(0,e,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(e){this._getCSSStyle().wordWrap=e,this.isChanged=!0}),c(0,e,"leading",function(){return this._getCSSStyle().leading},function(e){this._getCSSStyle().leading=e,this.isChanged=!0}),c(0,e,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(e){this._getCSSStyle().backgroundColor=e,this.isChanged=!0}),c(0,e,"borderColor",function(){return this._getCSSStyle().borderColor},function(e){this._getCSSStyle().borderColor=e,this.isChanged=!0}),c(0,e,"stroke",function(){return this._getCSSStyle().stroke},function(e){this._getCSSStyle().stroke=e,this.isChanged=!0}),c(0,e,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(e){this._getCSSStyle().strokeColor=e,this.isChanged=!0}),c(0,e,"isChanged",null,function(e){this._isChanged!==e&&(this._isChanged=e)&&x.timer.callLater(this,this.typeset)}),c(0,e,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(e){if(!(this.overflow!=_.SCROLL||this.textWidth<this._width)&&this._clipPoint){e=e<this.padding[3]?this.padding[3]:e;var t=this._textWidth-this._width;e=t<e?t:e;var i=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=e,this.renderText(this._lastVisibleLineIndex,i)}}),c(0,e,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(e){if(!(this.overflow!=_.SCROLL||this.textHeight<this._height)&&this._clipPoint){e=e<this.padding[0]?this.padding[0]:e;var t=this._textHeight-this._height,i=(e=t<e?t:e)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=i;var n=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=e,this.renderText(i,n)}}),c(0,e,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),c(0,e,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),c(0,e,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),c(0,e,"underlineColor",function(){return this._underlineColor},function(e){this._underlineColor=e,this._isChanged=!0,this.typeset()}),_.registerBitmapFont=function(e,t){_._bitmapFonts||(_._bitmapFonts={}),_._bitmapFonts[e]=t},_.unregisterBitmapFont=function(e,t){if(void 0===t&&(t=!0),_._bitmapFonts&&_._bitmapFonts[e]){var i=_._bitmapFonts[e];t&&i.destroy(),delete _._bitmapFonts[e]}},_.setTextRightToLeft=function(){var e;(e=Q.canvas.source.style).display="none",e.position="absolute",e.direction="rtl",X._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,Q.document.body.appendChild(Q.canvas.source)},_.supportFont=function(e){Q.context.font="10px sans-serif";var t=Q.context.measureText("abcji").width;Q.context.font="10px "+e;var i=Q.context.measureText("abcji").width;return console.log(t,i),t!==i},_._testWord="游",_.langPacks=null,_.VISIBLE="visible",_.SCROLL="scroll",_.HIDDEN="hidden",_.CharacterCache=!0,_.RightToLeft=!1,_._bitmapFonts=null,l(_,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),_}(Oe),Ue=function(u){function s(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",s.__super.call(this),this.offset=new O,this._canvasTransform=new N,this._previousOrientation=Q.window.orientation;var t=this;this.transform=N.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var e=Q.window,i=this;e.addEventListener("focus",function(){t._isFocused=!0,i.event("focus"),i.event("focuschange")}),e.addEventListener("blur",function(){t._isFocused=!1,i.event("blur"),i.event("focuschange"),i._isInputting()&&(je.inputElement.target.focus=!1)});var n="visibilityState",a="visibilitychange",r=e.document;void 0!==r.hidden?(a="visibilitychange",n="visibilityState"):void 0!==r.mozHidden?(a="mozvisibilitychange",n="mozVisibilityState"):void 0!==r.msHidden?(a="msvisibilitychange",n="msVisibilityState"):void 0!==r.webkitHidden&&(a="webkitvisibilitychange",n="webkitVisibilityState"),e.document.addEventListener(a,function(){"hidden"==Q.document[n]?i._setStageVisible(!1):i._setStageVisible(!0)}),e.document.addEventListener("qbrowserVisibilityChange",function(e){i._setStageVisible(!e.hidden)}),e.addEventListener("resize",function(){var e=Q.window.orientation;null!=e&&e!=t._previousOrientation&&i._isInputting()&&(je.inputElement.target.focus=!1),t._previousOrientation=e,i._isInputting()||i._resetCanvas()}),e.addEventListener("orientationchange",function(e){i._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),Q.onMobile&&this.on("mousedown",this,this._onmouseMove)}f(s,"laya.display.Stage",u);var e=s.prototype;return e._setStageVisible=function(e){this._isVisibility!=e&&(this._isVisibility=e,this._isVisibility||this._isInputting()&&(je.inputElement.target.focus=!1),this.event("visibilitychange"))},e._isInputting=function(){return Q.onMobile&&je.isInputting},e._changeCanvasSize=function(){this.setScreenSize(Q.clientWidth*Q.pixelRatio,Q.clientHeight*Q.pixelRatio)},e._resetCanvas=function(){if(this.screenAdaptationEnabled){var e=X._mainCanvas;e.source.style;e.size(1,1),x.timer.once(100,this,this._changeCanvasSize)}},e.setScreenSize=function(e,t){var i=!1;if("none"!==this._screenMode&&(i=(e/t<1?"vertical":"horizontal")!==this._screenMode)){var n=t;t=e,e=n}this.canvasRotation=i;var a=X._mainCanvas,r=a.source.style,s=this._canvasTransform.identity(),o=this._scaleMode,l=e/this.designWidth,h=t/this.designHeight,c=this.designWidth,u=this.designHeight,d=e,_=t,p=Q.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,o){case"noscale":l=h=1,d=this.designWidth,_=this.designHeight;break;case"showall":l=h=Math.min(l,h),c=d=Math.round(this.designWidth*l),u=_=Math.round(this.designHeight*h);break;case"noborder":l=h=Math.max(l,h),d=Math.round(this.designWidth*l),_=Math.round(this.designHeight*h);break;case"full":l=h=1,this._width=c=e,this._height=u=t;break;case"fixedwidth":h=l,this._height=u=Math.round(t/l);break;case"fixedheight":l=h,this._width=c=Math.round(e/h);break;case"fixedauto":e/t<this.designWidth/this.designHeight?(h=l,this._height=u=Math.round(t/l)):(l=h,this._width=c=Math.round(e/h))}this.conchModel&&this.conchModel.size(this._width,this._height),l*=this.scaleX,h*=this.scaleY,1===l&&1===h?this.transform.identity():(this.transform.a=this._formatData(l/(d/c)),this.transform.d=this._formatData(h/(_/u)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),a.size(c,u),L.changeWebGLSize(c,u),s.scale(d/c/p,_/u/p),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(e-d)/p:this.offset.x=.5*(e-d)/p,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(t-_)/p:this.offset.y=.5*(t-_)/p,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),s.translate(this.offset.x,this.offset.y),this.canvasDegree=0,i&&("horizontal"===this._screenMode?(s.rotate(Math.PI/2),s.translate(t/p,0),this.canvasDegree=90):(s.rotate(-Math.PI/2),s.translate(0,e/p),this.canvasDegree=-90)),s.a=this._formatData(s.a),s.d=this._formatData(s.d),s.tx=this._formatData(s.tx),s.ty=this._formatData(s.ty),r.transformOrigin=r.webkitTransformOrigin=r.msTransformOrigin=r.mozTransformOrigin=r.oTransformOrigin="0px 0px 0px",r.transform=r.webkitTransform=r.msTransform=r.mozTransform=r.oTransform="matrix("+s.toString()+")",s.translate(parseInt(r.left)||0,parseInt(r.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},e._formatData=function(e){return Math.abs(e)<1e-6?0:Math.abs(1-e)<.001?0<e?1:-1:e},e.getMousePoint=function(){return O.TEMP.setTo(this.mouseX,this.mouseY)},e.repaint=function(){this._repaint=1},e.parentRepaint=function(){},e._loop=function(){return this.render(X.context,0,0),!0},e._onmouseMove=function(e){this._mouseMoveTime=Q.now()},e.getTimeFromFrameStart=function(){return Q.now()-this._frameStartTime},e.render=function(e,t,i){if("sleep"===this._frameRate&&!X.isConchApp){var n=Q.now();if(!(1e3<=n-this._frameStartTime))return;this._frameStartTime=n}if(this._renderCount++,X.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=Q.now();var a="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),r=this._renderCount%2==0;if(pe.renderSlow=!a,a||r||X.isConchApp){var s;pe.loopCount++,E.instance.runEvent(),x.timer._update(),L.update3DLoop();var o=0,l=0;if(X.isConchNode)for(o=0,l=this._scenes.length;o<l;o++)(s=this._scenes[o])&&s._updateSceneConch();else for(o=0,l=this._scenes.length;o<l;o++)(s=this._scenes[o])&&s._updateScene();if(X.isConchNode){var h=Oe.CustomList;for(o=0,l=h.length;o<l;o++){var c=h[o];c.customRender(c.customContext,0,0)}return}}X.isConchNode||this.renderingEnabled&&(a||!r||X.isConchWebGL)&&(X.isWebGL?(e.clear(),u.prototype.render.call(this,e,t,i),pe._show&&pe._sp&&pe._sp.render(e,t,i),L.clear(this._bgColor),L.beginFlush(),e.flush(),L.endFinish(),Ce.instance&&Ce.getInstance().endDispose()):(L.clear(this._bgColor),u.prototype.render.call(this,e,t,i),pe._show&&pe._sp&&pe._sp.render(e,t,i)))}else this._renderCount%5==0&&(pe.loopCount++,E.instance.runEvent(),x.timer._update())},e._requestFullscreen=function(){var e=Q.document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},e._fullScreenChanged=function(){x.stage.event("fullscreenchange")},e.exitFullscreen=function(){var e=Q.document;e.exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()},c(0,e,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),c(0,e,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),c(0,e,"frameRate",function(){return this._frameRate},function(e){if(this._frameRate=e,X.isConchApp)switch(this._frameRate){case"slow":Q.window.conch&&Q.window.conchConfig.setSlowFrame&&Q.window.conchConfig.setSlowFrame(!0);break;case"fast":Q.window.conch&&Q.window.conchConfig.setSlowFrame&&Q.window.conchConfig.setSlowFrame(!1);break;case"mouse":Q.window.conch&&Q.window.conchConfig.setMouseFrame&&Q.window.conchConfig.setMouseFrame(2e3);break;case"sleep":Q.window.conch&&Q.window.conchConfig.setLimitFPS&&Q.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),c(0,e,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),c(0,e,"width",u.prototype._$get_width,function(e){this.designWidth=e,x.superSet(Oe,this,"width",e),x.timer.callLater(this,this._changeCanvasSize)}),c(0,e,"alignH",function(){return this._alignH},function(e){this._alignH=e,x.timer.callLater(this,this._changeCanvasSize)}),c(0,e,"isFocused",function(){return this._isFocused}),c(0,e,"height",u.prototype._$get_height,function(e){this.designHeight=e,x.superSet(Oe,this,"height",e),x.timer.callLater(this,this._changeCanvasSize)}),c(0,e,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||N.create()},u.prototype._$set_transform),c(0,e,"isVisibility",function(){return this._isVisibility}),c(0,e,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),c(0,e,"scaleMode",function(){return this._scaleMode},function(e){this._scaleMode=e,x.timer.callLater(this,this._changeCanvasSize)}),c(0,e,"alignV",function(){return this._alignV},function(e){this._alignV=e,x.timer.callLater(this,this._changeCanvasSize)}),c(0,e,"bgColor",function(){return this._bgColor},function(e){this._bgColor=e,this.conchModel&&this.conchModel.bgColor(e),X.isWebGL&&(e?s._wgColor=ae.create(e)._color:Q.onMiniGame||(s._wgColor=null)),Q.onLimixiu?s._wgColor=ae.create(e)._color:X.canvas.style.background=e||"none"}),c(0,e,"mouseX",function(){return Math.round(E.instance.mouseX/this.clientScaleX)}),c(0,e,"mouseY",function(){return Math.round(E.instance.mouseY/this.clientScaleY)}),c(0,e,"screenMode",function(){return this._screenMode},function(e){this._screenMode=e}),c(0,e,"visible",u.prototype._$get_visible,function(e){this.visible!==e&&(x.superSet(Oe,this,"visible",e),X._mainCanvas.source.style.visibility=e?"visible":"hidden")}),c(0,e,"fullScreenEnabled",null,function(e){var t=Q.document,i=X.canvas;e?(i.addEventListener("mousedown",this._requestFullscreen),i.addEventListener("touchstart",this._requestFullscreen),t.addEventListener("fullscreenchange",this._fullScreenChanged),t.addEventListener("mozfullscreenchange",this._fullScreenChanged),t.addEventListener("webkitfullscreenchange",this._fullScreenChanged),t.addEventListener("msfullscreenchange",this._fullScreenChanged)):(i.removeEventListener("mousedown",this._requestFullscreen),i.removeEventListener("touchstart",this._requestFullscreen),t.removeEventListener("fullscreenchange",this._fullScreenChanged),t.removeEventListener("mozfullscreenchange",this._fullScreenChanged),t.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),t.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),s.SCALE_NOSCALE="noscale",s.SCALE_EXACTFIT="exactfit",s.SCALE_SHOWALL="showall",s.SCALE_NOBORDER="noborder",s.SCALE_FULL="full",s.SCALE_FIXED_WIDTH="fixedwidth",s.SCALE_FIXED_HEIGHT="fixedheight",s.SCALE_FIXED_AUTO="fixedauto",s.ALIGN_LEFT="left",s.ALIGN_RIGHT="right",s.ALIGN_CENTER="center",s.ALIGN_TOP="top",s.ALIGN_MIDDLE="middle",s.ALIGN_BOTTOM="bottom",s.SCREEN_NONE="none",s.SCREEN_HORIZONTAL="horizontal",s.SCREEN_VERTICAL="vertical",s.FRAME_FAST="fast",s.FRAME_SLOW="slow",s.FRAME_MOUSE="mouse",s.FRAME_SLEEP="sleep",s.FRAME_MOUSE_THREDHOLD=2e3,l(s,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),s}(Oe),Ge=(function(){function e(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,e.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}f(e,"laya.media.SoundNode",Oe);var t=e.prototype;t._onParentChange=function(){this.target=this.parent},t.play=function(e,t){void 0===e&&(e=1),isNaN(e)&&(e=1),this.url&&(this.stop(),this._channel=V.playSound(this.url,e,t))},t.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},t._setPlayAction=function(e,t,i,n){void 0===n&&(n=!0),this[i]&&e&&(n?e.on(t,this,this[i]):e.off(t,this,this[i]))},t._setPlayActions=function(e,t,i,n){if(void 0===n&&(n=!0),e&&t){var a,r=t.split(","),s=0;for(a=r.length,s=0;s<a;s++)this._setPlayAction(e,r[s],i,n)}},c(0,t,"playEvent",null,function(e){(this._playEvents=e)&&this._tar&&this._setPlayActions(this._tar,e,"play")}),c(0,t,"target",null,function(e){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=e,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),c(0,t,"stopEvent",null,function(e){(this._stopEvents=e)&&this._tar&&this._setPlayActions(this._tar,e,"stop")})}(),function(){function e(){this._src=null,this._onload=null,this._onerror=null,e.__super.call(this)}f(e,"laya.resource.FileBitmap",Be);var t=e.prototype;return c(0,t,"src",function(){return this._src},function(e){this._src=e}),c(0,t,"onload",null,function(e){}),c(0,t,"onerror",null,function(e){}),e}()),ze=function(){function i(e,t){this._is2D=!1,i.__super.call(this);var n=this;if(this._source=this,"2D"===e||"AUTO"===e&&!X.isWebGL){this._is2D=!0,this._source=t||Q.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var a=this;a.getContext=function(e,t){if(n._ctx)return n._ctx;var i=n._ctx=n._source.getContext(e,t);return i&&(i._canvas=a,X.isFlash||Q.onLimixiu||(i.size=function(e,t){})),i}}this.lock=!0}f(i,"laya.resource.HTMLCanvas",Be);var e=i.prototype;return e.clear=function(){this._ctx&&this._ctx.clear()},e.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},e.release=function(){},e._setContext=function(e){this._ctx=e},e.getContext=function(e,t){return this._ctx?this._ctx:this._ctx=i._createContext(this)},e.getMemSize=function(){return 0},e.size=function(e,t){this._w==e&&this._h==t&&(!this._source||this._source.width==e&&this._source.height==t)||(this._w=e,this._h=t,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(e,t),this._source&&(this._source.height=t,this._source.width=e))},e.getCanvas=function(){return this._source},e.toBase64=function(e,t,i){if(this._source)if(X.isConchApp&&this._source.toBase64)this._source.toBase64(e,t,i);else{var n=this._source.toDataURL(e,t);i.call(this,n)}},c(0,e,"context",function(){return this._ctx}),c(0,e,"asBitmap",null,function(e){}),i.create=function(e,t){return new i(e,t)},i.TYPE2D="2D",i.TYPE3D="3D",i.TYPEAUTO="AUTO",i._createContext=null,i}();f(We,"laya.resource.HTMLSubImage",Be),We.create=function(e,t,i,n,a,r,s,o){return void 0===o&&(o=!1),new We(e,t,i,n,a,r,s,o)};function We(e,t,i,n,a,r,s,o){throw We.__super.call(this),new Error("不允许new！")}!function(e){function u(){this._frames=null,this._url=null,u.__super.call(this),this._setControlNode(this)}f(u,"laya.display.Animation",e);var t=u.prototype;t.destroy=function(e){void 0===e&&(e=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,e),this._frames=null,this._labels=null},t.play=function(e,t,i,n){void 0===e&&(e=0),void 0===t&&(t=!0),void 0===i&&(i=""),void 0===n&&(n=!0),i&&this._setFramesFromCache(i,n),this._isPlaying=!0,this.index="string"==typeof e?this._getFrameByLabel(e):e,this.loop=t,this._actionName=i,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},t._setFramesFromCache=function(e,t){var i;return void 0===t&&(t=!1),this._url&&(e=this._url+"#"+e),e&&u.framesMap[e]?((i=u.framesMap[e])instanceof Array?(this._frames=u.framesMap[e],this._count=this._frames.length):(i.nodeRoot&&(u.framesMap[e]=this._parseGraphicAnimationByData(i),i=u.framesMap[e]),this._frames=i.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=i.interval),this._labels=this._copyLabels(i.labels)),!0):(t&&console.log("ani not found:",e),!1)},t._copyLabels=function(e){if(!e)return null;var t,i;for(i in t={},e)t[i]=ve.copyArray([],e[i]);return t},t._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&e.prototype._frameLoop.call(this)},t._displayToIndex=function(e){this._frames&&(this.graphics=this._frames[e])},t.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},t.loadImages=function(e,t){return void 0===t&&(t=""),this._url="",this._setFramesFromCache(t)||(this.frames=u.framesMap[t]?u.framesMap[t]:u.createFrames(e,t)),this},t.loadAtlas=function(t,i,n){void 0===n&&(n=""),this._url="";var a=this;function e(e){t===e&&(a.frames=u.framesMap[n]?u.framesMap[n]:u.createFrames(t,n),i&&i.run())}return a._setFramesFromCache(n)||(Ae.getAtlas(t)?e(t):x.loader.load(t,v.create(null,e,[t]),null,"atlas")),this},t.loadAnimation=function(e,t,i){this._url=e;return this._actionName||(this._actionName=""),this._setFramesFromCache(this._actionName)?(this._setFramesFromCache(this._actionName,!0),this.index=0,t&&t.run()):!i||Ae.getAtlas(i)?this._loadAnimationData(e,t,i):x.loader.load(i,v.create(this,this._loadAnimationData,[e,t,i]),null,"atlas"),this},t._loadAnimationData=function(o,l,e){var h=this;if(!e||Ae.getAtlas(e)){var c=this;Ae.getRes(o)?t(o):x.loader.load(o,v.create(null,t,[o]),null,"json"),Ae.clearRes(o)}else console.warn("atlas load fail:"+e);function t(e){if(Ae.getRes(e)&&o===e){var t;if(u.framesMap[o+"#"])c._setFramesFromCache(h._actionName,!0),h.index=0,h._checkResumePlaying();else{var i=c._parseGraphicAnimation(Ae.getRes(o));if(!i)return;var n,a=i.animationList,r=0,s=a.length;for(r=0;r<s;r++)t=a[r],u.framesMap[o+"#"+t.name]=t,n=n||t;n&&(u.framesMap[o+"#"]=n,c._setFramesFromCache(h._actionName,!0),h.index=0),h._checkResumePlaying()}l&&l.run()}}},t._parseGraphicAnimation=function(e){return Ke.parseAnimationData(e)},t._parseGraphicAnimationByData=function(e){return Ke.parseAnimationByData(e)},c(0,t,"frames",function(){return this._frames},function(e){(this._frames=e)&&(this._count=e.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),c(0,t,"autoPlay",null,function(e){e?this.play():this.stop()}),c(0,t,"source",null,function(e){-1<e.indexOf(".ani")?this.loadAnimation(e):-1<e.indexOf(".json")||-1<e.indexOf("als")||-1<e.indexOf("atlas")?this.loadAtlas(e):this.loadImages(e.split(","))}),c(0,t,"autoAnimation",null,function(e){this.play(0,!0,e,!1)}),u.createFrames=function(e,t){var i,n,a=0,r=0;if("string"==typeof e){var s=Ae.getAtlas(e);if(s&&s.length)for(i=[],a=0,r=s.length;a<r;a++)(n=new L.createGraphics).drawTexture(Ae.getRes(s[a]),0,0),i.push(n)}else if(e instanceof Array)for(i=[],a=0,r=e.length;a<r;a++)(n=new L.createGraphics).loadImage(e[a],0,0),i.push(n);return t&&(u.framesMap[t]=i),i},u.clearCache=function(e){var t,i=u.framesMap,n=e+"#";for(t in i)t!==e&&0!=t.indexOf(n)||delete u.framesMap[t]},u.framesMap={}}(Fe);var Xe=function(e){function r(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,r.__super.call(this),null==r._sortIndexFun&&(r._sortIndexFun=D.sortByKey("index",!1,!0))}f(r,"laya.display.FrameAnimation",e);var t=r.prototype;return t._setUp=function(e,t){this._labels=null,this._animationNewFrames=null,this._targetDic=e,this._animationData=t,this.interval=1e3/t.frameRate,t.parsed?(this._count=t.count,this._labels=t.labels,this._animationNewFrames=t.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),t.parsed=!0,t.labels=this._labels,t.count=this._count,t.animationNewFrames=this._animationNewFrames},t.clear=function(){e.prototype.clear.call(this),this._targetDic=null,this._animationData=null},t._displayToIndex=function(e){if(this._animationData){e<0&&(e=0),e>this._count&&(e=this._count);var t=this._animationData.nodes,i=0,n=t.length;for(i=0;i<n;i++)this._displayNodeToFrame(t[i],e)}},t._displayNodeToFrame=function(e,t,i){var n=(i=i||this._targetDic)[e.target];if(n){var a,r,s,o=e.frames,l=e.keys,h=0,c=l.length;for(h=0;h<c;h++)s=(r=o[a=l[h]]).length>t?r[t]:r[r.length-1],n[a]=s}},t._calculateDatas=function(){if(this._animationData){var e,t=this._animationData.nodes,i=0,n=t.length;for(i=this._count=0;i<n;i++)e=t[i],this._calculateNodeKeyFrames(e);this._count+=1}},t._calculateNodeKeyFrames=function(e){var t,i,n=e.keyframes,a=e.target;for(t in e.frames||(e.frames={}),e.keys?e.keys.length=0:e.keys=[],e.initValues||(e.initValues={}),n)i=n[t],e.frames[t]||(e.frames[t]=[]),this._targetDic&&this._targetDic[a]&&(e.initValues[t]=this._targetDic[a][t]),i.sort(r._sortIndexFun),e.keys.push(t),this._calculateNodePropFrames(i,e.frames[t],t,a)},t.resetToInitState=function(){if(this._targetDic&&this._animationData){var e,t,i=this._animationData.nodes,n=0,a=i.length;for(n=0;n<a;n++)if(t=(e=i[n]).initValues){var r,s=this._targetDic[e.target];if(s)for(r in t)s[r]=t[r]}}},t._calculateNodePropFrames=function(e,t,i,n){var a=0,r=e.length-1;for(t.length=e[r].index+1,a=0;a<r;a++)this._dealKeyFrame(e[a]),this._calculateFrameValues(e[a],e[a+1],t);0==r&&(t[e[0].index]=e[0].value,this._animationNewFrames&&(this._animationNewFrames[e[0].index]=!0)),this._dealKeyFrame(e[a])},t._dealKeyFrame=function(e){e.label&&""!=e.label&&this.addLabel(e.label,e.index)},t._calculateFrameValues=function(e,t,i){var n,a=0,r=e.index,s=t.index,o=e.value,l=t.value-e.value,h=s-r;if(s>this._count&&(this._count=s),e.tween)for(null==(n=oe[e.tweenMethod])&&(n=oe.linearNone),a=r;a<s;a++)i[a]=n(a-r,o,l,h),this._animationNewFrames&&(this._animationNewFrames[a]=!0);else for(a=r;a<s;a++)i[a]=o;this._animationNewFrames&&(this._animationNewFrames[e.index]=!0,this._animationNewFrames[t.index]=!0),i[t.index]=t.value},r._sortIndexFun=null,r}(Fe),je=function(t){function a(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",a.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=He.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}f(a,"laya.display.Input",t);var e=a.prototype;return e.setSelection=function(e,t){this.focus=!0,laya.display.Input.inputElement.selectionStart=e,laya.display.Input.inputElement.selectionEnd=t},e._onUnDisplay=function(e){this.focus=!1},e._onMouseDown=function(e){this.focus=!0},e._syncInputTransform=function(){var e=this.nativeInput,t=ve.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),i=this._width-this.padding[1]-this.padding[3],n=this._height-this.padding[0]-this.padding[2];X.isConchApp?(e.setScale(t.scaleX,t.scaleY),e.setSize(i,n),e.setPos(t.x,t.y)):(a.inputContainer.style.transform=a.inputContainer.style.webkitTransform="scale("+t.scaleX+","+t.scaleY+") rotate("+x.stage.canvasDegree+"deg)",e.style.width=i+"px",e.style.height=n+"px",a.inputContainer.style.left=t.x+"px",a.inputContainer.style.top=t.y+"px")},e.select=function(){this.nativeInput.select()},e._setInputMethod=function(){a.input.parentElement&&a.inputContainer.removeChild(a.input),a.area.parentElement&&a.inputContainer.removeChild(a.area),a.inputElement=this._multiline?a.area:a.input,a.inputContainer.appendChild(a.inputElement),He.RightToLeft&&(a.inputElement.style.direction="rtl")},e._focusIn=function(){laya.display.Input.isInputting=!0;var e=this.nativeInput;this._focus=!0;var t=e.style;t.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),e.readOnly=!this._editable,X.isConchApp&&(e.setType(this._type),e.setForbidEdit(!this._editable)),e.maxLength=this._maxChars;this.padding;if(e.type=this._type,e.value=this._content,e.placeholder=this._prompt,x.stage.off("keydown",this,this._onKeyDown),x.stage.on("keydown",this,this._onKeyDown),(x.stage.focus=this).event("focus"),Q.onPC&&e.focus(),!Q.onMiniGame){this._text;this._text=null}this.typeset(),e.setColor(this._originColor),e.setFontSize(this.fontSize),e.setFontFace(Q.onIPhone&&He._fontFamilyMap[this.font]||this.font),X.isConchApp&&e.setMultiAble&&e.setMultiAble(this._multiline),t.lineHeight=this.leading+this.fontSize+"px",t.fontStyle=this.italic?"italic":"normal",t.fontWeight=this.bold?"bold":"normal",t.textAlign=this.align,t.padding="0 0",this._syncInputTransform(),!X.isConchApp&&Q.onPC&&x.timer.frameLoop(1,this,this._syncInputTransform)},e._setPromptColor=function(){(a.promptStyleDOM=Q.getElementById("promptStyle"))||((a.promptStyleDOM=Q.createElement("style")).setAttribute("id","promptStyle"),Q.document.head.appendChild(a.promptStyleDOM)),a.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},e._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(x.superSet(He,this,"text",this._content),x.superSet(He,this,"color",this._originColor)):(x.superSet(He,this,"text",this._prompt),x.superSet(He,this,"color",this._promptColor)),x.stage.off("keydown",this,this._onKeyDown),x.stage.focus=null,this.event("blur"),X.isConchApp&&this.nativeInput.blur(),Q.onPC&&x.timer.clear(this,this._syncInputTransform)},e._onKeyDown=function(e){13===e.keyCode&&(Q.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},e.changeText=function(e){this._content=e,this._focus?(this.nativeInput.value=e||"",this.event("change")):t.prototype.changeText.call(this,e)},c(0,e,"color",t.prototype._$get_color,function(e){this._focus&&this.nativeInput.setColor(e),x.superSet(He,this,"color",this._content?e:this._promptColor),this._originColor=e}),c(0,e,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(e){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),c(0,e,"multiline",function(){return this._multiline},function(e){this._multiline=e,this.valign=e?"top":"middle"}),c(0,e,"maxChars",function(){return this._maxChars},function(e){e<=0&&(e=1e5),this._maxChars=e}),c(0,e,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(e){x.superSet(He,this,"color",this._originColor),e+="",this._focus?(this.nativeInput.value=e||"",this.event("change")):(this._multiline||(e=e.replace(/\r?\n/g,"")),(this._content=e)?x.superSet(He,this,"text",e):(x.superSet(He,this,"text",this._prompt),x.superSet(He,this,"color",this.promptColor)))}),c(0,e,"nativeInput",function(){return this._multiline?a.area:a.input}),c(0,e,"prompt",function(){return this._prompt},function(e){!this._text&&e&&x.superSet(He,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?x.superSet(He,this,"text",this._text==this._prompt?e:this._text):x.superSet(He,this,"text",e),this._prompt=He.langPacks&&He.langPacks[e]?He.langPacks[e]:e}),c(0,e,"focus",function(){return this._focus},function(e){var t=this.nativeInput;this._focus!==e&&(e?(t.target?t.target._focusOut():this._setInputMethod(),(t.target=this)._focusIn()):(t.target=null,this._focusOut(),Q.document.body.scrollTop=0,t.blur(),X.isConchApp?t.setPos(-1e4,-1e4):a.inputContainer.contains(t)&&a.inputContainer.removeChild(t)))}),c(0,e,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(e){e?(-1<(e="[^"+e+"]").indexOf("^^")&&(e=e.replace("^^","")),this._restrictPattern=new RegExp(e,"g")):this._restrictPattern=null}),c(0,e,"editable",function(){return this._editable},function(e){this._editable=e,X.isConchApp&&a.input.setForbidEdit(!e)}),c(0,e,"promptColor",function(){return this._promptColor},function(e){this._promptColor=e,this._content||x.superSet(He,this,"color",e)}),c(0,e,"type",function(){return this._type},function(e){this._getCSSStyle().password="password"==e,this._type=e,X.isConchApp&&this.nativeInput.setType(e)}),c(0,e,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(e){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),c(0,e,"asPassword",function(){return this._getCSSStyle().password},function(e){this._getCSSStyle().password=e,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),a.__init__=function(){a._createInputElement(),Q.onMobile&&X.canvas.addEventListener(a.IOS_IFRAME?Q.onMiniGame?"touchend":"click":"touchend",a._popupInputMethod)},a._popupInputMethod=function(e){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},a._createInputElement=function(){a._initInput(a.area=Q.createElement("textarea")),a._initInput(a.input=Q.createElement("input")),(a.inputContainer=Q.createElement("div")).style.position="absolute",a.inputContainer.style.zIndex=1e5,Q.container.appendChild(a.inputContainer),a.inputContainer.setPos=function(e,t){a.inputContainer.style.left=e+"px",a.inputContainer.style.top=t+"px"}},a._initInput=function(t){var e=t.style;e.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",e.resize="none",e.backgroundColor="transparent",e.border="none",e.outline="none",e.zIndex=1,t.addEventListener("input",a._processInputting),t.addEventListener("mousemove",a._stopEvent),t.addEventListener("mousedown",a._stopEvent),t.addEventListener("touchmove",a._stopEvent),t.setFontFace=function(e){t.style.fontFamily=e},X.isConchApp||(t.setColor=function(e){t.style.color=e},t.setFontSize=function(e){t.style.fontSize=e+"px"})},a._processInputting=function(e){var t=laya.display.Input.inputElement.target;if(t){var i=laya.display.Input.inputElement.value;t._restrictPattern&&(i=i.replace(/\u2006|\x27/g,""),t._restrictPattern.test(i)&&(i=i.replace(t._restrictPattern,""),laya.display.Input.inputElement.value=i)),t._text=i,t.event("input")}},a._stopEvent=function(e){"touchmove"==e.type&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},a.TYPE_TEXT="text",a.TYPE_PASSWORD="password",a.TYPE_EMAIL="email",a.TYPE_URL="url",a.TYPE_NUMBER="number",a.TYPE_RANGE="range",a.TYPE_DATE="date",a.TYPE_MONTH="month",a.TYPE_WEEK="week",a.TYPE_TIME="time",a.TYPE_DATE_TIME="datetime",a.TYPE_DATE_TIME_LOCAL="datetime-local",a.TYPE_SEARCH="search",a.input=null,a.area=null,a.inputElement=null,a.inputContainer=null,a.confirmButton=null,a.promptStyleDOM=null,a.inputHeight=45,a.isInputting=!1,a.stageMatrix=null,l(a,["IOS_IFRAME",function(){return this.IOS_IFRAME=Q.onIOS&&Q.window.top!=Q.window.self}]),a}(He),Ye=function(){function i(e,t){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,i.__super.call(this),this._init_(e,t)}f(i,"laya.resource.HTMLImage",Ge);var e=i.prototype;return e._init_=function(e,t){this._src=e,this._source=new Q.window.Image,t&&(t.onload&&(this.onload=t.onload),t.onerror&&(this.onerror=t.onerror),t.onCreate&&t.onCreate(this)),0!=e.indexOf("data:image")&&(this._source.crossOrigin=""),e&&(this._source.src=e)},e.recreateResource=function(){var e=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var t=this;this._source=new Q.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(t._needReleaseAgain)return t._needReleaseAgain=!1,t._source.onload=null,void(t._source=null);t._source.onload=null,t.memorySize=e._w*e._h*4,t._recreateLock=!1,t.completeCreate()},this._source.src=this._src}},e.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},e.onresize=function(){this._w=this._source.width,this._h=this._source.height},c(0,e,"onload",null,function(e){var t=this;this._onload=e,this._source&&(this._source.onload=null!=this._onload?function(){t.onresize(),t._onload()}:null)}),c(0,e,"onerror",null,function(e){var t=this;this._onerror=e,this._source&&(this._source.onerror=null!=this._onerror?function(){t._onerror()}:null)}),c(0,e,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(e){this._enableMerageInAtlas=e,X.isConchApp&&this._source&&(this._source.enableMerageInAtlas=e)}),i.create=function(e,t){return new i(e,t)},i}(),Ke=(function(r){function e(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,e.__super.call(this)}f(e,"laya.display.EffectAnimation",r);var t=e.prototype;t._onOtherBegin=function(e){e!=this&&this.stop()},t.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},t._onPlayAction=function(){this.play(0,!1)},t.play=function(e,t,i,n){void 0===e&&(e=0),void 0===t&&(t=!0),void 0===i&&(i=""),void 0===n&&(n=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,e,t,i,n))},t._recordInitData=function(){if(this._aniKeys){var e,t,i=0;for(e=this._aniKeys.length,i=0;i<e;i++)t=this._aniKeys[i],this._initData[t]=this._target[t]}},t._displayToIndex=function(e){if(this._animationData){e<0&&(e=0),e>this._count&&(e=this._count);var t=this._animationData.nodes,i=0,n=t.length;for(n=1<n?1:n,i=0;i<n;i++)this._displayNodeToFrame(t[i],e)}},t._displayNodeToFrame=function(e,t,i){if(this._target){var n;n=this._target;var a,r,s,o,l=e.frames,h=e.keys,c=0,u=h.length;o=e.secondFrames;var d,_,p,f,m=0;for(c=0;c<u;c++)r=l[a=h[c]],s=-1==(m=o[a])?this._initData[a]:t<m?(p=(_=e.keyframes[a])[0]).tween?(null==(d=oe[p.tweenMethod])&&(d=oe.linearNone),f=_[1],d(t,this._initData[a],f.value-this._initData[a],f.index)):this._initData[a]:r.length>t?r[t]:r[r.length-1],n[a]=s}},t._calculateNodeKeyFrames=function(e){r.prototype._calculateNodeKeyFrames.call(this,e);var t,i,n,a=e.keyframes;e.target;for(t in n={},e.secondFrames=n,a)(i=a[t]).length<=1?n[t]=-1:n[t]=i[1].index},c(0,t,"target",function(){return this._target},function(e){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=e,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),c(0,t,"playEvent",null,function(e){(this._playEvents=e)&&this.addEvent()}),c(0,t,"effectData",null,function(e){var t;e&&(t=e.animations)&&t[0]&&(this._setUp({},t[0]),t[0].nodes&&t[0].nodes[0]&&(this._aniKeys=t[0].nodes[0].keys))}),c(0,t,"effectClass",null,function(e){var t,i;this._effectClass=ie.getClass(e),!this._effectClass||(t=this._effectClass.uiView)&&(i=t.animations)&&i[0]&&(this._setUp({},i[0]),i[0].nodes&&i[0].nodes[0]&&(this._aniKeys=i[0].nodes[0].keys))}),e.EffectAnimationBegin="effectanimationbegin"}(Xe),function(t){var b;function R(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,R.__super.call(this)}f(R,"laya.utils.GraphicAnimation",t);var e=R.prototype;return e._parseNodeList=function(e){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[e.compId]=e.props,e.compId&&this._nodeList.push(e.compId);var t=e.child;if(t){var i=0,n=t.length;for(i=0;i<n;i++)this._parseNodeList(t[i])}},e._calGraphicData=function(e){var t;if(this._setUp(null,e),this._createGraphicData(),this._nodeIDAniDic)for(t in this._nodeIDAniDic)this._nodeIDAniDic[t]=null},e._createGraphicData=function(){var e,t=[],i=0,n=this.count,a=this._animationNewFrames;for(a=a||[],i=0;i<n;i++)!a[i]&&e||(e=this._createFrameGraphic(i)),t.push(e);this._gList=t},e._createFrameGraphic=function(e){var t=L.createGraphics();return R._rootMatrix||(R._rootMatrix=new N),this._updateNodeGraphic(this._rootNode,e,R._rootMatrix,t),t},e._updateNodeGraphic=function(e,t,i,n,a){var r;void 0===a&&(a=1);var s,o,l,h=(r=this._nodeGDic[e.compId]=this._getNodeGraphicData(e.compId,t,this._nodeGDic[e.compId])).alpha*a;if(!(h<.01)&&(r.resultTransform||(r.resultTransform=N.create()),s=r.resultTransform,N.mul(r.transform,i,s),r.skin&&(o=this._getTextureByUrl(r.skin))&&(s._checkTransform()?(n.drawTexture(o,0,0,r.width,r.height,s,h),r.resultTransform=null):n.drawTexture(o,s.tx,s.ty,r.width,r.height,null,h)),l=e.child)){var c,u=0;for(c=l.length,u=0;u<c;u++)this._updateNodeGraphic(l[u],t,s,n,h)}},e._updateNoChilds=function(e,t){if(e.skin){var i=this._getTextureByUrl(e.skin);if(i){var n=e.transform;n._checkTransform();!n.bTransform?t.drawTexture(i,n.tx,n.ty,e.width,e.height,null,e.alpha):t.drawTexture(i,0,0,e.width,e.height,n.clone(),e.alpha)}}},e._updateNodeGraphic2=function(e,t,i){var n;if(n=this._nodeGDic[e.compId]=this._getNodeGraphicData(e.compId,t,this._nodeGDic[e.compId]),e.child){var a=n.transform;a._checkTransform();var r,s;s=(r=!a.bTransform)&&(0!=a.tx||0!=a.ty);var o,l,h;if((o=a.bTransform||1!=n.alpha)&&i.save(),1!=n.alpha&&i.alpha(n.alpha),r?s&&i.translate(a.tx,a.ty):i.transform(a.clone()),l=e.child,n.skin&&(h=this._getTextureByUrl(n.skin))&&i.drawTexture(h,0,0,n.width,n.height),l){var c,u=0;for(c=l.length,u=0;u<c;u++)this._updateNodeGraphic2(l[u],t,i)}o?i.restore():r?s&&i.translate(-a.tx,-a.ty):i.transform(a.clone().invert())}else this._updateNoChilds(n,i)},e._calculateNodeKeyFrames=function(e){t.prototype._calculateNodeKeyFrames.call(this,e),this._nodeIDAniDic[e.target]=e},e.getNodeDataByID=function(e){return this._nodeIDAniDic[e]},e._getParams=function(e,t,i,n){var a=R._temParam;a.length=t.length;var r=0,s=t.length;for(r=0;r<s;r++)a[r]=this._getObjVar(e,t[r][0],i,t[r][1],n);return a},e._getObjVar=function(e,t,i,n,a){if(e.hasOwnProperty(t)){var r=e[t];if(i>=r.length&&(i=r.length-1),null!=e[t][i])return e[t][i]}return a.hasOwnProperty(t)?a[t]:n},e._getNodeGraphicData=function(e,t,i){(i=i||b.create()).transform?i.transform.identity():i.transform=N.create();var n=this.getNodeDataByID(e);if(!n)return i;var a,r,s=n.frames,o=this._getParams(s,R._drawTextureCmd,t,this._nodeDefaultProps[e]),l=o[0],h=NaN,c=NaN,u=o[5],d=o[6],_=o[13],p=o[14],f=o[7],m=o[8],g=o[9],v=o[11],y=o[12];h=o[3],c=o[4],0!=h&&0!=c||(l=null),-1==h&&(h=0),-1==c&&(c=0),i.skin=l,i.width=h,i.height=c,l&&((a=this._getTextureByUrl(l))?(h=h||a.sourceWidth,c=c||a.sourceHeight):console.warn("lost skin:",l,",you may load pics first")),i.alpha=o[10],r=i.transform,0!=_&&(u=_*h),0!=p&&(d=p*c),0==u&&0==d||r.translate(-u,-d);var C=null;if(g||1!==f||1!==m||v||y){(C=R._tempMt).identity(),C.bTransform=!0;var E=.0174532922222222*(g-v),S=.0174532922222222*(g+y),x=Math.cos(S),T=Math.sin(S),w=Math.sin(E),M=Math.cos(E);C.a=f*x,C.b=f*T,C.c=-m*w,C.d=m*M,C.tx=C.ty=0}return C&&(r=N.mul(r,C,r)),r.translate(o[1],o[2]),i},e._getTextureByUrl=function(e){return Ae.getRes(e)},e.setAniData=function(e,t){if(e.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=e,this._parseNodeList(e);var i,n={},a=[],r=e.animations,s=0,o=r.length;for(s=0;s<o;s++)if(i=r[s],this._labels=null,(!t||t==i.name)&&i){try{this._calGraphicData(i)}catch(e){console.warn("parse animation fail:"+i.name+",empty animation created"),this._gList=[]}var l={};l.interval=1e3/i.frameRate,l.frames=this._gList,l.labels=this._labels,l.name=i.name,a.push(l),n[i.name]=l}this.animationList=a,this.animationDic=n}R._temParam.length=0},e.parseByData=function(e){var t,i;t=e.nodeRoot,i=e.aniO,delete e.nodeRoot,delete e.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=t,this._parseNodeList(t),this._labels=null;try{this._calGraphicData(i)}catch(e){console.warn("parse animation fail:"+i.name+",empty animation created"),this._gList=[]}var n=e;return n.interval=1e3/i.frameRate,n.frames=this._gList,n.labels=this._labels,n.name=i.name,n},e.setUpAniData=function(e){if(e.animations){var t,i={},n=[],a=e.animations,r=0,s=a.length;for(r=0;r<s;r++)if(t=a[r]){var o={};o.name=t.name,o.aniO=t,o.nodeRoot=e,n.push(o),i[t.name]=o}this.animationList=n,this.animationDic=i}},e._clear=function(){var e,t;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(e in this._nodeGDic)(t=this._nodeGDic[e])&&t.recover();this._nodeGDic=null},R.parseAnimationByData=function(e){var t;return R._I||(R._I=new R),t=R._I.parseByData(e),R._I._clear(),t},R.parseAnimationData=function(e){var t;return R._I||(R._I=new R),R._I.setUpAniData(e),(t={}).animationList=R._I.animationList,t.animationDic=R._I.animationDic,R._I._clear(),t},R._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],R._temParam=[],R._I=null,R._rootMatrix=null,l(R,["_tempMt",function(){return this._tempMt=new N}]),R.__init$=function(){function e(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}f(e,""),e.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),de.recover("GraphicNode",this)},e.create=function(){return de.getItemByClass("GraphicNode",e)},b=e},R}(Xe));x.__init([i,Ie,X,Q,me,H,Ne,Ke])}(window,document,Laya),function(e,t,i){i.un,i.uns,i.static;var n=i.class;i.getset,i.__newvec;function a(){}new(n(a,"LayaMain"),a)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,t){"use strict";for(var i in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(t[i]=n)}}),function(a,e,r){r.un,r.uns;var t=r.static,n=r.class,s=r.getset,u=(r.__newvec,laya.utils.Browser),i=(laya.events.Event,laya.events.EventDispatcher),d=laya.resource.HTMLImage,m=laya.utils.Handler,o=laya.display.Input,g=laya.net.Loader,l=laya.net.LocalStorage,h=(laya.maths.Matrix,laya.renders.Render),c=laya.utils.RunDriver,_=laya.media.SoundChannel,p=laya.media.SoundManager,v=laya.net.URL,y=laya.utils.Utils,C=(n(f,"laya.wx.mini.MiniAdpter"),f.getJson=function(e){return JSON.parse(e)},f.init=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),!(f._inited||(f._inited=!0,(f.window=a).navigator.userAgent.indexOf("MiniGame")<0))){f.isZiYu=t,f.isPosMsgYu=e,f.EnvConfig={};try{laya.webgl.resource.WebGLCanvas.premulAlpha=!0}catch(e){}if(f.isZiYu||(E.setNativeFileDir("/layaairGame"),E.existDir(E.fileNativeDir,m.create(f,f.onMkdirCallBack))),"ios 10.1.1"===(f.systemInfo=wx.getSystemInfoSync()).system.toLowerCase())try{laya.webgl.resource.WebGLCharImage.canUseCanvas=!1}catch(e){}f.window.focus=function(){},r._getUrlPath=function(){},f.window.logtime=function(e){},f.window.alertTimeLog=function(e){},f.window.resetShareInfo=function(){},f.window.CanvasRenderingContext2D=function(){},f.window.CanvasRenderingContext2D.prototype=f.window.wx.createCanvas().getContext("2d").__proto__,f.window.document.body.appendChild=function(){},f.EnvConfig.pixelRatioInt=0,c.getPixelRatio=f.pixelRatio,f._preCreateElement=u.createElement,u.createElement=f.createElement,c.createShaderCondition=f.createShaderCondition,y.parseXMLFromString=f.parseXMLFromString,o._createInputElement=w._createInputElement,f.EnvConfig.load=g.prototype.load,g.prototype.load=A.prototype.load,g.prototype._loadImage=x.prototype._loadImage,(l._baseClass=b).__init__(),f.onReciveData()}},f.onReciveData=function(){laya.wx.mini.MiniAdpter.isZiYu&&wx.onMessage(function(e){"opendatacontext"==e.isLoad?e.url&&(E.ziyuFileData[e.url]=e.atlasdata,E.ziyuFileTextureData[e.imgReadyUrl]=e.imgNativeUrl):"openJsondatacontext"==e.isLoad?e.url&&(E.ziyuFileData[e.url]=e.atlasdata):"openJsondatacontextPic"==e.isLoad&&(E.ziyuFileTextureData[e.imgReadyUrl]=e.imgNativeUrl)})},f.measureText=function(e){var t=f._measureText(e);return t||(t={width:16},console.warn("-------微信获取文字宽度失败----等待修复---------")),t},f.getUrlEncode=function(e,t){return-1!=e.indexOf(".fnt")?"utf8":"arraybuffer"==t?"":"ascii"},f.downLoadFile=function(e,t,i,n){void 0===t&&(t=""),void 0===n&&(n="ascii"),E.getFileInfo(e)?null!=i&&i.runWith([0]):E.downLoadFile(e,t,i,n)},f.remove=function(e,t){E.deleteFile("",e,t,"",0)},f.removeAll=function(){E.deleteAll()},f.hasNativeFile=function(e){return E.isLocalNativeFile(e)},f.getFileInfo=function(e){return E.getFileInfo(e)},f.getFileList=function(){return E.filesListObj},f.exitMiniProgram=function(){f.window.wx.exitMiniProgram()},f.onMkdirCallBack=function(e,t){e||(E.filesListObj=JSON.parse(t.data))},f.pixelRatio=function(){if(!f.EnvConfig.pixelRatioInt)try{return f.EnvConfig.pixelRatioInt=f.systemInfo.pixelRatio,f.systemInfo.pixelRatio}catch(e){}return f.EnvConfig.pixelRatioInt},f.createElement=function(e){var t;if("canvas"==e)return 1==f.idx?f.isZiYu?(t=sharedCanvas).style={}:t=a.canvas:t=a.wx.createCanvas(),f.idx++,t;if("textarea"==e||"input"==e)return f.onCreateInput(e);if("div"!=e)return f._preCreateElement(e);var i=f._preCreateElement(e);return i.contains=function(e){return null},i.removeChild=function(e){},i},f.onCreateInput=function(e){var t=f._preCreateElement(e);return t.focus=w.wxinputFocus,t.blur=w.wxinputblur,t.style={},t.value=0,t.parentElement={},t.placeholder={},t.type={},t.setColor=function(e){},t.setType=function(e){},t.setFontFace=function(e){},t.addEventListener=function(e){},t.contains=function(e){return null},t.removeChild=function(e){},t},f.createShaderCondition=function(e){var t=this;return function(){return t[e.replace("this.","")]}},f.sendAtlasToOpenDataContext=function(e){if(!laya.wx.mini.MiniAdpter.isZiYu){var t=g.getRes(v.formatURL(e));if(!t)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";if(t.meta.image.split(","),t.meta&&t.meta.image)for(var i=t.meta.image.split(","),n=0<=e.indexOf("/")?"/":"\\",a=e.lastIndexOf(n),r=0<=a?e.substr(0,a+1):"",s=0,o=i.length;s<o;s++)i[s]=r+i[s];else i=[e.replace(".json",".png")];for(s=0;s<i.length;s++){var l=i[s];f.postInfoToContext(e,l,t)}}},f.postInfoToContext=function(e,t,i){var n={frames:i.frames,meta:i.meta},a=t,r=E.getFileInfo(v.formatURL(t));if(r)var s=r.md5,o=E.getFileNativePath(s);else o=a;if(!o)throw"获取图集的磁盘url路径不存在！";wx.postMessage({url:e,atlasdata:n,imgNativeUrl:o,imgReadyUrl:a,isLoad:"opendatacontext"})},f.sendSinglePicToOpenDataContext=function(e){var t=v.formatURL(e),i=E.getFileInfo(t);if(i){var n=i.md5,a=E.getFileNativePath(n);e=t}else a=e;if(!a)throw"获取图集的磁盘url路径不存在！";wx.postMessage({url:e,imgNativeUrl:a,imgReadyUrl:e,isLoad:"openJsondatacontextPic"})},f.sendJsonDataToDataContext=function(e){if(!laya.wx.mini.MiniAdpter.isZiYu){var t=g.getRes(e);if(!t)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";wx.postMessage({url:e,atlasdata:t,isLoad:"openJsondatacontext"})}},f.EnvConfig=null,f.window=null,f._preCreateElement=null,f._inited=!1,f.systemInfo=null,f.isZiYu=!1,f.isPosMsgYu=!1,f.autoCacheFile=!0,f.minClearSize=5242880,f.subNativeFiles=null,f.subNativeheads=[],f.subMaps=[],f.AutoCacheDownFile=!1,f._measureText=null,f.parseXMLFromString=function(e){var t;e=e.replace(/>\s+</g,"><");try{t=(new a.Parser.DOMParser).parseFromString(e,"text/xml")}catch(e){throw"需要引入xml解析库文件"}return t},f.idx=1,t(f,["nativefiles",function(){return this.nativefiles=["layaNativeDir","wxlocal"]}]),f);function f(){}var E=(n(S,"laya.wx.mini.MiniFileMgr"),S.isLocalNativeFile=function(e){for(var t=0,i=C.nativefiles.length;t<i;t++)if(-1!=e.indexOf(C.nativefiles[t]))return!0;return!1},S.getFileInfo=function(e){var t=S.filesListObj[e];return null==t?null:t},S.read=function(e,t,i,n,a,r){var s;void 0===t&&(t="ascill"),void 0===n&&(n=""),void 0===a&&(a=!1),void 0===r&&(r=""),s=""==n||-1==n.indexOf("http://")&&-1==n.indexOf("https://")?e:S.getFileNativePath(e),S.fs.readFile({filePath:s,encoding:t,success:function(e){null!=i&&i.runWith([0,e])},fail:function(e){e&&""!=n?S.downFiles(n,t,i,n,a,r):null!=i&&i.runWith([1])}})},S.downFiles=function(t,i,n,a,r,s,o){void 0===i&&(i="ascii"),void 0===a&&(a=""),void 0===r&&(r=!1),void 0===s&&(s=""),void 0===o&&(o=!0),S.wxdown({url:t,success:function(e){200===e.statusCode?S.readFile(e.tempFilePath,i,n,a,r,s,o):403===e.statusCode?null!=n&&n.runWith([0,t]):null!=n&&n.runWith([1,e])},fail:function(e){null!=n&&n.runWith([1,e])}}).onProgressUpdate(function(e){null!=n&&n.runWith([2,e.progress])})},S.readFile=function(t,i,n,a,r,e,s){void 0===i&&(i="ascill"),void 0===a&&(a=""),void 0===r&&(r=!1),void 0===e&&(e=""),void 0===s&&(s=!0),S.fs.readFile({filePath:t,encoding:i,success:function(e){-1!=t.indexOf("http://")||-1!=t.indexOf("https://")?(C.autoCacheFile||r)&&S.copyFile(t,a,n,i,s):null!=n&&n.runWith([0,e])},fail:function(e){e&&null!=n&&n.runWith([1,e])}})},S.downOtherFiles=function(e,t,i,n,a){void 0===i&&(i=""),void 0===n&&(n=!1),void 0===a&&(a=!0),S.wxdown({url:e,success:function(e){200===e.statusCode?(C.autoCacheFile||n)&&-1==i.indexOf("wx.qlogo.cn")&&-1==i.indexOf(".php")?S.copyFile(e.tempFilePath,i,t,"",a):null!=t&&t.runWith([0,e.tempFilePath]):null!=t&&t.runWith([1,e])},fail:function(e){null!=t&&t.runWith([1,e])}})},S.downLoadFile=function(e,t,i,n){void 0===t&&(t=""),void 0===n&&(n="ascii"),a.navigator.userAgent.indexOf("MiniGame")<0?r.loader.load(e,i):"image"==t||"sound"==t?S.downOtherFiles(e,i,e,!0,!1):S.downFiles(e,n,i,e,!0,t,!1)},S.copyFile=function(e,i,n,a,r){void 0===a&&(a=""),void 0===r&&(r=!0);var t=e.split("/"),s=t[t.length-1],o=S.getFileInfo(i),l=S.getFileNativePath(s),h=S.getCacheUseSize();o?o.readyUrl!=i?S.fs.getFileInfo({filePath:e,success:function(e){r&&52428800<=h+4194304+e.size&&(e.size>C.minClearSize&&(C.minClearSize=e.size),S.onClearCacheRes()),S.deleteFile(s,i,n,a,e.size)},fail:function(e){null!=n&&n.runWith([1,e])}}):null!=n&&n.runWith([0]):S.fs.getFileInfo({filePath:e,success:function(t){r&&52428800<=h+4194304+t.size&&(t.size>C.minClearSize&&(C.minClearSize=t.size),S.onClearCacheRes()),S.fs.copyFile({srcPath:e,destPath:l,success:function(e){S.onSaveFile(i,s,!0,a,n,t.size)},fail:function(e){null!=n&&n.runWith([1,e])}})},fail:function(e){null!=n&&n.runWith([1,e])}})},S.onClearCacheRes=function(){var e=C.minClearSize,t=[];for(var i in S.filesListObj)t.push(S.filesListObj[i]);S.sortOn(t,"times",16);for(var n=0,a=1,r=t.length;a<r;a++){var s=t[a];if(e<=n)break;n+=s.size,S.deleteFile("",s.readyUrl)}},S.sortOn=function(e,i,t){return void 0===t&&(t=0),16==t?e.sort(function(e,t){return e[i]-t[i]}):18==t?e.sort(function(e,t){return t[i]-e[i]}):e.sort(function(e,t){return e[i]-t[i]})},S.getFileNativePath=function(e){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+e},S.deleteFile=function(n,a,r,s,o){void 0===a&&(a=""),void 0===s&&(s=""),void 0===o&&(o=0);var e=S.getFileInfo(a),t=S.getFileNativePath(e.md5);S.fs.unlink({filePath:t,success:function(e){var t=""!=n;if(""!=n){var i=S.getFileNativePath(n);S.fs.copyFile({srcPath:n,destPath:i,success:function(e){S.onSaveFile(a,n,t,s,r,e.size)},fail:function(e){null!=r&&r.runWith([1,e])}})}else S.onSaveFile(a,n,t,s,r,o)},fail:function(e){}})},S.deleteAll=function(){var e=[];for(var t in S.filesListObj)e.push(S.filesListObj[t]);for(var i=1,n=e.length;i<n;i++){var a=e[i];S.deleteFile("",a.readyUrl)}laya.wx.mini.MiniFileMgr.filesListObj&&laya.wx.mini.MiniFileMgr.filesListObj.fileUsedSize&&(laya.wx.mini.MiniFileMgr.filesListObj.fileUsedSize=0),laya.wx.mini.MiniFileMgr.writeFilesList("",JSON.stringify({}),!1)},S.onSaveFile=function(e,t,i,n,a,r){void 0===i&&(i=!0),void 0===n&&(n=""),void 0===r&&(r=0);var s=e;if(null==S.filesListObj.fileUsedSize&&(S.filesListObj.fileUsedSize=0),i)S.getFileNativePath(t),S.filesListObj[s]={md5:t,readyUrl:e,size:r,times:u.now(),encoding:n},S.filesListObj.fileUsedSize=parseInt(S.filesListObj.fileUsedSize)+r,S.writeFilesList(s,JSON.stringify(S.filesListObj),!0),null!=a&&a.runWith([0]);else if(S.filesListObj[s]){var o=parseInt(S.filesListObj[s].size);S.filesListObj.fileUsedSize=parseInt(S.filesListObj.fileUsedSize)-o,delete S.filesListObj[s],S.writeFilesList(s,JSON.stringify(S.filesListObj),!1),null!=a&&a.runWith([0])}},S.writeFilesList=function(e,t,i){var n=S.fileNativeDir+"/"+S.fileListName;S.fs.writeFile({filePath:n,encoding:"utf8",data:t,success:function(e){},fail:function(e){}}),!C.isZiYu&&C.isPosMsgYu&&wx.postMessage({url:e,data:S.filesListObj[e],isLoad:"filenative",isAdd:i})},S.getCacheUseSize=function(){return S.filesListObj&&S.filesListObj.fileUsedSize?S.filesListObj.fileUsedSize:0},S.existDir=function(e,t){S.fs.mkdir({dirPath:e,success:function(e){null!=t&&t.runWith([0,{data:JSON.stringify({})}])},fail:function(e){-1!=e.errMsg.indexOf("file already exists")?S.readSync(S.fileListName,"utf8",t):null!=t&&t.runWith([1,e])}})},S.readSync=function(e,t,i,n){void 0===t&&(t="ascill"),void 0===n&&(n="");var a,r=S.getFileNativePath(e);try{a=S.fs.readFileSync(r,t),null!=i&&i.runWith([0,{data:a}])}catch(e){null!=i&&i.runWith([1])}},S.setNativeFileDir=function(e){S.fileNativeDir=wx.env.USER_DATA_PATH+e},S.filesListObj={},S.fileNativeDir=null,S.fileListName="layaairfiles.txt",S.ziyuFileData={},S.ziyuFileTextureData={},S.loadPath="",S.DESCENDING=2,S.NUMERIC=16,t(S,["fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),S);function S(){}var x=(n(T,"laya.wx.mini.MiniImage"),T.prototype._loadImage=function(e){if(C.isZiYu)T.onCreateImage(e,this,!0);else{var t=!1;if(E.isLocalNativeFile(e)){if(-1!=e.indexOf("http://")||-1!=e.indexOf("https://"))if(""!=E.loadPath)e=e.split(E.loadPath)[1];else{var i=""!=v.rootPath?v.rootPath:v.basePath,n=e;""!=i&&(e=e.split(i)[1]),e=e||n}if(C.subNativeFiles&&0==C.subNativeheads.length)for(var a in C.subNativeFiles){var r=C.subNativeFiles[a];C.subNativeheads=C.subNativeheads.concat(r);for(var s=0;s<r.length;s++)C.subMaps[r[s]]=a+"/"+r[s]}if(C.subNativeFiles&&-1!=e.indexOf("/")){var o=e.split("/")[0]+"/";if(o&&-1!=C.subNativeheads.indexOf(o)){var l=C.subMaps[o];e=e.replace(o,l)}}}else t=!0,e=v.formatURL(e);E.getFileInfo(e)?T.onCreateImage(e,this,!t):-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?C.isZiYu?T.onCreateImage(e,this,!0):E.downOtherFiles(e,new m(T,T.onDownImgCallBack,[e,this]),e):T.onCreateImage(e,this,!0)}},T.onDownImgCallBack=function(e,t,i,n){void 0===n&&(n=""),i?t.onError(null):T.onCreateImage(e,t,!1,n)},T.onCreateImage=function(t,i,e,n){var a,r;if(void 0===e&&(e=!1),void 0===n&&(n=""),C.autoCacheFile)if(e)if(C.isZiYu){var s=v.formatURL(t);a=E.ziyuFileTextureData[s]?E.ziyuFileTextureData[s]:t}else a=t;else if(""!=n)a=n;else{var o=E.getFileInfo(t).md5;a=E.getFileNativePath(o)}else a=e?t:n;function l(){r.onload=null,r.onerror=null,delete i.imgCache[t]}function h(){l(),i._url=v.formatURL(i._url),i.onLoaded(r)}function c(){l(),i.event("error","Load image failed")}null==i.imgCache&&(i.imgCache={}),"nativeimage"==i._type?((r=new u.window.Image).crossOrigin="",r.onload=h,r.onerror=c,r.src=a,i.imgCache[t]=r):new d.create(a,{onload:h,onerror:c,onCreate:function(e){r=e,i.imgCache[t]=e}})},T);function T(){}var w=(n(M,"laya.wx.mini.MiniInput"),M._createInputElement=function(){o._initInput(o.area=u.createElement("textarea")),o._initInput(o.input=u.createElement("input")),o.inputContainer=u.createElement("div"),o.inputContainer.style.position="absolute",o.inputContainer.style.zIndex=1e5,u.container.appendChild(o.inputContainer),o.inputContainer.setPos=function(e,t){o.inputContainer.style.left=e+"px",o.inputContainer.style.top=t+"px"},r.stage.on("resize",null,M._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(e){a.dispatchEvent&&a.dispatchEvent("resize")}),p._soundClass=D,p._musicClass=D;var e=C.systemInfo.model,t=C.systemInfo.system;-1!=e.indexOf("iPhone")&&(u.onIPhone=!0,u.onIOS=!0,u.onIPad=!0,u.onAndroid=!1),-1==t.indexOf("Android")&&-1==t.indexOf("Adr")||(u.onAndroid=!0,u.onIPhone=!1,u.onIOS=!1,u.onIPad=!1)},M._onStageResize=function(){r.stage._canvasTransform.identity().scale(u.width/h.canvas.width/c.getPixelRatio(),u.height/h.canvas.height/c.getPixelRatio())},M.wxinputFocus=function(e){var i=o.inputElement.target;i&&!i.editable||(C.window.wx.offKeyboardConfirm(),C.window.wx.offKeyboardInput(),C.window.wx.showKeyboard({defaultValue:i.text,maxLength:i.maxChars,multiple:i.multiline,confirmHold:!0,confirmType:"done",success:function(e){},fail:function(e){}}),C.window.wx.onKeyboardConfirm(function(e){var t=e?e.value:"";i.text=t,i.event("input"),laya.wx.mini.MiniInput.inputEnter()}),C.window.wx.onKeyboardInput(function(e){var t=e?e.value:"";i.multiline||-1==t.indexOf("\n")?(i.text=t,i.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},M.inputEnter=function(){o.inputElement.target.focus=!1},M.wxinputblur=function(){M.hideKeyboard()},M.hideKeyboard=function(){C.window.wx.offKeyboardConfirm(),C.window.wx.offKeyboardInput(),C.window.wx.hideKeyboard({success:function(e){console.log("隐藏键盘")},fail:function(e){console.log("隐藏键盘出错:"+(e?e.errMsg:""))}})},M);function M(){}var b=(n(R,"laya.wx.mini.MiniLocalStorage"),R.__init__=function(){R.items=R},R.setItem=function(t,i){try{wx.setStorageSync(t,i)}catch(e){wx.setStorage({key:t,data:i})}},R.getItem=function(e){return wx.getStorageSync(e)},R.setJSON=function(e,t){R.setItem(e,t)},R.getJSON=function(e){return R.getItem(e)},R.removeItem=function(e){wx.removeStorageSync(e)},R.clear=function(){wx.clearStorageSync()},R.getStorageInfoSync=function(){try{var e=wx.getStorageInfoSync();return console.log(e.keys),console.log(e.currentSize),console.log(e.limitSize),e}catch(e){}return null},R.support=!0,R.items=null,R);function R(){}n(L,"laya.wx.mini.MiniLocation"),L.__init__=function(){C.window.navigator.geolocation.getCurrentPosition=L.getCurrentPosition,C.window.navigator.geolocation.watchPosition=L.watchPosition,C.window.navigator.geolocation.clearWatch=L.clearWatch},L.getCurrentPosition=function(t,e,i){var n;(n={success:function(e){null!=t&&t(e)}}).fail=e,C.window.wx.getLocation(n)},L.watchPosition=function(e,t,i){var n;return L._curID++,(n={}).success=e,n.error=t,L._watchDic[L._curID]=n,r.timer.loop(1e3,null,L._myLoop),L._curID},L.clearWatch=function(e){delete L._watchDic[e],L._hasWatch()||r.timer.clear(null,L._myLoop)},L._hasWatch=function(){var e;for(e in L._watchDic)if(L._watchDic[e])return!0;return!1},L._myLoop=function(){L.getCurrentPosition(L._mySuccess,L._myError)},L._mySuccess=function(e){var t,i={};for(t in i.coords=e,i.timestamp=u.now(),L._watchDic)L._watchDic[t].success&&L._watchDic[t].success(i)},L._myError=function(e){var t;for(t in L._watchDic)L._watchDic[t].error&&L._watchDic[t].error(e)},L._watchDic={},L._curID=0;function L(){}!function(a){function r(){r.__super.call(this)}n(r,"laya.wx.mini.MiniAccelerator",a);var e=r.prototype;e.on=function(e,t,i,n){return a.prototype.on.call(this,e,t,i,n),r.startListen(this.onDeviceOrientationChange),this},e.off=function(e,t,i,n){return void 0===n&&(n=!1),this.hasListener(e)||r.stopListen(),a.prototype.off.call(this,e,t,i,n)},r.__init__=function(){try{var e;if(!(e=laya.device.motion.Accelerator))return;e.prototype.on=r.prototype.on,e.prototype.off=r.prototype.off}catch(e){}},r.startListen=function(e){if(r._callBack=e,!r._isListening){r._isListening=!0;try{wx.onAccelerometerChange(r.onAccelerometerChange)}catch(e){}}},r.stopListen=function(){r._isListening=!1;try{wx.stopAccelerometer({})}catch(e){}},r.onAccelerometerChange=function(e){var t;(t={}).acceleration=e,t.accelerationIncludingGravity=e,t.rotationRate={},null!=r._callBack&&r._callBack(t)},r._isListening=!1,r._callBack=null}(i);var A=(n(I,"laya.wx.mini.MiniLoader",i),I.prototype.load=function(e,t,i,n,a){void 0===i&&(i=!0),void 0===a&&(a=!1);var r=this;if(0===(r._url=e).indexOf("data:image")?r._type=t="image":r._type=t=t||r.getTypeFromUrl(e),r._cache=i,r._data=null,!a&&g.loadedMap[v.formatURL(e)])return r._data=g.loadedMap[v.formatURL(e)],this.event("progress",1),void this.event("complete",r._data);if(null!=g.parserMap[t])return r._customParse=!0,void(g.parserMap[t]instanceof laya.utils.Handler?g.parserMap[t].runWith(this):g.parserMap[t].call(null,this));var s=C.getUrlEncode(e,t),o=y.getFileExtension(e);if(-1!=I._fileTypeArr.indexOf(o))C.EnvConfig.load.call(this,e,t,i,n,a);else{if(C.isZiYu&&!E.ziyuFileData[e]&&(e=v.formatURL(e)),C.isZiYu&&E.ziyuFileData[e]){var l=E.ziyuFileData[e];return void r.onLoaded(l)}if(E.getFileInfo(e)){var h=E.getFileInfo(e);h.encoding=null==h.encoding?"ascii":h.encoding,E.readFile(e,h.encoding,new m(I,I.onReadNativeCallBack,[s,e,t,i,n,a,r]),e)}else{if(E.isLocalNativeFile(e)){if(C.subNativeFiles&&0==C.subNativeheads.length)for(var c in C.subNativeFiles){var u=C.subNativeFiles[c];C.subNativeheads=C.subNativeheads.concat(u);for(var d=0;d<u.length;d++)C.subMaps[u[d]]=c+"/"+u[d]}if(C.subNativeFiles&&-1!=e.indexOf("/")){var _=e.split("/")[0]+"/";if(_&&-1!=C.subNativeheads.indexOf(_)){var p=C.subMaps[_];e=e.replace(_,p)}}return void E.read(e,s,new m(I,I.onReadNativeCallBack,[s,e,t,i,n,a,r]))}var f=e;-1!=(e=v.formatURL(e)).indexOf("http://")||-1!=e.indexOf("https://")?C.EnvConfig.load.call(r,f,t,i,n,a):E.readFile(e,s,new m(I,I.onReadNativeCallBack,[s,e,t,i,n,a,r]),e)}}},I.onReadNativeCallBack=function(e,t,i,n,a,r,s,o,l){var h;void 0===n&&(n=!0),void 0===r&&(r=!1),void 0===o&&(o=0),o?1==o&&(console.log("-----------本地加载失败，尝试外网加载----"),C.EnvConfig.load.call(s,t,i,n,a,r)):(h="json"==i||"atlas"==i?C.getJson(l.data):"xml"==i?y.parseXMLFromString(l.data):l.data,!C.isZiYu&&C.isPosMsgYu&&"arraybuffer"!=i&&wx.postMessage({url:t,data:h,isLoad:"filedata"}),s.onLoaded(h))},t(I,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),I);function I(){I.__super.call(this)}var D=function(){function l(){this._sound=null,this.url=null,this.loaded=!1,this.readyUrl=null,l.__super.call(this)}n(l,"laya.wx.mini.MiniSound",i);var e=l.prototype;return e.load=function(e){if(E.isLocalNativeFile(e)){if(-1!=e.indexOf("http://")||-1!=e.indexOf("https://"))if(""!=E.loadPath)e=e.split(E.loadPath)[1];else{var t=""!=v.rootPath?v.rootPath:v.basePath;""!=t&&(e=e.split(t)[1])}}else e=v.formatURL(e);if(this.url=e,this.readyUrl=e,l._audioCache[this.readyUrl])this.event("complete");else if(C.autoCacheFile&&E.getFileInfo(e))this.onDownLoadCallBack(e,0);else if(C.autoCacheFile)if(E.isLocalNativeFile(e)){var i=e;if(""!=(t=""!=v.rootPath?v.rootPath:v.basePath)&&(e=e.split(t)[1]),e=e||i,C.subNativeFiles&&0==C.subNativeheads.length)for(var n in C.subNativeFiles){var a=C.subNativeFiles[n];C.subNativeheads=C.subNativeheads.concat(a);for(var r=0;r<a.length;r++)C.subMaps[a[r]]=n+"/"+a[r]}if(C.subNativeFiles&&-1!=e.indexOf("/")){var s=e.split("/")[0]+"/";if(s&&-1!=C.subNativeheads.indexOf(s)){var o=C.subMaps[s];e=e.replace(s,o)}}this.onDownLoadCallBack(e,0)}else E.downOtherFiles(e,m.create(this,this.onDownLoadCallBack,[e]),e);else this.onDownLoadCallBack(e,0)},e.onDownLoadCallBack=function(e,t){if(t)this.event("error");else{var i;if(C.autoCacheFile){var n=E.getFileInfo(e);if(n&&n.md5){var a=n.md5;i=E.getFileNativePath(a)}else i=e;this._sound=l._createSound(),this._sound.src=this.url=i}else this._sound=l._createSound(),this._sound.src=e;this._sound.onCanplay(l.bindToThis(this.onCanPlay,this)),this._sound.onError(l.bindToThis(this.onError,this))}},e.onError=function(e){try{console.log("-----1---------------minisound-----id:"+l._id),console.log(e)}catch(e){console.log("-----2---------------minisound-----id:"+l._id),console.log(e)}this.event("error"),this._sound.offError(null)},e.onCanPlay=function(){this.loaded=!0,this.event("complete"),this._sound.offCanplay(null)},e.play=function(e,t){var i;if(void 0===e&&(e=0),void 0===t&&(t=0),i=this.url==p._tMusic?(l._musicAudio||(l._musicAudio=l._createSound()),l._musicAudio):l._audioCache[this.readyUrl]?l._audioCache[this.readyUrl]._sound:l._createSound(),C.autoCacheFile&&E.getFileInfo(this.url)){var n=E.getFileInfo(this.url).md5;i.src=this.url=E.getFileNativePath(n)}else i.src=this.url;var a=new P(i,this);return a.url=this.url,a.loops=t,a.loop=0===t,a.startTime=e,a.play(),p.addChannel(a),a},e.dispose=function(){var e=l._audioCache[this.readyUrl];e&&(e.src="",e._sound&&(e._sound.destroy(),e._sound=null,e=null),delete l._audioCache[this.readyUrl])},s(0,e,"duration",function(){return this._sound.duration}),l._createSound=function(){return l._id++,C.window.wx.createInnerAudioContext()},l.bindToThis=function(e,t){return e.bind(t)},l._musicAudio=null,l._id=0,l._audioCache={},l}(),P=function(){function i(e,t){this._audio=null,this._onEnd=null,this._miniSound=null,i.__super.call(this),this._audio=e,this._miniSound=t,this._onEnd=i.bindToThis(this.__onEnd,this),e.onEnded(this._onEnd)}n(i,"laya.wx.mini.MiniSoundChannel",_);var e=i.prototype;return e.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(r.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},e.play=function(){this.isStopped=!1,p.addChannel(this),this._audio.play()},e.stop=function(){this.isStopped=!0,p.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.pause(),this._audio.offEnded(null),this._audio=null,this._miniSound=null,this._onEnd=null)},e.pause=function(){this.isStopped=!0,this._audio.pause()},e.resume=function(){this._audio&&(this.isStopped=!1,p.addChannel(this),this._audio.play())},s(0,e,"startTime",null,function(e){this._audio&&(this._audio.startTime=e)}),s(0,e,"autoplay",function(){return this._audio.autoplay},function(e){this._audio.autoplay=e}),s(0,e,"position",function(){return this._audio?this._audio.currentTime:0}),s(0,e,"duration",function(){return this._audio?this._audio.duration:0}),s(0,e,"loop",function(){return this._audio.loop},function(e){this._audio.loop=e}),s(0,e,"volume",function(){return this._audio?this._audio.volume:1},function(e){this._audio&&(this._audio.volume=e)}),i.bindToThis=function(e,t){return e.bind(t)},i}()}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,t){"use strict";for(var i in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(t[i]=n)}}),function(e,t,S){S.un,S.uns;var s=S.static,d=S.class,n=S.getset,r=S.__newvec,l=laya.maths.Arith,c=laya.maths.Bezier,i=laya.resource.Bitmap,_=laya.utils.Browser,o=laya.utils.Byte,p=laya.utils.Color,x=(laya.filters.ColorFilter,S.Config),a=laya.resource.Context,T=(laya.events.Event,laya.filters.Filter),h=laya.display.Graphics,u=laya.resource.HTMLCanvas,f=(laya.utils.HTMLChar,laya.resource.HTMLImage),m=laya.resource.HTMLSubImage,w=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),M=laya.maths.Point,b=laya.maths.Rectangle,g=laya.renders.Render,v=(laya.renders.RenderContext,laya.renders.RenderSprite),y=laya.resource.Resource,C=laya.resource.ResourceManager,E=laya.utils.RunDriver,R=laya.display.Sprite,L=laya.display.Stage,A=laya.utils.Stat,I=laya.utils.StringKey,D=(laya.display.css.Style,laya.system.System),P=laya.display.Text,N=laya.resource.Texture,O=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),k=laya.utils.VectorGraphManager;laya.utils.WordText;S.interface("laya.webgl.shapes.IShape"),S.interface("laya.webgl.submit.ISubmit"),S.interface("laya.webgl.text.ICharSegment"),S.interface("laya.webgl.canvas.save.ISaveData"),S.interface("laya.webgl.resource.IMergeAtlasBitmap"),S.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var V=function(){function e(){}d(e,"laya.filters.webgl.FilterActionGL");var t=e.prototype;return S.imps(t,{"laya.filters.IFilterActionGL":!0}),t.setValue=function(e){},t.setValueMix=function(e){},t.apply3d=function(e,t,i,n,a){return null},t.apply=function(e){return null},n(0,t,"typeMix",function(){return 0}),e}(),B=(d(F,"laya.webgl.shader.ShaderValue"),F);function F(){}var H=function(){var n,a;function e(e,t,i){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new a,void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this._cells=null,this._rowInfo=null,this._init(e,t),this._atlasID=i}d(e,"laya.webgl.atlas.AtlasGrid");var t=e.prototype;return t.getAltasID=function(){return this._atlasID},t.setAltasID=function(e){0<=e&&(this._atlasID=e)},t.addTex=function(e,t,i){var n=this._get(t,i);return 0==n.ret||(this._fill(n.x,n.y,t,i,e),this._texCount++),n},t._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},t._init=function(e,t){if(this._width=e,this._height=t,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=r(this._height);for(var i=0;i<this._height;i++)this._rowInfo[i]=new n;return this._clear(),!0},t._get=function(e,t){var i=new G;if(e>=this._failSize.width&&t>=this._failSize.height)return i;for(var n=-1,a=-1,r=this._width,s=this._height,o=this._cells,l=0;l<s;l++)if(!(this._rowInfo[l].spaceCount<e))for(var h=0;h<r;){var c=3*(l*r+h);if(0!=o[c]||o[1+c]<e||o[2+c]<t)h+=o[1+c];else{n=h,a=l;for(var u=0;u<e;u++)if(o[3*u+c+2]<t){n=-1;break}if(!(n<0))return i.ret=!0,i.x=n,i.y=a,i;h+=o[1+c]}}return i},t._fill=function(e,t,i,n,a){var r=this._width,s=this._height;this._check(e+i<=r&&t+n<=s);for(var o=t;o<n+t;++o){this._check(this._rowInfo[o].spaceCount>=i),this._rowInfo[o].spaceCount-=i;for(var l=0;l<i;l++){var h=3*(e+o*r+l);this._check(0==this._cells[h]),this._cells[h]=a,this._cells[1+h]=i,this._cells[2+h]=n}}if(0<e)for(o=0;o<n;++o){var c=0;for(l=e-1;0<=l&&0==this._cells[3*((t+o)*r+l)];--l,++c);for(l=c;0<l;--l)this._cells[3*((t+o)*r+e-l)+1]=l,this._check(0<l)}if(0<t)for(l=e;l<e+i;++l){for(c=0,o=t-1;0<=o&&0==this._cells[3*(l+o*r)];--o,c++);for(o=c;0<o;--o)this._cells[3*(l+(t-o)*r)+2]=o,this._check(0<o)}},t._check=function(e){0==e&&console.log("xtexMerger 错误啦")},t._clear=function(){for(var e=this._texCount=0;e<this._height;e++)this._rowInfo[e].spaceCount=this._width;for(var t=0;t<this._height;t++)for(var i=0;i<this._width;i++){var n=3*(t*this._width+i);this._cells[n]=0,this._cells[1+n]=this._width-i,this._cells[2+n]=this._width-t}this._failSize.width=this._width+1,this._failSize.height=this._height+1},e.__init$=function(){function e(){this.spaceCount=0}function t(){this.width=0,this.height=0}d(e,""),n=e,d(t,""),a=t},e}(),U=function(){function g(e,t,i,n){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=e,this._height=t,this._gridSize=i,this._maxAtlaserCount=n,this._gridNumX=e/i,this._gridNumY=t/i,this._curAtlasIndex=0,this._atlaserArray=[]}d(g,"laya.webgl.atlas.AtlasResourceManager");var e=g.prototype;return e.setAtlasParam=function(e,t,i,n){if(1==this._setAtlasParam)return g._sid_=0,this._width=e,this._height=t,this._gridSize=i,this._maxAtlaserCount=n,this._gridNumX=e/i,this._gridNumY=t/i,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},e.pushData=function(e){var t,i=e.bitmap,n=-1,a=null,r=0,s=0;for(r=0,t=this._atlaserArray.length;r<t&&(s=(this._curAtlasIndex+r)%t,-1==(n=(a=this._atlaserArray[s]).findBitmapIsExist(i)));r++);if(-1!=n){var o=a.InAtlasWebGLImagesOffsetValue[n];return p=o[0],f=o[1],a.addToAtlas(e,p,f),!0}this._setAtlasParam=!1;for(var l=Math.ceil((e.bitmap.width+2)/this._gridSize),h=Math.ceil((e.bitmap.height+2)/this._gridSize),c=!1,u=0;u<2;u++){var d=this._maxAtlaserCount;for(r=0;r<d;r++){s=(this._curAtlasIndex+r)%d,this._atlaserArray.length-1>=s||this._atlaserArray.push(new Ue(this._gridNumX,this._gridNumY,this._width,this._height,g._sid_++));var _=this._atlaserArray[s],p=0,f=0,m=_.addTex(1,l,h);if(m.ret){p=m.x*this._gridSize+1,f=m.y*this._gridSize+1,i.lock=!0,_.addToAtlasTexture(i,p,f),_.addToAtlas(e,p,f),c=!0,this._curAtlasIndex=s;break}}if(c)break;this._atlaserArray.push(new Ue(this._gridNumX,this._gridNumY,this._width,this._height,g._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return c||console.log(">>>AtlasManager pushData error"),c},e.addToAtlas=function(e){laya.webgl.atlas.AtlasResourceManager.instance.pushData(e)},e.garbageCollection=function(){if(!0===this._needGC){for(var e=this._atlaserArray.length-this._maxAtlaserCount,t=0;t<e;t++)this._atlaserArray[t].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+e),this._atlaserArray.splice(0,e),this._needGC=!1}return!0},e.freeAll=function(){for(var e=0,t=this._atlaserArray.length;e<t;e++)this._atlaserArray[e].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},e.getAtlaserCount=function(){return this._atlaserArray.length},e.getAtlaserByIndex=function(e){return this._atlaserArray[e]},n(1,g,"instance",function(){return g._Instance||(g._Instance=new g(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),g._Instance}),n(1,g,"enabled",function(){return x.atlasEnable}),n(1,g,"atlasLimitWidth",function(){return g._atlasLimitWidth},function(e){g._atlasLimitWidth=e}),n(1,g,"atlasLimitHeight",function(){return g._atlasLimitHeight},function(e){g._atlasLimitHeight=e}),g._enable=function(){x.atlasEnable=!0},g._disable=function(){x.atlasEnable=!1},g.__init__=function(){g.atlasTextureWidth=2048,g.atlasTextureHeight=2048,g.maxTextureCount=6,g.atlasLimitWidth=512,g.atlasLimitHeight=512},g._atlasLimitWidth=0,g._atlasLimitHeight=0,g.gridSize=16,g.atlasTextureWidth=0,g.atlasTextureHeight=0,g.maxTextureCount=0,g._atlasRestore=0,g.BOARDER_TYPE_NO=0,g.BOARDER_TYPE_RIGHT=1,g.BOARDER_TYPE_LEFT=2,g.BOARDER_TYPE_BOTTOM=4,g.BOARDER_TYPE_TOP=8,g.BOARDER_TYPE_ALL=15,g._sid_=0,g._Instance=null,g}(),G=(d(z,"laya.webgl.atlas.MergeFillInfo"),z);function z(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}var W=(d(X,"laya.webgl.canvas.BlendMode"),X._init_=function(e){X.fns=[X.BlendNormal,X.BlendAdd,X.BlendMultiply,X.BlendScreen,X.BlendOverlay,X.BlendLight,X.BlendMask,X.BlendDestinationOut],X.targetFns=[X.BlendNormalTarget,X.BlendAddTarget,X.BlendMultiplyTarget,X.BlendScreenTarget,X.BlendOverlayTarget,X.BlendLightTarget,X.BlendMask,X.BlendDestinationOut]},X.BlendNormal=function(e){e.blendFunc(1,771)},X.BlendAdd=function(e){e.blendFunc(1,772)},X.BlendMultiply=function(e){e.blendFunc(774,771)},X.BlendScreen=function(e){e.blendFunc(1,1)},X.BlendOverlay=function(e){e.blendFunc(1,769)},X.BlendLight=function(e){e.blendFunc(1,1)},X.BlendNormalTarget=function(e){e.blendFunc(1,771)},X.BlendAddTarget=function(e){e.blendFunc(1,772)},X.BlendMultiplyTarget=function(e){e.blendFunc(774,771)},X.BlendScreenTarget=function(e){e.blendFunc(1,1)},X.BlendOverlayTarget=function(e){e.blendFunc(1,769)},X.BlendLightTarget=function(e){e.blendFunc(1,1)},X.BlendMask=function(e){e.blendFunc(0,770)},X.BlendDestinationOut=function(e){e.blendFunc(0,0)},X.activeBlendFunction=null,X.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],X.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},X.NORMAL="normal",X.ADD="add",X.MULTIPLY="multiply",X.SCREEN="screen",X.LIGHT="light",X.OVERLAY="overlay",X.DESTINATIONOUT="destination-out",X.fns=[],X.targetFns=[],X);function X(){}var j=function(){function i(e){this._color=p.create("black"),this.setValue(e)}d(i,"laya.webgl.canvas.DrawStyle");var e=i.prototype;return e.setValue=function(e){if(e){if("string"==typeof e)return void(this._color=p.create(e));if(e instanceof laya.utils.Color)return void(this._color=e)}},e.reset=function(){this._color=p.create("black")},e.equal=function(e){return"string"==typeof e?this._color.strColor===e:e instanceof laya.utils.Color&&this._color.numColor===e.numColor},e.toColorStr=function(){return this._color.strColor},i.create=function(e){var t;if(e&&("string"==typeof e?t=p.create(e):e instanceof laya.utils.Color&&(t=e),t))return t._drawStyle||(t._drawStyle=new i(e));return laya.webgl.canvas.DrawStyle.DEFAULT},s(i,["DEFAULT",function(){return this.DEFAULT=new i("#000000")}]),i}(),Y=function(){function e(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];De.mainContext;this.ib=vt.create(35048),this.vb=yt.create(5)}d(e,"laya.webgl.canvas.Path");var t=e.prototype;return t.addPoint=function(e,t){this.tempArray.push(e,t)},t.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},t.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},t.polygon=function(e,t,i,n,a,r){var s;return this.geomatrys.push(this._curGeomatry=s=new Ye(e,t,i,n,a,r)),n||(s.fill=!1),null==r&&(s.borderWidth=0),s},t.setGeomtry=function(e){this.geomatrys.push(this._curGeomatry=e)},t.drawLine=function(e,t,i,n,a){var r;return this.closePath?this.geomatrys.push(this._curGeomatry=r=new je(e,t,i,n,a)):this.geomatrys.push(this._curGeomatry=r=new Xe(e,t,i,n,a)),r.fill=!1,r},t.update=function(){var e=this.ib._byteLength,t=this.geomatrys.length;this.offset=e;for(var i=this.geoStart;i<t;i++)this.geomatrys[i].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=t,this.count=(this.ib._byteLength-e)/xe.BYTES_PIDX},t.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},t.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},e}(),K=function(){function o(){}d(o,"laya.webgl.canvas.save.SaveBase");var e=o.prototype;return S.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){this._dataObj[this._valueName]=this._value,(o._cache[o._cache._length++]=this)._newSubmit&&(e._curSubmit=de.RENDERBASE,e._renderKey=0)},o._createArray=function(){var e=[];return e._length=0,e},o._init=function(){var e=o._namemap={};return e[1]="ALPHA",e[2]="fillStyle",e[8]="font",e[256]="lineWidth",e[512]="strokeStyle",e[8192]="_mergeID",e[1024]=e[2048]=e[4096]=[],e[16384]="textBaseline",e[32768]="textAlign",e[65536]="_nBlendType",e[1048576]="shader",e[2097152]="filters",e},o.save=function(e,t,i,n){if((e._saveMark._saveuse&t)!==t){e._saveMark._saveuse|=t;var a=o._cache,r=0<a._length?a[--a._length]:new o;r._value=i[r._valueName=o._namemap[t]],r._dataObj=i,r._newSubmit=n;var s=e._save;s[s._length++]=r}},o._cache=laya.webgl.canvas.save.SaveBase._createArray(),o._namemap=o._init(),o}(),q=function(){function r(){this._clipRect=new b}d(r,"laya.webgl.canvas.save.SaveClipRect");var e=r.prototype;return S.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._clipRect=this._clipSaveRect,(r._cache[r._cache._length++]=this)._submitScissor.submitLength=e._submits._length-this._submitScissor.submitIndex,e._curSubmit=de.RENDERBASE,e._renderKey=0},r.save=function(e,t){if(131072!=(131072&e._saveMark._saveuse)){e._saveMark._saveuse|=131072;var i=r._cache,n=0<i._length?i[--i._length]:new r;n._clipSaveRect=e._clipRect,e._clipRect=n._clipRect.copyFrom(e._clipRect),n._submitScissor=t;var a=e._save;a[a._length++]=n}},s(r,["_cache",function(){return this._cache=K._createArray()}]),r}(),Z=function(){function _(){this._contextX=0,this._contextY=0,this._clipRect=new b,this._rect=new b,this._matrix=new w}d(_,"laya.webgl.canvas.save.SaveClipRectStencil");var e=_.prototype;return S.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){ge.restore(e,this._rect,this._saveMatrix,this._contextX,this._contextY),e._clipRect=this._clipSaveRect,e._curMat=this._saveMatrix,e._x=this._contextX,e._y=this._contextY,_._cache[_._cache._length++]=this,e._curSubmit=de.RENDERBASE},_.save=function(e,t,i,n,a,r,s,o,l,h){if(262144!=(262144&e._saveMark._saveuse)){e._saveMark._saveuse|=262144;var c=_._cache,u=0<c._length?c[--c._length]:new _;u._clipSaveRect=e._clipRect,u._clipRect.setTo(s,o,l,h),e._clipRect=u._clipRect,u._rect.x=i,u._rect.y=n,u._rect.width=a,u._rect.height=r,u._contextX=e._x,u._contextY=e._y,u._saveMatrix=e._curMat,e._curMat.copyTo(u._matrix),e._curMat=u._matrix,u._submitStencil=t;var d=e._save;d[d._length++]=u}},s(_,["_cache",function(){return this._cache=K._createArray()}]),_}(),Q=function(){function n(){this._saveuse=0}d(n,"laya.webgl.canvas.save.SaveMark");var e=n.prototype;return S.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!0},e.restore=function(e){e._saveMark=this._preSaveMark,n._no[n._no._length++]=this},n.Create=function(e){var t=n._no,i=0<t._length?t[--t._length]:new n;return i._saveuse=0,i._preSaveMark=e._saveMark,e._saveMark=i},s(n,["_no",function(){return this._no=K._createArray()}]),n}(),$=function(){function r(){this._matrix=new w}d(r,"laya.webgl.canvas.save.SaveTransform");var e=r.prototype;return S.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._curMat=this._savematrix,r._no[r._no._length++]=this},r.save=function(e){var t=e._saveMark;if(2048!=(2048&t._saveuse)){t._saveuse|=2048;var i=r._no,n=0<i._length?i[--i._length]:new r;n._savematrix=e._curMat,e._curMat=e._curMat.copyTo(n._matrix);var a=e._save;a[a._length++]=n}},s(r,["_no",function(){return this._no=K._createArray()}]),r}(),J=function(){function a(){}d(a,"laya.webgl.canvas.save.SaveTranslate");var e=a.prototype;return S.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._curMat;e._x=this._x,e._y=this._y,a._no[a._no._length++]=this},a.save=function(e){var t=a._no,i=0<t._length?t[--t._length]:new a;i._x=e._x,i._y=e._y;var n=e._save;n[n._length++]=i},s(a,["_no",function(){return this._no=K._createArray()}]),a}(),ee=function(){function e(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new b}d(e,"laya.webgl.resource.RenderTargetMAX");var t=e.prototype;return t.setSP=function(e){this._sp=e},t.size=function(e,t){var i=this;this._width!==e||this._height!==t?(this.repaint=!0,this._width=e,this._height=t,this.target?this.target.size(e,t):this.target=Je.create(e,t),this.target.hasListener("recovered")||this.target.on("recovered",this,function(e){S.timer.callLater(i._sp,i._sp.repaint)})):this.target.size(e,t)},t._flushToTarget=function(e,t){if(!t._destroy){var i=Le.worldScissorTest,n=Le.worldClipRect;Le.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,Le.worldScissorTest=!1,De.mainContext.disable(3089);var a=Le.worldAlpha,r=Le.worldMatrix4,s=Le.worldMatrix,o=Le.worldFilters,l=Le.worldShaderDefines;if(Le.worldMatrix=w.EMPTY,Le.restoreTempArray(),Le.worldMatrix4=Le.TEMPMAT4_ARRAY,Le.worldAlpha=1,Le.worldFilters=null,Le.worldShaderDefines=null,Qe.activeShader=null,t.start(),x.showCanvasMark?t.clear(0,1,0,.3):t.clear(0,0,0,0),e.flush(),t.end(),Qe.activeShader=null,Le.worldAlpha=a,Le.worldMatrix4=r,Le.worldMatrix=s,Le.worldFilters=o,Le.worldShaderDefines=l,Le.worldScissorTest=i){var h=Le.height-n.y-n.height;De.mainContext.scissor(n.x,h,n.width,n.height),De.mainContext.enable(3089)}Le.worldClipRect=n}},t.flush=function(e){this.repaint&&(this._flushToTarget(e,this.target),this.repaint=!1)},t.drawTo=function(e,t,i,n,a){e.drawTexture(this.target.getTexture(),t,i,n,a,0,0)},t.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},e}(),te=(d(ie,"laya.webgl.shader.d2.Shader2D"),ie.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},ie.__init__=function(){var e,t;pt.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),pt.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),pt.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),pt.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),pt.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),pt.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),pt.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),pt.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),e="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",t='precision mediump float;\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',pt.preCompile2D(0,1,e,t,null),e="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",t='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',pt.preCompile2D(0,2,e,t,null),e="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",t="precision mediump float;\n//precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",pt.preCompile2D(0,4,e,t,null),e="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",t='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',pt.preCompile2D(0,256,e,t,null),e="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",t="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",pt.preCompile2D(0,512,e,t,null)},ie);function ie(){this.ALPHA=1,this.shaderType=0,this.defines=new Ge}var ne=function(){function t(e,t,i){this._value=0,this._name2int=e,this._int2name=t,this._int2nameMap=i}d(t,"laya.webgl.shader.ShaderDefines");var e=t.prototype;return e.add=function(e){return"string"==typeof e&&(e=this._name2int[e]),this._value|=e,this._value},e.addInt=function(e){return this._value|=e,this._value},e.remove=function(e){return"string"==typeof e&&(e=this._name2int[e]),this._value&=~e,this._value},e.isDefine=function(e){return(this._value&e)===e},e.getValue=function(){return this._value},e.setValue=function(e){this._value=e},e.toNameDic=function(){var e=this._int2nameMap[this._value];return e||t._toText(this._value,this._int2name,this._int2nameMap)},t._reg=function(e,t,i,n){n[i[e]=t]=e},t._toText=function(e,t,i){var n=i[e];if(n)return n;for(var a={},r=1,s=0;s<32&&!(e<(r=1<<s));s++)if(e&r){var o=t[r];o&&(a[o]="")}return i[e]=a},t._toInt=function(e,t){for(var i=e.split("."),n=0,a=0,r=i.length;a<r;a++){var s=t[i[a]];if(!s)throw new Error("Defines to int err:"+e+"/"+i[a]);n|=s}return n},t}(),ae=function(){function s(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new w}d(s,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var e=s.prototype;return e.init=function(e,t,i){if(t)this._vs=t;else{this._vs=[];var n=e.width,a=e.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(n,0,1,0,1,1,1,1),this._vs.push(n,a,1,1,1,1,1,1),this._vs.push(0,a,0,1,1,1,1,1)}i?this._ps=i:(s._defaultPS||(s._defaultPS=[]).push(0,1,3,3,1,2),this._ps=s._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=e},e.init2=function(e,t,i,n,a){this.transform&&(this.transform=null),i?this._ps=i:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=n,this._uvs=a,this.mEleNum=this._ps.length,this.mTexture=e,(g.isConchNode||g.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},e._initMyData=function(){var e=0,t=0,i=4*this._verticles.length;this._vs=s._tempVS;var n=!1;if(g.isConchNode||g.isConchApp?(this._vs.length=i,n=!0):this._vs.length<i&&(this._vs.length=i,n=!0),s._tVSLen=i,n)for(;e<i;)this._vs[e]=this._verticles[t],this._vs[e+1]=this._verticles[t+1],this._vs[e+2]=this._uvs[t],this._vs[e+3]=this._uvs[t+1],this._vs[e+4]=1,this._vs[e+5]=1,this._vs[e+6]=1,this._vs[e+7]=1,e+=8,t+=2;else for(;e<i;)this._vs[e]=this._verticles[t],this._vs[e+1]=this._verticles[t+1],this._vs[e+2]=this._uvs[t],this._vs[e+3]=this._uvs[t+1],e+=8,t+=2},e.getData2=function(e,t,i){var n;this.mVBBuffer=e,this.mIBBuffer=t,this._initMyData(),e.appendEx2(this._vs,Float32Array,s._tVSLen,4),this._indexStart=t._byteLength,(n=s._tempIB).length<this._ps.length&&(n.length=this._ps.length);for(var a=0,r=this._ps.length;a<r;a++)n[a]=this._ps[a]+i;t.appendEx2(n,Uint16Array,this._ps.length,2)},e.getData=function(e,t,i){if(this.mVBBuffer=e,this.mIBBuffer=t,e.append(this.mVBData),this._indexStart=t._byteLength,this.mIBData.start!=i){for(var n=0,a=this._ps.length;n<a;n++)this.mIBData[n]=this._ps[n]+i;this.mIBData.start=i}t.append(this.mIBData)},e.render=function(e,t,i){if(g.isWebGL&&this.mTexture){e._renderKey=0,e._shader2D.glTexture=null,re.getInstance().addSkinMesh(this);var n=de.createShape(e,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,Be.create(512,0));this.transform||(this.transform=w.EMPTY),this.transform.translate(t,i),w.mul(this.transform,e._curMat,this._tempMatrix),this.transform.translate(-t,-i);var a=n.shaderValue,r=a.u_mmat2||Le.getMatrArray();Le.mat2MatArray(this._tempMatrix,r),a.textureHost=this.mTexture,a.offsetX=0,a.offsetY=0,a.u_mmat2=r,a.ALPHA=e._shader2D.ALPHA,e._submits[e._submits._length++]=n}else g.isConchApp&&this.mTexture&&(this.transform||(this.transform=w.EMPTY),e.setSkinMesh&&e.setSkinMesh(t,i,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},s._tempVS=[],s._tempIB=[],s._defaultPS=null,s._tVSLen=0,s}(),re=function(){function e(){this.ib=null,this.vb=null;De.mainContext;this.ib=vt.create(35048),this.vb=yt.create(8)}d(e,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var t=e.prototype;return t.addSkinMesh=function(e){e.getData2(this.vb,this.ib,this.vb._byteLength/32)},t.reset=function(){this.vb.clear(),this.ib.clear()},e.getInstance=function(){return e.instance=e.instance||new e},e.instance=null,e}(),se=function(){function e(e,t,i,n,a,r,s,o,l){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===l&&(l=0),this.x=e,this.y=t,this.width=i,this.height=n,this.edges=a,this.color=r,this.borderWidth=s,this.borderColor=o}d(e,"laya.webgl.shapes.BasePoly");var t=e.prototype;return S.imps(t,{"laya.webgl.shapes.IShape":!0}),t.getData=function(e,t,i){},t.rebuild=function(e){},t.setMatrix=function(e){},t.needUpdate=function(e){return!0},t.sector=function(e,t,i){var n=this.x,a=this.y,r=this.edges,s=(this.r1-this.r0)/r,o=this.width,l=this.height,h=this.color,c=(h>>16&255)/255,u=(h>>8&255)/255,d=(255&h)/255;e.push(n,a,c,u,d);for(var _=0;_<r+1;_++)e.push(n+Math.sin(s*_+this.r0)*o,a+Math.cos(s*_+this.r0)*l),e.push(c,u,d);for(_=0;_<r;_++)t.push(i,i+_+1,i+_+2)},t.createLine2=function(e,t,i,n,a,r){var s,o,l,h,c,u,d,_,p,f,m,g,v,y,C,E,S,x,T,w,M=e.concat(),b=a,R=this.borderColor,L=(R>>16&255)/255,A=(R>>8&255)/255,I=(255&R)/255,D=M.length/2,P=n,N=i/2;l=M[0],h=M[1],f=l-(c=M[2]),p=(p=-(h-(u=M[3])))/(w=Math.sqrt(p*p+f*f))*N,f=f/w*N,b.push(l-p+this.x,h-f+this.y,L,A,I,l+p+this.x,h+f+this.y,L,A,I);for(var O=1;O<D-1;O++)l=M[2*(O-1)],h=M[2*(O-1)+1],c=M[2*O],u=M[2*O+1],d=M[2*(O+1)],_=M[2*(O+1)+1],f=l-c,g=c-d,C=(-(p=(p=-(h-u))/(w=Math.sqrt(p*p+f*f))*N)+l)*(-(f=f/w*N)+u)-(-p+c)*(-f+h),x=(-(m=(m=-(u-_))/(w=Math.sqrt(m*m+g*g))*N)+d)*(-(g=g/w*N)+u)-(-m+c)*(-g+_),T=(v=-f+h-(-f+u))*(S=-m+c-(-m+d))-(E=-g+_-(-g+u))*(y=-p+c-(-p+l)),Math.abs(T)<.1?(T+=10.1,b.push(c-p+this.x,u-f+this.y,L,A,I,c+p+this.x,u+f+this.y,L,A,I)):(((s=(y*x-S*C)/T)-c)*(s-c)+((o=(E*C-v*x)/T)-u)+(o-u),b.push(s+this.x,o+this.y,L,A,I,c-(s-c)+this.x,u-(o-u)+this.y,L,A,I));l=M[M.length-4],h=M[M.length-3],f=l-(c=M[M.length-2]),p=(p=-(h-(u=M[M.length-1])))/(w=Math.sqrt(p*p+f*f))*N,f=f/w*N,b.push(c-p+this.x,u-f+this.y,L,A,I,c+p+this.x,u+f+this.y,L,A,I);var k=r;for(O=1;O<k;O++)t.push(P+2*(O-1),P+2*(O-1)+1,P+2*O+1,P+2*O+1,P+2*O,P+2*(O-1));return b},t.createLine=function(e,t,i,n){var a=e.concat(),r=e,s=this.borderColor,o=(s>>16&255)/255,l=(s>>8&255)/255,h=(255&s)/255;a.splice(0,5);var c,u,d,_,p,f,m,g,v,y,C,E,S,x,T,w,M,b,R,L,A=a.length/5,I=n,D=i/2;d=a[0],_=a[1],y=d-(p=a[5]),v=(v=-(_-(f=a[6])))/(L=Math.sqrt(v*v+y*y))*D,y=y/L*D,r.push(d-v,_-y,o,l,h,d+v,_+y,o,l,h);for(var P=1;P<A-1;P++)d=a[5*(P-1)],_=a[5*(P-1)+1],p=a[5*P],f=a[5*P+1],m=a[5*(P+1)],g=a[5*(P+1)+1],y=d-p,E=p-m,T=(-(v=(v=-(_-f))/(L=Math.sqrt(v*v+y*y))*D)+d)*(-(y=y/L*D)+f)-(-v+p)*(-y+_),b=(-(C=(C=-(f-g))/(L=Math.sqrt(C*C+E*E))*D)+m)*(-(E=E/L*D)+f)-(-C+p)*(-E+g),R=(S=-y+_-(-y+f))*(M=-C+p-(-C+m))-(w=-E+g-(-E+f))*(x=-v+p-(-v+d)),Math.abs(R)<.1?(R+=10.1,r.push(p-v,f-y,o,l,h,p+v,f+y,o,l,h)):(((c=(x*b-M*T)/R)-p)*(c-p)+((u=(w*T-S*b)/R)-f)+(u-f),r.push(c,u,o,l,h,p-(c-p),f-(u-f),o,l,h));d=a[a.length-10],_=a[a.length-9],y=d-(p=a[a.length-5]),v=(v=-(_-(f=a[a.length-4])))/(L=Math.sqrt(v*v+y*y))*D,y=y/L*D,r.push(p-v,f-y,o,l,h,p+v,f+y,o,l,h);var N=this.edges+1;for(P=1;P<N;P++)t.push(I+2*(P-1),I+2*(P-1)+1,I+2*P+1,I+2*P+1,I+2*P,I+2*(P-1));return r},t.createLoopLine=function(e,t,i,n,a,r){var s=e.concat(),o=a||e,l=this.borderColor,h=(l>>16&255)/255,c=(l>>8&255)/255,u=(255&l)/255;s.splice(0,5);var d=[s[0],s[1]],_=[s[s.length-5],s[s.length-4]],p=_[0]+.5*(d[0]-_[0]),f=_[1]+.5*(d[1]-_[1]);s.unshift(p,f,0,0,0),s.push(p,f,0,0,0);var m,g,v,y,C,E,S,x,T,w,M,b,R,L,A,I,D,P,N,O,k=s.length/5,V=n,B=i/2;v=s[0],y=s[1],w=v-(C=s[5]),T=(T=-(y-(E=s[6])))/(O=Math.sqrt(T*T+w*w))*B,w=w/O*B,o.push(v-T,y-w,h,c,u,v+T,y+w,h,c,u);for(var F=1;F<k-1;F++)v=s[5*(F-1)],y=s[5*(F-1)+1],C=s[5*F],E=s[5*F+1],S=s[5*(F+1)],x=s[5*(F+1)+1],w=v-C,b=C-S,A=(-(T=(T=-(y-E))/(O=Math.sqrt(T*T+w*w))*B)+v)*(-(w=w/O*B)+E)-(-T+C)*(-w+y),P=(-(M=(M=-(E-x))/(O=Math.sqrt(M*M+b*b))*B)+S)*(-(b=b/O*B)+E)-(-M+C)*(-b+x),N=(R=-w+y-(-w+E))*(D=-M+C-(-M+S))-(I=-b+x-(-b+E))*(L=-T+C-(-T+v)),Math.abs(N)<.1?(N+=10.1,o.push(C-T,E-w,h,c,u,C+T,E+w,h,c,u)):(((m=(L*P-D*A)/N)-C)*(m-C)+((g=(I*A-R*P)/N)-E)+(g-E),o.push(m,g,h,c,u,C-(m-C),E-(g-E),h,c,u));r&&(t=r);var H=this.edges+1;for(F=1;F<H;F++)t.push(V+2*(F-1),V+2*(F-1)+1,V+2*F+1,V+2*F+1,V+2*F,V+2*(F-1));return t.push(V+2*(F-1),V+2*(F-1)+1,V+1,V+1,V,V+2*(F-1)),o},e}(),oe=(d(le,"laya.webgl.shapes.Earcut"),le.earcut=function(e,t,i){i=i||2;var n,a,r,s,o,l,h,c=t&&t.length,u=c?t[0]*i:e.length,d=le.linkedList(e,0,u,i,!0),_=[];if(!d)return _;if(c&&(d=le.eliminateHoles(e,t,d,i)),e.length>80*i){n=r=e[0],a=s=e[1];for(var p=i;p<u;p+=i)(o=e[p])<n&&(n=o),(l=e[p+1])<a&&(a=l),r<o&&(r=o),s<l&&(s=l);h=0!==(h=Math.max(r-n,s-a))?1/h:0}return le.earcutLinked(d,_,i,n,a,h),_},le.linkedList=function(e,t,i,n,a){var r,s;if(a===0<le.signedArea(e,t,i,n))for(r=t;r<i;r+=n)s=le.insertNode(r,e[r],e[r+1],s);else for(r=i-n;t<=r;r-=n)s=le.insertNode(r,e[r],e[r+1],s);return s&&le.equals(s,s.next)&&(le.removeNode(s),s=s.next),s},le.filterPoints=function(e,t){if(!e)return e;t=t||e;var i,n=e;do{if(i=!1,n.steiner||!le.equals(n,n.next)&&0!==le.area(n.prev,n,n.next))n=n.next;else{if(le.removeNode(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t},le.earcutLinked=function(e,t,i,n,a,r,s){if(e){!s&&r&&le.indexCurve(e,n,a,r);for(var o,l,h=e;e.prev!==e.next;)if(o=e.prev,l=e.next,r?le.isEarHashed(e,n,a,r):le.isEar(e))t.push(o.i/i),t.push(e.i/i),t.push(l.i/i),le.removeNode(e),e=l.next,h=l.next;else if((e=l)===h){s?1===s?(e=le.cureLocalIntersections(e,t,i),le.earcutLinked(e,t,i,n,a,r,2)):2===s&&le.splitEarcut(e,t,i,n,a,r):le.earcutLinked(le.filterPoints(e,null),t,i,n,a,r,1);break}}},le.isEar=function(e){var t=e.prev,i=e,n=e.next;if(0<=le.area(t,i,n))return!1;for(var a=e.next.next;a!==e.prev;){if(le.pointInTriangle(t.x,t.y,i.x,i.y,n.x,n.y,a.x,a.y)&&0<=le.area(a.prev,a,a.next))return!1;a=a.next}return!0},le.isEarHashed=function(e,t,i,n){var a=e.prev,r=e,s=e.next;if(0<=le.area(a,r,s))return!1;for(var o=a.x<r.x?a.x<s.x?a.x:s.x:r.x<s.x?r.x:s.x,l=a.y<r.y?a.y<s.y?a.y:s.y:r.y<s.y?r.y:s.y,h=a.x>r.x?a.x>s.x?a.x:s.x:r.x>s.x?r.x:s.x,c=a.y>r.y?a.y>s.y?a.y:s.y:r.y>s.y?r.y:s.y,u=le.zOrder(o,l,t,i,n),d=le.zOrder(h,c,t,i,n),_=e.nextZ;_&&_.z<=d;){if(_!==e.prev&&_!==e.next&&le.pointInTriangle(a.x,a.y,r.x,r.y,s.x,s.y,_.x,_.y)&&0<=le.area(_.prev,_,_.next))return!1;_=_.nextZ}for(_=e.prevZ;_&&_.z>=u;){if(_!==e.prev&&_!==e.next&&le.pointInTriangle(a.x,a.y,r.x,r.y,s.x,s.y,_.x,_.y)&&0<=le.area(_.prev,_,_.next))return!1;_=_.prevZ}return!0},le.cureLocalIntersections=function(e,t,i){var n=e;do{var a=n.prev,r=n.next.next;!le.equals(a,r)&&le.intersects(a,n,n.next,r)&&le.locallyInside(a,r)&&le.locallyInside(r,a)&&(t.push(a.i/i),t.push(n.i/i),t.push(r.i/i),le.removeNode(n),le.removeNode(n.next),n=e=r),n=n.next}while(n!==e);return n},le.splitEarcut=function(e,t,i,n,a,r){var s=e;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&le.isValidDiagonal(s,o)){var l=le.splitPolygon(s,o);return s=le.filterPoints(s,s.next),l=le.filterPoints(l,l.next),le.earcutLinked(s,t,i,n,a,r),void le.earcutLinked(l,t,i,n,a,r)}o=o.next}s=s.next}while(s!==e)},le.eliminateHoles=function(e,t,i,n){var a,r,s,o,l,h=[];for(a=0,r=t.length;a<r;a++)s=t[a]*n,o=a<r-1?t[a+1]*n:e.length,(l=le.linkedList(e,s,o,n,!1))===l.next&&(l.steiner=!0),h.push(le.getLeftmost(l));for(h.sort(le.compareX),a=0;a<h.length;a++)le.eliminateHole(h[a],i),i=le.filterPoints(i,i.next);return i},le.compareX=function(e,t){return e.x-t.x},le.eliminateHole=function(e,t){if(t=le.findHoleBridge(e,t)){var i=le.splitPolygon(t,e);le.filterPoints(i,i.next)}},le.findHoleBridge=function(e,t){var i,n=t,a=e.x,r=e.y,s=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var o=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=a&&s<o){if((s=o)===a){if(r===n.y)return n;if(r===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(a===s)return i.prev;var l,h=i,c=i.x,u=i.y,d=1/0;for(n=i.next;n!==h;)a>=n.x&&n.x>=c&&a!==n.x&&le.pointInTriangle(r<u?a:s,r,c,u,r<u?s:a,r,n.x,n.y)&&((l=Math.abs(r-n.y)/(a-n.x))<d||l===d&&n.x>i.x)&&le.locallyInside(n,e)&&(i=n,d=l),n=n.next;return i},le.indexCurve=function(e,t,i,n){for(var a=e;null===a.z&&(a.z=le.zOrder(a.x,a.y,t,i,n)),a.prevZ=a.prev,a.nextZ=a.next,(a=a.next)!==e;);a.prevZ.nextZ=null,a.prevZ=null,le.sortLinked(a)},le.sortLinked=function(e){var t,i,n,a,r,s,o,l,h=1;do{for(i=e,r=e=null,s=0;i;){for(s++,n=i,t=o=0;t<h&&(o++,n=n.nextZ);t++);for(l=h;0<o||0<l&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(i=(a=i).nextZ,o--):(n=(a=n).nextZ,l--),r?r.nextZ=a:e=a,a.prevZ=r,r=a;i=n}r.nextZ=null,h*=2}while(1<s);return e},le.zOrder=function(e,t,i,n,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1},le.getLeftmost=function(e){for(var t=e,i=e;t.x<i.x&&(i=t),(t=t.next)!==e;);return i},le.pointInTriangle=function(e,t,i,n,a,r,s,o){return 0<=(a-s)*(t-o)-(e-s)*(r-o)&&0<=(e-s)*(n-o)-(i-s)*(t-o)&&0<=(i-s)*(r-o)-(a-s)*(n-o)},le.isValidDiagonal=function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!le.intersectsPolygon(e,t)&&le.locallyInside(e,t)&&le.locallyInside(t,e)&&le.middleInside(e,t)},le.area=function(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)},le.equals=function(e,t){return e.x===t.x&&e.y===t.y},le.intersects=function(e,t,i,n){return!!(le.equals(e,t)&&le.equals(i,n)||le.equals(e,n)&&le.equals(i,t))||0<le.area(e,t,i)!=0<le.area(e,t,n)&&0<le.area(i,n,e)!=0<le.area(i,n,t)},le.intersectsPolygon=function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&le.intersects(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1},le.locallyInside=function(e,t){return le.area(e.prev,e,e.next)<0?0<=le.area(e,t,e.next)&&0<=le.area(e,e.prev,t):le.area(e,t,e.prev)<0||le.area(e,e.next,t)<0},le.middleInside=function(e,t){for(var i=e,n=!1,a=(e.x+t.x)/2,r=(e.y+t.y)/2;i.y>r!=i.next.y>r&&i.next.y!==i.y&&a<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),(i=i.next)!==e;);return n},le.splitPolygon=function(e,t){var i=new he(e.i,e.x,e.y),n=new he(t.i,t.x,t.y),a=e.next,r=t.prev;return(e.next=t).prev=e,(i.next=a).prev=i,(n.next=i).prev=n,(r.next=n).prev=r,n},le.insertNode=function(e,t,i,n){var a=new he(e,t,i);return n?(a.next=n.next,(a.prev=n).next.prev=a,n.next=a):(a.prev=a).next=a,a},le.removeNode=function(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)},le.signedArea=function(e,t,i,n){for(var a=0,r=t,s=i-n;r<i;r+=n)a+=(e[s]-e[r])*(e[r+1]+e[s+1]),s=r;return a},le);function le(){}var he=(d(ce,"laya.webgl.shapes.EarcutNode"),ce);function ce(e,t,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}(function(){function e(e,t,i,n,a,r,s){this.lineWidth=e,this.lineColor=t,this.lineAlpha=i,this.fillColor=n,this.fillAlpha=a,this.shape=s,this.fill=r}d(e,"laya.webgl.shapes.GeometryData");var t=e.prototype;t.clone=function(){return new e(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},t.getIndexData=function(){return null},t.getVertexData=function(){return null},t.destroy=function(){this.shape=null}})(),function(){function e(e){if(e instanceof Float32Array)this.points=e;else if(e instanceof Array){e.length;this.points=new Float32Array(e)}}d(e,"laya.webgl.shapes.Vertex");var t=e.prototype;S.imps(t,{"laya.webgl.shapes.IShape":!0}),t.getData=function(e,t,i){},t.needUpdate=function(e){return!1},t.rebuild=function(e){},t.setMatrix=function(e){}}();var ue,de=function(){function l(e){void 0===e&&(e=1e4),this._renderType=e}d(l,"laya.webgl.submit.Submit");var e=l.prototype;return S.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.releaseRender=function(){var e=l._cache;(e[e._length++]=this).shaderValue.release(),this._vb=null},e.getRenderType=function(){return this._renderType},e.renderSubmit=function(){if(0===this._numEle)return 1;var e=this.shaderValue.textureHost;if(e){var t=e.source;if(!e.bitmap||!t)return 1;this.shaderValue.texture=t}this._vb.bind_upload(this._ib);var i=De.mainContext;return this.shaderValue.upload(),W.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),W.activeBlendFunction=this._blendFn),A.drawCall++,A.trianglesFaces+=this._numEle/3,i.drawElements(4,this._numEle,5123,this._startIdx),1},l.__init__=function(){var e=l.RENDERBASE=new l(-1);e.shaderValue=new Be(0,0),e.shaderValue.ALPHA=-1234},l.createSubmit=function(e,t,i,n,a){var r=l._cache._length?l._cache[--l._cache._length]:new l;null==i&&((i=r._selfVb||(r._selfVb=yt.create(-1))).clear(),n=0),r._ib=t,r._vb=i,r._startIdx=n*xe.BYTES_PIDX,r._numEle=0;var s=e._nBlendType;r._blendFn=e._targets?W.targetFns[s]:W.fns[s],r.shaderValue=a,r.shaderValue.setValue(e._shader2D);var o=e._shader2D.filters;return o&&r.shaderValue.setFilters(o),r},l.createShape=function(e,t,i,n,a,r){var s=l._cache._length?l._cache[--l._cache._length]:new l;s._ib=t,s._vb=i,s._numEle=n,s._startIdx=a,s.shaderValue=r,s.shaderValue.setValue(e._shader2D);var o=e._nBlendType;return s._blendFn=e._targets?W.targetFns[o]:W.fns[o],s},l.TYPE_2D=1e4,l.TYPE_CANVAS=10003,l.TYPE_CMDSETRT=10004,l.TYPE_CUSTOM=10005,l.TYPE_BLURRT=10006,l.TYPE_CMDDESTORYPRERT=10007,l.TYPE_DISABLESTENCIL=10008,l.TYPE_OTHERIBVB=10009,l.TYPE_PRIMITIVE=10010,l.TYPE_RT=10011,l.TYPE_BLUR_RT=10012,l.TYPE_TARGET=10013,l.TYPE_CHANGE_VALUE=10014,l.TYPE_SHAPE=10015,l.TYPE_TEXTURE=10016,l.TYPE_FILLTEXTURE=10017,l.RENDERBASE=null,l._cache=((l._cache=[])._length=0,l._cache),l}(),_e=function(){function n(){this.fun=null,this.args=null}d(n,"laya.webgl.submit.SubmitCMD");var e=n.prototype;return S.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){return this.fun.apply(null,this.args),1},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=n._cache;e[e._length++]=this},n.create=function(e,t){var i=n._cache._length?n._cache[--n._cache._length]:new n;return i.fun=t,i.args=e,i},n._cache=((n._cache=[])._length=0,n._cache),n}(),pe=function(){function t(){this.variables={}}d(t,"laya.webgl.submit.SubmitCMDScope");var e=t.prototype;return e.getValue=function(e){return this.variables[e]},e.addValue=function(e,t){return this.variables[e]=t},e.setValue=function(e,t){return this.variables.hasOwnProperty(e)?this.variables[e]=t:null},e.clear=function(){for(var e in this.variables)delete this.variables[e]},e.recycle=function(){this.clear(),t.POOL.push(this)},t.create=function(){var e=t.POOL.pop();return e=e||new t},t.POOL=[],t}(),fe=function(){function u(){this.offset=0,this.startIndex=0,this._mat=w.create()}d(u,"laya.webgl.submit.SubmitOtherIBVB");var e=u.prototype;return S.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.releaseRender=function(){var e=u._cache;e[e._length++]=this},e.getRenderType=function(){return 10009},e.renderSubmit=function(){var e=this._shaderValue.textureHost;if(e){var t=e.source;if(!e.bitmap||!t)return 1;this._shaderValue.texture=t}this._vb.bind_upload(this._ib);var i=Le.worldMatrix4,n=w.TEMP;w.mulPre(this._mat,i[0],i[1],i[4],i[5],i[12],i[13],n);var a=Le.worldMatrix4=u.tempMatrix4;a[0]=n.a,a[1]=n.b,a[4]=n.c,a[5]=n.d,a[12]=n.tx,a[13]=n.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var r=De.mainContext;return W.activeBlendFunction!==this._blendFn&&(r.enable(3042),this._blendFn(r),W.activeBlendFunction=this._blendFn),A.drawCall++,A.trianglesFaces+=this._numEle/3,r.drawElements(4,this._numEle,5123,this.startIndex),Le.worldMatrix4=i,Qe.activeShader=null,1},u.create=function(e,t,i,n,a,r,s,o,l){void 0===l&&(l=0);var h=u._cache._length?u._cache[--u._cache._length]:new u;h._ib=i,h._vb=t,h._numEle=n,h._shader=a,h._shaderValue=r;var c=e._nBlendType;switch(h._blendFn=e._targets?W.targetFns[c]:W.fns[c],l){case 0:h.offset=0,h.startIndex=o/(xe.BYTES_PE*t.vertexStride)*1.5,h.startIndex*=xe.BYTES_PIDX;break;case 1:h.startIndex=s,h.offset=o}return h},u._cache=((u._cache=[])._length=0,u._cache),u.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u}(),me=function(){function i(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new b,this.screenRect=new b}d(i,"laya.webgl.submit.SubmitScissor");var e=i.prototype;return S.imps(e,{"laya.webgl.submit.ISubmit":!0}),e._scissor=function(e,t,i,n){var a=Le.worldMatrix4,r=a[0],s=a[5],o=a[12],l=a[13];if(n*=s,(i*=r)<1||n<1)return!1;var h=(e=e*r+o)+i,c=(t=t*s+l)+n;e<0&&(i=h-(e=0)),t<0&&(n=c-(t=0));var u=Le.worldClipRect;if(e=Math.max(e,u.x),t=Math.max(t,u.y),i=Math.min(h,u.right)-e,n=Math.min(c,u.bottom)-t,i<1||n<1)return!1;var d=Le.worldScissorTest;return this.screenRect.copyFrom(u),u.x=e,u.y=t,u.width=i,u.height=n,Le.worldScissorTest=!0,t=Le.height-t-n,De.mainContext.scissor(e,t,i,n),De.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),d?(t=Le.height-this.screenRect.y-this.screenRect.height,De.mainContext.scissor(this.screenRect.x,t,this.screenRect.width,this.screenRect.height),De.mainContext.enable(3089)):(De.mainContext.disable(3089),Le.worldScissorTest=!1),u.copyFrom(this.screenRect),!0},e._scissorWithTagart=function(e,t,i,n){if(i<1||n<1)return!1;var a=e+i,r=t+n;e<0&&(i=a-(e=0)),t<0&&(n=r-(t=0));var s=Le.worldClipRect;if(e=Math.max(e,s.x),t=Math.max(t,s.y),i=Math.min(a,s.right)-e,n=Math.min(r,s.bottom)-t,i<1||n<1)return!1;var o=Le.worldScissorTest;return this.screenRect.copyFrom(s),Le.worldScissorTest=!0,s.x=e,s.y=t,s.width=i,s.height=n,t=Le.height-t-n,De.mainContext.scissor(e,t,i,n),De.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),o?(t=Le.height-this.screenRect.y-this.screenRect.height,De.mainContext.scissor(this.screenRect.x,t,this.screenRect.width,this.screenRect.height),De.mainContext.enable(3089)):(De.mainContext.disable(3089),Le.worldScissorTest=!1),s.copyFrom(this.screenRect),!0},e.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=i._cache;(e[e._length++]=this).context=null},i.create=function(e){var t=i._cache._length?i._cache[--i._cache._length]:new i;return t.context=e,t},i._cache=((i._cache=[])._length=0,i._cache),i}(),ge=function(){function l(){this.step=0,this.blendMode=null,this.level=0}d(l,"laya.webgl.submit.SubmitStencil");var e=l.prototype;return S.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=l._cache;e[e._length++]=this},e.do1=function(){var e=De.mainContext;e.enable(2960),e.clear(1024),e.colorMask(!1,!1,!1,!1),e.stencilFunc(514,this.level,255),e.stencilOp(7680,7680,7682)},e.do2=function(){var e=De.mainContext;e.stencilFunc(514,this.level+1,255),e.colorMask(!0,!0,!0,!0),e.stencilOp(7680,7680,7680)},e.do3=function(){var e=De.mainContext;e.colorMask(!0,!0,!0,!0),e.stencilOp(7680,7680,7680),e.clear(1024),e.disable(2960)},e.do4=function(){var e=De.mainContext;0==this.level&&(e.enable(2960),e.clear(1024)),e.colorMask(!1,!1,!1,!1),e.stencilFunc(519,0,255),e.stencilOp(7680,7680,7682)},e.do5=function(){var e=De.mainContext;e.stencilFunc(514,this.level,255),e.colorMask(!0,!0,!0,!0),e.stencilOp(7680,7680,7680)},e.do6=function(){var e=De.mainContext;W.targetFns[W.TOINT[this.blendMode]](e)},e.do7=function(){var e=De.mainContext;e.colorMask(!1,!1,!1,!1),e.stencilOp(7680,7680,7683)},e.do8=function(){var e=De.mainContext;e.colorMask(!0,!0,!0,!0),e.stencilFunc(514,this.level,255),e.stencilOp(7680,7680,7680)},l.restore=function(e,t,i,n,a){var r;if((e._renderKey=0)<l._mask&&l._mask--,0==l._mask)r=laya.webgl.submit.SubmitStencil.create(3),e.addRenderObject(r),e._curSubmit=de.RENDERBASE;else{r=laya.webgl.submit.SubmitStencil.create(7),e.addRenderObject(r);var s=e._vb;s._byteLength;if(we.fillRectImgVb(s,null,t.x,t.y,t.width,t.height,N.DEF_UV,i,n,a,0,0)){e._shader2D.glTexture=null;var o=e._curSubmit=de.createSubmit(e,e._ib,s,(s._byteLength-64)/32*3,Be.create(2,0));o.shaderValue.ALPHA=1,e._submits[e._submits._length++]=o,e._curSubmit._numEle+=6,e._curSubmit=de.RENDERBASE}else alert("clipRect calc stencil rect error");r=laya.webgl.submit.SubmitStencil.create(8),e.addRenderObject(r)}},l.restore2=function(e,t){var i;(e._renderKey=0)<l._mask&&l._mask--,0==l._mask?(i=laya.webgl.submit.SubmitStencil.create(3),e.addRenderObject(i),e._curSubmit=de.RENDERBASE):(i=laya.webgl.submit.SubmitStencil.create(7),e.addRenderObject(i),e._submits[e._submits._length++]=t,i=laya.webgl.submit.SubmitStencil.create(8),e.addRenderObject(i))},l.create=function(e){var t=l._cache._length?l._cache[--l._cache._length]:new l;return 5==(t.step=e)&&++l._mask,t.level=l._mask,t},l._cache=((l._cache=[])._length=0,l._cache),l._mask=0,l}(),ve=function(){function o(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}d(o,"laya.webgl.submit.SubmitTarget");var e=o.prototype;return S.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){this._vb.bind_upload(this._ib);var e=this.scope.getValue(this.proName);return e&&(this.shaderValue.texture=e.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[e.width,e.height]),this.shaderValue.upload(),this.blend(),A.drawCall++,A.trianglesFaces+=this._numEle/3,De.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},e.blend=function(){if(W.activeBlendFunction!==W.fns[this.blendType]){var e=De.mainContext;e.enable(3042),W.fns[this.blendType](e),W.activeBlendFunction=W.fns[this.blendType]}},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=o._cache;e[e._length++]=this},o.create=function(e,t,i,n,a,r){var s=o._cache._length?o._cache[--o._cache._length]:new o;return s._ib=t,s._vb=i,s.proName=r,s._startIdx=n*xe.BYTES_PIDX,s._numEle=0,s.blendType=e._nBlendType,s.shaderValue=a,s.shaderValue.setValue(e._shader2D),s},o._cache=((o._cache=[])._length=0,o._cache),o}(),ye=function(){function e(){this._sourceStr=null}d(e,"laya.webgl.text.CharSegment");var t=e.prototype;return S.imps(t,{"laya.webgl.text.ICharSegment":!0}),t.textToSpit=function(e){this._sourceStr=e},t.getChar=function(e){return this._sourceStr.charAt(e)},t.getCharCode=function(e){return this._sourceStr.charCodeAt(e)},t.length=function(){return this._sourceStr.length},e}(),Ce=(d(Ee,"laya.webgl.text.DrawText"),Ee.__init__=function(){Ee._charsTemp=new Array,Ee._drawValue=new ue,Ee._charSeg=new ye},Ee.customCharSeg=function(e){Ee._charSeg=e},Ee.getChar=function(e,t,i){var n=ut.createOneChar(e,i);return-1!=t&&(Ee._charsCache[t]=n),n},Ee._drawSlow=function(e,t,i,n,a,r,s,o,l,h,c,u,d,_,p){var f,m,g=Ee._drawValue.value(r,o,l,h,d,_,p),v=0,y=0,C=Ee._charsTemp,E=0,S=NaN;if(n)for(C.length=n.length,v=0,y=n.length;v<y;v++)S=(m=n[v]).charNum+g.txtID,C[v]=f=Ee._charsCache[S]||Ee.getChar(m.char,S,g),f.active();else{var x=i instanceof laya.utils.WordText?i.toString():i;if(P.CharacterCache){Ee._charSeg.textToSpit(x);var T=Ee._charSeg.length();for(v=0,y=C.length=T;v<y;v++)S=Ee._charSeg.getCharCode(v)+g.txtID,C[v]=f=Ee._charsCache[S]||Ee.getChar(Ee._charSeg.getChar(v),S,g),f.active(),E+=f.cw}else C.length=0,(f=Ee.getChar(x,-1,g)).active(),E+=f.cw,C[0]=f}var w=0;null!==s&&"left"!==s&&(w=-("center"==s?E/2:E));var M,b,R=NaN,L=0;if(n)for(v=0,y=C.length;v<y;v++)(f=C[v]).isSpace||(m=n[v],R=f.borderSize,M=f.texture,t._drawText(M,c+w+m.x*d-R,u+m.y*_-R,M.width,M.height,a,0,0,0,0));else{for(v=0,y=C.length;v<y;v++)(f=C[v]).isSpace||(R=f.borderSize,M=f.texture,t._drawText(M,c+w-R,u-R,M.width,M.height,a,0,0,0,0),e&&((b=(b=e[L++])||(e[L-1]=[]))[0]=M,b[1]=w-R,b[2]=-R)),w+=f.cw;e&&(e.length=L)}},Ee._drawFast=function(e,t,i,n,a){for(var r,s,o=0,l=e.length;o<l;o++)(r=(s=e[o])[0]).active(),t._drawText(r,n+s[1],a+s[2],r.width,r.height,i,0,0,0,0)},Ee.drawText=function(e,t,i,n,a,r,s,o,l,h,c,u){if(void 0===u&&(u=0),!(t&&0===t.length||i&&0===i.length)){var d=n.a,_=n.d;0===n.b&&0===n.c||(d=_=1);var p=1!==d||1!==_;if(p&&S.stage.transform){var f=S.stage.transform;p=f.a===d&&f.d===_}else p=!1;if(p){var m=(n=n.copyTo(Ve._tmpMatrix)).tx,g=n.ty;n.scale(1/d,1/_),n._checkTransform(),h*=d,c*=_,h+=m-n.tx,c+=g-n.ty}else d=_=1;if(i)Ee._drawSlow(null,e,t,i,n,a,r,s,o,l,h,c,d,_,u);else{if(null===t.toUpperCase){var v=d+1e5*_,y=t;return void(y.changed||y.id!==v?(y.id=v,y.changed=!1,Ee._drawSlow(y.save,e,t,i,n,a,r,s,o,l,h,c,d,_,u)):Ee._drawFast(y.save,e,n,h,c))}var C=t+a.toString()+s+o+l+d+_+r,E=Ee._textsCache[C];P.CharacterCache?E?Ee._drawFast(E,e,n,h,c):(Ee._textsCache.__length||(Ee._textsCache.__length=0),Ee._textsCache.__length>x.WebGLTextCacheCount&&((Ee._textsCache={}).__length=0,Ee._curPoolIndex=0),Ee._textCachesPool[Ee._curPoolIndex]?(E=Ee._textsCache[C]=Ee._textCachesPool[Ee._curPoolIndex]).length=0:Ee._textCachesPool[Ee._curPoolIndex]=E=Ee._textsCache[C]=[],Ee._textsCache.__length++,Ee._curPoolIndex++,Ee._drawSlow(E,e,t,i,n,a,r,s,o,l,h,c,d,_,u)):Ee._drawSlow(E,e,t,i,n,a,r,s,o,l,h,c,d,_,u)}}},Ee._charsTemp=null,Ee._textCachesPool=[],Ee._curPoolIndex=0,Ee._charsCache={},Ee._textsCache={},Ee._drawValue=null,Ee.d=[],Ee._charSeg=null,Ee.__init$=function(){function l(){}d(l,""),l.prototype.value=function(e,t,i,n,a,r,s){this.font=e,this.fillColor=t,this.borderColor=i,this.lineWidth=n,this.scaleX=a,this.scaleY=r,this.underLine=s;var o=e.toString()+a+r+n+t+i+s;return this.txtID=l._keymap[o],this.txtID||(this.txtID=1e-7*++l._keymapCount,l._keymap[o]=this.txtID),this},l.clear=function(){l._keymap={},l._keymapCount=1},l._keymap={},l._keymapCount=1,ue=l},Ee);function Ee(){}var Se=function(){function a(e){this._index=0,this._size=14,this._italic=-2,a._cache2=a._cache2||[],this.setFont(e||"14px Arial")}d(a,"laya.webgl.text.FontInContext");var e=a.prototype;return e.setFont=function(e){var t=a._cache2[e];if(t)this._words=t[0],this._size=t[1];else{this._words=e.split(" ");for(var i=0,n=this._words.length;i<n;i++)if(0<this._words[i].indexOf("px")){this._index=i;break}this._size=parseInt(this._words[this._index]),a._cache2[e]=[this._words,this._size]}this._text=null,this._italic=-2},e.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},e.hasType=function(e){for(var t=0,i=this._words.length;t<i;t++)if(this._words[t]===e)return t;return-1},e.removeType=function(e){for(var t=0,i=this._words.length;t<i;t++)if(this._words[t]===e){this._words.splice(t,1),this._index>t&&this._index--;break}this._text=null,this._italic=-2},e.copyTo=function(e){return e._text=this._text,e._size=this._size,e._index=this._index,e._words=this._words.slice(),e._italic=-2,e},e.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},n(0,e,"size",function(){return this._size},function(e){this._size=e,this._words[this._index]=e+"px",this._text=null}),a.create=function(e){var t=a._cache[e];return t||(t=a._cache[e]=new a(e))},a.EMPTY=new a,a._cache={},a._cache2=null,a}(),xe=(d(Te,"laya.webgl.utils.CONST3D2D"),Te.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Te.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],Te.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],Te._TMPARRAY=[],Te._OFFSETX=0,Te._OFFSETY=0,s(Te,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),Te);function Te(){}var we=(d(Me,"laya.webgl.utils.GlUtils"),Me.make2DProjection=function(e,t,i){return[2/e,0,0,0,0,-2/t,0,0,0,0,2/i,0,-1,1,0,1]},Me.fillIBQuadrangle=function(e,t){if(65535/4<t)throw Error("IBQuadrangle count:"+t+" must<:"+Math.floor(65535/4));t=Math.floor(t),e._resizeBuffer(6*(t+1)*2,!1),e.byteLength=e.bufferLength;for(var i=e.getUint16Array(),n=0,a=0;a<t;a++)i[n++]=4*a,i[n++]=4*a+2,i[n++]=4*a+1,i[n++]=4*a,i[n++]=4*a+3,i[n++]=4*a+2;return e.setNeedUpload(),!0},Me.expandIBQuadrangle=function(e,t){e.bufferLength>=6*t*2||Me.fillIBQuadrangle(e,t)},Me.mathCeilPowerOfTwo=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},Me.fillQuadrangleImgVb=function(e,t,i,n,a,r,s,o){var l=16+(e._byteLength>>2);e.byteLength=l<<2;var h=e.getFloat32Array();h[2+(l-=16)]=a[0],h[l+3]=a[1],h[l+6]=a[2],h[l+7]=a[3],h[l+10]=a[4],h[l+11]=a[5],h[l+14]=a[6],h[l+15]=a[7];var c=r.a,u=r.b,d=r.c,_=r.d;if(1!==c||0!==u||0!==d||1!==_){r.bTransform=!0;var p=r.tx+s,f=r.ty+o;h[l]=(n[0]+t)*c+(n[1]+i)*d+p,h[l+1]=(n[0]+t)*u+(n[1]+i)*_+f,h[l+4]=(n[2]+t)*c+(n[3]+i)*d+p,h[l+5]=(n[2]+t)*u+(n[3]+i)*_+f,h[l+8]=(n[4]+t)*c+(n[5]+i)*d+p,h[l+9]=(n[4]+t)*u+(n[5]+i)*_+f,h[l+12]=(n[6]+t)*c+(n[7]+i)*d+p,h[l+13]=(n[6]+t)*u+(n[7]+i)*_+f}else r.bTransform=!1,t+=r.tx+s,i+=r.ty+o,h[l]=t+n[0],h[l+1]=i+n[1],h[l+4]=t+n[2],h[l+5]=i+n[3],h[l+8]=t+n[4],h[l+9]=i+n[5],h[l+12]=t+n[6],h[l+13]=i+n[7];return e._upload=!0},Me.fillTranglesVB=function(e,t,i,n,a,r,s){var o=(e._byteLength>>2)+n.length;e.byteLength=o<<2;var l=e.getFloat32Array();o-=n.length;for(var h=n.length,c=a.a,u=a.b,d=a.c,_=a.d,p=0;p<h;p+=4)if(l[o+p+2]=n[p+2],l[o+p+3]=n[p+3],1!==c||0!==u||0!==d||1!==_){a.bTransform=!0;var f=a.tx+r,m=a.ty+s;l[o+p]=(n[p]+t)*c+(n[p+1]+i)*d+f,l[o+p+1]=(n[p]+t)*u+(n[p+1]+i)*_+m}else a.bTransform=!1,t+=a.tx+r,i+=a.ty+s,l[o+p]=t+n[p],l[o+p+1]=i+n[p+1];return e._upload=!0},Me.copyPreImgVb=function(e,t,i){var n=e._byteLength>>2;e.byteLength=n+16<<2;for(var a=e.getFloat32Array(),r=0,s=n-16;r<4;r++)a[n]=a[s]+t,++s,a[++n]=a[s]+i,++s,a[++n]=a[s],++s,a[++n]=a[s],++n,++s;e._upload=!0},Me.fillRectImgVb=function(e,t,i,n,a,r,s,o,l,h,c,u,d){void 0===d&&(d=!1);var _,p,f,m,g,v,y,C,E,S,x,T,w,M,b,R,L=1,A=o.a,I=o.b,D=o.c,P=o.d,N=t&&t.width<99999999;if(1!==A||0!==I||0!==D||1!==P?(o.bTransform=!0,0===I&&0===D&&(L=23,E=a+i,S=r+n,_=A*i+(x=o.tx+l),f=A*E+x,p=P*n+(T=o.ty+h),m=P*S+T)):(L=23,o.bTransform=!1,f=(_=i+o.tx+l)+a,m=(p=n+o.ty+h)+r),N&&(g=t.x,v=t.y,y=t.width+g,C=t.height+v),1!==L){if(Math.min(_,f)>=y)return!1;if(Math.min(p,m)>=C)return!1;if(Math.max(f,_)<=g)return!1;if(Math.max(m,p)<=v)return!1}var O=e._byteLength>>2;e.byteLength=16+O<<2;var k=e.getFloat32Array();switch(k[2+O]=s[0],k[3+O]=s[1],k[6+O]=s[2],k[7+O]=s[3],k[10+O]=s[4],k[11+O]=s[5],k[14+O]=s[6],k[15+O]=s[7],L){case 1:x=o.tx+l,T=o.ty+h;var V=A*i,B=D*n,F=P*n,H=I*i,U=A*(E=a+i),G=D*(S=r+n),z=P*S,W=I*E;d?(w=V+B+x,b=Math.round(w)-w,M=F+H+T,R=Math.round(M)-M,k[O]=w+b,k[1+O]=M+R,k[4+O]=U+B+x+b,k[5+O]=F+W+T+R,k[8+O]=U+G+x+b,k[9+O]=z+W+T+R,k[12+O]=V+G+x+b,k[13+O]=z+H+T+R):(k[O]=V+B+x,k[1+O]=F+H+T,k[4+O]=U+B+x,k[5+O]=F+W+T,k[8+O]=U+G+x,k[9+O]=z+W+T,k[12+O]=V+G+x,k[13+O]=z+H+T);break;case 23:d?(w=_+c,b=Math.round(w)-w,M=p,R=Math.round(M)-M,k[O]=w+b,k[1+O]=M+R,k[4+O]=f+c+b,k[5+O]=p+R,k[8+O]=f+b,k[9+O]=m+R,k[12+O]=_+b,k[13+O]=m+R):(k[O]=_+c,k[1+O]=p,k[4+O]=f+c,k[5+O]=p,k[8+O]=f,k[9+O]=m,k[12+O]=_,k[13+O]=m)}return e._upload=!0},Me.fillLineVb=function(e,t,i,n,a,r,s,o){var l=.5*s,h=Me._fillLineArray,c=-(n-r),u=i-a,d=Math.sqrt(c*c+u*u);c/=d,u/=d,c*=l,u*=l,h[0]=i-c,h[1]=n-u,h[4]=i+c,h[5]=n+u,h[8]=a+c,h[9]=r+u,h[12]=a-c,h[13]=r-u,o&&o.transformPointArray(h,h);var _=16+(e._byteLength>>2);return e.byteLength=_<<2,e.insertData(h,_-16),!0},Me._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Me);function Me(){}d(be,"laya.webgl.utils.MatirxArray"),be.ArrayMul=function(e,t,i){if(e)if(t)for(var n=NaN,a=NaN,r=NaN,s=NaN,o=0;o<4;o++)n=e[o],a=e[o+4],r=e[o+8],s=e[o+12],i[o]=n*t[0]+a*t[1]+r*t[2]+s*t[3],i[o+4]=n*t[4]+a*t[5]+r*t[6]+s*t[7],i[o+8]=n*t[8]+a*t[9]+r*t[10]+s*t[11],i[o+12]=n*t[12]+a*t[13]+r*t[14]+s*t[15];else be.copyArray(e,i);else be.copyArray(t,i)},be.copyArray=function(e,t){if(e&&t)for(var i=0;i<e.length;i++)t[i]=e[i]};function be(){}var Re=function(){function t(e,t,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=e,this._vb=new yt(e,35048),t&&this._vb._resizeBuffer(t,!1),this._ib=new vt,i&&this._ib._resizeBuffer(i,!1)}d(t,"laya.webgl.utils.Mesh2D");var e=t.prototype;return e.cloneWithNewVB=function(){var e=new t(this._stride,0,0);return e._ib=this._ib,e._quadNum=this._quadNum,e._attribInfo=this._attribInfo,e},e.cloneWithNewVBIB=function(){var e=new t(this._stride,0,0);return e._attribInfo=this._attribInfo,e},e.getVBW=function(){return this._vb.setNeedUpload(),this._vb},e.getVBR=function(){return this._vb},e.getIBR=function(){return this._ib},e.getIBW=function(){return this._ib.setNeedUpload(),this._ib},e.createQuadIB=function(e){this._quadNum=e,this._ib._resizeBuffer(6*e*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var t=this._ib.getUint16Array(),i=0,n=0,a=0;a<e;a++)t[i++]=n,t[i++]=n+2,t[i++]=n+1,t[i++]=n,t[i++]=n+3,t[i++]=n+2,n+=4;this._ib.setNeedUpload()},e.setAttributes=function(e){if(this._attribInfo=e,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},e.getEleNum=function(){return this._ib.getBuffer().byteLength/2},e.releaseMesh=function(){},e.destroy=function(){},e.clearVB=function(){this._vb.clear()},t._gvaoid=0,t}(),Le=(d(Ae,"laya.webgl.utils.RenderState2D"),Ae.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},Ae.mat2MatArray=function(e,t){var i=e,n=t;return n[0]=i.a,n[1]=i.b,n[2]=Ae.EMPTYMAT4_ARRAY[2],n[3]=Ae.EMPTYMAT4_ARRAY[3],n[4]=i.c,n[5]=i.d,n[6]=Ae.EMPTYMAT4_ARRAY[6],n[7]=Ae.EMPTYMAT4_ARRAY[7],n[8]=Ae.EMPTYMAT4_ARRAY[8],n[9]=Ae.EMPTYMAT4_ARRAY[9],n[10]=Ae.EMPTYMAT4_ARRAY[10],n[11]=Ae.EMPTYMAT4_ARRAY[11],n[12]=i.tx,n[13]=i.ty,n[14]=Ae.EMPTYMAT4_ARRAY[14],n[15]=Ae.EMPTYMAT4_ARRAY[15],t},Ae.restoreTempArray=function(){Ae.TEMPMAT4_ARRAY[0]=1,Ae.TEMPMAT4_ARRAY[1]=0,Ae.TEMPMAT4_ARRAY[4]=0,Ae.TEMPMAT4_ARRAY[5]=1,Ae.TEMPMAT4_ARRAY[12]=0,Ae.TEMPMAT4_ARRAY[13]=0},Ae.clear=function(){Ae.worldScissorTest=!1,Ae.worldShaderDefines=null,Ae.worldFilters=null,Ae.worldAlpha=1,Ae.worldClipRect.x=Ae.worldClipRect.y=0,Ae.worldClipRect.width=Ae.width,Ae.worldClipRect.height=Ae.height,Ae.curRenderTarget=null},Ae._MAXSIZE=99999999,Ae.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ae.worldMatrix4=Ae.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ae.worldAlpha=1,Ae.worldScissorTest=!1,Ae.worldFilters=null,Ae.worldShaderDefines=null,Ae.curRenderTarget=null,Ae.width=0,Ae.height=0,s(Ae,["worldMatrix",function(){return this.worldMatrix=new w},"worldClipRect",function(){return this.worldClipRect=new b(0,0,99999999,99999999)}]),Ae);function Ae(){}var Ie=function(){var v,i;function y(e,t,i,n,a){var r=this;function s(e){var t=[],i=new v(t);return r._compileToTree(i,e.split("\n"),0,t,a),i}var o=_.now();this._VS=s(t),this._PS=s(i),this._nameMap=n,2<_.now()-o&&console.log("ShaderCompile use time:"+(_.now()-o)+"  size:"+t.length+"/"+i.length)}d(y,"laya.webgl.utils.ShaderCompile");var e=y.prototype;return e._compileToTree=function(e,t,i,n,a){var r,s,o,l,h,c,u,d=0,_=0,p=0,f=0;for(_=i;_<t.length;_++)if(!((o=t[_]).length<1)&&0!==(d=o.indexOf("//"))){if(0<=d&&(o=o.substr(0,d)),r=u||new v(n),u=null,r.text=o,r.noCompile=!0,0<=(d=o.indexOf("#"))){for(l="#",f=d+1,p=o.length;f<p;f++){var m=o.charAt(f);if(" "===m||"\t"===m||"?"===m)break;l+=m}switch(r.name=l){case"#ifdef":case"#ifndef":if(r.src=o,r.noCompile=null!=o.match(/[!&|()=<>]/),r.noCompile?console.log("function():Boolean{return "+o.substr(d+r.name.length)+"}"):(c=o.replace(/^\s*/,"").split(/\s+/),r.setCondition(c[1],"#ifdef"===l?1:2),r.text="//"+r.text),r.setParent(e),e=r,a)for(c=o.substr(f).split(y._splitToWordExps3),f=0;f<c.length;f++)(o=c[f]).length&&(a[o]=!0);continue;case"#if":if(r.src=o,r.noCompile=!0,r.setParent(e),e=r,a)for(c=o.substr(f).split(y._splitToWordExps3),f=0;f<c.length;f++)(o=c[f]).length&&"defined"!=o&&(a[o]=!0);continue;case"#else":r.src=o,s=(e=e.parent).childs[e.childs.length-1],r.noCompile=s.noCompile,r.noCompile||(r.condition=s.condition,r.conditionType=1==s.conditionType?2:1,r.text="//"+r.text+" "+s.text+" "+r.conditionType),r.setParent(e),e=r;continue;case"#endif":s=(e=e.parent).childs[e.childs.length-1],r.noCompile=s.noCompile,r.noCompile||(r.text="//"+r.text),r.setParent(e);continue;case"#include":c=y.splitToWords(o,null);var g=y.includes[c[1]];if(!g)throw"ShaderCompile error no this include file:"+c[1];if((d=c[0].indexOf("?"))<0){r.setParent(e),o=g.getWith("with"==c[2]?c[3]:null),this._compileToTree(r,o.split("\n"),0,n,a),r.text="";continue}r.setCondition(c[0].substr(d+1),1),r.text=g.getWith("with"==c[2]?c[3]:null);break;case"#import":h=(c=y.splitToWords(o,null))[1],n.push({node:r,file:y.includes[h],ofs:r.text.length});continue}}else{if((s=e.childs[e.childs.length-1])&&!s.name){0<n.length&&y.splitToWords(o,s),u=r,s.text+="\n"+o;continue}0<n.length&&y.splitToWords(o,r)}r.setParent(e)}},e.createShader=function(e,t,i){var n={},a="";if(e)for(var r in e)a+="#define "+r+"\n",n[r]=!0;var s=this._VS.toscript(n,[]),o=this._PS.toscript(n,[]);return(i||pt.create)(a+s.join("\n"),a+o.join("\n"),t,this._nameMap)},y._parseOne=function(e,t,i,n,a,r){var s={type:y.shaderParamsMap[i[n+1]],name:i[n+2],size:isNaN(parseInt(i[n+3]))?1:parseInt(i[n+3])};return r&&("attribute"==a?e.push(s):t.push(s)),":"==i[n+3]&&(s.type=i[n+4],n+=2),n+=2},y.addInclude=function(e,t){if(!t||0===t.length)throw new Error("add shader include file err:"+e);if(y.includes[e])throw new Error("add shader include file err, has add:"+e);y.includes[e]=new i(t)},y.preGetParams=function(e,t){var i=[e,t],n={},a=[],r=[],s={},o=[];n.attributes=a,n.uniforms=r,n.defines=s;for(var l=0,h=0,c=0;c<2;c++){i[c]=i[c].replace(y._removeAnnotation,"");var u,d=i[c].match(y._reg);for(l=0,h=d.length;l<h;l++){var _=d[l];if("attribute"==_||"uniform"==_)l=y._parseOne(a,r,d,l,_,!0);else{if("#define"==_){o[_=d[++l]]=1;continue}if("#ifdef"==_){s[u=d[++l]]=s[u]||[];for(l++;l<h;l++)if("attribute"==(_=d[l])||"uniform"==_)l=y._parseOne(a,r,d,l,_,o[u]);else if("#else"==_)for(l++;l<h;l++)if("attribute"==(_=d[l])||"uniform"==_)l=y._parseOne(a,r,d,l,_,!o[u]);else if("#endif"==_)break}}}}return n},y.splitToWords=function(e,t){for(var i,n,a=[],r=-1,s=0,o=e.length;s<o;s++)if(i=e.charAt(s),0<=" \t=+-*/&%!<>()'\",;".indexOf(i)){if(0<=r&&1<s-r&&(n=e.substr(r,s-r),a.push(n)),'"'==i||"'"==i){var l=e.indexOf(i,s+1);if(l<0)throw"Sharder err:"+e;a.push(e.substr(s+1,l-s-1)),s=l,r=-1;continue}"("==i&&t&&0<a.length&&(n=a[a.length-1]+";","vec4;main;".indexOf(n)<0&&(t.useFuns+=n)),r=-1}else r<0&&(r=s);return r<o&&1<o-r&&(n=e.substr(r,o-r),a.push(n)),a},y.IFDEF_NO=0,y.IFDEF_YES=1,y.IFDEF_ELSE=2,y.IFDEF_PARENT=3,y._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),y._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),y._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),y.includes={},s(y,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),y.__init$=function(){v=function(){function i(e){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=e}d(i,"");var e=i.prototype;return e.setParent=function(e){e.childs.push(this),this.z=e.z+1,this.parent=e},e.setCondition=function(e,t){e&&(this.conditionType=t,e=e.replace(/(\s*$)/g,""),this.condition=function(){return this[e]},this.condition.__condition=e)},e.toscript=function(e,t){return this._toscript(e,t,++i.__id)},e._toscript=function(n,a,r){if(this.childs.length<1&&!this.text)return a;a.length;if(this.condition){var e=!!this.condition.call(n);if(2===this.conditionType&&(e=!e),!e)return a}if(this.text&&a.push(this.text),0<this.childs.length&&this.childs.forEach(function(e,t,i){e._toscript(n,a,r)}),0<this.includefiles.length&&0<this.useFuns.length)for(var t,i=0,s=this.includefiles.length;i<s;i++)this.includefiles[i].curUseID!=r&&0<(t=this.includefiles[i].file.getFunsScript(this.useFuns)).length&&(this.includefiles[i].curUseID=r,a[0]=t+a[0]);return a},i.__id=1,i}(),i=function(){function e(e){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=e;for(var t=0,i=0,n=0;!((t=e.indexOf("#begin",t))<0);){for(n=t+5;!((n=e.indexOf("#end",n))<0)&&"i"===e.charAt(n+4);)n+=5;if(n<0)throw"add include err,no #end:"+e;i=e.indexOf("\n",t);var a=y.splitToWords(e.substr(t,i-t),null);"code"==a[1]?this.codes[a[2]]=e.substr(i+1,n-i-1):"function"==a[1]&&(i=e.indexOf("function",t),i+="function".length,this.funs[a[3]]=e.substr(i+1,n-i-1),this.funnames+=a[3]+";"),t=n+1}}d(e,"");var t=e.prototype;return t.getWith=function(e){var t=e?this.codes[e]:this.script;if(!t)throw"get with error:"+e;return t},t.getFunsScript=function(e){var t="";for(var i in this.funs)0<=e.indexOf(i+";")&&(t+=this.funs[i]);return t},e}()},y}(),De=(d(Pe,"laya.webgl.WebGL"),Pe._uint8ArraySlice=function(){for(var e=this.length,t=new Uint8Array(this.length),i=0;i<e;i++)t[i]=this[i];return t},Pe._float32ArraySlice=function(){for(var e=this.length,t=new Float32Array(this.length),i=0;i<e;i++)t[i]=this[i];return t},Pe._uint16ArraySlice=function(e){var t,i=arguments,n=0,a=0;if(0===i.length)for(n=this.length,t=new Uint16Array(n),a=0;a<n;a++)t[a]=this[a];else if(2===i.length){var r=i[0],s=i[1];if(r<s)for(n=s-r,t=new Uint16Array(n),a=r;a<s;a++)t[a-r]=this[a];else t=new Uint16Array(0)}return t},Pe.expandContext=function(){var e=a.prototype,t=CanvasRenderingContext2D.prototype;t.fillTrangles=e.fillTrangles,ft.__int__(null),t.setIBVB=function(e,t,i,n,a,r,s,o,l,h){void 0===l&&(l=0),void 0===h&&(h=0),null===i&&(this._ib=this._ib||vt.QuadrangleIB,i=this._ib,we.expandIBQuadrangle(i,n._byteLength/64+8)),this._setIBVB(e,t,i,n,a,r,s,o,l,h)},t.fillTrangles=function(e,t,i,n,a){this._curMat=this._curMat||w.create(),this._vb=this._vb||yt.create(),this._ib||(this._ib=vt.create(),we.fillIBQuadrangle(this._ib,s/4));var r=this._vb,s=n.length>>4;we.fillTranglesVB(r,t,i,n,a||this._curMat,0,0),we.expandIBQuadrangle(this._ib,r._byteLength/64+8);var o=new Be(1,0);o.textureHost=e;var l=new gt("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; void main() {vec4 color= texture2D(texture, v_texcoord); color.a*=1.0; gl_FragColor= color;}");r._vertType=3,this._setIBVB(t,i,this._ib,r,6*s,a,l,o,0,0)}},Pe.enable=function(){if(_.__init__(),g.isConchApp&&!g.isConchWebGL)return E.skinAniSprite=function(){return new ae},Pe.expandContext(),!1;if(E.getWebGLContext=function(e){for(var t,i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=0;n<i.length;n++){try{t=e.getContext(i[n],{stencil:x.isStencil,alpha:x.isAlpha,antialias:x.isAntialias,premultipliedAlpha:x.premultipliedAlpha,preserveDrawingBuffer:x.preserveDrawingBuffer})}catch(e){}if(t)return t}return null},null==(Pe.mainContext=E.getWebGLContext(g._mainCanvas)))return!1;if(g.isWebGL)return!0;f.create=function(e,t){return new Ct(e,t)},m.create=function(e,t,i,n,a,r,s){return new _t(e,t,i,n,a,r,s)},g.WebGL=Pe,g.isWebGL=!0,Ce.__init__(),E.createRenderSprite=function(e,t){return new Fe(e,t)},E.createWebGLContext2D=function(e){return new Ve(e)},E.changeWebGLSize=function(e,t){laya.webgl.WebGL.onStageResize(e,t)},E.createGraphics=function(){return new ke};var e=E.createFilterAction;return E.createFilterAction=e||function(e){return new He},E.clear=function(e){Le.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var t=g.context.ctx,i=0==t._submits._length||x.preserveDrawingBuffer?p.create(e)._color:L._wgColor;i&&t.clearBG(i[0],i[1],i[2],i[3]),Le.clear()},E.addToAtlas=function(e,t){void 0===t&&(t=!1);var i=e.bitmap;g.optimizeTextureMemory(e.url,e)?S.__typeof(i,"laya.webgl.resource.IMergeAtlasBitmap")&&i.allowMerageInAtlas&&i.on("recovered",e,e.addTextureToAtlas):i.enableMerageInAtlas=!1},E.isAtlas=function(e){return e instanceof laya.webgl.atlas.AtlasWebGLCanvas},U._enable(),E.beginFlush=function(){for(var e=U.instance,t=e.getAtlaserCount(),i=0;i<t;i++){var n=e.getAtlaserByIndex(i).texture;n._flashCacheImageNeedFlush&&E.flashFlushImage(n)}},E.drawToCanvas=function(e,t,i,n,a,r){(i<=0||n<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),i|=0,n|=0,a|=0,r|=0;var s=Je.create(i,n,6408,5121,0,!1);s.start(),s.clear(0,0,0,0),g.context.clear(),v.renders[t]._fun(e,g.context,a,Le.height-n+r),g.context.flush(),s.end();var o=s.getData(0,0,i,n);if(s.recycle(),o.byteLength==i*n*4){var l=new ct;l._canvas=_.createElement("canvas"),l.size(i,n);var h=l._canvas.getContext("2d");_.canvas.size(i,n);var c=_.context,u=c.createImageData(i,n);return u.data.set(new Uint8ClampedArray(o.buffer)),l._imgData=u,c.putImageData(u,0,0),h.save(),h.translate(0,n),h.scale(1,-1),h.drawImage(_.canvas.source,0,0),h.restore(),l}console.log("drawToCanvas error: w:"+i+",h:"+n+",datalen:"+o.byteLength)},E.createFilterAction=function(e){var t;switch(e){case 32:t=new He}return t},E.addTextureToAtlas=function(e){e._uvID++,U._atlasRestore++,e.bitmap.enableMerageInAtlas&&U.instance.addToAtlas(e)},E.getTexturePixels=function(e,t,i,n,a){g.context.ctx.clear();var r=new R;r.graphics.drawTexture(e,-t,-i);var s=Je.create(n,a);s.start(),s.clear(0,0,0,0),r.render(g.context,0,0),g.context.ctx.flush(),s.end();for(var o=s.getData(0,0,n,a),l=[],h=0,c=a-1;0<=c;c--)for(var u=0;u<n;u++)h=4*(c*n+u),l.push(o[h]),l.push(o[h+1]),l.push(o[h+2]),l.push(o[h+3]);return l},E.skinAniSprite=function(){return new ae},u.create=function(e,t){var i=new ct;return i._imgData=t,i.flipY=!1,i},T._filterStart=function(e,t,i,n,a){var r=e.getValue("bounds"),s=Je.create(r.width,r.height);if(s.start(),s.clear(0,0,0,0),e.addValue("src",s),e.addValue("ScissorTest",Le.worldScissorTest),Le.worldScissorTest){var o=new b;o.copyFrom(i.ctx._clipRect),e.addValue("clipRect",o),Le.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},T._filterEnd=function(e,t,i,n,a){var r=e.getValue("bounds");e.getValue("src").end();var s=Je.create(r.width,r.height);s.start(),s.clear(0,0,0,0),e.addValue("out",s),t._set$P("_filterCache",s),t._set$P("_isHaveGlowFilter",e.getValue("_isHaveGlowFilter"))},T._EndTarget=function(e,t){if(e.getValue("src").recycle(),e.getValue("out").end(),e.getValue("ScissorTest")){Le.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),t.ctx.save();var i=e.getValue("clipRect");t.ctx.clipRect(i.x,i.y,i.width,i.height)}},T._useSrc=function(e){var t=e.getValue("out");t.end(),(t=e.getValue("src")).start(),t.clear(0,0,0,0)},T._endSrc=function(e){e.getValue("src").end()},T._useOut=function(e){var t=e.getValue("src");t.end(),(t=e.getValue("out")).start(),t.clear(0,0,0,0)},T._endOut=function(e){e.getValue("out").end()},T._recycleScope=function(e){e.recycle()},T._filter=function(e,t,i,n){var a=this._next;if(a){var r,s,o=e.filters,l=o.length;if(1==l&&32==o[0].type)return t.ctx.save(),t.ctx.setFilters([o[0]]),a._fun.call(a,e,t,i,n),void t.ctx.restore();var h=pe.create(),c=M.TEMP,u=t.ctx._getTransformMatrix(),d=w.create();u.copyTo(d);var _=0,p=0,f=!1,m=e._$P._filterCache?e._$P._filterCache:null;if(!m||e._repaint){f=e._isHaveGlowFilter(),h.addValue("_isHaveGlowFilter",f),f&&(_=50,p=25),(s=new b).copyFrom(e.getSelfBounds()),s.x+=e.x,s.y+=e.y,s.x-=e.pivotX+4,s.y-=e.pivotY+4;var g=s.x,v=s.y;if(s.width+=_+8,s.height+=_+8,c.x=s.x*d.a+s.y*d.c,c.y=s.y*d.d+s.x*d.b,s.x=c.x,s.y=c.y,c.x=s.width*d.a+s.height*d.c,c.y=s.height*d.d+s.width*d.b,s.width=c.x,s.height=c.y,s.width<=0||s.height<=0)return;m&&m.recycle(),h.addValue("bounds",s);var y=_e.create([h,e,t,0,0],T._filterStart);t.addRenderObject(y),t.ctx._renderKey=0,t.ctx._shader2D.glTexture=null;var C=e.x-g+p,E=e.y-v+p;a._fun.call(a,e,t,C,E),y=_e.create([h,e,t,0,0],T._filterEnd),t.addRenderObject(y);for(var S=0;S<l;S++)0!=S&&(y=_e.create([h],T._useSrc),t.addRenderObject(y),r=Be.create(1,0),w.TEMP.identity(),t.ctx.drawTarget(h,0,0,s.width,s.height,w.TEMP,"out",r,null,W.TOINT.overlay),y=_e.create([h],T._useOut),t.addRenderObject(y)),o[S].action.apply3d(h,e,t,0,0);y=_e.create([h,t],T._EndTarget),t.addRenderObject(y)}else{if((f=!!e._$P._isHaveGlowFilter&&e._$P._isHaveGlowFilter)&&(_=50,p=25),(s=e.getBounds()).width<=0||s.height<=0)return;s.width+=_,s.height+=_,c.x=s.x*d.a+s.y*d.c,c.y=s.y*d.d+s.x*d.b,s.x=c.x,s.y=c.y,c.x=s.width*d.a+s.height*d.c,c.y=s.height*d.d+s.width*d.b,s.width=c.x,s.height=c.y,h.addValue("out",m)}i=i-p-e.x,n=n-p-e.y,c.setTo(i,n),d.transformPoint(c),i=c.x+s.x,n=c.y+s.y,r=Be.create(1,0),w.TEMP.identity(),t.ctx.drawTarget(h,i,n,s.width,s.height,w.TEMP,"out",r,null,W.TOINT.overlay),y=_e.create([h],T._recycleScope),t.addRenderObject(y),d.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=Pe._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=Pe._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=Pe._uint8ArraySlice),!0},Pe.onStageResize=function(e,t){null!=Pe.mainContext&&(Pe.mainContext.viewport(0,0,e,t),Le.width=e,Le.height=t)},Pe.onInvalidGLRes=function(){U.instance.freeAll(),C.releaseContentManagers(!0),Pe.doNodeRepaint(S.stage),Pe.mainContext.viewport(0,0,Le.width,Le.height),S.stage.event("devicelost")},Pe.doNodeRepaint=function(e){0==e.numChildren&&e.repaint();for(var t=0;t<e.numChildren;t++)Pe.doNodeRepaint(e.getChildAt(t))},Pe.init=function(e,t,i){Pe.mainCanvas=e,u._createContext=function(e){return new Ve(e)},ct._createContext=function(e){return new Ve(e)};var n=laya.webgl.WebGL.mainContext;if(null!=n.getShaderPrecisionFormat){var a=n.getShaderPrecisionFormat(35633,36338),r=n.getShaderPrecisionFormat(35632,36338);Pe.shaderHighPrecision=!(!a.precision||!r.precision)}else Pe.shaderHighPrecision=!1;if(Pe.compressAstc=n.getExtension("WEBGL_compressed_texture_astc"),Pe.compressAtc=n.getExtension("WEBGL_compressed_texture_atc"),Pe.compressEtc=n.getExtension("WEBGL_compressed_texture_etc"),Pe.compressEtc1=n.getExtension("WEBGL_compressed_texture_etc1"),Pe.compressPvrtc=n.getExtension("WEBGL_compressed_texture_pvrtc"),Pe.compressS3tc=n.getExtension("WEBGL_compressed_texture_s3tc"),Pe.compressS3tc_srgb=n.getExtension("WEBGL_compressed_texture_s3tc_srgb"),n.deleteTexture1=n.deleteTexture,n.deleteTexture=function(e){e==Ne.curBindTexValue&&(Ne.curBindTexValue=null),n.deleteTexture1(e)},Pe.onStageResize(t,i),null==Pe.mainContext)throw new Error("webGL getContext err!");D.__init__(),U.__init__(),Ge.__init__(),de.__init__(),Ve.__init__(),Be.__init__(),te.__init__(),ft.__int__(n),W._init_(n),g.isConchApp&&conch.setOnInvalidGLRes(Pe.onInvalidGLRes)},Pe.compressAstc=null,Pe.compressAtc=null,Pe.compressEtc=null,Pe.compressEtc1=null,Pe.compressPvrtc=null,Pe.compressS3tc=null,Pe.compressS3tc_srgb=null,Pe.mainCanvas=null,Pe.mainContext=null,Pe.antialias=!0,Pe.shaderHighPrecision=!1,Pe._bg_null=[0,0,0,0],Pe);function Pe(){}var Ne=(d(Oe,"laya.webgl.WebGLContext"),Oe.UseProgram=function(e){return Oe._useProgram!==e&&(De.mainContext.useProgram(e),Oe._useProgram=e,!0)},Oe.setDepthTest=function(e,t){t!==Oe._depthTest&&((Oe._depthTest=t)?e.enable(2929):e.disable(2929))},Oe.setDepthMask=function(e,t){t!==Oe._depthMask&&(Oe._depthMask=t,e.depthMask(t))},Oe.setDepthFunc=function(e,t){t!==Oe._depthFunc&&(Oe._depthFunc=t,e.depthFunc(t))},Oe.setBlend=function(e,t){t!==Oe._blend&&((Oe._blend=t)?e.enable(3042):e.disable(3042))},Oe.setBlendFunc=function(e,t,i){t===Oe._sFactor&&i===Oe._dFactor||(Oe._sFactor=t,Oe._dFactor=i,e.blendFunc(t,i))},Oe.setCullFace=function(e,t){t!==Oe._cullFace&&((Oe._cullFace=t)?e.enable(2884):e.disable(2884))},Oe.setFrontFace=function(e,t){t!==Oe._frontFace&&(Oe._frontFace=t,e.frontFace(t))},Oe.bindTexture=function(e,t,i){e.bindTexture(t,i),Oe.curBindTexTarget=t,Oe.curBindTexValue=i},Oe.DEPTH_BUFFER_BIT=256,Oe.STENCIL_BUFFER_BIT=1024,Oe.COLOR_BUFFER_BIT=16384,Oe.POINTS=0,Oe.LINES=1,Oe.LINE_LOOP=2,Oe.LINE_STRIP=3,Oe.TRIANGLES=4,Oe.TRIANGLE_STRIP=5,Oe.TRIANGLE_FAN=6,Oe.ZERO=0,Oe.ONE=1,Oe.SRC_COLOR=768,Oe.ONE_MINUS_SRC_COLOR=769,Oe.SRC_ALPHA=770,Oe.ONE_MINUS_SRC_ALPHA=771,Oe.DST_ALPHA=772,Oe.ONE_MINUS_DST_ALPHA=773,Oe.DST_COLOR=774,Oe.ONE_MINUS_DST_COLOR=775,Oe.SRC_ALPHA_SATURATE=776,Oe.FUNC_ADD=32774,Oe.BLEND_EQUATION=32777,Oe.BLEND_EQUATION_RGB=32777,Oe.BLEND_EQUATION_ALPHA=34877,Oe.FUNC_SUBTRACT=32778,Oe.FUNC_REVERSE_SUBTRACT=32779,Oe.BLEND_DST_RGB=32968,Oe.BLEND_SRC_RGB=32969,Oe.BLEND_DST_ALPHA=32970,Oe.BLEND_SRC_ALPHA=32971,Oe.CONSTANT_COLOR=32769,Oe.ONE_MINUS_CONSTANT_COLOR=32770,Oe.CONSTANT_ALPHA=32771,Oe.ONE_MINUS_CONSTANT_ALPHA=32772,Oe.BLEND_COLOR=32773,Oe.ARRAY_BUFFER=34962,Oe.ELEMENT_ARRAY_BUFFER=34963,Oe.ARRAY_BUFFER_BINDING=34964,Oe.ELEMENT_ARRAY_BUFFER_BINDING=34965,Oe.STREAM_DRAW=35040,Oe.STATIC_DRAW=35044,Oe.DYNAMIC_DRAW=35048,Oe.BUFFER_SIZE=34660,Oe.BUFFER_USAGE=34661,Oe.CURRENT_VERTEX_ATTRIB=34342,Oe.FRONT=1028,Oe.BACK=1029,Oe.CULL_FACE=2884,Oe.FRONT_AND_BACK=1032,Oe.BLEND=3042,Oe.DITHER=3024,Oe.STENCIL_TEST=2960,Oe.DEPTH_TEST=2929,Oe.SCISSOR_TEST=3089,Oe.POLYGON_OFFSET_FILL=32823,Oe.SAMPLE_ALPHA_TO_COVERAGE=32926,Oe.SAMPLE_COVERAGE=32928,Oe.NO_ERROR=0,Oe.INVALID_ENUM=1280,Oe.INVALID_VALUE=1281,Oe.INVALID_OPERATION=1282,Oe.OUT_OF_MEMORY=1285,Oe.CW=2304,Oe.CCW=2305,Oe.LINE_WIDTH=2849,Oe.ALIASED_POINT_SIZE_RANGE=33901,Oe.ALIASED_LINE_WIDTH_RANGE=33902,Oe.CULL_FACE_MODE=2885,Oe.FRONT_FACE=2886,Oe.DEPTH_RANGE=2928,Oe.DEPTH_WRITEMASK=2930,Oe.DEPTH_CLEAR_VALUE=2931,Oe.DEPTH_FUNC=2932,Oe.STENCIL_CLEAR_VALUE=2961,Oe.STENCIL_FUNC=2962,Oe.STENCIL_FAIL=2964,Oe.STENCIL_PASS_DEPTH_FAIL=2965,Oe.STENCIL_PASS_DEPTH_PASS=2966,Oe.STENCIL_REF=2967,Oe.STENCIL_VALUE_MASK=2963,Oe.STENCIL_WRITEMASK=2968,Oe.STENCIL_BACK_FUNC=34816,Oe.STENCIL_BACK_FAIL=34817,Oe.STENCIL_BACK_PASS_DEPTH_FAIL=34818,Oe.STENCIL_BACK_PASS_DEPTH_PASS=34819,Oe.STENCIL_BACK_REF=36003,Oe.STENCIL_BACK_VALUE_MASK=36004,Oe.STENCIL_BACK_WRITEMASK=36005,Oe.VIEWPORT=2978,Oe.SCISSOR_BOX=3088,Oe.COLOR_CLEAR_VALUE=3106,Oe.COLOR_WRITEMASK=3107,Oe.UNPACK_ALIGNMENT=3317,Oe.PACK_ALIGNMENT=3333,Oe.MAX_TEXTURE_SIZE=3379,Oe.MAX_VIEWPORT_DIMS=3386,Oe.SUBPIXEL_BITS=3408,Oe.RED_BITS=3410,Oe.GREEN_BITS=3411,Oe.BLUE_BITS=3412,Oe.ALPHA_BITS=3413,Oe.DEPTH_BITS=3414,Oe.STENCIL_BITS=3415,Oe.POLYGON_OFFSET_UNITS=10752,Oe.POLYGON_OFFSET_FACTOR=32824,Oe.TEXTURE_BINDING_2D=32873,Oe.SAMPLE_BUFFERS=32936,Oe.SAMPLES=32937,Oe.SAMPLE_COVERAGE_VALUE=32938,Oe.SAMPLE_COVERAGE_INVERT=32939,Oe.NUM_COMPRESSED_TEXTURE_FORMATS=34466,Oe.COMPRESSED_TEXTURE_FORMATS=34467,Oe.DONT_CARE=4352,Oe.FASTEST=4353,Oe.NICEST=4354,Oe.GENERATE_MIPMAP_HINT=33170,Oe.BYTE=5120,Oe.UNSIGNED_BYTE=5121,Oe.SHORT=5122,Oe.UNSIGNED_SHORT=5123,Oe.INT=5124,Oe.UNSIGNED_INT=5125,Oe.FLOAT=5126,Oe.DEPTH_COMPONENT=6402,Oe.ALPHA=6406,Oe.RGB=6407,Oe.RGBA=6408,Oe.LUMINANCE=6409,Oe.LUMINANCE_ALPHA=6410,Oe.UNSIGNED_SHORT_4_4_4_4=32819,Oe.UNSIGNED_SHORT_5_5_5_1=32820,Oe.UNSIGNED_SHORT_5_6_5=33635,Oe.FRAGMENT_SHADER=35632,Oe.VERTEX_SHADER=35633,Oe.MAX_VERTEX_ATTRIBS=34921,Oe.MAX_VERTEX_UNIFORM_VECTORS=36347,Oe.MAX_VARYING_VECTORS=36348,Oe.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,Oe.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,Oe.MAX_TEXTURE_IMAGE_UNITS=34930,Oe.MAX_FRAGMENT_UNIFORM_VECTORS=36349,Oe.SHADER_TYPE=35663,Oe.DELETE_STATUS=35712,Oe.LINK_STATUS=35714,Oe.VALIDATE_STATUS=35715,Oe.ATTACHED_SHADERS=35717,Oe.ACTIVE_UNIFORMS=35718,Oe.ACTIVE_ATTRIBUTES=35721,Oe.SHADING_LANGUAGE_VERSION=35724,Oe.CURRENT_PROGRAM=35725,Oe.NEVER=512,Oe.LESS=513,Oe.EQUAL=514,Oe.LEQUAL=515,Oe.GREATER=516,Oe.NOTEQUAL=517,Oe.GEQUAL=518,Oe.ALWAYS=519,Oe.KEEP=7680,Oe.REPLACE=7681,Oe.INCR=7682,Oe.DECR=7683,Oe.INVERT=5386,Oe.INCR_WRAP=34055,Oe.DECR_WRAP=34056,Oe.VENDOR=7936,Oe.RENDERER=7937,Oe.VERSION=7938,Oe.NEAREST=9728,Oe.LINEAR=9729,Oe.NEAREST_MIPMAP_NEAREST=9984,Oe.LINEAR_MIPMAP_NEAREST=9985,Oe.NEAREST_MIPMAP_LINEAR=9986,Oe.LINEAR_MIPMAP_LINEAR=9987,Oe.TEXTURE_MAG_FILTER=10240,Oe.TEXTURE_MIN_FILTER=10241,Oe.TEXTURE_WRAP_S=10242,Oe.TEXTURE_WRAP_T=10243,Oe.TEXTURE_2D=3553,Oe.TEXTURE=5890,Oe.TEXTURE_CUBE_MAP=34067,Oe.TEXTURE_BINDING_CUBE_MAP=34068,Oe.TEXTURE_CUBE_MAP_POSITIVE_X=34069,Oe.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,Oe.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,Oe.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,Oe.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,Oe.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,Oe.MAX_CUBE_MAP_TEXTURE_SIZE=34076,Oe.TEXTURE0=33984,Oe.TEXTURE1=33985,Oe.TEXTURE2=33986,Oe.TEXTURE3=33987,Oe.TEXTURE4=33988,Oe.TEXTURE5=33989,Oe.TEXTURE6=33990,Oe.TEXTURE7=33991,Oe.TEXTURE8=33992,Oe.TEXTURE9=33993,Oe.TEXTURE10=33994,Oe.TEXTURE11=33995,Oe.TEXTURE12=33996,Oe.TEXTURE13=33997,Oe.TEXTURE14=33998,Oe.TEXTURE15=33999,Oe.TEXTURE16=34e3,Oe.TEXTURE17=34001,Oe.TEXTURE18=34002,Oe.TEXTURE19=34003,Oe.TEXTURE20=34004,Oe.TEXTURE21=34005,Oe.TEXTURE22=34006,Oe.TEXTURE23=34007,Oe.TEXTURE24=34008,Oe.TEXTURE25=34009,Oe.TEXTURE26=34010,Oe.TEXTURE27=34011,Oe.TEXTURE28=34012,Oe.TEXTURE29=34013,Oe.TEXTURE30=34014,Oe.TEXTURE31=34015,Oe.ACTIVE_TEXTURE=34016,Oe.REPEAT=10497,Oe.CLAMP_TO_EDGE=33071,Oe.MIRRORED_REPEAT=33648,Oe.FLOAT_VEC2=35664,Oe.FLOAT_VEC3=35665,Oe.FLOAT_VEC4=35666,Oe.INT_VEC2=35667,Oe.INT_VEC3=35668,Oe.INT_VEC4=35669,Oe.BOOL=35670,Oe.BOOL_VEC2=35671,Oe.BOOL_VEC3=35672,Oe.BOOL_VEC4=35673,Oe.FLOAT_MAT2=35674,Oe.FLOAT_MAT3=35675,Oe.FLOAT_MAT4=35676,Oe.SAMPLER_2D=35678,Oe.SAMPLER_CUBE=35680,Oe.VERTEX_ATTRIB_ARRAY_ENABLED=34338,Oe.VERTEX_ATTRIB_ARRAY_SIZE=34339,Oe.VERTEX_ATTRIB_ARRAY_STRIDE=34340,Oe.VERTEX_ATTRIB_ARRAY_TYPE=34341,Oe.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,Oe.VERTEX_ATTRIB_ARRAY_POINTER=34373,Oe.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,Oe.COMPILE_STATUS=35713,Oe.LOW_FLOAT=36336,Oe.MEDIUM_FLOAT=36337,Oe.HIGH_FLOAT=36338,Oe.LOW_INT=36339,Oe.MEDIUM_INT=36340,Oe.HIGH_INT=36341,Oe.FRAMEBUFFER=36160,Oe.RENDERBUFFER=36161,Oe.RGBA4=32854,Oe.RGB5_A1=32855,Oe.RGB565=36194,Oe.DEPTH_COMPONENT16=33189,Oe.STENCIL_INDEX=6401,Oe.STENCIL_INDEX8=36168,Oe.DEPTH_STENCIL=34041,Oe.RENDERBUFFER_WIDTH=36162,Oe.RENDERBUFFER_HEIGHT=36163,Oe.RENDERBUFFER_INTERNAL_FORMAT=36164,Oe.RENDERBUFFER_RED_SIZE=36176,Oe.RENDERBUFFER_GREEN_SIZE=36177,Oe.RENDERBUFFER_BLUE_SIZE=36178,Oe.RENDERBUFFER_ALPHA_SIZE=36179,Oe.RENDERBUFFER_DEPTH_SIZE=36180,Oe.RENDERBUFFER_STENCIL_SIZE=36181,Oe.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,Oe.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,Oe.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,Oe.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,Oe.COLOR_ATTACHMENT0=36064,Oe.DEPTH_ATTACHMENT=36096,Oe.STENCIL_ATTACHMENT=36128,Oe.DEPTH_STENCIL_ATTACHMENT=33306,Oe.NONE=0,Oe.FRAMEBUFFER_COMPLETE=36053,Oe.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,Oe.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,Oe.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,Oe.FRAMEBUFFER_UNSUPPORTED=36061,Oe.FRAMEBUFFER_BINDING=36006,Oe.RENDERBUFFER_BINDING=36007,Oe.MAX_RENDERBUFFER_SIZE=34024,Oe.INVALID_FRAMEBUFFER_OPERATION=1286,Oe.UNPACK_FLIP_Y_WEBGL=37440,Oe.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,Oe.CONTEXT_LOST_WEBGL=37442,Oe.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,Oe.BROWSER_DEFAULT_WEBGL=37444,Oe._useProgram=null,Oe._depthTest=!0,Oe._depthMask=!0,Oe._blend=!1,Oe._cullFace=!1,Oe.curBindTexTarget=null,Oe.curBindTexValue=null,s(Oe,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),Oe);function Oe(){}var ke=function(){function e(){e.__super.call(this)}d(e,"laya.webgl.display.GraphicsGL",h);var t=e.prototype;return t.setShader=function(e){this._saveToCmd(g.context._setShader,[e])},t.setIBVB=function(e,t,i,n,a,r){this._saveToCmd(g.context._setIBVB,[e,t,i,n,a,r])},t.drawParticle=function(e,t,i){var n=E.createParticleTemplate2D(i);n.x=e,n.y=t,this._saveToCmd(g.context._drawParticle,[n])},e}(),Ve=function(){var i;function F(e){this._x=0,this._y=0,this._id=++F._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,F.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=F.MAXCLIPRECT,this.mOutPoint,this._canvas=e,F._contextcount++,g.isFlash?(this._ib=vt.create(35044),we.fillIBQuadrangle(this._ib,16)):this._ib=vt.QuadrangleIB,this.clear()}d(F,"laya.webgl.canvas.WebGLContext2D",a);var e=F.prototype;return e.setIsMainContext=function(){this._isMain=!0},e.clearBG=function(e,t,i,n){var a=De.mainContext;a.clearColor(e,t,i,n),a.clear(16384)},e._getSubmits=function(){return this._submits},e._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var e=0,t=this._submits._length;e<t;e++)this._submits[e].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},e.destroy=function(){--F._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas=null,this._ib&&this._ib!=vt.QuadrangleIB&&this._ib.releaseResource()},e.clear=function(){this._submits||(this._other=i.DEFAULT,this._curMat=w.create(),this._vb=yt.create(-1),this._submits=[],this._save=[Q.Create(this)],this._save.length=10,this._shader2D=new te,this._triangleMesh=Ze.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=i.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=F.MAXCLIPRECT,this._curSubmit=de.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=j.DEFAULT;for(var e=0,t=this._submits._length;e<t;e++)this._submits[e].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},e.size=function(e,t){if(this._width!=e||this._height!=t)if(0==e||0==t){0!=this._vb._byteLength&&(this._width=e,this._height=t,this._vb.clear(),this._vb.upload());for(var i=0,n=this._submits._length;i<n;i++)this._submits[i].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=e,this._height=t,this._targets&&this._targets.size(e,t),this._canvas.memorySize-=this._canvas.memorySize;0===e&&0===t&&this._releaseMem()},e._getTransformMatrix=function(){return this._curMat},e.translate=function(e,t){0===e&&0===t||(J.save(this),this._curMat.bTransform&&($.save(this),this._curMat.transformPointN(M.TEMP.setTo(e,t)),e=M.TEMP.x,t=M.TEMP.y),this._x+=e,this._y+=t)},e.save=function(){this._save[this._save._length++]=Q.Create(this)},e.restore=function(){var e=this._save._length;if(!(e<1))for(var t=e-1;0<=t;t--){var i=this._save[t];if(i.restore(this),i.isSaveMark())return void(this._save._length=t)}},e._fillText=function(e,t,i,n,a,r,s,o,l,h){void 0===h&&(h=0);var c=this._shader2D,u=this._curSubmit.shaderValue,d=a?Se.create(a):this._other.font;if(U.enabled)c.ALPHA!==u.ALPHA&&(c.glTexture=null),Ce.drawText(this,e,t,this._curMat,d,l||this._other.textAlign,r,s,o,i,n,h);else{this._shader2D.defines.getValue();var _=r?p.create(r)._color:c.colorAdd;c.ALPHA===u.ALPHA&&_===c.colorAdd&&u.colorAdd===c.colorAdd||(c.glTexture=null,c.colorAdd=_),Ce.drawText(this,e,t,this._curMat,d,l||this._other.textAlign,r,s,o,i,n,h)}},e.fillWords=function(e,t,i,n,a,r){this._fillText(null,e,t,i,n,a,null,-1,null,r)},e.fillBorderWords=function(e,t,i,n,a,r,s){this._fillBorderText(null,e,t,i,n,a,r,s,null)},e.fillText=function(e,t,i,n,a,r){this._fillText(e,null,t,i,n,a,null,-1,r)},e.strokeText=function(e,t,i,n,a,r,s){this._fillText(e,null,t,i,n,null,a,r||1,s)},e.fillBorderText=function(e,t,i,n,a,r,s,o){this._fillBorderText(e,null,t,i,n,a,r,s,o)},e._fillBorderText=function(e,t,i,n,a,r,s,o,l){if(!U.enabled)return this._fillText(e,t,i,n,a,null,s,o||1,l),void this._fillText(e,t,i,n,a,r,null,-1,l);var h=this._shader2D,c=this._curSubmit.shaderValue;h.ALPHA!==c.ALPHA&&(h.glTexture=null);var u=a?(F._fontTemp.setFont(a),F._fontTemp):this._other.font;Ce.drawText(this,e,t,this._curMat,u,l||this._other.textAlign,r,s,o||1,i,n,0)},e.fillRect=function(e,t,i,n,a){var r=this._vb;if(we.fillRectImgVb(r,this._clipRect,e,t,i,n,N.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var s=this._shader2D.fillStyle;a&&(this._shader2D.fillStyle=j.create(a));var o=this._shader2D,l=this._curSubmit.shaderValue;if(o.fillStyle!==l.fillStyle||o.ALPHA!==l.ALPHA){o.glTexture=null;var h=this._curSubmit=de.createSubmit(this,this._ib,r,(r._byteLength-64)/32*3,Be.create(2,0));h.shaderValue.color=o.fillStyle._color._color,h.shaderValue.ALPHA=o.ALPHA,this._submits[this._submits._length++]=h}this._curSubmit._numEle+=6,this._shader2D.fillStyle=s}},e.fillTexture=function(e,t,i,n,a,r,s,o){if(e.loaded&&e.bitmap&&e.source){var l=this._vb,h=e.bitmap.width,c=e.bitmap.height,u=e.uv,d=s.x%e.width,_=s.y%e.height;if(h!=o.w||c!=o.h){if(!o.w&&!o.h)switch(o.oy=o.ox=0,r){case"repeat":o.width=n,o.height=a;break;case"repeat-x":o.width=n,_<0?e.height+_>a?o.height=a:o.height=e.height+_:(o.oy=_,e.height+_>a?o.height=a-_:o.height=e.height);break;case"repeat-y":d<0?e.width+d>n?o.width=n:o.width=e.width+d:(o.ox=d,e.width+d>n?o.width=n-d:o.width=e.width),o.height=a;break;case"no-repeat":d<0?e.width+d>n?o.width=n:o.width=e.width+d:(o.ox=d,e.width+d>n?o.width=n-d:o.width=e.width),_<0?e.height+_>a?o.height=a:o.height=e.height+_:(o.oy=_,e.height+_>a?o.height=a-_:o.height=e.height);break;default:o.width=n,o.height=a}o.w=h,o.h=c,o.uv=[0,0,o.width/h,0,o.width/h,o.height/c,0,o.height/c]}if(t+=o.ox,i+=o.oy,d-=o.ox,_-=o.oy,we.fillRectImgVb(l,this._clipRect,t,i,o.width,o.height,o.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var p=qe.create(this,this._ib,l,(l._byteLength-64)/32*3,Be.create(256,0)),f=(this._submits[this._submits._length++]=p).shaderValue;f.textureHost=e;var m=u[0]*h,g=u[1]*c,v=(u[2]-u[0])*h,y=(u[5]-u[3])*c,C=-d/h,E=-_/c;f.u_TexRange[0]=m/h,f.u_TexRange[1]=v/h,f.u_TexRange[2]=g/c,f.u_TexRange[3]=y/c,f.u_offset[0]=C,f.u_offset[1]=E,U.enabled&&!this._isMain&&p.addTexture(e,(l._byteLength>>2)-16),(this._curSubmit=p)._renderType=10017,p._numEle+=6}}else this.sprite&&S.timer.callLater(this,this._repaintSprite)},e.setShader=function(e){K.save(this,1048576,this._shader2D,!0),this._shader2D.shader=e},e.setFilters=function(e){K.save(this,2097152,this._shader2D,!0),this._shader2D.filters=e,this._curSubmit=de.RENDERBASE,this._renderKey=0,this._drawCount++},e.drawTexture=function(e,t,i,n,a,r,s){this._drawTextureM(e,t,i,n,a,r,s,null,1)},e.addTextureVb=function(e,t,i){var n=this._curSubmit._vb||this._vb,a=n._byteLength>>2;n.byteLength=a+16<<2;for(var r=n.getFloat32Array(),s=0;s<16;s+=4)r[a++]=e[s]+t,r[a++]=e[s+1]+i,r[a++]=e[s+2],r[a++]=e[s+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),n._upload=!0},e.willDrawTexture=function(e,t){if(!(e.loaded&&e.bitmap&&e.source))return this.sprite&&S.timer.callLater(this,this._repaintSprite),0;var i=e.bitmap,n=i.id+this._shader2D.ALPHA*t+10016;if(n==this._renderKey)return n;var a=this._shader2D,r=a.ALPHA,s=this._curSubmit.shaderValue;a.ALPHA*=t,this._renderKey=n,this._drawCount++,a.glTexture=i;var o=this._vb,l=null,h=o._byteLength/32*3;return l=qe.create(this,this._ib,o,h,Be.create(1,0)),(this._submits[this._submits._length++]=l).shaderValue.textureHost=e,l._renderType=10016,l._preIsSameTextureShader=10016===this._curSubmit._renderType&&a.ALPHA===s.ALPHA,this._curSubmit=l,a.ALPHA=r,n},e.drawTextures=function(e,t,i,n){if(e.loaded&&e.bitmap&&e.source){var a=this._clipRect;if(this._clipRect=F.MAXCLIPRECT,this._drawTextureM(e,t[0],t[1],e.width,e.height,i,n,null,1)){if(this._clipRect=a,A.drawCall++,!(t.length<4)){for(var r=this._curSubmit._vb||this._vb,s=this._curMat.a,o=this._curMat.d,l=2,h=t.length;l<h;l+=2)we.copyPreImgVb(r,(t[l]-t[l-2])*s,(t[l+1]-t[l-1])*o),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&S.timer.callLater(this,this._repaintSprite)},e._drawTextureM=function(e,t,i,n,a,r,s,o,l){if(!e.loaded||!e.source)return this.sprite&&S.timer.callLater(this,this._repaintSprite),!1;var h=this._curSubmit._vb||this._vb,c=e.bitmap;t+=r,i+=s,this._drawCount++;var u=c.id+this._shader2D.ALPHA*l+10016;if(u!=this._renderKey){this._renderKey=u;var d=this._curSubmit.shaderValue,_=this._shader2D,p=_.ALPHA;_.ALPHA*=l,_.glTexture=c;var f=this._vb,m=null,g=f._byteLength/32*3;m=qe.create(this,this._ib,f,g,Be.create(1,0)),(this._submits[this._submits._length++]=m).shaderValue.textureHost=e,m._renderType=10016,m._preIsSameTextureShader=10016===this._curSubmit._renderType&&_.ALPHA===d.ALPHA,this._curSubmit=m,h=this._curSubmit._vb||this._vb,_.ALPHA=p}return!!we.fillRectImgVb(h,this._clipRect,t,i,n||e.width,a||e.height,e.uv,o||this._curMat,this._x,this._y,0,0)&&(U.enabled&&!this._isMain&&this._curSubmit.addTexture(e,(h._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},e._repaintSprite=function(){this.sprite&&this.sprite.repaint()},e._drawText=function(e,t,i,n,a,r,s,o,l,h){var c=e.bitmap;this._drawCount++;var u=c.id+this._shader2D.ALPHA+10016;if(u!=this._renderKey){this._renderKey=u;var d=this._curSubmit.shaderValue,_=this._shader2D;_.glTexture=c;var p=this._vb,f=null,m=p._byteLength/32*3;(f=U.enabled?qe.create(this,this._ib,p,m,Be.create(1,0)):qe.create(this,this._ib,p,m,mt.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&_.ALPHA===d.ALPHA,(this._submits[this._submits._length++]=f).shaderValue.textureHost=e,f._renderType=10016,this._curSubmit=f}e.active();var g=this._curSubmit._vb||this._vb;we.fillRectImgVb(g,this._clipRect,t+s,i+o,n||e.width,a||e.height,e.uv,r||this._curMat,this._x,this._y,l,h,!0)&&(U.enabled&&!this._isMain&&this._curSubmit.addTexture(e,(g._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},e.drawTextureWithTransform=function(e,t,i,n,a,r,s,o,l){if(r){var h=this._curMat,c=this._x,u=this._y;0===s&&0===o||(this._x=s*h.a+o*h.c,this._y=o*h.d+s*h.b),r&&h.bTransform?(w.mul(r,h,F._tmpMatrix),(r=F._tmpMatrix)._checkTransform()):(this._x+=h.tx,this._y+=h.ty),this._drawTextureM(e,t,i,n,a,0,0,r,l),this._x=c,this._y=u}else this._drawTextureM(e,t,i,n,a,s,o,null,l)},e.fillQuadrangle=function(e,t,i,n,a){var r=this._curSubmit,s=this._vb,o=this._shader2D,l=r.shaderValue;if(this._renderKey=0,e.bitmap){var h=e.bitmap;o.glTexture==h&&o.ALPHA===l.ALPHA||(o.glTexture=h,(r=this._curSubmit=de.createSubmit(this,this._ib,s,s._byteLength/32*3,Be.create(1,0))).shaderValue.glTexture=h,this._submits[this._submits._length++]=r),we.fillQuadrangleImgVb(s,t,i,n,e.uv,a||this._curMat,this._x,this._y)}else r.shaderValue.fillStyle&&r.shaderValue.fillStyle.equal(e)&&o.ALPHA===l.ALPHA||(o.glTexture=null,(r=this._curSubmit=de.createSubmit(this,this._ib,s,s._byteLength/32*3,Be.create(2,0))).shaderValue.defines.add(2),r.shaderValue.fillStyle=j.create(e),this._submits[this._submits._length++]=r),we.fillQuadrangleImgVb(s,t,i,n,N.DEF_UV,a||this._curMat,this._x,this._y);r._numEle+=6},e.drawTexture2=function(e,t,i,n,a,r,s,o){if(0!=r){var l=this._curMat;if(this._x=e*l.a+t*l.c,this._y=t*l.d+e*l.b,a=a&&(l.bTransform||a.bTransform?(w.mul(a,l,F._tmpMatrix),F._tmpMatrix):(this._x+=a.tx+l.tx,this._y+=a.ty+l.ty,w.EMPTY)),1!==r||s){var h=this._shader2D.ALPHA,c=this._nBlendType;this._shader2D.ALPHA=r,s&&(this._nBlendType=W.TOINT(s)),this._drawTextureM(o[0],o[1]-i,o[2]-n,o[3],o[4],0,0,a,1),this._shader2D.ALPHA=h,this._nBlendType=c}else this._drawTextureM(o[0],o[1]-i,o[2]-n,o[3],o[4],0,0,a,1);this._x=this._y=0}},e.drawCanvas=function(e,t,i,n,a){var r=e.context;if(this._renderKey=0,r._targets)this._submits[this._submits._length++]=Ke.create(r,0,null),this._curSubmit=de.RENDERBASE,r._targets.drawTo(this,t,i,n,a);else{var s=this._submits[this._submits._length++]=Ke.create(r,this._shader2D.ALPHA,this._shader2D.filters),o=n/e.width,l=a/e.height,h=s._matrix;this._curMat.copyTo(h),1!=o&&1!=l&&h.scale(o,l);var c=h.tx,u=h.ty;h.tx=h.ty=0,h.transformPoint(M.TEMP.setTo(t,i)),h.translate(M.TEMP.x+c,M.TEMP.y+u),this._curSubmit=de.RENDERBASE}x.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=r._targets?"yellow":"green",this.strokeRect(t-1,i-1,n+2,a+2,1),this.strokeRect(t,i,n,a,1),this.restore())},e.drawTarget=function(e,t,i,n,a,r,s,o,l,h){void 0===h&&(h=-1);var c=this._vb;if(we.fillRectImgVb(c,this._clipRect,t,i,n,a,l||N.DEF_UV,r||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var u=this._curSubmit=ve.create(this,this._ib,c,(c._byteLength-64)/32*3,o,s);u.blendType=-1==h?this._nBlendType:h,u.scope=e,this._submits[this._submits._length++]=u,this._curSubmit._numEle+=6}},e.mixRGBandAlpha=function(e){return this._mixRGBandAlpha(e,this._shader2D.ALPHA)},e._mixRGBandAlpha=function(e,t){var i=(4278190080&e)>>>24;return 0!=i?i*=t:i=255*t,16777215&e|i<<24},e.drawTriangles=function(e,t,i,n,a,r,s,o,l,h){if(!e.loaded||!e.source)return this.sprite&&S.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;e.bitmap;var c=this._mixRGBandAlpha(4294967295,o),u=(n.length,r.length);this._renderKey=-1;var d=this._curSubmit=qe.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,Be.create(1,0));return d.shaderValue.textureHost=e,d._renderType=10016,this._submits[this._submits._length++]=d,s?(F._tmpMatrix.a=s.a,F._tmpMatrix.b=s.b,F._tmpMatrix.c=s.c,F._tmpMatrix.d=s.d,F._tmpMatrix.tx=s.tx+t,F._tmpMatrix.ty=s.ty+i,w.mul(F._tmpMatrix,this._curMat,F._tmpMatrix)):(F._tmpMatrix.a=this._curMat.a,F._tmpMatrix.b=this._curMat.b,F._tmpMatrix.c=this._curMat.c,F._tmpMatrix.d=this._curMat.d,F._tmpMatrix.tx=this._curMat.tx+t,F._tmpMatrix.ty=this._curMat.ty+i),this._triangleMesh.addData(n,a,r,F._tmpMatrix,c,this),this._curSubmit._numEle+=u,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},e.transform=function(e,t,i,n,a,r){$.save(this),w.mul(w.TEMP.setTo(e,t,i,n,a,r),this._curMat,this._curMat),this._curMat._checkTransform()},e.setTransformByMatrix=function(e){e.copyTo(this._curMat)},e.transformByMatrix=function(e){$.save(this),w.mul(e,this._curMat,this._curMat),this._curMat._checkTransform()},e.rotate=function(e){$.save(this),this._curMat.rotateEx(e)},e.scale=function(e,t){$.save(this),this._curMat.scaleEx(e,t)},e.clipRect=function(e,t,i,n){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var a=ge.create(4);this.addRenderObject(a);var r=this._vb,s=r._byteLength>>2;if(we.fillRectImgVb(r,null,e,t,i,n,N.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var o=this._curSubmit=de.createSubmit(this,this._ib,r,(r._byteLength-64)/32*3,Be.create(2,0));o.shaderValue.ALPHA=1,this._submits[this._submits._length++]=o,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var l=ge.create(5);this.addRenderObject(l);var h=r.getFloat32Array(),c=Math.min(Math.min(Math.min(h[0+s],h[4+s]),h[8+s]),h[12+s]),u=Math.max(Math.max(Math.max(h[0+s],h[4+s]),h[8+s]),h[12+s]),d=Math.min(Math.min(Math.min(h[1+s],h[5+s]),h[9+s]),h[13+s]),_=Math.max(Math.max(Math.max(h[1+s],h[5+s]),h[9+s]),h[13+s]);Z.save(this,l,e,t,i,n,c,d,u-c,_-d),this._curSubmit=de.RENDERBASE}else{i*=this._curMat.a,n*=this._curMat.d;var p=M.TEMP;this._curMat.transformPoint(p.setTo(e,t)),i<0&&(p.x=p.x+i,i=-i),n<0&&(p.y=p.y+n,n=-n),this._renderKey=0;var f=this._curSubmit=me.create(this);(this._submits[this._submits._length++]=f).submitIndex=this._submits._length,f.submitLength=9999999,q.save(this,f);var m=this._clipRect,g=m.x,v=m.y,y=p.x+i,C=p.y+n;g<p.x&&(m.x=p.x),v<p.y&&(m.y=p.y),m.width=Math.min(y,g+m.width)-m.x,m.height=Math.min(C,v+m.height)-m.y,this._shader2D.glTexture=null,f.clipRect.copyFrom(m),this._curSubmit=de.RENDERBASE}},e.setIBVB=function(e,t,i,n,a,r,s,o,l,h,c){if(void 0===l&&(l=0),void 0===h&&(h=0),void 0===c&&(c=0),null===i){if(g.isFlash){var u=n;u._selfIB||(u._selfIB=vt.create(35044)),u._selfIB.clear(),i=u._selfIB}else i=this._ib;we.expandIBQuadrangle(i,n._byteLength/(4*n.vertexStride*4))}if(!o||!s)throw Error("setIBVB must input:shader shaderValues");var d=fe.create(this,n,i,a,s,o,l,h,c);(r=r||w.EMPTY).translate(e,t),w.mul(r,this._curMat,d._mat),r.translate(-e,-t),this._submits[this._submits._length++]=d,this._curSubmit=de.RENDERBASE,this._renderKey=0},e.addRenderObject=function(e){this._submits[this._submits._length++]=e},e.fillTrangles=function(e,t,i,n,a){var r=this._curSubmit,s=this._vb,o=this._shader2D,l=r.shaderValue,h=n.length>>4,c=e.bitmap;this._renderKey=0,o.glTexture==c&&o.ALPHA===l.ALPHA||((r=this._curSubmit=de.createSubmit(this,this._ib,s,s._byteLength/32*3,Be.create(1,0))).shaderValue.textureHost=e,this._submits[this._submits._length++]=r),we.fillTranglesVB(s,t,i,n,a||this._curMat,this._x,this._y),r._numEle+=6*h},e.submitElement=function(e,t){var i=this._submits;for(t<0&&(t=i._length);e<t;)e+=i[e].renderSubmit()},e.finish=function(){De.mainContext.finish()},e.flush=function(){var e=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(e>this._ib.bufferLength/12&&we.expandIBQuadrangle(this._ib,e),!this._isMain&&U.enabled&&U._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=U._atlasRestore;for(var t=this._submits,i=0,n=t._length;i<n;i++){var a=t[i];10016===a.getRenderType()&&a.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),re.instance&&re.getInstance().reset();var r;for(i=0,r=this.meshlist.length;i<r;i++){var s=this.meshlist[i];s.canReuse?s.releaseMesh():s.destroy()}return this.meshlist.length=0,this._curSubmit=de.RENDERBASE,this._renderKey=0,this._triangleMesh=Ze.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},e.setPathId=function(e){if(this.mId=e,-1!=this.mId){this.mHaveKey=!1;var t=k.getInstance();t.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,t.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},e.movePath=function(e,t){var i=e,n=t;e=this._curMat.a*i+this._curMat.c*n+this._curMat.tx,t=this._curMat.b*i+this._curMat.d*n+this._curMat.ty,this.mX+=e,this.mY+=t},e.beginPath=function(){var e=this._getPath();e.tempArray.length=0,e.closePath=!1,this.mX=0,this.mY=0},e.closePath=function(){this._path.closePath=!0},e.fill=function(e){void 0===e&&(e=!1);var t=this._getPath();this.drawPoly(0,0,t.tempArray,this.fillStyle._color.numColor,0,0,e)},e.stroke=function(){var e=this._getPath();if(0<this.lineWidth){if(-1==this.mId)e.drawLine(0,0,e.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var t=k.getInstance().shapeLineDic[this.mId];t.rebuild(e.tempArray),e.setGeomtry(t)}else k.getInstance().addLine(this.mId,e.drawLine(0,0,e.tempArray,this.lineWidth,this.strokeStyle._color.numColor));e.update();var i=[this.mX,this.mY],n=de.createShape(this,e.ib,e.vb,e.count,e.offset,Be.create(4,0));n.shaderValue.ALPHA=this._shader2D.ALPHA,n.shaderValue.u_pos=i,n.shaderValue.u_mmat2=Le.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=n,this._renderKey=-1}},e.line=function(e,t,i,n,a,r){var s=this._curSubmit,o=this._vb;if(we.fillLineVb(o,this._clipRect,e,t,i,n,a,r)){this._renderKey=0;var l=this._shader2D,h=s.shaderValue;l.strokeStyle===h.strokeStyle&&l.ALPHA===h.ALPHA||(l.glTexture=null,(s=this._curSubmit=de.createSubmit(this,this._ib,o,(o._byteLength-64)/32*3,Be.create(2,0))).shaderValue.strokeStyle=l.strokeStyle,s.shaderValue.mainID=2,s.shaderValue.ALPHA=l.ALPHA,this._submits[this._submits._length++]=s),s._numEle+=6}},e.moveTo=function(e,t,i){void 0===i&&(i=!0);var n=this._getPath();if(i){var a=e,r=t;e=this._curMat.a*a+this._curMat.c*r,t=this._curMat.b*a+this._curMat.d*r}n.addPoint(e,t)},e.lineTo=function(e,t,i){void 0===i&&(i=!0);var n=this._getPath();if(i){var a=e,r=t;e=this._curMat.a*a+this._curMat.c*r,t=this._curMat.b*a+this._curMat.d*r}n.addPoint(e,t)},e.drawCurves=function(e,t,i){this.setPathId(-1),this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var n=i[2];e+=i[0],t+=i[1],this.movePath(e,t),this.moveTo(n[0],n[1]);for(var a=2,r=n.length;a<r;)this.quadraticCurveTo(n[a++],n[a++],n[a++],n[a++]);this.stroke()},e.arcTo=function(e,t,i,n,a){if(-1==this.mId||!this.mHaveKey){var r=0,s=0,o=0,l=this._getPath();this._curMat.copyTo(F._tmpMatrix),F._tmpMatrix.tx=F._tmpMatrix.ty=0,F._tempPoint.setTo(l.getEndPointX(),l.getEndPointY()),F._tmpMatrix.invertTransformPoint(F._tempPoint);var h=F._tempPoint.x-e,c=F._tempPoint.y-t,u=Math.sqrt(h*h+c*c);if(!(u<=1e-6)){var d=h/u,_=c/u,p=i-e,f=n-t,m=p*p+f*f,g=Math.sqrt(m);if(!(g<=1e-6)){var v=p/g,y=f/g,C=d+v,E=_+y,S=Math.sqrt(C*C+E*E);if(!(S<=1e-6)){var x=C/S,T=E/S,w=Math.acos(x*d+T*_),M=Math.PI/2-w,b=(u=a/Math.tan(M))*d+e,R=u*_+t,L=Math.sqrt(u*u+a*a),A=e+x*L,I=t+T*L,D=0,P=0;if(0<=d*y-_*v){var N=2*M/F.SEGNUM;D=Math.sin(N),P=Math.cos(N)}else N=2*-M/F.SEGNUM,D=Math.sin(N),P=Math.cos(N);s=this._curMat.a*b+this._curMat.c*R,o=this._curMat.b*b+this._curMat.d*R,s==this._path.getEndPointX()&&o==this._path.getEndPointY()||l.addPoint(s,o);var O=b-A,k=R-I;for(r=0;r<F.SEGNUM;r++){var V=O*P+k*D,B=-O*D+k*P;s=V+A,o=B+I,e=this._curMat.a*s+this._curMat.c*o,o=t=this._curMat.b*s+this._curMat.d*o,(s=e)==this._path.getEndPointX()&&o==this._path.getEndPointY()||l.addPoint(s,o),O=V,k=B}}}}}},e.arc=function(e,t,i,n,a,r,s){if(void 0===r&&(r=!1),void 0===s&&(s=!0),-1!=this.mId){var o=k.getInstance().shapeDic[this.mId];if(o&&this.mHaveKey&&!o.needUpdate(this._curMat))return;t=e=0}var l,h=0,c=0,u=0,d=0,_=0,p=0,f=0;if(c=a-n,r)if(Math.abs(c)>=2*Math.PI)c=2*-Math.PI;else for(;0<c;)c-=2*Math.PI;else if(Math.abs(c)>=2*Math.PI)c=2*Math.PI;else for(;c<0;)c+=2*Math.PI;l=c/(f=i<101?Math.max(10,c*i/5):i<201?Math.max(10,c*i/20):Math.max(10,c*i/40))/2,u=Math.abs(4/3*(1-Math.cos(l))/Math.sin(l)),r&&(u=-u);var m=this._getPath(),g=NaN,v=NaN;for(p=0;p<=f;p++)h=n+c*(p/f),d=e+Math.cos(h)*i,_=t+Math.sin(h)*i,s&&(g=d,v=_,d=this._curMat.a*g+this._curMat.c*v,_=this._curMat.b*g+this._curMat.d*v),d==this._path.getEndPointX()&&_==this._path.getEndPointY()||m.addPoint(d,_);d=e+Math.cos(a)*i,_=t+Math.sin(a)*i,s&&(g=d,v=_,d=this._curMat.a*g+this._curMat.c*v,_=this._curMat.b*g+this._curMat.d*v),d==this._path.getEndPointX()&&_==this._path.getEndPointY()||m.addPoint(d,_)},e.quadraticCurveTo=function(e,t,i,n){var a=c.I,r=i,s=n;i=this._curMat.a*r+this._curMat.c*s,n=this._curMat.b*r+this._curMat.d*s,r=e,s=t,e=this._curMat.a*r+this._curMat.c*s,t=this._curMat.b*r+this._curMat.d*s;for(var o=a.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),e,t,i,n],30,2),l=0,h=o.length/2;l<h;l++)this.lineTo(o[2*l],o[2*l+1],!1);this.lineTo(i,n,!1)},e.rect=function(e,t,i,n){this._other=this._other.make(),this._other.path||(this._other.path=new Y),this._other.path.rect(e,t,i,n)},e.strokeRect=function(e,t,i,n,a){var r=.5*a;this.line(e-r,t,e+i+r,t,a,this._curMat),this.line(e+i,t,e+i,t+n,a,this._curMat),this.line(e,t,e,t+n,a,this._curMat),this.line(e-r,t+n,e+i+r,t+n,a,this._curMat)},e.clip=function(){},e.drawPoly=function(e,t,i,n,a,r,s){void 0===s&&(s=!1),this._renderKey=0,this._shader2D.glTexture=null;var o=this._getPath();if(-1==this.mId)o.polygon(e,t,i,n,a||1,r);else if(this.mHaveKey){var l=k.getInstance().shapeDic[this.mId];l.setMatrix(this._curMat),l.rebuild(o.tempArray),o.setGeomtry(l)}else{var h=o.polygon(e,t,i,n,a||1,r);k.getInstance().addShape(this.mId,h),h.setMatrix(this._curMat)}o.update();var c,u=[this.mX,this.mY];if((c=de.createShape(this,o.ib,o.vb,o.count,o.offset,Be.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,c.shaderValue.u_pos=u,c.shaderValue.u_mmat2=Le.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=c,0<a){if(this.mHaveLineKey){var d=k.getInstance().shapeLineDic[this.mId];d.rebuild(o.tempArray),o.setGeomtry(d)}else k.getInstance().addShape(this.mId,o.drawLine(e,t,i,a,r));o.update(),(c=de.createShape(this,o.ib,o.vb,o.count,o.offset,Be.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,c.shaderValue.u_mmat2=Le.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=c}},e.drawParticle=function(e,t,i){i.x=e,i.y=t,this._submits[this._submits._length++]=i},e._getPath=function(){return this._path||(this._path=new Y)},n(0,e,"globalCompositeOperation",function(){return W.NAMES[this._nBlendType]},function(e){var t=W.TOINT[e];null==t||this._nBlendType===t||(K.save(this,65536,this,!0),this._curSubmit=de.RENDERBASE,this._renderKey=0,this._nBlendType=t)}),n(0,e,"strokeStyle",function(){return this._shader2D.strokeStyle},function(e){this._shader2D.strokeStyle.equal(e)||(K.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=j.create(e))}),n(0,e,"globalAlpha",function(){return this._shader2D.ALPHA},function(e){(e=Math.floor(1e3*e)/1e3)!=this._shader2D.ALPHA&&(K.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=e)}),n(0,e,"asBitmap",null,function(e){if(e){if(this._targets||(this._targets=new ee),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),n(0,e,"fillStyle",function(){return this._shader2D.fillStyle},function(e){this._shader2D.fillStyle.equal(e)||(K.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=j.create(e))}),n(0,e,"textAlign",function(){return this._other.textAlign},function(e){this._other.textAlign===e||(this._other=this._other.make(),K.save(this,32768,this._other,!1),this._other.textAlign=e)}),n(0,e,"lineWidth",function(){return this._other.lineWidth},function(e){this._other.lineWidth===e||(this._other=this._other.make(),K.save(this,256,this._other,!1),this._other.lineWidth=e)}),n(0,e,"textBaseline",function(){return this._other.textBaseline},function(e){this._other.textBaseline===e||(this._other=this._other.make(),K.save(this,16384,this._other,!1),this._other.textBaseline=e)}),n(0,e,"font",null,function(e){e!=this._other.font.toString()&&(this._other=this._other.make(),K.save(this,8,this._other,!1),this._other.font===Se.EMPTY?this._other.font=new Se(e):this._other.font.setFont(e))}),F.__init__=function(){i.DEFAULT=new i},F._tempPoint=new M,F._SUBMITVBSIZE=32e3,F._MAXSIZE=99999999,F._RECTVBSIZE=16,F.MAXCLIPRECT=new b(0,0,99999999,99999999),F._COUNT=0,F._tmpMatrix=new w,F.SEGNUM=32,F._contextcount=0,s(F,["_fontTemp",function(){return this._fontTemp=new Se},"_drawStyleTemp",function(){return this._drawStyleTemp=new j(null)}]),F.__init$=function(){i=function(){function e(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=Se.EMPTY}d(e,"");var t=e.prototype;return t.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=Se.EMPTY},t.make=function(){return this===e.DEFAULT?new e:this},e.DEFAULT=null,e}()},F}(),Be=function(){function n(e,t){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,n.__super.call(this),this.defines=new Ge,this.position=n._POSITION,this.mainID=e,this.subID=t,this.textureHost=null,this.texture=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=e|t,this._inClassCache=n._cache[this._cacheID],0<e&&!this._inClassCache&&(this._inClassCache=n._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}d(n,"laya.webgl.shader.d2.value.Value2D",B);var e=n.prototype;return e.setValue=function(e){},e.refresh=function(){var e=this.size;return e[0]=Le.width,e[1]=Le.height,this.alpha=this.ALPHA*Le.worldAlpha,this.mmat=Le.worldMatrix4,this},e._ShaderWithCompile=function(){return pt.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,gt.create)},e._withWorldShaderDefines=function(){var e=Le.worldShaderDefines,t=pt.sharders[this.mainID|this.defines._value|e.getValue()];if(!t){var i,n={};for(i in this.defines.toNameDic())n[i]="";for(i in e.toNameDic())n[i]="";t=pt.withCompile2D(0,this.mainID,n,this.mainID|this.defines._value|e.getValue(),gt.create)}var a=Le.worldFilters;if(!a)return t;for(var r,s=a.length,o=0;o<s;o++)(r=a[o])&&r.action.setValue(this);return t},e.upload=function(){var e=Le;this.alpha=this.ALPHA*e.worldAlpha,Le.worldMatrix4!==Le.TEMPMAT4_ARRAY&&this.defines.add(128),De.shaderHighPrecision&&this.defines.add(1024);var t,i=e.worldShaderDefines?this._withWorldShaderDefines():pt.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=e.width,this.size[1]=e.height,this.mmat=e.worldMatrix4,Qe.activeShader!==i?i._shaderValueWidth!==e.width||i._shaderValueHeight!==e.height?(i._shaderValueWidth=e.width,i._shaderValueHeight=e.height):t=i._params2dQuick2||i._make2dQuick2():i._shaderValueWidth!==e.width||i._shaderValueHeight!==e.height?(i._shaderValueWidth=e.width,i._shaderValueHeight=e.height):t=i._params2dQuick1||i._make2dQuick1(),i.upload(this,t)},e.setFilters=function(e){if(this.filters=e)for(var t,i=e.length,n=0;n<i;n++)(t=e[n])&&(this.defines.add(t.type),t.action.setValue(this))},e.clear=function(){this.defines.setValue(this.subID)},e.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.clear()},n._initone=function(e,t){n._typeClass[e]=t,n._cache[e]=[],n._cache[e]._length=0},n.__init__=function(){n._POSITION=[2,5126,!1,4*xe.BYTES_PE,0],n._TEXCOORD=[2,5126,!1,4*xe.BYTES_PE,2*xe.BYTES_PE],n._initone(2,nt),n._initone(4,ot),n._initone(256,rt),n._initone(512,tt),n._initone(1,st),n._initone(65,mt),n._initone(9,st)},n.create=function(e,t){var i=n._cache[e|t];return i._length?i[--i._length]:new n._typeClass[e|t](t)},n._POSITION=null,n._TEXCOORD=null,n._cache=[],n._typeClass=[],n.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n}(),Fe=function(){function m(e,t){m.__super.call(this,e,t)}d(m,"laya.webgl.utils.RenderSprite3D",v);var e=m.prototype;return e.onCreate=function(e){switch(e){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},e._mask=function(e,t,i,n){var a,r,s=this._next,o=e.mask;if(o){t.ctx.save();var l=t.ctx.globalCompositeOperation,h=new b;if(h.copyFrom(o.getBounds()),h.width=Math.round(h.width),h.height=Math.round(h.height),h.x=Math.round(h.x),h.y=Math.round(h.y),0<h.width&&0<h.height){var c=e._style._tf,u=pe.create();u.addValue("bounds",h),a=_e.create([u,t],laya.webgl.utils.RenderSprite3D.tmpTarget),t.addRenderObject(a),o.render(t,-h.x,-h.y),a=_e.create([u],laya.webgl.utils.RenderSprite3D.endTmpTarget),t.addRenderObject(a),t.ctx.save(),t.clipRect(i-c.translateX+h.x,n-c.translateY+h.y,h.width,h.height),s._fun.call(s,e,t,i,n),t.ctx.restore(),r=ge.create(6),l=t.ctx.globalCompositeOperation,r.blendMode="mask",t.addRenderObject(r),w.TEMP.identity();var d=Be.create(1,0),_=N.INV_UV,p=h.width,f=h.height;(h.width<32||h.height<32)&&((_=m.tempUV)[0]=0,_[1]=0,_[2]=32<=h.width?1:h.width/32,_[3]=0,_[4]=32<=h.width?1:h.width/32,_[5]=32<=h.height?1:h.height/32,_[6]=0,_[7]=32<=h.height?1:h.height/32,h.width=32<=h.width?h.width:32,h.height=32<=h.height?h.height:32,_[1]*=-1,_[3]*=-1,_[5]*=-1,_[7]*=-1,_[1]+=1,_[3]+=1,_[5]+=1,_[7]+=1),t.ctx.drawTarget(u,i+h.x-c.translateX,n+h.y-c.translateY,p,f,w.TEMP,"tmpTarget",d,_,6),a=_e.create([u],laya.webgl.utils.RenderSprite3D.recycleTarget),t.addRenderObject(a),(r=ge.create(6)).blendMode=l,t.addRenderObject(r)}t.ctx.restore()}else s._fun.call(s,e,t,i,n)},e._blend=function(e,t,i,n){var a=e._style,r=this._next;a.blendMode?(t.ctx.save(),t.ctx.globalCompositeOperation=a.blendMode,r._fun.call(r,e,t,i,n),t.ctx.restore()):r._fun.call(r,e,t,i,n)},e._transform=function(e,t,i,n){var a=e.transform,r=this._next;if(a&&r!=v.NORENDER){var s=t.ctx;e._style;a.tx=i,a.ty=n;var o=s._getTransformMatrix(),l=o.clone();w.mul(a,o,o),o._checkTransform(),a.tx=a.ty=0,r._fun.call(r,e,t,0,0),l.copyTo(o),l.destroy()}else r._fun.call(r,e,t,i,n)},m.tmpTarget=function(e,t){var i=e.getValue("bounds"),n=Je.create(i.width,i.height);n.start(),n.clear(0,0,0,0),e.addValue("tmpTarget",n)},m.endTmpTarget=function(e){e.getValue("tmpTarget").end()},m.recycleTarget=function(e){e.getValue("tmpTarget").recycle(),e.recycle()},s(m,["tempUV",function(){return this.tempUV=new Array(8)}]),m}(),He=function(){function e(){this.data=null,e.__super.call(this)}d(e,"laya.filters.webgl.ColorFilterActionGL",V);var t=e.prototype;return S.imps(t,{"laya.filters.IFilterActionGL":!0}),t.setValue=function(e){e.colorMat=this.data._mat,e.colorAlpha=this.data._alpha},t.apply3d=function(e,t,i,n,a){var r=e.getValue("bounds"),s=Be.create(1,0);s.setFilters([this.data]);var o=w.TEMP;o.identity(),i.ctx.drawTarget(e,0,0,r.width,r.height,o,"src",s)},e}(),Ue=function(){function r(e,t,i,n,a){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,r.__super.call(this,e,t,a),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new ht,(this._atlasCanvas._atlaser=this)._atlasCanvas.width=i,this._atlasCanvas.height=n,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}d(r,"laya.webgl.atlas.Atlaser",H);var e=r.prototype;return e.computeUVinAtlasTexture=function(e,t,i,n){var a=U.atlasTextureWidth,r=U.atlasTextureHeight,s=i/a,o=n/r,l=(i+e.bitmap.width)/a,h=(n+e.bitmap.height)/r,c=e.bitmap.width/a,u=e.bitmap.height/r;e.uv=[s+t[0]*c,o+t[1]*u,l-(1-t[2])*c,o+t[3]*u,l-(1-t[4])*c,h-(1-t[5])*u,s+t[6]*c,h-(1-t[7])*u]},e.findBitmapIsExist=function(e){if(e instanceof laya.webgl.resource.WebGLImage){var t=e,i=t.url,n=this._InAtlasWebGLImagesKey[i||t.id];if(n)return n.offsetInfoID}return-1},e.addToAtlasTexture=function(e,t,i){if(e instanceof laya.webgl.resource.WebGLImage){var n=e,a=n.url;this._InAtlasWebGLImagesKey[a||n.id]={bitmap:e,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([t,i])}this._atlasCanvas.texSubImage2D(t,i,e.atlasImgData||e.atlasSource),e.clearAtlasSource()},e.addToAtlas=function(e,t,i){e._atlasID=this._inAtlasTextureKey.length;var n=e.uv.slice(),a=e.bitmap;this._inAtlasTextureKey.push(e),this._inAtlasTextureOriUVValue.push(n),this._inAtlasTextureBitmapValue.push(a),this.computeUVinAtlasTexture(e,n,t,i),e.bitmap=this._atlasCanvas},e.clear=function(){for(var e=0,t=this._inAtlasTextureKey.length;e<t;e++)this._inAtlasTextureKey[e].bitmap=this._inAtlasTextureBitmapValue[e],this._inAtlasTextureKey[e].uv=this._inAtlasTextureOriUVValue[e],this._inAtlasTextureKey[e]._atlasID=-1,this._inAtlasTextureKey[e].bitmap.lock=!1,this._inAtlasTextureKey[e].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},e.dispose=function(){this.clear(),this._atlasCanvas.destroy()},n(0,e,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),n(0,e,"texture",function(){return this._atlasCanvas}),n(0,e,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),r}(),Ge=(d(ze,"laya.webgl.shader.d2.ShaderDefines2D",ne),ze.__init__=function(){ze.reg("TEXTURE2D",1),ze.reg("COLOR2D",2),ze.reg("PRIMITIVE",4),ze.reg("GLOW_FILTER",8),ze.reg("BLUR_FILTER",16),ze.reg("COLOR_FILTER",32),ze.reg("COLOR_ADD",64),ze.reg("WORLDMAT",128),ze.reg("FILLTEXTURE",256),ze.reg("FSHIGHPRECISION",1024)},ze.reg=function(e,t){ne._reg(e,t,ze.__name2int,ze.__int2name)},ze.toText=function(e,t,i){return ne._toText(e,t,i)},ze.toInt=function(e){return ne._toInt(e,ze.__name2int)},ze.TEXTURE2D=1,ze.COLOR2D=2,ze.PRIMITIVE=4,ze.FILTERGLOW=8,ze.FILTERBLUR=16,ze.FILTERCOLOR=32,ze.COLORADD=64,ze.WORLDMAT=128,ze.FILLTEXTURE=256,ze.SKINMESH=512,ze.SHADERDEFINE_FSHIGHPRECISION=1024,ze.__name2int={},ze.__int2name=[],ze.__int2nameMap=[],ze);function ze(){ze.__super.call(this,ze.__name2int,ze.__int2name,ze.__int2nameMap)}d(We,"laya.webgl.shapes.Ellipse",se);function We(e,t,i,n,a,r,s){We.__super.call(this,e,t,i,n,40,a,r,s)}var Xe=function(){function r(e,t,i,n,a){this._points=[],this.rebuild(i),r.__super.call(this,e,t,0,0,0,a,n,a,0)}d(r,"laya.webgl.shapes.Line",se);var e=r.prototype;return e.rebuild=function(e){var t=e.length;t!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(t/2-1)),this.mFloat32Array=new Float32Array(5*t)),this._points.length=0;for(var i=NaN,n=NaN,a=-1,r=-1,s=e.length/2,o=0;o<s;o++)i=e[2*o],n=e[2*o+1],(.01<Math.abs(a-i)||.01<Math.abs(r-n))&&this._points.push(i,n),a=i,r=n},e.getData=function(e,t,i){var n=[],a=[];0<this.borderWidth&&this.createLine2(this._points,n,this.borderWidth,i,a,this._points.length/2),this.mUint16Array.set(n,0),this.mFloat32Array.set(a,0),e.append(this.mUint16Array),t.append(this.mFloat32Array)},r}(),je=function(){function u(e,t,i,n,a){this._points=[];for(var r=NaN,s=NaN,o=-1,l=-1,h=i.length/2-1,c=0;c<h;c++)r=i[2*c],s=i[2*c+1],(.01<Math.abs(o-r)||.01<Math.abs(l-s))&&this._points.push(r,s),o=r,l=s;r=i[2*h],s=i[2*h+1],o=this._points[0],l=this._points[1],(.01<Math.abs(o-r)||.01<Math.abs(l-s))&&this._points.push(r,s),u.__super.call(this,e,t,0,0,this._points.length/2,0,n,a)}d(u,"laya.webgl.shapes.LoopLine",se);var e=u.prototype;return e.getData=function(e,t,i){if(0<this.borderWidth){for(var n=this.color,a=(n>>16&255)/255,r=(n>>8&255)/255,s=(255&n)/255,o=[],l=0,h=0,c=[],u=Math.floor(this._points.length/2),d=0;d<u;d++)l=this._points[2*d],h=this._points[2*d+1],o.push(this.x+l,this.y+h,a,r,s);this.createLoopLine(o,c,this.borderWidth,i+o.length/5),e.append(new Uint16Array(c)),t.append(new Float32Array(o))}},e.createLoopLine=function(e,t,i,n,a,r){e.length;var s=e.concat(),o=a||e,l=this.borderColor,h=(l>>16&255)/255,c=(l>>8&255)/255,u=(255&l)/255,d=[s[0],s[1]],_=[s[s.length-5],s[s.length-4]],p=_[0]+.5*(d[0]-_[0]),f=_[1]+.5*(d[1]-_[1]);s.unshift(p,f,0,0,0),s.push(p,f,0,0,0);var m,g,v,y,C,E,S,x,T,w,M,b,R,L,A,I,D,P,N,O,k=s.length/5,V=n,B=i/2;v=s[0],y=s[1],w=v-(C=s[5]),T=(T=-(y-(E=s[6])))/(O=Math.sqrt(T*T+w*w))*B,w=w/O*B,o.push(v-T,y-w,h,c,u,v+T,y+w,h,c,u);for(var F=1;F<k-1;F++)v=s[5*(F-1)],y=s[5*(F-1)+1],C=s[5*F],E=s[5*F+1],S=s[5*(F+1)],x=s[5*(F+1)+1],w=v-C,b=C-S,A=(-(T=(T=-(y-E))/(O=Math.sqrt(T*T+w*w))*B)+v)*(-(w=w/O*B)+E)-(-T+C)*(-w+y),P=(-(M=(M=-(E-x))/(O=Math.sqrt(M*M+b*b))*B)+S)*(-(b=b/O*B)+E)-(-M+C)*(-b+x),N=(R=-w+y-(-w+E))*(D=-M+C-(-M+S))-(I=-b+x-(-b+E))*(L=-T+C-(-T+v)),Math.abs(N)<.1?(N+=10.1,o.push(C-T,E-w,h,c,u,C+T,E+w,h,c,u)):(((m=(L*P-D*A)/N)-C)*(m-C)+((g=(I*A-R*P)/N)-E)+(g-E),o.push(m,g,h,c,u,C-(m-C),E-(g-E),h,c,u));r&&(t=r);var H=this.edges+1;for(F=1;F<H;F++)t.push(V+2*(F-1),V+2*(F-1)+1,V+2*F+1,V+2*F+1,V+2*F,V+2*(F-1));return t.push(V+2*(F-1),V+2*(F-1)+1,V+1,V+1,V,V+2*(F-1)),o},u}(),Ye=function(){function s(e,t,i,n,a,r){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=w.create(),this._points=i.slice(0,i.length),s.__super.call(this,e,t,0,0,this._points.length/2,n,a,r)}d(s,"laya.webgl.shapes.Polygon",se);var e=s.prototype;return e.rebuild=function(e){this._repaint||(this._points.length=0,this._points=this._points.concat(e))},e.setMatrix=function(e){e.copyTo(this._mat)},e.needUpdate=function(e){return this._repaint=this._mat.a==e.a&&this._mat.b==e.b&&this._mat.c==e.c&&this._mat.d==e.d&&this._mat.tx==e.tx&&this._mat.ty==e.ty,!this._repaint},e.getData=function(e,t,i){var n,a=0,r=this._points,s=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=i){for(this._start=i,n=[],s=this.earcutTriangles.length,a=0;a<s;a++)n.push(this.earcutTriangles[a]+i);this.mUint16Array=new Uint16Array(n)}}else{this._start=i,n=[];var o=[],l=[],h=this.color,c=(h>>16&255)/255,u=(h>>8&255)/255,d=(255&h)/255;for(s=Math.floor(r.length/2),a=0;a<s;a++)o.push(this.x+r[2*a],this.y+r[2*a+1],c,u,d),l.push(this.x+r[2*a],this.y+r[2*a+1]);for(this.earcutTriangles=oe.earcut(l,null,2),s=this.earcutTriangles.length,a=0;a<s;a++)n.push(this.earcutTriangles[a]+i);this.mUint16Array=new Uint16Array(n),this.mFloat32Array=new Float32Array(o)}e.append(this.mUint16Array),t.append(this.mFloat32Array)},s}(),Ke=function(){function r(){this._matrix=new w,this._matrix4=xe.defaultMatrix4.concat(),r.__super.call(this,1e4),this.shaderValue=new Be(0,0)}d(r,"laya.webgl.submit.SubmitCanvas",de);var e=r.prototype;return e.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var e=Le.worldAlpha,t=Le.worldMatrix4,i=Le.worldMatrix,n=Le.worldFilters,a=Le.worldShaderDefines,r=this.shaderValue,s=this._matrix,o=this._matrix4,l=w.TEMP;return w.mul(s,i,l),o[0]=l.a,o[1]=l.b,o[4]=l.c,o[5]=l.d,o[12]=l.tx,o[13]=l.ty,Le.worldMatrix=l.clone(),Le.worldMatrix4=o,Le.worldAlpha=Le.worldAlpha*r.alpha,r.filters&&r.filters.length&&(Le.worldFilters=r.filters,Le.worldShaderDefines=r.defines),this._ctx_src.flush(),Le.worldAlpha=e,Le.worldMatrix4=t,Le.worldMatrix.destroy(),Le.worldMatrix=i,Le.worldFilters=n,Le.worldShaderDefines=a,1},e.releaseRender=function(){var e=r._cache;this._ctx_src=null,e[e._length++]=this},e.getRenderType=function(){return 10003},r.create=function(e,t,i){var n=r._cache._length?r._cache[--r._cache._length]:new r;n._ctx_src=e;var a=n.shaderValue;return a.alpha=t,a.defines.setValue(0),i&&i.length&&a.setFilters(i),n},r._cache=((r._cache=[])._length=0,r._cache),r}(),qe=function(){function h(e){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===e&&(e=1e4),h.__super.call(this,e)}d(h,"laya.webgl.submit.SubmitTexture",de);var e=h.prototype;return e.releaseRender=function(){var e=h._cache;(e[e._length++]=this).shaderValue.release(),this._preIsSameTextureShader=!1,this._vb=null,this._texs.length=0,this._vbPos.length=0,this._isSameTexture=!0},e.addTexture=function(e,t){this._texsID[this._texs.length]=e._uvID,this._texs.push(e),this._vbPos.push(t)},e.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var e=this.shaderValue.textureHost.bitmap;if(null!==e)for(var t=this._vb.getFloat32Array(),i=0,n=this._texs.length;i<n;i++){var a=this._texs[i];a.active();var r=a.uv;if(this._texsID[i]!==a._uvID){this._texsID[i]=a._uvID;var s=this._vbPos[i];t[s+2]=r[0],t[s+3]=r[1],t[s+6]=r[2],t[s+7]=r[3],t[s+10]=r[4],t[s+11]=r[5],t[s+14]=r[6],t[s+15]=r[7],this._vb.setNeedUpload()}a.bitmap!==e&&(this._isSameTexture=!1)}}},e.renderSubmit=function(){if(0===this._numEle)return h._shaderSet=!1,1;var e=this.shaderValue.textureHost;if(e){var t=e.source;if(!e.bitmap||!t)return h._shaderSet=!1,1;this.shaderValue.texture=t}this._vb.bind_upload(this._ib);var i=De.mainContext;if(W.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),W.activeBlendFunction=this._blendFn),A.drawCall++,A.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&Qe.activeShader&&h._shaderSet?Qe.activeShader.uploadTexture2D(this.shaderValue.texture):this.shaderValue.upload(),h._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var n=e.bitmap,a=0,r=Qe.activeShader,s=0,o=this._texs.length;s<o;s++){var l=this._texs[s];l.bitmap===n&&s+1!==o||(r.uploadTexture2D(l.source),i.drawElements(4,6*(s-a+1),5123,this._startIdx+6*a*xe.BYTES_PIDX),n=l.bitmap,a=s)}else i.drawElements(4,this._numEle,5123,this._startIdx);return 1},h.create=function(e,t,i,n,a){var r=h._cache._length?h._cache[--h._cache._length]:new h;null==i&&((i=r._selfVb||(r._selfVb=yt.create(-1))).clear(),n=0),r._ib=t,r._vb=i,r._startIdx=n*xe.BYTES_PIDX,r._numEle=0;var s=e._nBlendType;r._blendFn=e._targets?W.targetFns[s]:W.fns[s],r.shaderValue=a,r.shaderValue.setValue(e._shader2D);var o=e._shader2D.filters;return o&&r.shaderValue.setFilters(o),r},h._cache=((h._cache=[])._length=0,h._cache),h._shaderSet=!0,h}(),Ze=function(){function v(){v.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}d(v,"laya.webgl.utils.MeshTexture",Re);var e=v.prototype;return e.addData=function(e,t,i,n,a,r){for(var s=e.length/2,o=this._vb.needSize(s*v.const_stride)>>2,l=this._vb.getFloat32Array(),h=0,c=0;c<s;c++){var u=e[h],d=e[h+1],_=u*n.a+d*n.c+n.tx,p=u*n.b+d*n.d+n.ty;l[o++]=_,l[o++]=p,l[o++]=t[h],l[o++]=t[h+1],h+=2}this._vb.setNeedUpload();var f=this.vertNum;if(0<f){var m=i.length;m>v.tmpIdx.length&&(v.tmpIdx=new Uint16Array(m));for(var g=0;g<m;g++)v.tmpIdx[g]=i[g]+f;this._ib.appendU16Array(v.tmpIdx,i.length)}else this._ib.append(i);this._ib.setNeedUpload(),this.vertNum+=s,this.indexNum+=i.length},e.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy()},v.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new v},v.const_stride=16,v._POOL=[],s(v,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),v}(),Qe=(d($e,"laya.webgl.shader.BaseShader",y),$e.activeShader=null,$e.bindShader=null,$e);function $e(){$e.__super.call(this),this.lock=!0}var Je=function(t){function c(e,t,i,n,a,r,s,o,l){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===i&&(i=6408),void 0===n&&(n=5121),void 0===a&&(a=34041),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===o&&(o=-1),void 0===l&&(l=-1),this._type=1,this._w=e,this._h=t,this._surfaceFormat=i,this._surfaceType=n,this._depthStencilFormat=a,g.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=r,this._repeat=s,this._minFifter=o,this._magFifter=l,this._createWebGLRenderTarget(),this.bitmap.lock=!0,c.__super.call(this,this.bitmap,N.INV_UV)}d(c,"laya.webgl.resource.RenderTarget2D",t);var e=c.prototype;return S.imps(e,{"laya.resource.IDispose":!0}),e.getType=function(){return this._type},e.getTexture=function(){return this},e.size=function(e,t){this._w==e&&this._h==t||(this._w=e,this._h=t,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},e.release=function(){this.destroy()},e.recycle=function(){c.POOL.push(this)},e.start=function(){var e=De.mainContext;return this._preRenderTarget=Le.curRenderTarget,Le.curRenderTarget=this,e.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(e.viewport(0,0,this._w,this._h),this._svWidth=Le.width,this._svHeight=Le.height,Le.width=this._w,Le.height=this._h,Qe.activeShader=null),this},e.clear=function(e,t,i,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=1);var a=De.mainContext;a.clearColor(e,t,i,n);var r=16384;switch(this._depthStencilFormat){case 33189:r|=256;break;case 36168:r|=1024;break;case 34041:r|=256,r|=1024}a.clear(r)},e.end=function(){var e=De.mainContext;e.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,Le.curRenderTarget=this._preRenderTarget,1==this._type?(e.viewport(0,0,this._svWidth,this._svHeight),Le.width=this._svWidth,Le.height=this._svHeight,Qe.activeShader=null):e.viewport(0,0,S.stage.width,S.stage.height)},e.getData=function(e,t,i,n){var a=De.mainContext;if(a.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===a.checkFramebufferStatus(36160)))return a.bindFramebuffer(36160,null),null;var r=new Uint8Array(this._w*this._h*4);return a.readPixels(e,t,i,n,this._surfaceFormat,this._surfaceType,r),a.bindFramebuffer(36160,null),r},e.destroy=function(e){void 0===e&&(e=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,t.prototype.destroy.call(this))},e.dispose=function(){},e._createWebGLRenderTarget=function(){this.bitmap=new dt(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(e){this.event("recovered")})},n(0,e,"surfaceFormat",function(){return this._surfaceFormat}),n(0,e,"magFifter",function(){return this._magFifter}),n(0,e,"surfaceType",function(){return this._surfaceType}),n(0,e,"mipMap",function(){return this._mipMap}),n(0,e,"depthStencilFormat",function(){return this._depthStencilFormat}),n(0,e,"minFifter",function(){return this._minFifter}),n(0,e,"source",function(){return this._alreadyResolved?S.superGet(N,this,"source"):null}),c.create=function(e,t,i,n,a,r,s,o,l){void 0===i&&(i=6408),void 0===n&&(n=5121),void 0===a&&(a=34041),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===o&&(o=-1),void 0===l&&(l=-1);var h=c.POOL.pop();return(h=h||new c(e,t)).bitmap&&h._w==e&&h._h==t&&h._surfaceFormat==i&&h._surfaceType==n&&h._depthStencilFormat==a&&h._mipMap==r&&h._repeat==s&&h._minFifter==o&&h._magFifter==l||(h._w=e,h._h=t,h._surfaceFormat=i,h._surfaceType=n,h._depthStencilFormat=a,g.isConchWebGL&&34041===h._depthStencilFormat&&(h._depthStencilFormat=33189),h._mipMap=r,h._repeat=s,h._minFifter=o,h._magFifter=l,h.release(),h._createWebGLRenderTarget()),h},c.TYPE2D=1,c.TYPE3D=2,c.POOL=[],c}(N),et=function(){function e(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,e.__super.call(this),e._gl=De.mainContext}d(e,"laya.webgl.utils.Buffer",y);var t=e.prototype;return t._bind=function(){this.activeResource(),e._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(e._bindVertexBuffer=this._glBuffer),e._gl.bindBuffer(this._bufferType,e._bindActive[this._bufferType]=this._glBuffer),Qe.activeShader=null)},t.recreateResource=function(){this._glBuffer||(this._glBuffer=e._gl.createBuffer()),this.completeCreate()},t.disposeResource=function(){this._glBuffer&&(De.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},n(0,t,"bufferUsage",function(){return this._bufferUsage}),e._gl=null,e._bindActive={},e._bindVertexBuffer=null,e._enableAtributes=[],e}(),tt=(d(it,"laya.webgl.shader.d2.skinAnishader.SkinSV",Be),it);function it(e){this.texcoord=null,this.offsetX=300,this.offsetY=0,it.__super.call(this,512,0);var t=8*xe.BYTES_PE;this.position=[2,5126,!1,t,0],this.texcoord=[2,5126,!1,t,2*xe.BYTES_PE],this.color=[4,5126,!1,t,4*xe.BYTES_PE]}var nt=(d(at,"laya.webgl.shader.d2.value.Color2dSV",Be),at.prototype.setValue=function(e){e.fillStyle&&(this.color=e.fillStyle._color._color),e.strokeStyle&&(this.color=e.strokeStyle._color._color)},at);function at(e){at.__super.call(this,2,0),this.color=[]}var rt=function(){function t(e){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=Be._TEXCOORD,t.__super.call(this,256,0)}d(t,"laya.webgl.shader.d2.value.FillTextureSV",Be);var e=t.prototype;return e.setValue=function(e){this.ALPHA=e.ALPHA,e.filters&&this.setFilters(e.filters)},e.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},t}(),st=function(){function t(e){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=Be._TEXCOORD,void 0===e&&(e=0),t.__super.call(this,1,e)}d(t,"laya.webgl.shader.d2.value.TextureSV",Be);var e=t.prototype;return e.setValue=function(e){this.ALPHA=e.ALPHA,e.filters&&this.setFilters(e.filters)},e.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},t}(),ot=(d(lt,"laya.webgl.shader.d2.value.PrimitiveSV",Be),lt);function lt(e){this.a_color=null,this.u_pos=[0,0],lt.__super.call(this,4,0),this.position=[2,5126,!1,5*xe.BYTES_PE,0],this.a_color=[3,5126,!1,5*xe.BYTES_PE,2*xe.BYTES_PE]}var ht=function(e){function t(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,t.__super.call(this)}d(t,"laya.webgl.atlas.AtlasWebGLCanvas",e);var i=t.prototype;return i.recreateResource=function(){var e=De.mainContext,t=this._source=e.createTexture(),i=Ne.curBindTexTarget,n=Ne.curBindTexValue;Ne.bindTexture(e,3553,t),e.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),e.texParameteri(3553,10241,9729),e.texParameteri(3553,10240,9729),e.texParameteri(3553,10242,33071),e.texParameteri(3553,10243,33071),i&&n&&Ne.bindTexture(e,i,n),this.memorySize=this._w*this._h*4,this.completeCreate()},i.disposeResource=function(){this._source&&(De.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.texSubImage2D=function(e,t,i){if(g.isFlash){this._flashCacheImage||(this._flashCacheImage=f.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var n=i.bitmapdata;this._flashCacheImage._image.copyPixels(n,0,0,n.width,n.height,e,t),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var a=De.mainContext,r=Ne.curBindTexTarget,s=Ne.curBindTexValue;Ne.bindTexture(a,3553,this._source),g.isConchWebGL?(i!==ConchTextCanvas&&(0<=e-1&&a.texSubImage2DEx(!0,3553,0,e-1,t,6408,5121,i),e+1<=this._w&&a.texSubImage2DEx(!0,3553,0,e+1,t,6408,5121,i),0<=t-1&&a.texSubImage2DEx(!0,3553,0,e,t-1,6408,5121,i),t+1<=this._h&&a.texSubImage2DEx(!0,3553,0,e,t+1,6408,5121,i)),a.texSubImage2DEx(!0,3553,0,e,t,6408,5121,i)):(a.pixelStorei(37441,!0),0<=e-1&&a.texSubImage2D(3553,0,e-1,t,6408,5121,i),e+1<=this._w&&a.texSubImage2D(3553,0,e+1,t,6408,5121,i),0<=t-1&&a.texSubImage2D(3553,0,e,t-1,6408,5121,i),t+1<=this._h&&a.texSubImage2D(3553,0,e,t+1,6408,5121,i),a.texSubImage2D(3553,0,e,t,6408,5121,i),a.pixelStorei(37441,!1)),r&&s&&Ne.bindTexture(a,r,s)}},i.texSubImage2DPixel=function(e,t,i,n,a){var r=De.mainContext,s=Ne.curBindTexTarget,o=Ne.curBindTexValue;Ne.bindTexture(r,3553,this._source);var l=new Uint8Array(a.data);g.isConchWebGL?r.texSubImage2DEx(!0,3553,0,e,t,i,n,6408,5121,l):(r.pixelStorei(37441,!0),r.texSubImage2D(3553,0,e,t,i,n,6408,5121,l),r.pixelStorei(37441,!1)),s&&o&&Ne.bindTexture(r,s,o)},n(0,i,"width",e.prototype._$get_width,function(e){this._w=e}),n(0,i,"height",e.prototype._$get_height,function(e){this._h=e}),t}(i),ct=function(){function a(){this.flipY=!0,this.alwaysChange=!1,a.__super.call(this)}d(a,"laya.webgl.resource.WebGLCanvas",i);var e=a.prototype;return e.getCanvas=function(){return this._canvas},e.clear=function(){this._ctx&&this._ctx.clear()},e.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},e._setContext=function(e){this._ctx=e},e.getContext=function(e,t){return this._ctx?this._ctx:this._ctx=a._createContext(this)},e.size=function(e,t){this._w==e&&this._h==t||(this._w=e,this._h=t,this._ctx&&this._ctx.size(e,t),this._canvas&&(this._canvas.height=t,this._canvas.width=e))},e.activeResource=function(e){void 0===e&&(e=!1),this._source||this.recreateResource()},e.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},e.disposeResource=function(){this._source&&!this.iscpuSource&&(De.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},e.createWebGlTexture=function(){var e=De.mainContext;this._canvas;var t=this._source=e.createTexture();this.iscpuSource=!1;var i=Ne.curBindTexTarget,n=Ne.curBindTexValue;Ne.bindTexture(e,3553,t),e.pixelStorei(37440,this.flipY?1:0),g.isConchWebGL?e.texImage2DEx(a.premulAlpha,3553,0,6408,6408,5121,this._imgData):(a.premulAlpha&&e.pixelStorei(37441,!0),e.texImage2D(3553,0,6408,6408,5121,this._imgData),a.premulAlpha&&e.pixelStorei(37441,!1)),e.texParameteri(3553,10240,9729),e.texParameteri(3553,10241,9729),e.texParameteri(3553,10242,33071),e.texParameteri(3553,10243,33071),e.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,i&&n&&Ne.bindTexture(e,i,n)},e.reloadCanvasData=function(){var e=De.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var t=Ne.curBindTexTarget,i=Ne.curBindTexValue;Ne.bindTexture(e,3553,this._source),g.isConchWebGL?e.texImage2DEx(a.premulAlpha,3553,0,6408,6408,5121,this._imgData):(a.premulAlpha&&e.pixelStorei(37441,!0),e.texImage2D(3553,0,6408,6408,5121,this._imgData),a.premulAlpha&&e.pixelStorei(37441,!1)),e.pixelStorei(37440,0),t&&i&&Ne.bindTexture(e,t,i)},e.texSubImage2D=function(e,t,i){var n=De.mainContext,a=Ne.curBindTexTarget,r=Ne.curBindTexValue;Ne.bindTexture(n,3553,this._source),g.isConchWebGL?n.texSubImage2DEx(!0,3553,0,t,i,6408,5121,e._source):(n.pixelStorei(37441,!0),n.texSubImage2D(3553,0,t,i,6408,5121,e._source),n.pixelStorei(37441,!1)),a&&r&&Ne.bindTexture(n,a,r)},e.toBase64=function(e,t,i){var n=null;this._canvas&&(n=this._canvas.toDataURL(e,t)),i.call(this,n)},n(0,e,"context",function(){return this._ctx}),n(0,e,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),n(0,e,"asBitmap",null,function(e){this._ctx&&(this._ctx.asBitmap=e)}),a._createContext=null,a.premulAlpha=!1,a}(),ut=function(){function r(e,t){this.CborderSize=12,r.__super.call(this),this.char=e,this.isSpace=" "===e,this.xs=t.scaleX,this.ys=t.scaleY,this.font=t.font.toString(),this.fontSize=t.font.size,this.fillColor=t.fillColor,this.borderColor=t.borderColor,this.lineWidth=t.lineWidth,this.underLine=t.underLine;var i,n=g.isConchApp;n?((i=ConchTextCanvas)._source=ConchTextCanvas,i._source.canvas=ConchTextCanvas):i=_.canvas.source,this.canvas=i,this._enableMerageInAtlas=!0,this._ctx=n?i:this.canvas.getContext("2d",void 0);var a=O.measureText(this.char,this.font);this.cw=a.width*this.xs,this.ch=(a.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new N(this)}d(r,"laya.webgl.resource.WebGLCharImage",i);var e=r.prototype;return S.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e.active=function(){this.texture.active()},e.recreateResource=function(){var e=g.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),e){var t=this.fontSize;1==this.xs&&1==this.ys||(t=parseInt(t*(this.xs>this.ys?this.xs:this.ys)+""));var i="normal 100 "+this.font;i=i.replace(r._fontSizeReg,t),this.borderColor&&(i+=" 1 "+this.borderColor),this._ctx.font=i,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,P.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var n=this._ctx.measureText(this.char).width+1;this._ctx.lineTo(n,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},e.onresize=function(e,t){this._w=e,this._h=t,this._allowMerageInAtlas=!0},e.clearAtlasSource=function(){},n(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),n(0,e,"atlasSource",function(){return this.canvas}),n(0,e,"atlasImgData",function(){return!r.canUseCanvas&&this._ctx.getImageData?this._ctx.getImageData(0,0,this._w,this._h):null}),n(0,e,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(e){this._enableMerageInAtlas=e}),r.createOneChar=function(e,t){return new r(e,t)},r.canUseCanvas=!0,r._fontSizeReg=new RegExp("\\d+(?=px)","g"),r}(),dt=function(){function h(e,t,i,n,a,r,s,o,l){void 0===i&&(i=6408),void 0===n&&(n=5121),void 0===a&&(a=34041),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===o&&(o=-1),void 0===l&&(l=1),h.__super.call(this),this._w=e,this._h=t,this._surfaceFormat=i,this._surfaceType=n,this._depthStencilFormat=a,g.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=r,this._repeat=s,this._minFifter=o,this._magFifter=l}d(h,"laya.webgl.resource.WebGLRenderTarget",i);var e=h.prototype;return e.recreateResource=function(){var e=De.mainContext;this._frameBuffer||(this._frameBuffer=e.createFramebuffer()),this._source||(this._source=e.createTexture());var t=Ne.curBindTexTarget,i=Ne.curBindTexValue;Ne.bindTexture(e,3553,this._source),e.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var n=this._minFifter,a=this._magFifter,r=this._repeat?10497:33071,s=l.isPOT(this._w,this._h);if(s?(this._mipMap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==a||(a=9729),e.texParameteri(3553,10241,n),e.texParameteri(3553,10240,a),e.texParameteri(3553,10242,r),e.texParameteri(3553,10243,r),this._mipMap&&e.generateMipmap(3553)):(-1!==n||(n=9729),-1!==a||(a=9729),e.texParameteri(3553,10241,n),e.texParameteri(3553,10240,a),e.texParameteri(3553,10242,33071),e.texParameteri(3553,10243,33071)),e.bindFramebuffer(36160,this._frameBuffer),e.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=e.createRenderbuffer()),e.bindRenderbuffer(36161,this._depthStencilBuffer),e.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:e.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:e.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:e.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}e.bindFramebuffer(36160,null),t&&i&&Ne.bindTexture(e,t,i),e.bindRenderbuffer(36161,null),s&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},e.disposeResource=function(){this._frameBuffer&&(De.mainContext.deleteTexture(this._source),De.mainContext.deleteFramebuffer(this._frameBuffer),De.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},n(0,e,"depthStencilBuffer",function(){return this._depthStencilBuffer}),n(0,e,"frameBuffer",function(){return this._frameBuffer}),h}(),_t=function(){function o(e,t,i,n,a,r,s){this.offsetX=0,this.offsetY=0,o.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=r,this.canvas=e,this._ctx=e.getContext("2d",void 0),this._w=n,this._h=a,this.offsetX=t,this.offsetY=i,this.src=s,this._enableMerageInAtlas=!0,U.enabled&&this._w<U.atlasLimitWidth&&this._h<U.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}d(o,"laya.webgl.resource.WebGLSubImage",i);var e=o.prototype;return S.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e.size=function(e,t){this._w=e,this._h=t,this._ctx&&this._ctx.size(e,t),this.canvas&&(this.canvas.height=t,this.canvas.width=e)},e.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},e.createWebGlTexture=function(){var e=De.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var t=this._source=e.createTexture(),i=Ne.curBindTexTarget,n=Ne.curBindTexValue;Ne.bindTexture(e,3553,t),g.isConchWebGL?e.texImage2DEx(!0,3553,0,6408,6408,5121,this.canvas):(e.pixelStorei(37441,!0),e.texImage2D(3553,0,6408,6408,5121,this.canvas),e.pixelStorei(37441,!1));var a=this.minFifter,r=this.magFifter,s=this.repeat?10497:33071,o=l.isPOT(this.width,this.height);o?(this.mipmap?-1!==a||(a=9987):-1!==a||(a=9729),-1!==r||(r=9729),e.texParameteri(3553,10240,r),e.texParameteri(3553,10241,a),e.texParameteri(3553,10242,s),e.texParameteri(3553,10243,s),this.mipmap&&e.generateMipmap(3553)):(-1!==a||(a=9729),-1!==r||(r=9729),e.texParameteri(3553,10241,a),e.texParameteri(3553,10240,r),e.texParameteri(3553,10242,33071),e.texParameteri(3553,10243,33071)),i&&n&&Ne.bindTexture(e,i,n),this.canvas=null,o&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},e.disposeResource=function(){U.enabled&&this._allowMerageInAtlas||!this._source||(De.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},e.clearAtlasSource=function(){},n(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),n(0,e,"atlasSource",function(){return this.canvas}),n(0,e,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(e){this._allowMerageInAtlas=e}),o}(),pt=function(){function h(e,t,i,n){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,h.__super.call(this),!e||!t)throw"Shader Error";this._id=++h._count,this._vs=e,this._ps=t,this._nameMap=n||{},null!=i&&(h.sharders[i]=this)}d(h,"laya.webgl.shader.Shader",Qe);var e=h.prototype;return e.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},e.disposeResource=function(){De.mainContext.deleteShader(this._vshader),De.mainContext.deleteShader(this._pshader),De.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var e=[this._vs,this._ps],t=De.mainContext;if(this._program=t.createProgram(),this._vshader=h._createShader(t,e[0],35633),this._pshader=h._createShader(t,e[1],35632),t.attachShader(this._program,this._vshader),t.attachShader(this._program,this._pshader),t.linkProgram(this._program),!g.isConchApp&&!t.getProgramParameter(this._program,35714))throw t.getProgramInfoLog(this._program);var i,n,a=0,r=0;for(r=g.isConchApp?t.getProgramParameterEx(this._vs,this._ps,"",35721):t.getProgramParameter(this._program,35721),a=0;a<r;a++){var s=null;i={vartype:"attribute",glfun:null,ivartype:0,attrib:s=g.isConchApp?t.getActiveAttribEx(this._vs,this._ps,"",a):t.getActiveAttrib(this._program,a),location:t.getAttribLocation(this._program,s.name),name:s.name,type:s.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(i)}var o=0;for(o=g.isConchApp?t.getProgramParameterEx(this._vs,this._ps,"",35718):t.getProgramParameter(this._program,35718),a=0;a<o;a++){var l=null;l=g.isConchApp?t.getActiveUniformEx(this._vs,this._ps,"",a):t.getActiveUniform(this._program,a),0<(i={vartype:"uniform",glfun:null,ivartype:1,attrib:s,location:t.getUniformLocation(this._program,l.name),name:l.name,type:l.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(i.name=i.name.substr(0,i.name.length-3),i.isArray=!0,i.location=t.getUniformLocation(this._program,i.name)),this._params.push(i)}for(a=0,n=this._params.length;a<n;a++)if((i=this._params[a]).indexOfParams=a,i.index=1,i.value=[i.location,null],i.codename=i.name,i.name=this._nameMap[i.codename]?this._nameMap[i.codename]:i.codename,(this._paramsMap[i.name]=i)._this=this,i.uploadedValue=[],"attribute"!==i.vartype)switch(i.type){case 5124:i.fun=i.isArray?this._uniform1iv:this._uniform1i;break;case 5126:i.fun=i.isArray?this._uniform1fv:this._uniform1f;break;case 35664:i.fun=i.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:i.fun=i.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:i.fun=i.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:i.fun=this._uniform_sampler2D;break;case 35680:i.fun=this._uniform_samplerCube;break;case 35676:i.glfun=t.uniformMatrix4fv,i.fun=this._uniformMatrix4fv;break;case 35670:i.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else i.fun=this._attribute}},e.getUniform=function(e){return this._paramsMap[e]},e._attribute=function(e,t){var i=De.mainContext,n=et._enableAtributes,a=e.location;return n[a]||i.enableVertexAttribArray(a),i.vertexAttribPointer(a,t[0],t[1],t[2],t[3],t[4]+this._offset),n[a]=et._bindVertexBuffer,1},e._uniform1f=function(e,t){var i=e.uploadedValue;return i[0]!==t?(De.mainContext.uniform1f(e.location,i[0]=t),1):0},e._uniform1fv=function(e,t){if(t.length<4){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]||i[3]!==t[3]?(De.mainContext.uniform1fv(e.location,t),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],1):0}return De.mainContext.uniform1fv(e.location,t),1},e._uniform_vec2=function(e,t){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]?(De.mainContext.uniform2f(e.location,i[0]=t[0],i[1]=t[1]),1):0},e._uniform_vec2v=function(e,t){if(t.length<2){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]||i[3]!==t[3]?(De.mainContext.uniform2fv(e.location,t),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],1):0}return De.mainContext.uniform2fv(e.location,t),1},e._uniform_vec3=function(e,t){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]?(De.mainContext.uniform3f(e.location,i[0]=t[0],i[1]=t[1],i[2]=t[2]),1):0},e._uniform_vec3v=function(e,t){return De.mainContext.uniform3fv(e.location,t),1},e._uniform_vec4=function(e,t){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]||i[3]!==t[3]?(De.mainContext.uniform4f(e.location,i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3]),1):0},e._uniform_vec4v=function(e,t){return De.mainContext.uniform4fv(e.location,t),1},e._uniformMatrix2fv=function(e,t){return De.mainContext.uniformMatrix2fv(e.location,!1,t),1},e._uniformMatrix3fv=function(e,t){return De.mainContext.uniformMatrix3fv(e.location,!1,t),1},e._uniformMatrix4fv=function(e,t){return De.mainContext.uniformMatrix4fv(e.location,!1,t),1},e._uniform1i=function(e,t){var i=e.uploadedValue;return i[0]!==t?(De.mainContext.uniform1i(e.location,i[0]=t),1):0},e._uniform1iv=function(e,t){return De.mainContext.uniform1iv(e.location,t),1},e._uniform_ivec2=function(e,t){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]?(De.mainContext.uniform2i(e.location,i[0]=t[0],i[1]=t[1]),1):0},e._uniform_ivec2v=function(e,t){return De.mainContext.uniform2iv(e.location,t),1},e._uniform_vec3i=function(e,t){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]?(De.mainContext.uniform3i(e.location,i[0]=t[0],i[1]=t[1],i[2]=t[2]),1):0},e._uniform_vec3vi=function(e,t){return De.mainContext.uniform3iv(e.location,t),1},e._uniform_vec4i=function(e,t){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]||i[3]!==t[3]?(De.mainContext.uniform4i(e.location,i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3]),1):0},e._uniform_vec4vi=function(e,t){return De.mainContext.uniform4iv(e.location,t),1},e._uniform_sampler2D=function(e,t){var i=De.mainContext,n=e.uploadedValue;return null==n[0]?(n[0]=this._curActTexIndex,i.uniform1i(e.location,this._curActTexIndex),i.activeTexture(h._TEXTURES[this._curActTexIndex]),Ne.bindTexture(i,3553,t),this._curActTexIndex++,1):(i.activeTexture(h._TEXTURES[n[0]]),Ne.bindTexture(i,3553,t),0)},e._uniform_samplerCube=function(e,t){var i=De.mainContext,n=e.uploadedValue;return null==n[0]?(n[0]=this._curActTexIndex,i.uniform1i(e.location,this._curActTexIndex),i.activeTexture(h._TEXTURES[this._curActTexIndex]),Ne.bindTexture(i,34067,t),this._curActTexIndex++,1):(i.activeTexture(h._TEXTURES[n[0]]),Ne.bindTexture(i,34067,t),0)},e._noSetValue=function(e){console.log("no....:"+e.name)},e.uploadOne=function(e,t){this.activeResource(),Ne.UseProgram(this._program);var i=this._paramsMap[e];i.fun.call(this,i,t)},e.uploadTexture2D=function(e){A.shaderCall++;var t=De.mainContext;t.activeTexture(33984),Ne.bindTexture(t,3553,e)},e.upload=function(e,t){Qe.activeShader=Qe.bindShader=this,this._lastUseFrameCount===A.loopCount||this.activeResource(),Ne.UseProgram(this._program),this._reCompile?(t=this._params,this._reCompile=!1):t=t||this._params;De.mainContext;for(var i,n,a=t.length,r=0,s=0;s<a;s++)null!==(n=e[(i=t[s]).name])&&(r+=i.fun.call(this,i,n));A.shaderCall+=r},e.uploadArray=function(e,t,i){Qe.activeShader=this,(Qe.bindShader=this).activeResource(),Ne.UseProgram(this._program);this._params;for(var n,a,r=0,s=t-2;0<=s;s-=2)(a=this._paramsMap[e[s]])&&null!=(n=e[s+1])&&(i&&i[a.name]&&i[a.name].bind(),r+=a.fun.call(this,a,n));A.shaderCall+=r},e.getParams=function(){return this._params},h.getShader=function(e){return h.sharders[e]},h.create=function(e,t,i,n){return new h(e,t,i,n)},h.withCompile=function(e,t,i,n){if(i&&h.sharders[i])return h.sharders[i];var a=h._preCompileShader[2e-4*e];if(!a)throw new Error("withCompile shader err!"+e);return a.createShader(t,i,n)},h.withCompile2D=function(e,t,i,n,a){if(n&&h.sharders[n])return h.sharders[n];var r=h._preCompileShader[2e-4*e+t];if(!r)throw new Error("withCompile shader err!"+e+" "+t);return r.createShader(i,n,a)},h.addInclude=function(e,t){Ie.addInclude(e,t)},h.preCompile=function(e,t,i,n){var a=2e-4*e;h._preCompileShader[a]=new Ie(a,t,i,n)},h.preCompile2D=function(e,t,i,n,a){var r=2e-4*e+t;h._preCompileShader[r]=new Ie(r,i,n,a)},h._createShader=function(e,t,i){var n=e.createShader(i);return e.shaderSource(n,t),e.compileShader(n),n},h._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],h._count=0,h._preCompileShader={},h.SHADERNAME2ID=2e-4,h.sharders=((h.sharders=[]).length=32,h.sharders),s(h,["nameKey",function(){return this.nameKey=new I}]),h}(),ft=function(e){function t(){this._maxsize=0,this._upload=!0,this._uploadSize=0,t.__super.call(this),this.lock=!0}d(t,"laya.webgl.utils.Buffer2D",e);var i=t.prototype;return i.needSize=function(e){var t=this._byteLength;if(e){var i=this._byteLength+e;i<=this._buffer.byteLength||this._resizeBuffer(i<<1,!0),this._byteLength=i}return t},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),A.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,et._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),et._gl.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(e,t,i){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),A.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,et._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),t||i){var n=this._buffer.slice(t,i);et._gl.bufferSubData(this._bufferType,e,n)}else et._gl.bufferSubData(this._bufferType,e,this._buffer)},i._checkArrayUse=function(){},i._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},i._bind_subUpload=function(e,t,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(e,t,i),!0)},i._resizeBuffer=function(e,t){if(e<this._buffer.byteLength)return this;if(this.memorySize=e,t&&this._buffer&&0<this._buffer.byteLength){var i=new ArrayBuffer(e);new Uint8Array(i).set(new Uint8Array(this._buffer),0),this._buffer=i}else this._buffer=new ArrayBuffer(e);return this._checkArrayUse(),this._upload=!0,this},i.append=function(e){this._upload=!0;var t,i;t=e.byteLength,e instanceof Uint8Array?(this._resizeBuffer(this._byteLength+t,!0),i=new Uint8Array(this._buffer,this._byteLength)):e instanceof Uint16Array?(this._resizeBuffer(this._byteLength+t,!0),i=new Uint16Array(this._buffer,this._byteLength)):e instanceof Float32Array&&(this._resizeBuffer(this._byteLength+t,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(e,0),this._byteLength+=t,this._checkArrayUse()},i.appendU16Array=function(e,t){this._resizeBuffer(this._byteLength+2*t,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,t),n=0;n<t;n++)i[n]=e[n];this._byteLength+=2*t,this._checkArrayUse()},i.appendEx=function(e,t){this._upload=!0;var i;i=e.byteLength,this._resizeBuffer(this._byteLength+i,!0),new t(this._buffer,this._byteLength).set(e,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx2=function(e,t,i,n){void 0===n&&(n=1),this._upload=!0;var a,r;a=i*n,this._resizeBuffer(this._byteLength+a,!0),r=new t(this._buffer,this._byteLength);var s=0;for(s=0;s<i;s++)r[s]=e[s];this._byteLength+=a,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var e=this._bind_upload();return et._gl.bindBuffer(this._bufferType,null),et._bindActive[this._bufferType]=null,Qe.activeShader=null,e},i.subUpload=function(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0);var n=this._bind_subUpload();return et._gl.bindBuffer(this._bufferType,null),et._bindActive[this._bufferType]=null,Qe.activeShader=null,n},i.disposeResource=function(){e.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},n(0,i,"bufferLength",function(){return this._buffer.byteLength}),n(0,i,"byteLength",null,function(e){this._byteLength!==e&&(e<=this._buffer.byteLength||this._resizeBuffer(2*e+256,!0),this._byteLength=e)}),t.__int__=function(e){vt.QuadrangleIB=vt.create(35044),we.fillIBQuadrangle(vt.QuadrangleIB,16)},t.FLOAT32=4,t.SHORT=2,t}(et),mt=(function(t){function i(e){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,i.__super.call(this,9)}d(i,"laya.webgl.shader.d2.value.GlowSV",t);var e=i.prototype;e.setValue=function(e){t.prototype.setValue.call(this,e)},e.clear=function(){t.prototype.clear.call(this)}}(st),function(e){function t(e){t.__super.call(this,64),this.defines.add(64)}d(t,"laya.webgl.shader.d2.value.TextSV",e);var i=t.prototype;return i.release=function(){(t.pool[t._length++]=this).clear()},i.clear=function(){e.prototype.clear.call(this)},t.create=function(){return t._length?t.pool[--t._length]:new t(null)},t.pool=[],t._length=0,t}(st)),gt=function(e){function a(e,t,i,n){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,a.__super.call(this,e,t,i,n)}d(a,"laya.webgl.shader.d2.Shader2X",e);var t=a.prototype;return t.upload2dQuick1=function(e){this.upload(e,this._params2dQuick1||this._make2dQuick1())},t._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var e,t=this._params,i=0,n=t.length;i<n;i++)e=t[i],(g.isFlash||"size"!==e.name&&"position"!==e.name&&"texcoord"!==e.name)&&this._params2dQuick1.push(e)}return this._params2dQuick1},t.disposeResource=function(){e.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},t.upload2dQuick2=function(e){this.upload(e,this._params2dQuick2||this._make2dQuick2())},t._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var e,t=this._params,i=0,n=t.length;i<n;i++)e=t[i],!g.isFlash&&"size"===e.name||this._params2dQuick2.push(e)}return this._params2dQuick2},a.create=function(e,t,i,n){return new a(e,t,i,n)},a}(pt),vt=function(){function t(e){this._uint8Array=null,this._uint16Array=null,void 0===e&&(e=35044),t.__super.call(this),this._bufferUsage=e,this._bufferType=34963,g.isFlash||(this._buffer=new ArrayBuffer(8))}d(t,"laya.webgl.utils.IndexBuffer2D",ft);var e=t.prototype;return e._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},e.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},e.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},e.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},t.QuadrangleIB=null,t.create=function(e){return void 0===e&&(e=35044),new t(e)},t}(),yt=function(e){function i(e,t){this._floatArray32=null,this._vertexStride=0,i.__super.call(this),this._vertexStride=e,this._bufferUsage=t,this._bufferType=34962,g.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}d(i,"laya.webgl.utils.VertexBuffer2D",e);var t=i.prototype;return t.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},t.bind=function(e){e&&e._bind(),this._bind()},t.insertData=function(e,t){this.getFloat32Array().set(e,t),this._upload=!0},t.bind_upload=function(e){e._bind_upload()||e._bind(),this._bind_upload()||this._bind()},t._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},t.disposeResource=function(){e.prototype.disposeResource.call(this)},t.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},n(0,t,"vertexStride",function(){return this._vertexStride}),i.create=function(e,t){return void 0===t&&(t=35048),new i(e,t)},i}(ft),Ct=function(){function r(e,t,i,n){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===i&&(i=6408),void 0===n&&(n=!0),r.__super.call(this,e,t),this._format=i,this._mipmap=n,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof e)this._url=e,this._src=e,this._image=new _.window.Image,t&&(t.onload&&(this.onload=t.onload),t.onerror&&(this.onerror=t.onerror),t.onCreate&&t.onCreate(this)),this._image.crossOrigin=e&&0==e.indexOf("data:")?null:"",e&&(this._image.src=e);else if(e instanceof ArrayBuffer){this._src=t,this._url=this._src;var a=new o(e);a.readUTFBytes(4),a.readUTFBytes(2),a.getInt16();a.endian="bigEndian",this._w=a.getInt16(),this._h=a.getInt16();a.getInt16(),a.getInt16();this._image=new Uint8Array(e,a.pos),this._format=De.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,U.enabled&&this._w<U.atlasLimitWidth&&this._h<U.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else this._src=t,this._url=this._src,this._image=e.source||e,this.onresize();this._$5__enableMerageInAtlas=!0}d(r,"laya.webgl.resource.WebGLImage",f);var e=r.prototype;return S.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e._init_=function(e,t){},e._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var e=De.mainContext,t=this._source=e.createTexture(),i=Ne.curBindTexTarget,n=Ne.curBindTexValue;if(Ne.bindTexture(e,3553,t),g.isConchWebGL)switch(this._format){case 6408:e.texImage2DEx(!0,3553,0,this._format,6408,5121,this._image);break;case De.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:e.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}else{switch(e.pixelStorei(37441,!0),this._format){case 6408:e.texImage2D(3553,0,this._format,6408,5121,this._image);break;case De.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:e.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}e.pixelStorei(37441,!1)}var a=this.minFifter,r=this.magFifter,s=this.repeat?10497:33071,o=l.isPOT(this._w,this._h);o?(this.mipmap?-1!==a||(a=9987):-1!==a||(a=9729),-1!==r||(r=9729),e.texParameteri(3553,10241,a),e.texParameteri(3553,10240,r),e.texParameteri(3553,10242,s),e.texParameteri(3553,10243,s),this.mipmap&&e.generateMipmap(3553)):(-1!==a||(a=9729),-1!==r||(r=9729),e.texParameteri(3553,10241,a),e.texParameteri(3553,10240,r),e.texParameteri(3553,10242,33071),e.texParameteri(3553,10243,33071)),i&&n&&Ne.bindTexture(e,i,n),this._image.onload=null,this._image=null,o&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._recreateLock=!1},e.recreateResource=function(){var e=this;if(null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var t=this;this._image=new _.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(t._needReleaseAgain)return t._needReleaseAgain=!1,t._image.onload=null,void(t._image=null);t._allowMerageInAtlas&&t._enableMerageInAtlas?(e.memorySize=0,e._recreateLock=!1):t._createWebGlTexture(),t.completeCreate()},this._image.src=this._src}},e.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(De.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},e.onresize=function(){this._w=this._image.width,this._h=this._image.height,U.enabled&&this._w<U.atlasLimitWidth&&this._h<U.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},e.clearAtlasSource=function(){this._image=null},n(0,e,"format",function(){return this._format}),n(0,e,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(e){this._$5__enableMerageInAtlas=e}),n(0,e,"mipmap",function(){return this._mipmap}),n(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),n(0,e,"atlasSource",function(){return this._image}),n(0,e,"onload",null,function(e){var t=this;this._onload=e,this._image&&(this._image.onload=null!=this._onload?function(){t.onresize(),t._onload()}:null)}),n(0,e,"onerror",null,function(e){var t=this;this._onerror=e,this._image&&(this._image.onerror=null!=this._onerror?function(){t._onerror()}:null)}),r}();S.__init([Ce,H,Ve,Ie])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,t){"use strict";for(var i in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(t[i]=n)}}),function(e,t,ae){ae.un,ae.uns;var i=ae.static,s=ae.class,n=ae.getset,f=ae.__newvec,o=laya.maths.Bezier,u=laya.utils.Browser,Le=laya.utils.Byte,a=(laya.events.Event,laya.events.EventDispatcher),r=laya.display.Graphics,l=laya.resource.HTMLCanvas,h=laya.utils.Handler,c=laya.net.Loader,d=laya.maths.MathUtil,Ae=laya.maths.Matrix,_=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle),m=laya.renders.Render,p=(laya.renders.RenderContext,laya.resource.Resource),g=laya.utils.RunDriver,re=laya.display.Sprite,v=laya.utils.Stat,Ie=laya.resource.Texture,y=(laya.net.URL,laya.utils.Utils),A=(s(C,"laya.ani.AnimationContent"),C);function C(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}var I=(s(E,"laya.ani.AnimationNodeContent"),E);function E(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}var S=(s(x,"laya.ani.AnimationParser01"),x.parse=function(e,t){var i=t.__getBuffer(),n=0,a=0,r=0,s=0,o=0,l=0,h=0,c=t.readUTFString();e._aniClassName=c;var u,d=t.readUTFString().split("\n"),_=t.getUint8(),p=t.getUint32(),f=t.getUint32();0<p&&(u=i.slice(p,f));var m=new Le(u);for(0<f&&(e._publicExtData=i.slice(f,i.byteLength)),e._useParent=!!t.getUint8(),e._anis.length=_,n=0;n<_;n++){var g=e._anis[n]=new A;g.nodes=new Array;var v=g.name=d[t.getUint16()];e._aniMap[v]=n,g.bone3DMap={},g.playTime=t.getFloat32();var y=g.nodes.length=t.getUint8();for(a=g.totalKeyframeDatasLength=0;a<y;a++){var C=g.nodes[a]=new I;C.childs=[];var E=t.getInt16();0<=E&&(C.name=d[E],g.bone3DMap[C.name]=a),C.keyFrame=new Array,C.parentIndex=t.getInt16(),-1==C.parentIndex?C.parent=null:C.parent=g.nodes[C.parentIndex],C.lerpType=t.getUint8();var S=t.getUint32();m.pos=S;var x=C.keyframeWidth=m.getUint16();if(g.totalKeyframeDatasLength+=x,0===C.lerpType||1===C.lerpType)for(C.interpolationMethod=[],C.interpolationMethod.length=x,r=0;r<x;r++)C.interpolationMethod[r]=ne.interpolation[m.getUint8()];null!=C.parent&&C.parent.childs.push(C);var T=t.getUint16();0<T&&(C.extenData=i.slice(t.pos,t.pos+T),t.pos+=T);var w,M=t.getUint16(),b=0;for(r=0,s=C.keyFrame.length=M;r<s;r++){if((w=C.keyFrame[r]=new q).duration=t.getFloat32(),w.startTime=b,2===C.lerpType){w.interpolationData=[];var R,L=t.getUint8();switch(R=t.getFloat32()){case 254:for(w.interpolationData.length=x,h=0;h<x;h++)w.interpolationData[h]=0;break;case 255:for(w.interpolationData.length=x,h=0;h<x;h++)w.interpolationData[h]=5;break;default:for(w.interpolationData.push(R),l=1;l<L;l++)w.interpolationData.push(t.getFloat32())}}for(w.data=new Float32Array(x),o=0;o<x;o++)w.data[o]=t.getFloat32(),-1e-8<w.data[o]&&w.data[o]<1e-8&&(w.data[o]=0);b+=w.duration}w.startTime=g.playTime,C.playTime=g.playTime,e._calculateKeyFrame(C,M,x)}}},x);function x(){}var T=(s(w,"laya.ani.AnimationParser02"),w.READ_DATA=function(){w._DATA.offset=w._reader.getUint32(),w._DATA.size=w._reader.getUint32()},w.READ_BLOCK=function(){for(var e=w._BLOCK.count=w._reader.getUint16(),t=w._BLOCK.blockStarts=[],i=w._BLOCK.blockLengths=[],n=0;n<e;n++)t.push(w._reader.getUint32()),i.push(w._reader.getUint32())},w.READ_STRINGS=function(){var e=w._reader.getUint32(),t=w._reader.getUint16(),i=w._reader.pos;w._reader.pos=e+w._DATA.offset;for(var n=0;n<t;n++)w._strings[n]=w._reader.readUTFString();w._reader.pos=i},w.parse=function(e,t){w._templet=e,(w._reader=t).__getBuffer(),w.READ_DATA(),w.READ_BLOCK(),w.READ_STRINGS();for(var i=0,n=w._BLOCK.count;i<n;i++){var a=t.getUint16(),r=w._strings[a],s=w["READ_"+r];if(null==s)throw new Error("model file err,no this function:"+a+" "+r);s.call()}},w.READ_ANIMATIONS=function(){var e=w._reader,t=e.__getBuffer(),i=0,n=0,a=0,r=0,s=e.getUint16(),o=[];for(o.length=s,i=0;i<s;i++)o[i]=ne.interpolation[e.getByte()];var l=e.getUint8();for(w._templet._anis.length=l,i=0;i<l;i++){var h=w._templet._anis[i]={};h.nodes=new Array;var c=h.name=w._strings[e.getUint16()];w._templet._aniMap[c]=i,h.bone3DMap={},h.playTime=e.getFloat32();var u=h.nodes.length=e.getInt16();for(n=h.totalKeyframeDatasLength=0;n<u;n++){var d=h.nodes[n]={};d.keyframeWidth=s,d.childs=[];var _=e.getUint16();0<=_&&(d.name=w._strings[_],h.bone3DMap[d.name]=n),d.keyFrame=new Array,d.parentIndex=e.getInt16(),-1==d.parentIndex?d.parent=null:d.parent=h.nodes[d.parentIndex],h.totalKeyframeDatasLength+=s,d.interpolationMethod=o,null!=d.parent&&d.parent.childs.push(d);var p=e.getUint16(),f=null,m=null;for(a=0,r=d.keyFrame.length=p;a<r;a++){(f=d.keyFrame[a]={}).startTime=e.getFloat32(),m&&(m.duration=f.startTime-m.startTime);var g=w._DATA.offset,v=e.getUint32(),y=4*s,C=t.slice(g+v,g+v+y);f.data=new Float32Array(C),m=f}f.duration=0,d.playTime=h.playTime,w._templet._calculateKeyFrame(d,p,s)}}},w._templet=null,w._reader=null,w._strings=[],i(w,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),w);function w(){}s(M,"laya.ani.AnimationState"),M.stopped=0,M.paused=1,M.playing=2;function M(){}var De=function(){function a(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new Xe,this.resultMatrix=new Ae,this._children=[]}s(a,"laya.ani.bone.Bone");var e=a.prototype;return e.setTempMatrix=function(e){this._tempMatrix=e;var t,i=0;for(i=0,t=this._children.length;i<t;i++)this._children[i].setTempMatrix(this._tempMatrix)},e.update=function(e){var t;if(this.rotation=this.transform.skX,e)t=this.resultTransform.getMatrix(),Ae.mul(t,e,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)t=this.resultTransform.getMatrix(),Ae.mul(t,this.parentBone.resultMatrix,this.resultMatrix);else{var i=this.parentBone,n=NaN,a=NaN,r=NaN,s=this.parentBone.resultMatrix;t=this.resultTransform.getMatrix();var o=s.a*t.tx+s.c*t.ty+s.tx,l=s.b*t.tx+s.d*t.ty+s.ty,h=new Ae;this.inheritRotation?(n=Math.atan2(i.resultMatrix.b,i.resultMatrix.a),a=Math.cos(n),r=Math.sin(n),h.setTo(a,r,-r,a,0,0),Ae.mul(this._tempMatrix,h,Ae.TEMP),Ae.TEMP.copyTo(h),t=this.resultTransform.getMatrix(),Ae.mul(t,h,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,t=this.resultTransform.getMatrix(),Ae.TEMP.identity(),Ae.TEMP.d=this.d,Ae.mul(t,Ae.TEMP,this.resultMatrix)),this.resultMatrix.tx=o,this.resultMatrix.ty=l}else(t=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var c,u=0;for(u=0,c=this._children.length;u<c;u++)this._children[u].update()},e.updateChild=function(){var e,t=0;for(t=0,e=this._children.length;t<e;t++)this._children[t].update()},e.setRotation=function(e){this._sprite&&(this._sprite.rotation=180*e/Math.PI)},e.updateDraw=function(e,t){a.ShowBones&&!a.ShowBones[this.name]||(this._sprite||(this._sprite=new re,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),ae.stage.addChild(this._sprite)),this._sprite.x=e+this.resultMatrix.tx,this._sprite.y=t+this.resultMatrix.ty);var i,n=0;for(n=0,i=this._children.length;n<i;n++)this._children[n].updateDraw(e,t)},e.addChild=function(e){this._children.push(e),e.parentBone=this},e.findBone=function(e){if(this.name==e)return this;var t,i,n=0;for(n=0,t=this._children.length;n<t;n++)if(i=this._children[n].findBone(e))return i;return null},e.localToWorld=function(e){var t=e[0],i=e[1];e[0]=t*this.resultMatrix.a+i*this.resultMatrix.c+this.resultMatrix.tx,e[1]=t*this.resultMatrix.b+i*this.resultMatrix.d+this.resultMatrix.ty},a.ShowBones={},a}(),Pe=function(){function f(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}s(f,"laya.ani.bone.BoneSlot");var e=f.prototype;return e.showSlotData=function(e,t){void 0===t&&(t=!0),this.currSlotData=e,t&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},e.showDisplayByName=function(e){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(e))},e.replaceDisplayByName=function(e,t){if(this.currSlotData){var i;i=this.currSlotData.getDisplayByName(e);var n;n=this.currSlotData.getDisplayByName(t),this.replaceDisplayByIndex(i,n)}},e.replaceDisplayByIndex=function(e,t){this.currSlotData&&(this._replaceDic[e]=t,this.displayIndex==e&&this.showDisplayByIndex(e))},e.showDisplayByIndex=function(e){if(null!=this._replaceDic[e]&&(e=this._replaceDic[e]),this.currSlotData&&-1<e&&e<this.currSlotData.displayArr.length){if(this.displayIndex=e,this.currDisplayData=this.currSlotData.displayArr[e],this.currDisplayData){var t=this.currDisplayData.name;this.currTexture=this.templet.getTexture(t),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!m.isConchApp||m.isConchApp&&"0.9.15"<re.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},e.replaceSkin=function(e){this._diyTexture=e,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},e.setParentMatrix=function(e){this._parentMatrix=e},e.draw=function(e,t,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var a,r=this.currTexture;switch(this._diyTexture&&(r=this._diyTexture),this.currDisplayData.type){case 0:if(e){var s=this.getDisplayMatrix();if(this._parentMatrix){var o=!1;if(s){var l;if(Ae.mul(s,this._parentMatrix,Ae.TEMP),l=i?(null==this._resultMatrix&&(this._resultMatrix=new Ae),this._resultMatrix):new Ae,!m.isWebGL&&this.currDisplayData.uvs||m.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var h=f._tempMatrix;h.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(h.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(o=!0,h.rotate(-Math.PI/2)),Ae.mul(h,Ae.TEMP,l)}else Ae.TEMP.copyTo(l);o?e.drawTexture(r,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,l):e.drawTexture(r,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,l)}}}break;case 1:if(null==(a=i?(null==this._skinSprite&&(this._skinSprite=f.createSkinMesh()),this._skinSprite):f.createSkinMesh()))return;var c;if(null==this.currDisplayData.bones){var u,d=this.currDisplayData.weights;this.deformData&&(d=this.deformData),u=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=Y.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=Y.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=d;this.currDisplayData.triangles.length;c=this.currDisplayData.triangles,a.init2(r,null,c,this._mVerticleArr,u);var _,p=this.getDisplayMatrix();if(this._parentMatrix)if(p)Ae.mul(p,this._parentMatrix,Ae.TEMP),_=i?(null==this._resultMatrix&&(this._resultMatrix=new Ae),this._resultMatrix):new Ae,Ae.TEMP.copyTo(_),a.transform=_}else this.skinMesh(t,a,n);e.drawSkin(a);break;case 2:if(null==(a=i?(null==this._skinSprite&&(this._skinSprite=f.createSkinMesh()),this._skinSprite):f.createSkinMesh()))return;this.skinMesh(t,a,n),e.drawSkin(a)}}},e.skinMesh=function(e,t,i){var n,a=this.currTexture,r=this.currDisplayData.bones;n=this._diyTexture?(a=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=Y.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=Y.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var s,o,l=this.currDisplayData.weights,h=this.currDisplayData.triangles,c=0,u=0,d=0,_=NaN,p=NaN,f=0,m=0,g=[],v=0,y=0;if(this.deformData&&0<this.deformData.length){var C=0;for(v=0,y=r.length;v<y;){for(d=r[v++]+v,u=c=0;v<d;v++)o=e[r[v]],_=l[f]+this.deformData[C++],p=l[f+1]+this.deformData[C++],m=l[f+2],c+=(_*o.a+p*o.c+o.tx)*m,u+=(_*o.b+p*o.d+o.ty)*m,f+=3;g.push(c,u)}}else for(v=0,y=r.length;v<y;){for(d=r[v++]+v,u=c=0;v<d;v++)o=e[r[v]],_=l[f],p=l[f+1],m=l[f+2],c+=(_*o.a+p*o.c+o.tx)*m,u+=(_*o.b+p*o.d+o.ty)*m,f+=3;g.push(c,u)}this._mVerticleArr=g,s=h,t.init2(a,null,s,this._mVerticleArr,n)},e.drawBonePoint=function(e){e&&this._parentMatrix&&e.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},e.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},e.getMatrix=function(){return this._resultMatrix},e.copy=function(){var e=new f;return e.type="copy",e.name=this.name,e.attachmentName=this.attachmentName,e.srcDisplayIndex=this.srcDisplayIndex,e.parent=this.parent,e.displayIndex=this.displayIndex,e.templet=this.templet,e.currSlotData=this.currSlotData,e.currTexture=this.currTexture,e.currDisplayData=this.currDisplayData,e},f.createSkinMesh=function(){return m.isWebGL||m.isConchApp?g.skinAniSprite():m.isWebGL?null:oe.useSimpleMeshInCanvas?new se:new ie},i(f,["_tempMatrix",function(){return this._tempMatrix=new Ae}]),f}(),b=function(){function e(){this.mesh=null,this.transform=null,this.context=null,this.mode=0}s(e,"laya.ani.bone.canvasmesh.CanvasMeshRender");var t=e.prototype;return t.renderToContext=function(e){this.context=e.ctx||e,this.mesh&&(0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh))},t._renderNoIndexes=function(e){var t=0,i=e.vertices.length/2,n=0;for(t=0;t<i-2;t++)n=2*t,this._renderDrawTriangle(e,n,n+2,n+4)},t._renderWithIndexes=function(e){var t=e.indexes,i=0,n=t.length;for(i=0;i<n;i+=3){var a=2*t[i],r=2*t[i+1],s=2*t[i+2];this._renderDrawTriangle(e,a,r,s)}},t._renderDrawTriangle=function(e,t,i,n){var a=this.context,r=e.uvs,s=e.vertices,o=e.texture,l=o.bitmap,h=l.source,c=o.width,u=o.height,d=l.width,_=l.height,p=NaN,f=NaN,m=NaN,g=NaN,v=NaN,y=NaN;if(e.useUvTransform){var C=e.uvTransform;p=(r[t]*C.a+r[t+1]*C.c+C.tx)*d,f=(r[i]*C.a+r[i+1]*C.c+C.tx)*d,m=(r[n]*C.a+r[n+1]*C.c+C.tx)*d,g=(r[t]*C.b+r[t+1]*C.d+C.ty)*_,v=(r[i]*C.b+r[i+1]*C.d+C.ty)*_,y=(r[n]*C.b+r[n+1]*C.d+C.ty)*_}else p=r[t]*d,f=r[i]*d,m=r[n]*d,g=r[t+1]*_,v=r[i+1]*_,y=r[n+1]*_;var E=s[t],S=s[i],x=s[n],T=s[t+1],w=s[i+1],M=s[n+1];if(0<e.canvasPadding){var b=e.canvasPadding,R=e.canvasPadding,L=(E+S+x)/3,A=(T+w+M)/3,I=E-L,D=T-A,P=Math.sqrt(I*I+D*D);E=L+I/P*(P+b),T=A+D/P*(P+R),D=w-A,S=L+(I=S-L)/(P=Math.sqrt(I*I+D*D))*(P+b),w=A+D/P*(P+R),D=M-A,x=L+(I=x-L)/(P=Math.sqrt(I*I+D*D))*(P+b),M=A+D/P*(P+R)}if(a.save(),this.transform){var N=this.transform;a.transform(N.a,N.b,N.c,N.d,N.tx,N.ty)}a.beginPath(),a.moveTo(E,T),a.lineTo(S,w),a.lineTo(x,M),a.closePath(),a.clip();var O=1/(p*v+g*m+f*y-v*m-g*f-p*y),k=E*v+g*x+S*y-v*x-g*S-E*y,V=p*S+E*m+f*x-S*m-E*f-p*x,B=p*v*x+g*S*m+E*f*y-E*v*m-g*f*x-p*S*y,F=T*v+g*M+w*y-v*M-g*w-T*y,H=p*w+T*m+f*M-w*m-T*f-p*M,U=p*v*M+g*w*m+T*f*y-T*v*m-g*f*M-p*w*y;a.transform(k*O,F*O,V*O,H*O,B*O,U*O),a.drawImage(h,o.uv[0]*d,o.uv[1]*_,c,u,o.uv[0]*d,o.uv[1]*_,c,u),a.restore()},e}(),R=(s(L,"laya.ani.bone.canvasmesh.MeshData"),L.prototype.getBounds=function(){return _._getWrapRec(this.vertices)},L);function L(){this.texture=null,this.uvs=[0,0,1,0,1,1,0,1],this.vertices=[0,0,100,0,100,100,0,100],this.indexes=[0,1,3,3,1,2],this.uvTransform=null,this.useUvTransform=!1,this.canvasPadding=1}var Ne=(s(D,"laya.ani.bone.DeformAniData"),D);function D(){this.skinName=null,this.deformSlotDataList=[]}var Oe=(s(P,"laya.ani.bone.DeformSlotData"),P);function P(){this.deformSlotDisplayList=[]}var ke=function(){function e(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}s(e,"laya.ani.bone.DeformSlotDisplayData");var t=e.prototype;return t.binarySearch1=function(e,t){var i=0,n=e.length-2;if(0==n)return 1;for(var a=n>>>1;;){if(e[Math.floor(a+1)]<=t?i=a+1:n=a,i==n)return i+1;a=i+n>>>1}return 0},t.apply=function(e,t,i){if(void 0===i&&(i=1),e+=.05,!(this.timeList.length<=0)){var n=0;if(!(e<this.timeList[0])){var a=this.vectices[0].length,r=[],s=this.binarySearch1(this.timeList,e);if(this.frameIndex=s,e>=this.timeList[this.timeList.length-1]){var o=this.vectices[this.vectices.length-1];if(i<1)for(n=0;n<a;n++)r[n]+=(o[n]-r[n])*i;else for(n=0;n<a;n++)r[n]=o[n];this.deformData=r}else{this.tweenKeyList[this.frameIndex];var l=this.vectices[this.frameIndex-1],h=this.vectices[this.frameIndex],c=this.timeList[this.frameIndex-1],u=this.timeList[this.frameIndex];i=this.tweenKeyList[s-1]?(e-c)/(u-c):0;var d=NaN;for(n=0;n<a;n++)d=l[n],r[n]=d+(h[n]-d)*i;this.deformData=r}}}},e}(),Ve=(s(N,"laya.ani.bone.DrawOrderData"),N);function N(){this.time=NaN,this.drawOrder=[]}var Be=(s(O,"laya.ani.bone.EventData"),O);function O(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}var k=function(){function ne(e,t){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=e,this._targetBone=t[e.targetBoneIndex],this.isSpine=e.isSpine,null==this._bones&&(this._bones=[]);for(var i=this._bones.length=0,n=e.boneIndexs.length;i<n;i++)this._bones.push(t[e.boneIndexs[i]]);this.name=e.name,this.mix=e.mix,this.bendDirection=e.bendDirection}s(ne,"laya.ani.bone.IkConstraint");var e=ne.prototype;return e.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},e._applyIk1=function(e,t,i,n){var a=e.parentBone,r=1/(a.resultMatrix.a*a.resultMatrix.d-a.resultMatrix.b*a.resultMatrix.c),s=t-a.resultMatrix.tx,o=i-a.resultMatrix.ty,l=(s*a.resultMatrix.d-o*a.resultMatrix.c)*r-e.transform.x,h=(o*a.resultMatrix.a-s*a.resultMatrix.b)*r-e.transform.y,c=Math.atan2(h,l)*ne.radDeg-0-e.transform.skX;e.transform.scX<0&&(c+=180),180<c?c-=360:c<-180&&(c+=360),e.transform.skX=e.transform.skY=e.transform.skX+c*n,e.update()},e.updatePos=function(e,t){this._sp&&this._sp.pos(e,t)},e._applyIk2=function(e,t,i,n,a,r){if(0!=r){var s=e.resultTransform.x,o=e.resultTransform.y,l=e.transform.scX,h=e.transform.scY,c=t.transform.scX,u=0,d=0,_=0;_=l<0?(l=-l,u=180,-1):(u=0,1),h<0&&(h=-h,_=-_),d=c<0?(c=-c,180):0;var p=t.resultTransform.x,f=NaN,m=NaN,g=NaN,v=e.resultMatrix.a,y=e.resultMatrix.c,C=e.resultMatrix.b,E=e.resultMatrix.d,S=Math.abs(l-h)<=1e-4;g=S?(m=v*p+y*(f=t.resultTransform.y)+e.resultMatrix.tx,C*p+E*f+e.resultMatrix.ty):(f=0,m=v*p+e.resultMatrix.tx,C*p+e.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new re,ae.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(i,n,15,"#ffff00"),this._sp.graphics.drawCircle(m,g,15,"#ff00ff")),e.setRotation(Math.atan2(g-e.resultMatrix.ty,m-e.resultMatrix.tx));var x=e.parentBone;v=x.resultMatrix.a,y=x.resultMatrix.c,C=x.resultMatrix.b;var T=1/(v*(E=x.resultMatrix.d)-y*C),w=i-x.resultMatrix.tx,M=n-x.resultMatrix.ty,b=(w*E-M*y)*T-s,R=(M*v-w*C)*T-o,L=((w=m-x.resultMatrix.tx)*E-(M=g-x.resultMatrix.ty)*y)*T-s,A=(M*v-w*C)*T-o,I=Math.sqrt(L*L+A*A),D=t.length*c,P=NaN,N=NaN;if(S){var O=(b*b+R*R-I*I-(D*=l)*D)/(2*I*D);O<-1?O=-1:1<O&&(O=1),N=Math.acos(O)*a,v=I+D*O,y=D*Math.sin(N),P=Math.atan2(R*v-b*y,b*v+R*y)}else{var k=(v=l*D)*v,V=(y=h*D)*y,B=b*b+R*R,F=Math.atan2(R,b),H=-2*V*I,U=V-k;if(0<(E=H*H-4*U*(C=V*I*I+k*B-k*V))){var G=Math.sqrt(E);H<0&&(G=-G);var z=(G=-(H+G)/2)/U,W=C/G,X=Math.abs(z)<Math.abs(W)?z:W;X*X<=B&&(M=Math.sqrt(B-X*X)*a,P=F-Math.atan2(M,X),N=Math.atan2(M/h,(X-I)/l))}var j=0,Y=Number.MAX_VALUE,K=0,q=0,Z=0,Q=0,$=0,J=0;Q<(E=(w=I+v)*w)&&(Z=0,Q=E,$=w),(E=(w=I-v)*w)<Y&&(j=Math.PI,Y=E,K=w);var ee=Math.acos(-v*I/(k-V));(E=(w=v*Math.cos(ee)+I)*w+(M=y*Math.sin(ee))*M)<Y&&(j=ee,Y=E,K=w,q=M),Q<E&&(Z=ee,Q=E,$=w,J=M),N=B<=(Y+Q)/2?(P=F-Math.atan2(q*a,K),j*a):(P=F-Math.atan2(J*a,$),Z*a)}var te=Math.atan2(f,p)*_,ie=e.resultTransform.skX;180<(P=(P-te)*ne.radDeg+u-ie)?P-=360:P<-180&&(P+=360),e.resultTransform.x=s,e.resultTransform.y=o,e.resultTransform.skX=e.resultTransform.skY=ie+P*r,ie=t.resultTransform.skX,180<(N=((N+te)*ne.radDeg-0)*_+d-(ie%=360))?N-=360:N<-180&&(N+=360),t.resultTransform.x=p,t.resultTransform.y=f,t.resultTransform.skX=t.resultTransform.skY=t.resultTransform.skY+N*r,e.update()}},e._applyIk3=function(e,t,i,n,a,r){if(0!=r){var s,o,l=t.resultMatrix.a*t.length,h=t.resultMatrix.b*t.length,c=l*l+h*h,u=Math.sqrt(c),d=e.resultMatrix.tx,_=e.resultMatrix.ty,p=t.resultMatrix.tx,f=t.resultMatrix.ty,m=p-d,g=f-_,v=m*m+g*g,y=Math.sqrt(v),C=(m=i-e.resultMatrix.tx)*m+(g=n-e.resultMatrix.ty)*g,E=Math.sqrt(C);if(u+y<=E||E+u<=y||E+y<=u){var S=NaN;p=d+(S=u+y<=E?1:-1)*(i-d)*y/E,f=_+S*(n-_)*y/E}else{var x=(v-c+C)/(2*C),T=Math.sqrt(v-x*x*C)/E,w=d+m*x,M=_+g*x,b=-g*T,R=m*T;f=0<a?(p=w-b,M-R):(p=w+b,M+R)}s=p,o=f,this.isDebug&&(this._sp||(this._sp=new re,ae.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(d,_,15,"#ff00ff"),this._sp.graphics.drawCircle(i,n,15,"#ffff00"),this._sp.graphics.drawCircle(s,o,15,"#ff00ff"));var L,A;L=Math.atan2(o-e.resultMatrix.ty,s-e.resultMatrix.tx),e.setRotation(L),(A=ne._tempMatrix).identity(),A.rotate(L),A.scale(e.resultMatrix.getScaleX(),e.resultMatrix.getScaleY()),A.translate(e.resultMatrix.tx,e.resultMatrix.ty),A.copyTo(e.resultMatrix),e.updateChild();var I,D;I=Math.atan2(n-o,i-s),t.setRotation(I),(D=ne._tempMatrix).identity(),D.rotate(I),D.scale(t.resultMatrix.getScaleX(),t.resultMatrix.getScaleY()),D.translate(s,o),A.copyTo(t.resultMatrix),t.updateChild()}},i(ne,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new Ae}]),ne}(),Fe=(s(V,"laya.ani.bone.IkConstraintData"),V);function V(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}var B=(s(F,"laya.ani.bone.MeshTools"),F.findEdge=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=!0);var n,a=0,r=0;for(n=e.length,r=-1,a=0;a<n;a+=2)(r<0||i==e[r+t]<e[a+t])&&(r=a);return r},F.findBestTriangle=function(e){var t,i,n,a,r;return t=F.findEdge(e,1,!0),i=F.findEdge(e,1,!1),n=F.findEdge(e,0,!0),a=F.findEdge(e,0,!1),(r=F._bestTriangle).length=0,r.push(n,a),r.indexOf(t)<0&&r.push(t),r.indexOf(i)<0&&r.push(i),r},F.solveMesh=function(e,t){var i,n,a,r,s,o,l;return(t=t||[]).length=0,i=e.uvs,n=e.vertices,s=(r=F.findBestTriangle(i))[0],o=r[1],l=r[2],F._absArr.length=0,F.isNormalUV(e.texture.uv)&&F.adptTexture(e),a=F.solvePoints(e.texture.uv,i[s],i[s+1],i[o]-i[s],i[o+1]-i[s+1],i[l]-i[s],i[l+1]-i[s+1],F._absArr),F.transPoints(a,n[s],n[s+1],n[o]-n[s],n[o+1]-n[s+1],n[l]-n[s],n[l+1]-n[s+1],t)},F.findWrapRect=function(e){var t,i,n,a,r,s,o,l;return t=F.findEdge(e,1,!0),i=F.findEdge(e,1,!1),n=F.findEdge(e,0,!0),a=F.findEdge(e,0,!1),r=e[n],s=e[a],o=e[t+1],[s,l=e[i+1],r-s,o-l]},F.adptTexture=function(e){var t,i,n;t=F.findWrapRect(e.uvs);var a=(i=e.texture).width,r=i.height;n=Ie.create(i,t[0]*a,t[1]*r,t[2]*a,t[3]*r),e.texture=n},F.isNormalUV=function(e){return 0==e[0]&&0==e[1]&&1==e[4]&&1==e[5]},F.solvePoints=function(e,t,i,n,a,r,s,o){o=o||[];var l,h,c=0;for(l=e.length,c=0;c<l;c+=2)h=F.solve2(e[c],e[c+1],t,i,n,a,r,s),o.push(h[0],h[1]);return o},F.transPoints=function(e,t,i,n,a,r,s,o){o=o||[];var l,h=0;for(l=e.length,h=0;h<l;h+=2)F.transPoint(e[h],e[h+1],t,i,n,a,r,s,o);return o},F.transPoint=function(e,t,i,n,a,r,s,o,l){return(l=l||[]).push(i+a*e+s*t,n+r*e+o*t),l},F.solve2=function(e,t,i,n,a,r,s,o,l,h){var c,u,d;return void 0===l&&(l=!1),h=h||[],0==a?F.solve2(e,t,i,n,s,o,a,r,!0,h):(c=((d=e-i)-(u=(t-n-d*r/a)/(o-s*r/a))*s)/a,l?h.push(u,c):h.push(c,u),h)},F.solve=function(e,t,i,n){return F.solve2(e.x,e.y,t.x,t.y,i.x,i.y,n.x,n.y)},F._bestTriangle=[],F._absArr=[],F);function F(){}var H=function(){function D(e,t){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=e,this.position=e.position,this.spacing=e.spacing,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.bones=[];for(var i=this.data.bones,n=0,a=i.length;n<a;n++)this.bones.push(t[i[n]])}s(D,"laya.ani.bone.PathConstraint");var e=D.prototype;return e.apply=function(e,t){if(this.target){var i=this.translateMix,n=this.translateMix,a=0<n,r=this.data.spacingMode,s="length"==r,o=this.data.rotateMode,l="tangent"==o,h="chainScale"==o,c=[],u=this.bones.length,d=l?u:u+1,_=[];(this._spaces=_)[0]=this.position;var p=this.spacing;if(h||s)for(var f=0,m=d-1;f<m;){var g=this.bones[f],v=g.length,y=v*g.resultMatrix.a,C=v*g.resultMatrix.b;v=Math.sqrt(y*y+C*C),h&&(c[f]=v),_[++f]=s?Math.max(0,v+p):p}else for(f=1;f<d;f++)_[f]=p;var E=this.computeWorldPositions(this.target,e,t,d,l,"percent"==this.data.positionMode,"percent"==r);if(this._debugKey){for(f=0;f<E.length;f++)t.drawCircle(E[f++],E[f++],5,"#00ff00");var S=[];for(f=0;f<E.length;f++)S.push(E[f++],E[f++]);t.drawLines(0,0,S,"#ff0000")}var x=E[0],T=E[1],w=this.data.offsetRotation,M="chain"==o&&0==w,b=NaN;for(f=0,b=3;f<u;f++,b+=3){(g=this.bones[f]).resultMatrix.tx+=(x-g.resultMatrix.tx)*i,g.resultMatrix.ty+=(T-g.resultMatrix.ty)*i;var R=(y=E[b])-x,L=(C=E[b+1])-T;if(h&&0!=(v=c[f])){var A=(Math.sqrt(R*R+L*L)/v-1)*n+1;g.resultMatrix.a*=A,g.resultMatrix.c*=A}if(x=y,T=C,a){var I=g.resultMatrix.a,D=g.resultMatrix.c,P=g.resultMatrix.b,N=g.resultMatrix.d,O=NaN,k=NaN,V=NaN;O=l?E[b-1]:0==_[f+1]?E[b+2]:Math.atan2(L,R),O-=Math.atan2(P,I)-w/180*Math.PI,M&&(k=Math.cos(O),V=Math.sin(O),x+=((v=g.length)*(k*I-V*P)-R)*n,T+=(v*(V*I+k*P)-L)*n),O>Math.PI?O-=2*Math.PI:O<-Math.PI&&(O+=2*Math.PI),O*=n,k=Math.cos(O),V=Math.sin(O),g.resultMatrix.a=k*I-V*P,g.resultMatrix.c=k*D-V*N,g.resultMatrix.b=V*I+k*P,g.resultMatrix.d=V*D+k*N}}}},e.computeWorldVertices2=function(e,t,i,n,a,r){var s,o,l=e.currDisplayData.bones,h=e.currDisplayData.weights,c=e.currDisplayData.triangles,u=0,d=0,_=0,p=0,f=0,m=0,g=0,v=0,y=0,C=0,E=0;if(null!=l){for(u=0;u<i;u+=2)d+=(p=l[d])+1,_+=p;var S=t;for(f=r,m=3*_;f<n;f+=2){for(v=g=0,p=l[d++],p+=d;d<p;d++,m+=3){s=S[l[d]].resultMatrix,y=h[m],C=h[m+1];var x=h[m+2];g+=(y*s.a+C*s.c+s.tx)*x,v+=(y*s.b+C*s.d+s.ty)*x}a[f]=g,a[f+1]=v}}else{var T,w;if(c=c||h,e.deformData&&(c=e.deformData),T=e.parent,t)for(E=t.length,u=0;u<E;u++)if(t[u].name==T){o=t[u];break}o&&(w=o.resultMatrix);var M=(w=w||D._tempMt).tx,b=w.ty,R=w.a,L=w.b,A=w.c,I=w.d;for(o&&(I*=o.d),d=i,f=r;f<n;d+=2,f+=2)y=c[d],C=c[d+1],a[f]=y*R+C*L+M,a[f+1]=-(y*A+C*I+b)}},e.computeWorldPositions=function(e,t,i,n,a,r,s){e.currDisplayData.bones,e.currDisplayData.weights,e.currDisplayData.triangles;var o=[],l=0,h=e.currDisplayData.verLen,c=this.position,u=this._spaces,d=[],_=[],p=h/6,f=-1,m=NaN,g=0,v=0,y=NaN,C=NaN,E=NaN,S=NaN;if(p--,h-=4,this.computeWorldVertices2(e,t,2,h,o,0),this._debugKey)for(l=0;l<o.length;)i.drawCircle(o[l++],o[l++],10,"#ff0000");d=o,this._curves.length=p;var x=this._curves,T=d[m=0],w=d[1],M=0,b=0,R=0,L=0,A=0,I=0,D=NaN,P=NaN,N=NaN,O=NaN,k=NaN,V=NaN,B=NaN,F=NaN,H=0;for(l=0,H=2;l<p;l++,H+=6)M=d[H],b=d[H+1],R=d[H+2],L=d[H+3],k=2*(D=.1875*(T-2*M+R))+(N=.09375*(3*(M-R)-T+(A=d[H+4]))),V=2*(P=.1875*(w-2*b+L))+(O=.09375*(3*(b-L)-w+(I=d[H+5]))),B=.75*(M-T)+D+.16666667*N,F=.75*(b-w)+P+.16666667*O,m+=Math.sqrt(B*B+F*F),B+=k,F+=V,k+=N,V+=O,m+=Math.sqrt(B*B+F*F),B+=k,F+=V,m+=Math.sqrt(B*B+F*F),B+=k+N,F+=V+O,m+=Math.sqrt(B*B+F*F),x[l]=m,T=A,w=I;if(r&&(c*=m),s)for(l=0;l<n;l++)u[l]*=m;var U=this._segments,G=0,z=0;for(z=v=g=l=0;l<n;l++,g+=3)if((y=c+=C=u[l])<0)this.addBeforePosition(y,d,0,_,g);else if(m<y)this.addAfterPosition(y-m,d,h-4,_,g);else{for(;;v++)if(!((S=x[v])<y)){0==v?y/=S:y=(y-(E=x[v-1]))/(S-E);break}if(v!=f){var W=6*(f=v);for(T=d[W],w=d[W+1],M=d[W+2],b=d[W+3],R=d[W+4],L=d[W+5],k=2*(D=.03*(T-2*M+R))+(N=.006*(3*(M-R)-T+(A=d[W+6]))),V=2*(P=.03*(w-2*b+L))+(O=.006*(3*(b-L)-w+(I=d[W+7]))),B=.3*(M-T)+D+.16666667*N,F=.3*(b-w)+P+.16666667*O,G=Math.sqrt(B*B+F*F),U[0]=G,W=1;W<8;W++)B+=k,F+=V,k+=N,V+=O,G+=Math.sqrt(B*B+F*F),U[W]=G;B+=k,F+=V,G+=Math.sqrt(B*B+F*F),U[8]=G,B+=k+N,F+=V+O,G+=Math.sqrt(B*B+F*F),U[9]=G,z=0}for(y*=G;;z++)if(!((S=U[z])<y)){0==z?y/=S:y=z+(y-(E=U[z-1]))/(S-E);break}this.addCurvePosition(.1*y,T,w,M,b,R,L,A,I,_,g,a||0<l&&0==C)}return _},e.addBeforePosition=function(e,t,i,n,a){var r=t[i],s=t[i+1],o=t[i+2]-r,l=t[i+3]-s,h=Math.atan2(l,o);n[a]=r+e*Math.cos(h),n[a+1]=s+e*Math.sin(h),n[a+2]=h},e.addAfterPosition=function(e,t,i,n,a){var r=t[i+2],s=t[i+3],o=r-t[i],l=s-t[i+1],h=Math.atan2(l,o);n[a]=r+e*Math.cos(h),n[a+1]=s+e*Math.sin(h),n[a+2]=h},e.addCurvePosition=function(e,t,i,n,a,r,s,o,l,h,c,u){0==e&&(e=1e-4);var d=e*e,_=d*e,p=1-e,f=p*p,m=f*p,g=p*e,v=3*g,y=p*v,C=v*e,E=t*m+n*y+r*C+o*_,S=i*m+a*y+s*C+l*_;h[c]=E,h[c+1]=S,h[c+2]=u?Math.atan2(S-(i*f+a*g*2+s*d),E-(t*f+n*g*2+r*d)):0},D.NONE=-1,D.BEFORE=-2,D.AFTER=-3,i(D,["_tempMt",function(){return this._tempMt=new Ae}]),D}(),He=(s(U,"laya.ani.bone.PathConstraintData"),U);function U(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}var Ue=(s(G,"laya.ani.bone.SkinData"),G);function G(){this.name=null,this.slotArr=[]}var Ge=function(){function e(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}s(e,"laya.ani.bone.SkinSlotDisplayData");var t=e.prototype;return t.createTexture=function(e){return this.texture||(this.texture=new Ie(e.bitmap,this.uvs),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=e.height,this.texture.height=e.width,this.texture.offsetX=-e.offsetX,this.texture.offsetY=-e.offsetY,this.texture.sourceWidth=e.sourceHeight,this.texture.sourceHeight=e.sourceWidth):(this.texture.width=e.width,this.texture.height=e.height,this.texture.offsetX=-e.offsetX,this.texture.offsetY=-e.offsetY,this.texture.sourceWidth=e.sourceWidth,this.texture.sourceHeight=e.sourceHeight),m.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},t.destory=function(){this.texture&&this.texture.destroy()},e}(),ze=(s(z,"laya.ani.bone.SlotData"),z.prototype.getDisplayByName=function(e){for(var t=0,i=this.displayArr.length;t<i;t++)if(this.displayArr[t].attachmentName==e)return t;return-1},z);function z(){this.name=null,this.displayArr=[]}var W=(s(X,"laya.ani.bone.TfConstraint"),X.prototype.apply=function(){for(var e,t=this.target.resultMatrix.a,i=this.target.resultMatrix.b,n=this.target.resultMatrix.c,a=this.target.resultMatrix.d,r=0,s=this._bones.length;r<s;r++){if(e=this._bones[r],0<this.rotateMix){var o=e.resultMatrix.a,l=e.resultMatrix.b,h=e.resultMatrix.c,c=e.resultMatrix.d,u=Math.atan2(n,t)-Math.atan2(h,o)+this._data.offsetRotation*Math.PI/180;u>Math.PI?u-=2*Math.PI:u<-Math.PI&&(u+=2*Math.PI),u*=this.rotateMix;var d=Math.cos(u),_=Math.sin(u);e.resultMatrix.a=d*o-_*h,e.resultMatrix.b=d*l-_*c,e.resultMatrix.c=_*o+d*h,e.resultMatrix.d=_*l+d*c}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),e.resultMatrix.tx+=(this._temp[0]-e.resultMatrix.tx)*this.translateMix,e.resultMatrix.ty+=(this._temp[1]-e.resultMatrix.ty)*this.translateMix,e.updateChild()),0<this.scaleMix){var p=Math.sqrt(e.resultMatrix.a*e.resultMatrix.a+e.resultMatrix.c*e.resultMatrix.c),f=Math.sqrt(t*t+n*n),m=1e-5<p?(p+(f-p+this._data.offsetScaleX)*this.scaleMix)/p:0;e.resultMatrix.a*=m,e.resultMatrix.c*=m,p=Math.sqrt(e.resultMatrix.b*e.resultMatrix.b+e.resultMatrix.d*e.resultMatrix.d),f=Math.sqrt(i*i+a*a),m=1e-5<p?(p+(f-p+this._data.offsetScaleY)*this.scaleMix)/p:0,e.resultMatrix.b*=m,e.resultMatrix.d*=m}if(0<this.shearMix){l=e.resultMatrix.b,c=e.resultMatrix.d;var g=Math.atan2(c,l);(u=Math.atan2(a,i)-Math.atan2(n,t)-(g-Math.atan2(e.resultMatrix.c,e.resultMatrix.a)))>Math.PI?u-=2*Math.PI:u<-Math.PI&&(u+=2*Math.PI),u=g+(u+this._data.offsetShearY*Math.PI/180)*this.shearMix,m=Math.sqrt(l*l+c*c),e.resultMatrix.b=Math.cos(u)*m,e.resultMatrix.d=Math.sin(u)*m}}},X);function X(e,t){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=f(2,0),this._data=e,null==this._bones&&(this._bones=[]),this.target=t[e.targetIndex];var i,n=0;for(n=0,i=e.boneIndexs.length;n<i;n++)this._bones.push(t[e.boneIndexs[n]]);this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.scaleMix=e.scaleMix,this.shearMix=e.shearMix}var We=(s(j,"laya.ani.bone.TfConstraintData"),j);function j(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}var Xe=function(){function e(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}s(e,"laya.ani.bone.Transform");var t=e.prototype;return t.initData=function(e){null!=e.x&&(this.x=e.x),null!=e.y&&(this.y=e.y),null!=e.skX&&(this.skX=e.skX),null!=e.skY&&(this.skY=e.skY),null!=e.scX&&(this.scX=e.scX),null!=e.scY&&(this.scY=e.scY)},t.getMatrix=function(){var e;return(e=this.mMatrix?this.mMatrix:this.mMatrix=new Ae).identity(),e.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(e,this.skewX*Math.PI/180,this.skewY*Math.PI/180),e.rotate(this.skX*Math.PI/180),e.translate(this.x,this.y),e},t.skew=function(e,t,i){var n=Math.sin(i),a=Math.cos(i),r=Math.sin(t),s=Math.cos(t);return e.setTo(e.a*s-e.b*n,e.a*r+e.b*a,e.c*s-e.d*n,e.c*r+e.d*a,e.tx*s-e.ty*n,e.tx*r+e.ty*a),e},e}(),Y=(s(K,"laya.ani.bone.UVTools"),K.getRelativeUV=function(e,t,i){var n=e[0],a=e[2]-e[0],r=e[1],s=e[5]-e[1];(i=i||[]).length=t.length;var o,l=0;o=i.length;var h=1/a,c=1/s;for(l=0;l<o;l+=2)i[l]=(t[l]-n)*h,i[l+1]=(t[l+1]-r)*c;return i},K.getAbsoluteUV=function(e,t,i){if(0==e[0]&&0==e[1]&&1==e[4]&&1==e[5])return i?(y.copyArray(i,t),i):t;var n=e[0],a=e[2]-e[0],r=e[1],s=e[5]-e[1];(i=i||[]).length=t.length;var o,l=0;for(o=i.length,l=0;l<o;l+=2)i[l]=t[l]*a+n,i[l+1]=t[l+1]*s+r;return i},K);function K(){}var q=(s(Z,"laya.ani.KeyFramesContent"),Z);function Z(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}var Q=(s($,"laya.ani.math.BezierLerp"),$.getBezierRate=function(e,t,i,n,a){var r=$._getBezierParamKey(t,i,n,a),s=100*r+e;if($._bezierResultCache[s])return $._bezierResultCache[s];var o,l=$._getBezierPoints(t,i,n,a,r),h=0;for(o=l.length,h=0;h<o;h+=2)if(e<=l[h])return $._bezierResultCache[s]=l[h+1],l[h+1];return $._bezierResultCache[s]=1},$._getBezierParamKey=function(e,t,i,n){return 100*(100*(100*(100*e+t)+i)+n)},$._getBezierPoints=function(e,t,i,n,a){return $._bezierPointsCache[a]?$._bezierPointsCache[a]:(r=[0,0,e,t,i,n,1,1],s=(new o).getBezierPoints(r,100,3),$._bezierPointsCache[a]=s);var r,s},$._bezierResultCache={},$._bezierPointsCache={},$);function $(){}var J=function(){function e(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,e.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}s(e,"laya.ani.AnimationPlayer",a);var t=e.prototype;return ae.imps(t,{"laya.resource.IDestroy":!0}),t._onTempletLoadedComputeFullKeyframeIndices=function(e,t,i){this._templet===i&&this._cachePlayRate===e&&this._cacheFrameRate===t&&this._computeFullKeyframeIndices()},t._computeFullKeyframeIndices=function(){for(var e=this._fullFrames=[],t=this._templet,i=this._cacheFrameRateInterval*this._cachePlayRate,n=0,a=t.getAnimationCount();n<a;n++){for(var r=[],s=0,o=t.getAnimation(n).nodes.length;s<o;s++){for(var l=t.getAnimation(n).nodes[s],h=Math.floor(l.playTime/i+.01),c=new Uint16Array(h+1),u=-1,d=0,_=l.keyFrame.length;d<_;d++){var p=l.keyFrame[d],f=p.startTime,m=f+p.duration+i;do{for(var g=Math.floor(f/i+.5),v=u+1;v<g;v++)c[v]=d;c[u=g]=d,f+=i}while(f<=m)}r.push(c)}e.push(r)}},t._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},t._calculatePlayDuration=function(){if(0!==this.state){var e=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=e),this._playEnd>e&&(this._playEnd=e),this._playDuration=this._playEnd-this._playStart}},t._setPlayParams=function(e,t){this._currentTime=e,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/t+.01),0),this._currentFrameTime=this._currentKeyframeIndex*t},t._setPlayParamsWhenStop=function(e,t){this._currentTime=e,this._currentKeyframeIndex=Math.max(Math.floor(e/t+.01),0),this._currentFrameTime=this._currentKeyframeIndex*t,this._currentAnimationClipIndex=-1},t._update=function(e){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var t=this._cacheFrameRateInterval*this._cachePlayRate,i=0;this._startUpdateLoopCount!==v.loopCount&&(i=e*this.playbackRate,this._elapsedPlaybackTime+=i);var n=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=n)return this._setPlayParamsWhenStop(n,t),void this.event("stopped");if(i+=this._currentTime,0<n)if(n<=i)do{if(i-=n,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(n,t),this._stopWhenCircleFinish=!1,void this.event("stopped");i<n&&(this._setPlayParams(i,t),this.event("complete"))}while(n<=i);else this._setPlayParams(i,t);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(n,t),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},t._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},t.play=function(e,t,i,n,a){if(void 0===e&&(e=0),void 0===t&&(t=1),void 0===i&&(i=2147483647),void 0===n&&(n=0),void 0===a&&(a=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(i<0||n<0||a<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==a&&a<n)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=t,this._overallDuration=i,this._playStart=n,this._playEnd=a,this._paused=!1,this._currentAnimationClipIndex=e,this._currentKeyframeIndex=0,this._startUpdateLoopCount=v.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},t.playByFrame=function(e,t,i,n,a,r){void 0===e&&(e=0),void 0===t&&(t=1),void 0===i&&(i=2147483647),void 0===n&&(n=0),void 0===a&&(a=0),void 0===r&&(r=30);var s=1e3/r;this.play(e,t,i,n*s,a*s)},t.stop=function(e){void 0===e&&(e=!0),e?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},n(0,t,"playEnd",function(){return this._playEnd}),n(0,t,"templet",function(){return this._templet},function(e){0===!this.state&&this.stop(!0),this._templet!==e&&((this._templet=e).loaded?this._computeFullKeyframeIndices():e.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),n(0,t,"playStart",function(){return this._playStart}),n(0,t,"playDuration",function(){return this._playDuration}),n(0,t,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),n(0,t,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),n(0,t,"overallDuration",function(){return this._overallDuration}),n(0,t,"currentFrameTime",function(){return this._currentFrameTime}),n(0,t,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),n(0,t,"currentPlayTime",function(){return this._currentTime+this._playStart}),n(0,t,"cachePlayRate",function(){return this._cachePlayRate},function(e){this._cachePlayRate!==e&&(this._cachePlayRate=e,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[e,this._cacheFrameRate])))}),n(0,t,"cacheFrameRate",function(){return this._cacheFrameRate},function(e){this._cacheFrameRate!==e&&(this._cacheFrameRate=e,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,e])))}),n(0,t,"currentTime",null,function(e){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(e<this._playStart||e>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=v.loopCount;var t=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=e,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/t),0),this._currentFrameTime=this._currentKeyframeIndex*t}}),n(0,t,"paused",function(){return this._paused},function(e){(this._paused=e)&&this.event("paused")}),n(0,t,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),n(0,t,"destroyed",function(){return this._destroyed}),e}(),ee=(s(te,"laya.ani.GraphicsAni",r),te.prototype.drawSkin=function(e){var t=[e];this._saveToCmd(m._context._drawSkin,t)},te.create=function(){return te._caches.pop()||new te},te.recycle=function(e){e.clear(),te._caches.push(e)},te._caches=[],te);function te(){te.__super.call(this),m.isConchNode&&(this.drawSkin=function(e){e.transform||(e.transform=Ae.EMPTY),this._addCmd([e]),this.setSkinMesh&&this.setSkinMesh(e._ps,e.mVBData,e.mEleNum,0,e.mTexture,e.transform)})}var ie=function(){function n(){n.__super.call(this),this.mesh=new R}s(n,"laya.ani.bone.canvasmesh.SkinMeshCanvas",b);var e=n.prototype;return e.init2=function(e,t,i,n,a){var r;this.transform&&(this.transform=null),i?r=i:(r=[]).push(0,1,3,3,1,2),this.mesh.texture=e,this.mesh.indexes=r,this.mesh.vertices=n,this.mesh.uvs=a},e.render=function(e,t,i){this.mesh.texture&&(this.transform?(this.transform.translate(t,i),this.renderToContext(e),this.transform.translate(-t,-i)):(this.transform=n._tempMatrix,this.transform.identity(),this.transform.translate(t,i),this.renderToContext(e),this.transform.translate(-t,-i),this.transform=null))},i(n,["_tempMatrix",function(){return this._tempMatrix=new Ae}]),n}(),ne=function(){function v(){this._aniMap={},this.unfixedLastAniIndex=-1,v.__super.call(this),this._anis=new Array}s(v,"laya.ani.AnimationTemplet",p);var e=v.prototype;return e.parse=function(e){var t=new Le(e);this._aniVersion=t.readUTFString(),S.parse(this,t)},e._calculateKeyFrame=function(e,t,i){var n=e.keyFrame;n[t]=n[0];for(var a=0;a<t;a++){var r=n[a];r.nextData=0===r.duration?r.data:n[a+1].data}n.length--},e.onAsynLoaded=function(e,t,i){var n=new Le(t);switch(this._aniVersion=n.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":T.parse(this,n);break;default:S.parse(this,n)}this._endLoaded()},e.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},e.getAnimationCount=function(){return this._anis.length},e.getAnimation=function(e){return this._anis[e]},e.getAniDuration=function(e){return this._anis[e].playTime},e.getNodes=function(e){return this._anis[e].nodes},e.getNodeIndexWithName=function(e,t){return this._anis[e].bone3DMap[t]},e.getNodeCount=function(e){return this._anis[e].nodes.length},e.getTotalkeyframesLength=function(e){return this._anis[e].totalKeyframeDatasLength},e.getPublicExtData=function(){return this._publicExtData},e.getAnimationDataWithCache=function(e,t,i,n){var a=t[i];if(a){var r=a[e];return r?r[n]:null}return null},e.setAnimationDataWithCache=function(e,t,i,n,a){var r=t[i]||(t[i]={});(r[e]||(r[e]=[]))[n]=a},e.getOriginalData=function(e,t,i,n,a){for(var r=this._anis[e].nodes,s=0,o=0,l=r.length,h=0;o<l;o++){var c,u=r[o];c=u.keyFrame[i[o][n]],u.dataOffset=h;var d=a-c.startTime,_=u.lerpType;if(_)switch(_){case 0:case 1:for(s=0;s<u.keyframeWidth;)s+=u.interpolationMethod[s](u,s,t,h+s,c.data,d,null,c.duration,c.nextData);break;case 2:var p=c.interpolationData,f=p.length,m=0;for(s=0;s<f;){var g=p[s];switch(g){case 6:case 7:s+=v.interpolation[g](u,m,t,h+m,c.data,d,null,c.duration,c.nextData,p,s+1);break;default:s+=v.interpolation[g](u,m,t,h+m,c.data,d,null,c.duration,c.nextData)}m++}}else for(s=0;s<u.keyframeWidth;)s+=u.interpolationMethod[s](u,s,t,h+s,c.data,d,null,c.duration,c.nextData);h+=u.keyframeWidth}},e.getNodesCurrentFrameIndex=function(e,t){var i=this._anis[e].nodes;e!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(i.length),this.unfixedCurrentTimes=new Float32Array(i.length),this.unfixedLastAniIndex=e);for(var n=0,a=i.length;n<a;n++){var r=i[n];for(t<this.unfixedCurrentTimes[n]&&(this.unfixedCurrentFrameIndexes[n]=0),this.unfixedCurrentTimes[n]=t;this.unfixedCurrentFrameIndexes[n]<r.keyFrame.length&&!(r.keyFrame[this.unfixedCurrentFrameIndexes[n]].startTime>this.unfixedCurrentTimes[n]);)this.unfixedCurrentFrameIndexes[n]++;this.unfixedCurrentFrameIndexes[n]--}return this.unfixedCurrentFrameIndexes},e.getOriginalDataUnfixedRate=function(e,t,i){var n=this._anis[e].nodes;e!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(n.length),this.unfixedCurrentTimes=new Float32Array(n.length),this.unfixedKeyframes=f(n.length),this.unfixedLastAniIndex=e);for(var a=0,r=0,s=n.length,o=0;r<s;r++){var l=n[r];for(i<this.unfixedCurrentTimes[r]&&(this.unfixedCurrentFrameIndexes[r]=0),this.unfixedCurrentTimes[r]=i;this.unfixedCurrentFrameIndexes[r]<l.keyFrame.length&&!(l.keyFrame[this.unfixedCurrentFrameIndexes[r]].startTime>this.unfixedCurrentTimes[r]);)this.unfixedKeyframes[r]=l.keyFrame[this.unfixedCurrentFrameIndexes[r]],this.unfixedCurrentFrameIndexes[r]++;var h=this.unfixedKeyframes[r];l.dataOffset=o;var c=i-h.startTime;if(l.lerpType)switch(l.lerpType){case 0:case 1:for(a=0;a<l.keyframeWidth;)a+=l.interpolationMethod[a](l,a,t,o+a,h.data,c,null,h.duration,h.nextData);break;case 2:var u=h.interpolationData,d=u.length,_=0;for(a=0;a<d;){var p=u[a];switch(p){case 6:case 7:a+=v.interpolation[p](l,_,t,o+_,h.data,c,null,h.duration,h.nextData,u,a+1);break;default:a+=v.interpolation[p](l,_,t,o+_,h.data,c,null,h.duration,h.nextData)}_++}}else for(a=0;a<l.keyframeWidth;)a+=l.interpolationMethod[a](l,a,t,o+a,h.data,c,null,h.duration,h.nextData);o+=l.keyframeWidth}},v._LinearInterpolation_0=function(e,t,i,n,a,r,s,o,l,h){var c=0===o?0:r/o;return i[n]=(1-c)*a[t]+c*l[t],1},v._QuaternionInterpolation_1=function(e,t,i,n,a,r,s,o,l,h){var c=0===o?0:r/o;return d.slerpQuaternionArray(a,t,l,t,c,i,n),4},v._AngleInterpolation_2=function(e,t,i,n,a,r,s,o,l,h){return 0},v._RadiansInterpolation_3=function(e,t,i,n,a,r,s,o,l,h){return 0},v._Matrix4x4Interpolation_4=function(e,t,i,n,a,r,s,o,l,h){for(var c=0;c<16;c++,t++)i[n+c]=a[t]+r*s[t];return 16},v._NoInterpolation_5=function(e,t,i,n,a,r,s,o,l,h){return i[n]=a[t],1},v._BezierInterpolation_6=function(e,t,i,n,a,r,s,o,l,h,c){return void 0===c&&(c=0),i[n]=a[t]+(l[t]-a[t])*Q.getBezierRate(r/o,h[c],h[c+1],h[c+2],h[c+3]),5},v._BezierInterpolation_7=function(e,t,i,n,a,r,s,o,l,h,c){return void 0===c&&(c=0),i[n]=h[c+4]+h[c+5]*Q.getBezierRate((.001*r+h[c+6])/h[c+7],h[c],h[c+1],h[c+2],h[c+3]),9},v.load=function(e){return ae.loader.create(e,null,null,v)},v.interpolation=[v._LinearInterpolation_0,v._QuaternionInterpolation_1,v._AngleInterpolation_2,v._RadiansInterpolation_3,v._Matrix4x4Interpolation_4,v._NoInterpolation_5,v._BezierInterpolation_6,v._BezierInterpolation_7],v}(),se=(function(){function n(){this.isCached=!1,this.canvas=null,this.tex=null,this.rec=null,n.__super.call(this)}s(n,"laya.ani.bone.canvasmesh.CacheAbleSkinMesh",ie);var e=n.prototype;e.getCanvasPic=function(){var e,t=new l("2D"),i=t.getContext("2d");return this.rec=this.mesh.getBounds(),t.size(this.rec.width,this.rec.height),e=this.transform,this.transform=n.tempMt,this.transform.identity(),this.transform.translate(-this.rec.x,-this.rec.y),this.renderToContext(i),this.transform.translate(+this.rec.x,+this.rec.y),this.transform=e,new Ie(t)},e.render=function(e,t,i){this.mesh.texture&&(this.isCached||(this.isCached=!0,this.tex=this.getCanvasPic()),this.transform?(this.transform.translate(t,i),this._renderTextureToContext(e),this.transform.translate(-t,-i)):(this.transform=ie._tempMatrix,this.transform.identity(),this.transform.translate(t,i),this._renderTextureToContext(e),this.transform.translate(-t,-i),this.transform=null))},e._renderTextureToContext=function(e){var t;if(this.context=e.ctx||e,e.save(),t=this.tex,this.transform){var i=this.transform;e.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}this.rec=this.mesh.getBounds(),e.translate(this.rec.x,this.rec.y),e.drawTexture(t,0,0,t.width,t.height,0,0),e.restore()},i(n,["tempMt",function(){return this.tempMt=new Ae}])}(),function(r){function e(){this.cacheOK=!1,this.cacheCmdOK=!1,this.transformCmds=[],this.drawCmds=[],e.__super.call(this),this.tempMesh=new R}s(e,"laya.ani.bone.canvasmesh.SimpleSkinMeshCanvas",r);var t=e.prototype;return t.init2=function(e,t,i,n,a){r.prototype.init2.call(this,e,t,i,n,a),this.cacheOK=!1,this.cacheCmdOK=!1,this.transformCmds.length=6,this.drawCmds.length=9},t.renderToContext=function(e){if(this.context=e.ctx||e,this.mesh){if(this.mesh.uvs.length<=8)return void(0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh));this.cacheOK||(this.tempMesh.texture=this.mesh.texture,this.tempMesh.uvs=this.mesh.texture.uv,this.tempMesh.vertices=B.solveMesh(this.mesh,this.tempMesh.vertices),this.cacheOK=!0),0==this.mode?this._renderWithIndexes(this.tempMesh):this._renderNoIndexes(this.tempMesh)}},t._renderWithIndexes=function(e){if(this.cacheCmdOK)this.renderByCache(e);else{var t=e.indexes,i=0,n=t.length;for(1<n&&(n=1),i=0;i<n;i+=3){var a=2*t[i],r=2*t[i+1],s=2*t[i+2];this._renderDrawTriangle(e,a,r,s)}this.cacheCmdOK=!0}},t._renderDrawTriangle=function(e,t,i,n){var a=this.context,r=e.uvs,s=e.vertices,o=e.texture,l=o.bitmap,h=l.source,c=o.width,u=o.height,d=l.width,_=l.height,p=NaN,f=NaN,m=NaN,g=NaN,v=NaN,y=NaN;if(e.useUvTransform){var C=e.uvTransform;p=(r[t]*C.a+r[t+1]*C.c+C.tx)*d,f=(r[i]*C.a+r[i+1]*C.c+C.tx)*d,m=(r[n]*C.a+r[n+1]*C.c+C.tx)*d,g=(r[t]*C.b+r[t+1]*C.d+C.ty)*_,v=(r[i]*C.b+r[i+1]*C.d+C.ty)*_,y=(r[n]*C.b+r[n+1]*C.d+C.ty)*_}else p=r[t]*d,f=r[i]*d,m=r[n]*d,g=r[t+1]*_,v=r[i+1]*_,y=r[n+1]*_;var E=s[t],S=s[i],x=s[n],T=s[t+1],w=s[i+1],M=s[n+1],b=1/(p*v+g*m+f*y-v*m-g*f-p*y),R=E*v+g*x+S*y-v*x-g*S-E*y,L=p*S+E*m+f*x-S*m-E*f-p*x,A=p*v*x+g*S*m+E*f*y-E*v*m-g*f*x-p*S*y,I=T*v+g*M+w*y-v*M-g*w-T*y,D=p*w+T*m+f*M-w*m-T*f-p*M,P=p*v*M+g*w*m+T*f*y-T*v*m-g*f*M-p*w*y;if(this.transformCmds[0]=R*b,this.transformCmds[1]=I*b,this.transformCmds[2]=L*b,this.transformCmds[3]=D*b,this.transformCmds[4]=A*b,this.transformCmds[5]=P*b,this.drawCmds[0]=h,this.drawCmds[1]=o.uv[0]*d,this.drawCmds[2]=o.uv[1]*_,this.drawCmds[3]=c,this.drawCmds[4]=u,this.drawCmds[5]=o.uv[0]*d,this.drawCmds[6]=o.uv[1]*_,this.drawCmds[7]=c,this.drawCmds[8]=u,a.save(),this.transform){var N=this.transform;a.transform(N.a,N.b,N.c,N.d,N.tx,N.ty)}a.transform.apply(a,this.transformCmds),a.drawImage.apply(a,this.drawCmds),a.restore()},t.renderByCache=function(e){var t=this.context;if(t.save(),this.transform){var i=this.transform;t.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}t.transform.apply(t,this.transformCmds),t.drawImage.apply(t,this.drawCmds),t.restore()},e}(ie)),oe=function(t){function i(e,t){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,i.__super.call(this),void 0===t&&(t=0),e&&this.init(e,t)}s(i,"laya.ani.bone.Skeleton",t);var e=i.prototype;return e.init=function(e,t){void 0===t&&(t=0);var i,n,a,r=0,s=0;if(1==t)for(this._graphicsCache=[],r=0,s=e.getAnimationCount();r<s;r++)this._graphicsCache.push([]);if(this._yReverseMatrix=e.yReverseMatrix,this._aniMode=t,this._templet=e,this._player=new J,this._player.cacheFrameRate=e.rate,this._player.templet=e,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=e.mBoneArr,this._rootBone=e.mRootBone,this._aniSectionDic=e.aniSectionDic,0<e.ikArr.length)for(this._ikArr=[],r=0,s=e.ikArr.length;r<s;r++)this._ikArr.push(new k(e.ikArr[r],this._boneList));if(0<e.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),r=0,s=e.pathArr.length;r<s;r++)i=e.pathArr[r],n=new H(i,this._boneList),(a=this._boneSlotDic[i.name])&&((n=new H(i,this._boneList)).target=a),this._pathDic[i.name]=n;if(0<e.tfArr.length)for(this._tfArr=[],r=0,s=e.tfArr.length;r<s;r++)this._tfArr.push(new W(e.tfArr[r],this._boneList));if(0<e.skinDataArray.length){var o=this._templet.skinDataArray[this._skinIndex];this._skinName=o.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},e.load=function(e,t,i){void 0===i&&(i=0),this._aniPath=e,this._complete=t,this._loadAniMode=i,ae.loader.load([{url:e,type:"arraybuffer"}],h.create(this,this._onLoaded))},e._onLoaded=function(){var e,t=c.getRes(this._aniPath);null!=t&&(null==le.TEMPLET_DICTIONARY&&(le.TEMPLET_DICTIONARY={}),(e=le.TEMPLET_DICTIONARY[this._aniPath])?e.isParseFail?this._parseFail():e.isParserComplete?this._parseComplete():(e.on("complete",this,this._parseComplete),e.on("error",this,this._parseFail)):((e=new le)._setUrl(this._aniPath),(le.TEMPLET_DICTIONARY[this._aniPath]=e).on("complete",this,this._parseComplete),e.on("error",this,this._parseFail),e.isParserComplete=!1,e.parseData(null,t)))},e._parseComplete=function(){var e=le.TEMPLET_DICTIONARY[this._aniPath];e&&(this.init(e,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},e._parseFail=function(){console.log("[Error]:"+this._aniPath+"解析失败")},e._onPlay=function(){this.event("played")},e._onStop=function(){var e,t=this._templet.eventAniArr[this._aniClipIndex];if(t&&this._eventIndex<t.length)for(;this._eventIndex<t.length;this._eventIndex++)(e=t[this._eventIndex]).time>=this._player.playStart&&e.time<=this._player.playEnd&&this.event("label",e);this._drawOrder=null,this.event("stopped")},e._onPause=function(){this.event("paused")},e._parseSrcBoneMatrix=function(){var e=0,t=0;for(t=this._templet.srcBoneMatrixArr.length,e=0;e<t;e++)this._boneMatrixArray.push(new Ae);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var i,n,a=this._templet.boneSlotArray;for(e=0,t=a.length;e<t;e++)i=a[e],null==(n=this._bindBoneBoneSlotDic[i.parent])&&(this._bindBoneBoneSlotDic[i.parent]=n=[]),this._boneSlotDic[i.name]=i=i.copy(),n.push(i),this._boneSlotArray.push(i)}},e._emitMissedEvents=function(e,t,i){void 0===i&&(i=0);var n=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(n){var a,r,s=0;for(a=n.length,s=i;s<a;s++)(r=n[s]).time>=this._player.playStart&&r.time<=this._player.playEnd&&this.event("label",r)}},e._update=function(e){if(void 0===e&&(e=!0),!(this._pause||e&&this._indexControl)){var t=this.timer.currTimer,i=this._player.currentKeyframeIndex,n=t-this._lastTime;if(e?this._player._update(n):i=-1,this._lastTime=t,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<n&&this._clipIndex==i&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var a;this._lastUpdateAniClipIndex=this._aniClipIndex,i>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var r,s=this._templet.eventAniArr[this._aniClipIndex];if(s&&this._eventIndex<s.length&&((a=s[this._eventIndex]).time>=this._player.playStart&&a.time<=this._player.playEnd?this._player.currentPlayTime>=a.time&&(this.event("label",a),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(r=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=r&&(this.graphics=r));var o=0,l=0;for(l=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,l-1)&&0<l;)l--;if(l<this._clipIndex)for(o=l;o<this._clipIndex;o++)this._createGraphics(o)}else if(1==this._aniMode){if(r=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=r&&(this.graphics=r));for(l=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,l-1)&&0<l;)l--;if(l<this._clipIndex)for(o=l;o<this._clipIndex;o++)this._createGraphics(o)}this._createGraphics()}}},e._createGraphics=function(e){void 0===e&&(e=-1),-1==e&&(e=this._clipIndex);var t,i,n=e*this._player.cacheFrameRateInterval,a=this._templet.drawOrderAniArr[this._aniClipIndex];if(a&&0<a.length)for(this._drawOrderIndex=0,t=a[this._drawOrderIndex];n>=t.time&&(this._drawOrder=t.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=a.length));)t=a[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=ee.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=ee.create(),i=this.graphics;var r=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],e,n);var s,o,l,h,c=this._aniSectionDic[this._aniClipIndex],u=0,d=0,_=0,p=0,f=0,m=this._templet.srcBoneMatrixArr.length;for(f=c[d=0];d<m;d++)h=this._boneList[d],l=this._templet.srcBoneMatrixArr[d],h.resultTransform.scX=l.scX*this._curOriginalData[u++],h.resultTransform.skX=l.skX+this._curOriginalData[u++],h.resultTransform.skY=l.skY+this._curOriginalData[u++],h.resultTransform.scY=l.scY*this._curOriginalData[u++],h.resultTransform.x=l.x+this._curOriginalData[u++],h.resultTransform.y=l.y+this._curOriginalData[u++],8===this._templet.tMatrixDataLen&&(h.resultTransform.skewX=l.skewX+this._curOriginalData[u++],h.resultTransform.skewY=l.skewY+this._curOriginalData[u++]);var g,v={},y={};for(f+=c[1];d<f;d++)v[(g=r[d]).name]=this._curOriginalData[u++],y[g.name]=this._curOriginalData[u++],this._curOriginalData[u++],this._curOriginalData[u++],this._curOriginalData[u++],this._curOriginalData[u++];var C,E,S={},x={};for(f+=c[2];d<f;d++)S[(g=r[d]).name]=this._curOriginalData[u++],x[g.name]=this._curOriginalData[u++],this._curOriginalData[u++],this._curOriginalData[u++],this._curOriginalData[u++],this._curOriginalData[u++];if(this._pathDic)for(f+=c[3];d<f;d++){if(g=r[d],C=this._pathDic[g.name])switch(new Le(g.extenData).getByte()){case 1:C.position=this._curOriginalData[u++];break;case 2:C.spacing=this._curOriginalData[u++];break;case 3:C.rotateMix=this._curOriginalData[u++],C.translateMix=this._curOriginalData[u++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(Ae.TEMP.identity()),this._ikArr)for(d=0,f=this._ikArr.length;d<f;d++)E=this._ikArr[d],S.hasOwnProperty(E.name)&&(E.bendDirection=S[E.name]),x.hasOwnProperty(E.name)&&(E.mix=x[E.name]),E.apply();if(this._pathDic)for(var T in this._pathDic)(C=this._pathDic[T]).apply(this._boneList,i);if(this._tfArr)for(d=0,p=this._tfArr.length;d<p;d++)this._tfArr[d].apply();for(d=0,p=this._boneList.length;d<p;d++)if(h=this._boneList[d],o=this._bindBoneBoneSlotDic[h.name],h.resultMatrix.copyTo(this._boneMatrixArray[d]),o)for(_=0,f=o.length;_<f;_++)(s=o[_])&&s.setParentMatrix(h.resultMatrix);var w,M,b,R,L={},A=this._templet.deformAniArr;if(A&&0<A.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,d=0,f=this._boneSlotArray.length;d<f;d++)(s=this._boneSlotArray[d]).deformData=null;var I,D=A[this._aniClipIndex];for(I in w=D.default,this._setDeform(w,L,this._boneSlotArray,n),D)"default"!=I&&I!=this._skinName&&(w=D[I],this._setDeform(w,L,this._boneSlotArray,n));w=D[this._skinName],this._setDeform(w,L,this._boneSlotArray,n)}if(this._drawOrder)for(d=0,f=this._drawOrder.length;d<f;d++)M=v[(s=this._boneSlotArray[this._drawOrder[d]]).name],b=y[s.name],isNaN(b)||(i.save(),i.alpha(b)),isNaN(M)||-2==M||(this._templet.attachmentNames?s.showDisplayByName(this._templet.attachmentNames[M]):s.showDisplayByIndex(M)),L[this._drawOrder[d]]?(R=L[this._drawOrder[d]],s.currDisplayData&&R[s.currDisplayData.attachmentName]?s.deformData=R[s.currDisplayData.attachmentName]:s.deformData=null):s.deformData=null,isNaN(b)?s.draw(i,this._boneMatrixArray,2==this._aniMode):s.draw(i,this._boneMatrixArray,2==this._aniMode,b),isNaN(b)||i.restore();else for(d=0,f=this._boneSlotArray.length;d<f;d++)M=v[(s=this._boneSlotArray[d]).name],b=y[s.name],isNaN(b)||(i.save(),i.alpha(b)),isNaN(M)||-2==M||(this._templet.attachmentNames?s.showDisplayByName(this._templet.attachmentNames[M]):s.showDisplayByIndex(M)),L[d]?(R=L[d],s.currDisplayData&&R[s.currDisplayData.attachmentName]?s.deformData=R[s.currDisplayData.attachmentName]:s.deformData=null):s.deformData=null,isNaN(b)?s.draw(i,this._boneMatrixArray,2==this._aniMode):s.draw(i,this._boneMatrixArray,2==this._aniMode,b),isNaN(b)||i.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,e,i):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,e,i)},e._setDeform=function(e,t,i,n){if(e){var a,r,s,o=0,l=0,h=0;if(e)for(o=0,l=e.deformSlotDataList.length;o<l;o++)for(a=e.deformSlotDataList[o],h=0;h<a.deformSlotDisplayList.length;h++)s=i[(r=a.deformSlotDisplayList[h]).slotIndex],r.apply(n,s),t[r.slotIndex]||(t[r.slotIndex]={}),t[r.slotIndex][r.attachment]=r.deformData}},e.getAnimNum=function(){return this._templet.getAnimationCount()},e.getAniNameByIndex=function(e){return this._templet.getAniNameByIndex(e)},e.getSlotByName=function(e){return this._boneSlotDic[e]},e.showSkinByName=function(e,t){void 0===t&&(t=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(e),t)},e.showSkinByIndex=function(e,t){void 0===t&&(t=!0);for(var i=0;i<this._boneSlotArray.length;i++)this._boneSlotArray[i].showSlotData(null,t);if(this._templet.showSkinByIndex(this._boneSlotDic,e,t)){var n=this._templet.skinDataArray[e];this._skinIndex=e,this._skinName=n.name}this._clearCache()},e.showSlotSkinByIndex=function(e,t){if(0!=this._aniMode){var i=this.getSlotByName(e);i&&i.showDisplayByIndex(t),this._clearCache()}},e.showSlotSkinByName=function(e,t){if(0!=this._aniMode){var i=this.getSlotByName(e);i&&i.showDisplayByName(t),this._clearCache()}},e.replaceSlotSkinName=function(e,t,i){if(0!=this._aniMode){var n=this.getSlotByName(e);n&&n.replaceDisplayByName(t,i),this._clearCache()}},e.replaceSlotSkinByIndex=function(e,t,i){if(0!=this._aniMode){var n=this.getSlotByName(e);n&&n.replaceDisplayByIndex(t,i),this._clearCache()}},e.setSlotSkin=function(e,t){if(0!=this._aniMode){var i=this.getSlotByName(e);i&&i.replaceSkin(t),this._clearCache()}},e._clearCache=function(){if(1==this._aniMode)for(var e=0,t=this._graphicsCache.length;e<t;e++){for(var i=0,n=this._graphicsCache[e].length;i<n;i++){var a=this._graphicsCache[e][i];a!=this.graphics&&ee.recycle(a)}this._graphicsCache[e].length=0}},e.play=function(e,t,i,n,a,r){void 0===i&&(i=!0),void 0===n&&(n=0),void 0===a&&(a=0),void 0===r&&(r=!0),this._indexControl=!1;var s=-1,o=NaN;if(o=t?2147483647:0,"string"==typeof e)for(var l=0,h=this._templet.getAnimationCount();l<h;l++){var c=this._templet.getAnimation(l);if(c&&e==c.name){s=l;break}}else s=e;-1<s&&s<this.getAnimNum()&&(this._aniClipIndex=s,(i||this._pause||this._currAniIndex!=s)&&(this._currAniIndex=s,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(s)),this._drawOrder=null,this._eventIndex=0,this._player.play(s,this._player.playbackRate,o,n,a),r&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=u.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},e.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},e.playbackRate=function(e){this._player&&(this._player.playbackRate=e)},e.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},e.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=u.now(),this.timer.frameLoop(1,this,this._update,null,!0))},e._getGrahicsDataWithCache=function(e,t){return this._graphicsCache[e][t]},e._setGrahicsDataWithCache=function(e,t,i){this._graphicsCache[e][t]=i},e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},n(0,e,"url",function(){return this._aniPath},function(e){this.load(e)}),n(0,e,"index",function(){return this._index},function(e){this.player&&(this._index=e,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),n(0,e,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),n(0,e,"templet",function(){return this._templet}),n(0,e,"player",function(){return this._player}),i.useSimpleMeshInCanvas=!1,i}(re),le=(function(t){function f(e){this._start=0,this._Pos=0,this._data=null,this._curIndex=0,this._preIndex=0,this._playIndex=0,this._playing=!1,this._ended=!0,this._count=0,this._ids=null,this._loadedImage={},this._idOfSprite=null,this._parentMovieClip=null,this._movieClipList=null,this._labels=null,this.basePath=null,this._atlasPath=null,this._url=null,this._isRoot=!1,this._completeHandler=null,this._endFrame=-1,this.interval=30,this.loop=!1,f.__super.call(this),this._ids={},this._idOfSprite=[],this._reset(),this._playing=!1,(this._parentMovieClip=e)?(this._isRoot=!1,this._movieClipList=e._movieClipList,this._movieClipList.push(this)):(this._movieClipList=[this],this._isRoot=!0,this._setUpNoticeType(1))}s(f,"laya.ani.swf.MovieClip",t);var e=f.prototype;e.destroy=function(e){void 0===e&&(e=!0),this._clear(),t.prototype.destroy.call(this,e)},e._setDisplay=function(e){t.prototype._setDisplay.call(this,e),this._isRoot&&this._$3__onDisplay(e)},e._$3__onDisplay=function(e){e?this.timer.loop(this.interval,this,this.updates,null,!0):this.timer.clear(this,this.updates)},e.updates=function(){if(!this._parentMovieClip){var e,t=0;for(e=this._movieClipList.length,t=0;t<e;t++)this._movieClipList[t]&&this._movieClipList[t]._update()}},e.addLabel=function(e,t){this._labels||(this._labels={}),this._labels[t]=e},e.removeLabel=function(e){if(e){if(!this._labels)for(var t in this._labels)if(this._labels[t]===e){delete this._labels[t];break}}else this._labels=null},e._update=function(){if(this._data&&this._playing){if(this._playIndex++,this._playIndex>=this._count){if(!this.loop)return this._playIndex--,void this.stop();this._playIndex=0}if(this._parse(this._playIndex),this._labels&&this._labels[this._playIndex]&&this.event("label",this._labels[this._playIndex]),-1!=this._endFrame&&this._endFrame==this._playIndex){if(this._endFrame=-1,null!=this._completeHandler){var e=this._completeHandler;this._completeHandler=null,e.run()}this.stop()}}},e.stop=function(){this._playing=!1},e.gotoAndStop=function(e){this.index=e,this.stop()},e._clear=function(){if(this.stop(),this._idOfSprite.length=0,!this._parentMovieClip){this.timer.clear(this,this.updates);var e,t=0;for(e=this._movieClipList.length,t=0;t<e;t++)this._movieClipList[t]!=this&&this._movieClipList[t]._clear();this._movieClipList.length=0}var i;for(i in this._atlasPath&&c.clearRes(this._atlasPath),this._loadedImage)this._loadedImage[i]&&(c.clearRes(i),this._loadedImage[i]=!1);this.removeChildren(),this.graphics=null,this._parentMovieClip=null},e.play=function(e,t){void 0===e&&(e=0),void 0===t&&(t=!0),this.loop=t,this._playing=!0,this._data&&this._displayFrame(e)},e._displayFrame=function(e){void 0===e&&(e=-1),-1!=e&&(this._curIndex>e&&this._reset(),this._parse(e))},e._reset=function(e){void 0===e&&(e=!0),e&&1!=this._curIndex&&this.removeChildren(),this._preIndex=this._curIndex=-1,this._Pos=this._start},e._parse=function(e){var t,i,n,a=0,r=0,s=0,o=!1,l=this._idOfSprite,h=this._data;for(this._ended&&this._reset(),h.pos=this._Pos,this._ended=!1,this._playIndex=e,this._curIndex>e&&e<this._preIndex&&(this._reset(!0),h.pos=this._Pos);this._curIndex<=e&&!this._ended;)switch(h.getUint16()){case 12:if(a=h.getUint16(),r=this._ids[h.getUint16()],this._Pos=h.pos,h.pos=r,0==(s=h.getUint8())){var c=h.getUint16();if(!(i=l[a])){i=l[a]=new re;var u=new re;u.loadImage(this.basePath+c+".png"),this._loadedImage[this.basePath+c+".png"]=!0,i.addChild(u),u.size(h.getFloat32(),h.getFloat32());var d=h._getMatrix();u.transform=d}i.alpha=1}else 1==s&&((t=l[a])||(l[a]=t=new f(this),t.interval=this.interval,t._ids=this._ids,t.basePath=this.basePath,t._setData(h,r),t._initState(),t.play(0)),t.alpha=1);h.pos=this._Pos;break;case 3:var _=l[h.getUint16()];_&&(this.addChild(_),_.zOrder=h.getUint16(),o=!0);break;case 4:(_=l[h.getUint16()])&&_.removeSelf();break;case 5:l[h.getUint16()][f._ValueList[h.getUint16()]]=h.getFloat32();break;case 6:l[h.getUint16()].visible=0<h.getUint8();break;case 7:var p=(i=l[h.getUint16()]).transform||Ae.create();p.setTo(h.getFloat32(),h.getFloat32(),h.getFloat32(),h.getFloat32(),h.getFloat32(),h.getFloat32()),i.transform=p;break;case 8:l[h.getUint16()].setPos(h.getFloat32(),h.getFloat32());break;case 9:l[h.getUint16()].setSize(h.getFloat32(),h.getFloat32());break;case 10:l[h.getUint16()].alpha=h.getFloat32();break;case 11:l[h.getUint16()].setScale(h.getFloat32(),h.getFloat32());break;case 98:n=h.getString(),this.event(n),"stop"==n&&this.stop();break;case 99:this._curIndex=h.getUint16(),o&&this.updateZOrder();break;case 100:this._count=this._curIndex+1,this._ended=!0,this._playing&&(this.event("enterframe"),this.event("end"),this.event("complete")),this._reset(!1)}this._playing&&!this._ended&&this.event("enterframe"),this._Pos=h.pos},e._setData=function(e,t){this._data=e,this._start=t+3},e.load=function(e,t,i){var n;void 0===t&&(t=!1),this._url=e,t&&(this._atlasPath=i||e.split(".swf")[0]+".json"),this.stop(),this._clear(),this._movieClipList=[this],n=[{url:e,type:"arraybuffer"}],this._atlasPath&&n.push({url:this._atlasPath,type:"atlas"}),ae.loader.load(n,h.create(this,this._onLoaded))},e._onLoaded=function(){var e;(e=c.getRes(this._url))?!this._atlasPath||c.getAtlas(this._atlasPath)?(this.basePath=this._atlasPath?c.getAtlas(this._atlasPath).dir:this._url.split(".swf")[0]+"/image/",this._initData(e)):this.event("error","Atlas not find"):this.event("error","file not find")},e._initState=function(){this._reset(),this._ended=!1;var e=this._playing;for(this._playing=!1,this._curIndex=0;!this._ended;)this._parse(++this._curIndex);this._playing=e},e._initData=function(e){this._data=new Le(e);var t=0,i=this._data.getUint16();for(t=0;t<i;t++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1e3/this._data.getUint16(),this._setData(this._data,this._ids[32767]),this._initState(),this.play(0),this.event("loaded"),this._parentMovieClip||this.timer.loop(this.interval,this,this.updates,null,!0)},e.playTo=function(e,t,i){this._completeHandler=i,this._endFrame=t,this.play(e,!1)},n(0,e,"index",function(){return this._playIndex},function(e){this._playIndex=e,this._data&&this._displayFrame(this._playIndex),this._labels&&this._labels[e]&&this.event("label",this._labels[e])}),n(0,e,"count",function(){return this._count}),n(0,e,"playing",function(){return this._playing}),n(0,e,"url",null,function(e){this.load(e)}),f._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"]}(re),function(t){function a(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,a.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}s(a,"laya.ani.bone.Templet",t);var e=a.prototype;return e.loadAni=function(e){this._skBufferUrl=e,ae.loader.load(e,h.create(this,this.onComplete),null,"arraybuffer")},e.onComplete=function(e){if(this._isDestroyed)this.destroy();else{var t=c.getRes(this._skBufferUrl);t?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,t)):this.event("error","load failed:"+this._skBufferUrl)}},e.parseData=function(e,t,i){void 0===i&&(i=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=e,this._mainTexture&&m.isWebGL&&e.bitmap&&(e.bitmap.enableMerageInAtlas=!1),this._rate=i,this.parse(t)},e.buildArmature=function(e){return void 0===e&&(e=0),new oe(this,e)},e.parse=function(e){t.prototype.parse.call(this,e),this._endLoaded(),this._aniVersion!=a.LAYA_ANIMATION_VISION&&(console.log("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+a.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},e._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var e=0;this._loadList=[];var t,i=new Le(this.getPublicExtData()),n=0,a=0,r=0,s=i.getInt32(),o=i.readUTFString(),l=o.split("\n");for(e=0;e<s;e++)t=this._path+l[2*e],o=l[2*e+1],i.getFloat32(),i.getFloat32(),n=i.getFloat32(),a=i.getFloat32(),r=i.getFloat32(),isNaN(r)?0:r,r=i.getFloat32(),isNaN(r)?0:r,r=i.getFloat32(),isNaN(r)?n:r,r=i.getFloat32(),isNaN(r)?a:r,-1==this._loadList.indexOf(t)&&this._loadList.push(t);ae.loader.load(this._loadList,h.create(this,this._textureComplete))}},e._textureComplete=function(){for(var e,t,i=0,n=this._loadList.length;i<n;i++)t=this._loadList[i],e=this._textureDic[t]=c.getRes(t),m.isWebGL&&e&&e.bitmap&&(e.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},e._parsePublicExtData=function(){var e=0,t=0,i=0,n=0,a=0;for(e=0,a=this.getAnimationCount();e<a;e++)this._graphicsCache.push([]);var r;r="Dragon"!=this._aniClassName;var s,o,l=new Le(this.getPublicExtData()),h=0,c=0,u=0,d=0,_=0,p=0,f=0,m=0,g=0,v=l.getInt32(),y=l.readUTFString(),C=y.split("\n");for(e=0;e<v;e++){if(s=this._mainTexture,o=this._path+C[2*e],y=C[2*e+1],null==this._mainTexture&&(s=this._textureDic[o]),!s)return this.event("error",this),void(this.isParseFail=!0);h=l.getFloat32(),c=l.getFloat32(),u=l.getFloat32(),d=l.getFloat32(),g=l.getFloat32(),_=isNaN(g)?0:g,g=l.getFloat32(),p=isNaN(g)?0:g,g=l.getFloat32(),f=isNaN(g)?u:g,g=l.getFloat32(),m=isNaN(g)?d:g,this.subTextureDic[y]=Ie.create(s,h,c,u,d,-_,-p,f,m)}this._mainTexture=s;var E,S,x,T,w,M=l.getUint16();for(e=0;e<M;e++)(E=[]).push(l.getUint16()),E.push(l.getUint16()),E.push(l.getUint16()),E.push(l.getUint16()),this.aniSectionDic[e]=E;var b,R=l.getInt16(),L={};for(e=0;e<R;e++)S=new De,0==e?b=S:S.root=b,S.d=r?-1:1,T=l.readUTFString(),w=l.readUTFString(),S.length=l.getFloat32(),1==l.getByte()&&(S.inheritRotation=!1),1==l.getByte()&&(S.inheritScale=!1),S.name=T,w&&((x=L[w])?x.addChild(S):this.mRootBone=S),L[T]=S,this.mBoneArr.push(S);this.tMatrixDataLen=l.getUint16();var A,I,D=l.getUint16(),P=Math.floor(D/this.tMatrixDataLen),N=this.srcBoneMatrixArr;for(e=0;e<P;e++)(A=new Xe).scX=l.getFloat32(),A.skX=l.getFloat32(),A.skY=l.getFloat32(),A.scY=l.getFloat32(),A.x=l.getFloat32(),A.y=l.getFloat32(),8===this.tMatrixDataLen&&(A.skewX=l.getFloat32(),A.skewY=l.getFloat32()),N.push(A),(S=this.mBoneArr[e]).transform=A;var O,k=l.getUint16(),V=0;for(e=0;e<k;e++){for(I=new Fe,V=l.getUint16(),t=0;t<V;t++)I.boneNames.push(l.readUTFString()),I.boneIndexs.push(l.getInt16());I.name=l.readUTFString(),I.targetBoneName=l.readUTFString(),I.targetBoneIndex=l.getInt16(),I.bendDirection=l.getFloat32(),I.mix=l.getFloat32(),I.isSpine=r,this.ikArr.push(I)}var B,F=l.getUint16(),H=0;for(e=0;e<F;e++){for(O=new We,H=l.getUint16(),t=0;t<H;t++)O.boneIndexs.push(l.getInt16());O.name=l.getUTFString(),O.targetIndex=l.getInt16(),O.rotateMix=l.getFloat32(),O.translateMix=l.getFloat32(),O.scaleMix=l.getFloat32(),O.shearMix=l.getFloat32(),O.offsetRotation=l.getFloat32(),O.offsetX=l.getFloat32(),O.offsetY=l.getFloat32(),O.offsetScaleX=l.getFloat32(),O.offsetScaleY=l.getFloat32(),O.offsetShearY=l.getFloat32(),this.tfArr.push(O)}var U=l.getUint16(),G=0;for(e=0;e<U;e++){for((B=new He).name=l.readUTFString(),G=l.getUint16(),t=0;t<G;t++)B.bones.push(l.getInt16());B.target=l.readUTFString(),B.positionMode=l.readUTFString(),B.spacingMode=l.readUTFString(),B.rotateMode=l.readUTFString(),B.offsetRotation=l.getFloat32(),B.position=l.getFloat32(),B.spacing=l.getFloat32(),B.rotateMix=l.getFloat32(),B.translateMix=l.getFloat32(),this.pathArr.push(B)}var z,W,X,j,Y,K=0,q=0,Z=0,Q=NaN,$=0,J=l.getInt16();for(e=0;e<J;e++){var ee=l.getUint8(),te={};this.deformAniArr.push(te);for(var ie=0;ie<ee;ie++)for((z=new Ne).skinName=l.getUTFString(),te[z.skinName]=z,K=l.getInt16(),t=0;t<K;t++)for(W=new Oe,z.deformSlotDataList.push(W),q=l.getInt16(),i=0;i<q;i++)for(X=new ke,W.deformSlotDisplayList.push(X),X.slotIndex=l.getInt16(),X.attachment=l.getUTFString(),Z=l.getInt16(),n=0;n<Z;n++)for(1==l.getByte()?X.tweenKeyList.push(!0):X.tweenKeyList.push(!1),Q=l.getFloat32(),X.timeList.push(Q),j=[],X.vectices.push(j),$=l.getInt16(),a=0;a<$;a++)j.push(l.getFloat32())}var ne,ae,re=l.getInt16(),se=0,oe=0;for(e=0;e<re;e++){for(se=l.getInt16(),Y=[],t=0;t<se;t++){for((ne=new Ve).time=l.getFloat32(),oe=l.getInt16(),i=0;i<oe;i++)ne.drawOrder.push(l.getInt16());Y.push(ne)}this.drawOrderAniArr.push(Y)}var le,he=l.getInt16(),ce=0;for(e=0;e<he;e++){for(ce=l.getInt16(),ae=[],t=0;t<ce;t++)(le=new Be).name=l.getUTFString(),le.intValue=l.getInt32(),le.floatValue=l.getFloat32(),le.stringValue=l.getUTFString(),le.time=l.getFloat32(),ae.push(le);this.eventAniArr.push(ae)}var ue=l.getInt16();if(0<ue)for(this.attachmentNames=[],e=0;e<ue;e++)this.attachmentNames.push(l.getUTFString());var de,_e,pe=l.getInt16();for(e=0;e<pe;e++)(de=new Pe).name=l.readUTFString(),de.parent=l.readUTFString(),de.attachmentName=l.readUTFString(),de.srcDisplayIndex=de.displayIndex=l.getInt16(),(de.templet=this).boneSlotDic[de.name]=de,null==(_e=this.bindBoneBoneSlotDic[de.parent])&&(this.bindBoneBoneSlotDic[de.parent]=_e=[]),_e.push(de),this.boneSlotArray.push(de);var fe,me,ge,ve=l.readUTFString().split("\n"),ye=0,Ce=l.getUint8(),Ee=0,Se=0,xe=0,Te=0,we=0,Me=0,be=0;for(e=0;e<Ce;e++){for((fe=new Ue).name=ve[ye++],Ee=l.getUint8(),t=0;t<Ee;t++){for((me=new ze).name=ve[ye++],de=this.boneSlotDic[me.name],Se=l.getUint8(),i=0;i<Se;i++){if(ge=new Ge,this.skinSlotDisplayDataArr.push(ge),ge.name=ve[ye++],ge.attachmentName=ve[ye++],ge.transform=new Xe,ge.transform.scX=l.getFloat32(),ge.transform.skX=l.getFloat32(),ge.transform.skY=l.getFloat32(),ge.transform.scY=l.getFloat32(),ge.transform.x=l.getFloat32(),ge.transform.y=l.getFloat32(),me.displayArr.push(ge),ge.width=l.getFloat32(),ge.height=l.getFloat32(),ge.type=l.getUint8(),ge.verLen=l.getUint16(),0<(R=l.getUint16()))for(ge.bones=[],n=0;n<R;n++){var Re=l.getUint16();ge.bones.push(Re)}if(0<(xe=l.getUint16()))for(ge.uvs=[],n=0;n<xe;n++)ge.uvs.push(l.getFloat32());if(0<(Te=l.getUint16()))for(ge.weights=[],n=0;n<Te;n++)ge.weights.push(l.getFloat32());if(0<(we=l.getUint16()))for(ge.triangles=[],n=0;n<we;n++)ge.triangles.push(l.getUint16());if(0<(Me=l.getUint16()))for(ge.vertices=[],n=0;n<Me;n++)ge.vertices.push(l.getFloat32());if(0<(be=l.getUint16()))for(ge.lengths=[],n=0;n<be;n++)ge.lengths.push(l.getFloat32())}fe.slotArr.push(me)}this.skinDic[fe.name]=fe,this.skinDataArray.push(fe)}1==l.getUint8()?(this.yReverseMatrix=new Ae(1,0,0,-1,0,0),b&&b.setTempMatrix(this.yReverseMatrix)):b&&b.setTempMatrix(new Ae),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},e.getTexture=function(e){var t=this.subTextureDic[e];return null==(t=t||this.subTextureDic[e.substr(0,e.length-1)])?this._mainTexture:t},e.showSkinByIndex=function(e,t,i){if(void 0===i&&(i=!0),t<0&&t>=this.skinDataArray.length)return!1;var n,a,r=0,s=0,o=this.skinDataArray[t];if(o){for(r=0,s=o.slotArr.length;r<s;r++)(a=o.slotArr[r])&&(n=e[a.name])&&(n.showSlotData(a,i),i&&"undefined"!=n.attachmentName&&"null"!=n.attachmentName?n.showDisplayByName(n.attachmentName):n.showDisplayByIndex(n.displayIndex));return!0}return!1},e.getSkinIndexByName=function(e){for(var t=0,i=this.skinDataArray.length;t<i;t++)if(this.skinDataArray[t].name==e)return t;return-1},e.getGrahicsDataWithCache=function(e,t){return this._graphicsCache[e]&&this._graphicsCache[e][t]?this._graphicsCache[e][t]:null},e.setGrahicsDataWithCache=function(e,t,i){this._graphicsCache[e][t]=i},e.destroy=function(){var e;for(var t in this._isDestroyed=!0,this.subTextureDic)(e=this.subTextureDic[t])&&e.destroy();for(t in this._textureDic)(e=this._textureDic[t])&&e.destroy();for(var i=0,n=this.skinSlotDisplayDataArr.length;i<n;i++)this.skinSlotDisplayDataArr[i].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete a.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},e.getAniNameByIndex=function(e){var t=this.getAnimation(e);return t?t.name:null},n(0,e,"rate",function(){return this._rate},function(e){this._rate=e}),a.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",a.TEMPLET_DICTIONARY=null,a}(ne))}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,t){"use strict";for(var i in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(t[i]=n)}}),function(e,t,i){i.un,i.uns,i.static;var n=i.class,r=i.getset,s=(i.__newvec,laya.utils.Browser,laya.utils.Color),a=laya.filters.ColorFilterAction,o=laya.filters.webgl.ColorFilterActionGL,l=laya.filters.Filter,h=laya.filters.webgl.FilterActionGL,c=laya.maths.Matrix,u=(laya.maths.Rectangle,laya.renders.Render),d=(laya.renders.RenderContext,laya.webgl.resource.RenderTarget2D),_=laya.utils.RunDriver,p=(laya.webgl.shader.d2.ShaderDefines2D,laya.display.Sprite,laya.resource.Texture,laya.webgl.shader.d2.value.Value2D),f=function(){function e(){this.data=null}n(e,"laya.filters.FilterAction");var t=e.prototype;return i.imps(t,{"laya.filters.IFilterAction":!0}),t.apply=function(e){return null},e}(),m=(n(g,"laya.filters.WebGLFilter"),g.enable=function(){g.isInit||(g.isInit=!0,u.isWebGL&&(_.createFilterAction=function(e){var t;switch(e){case 32:t=new o;break;case 16:t=new v;break;case 8:t=new y}return t}))},g.isInit=!1,g.__init$=function(){_.createFilterAction=function(e){var t;switch(e){case 16:case 8:t=new f;break;case 32:t=new a}return t}},g);function g(){}(function(){function t(e){this.strength=NaN,this.strength_sig2_2sig2_gauss1=[],t.__super.call(this),void 0===e&&(e=4),u.isWebGL&&m.enable(),this.strength=e,this._action=_.createFilterAction(16),this._action.data=this}n(t,"laya.filters.BlurFilter",l);var e=t.prototype;e.callNative=function(e){e.conchModel&&e.conchModel.blurFilter&&e.conchModel.blurFilter(this.strength)},r(0,e,"action",function(){return this._action}),r(0,e,"type",function(){return 16})})(),function(){function a(e,t,i,n){this._color=null,a.__super.call(this),this._elements=new Float32Array(9),void 0===t&&(t=4),void 0===i&&(i=6),void 0===n&&(n=6),u.isWebGL&&m.enable(),this._color=new s(e),this.blur=Math.min(t,20),this.offX=i,this.offY=n,this._action=_.createFilterAction(8),this._action.data=this}n(a,"laya.filters.GlowFilter",l);var e=a.prototype;e.getColor=function(){return this._color._color},e.callNative=function(e){e.conchModel&&e.conchModel.glowFilter&&e.conchModel.glowFilter(this._color.strColor,this._elements[4],this._elements[5],this._elements[6])},r(0,e,"type",function(){return 8}),r(0,e,"action",function(){return this._action}),r(0,e,"offY",function(){return this._elements[6]},function(e){this._elements[6]=e}),r(0,e,"offX",function(){return this._elements[5]},function(e){this._elements[5]=e}),r(0,e,"blur",function(){return this._elements[4]},function(e){this._elements[4]=e})}();var v=function(){function e(){this.data=null,e.__super.call(this)}n(e,"laya.filters.webgl.BlurFilterActionGL",h);var t=e.prototype;return t.setValueMix=function(e){e.defines.add(this.data.type)},t.apply3d=function(e,t,i,n,a){var r=e.getValue("bounds"),s=p.create(1,0);s.setFilters([this.data]),c.EMPTY.identity(),i.ctx.drawTarget(e,0,0,r.width,r.height,c.EMPTY,"src",s),s.setFilters(null)},t.setValue=function(e){e.strength=this.data.strength;var t=this.data.strength/3,i=t*t;this.data.strength_sig2_2sig2_gauss1[0]=this.data.strength,this.data.strength_sig2_2sig2_gauss1[1]=i,this.data.strength_sig2_2sig2_gauss1[2]=2*i,this.data.strength_sig2_2sig2_gauss1[3]=1/(2*Math.PI*i),e.strength_sig2_2sig2_gauss1=this.data.strength_sig2_2sig2_gauss1},r(0,t,"typeMix",function(){return 16}),e}(),y=function(){function e(){this.data=null,this._initKey=!1,this._textureWidth=0,this._textureHeight=0,e.__super.call(this)}n(e,"laya.filters.webgl.GlowFilterActionGL",h);var t=e.prototype;return i.imps(t,{"laya.filters.IFilterActionGL":!0}),t.setValueMix=function(e){},t.apply3d=function(e,t,i,n,a){var r=e.getValue("bounds");e.addValue("color",this.data.getColor());var s,o=r.width,l=r.height;this._textureWidth=o,this._textureHeight=l;var h=c.TEMP;return h.identity(),(s=p.create(1,0)).setFilters([this.data]),i.ctx.drawTarget(e,0,0,this._textureWidth,this._textureHeight,h,"src",s,null),s=p.create(1,0),i.ctx.drawTarget(e,0,0,this._textureWidth,this._textureHeight,h,"src",s),null},t.setSpriteWH=function(e){this._textureWidth=e.width,this._textureHeight=e.height},t.setValue=function(e){e.u_offsetX=this.data.offX,e.u_offsetY=-this.data.offY,e.u_strength=1,e.u_blurX=this.data.blur,e.u_blurY=this.data.blur,e.u_textW=this._textureWidth,e.u_textH=this._textureHeight,e.u_color=this.data.getColor()},r(0,t,"typeMix",function(){return 8}),e.tmpTarget=function(e,t,i,n,a){var r=e.getValue("bounds");e.getValue("out").end();var s=d.create(r.width,r.height);s.start();var o=e.getValue("color");o&&s.clear(o[0],o[1],o[2],0),e.addValue("tmpTarget",s)},e.startOut=function(e,t,i,n,a){e.getValue("tmpTarget").end();var r=e.getValue("out");r.start();var s=e.getValue("color");s&&r.clear(s[0],s[1],s[2],0)},e.recycleTarget=function(e,t,i,n,a){e.getValue("src");e.getValue("tmpTarget").recycle()},e}();i.__init([m])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,t){"use strict";for(var i in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(t[i]=n)}}),function(e,t,n){n.un,n.uns;var i=n.static,a=n.class,r=n.getset,s=(n.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),_=laya.utils.ClassUtils,u=(laya.events.Event,laya.utils.HTMLChar),o=laya.net.Loader,l=(laya.display.Node,laya.maths.Rectangle),h=laya.renders.Render,d=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),c=laya.utils.Stat,N=laya.display.Text,p=laya.resource.Texture,f=laya.net.URL,m=laya.utils.Utils,g=(a(v,"laya.html.utils.HTMLParse"),v.parse=function(e,t,i){t=(t="<root>"+(t=t.replace(/<br>/g,"<br/>"))+"</root>").replace(v.spacePattern,v.char255);var n=m.parseXMLFromString(t);v._parseXML(e,n.childNodes[0].childNodes,i)},v._parseXML=function(e,t,i,n){var a=0,r=0;if(t.join||t.item)for(a=0,r=t.length;a<r;++a)v._parseXML(e,t[a],i,n);else{var s,o,l;if(3==t.nodeType)return void(e instanceof laya.html.dom.HTMLDivElement?(null==t.nodeName&&(t.nodeName="#text"),o=t.nodeName.toLowerCase(),0<(l=t.textContent.replace(/^\s+|\s+$/g,"")).length&&(s=_.getInstance(o))&&(e.addChild(s),s.innerTEXT=l.replace(v.char255AndOneSpacePattern," "))):0<(l=t.textContent.replace(/^\s+|\s+$/g,"")).length&&(e.innerTEXT=l.replace(v.char255AndOneSpacePattern," ")));if("#comment"==(o=t.nodeName.toLowerCase()))return;if(s=_.getInstance(o)){(s=e.addChild(s)).URI=i,s.href=n;var h=t.attributes;if(h&&0<h.length)for(a=0,r=h.length;a<r;++a){var c=h[a],u=c.nodeName,d=c.value;s._setAttributes(u,d)}v._parseXML(s,t.childNodes,i,s.href)}else v._parseXML(e,t.childNodes,i,n)}},v.char255=String.fromCharCode(255),v.spacePattern=/&nbsp;|&#160;/g,v.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),v);function v(){}var y=(a(O,"laya.html.utils.Layout"),O.later=function(e){null==O._will&&(O._will=[],n.stage.frameLoop(1,null,function(){if(!(O._will.length<1)){for(var e=0;e<O._will.length;e++)laya.html.utils.Layout.layout(O._will[e]);O._will.length=0}})),O._will.push(e)},O.layout=function(e){if(!e||!e._style)return null;if(0==(512&e._style._type))return null;e.getStyle()._type&=-513;var t=O._multiLineLayout(e);return h.isConchApp&&e.layaoutCallNative&&e.layaoutCallNative(),t},O._multiLineLayout=function(e){if(N.RightToLeft)return O._multiLineLayout2(e);var t=new Array;e._addChildsToLayout(t);var i,n,a,r,s,o=0,l=t.length,h=e._getCSSStyle(),c=h.letterSpacing,u=h.leading,d=h.lineHeight,_=h._widthAuto()||!h.wordWrap,p=_?999999:e.width,f=(e.height,0),m=h.italic?h.fontSize/3:0,g=h._getAlign(),v=h._getValign(),y=0!==v||0!==g||0!=d,C=0,E=0,S=0,x=0,T=new Array,w=T[0]=new k,M=!1,b=!1;w.h=0,h.italic&&(p-=h.fontSize/3);var R=0,L=!0;function A(){w.y=E,E+=w.h+u,0==w.h&&(E+=d),w.mWidth=R,R=0,w=new k,T.push(w),w.h=0,M=!(L=!(C=0))}for(o=0;o<l;o++)if(null!=(i=t[o]))if(L=!1,i instanceof laya.html.dom.HTMLBrElement)A(),w.y=E;else{if(i._isChar()){if((r=i).isWord)M=b||"\n"===r.char,w.wordStartIndex=w.elements.length;else{if(0<T.length&&p<C+S&&0<w.wordStartIndex){var I;I=w.elements.length-w.wordStartIndex+1,w.elements.length=w.wordStartIndex,o-=I,A();continue}M=!1,R+=r.width}S=r.width+c,x=r.height,b=!1,(M=M||p<C+S)&&A(),w.minTextHeight=Math.min(w.minTextHeight,i.height)}else n=i._getCSSStyle(),s=i,a=n.padding,0===n._getCssFloat()||(y=!0),M=b||n.lineElement,S=s.width*s._style._tf.scaleX+a[1]+a[3]+c,x=s.height*s._style._tf.scaleY+a[0]+a[2],b=n.lineElement,(M=M||p<C+S&&n.wordWrap)&&A();w.elements.push(i),w.h=Math.max(w.h,x),i.x=C,i.y=E,C+=S,w.w=C-c,w.y=E,f=Math.max(C+m,f)}else L||(C+=O.DIV_ELEMENT_PADDING),w.wordStartIndex=w.elements.length;if(E=w.y+w.h,y){var D=0,P=p;for(_&&0<e.width&&(P=e.width),o=0,l=T.length;o<l;o++)T[o].updatePos(0,P,o,D,g,v,d),D+=Math.max(d,T[o].h+u);E=D}return _&&(e.width=f),E>e.height&&(e.height=E),[f,E]},O._multiLineLayout2=function(e){var t=new Array;e._addChildsToLayout(t);var i,n,a,r,s,o=0,l=t.length,h=e._getCSSStyle(),c=h.letterSpacing,u=h.leading,d=h.lineHeight,_=h._widthAuto()||!h.wordWrap,p=_?999999:e.width,f=(e.height,0),m=h.italic?h.fontSize/3:0,g=2-h._getAlign(),v=h._getValign(),y=0!==v||0!=g||0!=d,C=0,E=0,S=0,x=0,T=new Array,w=T[0]=new k,M=!1,b=!1;w.h=0,h.italic&&(p-=h.fontSize/3);var R=0,L=!0;function A(){w.y=E,E+=w.h+u,0==w.h&&(E+=d),w.mWidth=R,R=0,w=new k,T.push(w),w.h=0,M=!(L=!(C=0))}for(o=0;o<l;o++)if(null!=(i=t[o]))if(L=!1,i instanceof laya.html.dom.HTMLBrElement)A(),w.y=E;else{if(i._isChar()){if((r=i).isWord)M=b||"\n"===r.char,w.wordStartIndex=w.elements.length;else{if(0<T.length&&p<C+S&&0<w.wordStartIndex){var I;I=w.elements.length-w.wordStartIndex+1,w.elements.length=w.wordStartIndex,o-=I,A();continue}M=!1,R+=r.width}S=r.width+c,x=r.height,b=!1,(M=M||p<C+S)&&A(),w.minTextHeight=Math.min(w.minTextHeight,i.height)}else n=i._getCSSStyle(),s=i,a=n.padding,0===n._getCssFloat()||(y=!0),M=b||n.lineElement,S=s.width*s._style._tf.scaleX+a[1]+a[3]+c,x=s.height*s._style._tf.scaleY+a[0]+a[2],b=n.lineElement,(M=M||p<C+S&&n.wordWrap)&&A();w.elements.push(i),w.h=Math.max(w.h,x),i.x=C,i.y=E,C+=S,w.w=C-c,w.y=E,f=Math.max(C+m,f)}else L||(C+=O.DIV_ELEMENT_PADDING),w.wordStartIndex=w.elements.length;if(E=w.y+w.h,y){var D=0,P=p;for(o=0,l=T.length;o<l;o++)T[o].updatePos(0,P,o,D,g,v,d),D+=Math.max(d,T[o].h+u);E=D}for(_&&(e.width=f),E>e.height&&(e.height=E),o=0,l=T.length;o<l;o++)T[o].revertOrder(p);return[f,E]},O._will=null,O.DIV_ELEMENT_PADDING=0,O);function O(){}var k=function(){function e(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}a(e,"laya.html.utils.LayoutLine");var t=e.prototype;return t.updatePos=function(e,t,i,n,a,r,s){var o,l=0;0<this.elements.length&&(l=(o=this.elements[this.elements.length-1]).x+o.width-this.elements[0].x);var h=0,c=NaN;1===a&&(h=(t-l)/2),2===a&&(h=t-l),0===s||0!=r||(r=1);for(var u=0,d=this.elements.length;u<d;u++){var _=(o=this.elements[u])._getCSSStyle();switch(0!==h&&(o.x+=h),_._getValign()){case 0:o.y=n;break;case 1:var p=0;99999!=this.minTextHeight&&(p=this.minTextHeight);var f=(p+s)/2;f=Math.max(f,this.h),c=(laya.html.dom.HTMLImageElement,n+f-o.height),o.y=c;break;case 2:o.y=n+(s-o.height)}}},t.revertOrder=function(e){var t;if(0<this.elements.length){var i,n=0;for(i=this.elements.length,n=0;n<i;n++)(t=this.elements[n]).x=e-t.x-t.width}},e}(),C=function(i){function t(){this.URI=null,this._href=null,t.__super.call(this),this._text=t._EMPTYTEXT,this.setStyle(new s(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}a(t,"laya.html.dom.HTMLElement",i);var e=t.prototype;return e.layaoutCallNative=function(){var e=0;if(this._childs&&0<(e=this._childs.length))for(var t=0;t<e;t++)this._childs[t].layaoutCallNative&&this._childs[t].layaoutCallNative();var i=this._getWords();i?laya.html.dom.HTMLElement.fillWords(this,i,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},e.appendChild=function(e){return this.addChild(e)},e._getWords2=function(){var e=this._text.text;if(!e||0===e.length)return null;var t,i,n=0,a=0;if(this._text.drawWords)i=this._text.drawWords;else{for(a=(t=e.split(" ")).length-1,i=[],n=0;n<a;n++)i.push(t[n]," ");0<=a&&i.push(t[a]),this._text.drawWords=i}var r,s=this._text.words;if(s&&s.length===i.length)return s;null===s&&(this._text.words=s=[]),s.length=i.length;var o=this.style,l=o.font;for(n=0,a=i.length;n<a;n++){r=m.measureText(i[n],l);var h=s[n]=new u(i[n],r.width,r.height||o.fontSize,o);if(1<h.char.length&&(h.charNum=h.char),this.href){var c=new d;this.addChild(c),h.setSprite(c)}}return s},e._getWords=function(){if(!N.CharacterCache)return this._getWords2();var e=this._text.text;if(!e||0===e.length)return null;var t,i=this._text.words;if(i&&i.length===e.length)return i;null===i&&(this._text.words=i=[]),i.length=e.length;for(var n=this.style,a=n.font,r=0,s=e.length;r<s;r++){t=m.measureText(e.charAt(r),a);var o=i[r]=new u(e.charAt(r),t.width,t.height||n.fontSize,n);if(this.href){var l=new d;this.addChild(l),o.setSprite(l)}}return i},e.showLinkSprite=function(){var e=this._text.words;if(e)for(var t,i,n=[],a=0;a<e.length;a++)i=e[a],(t=new d).graphics.drawRect(0,0,i.width,i.height,"#ff0000"),t.width=i.width,t.height=i.height,this.addChild(t),n.push(t)},e._layoutLater=function(){var e=this.style;512&e._type||(e.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&e.block?(y.later(this),e._type|=512):this.parent&&this.parent._layoutLater())},e._setAttributes=function(e,t){switch(e){case"style":return void this.style.cssText(t);case"class":return void(this.className=t)}i.prototype._setAttributes.call(this,e,t)},e.updateHref=function(){if(null!=this._href){var e=this._getWords();if(e)for(var t,i,n=0;n<e.length;n++)(i=(t=e[n]).getSprite())&&(i.size(t.width,t.height),i.on("click",this,this.onLinkHandler))}},e.onLinkHandler=function(e){switch(e.type){case"click":for(var t=this;t;)t.event("link",[this.href]),t=t.parent}},e.formatURL=function(e){return this.URI?f.formatURL(e,this.URI?this.URI.path:null):e},r(0,e,"href",function(){return this._href},function(e){null!=(this._href=e)&&(this._getCSSStyle().underLine=1,this.updateHref())}),r(0,e,"color",null,function(e){this.style.color=e}),r(0,e,"onClick",null,function(e){n._runScript("fn=function(event){"+e+";}"),this.on("click",this,void 0)}),r(0,e,"id",null,function(e){T.document.setElementById(e,this)}),r(0,e,"innerTEXT",function(){return this._text.text},function(e){this.text=e}),r(0,e,"style",function(){return this._style}),r(0,e,"text",function(){return this._text.text},function(e){this._text==t._EMPTYTEXT?this._text={text:e,words:null}:(this._text.text=e,this._text.words&&(this._text.words.length=0)),h.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),r(0,e,"parent",i.prototype._$get_parent,function(e){if(e instanceof laya.html.dom.HTMLElement){var t=e;this.URI||(this.URI=t.URI),this.style.inherit(t.style)}n.superSet(d,this,"parent",e)}),r(0,e,"className",null,function(e){this.style.attrs(T.document.styleSheets["."+e])}),t.fillWords=function(e,t,i,n,a,r,s){e.graphics.clear();for(var o=0,l=t.length;o<l;o++){var h=t[o];e.graphics.fillText(h.char,h.x+i,h.y+n,a,r,"left",s)}},t._EMPTYTEXT={text:null,words:null},t}(d);a(E,"laya.html.dom.HTMLBrElement",C);function E(){E.__super.call(this),this.style.lineElement=!0,this.style.block=!0}var S,x=function(e){function t(){this.contextHeight=NaN,this.contextWidth=NaN,t.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}a(t,"laya.html.dom.HTMLDivElement",e);var i=t.prototype;return i.appendHTML=function(e){g.parse(this,e,this.URI),this.layout()},i._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&0==this._childs.length)return!1;e&&e.forEach(function(e){t.push(e)});for(var i=!0,n=0,a=this._childs.length;n<a;n++){var r=this._childs[n];i?i=!1:t.push(null),r._addToLayout(t)}return!0},i._addToLayout=function(e){this.layout()},i.layout=function(){if(this.style){this.style._type|=512;var e=y.layout(this);if(e){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new l);var t=this._$P.mHtmlBounds;t.x=t.y=0,t.width=this.contextWidth=e[0],t.height=this.contextHeight=e[1],this.setBounds(t)}}},r(0,i,"height",function(){return this._height?this._height:this.contextHeight},e.prototype._$set_height),r(0,i,"innerHTML",null,function(e){this.destroyChildren(),this.appendHTML(e)}),r(0,i,"width",function(){return this._width?this._width:this.contextWidth},function(e){var t=!1;t=0===e?e!=this._width:e!=this.width,n.superSet(C,this,"width",e),t&&this.layout()}),t}(C),T=function(){function e(){this.all=new Array,this.styleSheets=s.styleSheets,e.__super.call(this)}a(e,"laya.html.dom.HTMLDocument",C);var t=e.prototype;return t.getElementById=function(e){return this.all[e]},t.setElementById=function(e,t){this.all[e]=t},i(e,["document",function(){return this.document=new e}]),e}();(function(){function e(){this._tex=null,this._url=null,this._renderArgs=[],e.__super.call(this),this.style.block=!0}a(e,"laya.html.dom.HTMLImageElement",C);var t=e.prototype;t._addToLayout=function(e){this._style.absolute||e.push(this)},t.render=function(e,t,i){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(c.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,e.ctx.drawTexture2(t,i,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},t.layaoutCallNative=function(){var e=0;if(this._childs&&0<(e=this._childs.length))for(var t=0;t<e;t++)this._childs[t].layaoutCallNative&&this._childs[t].layaoutCallNative()},r(0,t,"src",null,function(e){var t=this;if(e=this.formatURL(e),this._url!=e){this._url=e;var i=this._tex=o.getRes(e);i||(this._tex=i=new p,i.load(e),o.cacheRes(e,i)),i.loaded?n():i.on("loaded",null,n)}function n(){var e=t._style;e.widthed(t)||t._tex.width,e.heighted(t)||t._tex.height;e.widthed(t)||t._width==t._tex.width||(t.width=t._tex.width,t.parent&&t.parent._layoutLater()),e.heighted(t)||t._height==t._tex.height||(t.height=t._tex.height,t.parent&&t.parent._layoutLater()),h.isConchApp&&(t._renderArgs[0]=t._tex,t._renderArgs[1]=t.x,t._renderArgs[2]=t.y,t._renderArgs[3]=t.width||t._tex.width,t._renderArgs[4]=t.height||t._tex.height,t.graphics.drawTexture(t._tex,0,0,t._renderArgs[3],t._renderArgs[4])),t.repaint(),t.parentRepaint()}})})(),function(e){function t(){this.type=null,t.__super.call(this),this.visible=!1}a(t,"laya.html.dom.HTMLLinkElement",e);var i=t.prototype;i._onload=function(e){switch(this.type){case"text/css":s.parseCSS(e,this.URI)}},r(0,i,"href",e.prototype._$get_href,function(e){var t=this;e=this.formatURL(e),this.URI=new f(e);var i=new o;i.once("complete",null,function(e){t._onload(e)}),i.load(e,"text")}),t._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(C),a(w,"laya.html.dom.HTMLStyleElement",S=C),r(0,w.prototype,"text",S.prototype._$get_text,function(e){s.parseCSS(e,null)});function w(){w.__super.call(this),this.visible=!1}var M;a(b,"laya.html.dom.HTMLIframeElement",M=x),r(0,b.prototype,"href",M.prototype._$get_href,function(i){var n=this;i=this.formatURL(i);var e=new o;e.once("complete",null,function(e){var t=n.URI;n.URI=new f(i),n.innerHTML=e,t&&(n.URI=t)}),e.load(i,"text")});function b(){b.__super.call(this),this._getCSSStyle().valign="middle"}}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,t){"use strict";for(var i in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(t[i]=n)}}),function(e,t,f){f.un,f.uns;var n=f.static,a=f.class,r=f.getset,i=(f.__newvec,laya.display.Animation),s=laya.utils.Browser,m=laya.utils.ClassUtils,o=laya.filters.ColorFilter,l=laya.utils.Ease,h=laya.events.Event,c=(laya.events.EventDispatcher,laya.display.css.Font),u=laya.display.FrameAnimation,d=laya.display.Graphics,_=laya.utils.Handler,p=laya.display.Input,g=laya.net.Loader,v=(laya.display.Node,laya.maths.Point),y=laya.maths.Rectangle,C=laya.renders.Render,E=laya.display.Sprite,S=laya.display.Text,x=laya.resource.Texture,T=laya.utils.Tween,w=laya.utils.Utils,M=laya.utils.WeakObject;f.interface("laya.ui.IItem"),f.interface("laya.ui.ISelect"),f.interface("laya.ui.IRender"),f.interface("laya.ui.IComponent"),f.interface("laya.ui.IBox","IComponent");var b=(a(R,"laya.ui.LayoutStyle"),n(R,["EMPTY",function(){return this.EMPTY=new R}]),R);function R(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}var L=(a(A,"laya.ui.Styles"),A.labelColor="#000000",A.buttonStateNum=3,A.scrollBarMinNum=15,A.scrollBarDelayTime=500,n(A,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),A);function A(){}var I=(a(D,"laya.ui.UIUtils"),D.fillArray=function(e,t,i){var n=e.concat();if(t)for(var a=t.split(","),r=0,s=Math.min(n.length,a.length);r<s;r++){var o=a[r];n[r]="true"==o||"false"!=o&&o,null!=i&&(n[r]=i(o))}return n},D.toColor=function(e){return w.toHexColor(e)},D.gray=function(e,t){void 0===t&&(t=!0),t?D.addFilter(e,D.grayFilter):D.clearFilter(e,o)},D.addFilter=function(e,t){var i=e.filters||[];i.push(t),e.filters=i},D.clearFilter=function(e,t){var i=e.filters;if(null!=i&&0<i.length){for(var n=i.length-1;-1<n;n--){var a=i[n];f.__typeof(a,t)&&i.splice(n,1)}e.filters=i}},D._getReplaceStr=function(e){return D.escapeSequence[e]},D.adptString=function(e){return e.replace(/\\(\w)/g,D._getReplaceStr)},D.getBindFun=function(e){var t=D._funMap.get(e);if(null==t){var i='"'+e+'"',n="(function(data){if(data==null)return;with(data){try{\nreturn "+(i=i.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";t=f._runScript(n),D._funMap.set(e,t)}return t},n(D,["grayFilter",function(){return this.grayFilter=new o([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new M}]),D);function D(){}var P=(a(N,"UIConfig"),N.touchScrollEnable=!0,N.mouseWheelEnable=!0,N.showButtons=!0,N.popupBgColor="#000000",N.popupBgAlpha=.5,N.closeDialogOnSide=!0,N);function N(){}var O=function(t){function p(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,p.__super.call(this)}a(p,"laya.ui.AutoBitmap",t);var e=p.prototype;return e.destroy=function(){t.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},e._setChanged=function(){this._isChanged||(this._isChanged=!0,f.timer.callLater(this,this.changeSource))},e.changeSource=function(){this._isChanged=!1;var e=this._source;if(e&&e.bitmap){var t=this.width,i=this.height,n=this._sizeGrid,a=e.sourceWidth,r=e.sourceHeight;if(!n||a===t&&r===i)this.clear(),this.drawTexture(e,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,t,i);else{e.$_GID||(e.$_GID=w.getGID());var s=e.$_GID+"."+t+"."+i+"."+n.join(".");if(w.isOKCmdList(M.I.get(s)))return void(this.cmds=M.I.get(s));this.clear();var o=n[0],l=n[1],h=n[2],c=n[3],u=n[4],d=!1;if(t==a&&(c=l=0),i==r&&(o=h=0),t<c+l){var _=t;d=!0,t=c+l,this.save(),this.clipRect(0,0,_,i)}c&&o&&this.drawTexture(p.getTexture(e,0,0,c,o),0,0,c,o),l&&o&&this.drawTexture(p.getTexture(e,a-l,0,l,o),t-l,0,l,o),c&&h&&this.drawTexture(p.getTexture(e,0,r-h,c,h),0,i-h,c,h),l&&h&&this.drawTexture(p.getTexture(e,a-l,r-h,l,h),t-l,i-h,l,h),o&&this.drawBitmap(u,p.getTexture(e,c,0,a-c-l,o),c,0,t-c-l,o),h&&this.drawBitmap(u,p.getTexture(e,c,r-h,a-c-l,h),c,i-h,t-c-l,h),c&&this.drawBitmap(u,p.getTexture(e,0,o,c,r-o-h),0,o,c,i-o-h),l&&this.drawBitmap(u,p.getTexture(e,a-l,o,l,r-o-h),t-l,o,l,i-o-h),this.drawBitmap(u,p.getTexture(e,c,o,a-c-l,r-o-h),c,o,t-c-l,i-o-h),d&&this.restore(),this.autoCacheCmd&&!C.isConchApp&&M.I.set(s,this.cmds)}this._repaint()}},e.drawBitmap=function(e,t,i,n,a,r){void 0===a&&(a=0),void 0===r&&(r=0),a<.1||r<.1||(!e||t.width==a&&t.height==r?this.drawTexture(t,i,n,a,r):this.fillTexture(t,i,n,a,r))},e.clear=function(e){void 0===e&&(e=!0),t.prototype.clear.call(this,!1)},r(0,e,"sizeGrid",function(){return this._sizeGrid},function(e){this._sizeGrid=e,this._setChanged()}),r(0,e,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(e){this._width!=e&&(this._width=e,this._setChanged())}),r(0,e,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(e){this._height!=e&&(this._height=e,this._setChanged())}),r(0,e,"source",function(){return this._source},function(e){e?(this._source=e,this._setChanged()):(this._source=null,this.clear())}),p.getTexture=function(e,t,i,n,a){n<=0&&(n=1),a<=0&&(a=1),e.$_GID||(e.$_GID=w.getGID());var r=e.$_GID+"."+t+"."+i+"."+n+"."+a,s=M.I.get(r);return s&&s.source||(s=x.createFromTexture(e,t,i,n,a),M.I.set(r,s)),s},p}(d);a(k,"laya.ui.UIEvent",h),k.SHOW_TIP="showtip",k.HIDE_TIP="hidetip";function k(){k.__super.call(this)}var V,B=function(t){function e(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,e.__super.call(this),this._layout=b.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}a(e,"laya.ui.Component",t);var i=e.prototype;return f.imps(i,{"laya.ui.IComponent":!0}),i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},i.preinitialize=function(){},i.createChildren=function(){},i.initialize=function(){},i.callLater=function(e,t){f.timer.callLater(this,e,t)},i.runCallLater=function(e){f.timer.runCallLater(this,e)},i.commitMeasure=function(){},i.changeSize=function(){this.event("resize"),this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},i.getLayout=function(){return this._layout===b.EMPTY&&(this._layout=new b),this._layout},i._setLayoutEnabled=function(e){this._layout&&this._layout.enable!=e&&(this._layout.enable=e,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},i.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},i.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},i.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},i.resetLayoutX=function(){var e=this._layout;if(isNaN(e.anchorX)||(this.pivotX=e.anchorX*this.width),this.layoutEnabled){var t=this.parent;t&&(isNaN(e.centerX)?isNaN(e.left)?isNaN(e.right)||(this.x=Math.round(t.width-this.displayWidth-e.right+this.pivotX*this.scaleX)):(this.x=Math.round(e.left+this.pivotX*this.scaleX),isNaN(e.right)||(this.width=(t._width-e.left-e.right)/(this.scaleX||.01))):this.x=Math.round(.5*(t.width-this.displayWidth)+e.centerX+this.pivotX*this.scaleX))}},i.resetLayoutY=function(){var e=this._layout;if(isNaN(e.anchorY)||(this.pivotY=e.anchorY*this.height),this.layoutEnabled){var t=this.parent;t&&(isNaN(e.centerY)?isNaN(e.top)?isNaN(e.bottom)||(this.y=Math.round(t.height-this.displayHeight-e.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(e.top+this.pivotY*this.scaleY),isNaN(e.bottom)||(this.height=(t._height-e.top-e.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(t.height-this.displayHeight)+e.centerY+this.pivotY*this.scaleY))}},i.onMouseOver=function(e){f.stage.event("showtip",this._toolTip)},i.onMouseOut=function(e){f.stage.event("hidetip",this._toolTip)},i._childChanged=function(e){this.callLater(this.changeSize),t.prototype._childChanged.call(this,e)},r(0,i,"displayWidth",function(){return this.width*this.scaleX}),r(0,i,"width",function(){return this._width?this._width:this.measureWidth},function(e){this._width!=e&&(this._width=e,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),r(0,i,"measureWidth",function(){var e=0;this.commitMeasure();for(var t=this.numChildren-1;-1<t;t--){var i=this.getChildAt(t);i.visible&&(e=Math.max(i.x+i.width*i.scaleX,e))}return e}),r(0,i,"displayHeight",function(){return this.height*this.scaleY}),r(0,i,"height",function(){return this._height?this._height:this.measureHeight},function(e){this._height!=e&&(this._height=e,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),r(0,i,"dataSource",function(){return this._dataSource},function(e){for(var t in this._dataSource=e,this._dataSource)this.hasOwnProperty(t)&&"function"!=typeof this[t]&&(this[t]=this._dataSource[t])}),r(0,i,"scaleY",t.prototype._$get_scaleY,function(e){f.superGet(E,this,"scaleY")!=e&&(f.superSet(E,this,"scaleY",e),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),r(0,i,"measureHeight",function(){var e=0;this.commitMeasure();for(var t=this.numChildren-1;-1<t;t--){var i=this.getChildAt(t);i.visible&&(e=Math.max(i.y+i.height*i.scaleY,e))}return e}),r(0,i,"scaleX",t.prototype._$get_scaleX,function(e){f.superGet(E,this,"scaleX")!=e&&(f.superSet(E,this,"scaleX",e),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),r(0,i,"top",function(){return this._layout.top},function(e){e!=this._layout.top&&(this.getLayout().top=e,this._setLayoutEnabled(!0)),this.resetLayoutY()}),r(0,i,"bottom",function(){return this._layout.bottom},function(e){e!=this._layout.bottom&&(this.getLayout().bottom=e,this._setLayoutEnabled(!0)),this.resetLayoutY()}),r(0,i,"left",function(){return this._layout.left},function(e){e!=this._layout.left&&(this.getLayout().left=e,this._setLayoutEnabled(!0)),this.resetLayoutX()}),r(0,i,"right",function(){return this._layout.right},function(e){e!=this._layout.right&&(this.getLayout().right=e,this._setLayoutEnabled(!0)),this.resetLayoutX()}),r(0,i,"centerX",function(){return this._layout.centerX},function(e){e!=this._layout.centerX&&(this.getLayout().centerX=e,this._setLayoutEnabled(!0)),this.resetLayoutX()}),r(0,i,"centerY",function(){return this._layout.centerY},function(e){e!=this._layout.centerY&&(this.getLayout().centerY=e,this._setLayoutEnabled(!0)),this.resetLayoutY()}),r(0,i,"anchorX",function(){return this._layout.anchorX},function(e){e!=this._layout.anchorX&&(this.getLayout().anchorX=e,this._setLayoutEnabled(!0)),this.resetLayoutX()}),r(0,i,"anchorY",function(){return this._layout.anchorY},function(e){e!=this._layout.anchorY&&(this.getLayout().anchorY=e,this._setLayoutEnabled(!0)),this.resetLayoutY()}),r(0,i,"tag",function(){return this._tag},function(e){this._tag=e}),r(0,i,"toolTip",function(){return this._toolTip},function(e){this._toolTip!=e&&(null!=(this._toolTip=e)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),r(0,i,"comXml",function(){return this._comXml},function(e){this._comXml=e}),r(0,i,"gray",function(){return this._gray},function(e){e!==this._gray&&(this._gray=e,I.gray(this,e))}),r(0,i,"disabled",function(){return this._disabled},function(e){e!==this._disabled&&(this.gray=this._disabled=e,this.mouseEnabled=!e)}),e}(E),F=function(){function e(){this.lockLayer=null,this.popupEffect=function(e){e.scale(1,1),T.from(e,{x:f.stage.width/2,y:f.stage.height/2,scaleX:0,scaleY:0},300,l.backOut,_.create(this,this.doOpen,[e]))},this.closeEffect=function(e,t){T.to(e,{x:f.stage.width/2,y:f.stage.height/2,scaleX:0,scaleY:0},300,l.strongOut,_.create(this,this.doClose,[e,t]))},e.__super.call(this),this.maskLayer=new E,this.popupEffectHandler=new _(this,this.popupEffect),this.closeEffectHandler=new _(this,this.closeEffect),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,f.stage.addChild(this),f.stage.on("resize",this,this._onResize),P.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}a(e,"laya.ui.DialogManager",E);var t=e.prototype;return t._closeOnSide=function(){var e=this.getChildAt(this.numChildren-1);e instanceof laya.ui.Dialog&&e.close("side")},t.setLockView=function(e){this.lockLayer||(this.lockLayer=new U,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(f.stage.width,f.stage.height)),this.lockLayer.removeChildren(),e&&(e.centerX=e.centerY=0,this.lockLayer.addChild(e))},t._onResize=function(e){var t=this.maskLayer.width=f.stage.width,i=this.maskLayer.height=f.stage.height;this.lockLayer&&this.lockLayer.size(t,i),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,t,i,P.popupBgColor),this.maskLayer.alpha=P.popupBgAlpha;for(var n=this.numChildren-1;-1<n;n--){var a=this.getChildAt(n);a.popupCenter&&this._centerDialog(a)}},t._centerDialog=function(e){e.x=Math.round((f.stage.width-e.width>>1)+e.pivotX),e.y=Math.round((f.stage.height-e.height>>1)+e.pivotY)},t.open=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),t&&this._closeAll(),e.popupCenter&&this._centerDialog(e),this.addChild(e),(e.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),i&&null!=e.popupEffect?e.popupEffect.runWith(e):this.doOpen(e),this.event("open")},t.doOpen=function(e){e.onOpened()},t.lock=function(e){this.lockLayer&&(e?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},t.close=function(e,t,i){void 0===i&&(i=!1),i&&null!=e.closeEffect?e.closeEffect.runWith([e,t]):this.doClose(e,t),this.event("close")},t.doClose=function(e,t){e.removeSelf(),e.isModal&&this._checkMask(),e.closeHandler&&e.closeHandler.runWith(t),e.onClosed(t)},t.closeAll=function(){this._closeAll(),this.event("close")},t._closeAll=function(){for(var e=this.numChildren-1;-1<e;e--){var t=this.getChildAt(e);t&&null!=t.close&&this.doClose(t)}},t.getDialogsByGroup=function(e){for(var t=[],i=this.numChildren-1;-1<i;i--){var n=this.getChildAt(i);n&&n.group===e&&t.push(n)}return t},t.closeByGroup=function(e){for(var t=[],i=this.numChildren-1;-1<i;i--){var n=this.getChildAt(i);n&&n.group===e&&(n.close(),t.push(n))}return t},t._checkMask=function(){this.maskLayer.removeSelf();for(var e=this.numChildren-1;-1<e;e--){var t=this.getChildAt(e);if(t&&t.isModal)return void this.addChildAt(this.maskLayer,e)}},e}(),H=function(t){function i(e){this._bitmap=null,this._skin=null,this._group=null,i.__super.call(this),this.skin=e}a(i,"laya.ui.Image",t);var e=i.prototype;return e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null},e.dispose=function(){this.destroy(!0),f.loader.clearRes(this._skin)},e.createChildren=function(){this.graphics=this._bitmap=new O,this._bitmap.autoCacheCmd=!1},e.setSource=function(e,t){e===this._skin&&t&&(this.source=t,this.onCompResize())},r(0,e,"source",function(){return this._bitmap.source},function(e){this._bitmap&&(this._bitmap.source=e,this.event("loaded"),this.repaint())}),r(0,e,"dataSource",t.prototype._$get_dataSource,function(e){"string"==typeof(this._dataSource=e)?this.skin=e:f.superSet(B,this,"dataSource",e)}),r(0,e,"measureHeight",function(){return this._bitmap.height}),r(0,e,"skin",function(){return this._skin},function(e){if(this._skin!=e)if(this._skin=e){var t=g.getRes(e);t?(this.source=t,this.onCompResize()):f.loader.load(this._skin,_.create(this,this.setSource,[this._skin]),null,"image",1,!0,this._group)}else this.source=null}),r(0,e,"group",function(){return this._group},function(e){e&&this._skin&&g.setGroup(this._skin,e),this._group=e}),r(0,e,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(e){this._bitmap.sizeGrid=I.fillArray(L.defaultSizeGrid,e,Number)}),r(0,e,"measureWidth",function(){return this._bitmap.width}),r(0,e,"width",t.prototype._$get_width,function(e){f.superSet(B,this,"width",e),this._bitmap.width=0==e?1e-7:e}),r(0,e,"height",t.prototype._$get_height,function(e){f.superSet(B,this,"height",e),this._bitmap.height=0==e?1e-7:e}),i}(B),U=function(e){function t(){t.__super.call(this)}a(t,"laya.ui.Box",e);var i=t.prototype;return f.imps(i,{"laya.ui.IBox":!0}),r(0,i,"dataSource",e.prototype._$get_dataSource,function(e){for(var t in this._dataSource=e){var i=this.getChildByName(t);i?i.dataSource=e[t]:this.hasOwnProperty(t)&&"function"!=typeof this[t]&&(this[t]=e[t])}}),t}(B),G=function(t){function i(e,t){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,i.__super.call(this),this._labelColors=L.buttonLabelColors,this._stateNum=L.buttonStateNum,void 0===t&&(t=""),this.skin=e,this.label=t}a(i,"laya.ui.Button",t);var e=i.prototype;return f.imps(e,{"laya.ui.ISelect":!0}),e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(e),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},e.createChildren=function(){this.graphics=this._bitmap=new O},e.createText=function(){this._text||(this._text=new S,this._text.overflow=S.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},e.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},e.onMouse=function(e){if(!1!==this.toggle||!this._selected)return"click"===e.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(this._selected||(this.state=i.stateMap[e.type]))},e.changeClips=function(){var e=g.getRes(this._skin);if(e){var t=e.sourceWidth,i=e.sourceHeight/this._stateNum;e.$_GID||(e.$_GID=w.getGID());var n=e.$_GID+"-"+this._stateNum,a=M.I.get(n);if(w.isOkTextureList(a)||(a=null),a)this._sources=a;else{if(this._sources=[],1===this._stateNum)this._sources.push(e);else for(var r=0;r<this._stateNum;r++)this._sources.push(x.createFromTexture(e,0,i*r,t,i));M.I.set(n,this._sources)}this._autoSize?(this._bitmap.width=this._width||t,this._bitmap.height=this._height||i,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=t)}else console.log("lose skin",this._skin)},e.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var e=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[e]),this.label&&(this._text.color=this._labelColors[e],this._strokeColors&&(this._text.strokeColor=this._strokeColors[e]))},e._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},r(0,e,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(e){this.createText(),this._text.strokeColor=e}),r(0,e,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),r(0,e,"skin",function(){return this._skin},function(e){this._skin!=e&&(this._skin=e,this.callLater(this.changeClips),this._setStateChanged())}),r(0,e,"state",function(){return this._state},function(e){this._state!=e&&(this._state=e,this._setStateChanged())}),r(0,e,"text",function(){return this.createText(),this._text}),r(0,e,"stateNum",function(){return this._stateNum},function(e){"string"==typeof e&&(e=parseInt(e)),this._stateNum!=e&&(this._stateNum=e<1?1:3<e?3:e,this.callLater(this.changeClips))}),r(0,e,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(e){this._strokeColors=I.fillArray(L.buttonLabelColors,e,String),this._setStateChanged()}),r(0,e,"labelColors",function(){return this._labelColors.join(",")},function(e){this._labelColors=I.fillArray(L.buttonLabelColors,e,String),this._setStateChanged()}),r(0,e,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),r(0,e,"label",function(){return this._text?this._text.text:null},function(e){(this._text||e)&&(this.createText(),this._text.text!=e&&(e&&!this._text.parent&&this.addChild(this._text),this._text.text=(e+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),r(0,e,"selected",function(){return this._selected},function(e){this._selected!=e&&(this._selected=e,this.state=this._selected?2:0,this.event("change"))}),r(0,e,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(e){this.createText(),this._text.padding=I.fillArray(L.labelPadding,e,Number)}),r(0,e,"labelSize",function(){return this.createText(),this._text.fontSize},function(e){this.createText(),this._text.fontSize=e}),r(0,e,"labelStroke",function(){return this.createText(),this._text.stroke},function(e){this.createText(),this._text.stroke=e}),r(0,e,"labelBold",function(){return this.createText(),this._text.bold},function(e){this.createText(),this._text.bold=e}),r(0,e,"labelFont",function(){return this.createText(),this._text.font},function(e){this.createText(),this._text.font=e}),r(0,e,"labelAlign",function(){return this.createText(),this._text.align},function(e){this.createText(),this._text.align=e}),r(0,e,"clickHandler",function(){return this._clickHandler},function(e){this._clickHandler=e}),r(0,e,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(e){this._bitmap.sizeGrid=I.fillArray(L.defaultSizeGrid,e,Number)}),r(0,e,"width",t.prototype._$get_width,function(e){f.superSet(B,this,"width",e),this._autoSize&&(this._bitmap.width=e,this._text&&(this._text.width=e))}),r(0,e,"height",t.prototype._$get_height,function(e){f.superSet(B,this,"height",e),this._autoSize&&(this._bitmap.height=e,this._text&&(this._text.height=e))}),r(0,e,"dataSource",t.prototype._$get_dataSource,function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.label=e+"":f.superSet(B,this,"dataSource",e)}),r(0,e,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(e){this._bitmap._offset=e?I.fillArray([1,1],e,Number):[]}),n(i,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),i}(B),z=function(t){function n(e,t,i){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,n.__super.call(this),void 0===t&&(t=1),void 0===i&&(i=1),this._clipX=t,this._clipY=i,this.skin=e}a(n,"laya.ui.Clip",t);var e=n.prototype;return e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},e.dispose=function(){this.destroy(!0),f.loader.clearRes(this._skin)},e.createChildren=function(){this.graphics=this._bitmap=new O},e._onDisplay=function(e){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},e.changeClip=function(){if(this._clipChanged=!1,this._skin){var e=g.getRes(this._skin);e?this.loadComplete(this._skin,e):f.loader.load(this._skin,_.create(this,this.loadComplete,[this._skin]))}},e.loadComplete=function(e,t){if(e===this._skin&&t){var i=this._clipWidth||Math.ceil(t.sourceWidth/this._clipX),n=this._clipHeight||Math.ceil(t.sourceHeight/this._clipY),a=this._skin+i+n,r=M.I.get(a);if(w.isOkTextureList(r)||(r=null),r)this._sources=r;else{this._sources=[];for(var s=0;s<this._clipY;s++)for(var o=0;o<this._clipX;o++)this._sources.push(x.createFromTexture(t,i*o,n*s,i,n));M.I.set(a,this._sources)}this.index=this._index,this.event("loaded"),this.onCompResize()}},e.play=function(e,t){void 0===e&&(e=0),void 0===t&&(t=-1),this._isPlaying=!0,this.index=e,this._toIndex=t,this._index++,f.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},e._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},e.stop=function(){this._isPlaying=!1,f.timer.clear(this,this._loop),this.event("complete")},e._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},r(0,e,"interval",function(){return this._interval},function(e){this._interval!=e&&(this._interval=e,this._isPlaying&&this.play())}),r(0,e,"skin",function(){return this._skin},function(e){this._skin!=e&&((this._skin=e)?this._setClipChanged():this._bitmap.source=null)}),r(0,e,"sources",function(){return this._sources},function(e){this._sources=e,this.index=this._index,this.event("loaded")}),r(0,e,"clipX",function(){return this._clipX},function(e){this._clipX=e||1,this._setClipChanged()}),r(0,e,"clipY",function(){return this._clipY},function(e){this._clipY=e||1,this._setClipChanged()}),r(0,e,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),r(0,e,"clipWidth",function(){return this._clipWidth},function(e){this._clipWidth=e,this._setClipChanged()}),r(0,e,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(e){this._bitmap.sizeGrid=I.fillArray(L.defaultSizeGrid,e,Number)}),r(0,e,"group",function(){return this._group},function(e){e&&this._skin&&g.setGroup(this._skin,e),this._group=e}),r(0,e,"clipHeight",function(){return this._clipHeight},function(e){this._clipHeight=e,this._setClipChanged()}),r(0,e,"width",t.prototype._$get_width,function(e){f.superSet(B,this,"width",e),this._bitmap.width=e}),r(0,e,"height",t.prototype._$get_height,function(e){f.superSet(B,this,"height",e),this._bitmap.height=e}),r(0,e,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),r(0,e,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),r(0,e,"index",function(){return this._index},function(e){this._index=e,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[e]),this.event("change")}),r(0,e,"autoPlay",function(){return this._autoPlay},function(e){this._autoPlay!=e&&((this._autoPlay=e)?this.play():this.stop())}),r(0,e,"isPlaying",function(){return this._isPlaying},function(e){this._isPlaying=e}),r(0,e,"dataSource",t.prototype._$get_dataSource,function(e){"number"==typeof(this._dataSource=e)&&Math.floor(e)==e||"string"==typeof e?this.index=parseInt(e):f.superSet(B,this,"dataSource",e)}),r(0,e,"bitmap",function(){return this._bitmap}),n}(B),W=function(t){function e(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,e.__super.call(this)}a(e,"laya.ui.ColorPicker",t);var i=e.prototype;return i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._colorPanel&&this._colorPanel.destroy(e),this._colorButton&&this._colorButton.destroy(e),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},i.createChildren=function(){this.addChild(this._colorButton=new G),this._colorPanel=new U,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new E),this._colorPanel.addChild(this._colorBlock=new E),this._colorPanel.addChild(this._colorInput=new p)},i.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},i.onPanelMouseDown=function(e){e.stopPropagation()},i.changePanel=function(){this._panelChanged=!1;var e=this._colorPanel.graphics;e.clear(),e.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(e=this._colorTiles.graphics).clear();for(var t=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],i=0;i<12;i++)for(var n=0;n<20;n++){var a=0;a=0===n?t[i]:1===n?0:51*(((3*i+n/6)%3<<0)+3*(i/6<<0))<<16|n%6*51<<8|(i<<0)%6*51;var r=I.toColor(a);this._colors.push(r);var s=n*this._gridSize,o=i*this._gridSize;e.drawRect(s,o,this._gridSize,this._gridSize,r,"#000000")}},i.onColorButtonClick=function(e){this._colorPanel.parent?this.close():this.open()},i.open=function(){var e=this.localToGlobal(new v),t=e.x+this._colorPanel.width<=f.stage.width?e.x:f.stage.width-this._colorPanel.width,i=e.y+this._colorButton.height;i=i+this._colorPanel.height<=f.stage.height?i:e.y-this._colorPanel.height,this._colorPanel.pos(t,i),this._colorPanel.zOrder=1001,f._currentStage.addChild(this._colorPanel),f.stage.on("mousedown",this,this.removeColorBox)},i.close=function(){f.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},i.removeColorBox=function(e){this.close()},i.onColorFieldKeyDown=function(e){13==e.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),e.stopPropagation())},i.onColorInputChange=function(e){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},i.onColorTilesClick=function(e){this.selectedColor=this.getColorByMouse(),this.close()},i.onColorTilesMouseMove=function(e){this._colorInput.focus=!1;var t=this.getColorByMouse();this._colorInput.text=t,this.drawBlock(t)},i.getColorByMouse=function(){var e=this._colorTiles.getMousePoint(),t=Math.floor(e.x/this._gridSize),i=Math.floor(e.y/this._gridSize);return this._colors[20*i+t]},i.drawBlock=function(e){var t=this._colorBlock.graphics;t.clear();var i=e||"#ffffff";t.drawRect(0,0,50,20,i,this._borderColor),e||t.drawLine(0,0,50,20,"#ff0000")},i.changeColor=function(){var e=this.graphics;e.clear();var t=this._selectedColor||"#000000";e.drawRect(0,0,this._colorButton.width,this._colorButton.height,t)},i._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},r(0,i,"inputBgColor",function(){return this._inputBgColor},function(e){this._inputBgColor=e,this._setPanelChanged()}),r(0,i,"selectedColor",function(){return this._selectedColor},function(e){this._selectedColor!=e&&(this._selectedColor=this._colorInput.text=e,this.drawBlock(e),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",h.EMPTY.setTo("change",this,this)))}),r(0,i,"skin",function(){return this._colorButton.skin},function(e){this._colorButton.skin=e,this.changeColor()}),r(0,i,"bgColor",function(){return this._bgColor},function(e){this._bgColor=e,this._setPanelChanged()}),r(0,i,"borderColor",function(){return this._borderColor},function(e){this._borderColor=e,this._setPanelChanged()}),r(0,i,"inputColor",function(){return this._inputColor},function(e){this._inputColor=e,this._setPanelChanged()}),e}(B),X=function(t){function i(e,t){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,i.__super.call(this),this._itemColors=L.comboBoxItemColors,this.skin=e,this.labels=t}a(i,"laya.ui.ComboBox",t);var e=i.prototype;return e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._button&&this._button.destroy(e),this._list&&this._list.destroy(e),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},e.createChildren=function(){this.addChild(this._button=new G),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},e._createList=function(){this._list=new ee,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},e._setListEvent=function(e){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=_.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},e.onListDown=function(e){e.stopPropagation()},e.onScrollBarDown=function(e){e.stopPropagation()},e.onButtonMouseDown=function(e){this.callLater(this.switchTo,[!this._isOpen])},e.changeList=function(){this._listChanged=!1;var e=this.width-2,t=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:e,height:this._itemHeight,fontSize:this._itemSize,color:t}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},e.onlistItemMouse=function(e,t){var i=e.type;if("mouseover"===i||"mouseout"===i){if(this._isCustomList)return;var n=this._list.getCell(t);if(!n)return;var a=n.getChildByName("label");a&&("mouseover"===i?(a.bgColor=this._itemColors[0],a.color=this._itemColors[1]):(a.bgColor=null,a.color=this._itemColors[2]))}else"click"===i&&(this.selectedIndex=t,this.isOpen=!1)},e.switchTo=function(e){this.isOpen=e},e.changeOpen=function(){this.isOpen=!this._isOpen},e.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var e=this._list.graphics;e.clear(),e.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var t=this._list.array||[],i=t.length=0,n=this._labels.length;i<n;i++)t.push({label:this._labels[i]});this._list.height=this._listHeight,this._list.array=t},e.changeSelected=function(){this._button.label=this.selectedLabel},e._onStageMouseWheel=function(e){this._list&&!this._list.contains(e.target)&&this.removeList(null)},e.removeList=function(e){f.stage.off("mousedown",this,this.removeList),f.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},r(0,e,"selectedIndex",function(){return this._selectedIndex},function(e){this._selectedIndex!=e&&(this._selectedIndex=e,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[h.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),r(0,e,"measureHeight",function(){return this._button.height}),r(0,e,"skin",function(){return this._button.skin},function(e){this._button.skin!=e&&(this._button.skin=e,this._listChanged=!0)}),r(0,e,"measureWidth",function(){return this._button.width}),r(0,e,"width",t.prototype._$get_width,function(e){f.superSet(B,this,"width",e),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),r(0,e,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(e){this.selectedIndex=this._labels.indexOf(e)}),r(0,e,"labels",function(){return this._labels.join(",")},function(e){0<this._labels.length&&(this.selectedIndex=-1),e?this._labels=e.split(","):this._labels.length=0,this._itemChanged=!0}),r(0,e,"height",t.prototype._$get_height,function(e){f.superSet(B,this,"height",e),this._button.height=this._height}),r(0,e,"selectHandler",function(){return this._selectHandler},function(e){this._selectHandler=e}),r(0,e,"visibleNum",function(){return this._visibleNum},function(e){this._visibleNum=e,this._listChanged=!0}),r(0,e,"labelBold",function(){return this._button.text.bold},function(e){this._button.text.bold=e}),r(0,e,"itemColors",function(){return String(this._itemColors)},function(e){this._itemColors=I.fillArray(this._itemColors,e,String),this._listChanged=!0}),r(0,e,"itemSize",function(){return this._itemSize},function(e){this._itemSize=e,this._listChanged=!0}),r(0,e,"scrollBar",function(){return this.list.scrollBar}),r(0,e,"isOpen",function(){return this._isOpen},function(e){if(this._isOpen!=e)if(this._isOpen=e,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var t=this.localToGlobal(v.TEMP.setTo(0,0)),i=t.y+this._button.height;i=i+this._listHeight<=f.stage.height?i:t.y-this._listHeight,this._list.pos(t.x,i),this._list.zOrder=1001,f._currentStage.addChild(this._list),f.stage.once("mousedown",this,this.removeList),f.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),r(0,e,"scrollBarSkin",function(){return this._scrollBarSkin},function(e){this._scrollBarSkin=e}),r(0,e,"sizeGrid",function(){return this._button.sizeGrid},function(e){this._button.sizeGrid=e}),r(0,e,"button",function(){return this._button}),r(0,e,"list",function(){return this._list||this._createList(),this._list},function(e){e&&(e.removeSelf(),this._isCustomList=!0,this._list=e,this._setListEvent(e),this._itemHeight=e.getCell(0).height+e.spaceY)}),r(0,e,"dataSource",t.prototype._$get_dataSource,function(e){"number"==typeof(this._dataSource=e)&&Math.floor(e)==e||"string"==typeof e?this.selectedIndex=parseInt(e):e instanceof Array?this.labels=e.join(","):f.superSet(B,this,"dataSource",e)}),r(0,e,"labelColors",function(){return this._button.labelColors},function(e){this._button.labelColors!=e&&(this._button.labelColors=e)}),r(0,e,"labelPadding",function(){return this._button.text.padding.join(",")},function(e){this._button.text.padding=I.fillArray(L.labelPadding,e,Number)}),r(0,e,"labelSize",function(){return this._button.text.fontSize},function(e){this._button.text.fontSize=e}),r(0,e,"labelFont",function(){return this._button.text.font},function(e){this._button.text.font=e}),r(0,e,"stateNum",function(){return this._button.stateNum},function(e){this._button.stateNum=e}),i}(B),j=function(t){function i(e){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,i.__super.call(this),this._showButtons=P.showButtons,this._touchScrollEnable=P.touchScrollEnable,this._mouseWheelEnable=P.mouseWheelEnable,this.skin=e,this.max=1}a(i,"laya.ui.ScrollBar",t);var e=i.prototype;return e.destroy=function(e){void 0===e&&(e=!0),this.stopScroll(),this.target=null,t.prototype.destroy.call(this,e),this.upButton&&this.upButton.destroy(e),this.downButton&&this.downButton.destroy(e),this.slider&&this.slider.destroy(e),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},e.createChildren=function(){this.addChild(this.slider=new Y),this.addChild(this.upButton=new G),this.addChild(this.downButton=new G)},e.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},e.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},e.onButtonMouseDown=function(e){var t=e.currentTarget===this.upButton;this.slide(t),f.timer.once(L.scrollBarDelayTime,this,this.startLoop,[t]),f.stage.once("mouseup",this,this.onStageMouseUp)},e.startLoop=function(e){f.timer.frameLoop(1,this,this.slide,[e])},e.slide=function(e){e?this.value-=this._scrollSize:this.value+=this._scrollSize},e.onStageMouseUp=function(e){f.timer.clear(this,this.startLoop),f.timer.clear(this,this.slide)},e.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},e.changeSize=function(){t.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},e.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},e.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},e.setScroll=function(e,t,i){this.runCallLater(this.changeSize),this.slider.setSlider(e,t,i),this.slider.bar.visible=0<t,!this._hide&&this.autoHide&&(this.visible=!1)},e.onTargetMouseWheel=function(e){this.value-=e.delta*this._scrollSize,this.target=this._target},e.onTargetMouseDown=function(e){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new v),this._lastPoint.setTo(f.stage.mouseX,f.stage.mouseY),f.timer.clear(this,this.tweenMove),T.clearTween(this),f.stage.once("mouseup",this,this.onStageMouseUp2),f.stage.once("mouseout",this,this.onStageMouseUp2),f.timer.frameLoop(1,this,this.loop)},e.loop=function(){var e=f.stage.mouseY,t=f.stage.mouseX;if(this._lastOffset=this.isVertical?e-this._lastPoint.y:t-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?f.stage._canvasTransform.getScaleY():f.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=t,this._lastPoint.y=e,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},e.onStageMouseUp2=function(e){if(f.stage.off("mouseup",this,this.onStageMouseUp2),f.stage.off("mouseout",this,this.onStageMouseUp2),f.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?T.to(this,{value:this.min},this.elasticBackTime,l.sineOut,_.create(this,this.elasticOver)):this._value>this.max&&T.to(this,{value:this.max},this.elasticBackTime,l.sineOut,_.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?f.stage.mouseY-this._lastPoint.y:f.stage.mouseX-this._lastPoint.x);for(var t=0,i=Math.min(this._offsets.length,3),n=0;n<i;n++)t+=this._offsets[this._offsets.length-1-n];if(this._lastOffset=t/i,(t=Math.abs(this._lastOffset))<2)return void this.event("end");60<t&&(this._lastOffset=0<this._lastOffset?60:-60);var a=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));f.timer.frameLoop(1,this,this.tweenMove,[a])}},e.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&T.to(this,{alpha:0},500),this.event("end")},e.tweenMove=function(e){this._lastOffset*=this.rollRatio;var t=NaN;if(0<e&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,t=.5*-(this.min-e-this.value),this._lastOffset>t&&(this._lastOffset=t)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,t=.5*-(this.max+e-this.value),this._lastOffset<t&&(this._lastOffset=t))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(f.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?T.to(this,{value:this.min},this.elasticBackTime,l.sineOut,_.create(this,this.elasticOver)):this._value>this.max?T.to(this,{value:this.max},this.elasticBackTime,l.sineOut,_.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&T.to(this,{alpha:0},500)}},e.stopScroll=function(){this.onStageMouseUp2(null),f.timer.clear(this,this.tweenMove),T.clearTween(this)},r(0,e,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),r(0,e,"skin",function(){return this._skin},function(e){this._skin!=e&&(this._skin=e,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),r(0,e,"max",function(){return this.slider.max},function(e){this.slider.max=e}),r(0,e,"showButtons",function(){return this._showButtons},function(e){this._showButtons=e,this.callLater(this.changeScrollBar)}),r(0,e,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),r(0,e,"min",function(){return this.slider.min},function(e){this.slider.min=e}),r(0,e,"value",function(){return this._value},function(e){e!==this._value&&(this._value=e,this._isElastic||(this.slider._value!=e&&(this.slider._value=e,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),r(0,e,"isVertical",function(){return this.slider.isVertical},function(e){this.slider.isVertical=e}),r(0,e,"sizeGrid",function(){return this.slider.sizeGrid},function(e){this.slider.sizeGrid=e}),r(0,e,"scrollSize",function(){return this._scrollSize},function(e){this._scrollSize=e}),r(0,e,"dataSource",t.prototype._$get_dataSource,function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.value=Number(e):f.superSet(B,this,"dataSource",e)}),r(0,e,"thumbPercent",function(){return this._thumbPercent},function(e){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),e=1<=e?.99:e,this._thumbPercent=e,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*e,L.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*e,L.scrollBarMinNum))}),r(0,e,"target",function(){return this._target},function(e){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=e)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),r(0,e,"hide",function(){return this._hide},function(e){this._hide=e,this.visible=!e}),r(0,e,"touchScrollEnable",function(){return this._touchScrollEnable},function(e){this._touchScrollEnable=e,this.target=this._target}),r(0,e,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(e){this._mouseWheelEnable=e,this.target=this._target}),r(0,e,"tick",function(){return this.slider.tick},function(e){this.slider.tick=e}),i}(B),Y=function(t){function i(e){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,i.__super.call(this),this.skin=e}a(i,"laya.ui.Slider",t);var e=i.prototype;return e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bg&&this._bg.destroy(e),this._bar&&this._bar.destroy(e),this._progress&&this._progress.destroy(e),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},e.createChildren=function(){this.addChild(this._bg=new H),this.addChild(this._bar=new G)},e.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},e.onBarMouseDown=function(e){this._globalSacle||(this._globalSacle=new v),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=f.stage.mouseX,this._ty=f.stage.mouseY,f.stage.on("mousemove",this,this.mouseMove),f.stage.once("mouseup",this,this.mouseUp),f.stage.once("mouseout",this,this.mouseUp),this.showValueText()},e.showValueText=function(){if(this.showLabel){var e=laya.ui.Slider.label;this.addChild(e),e.textField.changeText(this._value+""),this.isVertical?(e.x=this._bar.x+20,e.y=.5*(this._bar.height-e.height)+this._bar.y):(e.y=this._bar.y-20,e.x=.5*(this._bar.width-e.width)+this._bar.x)}},e.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},e.mouseUp=function(e){f.stage.off("mousemove",this,this.mouseMove),f.stage.off("mouseup",this,this.mouseUp),f.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},e.mouseMove=function(e){var t=this._value;this.isVertical?(this._bar.y+=(f.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(f.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=f.stage.mouseX,this._ty=f.stage.mouseY;var i=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*i)/i,this._value!=t&&this.sendChangeEvent(),this.showValueText()},e.sendChangeEvent=function(e){void 0===e&&(e="change"),this.event(e),this.changeHandler&&this.changeHandler.runWith(this._value)},e.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},e.changeSize=function(){t.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},e.setSlider=function(e,t,i){this._value=-1,this._min=e,this._max=e<t?t:e,this.value=i<e?e:t<i?t:i},e.changeValue=function(){var e=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*e)/e,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var t=this._max-this._min;0===t&&(t=1),this.isVertical?(this._bar.y=(this._value-this._min)/t*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/t*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},e.onBgMouseDown=function(e){var t=this._bg.getMousePoint();this.isVertical?this.value=t.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=t.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},r(0,e,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),r(0,e,"skin",function(){return this._skin},function(e){if(this._skin!=e){this._skin=e,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var t=this._skin.replace(".png","$progress.png");g.getRes(t)&&(this._progress||(this.addChild(this._progress=new H),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=t),this.setBarPoint(),this.callLater(this.changeValue)}}),r(0,e,"allowClickBack",function(){return this._allowClickBack},function(e){this._allowClickBack!=e&&((this._allowClickBack=e)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),r(0,e,"max",function(){return this._max},function(e){this._max!=e&&(this._max=e,this.callLater(this.changeValue))}),r(0,e,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),r(0,e,"tick",function(){return this._tick},function(e){this._tick!=e&&(this._tick=e,this.callLater(this.changeValue))}),r(0,e,"sizeGrid",function(){return this._bg.sizeGrid},function(e){this._bg.sizeGrid=e,this._bar.sizeGrid=e,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),r(0,e,"min",function(){return this._min},function(e){this._min!=e&&(this._min=e,this.callLater(this.changeValue))}),r(0,e,"value",function(){return this._value},function(e){if(this._value!=e){var t=this._value;this._value=e,this.changeValue(),this._value!=t&&this.sendChangeEvent()}}),r(0,e,"dataSource",t.prototype._$get_dataSource,function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.value=Number(e):f.superSet(B,this,"dataSource",e)}),r(0,e,"bar",function(){return this._bar}),n(i,["label",function(){return this.label=new K}]),i}(B),K=function(t){function i(e){this._tf=null,i.__super.call(this),void 0===e&&(e=""),c.defaultColor=L.labelColor,this.text=e}a(i,"laya.ui.Label",t);var e=i.prototype;return e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._tf=null},e.createChildren=function(){this.addChild(this._tf=new S)},e.changeText=function(e){this._tf.changeText(e)},r(0,e,"padding",function(){return this._tf.padding.join(",")},function(e){this._tf.padding=I.fillArray(L.labelPadding,e,Number)}),r(0,e,"bold",function(){return this._tf.bold},function(e){this._tf.bold=e}),r(0,e,"align",function(){return this._tf.align},function(e){this._tf.align=e}),r(0,e,"text",function(){return this._tf.text},function(e){this._tf.text!=e&&(e=e&&I.adptString(e+""),this._tf.text=e,this.event("change"),this._width&&this._height||this.onCompResize())}),r(0,e,"italic",function(){return this._tf.italic},function(e){this._tf.italic=e}),r(0,e,"wordWrap",function(){return this._tf.wordWrap},function(e){this._tf.wordWrap=e}),r(0,e,"font",function(){return this._tf.font},function(e){this._tf.font=e}),r(0,e,"dataSource",t.prototype._$get_dataSource,function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.text=e+"":f.superSet(B,this,"dataSource",e)}),r(0,e,"color",function(){return this._tf.color},function(e){this._tf.color=e}),r(0,e,"valign",function(){return this._tf.valign},function(e){this._tf.valign=e}),r(0,e,"leading",function(){return this._tf.leading},function(e){this._tf.leading=e}),r(0,e,"fontSize",function(){return this._tf.fontSize},function(e){this._tf.fontSize=e}),r(0,e,"bgColor",function(){return this._tf.bgColor},function(e){this._tf.bgColor=e}),r(0,e,"borderColor",function(){return this._tf.borderColor},function(e){this._tf.borderColor=e}),r(0,e,"stroke",function(){return this._tf.stroke},function(e){this._tf.stroke=e}),r(0,e,"strokeColor",function(){return this._tf.strokeColor},function(e){this._tf.strokeColor=e}),r(0,e,"textField",function(){return this._tf}),r(0,e,"measureWidth",function(){return this._tf.width}),r(0,e,"measureHeight",function(){return this._tf.height}),r(0,e,"width",function(){return this._width||this._tf.text?f.superGet(B,this,"width"):0},function(e){f.superSet(B,this,"width",e),this._tf.width=e}),r(0,e,"height",function(){return this._height||this._tf.text?f.superGet(B,this,"height"):0},function(e){f.superSet(B,this,"height",e),this._tf.height=e}),r(0,e,"overflow",function(){return this._tf.overflow},function(e){this._tf.overflow=e}),r(0,e,"underline",function(){return this._tf.underline},function(e){this._tf.underline=e}),r(0,e,"underlineColor",function(){return this._tf.underlineColor},function(e){this._tf.underlineColor=e}),i}(B),q=function(t){function i(e){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,i.__super.call(this),this.skin=e}a(i,"laya.ui.ProgressBar",t);var e=i.prototype;return e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bg&&this._bg.destroy(e),this._bar&&this._bar.destroy(e),this._bg=this._bar=null,this.changeHandler=null},e.createChildren=function(){this.addChild(this._bg=new H),this.addChild(this._bar=new H),this._bar._bitmap.autoCacheCmd=!1},e.changeValue=function(){if(this.sizeGrid){var e=this.sizeGrid.split(","),t=Number(e[3]),i=Number(e[1]),n=(this.width-t-i)*this._value;this._bar.width=t+i+n,this._bar.visible=this._bar.width>t+i}else this._bar.width=this.width*this._value},r(0,e,"measureHeight",function(){return this._bg.height}),r(0,e,"skin",function(){return this._skin},function(e){this._skin!=e&&(this._skin=e,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),r(0,e,"measureWidth",function(){return this._bg.width}),r(0,e,"height",t.prototype._$get_height,function(e){f.superSet(B,this,"height",e),this._bg.height=this._height,this._bar.height=this._height}),r(0,e,"bar",function(){return this._bar}),r(0,e,"value",function(){return this._value},function(e){this._value!=e&&(e=1<e?1:e<0?0:e,this._value=e,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(e))}),r(0,e,"bg",function(){return this._bg}),r(0,e,"sizeGrid",function(){return this._bg.sizeGrid},function(e){this._bg.sizeGrid=this._bar.sizeGrid=e}),r(0,e,"width",t.prototype._$get_width,function(e){f.superSet(B,this,"width",e),this._bg.width=this._width,this.callLater(this.changeValue)}),r(0,e,"dataSource",t.prototype._$get_dataSource,function(e){"number"==typeof(this._dataSource=e)||"string"==typeof e?this.value=Number(e):f.superSet(B,this,"dataSource",e)}),i}(B),Z=(function(){function i(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,i.__super.call(this),this._tipBox=new B,this._tipBox.addChild(this._tipText=new S),this._tipText.x=this._tipText.y=5,this._tipText.color=i.tipTextColor,this._defaultTipHandler=this._showDefaultTip,f.stage.on("showtip",this,this._onStageShowTip),f.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}a(i,"laya.ui.TipManager",B);var e=i.prototype;e._onStageHideTip=function(e){f.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},e._onStageShowTip=function(e){f.timer.once(i.tipDelay,this,this._showTip,[e],!0)},e._showTip=function(e){if("string"==typeof e){var t=String(e);Boolean(t)&&this._defaultTipHandler(t)}else e instanceof laya.utils.Handler?e.run():"function"==typeof e&&e.apply();f.stage.on("mousemove",this,this._onStageMouseMove),f.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},e._onStageMouseDown=function(e){this.closeAll()},e._onStageMouseMove=function(e){this._showToStage(this,i.offsetX,i.offsetY)},e._showToStage=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0);var n=e.getBounds();e.x=f.stage.mouseX+t,e.y=f.stage.mouseY+i,e.x+n.width>f.stage.width&&(e.x-=n.width+t),e.y+n.height>f.stage.height&&(e.y-=n.height+i)},e.closeAll=function(){f.timer.clear(this,this._showTip),f.stage.off("mousemove",this,this._onStageMouseMove),f.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},e.showDislayTip=function(e){this.addChild(e),this._showToStage(this),f._currentStage.addChild(this)},e._showDefaultTip=function(e){this._tipText.text=e;var t=this._tipBox.graphics;t.clear(),t.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,i.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),f._currentStage.addChild(this)},r(0,e,"defaultTipHandler",function(){return this._defaultTipHandler},function(e){this._defaultTipHandler=e}),i.offsetX=10,i.offsetY=15,i.tipTextColor="#ffffff",i.tipBackColor="#111111",i.tipDelay=200}(),function(t){function i(e){this.advsListArr=[],this.resUrl="https://unioncdn.layabox.com/config/iconlist.json",this._data=[],this._resquestTime=36e4,this._appid=null,this._appCodeImgStr=null,this._playIndex=0,this._lunboTime=5e3,i.__super.call(this),this._http=new s.window.XMLHttpRequest,this.skin=e,this.init(),this.size(120,120)}a(i,"laya.ui.AdvImage",t);var e=i.prototype;e.init=function(){s.onMiniGame&&this.isSupportJump?(f.timer.loop(this._resquestTime,this,this.onGetAdvsListData),this.onGetAdvsListData(),this.initEvent()):this.visible=!1},e.initEvent=function(){this.on("click",this,this.onAdvsImgClick)},e.onAdvsImgClick=function(){this.getCurrentAppidObj()&&this.jumptoGame()},e.revertAdvsData=function(){this.advsListArr[this._playIndex]&&(this.visible=!0,this.skin=this.advsListArr[this._playIndex])},e.jumptoGame=function(){var e=this;s.onMiniGame&&this.isSupportJump&&wx.navigateToMiniProgram({appId:this._appid,path:"",extraData:"",envVersion:"release",success:function(){console.log("-------------跳转成功--------------")},fail:function(){console.log("-------------跳转失败--------------")},complete:function(){console.log("-------------跳转接口调用成功--------------"),e.updateAdvsInfo()}.bind(this)})},e.updateAdvsInfo=function(){this.visible=!1,this.onLunbo(),f.timer.loop(this._lunboTime,this,this.onLunbo)},e.onLunbo=function(){this._playIndex>=this.advsListArr.length-1?this._playIndex=0:this._playIndex+=1,this.visible=!0,this.revertAdvsData()},e.getCurrentAppidObj=function(){return this.advsListArr[this._playIndex]},e.onGetAdvsListData=function(){var t=this,e=this.randRange(1e4,1e6),i=this.resUrl+"?"+e;this._http.open("get",i,!0),this._http.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this._http.responseType="text",this._http.onerror=function(e){t._onError(e)},this._http.onload=function(e){t._onLoad(e)},this._http.send(null)},e.randRange=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e._onError=function(e){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},e._onLoad=function(e){var t=this._http,i=void 0!==t.status?t.status:200;200===i||204===i||0===i?this.complete():this.error("["+t.status+"]"+t.statusText+":"+t.responseURL)},e.error=function(e){this.event("error",e)},e.complete=function(){try{this._data=this._http.response||this._http.responseText,this._data=JSON.parse(this._data),this.advsListArr=this._data.list,this._appid=this._data.appid,this._appCodeImgStr=this._data.qrcode,this.updateAdvsInfo(),this.revertAdvsData()}catch(e){!1,this.error(e.message)}},e.clear=function(){var e=this._http;e.onerror=e.onabort=e.onprogress=e.onload=null},e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,!0),f.timer.clear(this,this.onLunbo),f.timer.clear(this,this.onGetAdvsListData),this.clear()},r(0,e,"isSupportJump",function(){return!!s.onMiniGame&&"function"==typeof wx.navigateToMiniProgram})}(H),function(){var _;function p(){this._idMap=null,this._aniList=null,this._watchMap={},p.__super.call(this)}a(p,"laya.ui.View",U);var e=p.prototype;return e.createView=function(e){if(e.animations&&!this._idMap&&(this._idMap={}),p.createComp(e,this,this),e.animations){var t,i,n=[],a=e.animations,r=0,s=a.length;for(r=0;r<s;r++){switch(t=new u,i=a[r],t._setUp(this._idMap,i),(this[i.name]=t)._setControlNode(this),i.action){case 1:t.play(0,!1);break;case 2:t.play(0,!0)}n.push(t)}this._aniList=n}0<this._width&&null==e.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},e.onEvent=function(e,t){},e.loadUI=function(e){var t=p.uiMap[e];t&&this.createView(t)},e.destroy=function(e){void 0===e&&(e=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,e)},e.changeData=function(e){var t=this._watchMap[e];if(t){console.log("change",e);for(var i=0,n=t.length;i<n;i++){t[i].exe(this)}}},p._regs=function(){for(var e in p.uiClassMap)m.regClass(e,p.uiClassMap[e])},p.createComp=function(e,t,i,n){if(!(t=t||p.getCompInstance(e)))return console.warn("can not create:"+e.type),null;var a=e.child;if(a)for(var r=t instanceof laya.ui.List,s=0,o=a.length;s<o;s++){var l=a[s];if(!t.hasOwnProperty("itemRender")||"render"!=l.props.name&&"render"!==l.props.renderType)if("Graphic"==l.type)m.addGraphicsToSprite(l,t);else if(m.isDrawType(l.type))m.addGraphicToSprite(l,t,!0);else{if(r){var h=[],c=p.createComp(l,null,i,h);h.length&&(c._$bindData=h)}else c=p.createComp(l,null,i,n);"Script"==l.type?"owner"in c?c.owner=t:"target"in c&&(c.target=t):"mask"==l.props.renderType||"mask"==l.props.name?t.mask=c:c instanceof laya.display.Sprite&&t.addChild(c)}else t.itemRender=l}var u=e.props;for(var d in u){var _=u[d];p.eventDic[d]?_&&i&&t.on(d,i,i.onEvent,[_]):p.setCompValue(t,d,_,i,n)}return f.__typeof(t,"laya.ui.IItem")&&t.initItems(),e.compId&&i&&i._idMap&&(i._idMap[e.compId]=t),t},p.setCompValue=function(e,t,i,n,a){if("string"==typeof i&&-1<i.indexOf("${")){if(p._sheet||(p._sheet=m.getClass("laya.data.Table")),!p._sheet)return void console.warn("Can not find class Sheet");if(a)a.push(e,t,i);else if(n){-1==i.indexOf("].")&&(i=i.replace(".","[0]."));var r,s,o=new _(e,t,i);o.exe(n);for(var l=i.replace(/\[.*?\]\./g,".");null!=(r=p._parseWatchData.exec(l));){for(var h=r[1];null!=(s=p._parseKeyWord.exec(h));){var c=s[0],u=n._watchMap[c]||(n._watchMap[c]=[]);u.push(o),p._sheet.I.notifer.on(c,n,n.changeData,[c])}(u=n._watchMap[h]||(n._watchMap[h]=[])).push(o),p._sheet.I.notifer.on(h,n,n.changeData,[h])}}}else if("var"===t&&n)n[i]=e;else if("onClick"==t){var d=f._runScript("(function(){"+i+"})");e.on("click",n,d)}else e[t]="true"===i||"false"!==i&&i},p.getCompInstance=function(e){var t,i=e.props?e.props.runtime:null;return t=i?p.viewClassMap[i]||p.uiClassMap[i]||f.__classmap[i]:p.uiClassMap[e.type],e.props&&e.props.hasOwnProperty("renderType")&&"instance"==e.props.renderType?t.instance:t?new t:null},p.regComponent=function(e,t){p.uiClassMap[e]=t,m.regClass(e,t)},p.regViewRuntime=function(e,t){p.viewClassMap[e]=t},p.uiMap={},p.viewClassMap={},p._sheet=null,n(p,["uiClassMap",function(){return this.uiClassMap={ViewStack:he,LinkButton:G,TextArea:Se,ColorPicker:W,Box:U,Button:G,CheckBox:Q,Clip:z,ComboBox:X,Component:B,HScrollBar:te,HSlider:re,Image:H,Label:K,List:ee,Panel:ne,ProgressBar:q,Radio:ae,RadioGroup:ve,ScrollBar:j,Slider:Y,Tab:Ce,TextInput:de,View:p,VScrollBar:ce,VSlider:_e,Tree:le,HBox:me,VBox:ge,Sprite:E,Animation:i,Text:S,FontClip:J}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),p.__init$=function(){function e(e,t,i){this.comp=null,this.prop=null,this.value=null,this.comp=e,this.prop=t,this.value=i}p._regs(),a(e,""),e.prototype.exe=function(e){var t=I.getBindFun(this.value);this.comp[this.prop]=t.call(this,e)},_=e},p}()),Q=function(e){function i(e,t){void 0===t&&(t=""),i.__super.call(this,e,t)}a(i,"laya.ui.CheckBox",e);var t=i.prototype;return t.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},t.initialize=function(){e.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},r(0,t,"dataSource",e.prototype._$get_dataSource,function(e){"boolean"==typeof(this._dataSource=e)?this.selected=e:"string"==typeof e?this.selected="true"===e:f.superSet(G,this,"dataSource",e)}),i}(G),$=function(){function e(){this._space=0,this._align="none",this._itemChanged=!1,e.__super.call(this)}a(e,"laya.ui.LayoutBox",U);var t=e.prototype;return t.addChild=function(e){return e.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,e)},t.onResize=function(e){this._setItemChanged()},t.addChildAt=function(e,t){return e.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,e,t)},t.removeChildAt=function(e){return this.getChildAt(e).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,e)},t.refresh=function(){this._setItemChanged()},t.changeItems=function(){this._itemChanged=!1},t.sortItem=function(e){e&&e.sort(function(e,t){return e.y-t.y})},t._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},r(0,t,"space",function(){return this._space},function(e){this._space=e,this._setItemChanged()}),r(0,t,"align",function(){return this._align},function(e){this._align=e,this._setItemChanged()}),e}(),J=function(t){function i(e,t){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,i.__super.call(this),e&&(this.skin=e),t&&(this.sheet=t)}a(i,"laya.ui.FontClip",t);var e=i.prototype;return e.createChildren=function(){this._bitmap=new O,this.on("loaded",this,this._onClipLoaded)},e._onClipLoaded=function(){this.callLater(this.changeValue)},e.changeValue=function(){var e;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),e=this._sources[0]))){var t="horizontal"===this._direction;t?(this._wordsW=this._valueArr.length*(e.sourceWidth+this.spaceX),this._wordsH=e.sourceHeight):(this._wordsW=e.sourceWidth,this._wordsH=(e.sourceHeight+this.spaceY)*this._valueArr.length);var i=0;if(this._width)switch(this._align){case"center":i=.5*(this._width-this._wordsW);break;case"right":i=this._width-this._wordsW;break;default:i=0}for(var n=0,a=this._valueArr.length;n<a;n++){var r=this._indexMap[this._valueArr.charAt(n)];this.sources[r]&&(e=this.sources[r],t?this.graphics.drawTexture(e,i+n*(e.sourceWidth+this.spaceX),0,e.sourceWidth,e.sourceHeight):this.graphics.drawTexture(e,0+i,n*(e.sourceHeight+this.spaceY),e.sourceWidth,e.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},e.destroy=function(e){void 0===e&&(e=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),t.prototype.destroy.call(this,e)},r(0,e,"sheet",function(){return this._sheet},function(e){e+="";var t=(this._sheet=e).split(" ");this._clipX=String(t[0]).length,this.clipY=t.length,this._indexMap={};for(var i=0;i<this._clipY;i++)for(var n=t[i].split(""),a=0,r=n.length;a<r;a++)this._indexMap[n[a]]=i*this._clipX+a}),r(0,e,"height",t.prototype._$get_height,function(e){f.superSet(z,this,"height",e),this.callLater(this.changeValue)}),r(0,e,"direction",function(){return this._direction},function(e){this._direction=e,this.callLater(this.changeValue)}),r(0,e,"value",function(){return this._valueArr?this._valueArr:""},function(e){e+="",this._valueArr=e,this.callLater(this.changeValue)}),r(0,e,"width",t.prototype._$get_width,function(e){f.superSet(z,this,"width",e),this.callLater(this.changeValue)}),r(0,e,"spaceX",function(){return this._spaceX},function(e){this._spaceX=e,"horizontal"===this._direction&&this.callLater(this.changeValue)}),r(0,e,"spaceY",function(){return this._spaceY},function(e){this._spaceY=e,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),r(0,e,"align",function(){return this._align},function(e){this._align=e,this.callLater(this.changeValue)}),r(0,e,"measureWidth",function(){return this._wordsW}),r(0,e,"measureHeight",function(){return this._wordsH}),i}(z),ee=function(e){function t(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new v,t.__super.call(this)}a(t,"laya.ui.List",e);var i=t.prototype;return f.imps(i,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),i.destroy=function(e){void 0===e&&(e=!0),this._content&&this._content.destroy(e),this._scrollBar&&this._scrollBar.destroy(e),laya.ui.Component.prototype.destroy.call(this,e),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},i.createChildren=function(){this.addChild(this._content=new U)},i.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=f.superGet(U,this,"cacheAs")),f.superSet(U,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},i.onScrollEnd=function(){f.superSet(U,this,"cacheAs",this._$P.cacheAs)},i._removePreScrollBar=function(){var e=this.removeChildByName("scrollBar");e&&e.destroy(!0)},i.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var e=this._getOneCell(),t=e.width+this._spaceX||1,i=e.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/t):Math.ceil(this._width/t)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/i):Math.round(this._height/i));var n=this._width?this._width:t*this.repeatX-this._spaceX,a=this._height?this._height:i*this.repeatY-this._spaceY;this._cellSize=this._isVertical?i:t,this._cellOffset=this._isVertical?i*Math.max(this._repeatY2,this._repeatY)-a-this._spaceY:t*Math.max(this._repeatX2,this._repeatX)-n-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=a:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=n),this.setContentSize(n,a);var r=this._isVertical?this.repeatX:this.repeatY,s=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,r,s),this._createdLine=s,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},i._getOneCell=function(){if(0===this._cells.length){var e=this.createItem();if(this._offset.setTo(e.x,e.y),this.cacheContent)return e;this._cells.push(e)}return this._cells[0]},i._createItems=function(e,t,i){var n=this._content,a=this._getOneCell(),r=a.width+this._spaceX,s=a.height+this._spaceY;if(this.cacheContent){var o=new U;o.cacheAsBitmap=!0,o.pos((this._isVertical?0:e)*r,(this._isVertical?e:0)*s),this._content.addChild(o),this._content.optimizeScrollRect=!0,n=o}else{for(var l=[],h=this._cells.length-1;-1<h;h--){var c=this._cells[h];c.removeSelf(),l.push(c)}this._cells.length=0}for(var u=e;u<i;u++)for(var d=0;d<t;d++)(a=l&&l.length?l.pop():this.createItem()).x=(this._isVertical?d:u)*r-n.x,a.y=(this._isVertical?u:d)*s-n.y,a.name="item"+(u*t+d),n.addChild(a),this.addCell(a)},i.createItem=function(){var e=[];if("function"==typeof this._itemRender)var t=new this._itemRender;else t=Z.createComp(this._itemRender,null,null,e);if(0==e.length&&t._watchMap){var i=t._watchMap;for(var n in i)for(var a=i[n],r=0;r<a.length;r++){var s=a[r];e.push(s.comp,s.prop,s.value)}}return e.length&&(t._$bindData=e),t},i.addCell=function(e){e.on("click",this,this.onCellMouse),e.on("rightclick",this,this.onCellMouse),e.on("mouseover",this,this.onCellMouse),e.on("mouseout",this,this.onCellMouse),e.on("mousedown",this,this.onCellMouse),e.on("mouseup",this,this.onCellMouse),this._cells.push(e)},i.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var e=0,t=e=0;t<1e4;t++){var i=this.getChildByName("item"+t);if(!i)break;this.addCell(i),e++}this.repeatY=e}},i.setContentSize=function(e,t){this._content.width=e,this._content.height=t,!this._scrollBar&&0==this._offset.x&&0==this._offset.y||(this._content.scrollRect||(this._content.scrollRect=new y),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,e,t),this._content.scrollRect=this._content.scrollRect),this.event("resize")},i.onCellMouse=function(e){"mousedown"===e.type&&(this._isMoved=!1);var t=e.currentTarget,i=this._startIndex+this._cells.indexOf(t);i<0||("click"===e.type||"rightclick"===e.type?this.selectEnable&&!this._isMoved?this.selectedIndex=i:this.changeCellState(t,!0,0):"mouseover"!==e.type&&"mouseout"!==e.type||this._selectedIndex===i||this.changeCellState(t,"mouseover"===e.type,0),this.mouseHandler&&this.mouseHandler.runWith([e,i]))},i.changeCellState=function(e,t,i){var n=e.getChildByName("selectBox");n&&(this.selectEnable=!0,n.visible=t,n.index=i)},i.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},i.onScrollBarChange=function(e){this.runCallLater(this.changeCells);var t=this._scrollBar.value,i=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,a=Math.floor(t/this._cellSize);if(this.cacheContent)s=n+1,this._createdLine-a<s&&(this._createItems(this._createdLine,i,this._createdLine+s),this.renderItems(this._createdLine*i,0),this._createdLine+=s);else{var r=a*i,s=0;if(r>this._startIndex){s=r-this._startIndex;var o=!0,l=this._startIndex+i*(n+1);this._isMoved=!0}else r<this._startIndex&&(s=this._startIndex-r,o=!1,l=this._startIndex-1,this._isMoved=!0);for(var h=0;h<s;h++){if(o){var c=this._cells.shift();this._cells[this._cells.length]=c;var u=l+h}else c=this._cells.pop(),this._cells.unshift(c),u=l-h;var d=Math.floor(u/i)*this._cellSize;this._isVertical?c.y=d:c.x=d,this.renderItem(c,u)}this._startIndex=r,this.changeSelectStatus()}var _=this._content.scrollRect;this._isVertical?(_.y=t-this._offset.y,_.x=-this._offset.x):(_.y=-this._offset.y,_.x=t-this._offset.x),this._content.scrollRect=_},i.posCell=function(e,t){if(this._scrollBar){var i=this._isVertical?this.repeatX:this.repeatY,n=(this._isVertical?this.repeatY:this.repeatX,Math.floor(t/i)*this._cellSize);this._isVertical?e.y=n:e.x=n}},i.changeSelectStatus=function(){for(var e=0,t=this._cells.length;e<t;e++)this.changeCellState(this._cells[e],this._selectedIndex===this._startIndex+e,1)},i.renderItems=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);for(var i=e,n=t||this._cells.length;i<n;i++)this.renderItem(this._cells[i],this._startIndex+i);this.changeSelectStatus()},i.renderItem=function(e,t){this._array&&0<=t&&t<this._array.length?(e.visible=!0,e._$bindData?(e._dataSource=this._array[t],this._bindData(e,this._array[t])):e.dataSource=this._array[t],this.cacheContent||this.posCell(e,t),this.hasListener("render")&&this.event("render",[e,t]),this.renderHandler&&this.renderHandler.runWith([e,t])):(e.visible=!1,e.dataSource=null)},i._bindData=function(e,t){for(var i=e._$bindData,n=0,a=i.length;n<a;n++){var r=i[n++],s=i[n++],o=i[n],l=I.getBindFun(o);r[s]=l.call(this,t)}},i.refresh=function(){this.array=this._array},i.getItem=function(e){return-1<e&&e<this._array.length?this._array[e]:null},i.changeItem=function(e,t){-1<e&&e<this._array.length&&(this._array[e]=t,e>=this._startIndex&&e<this._startIndex+this._cells.length&&this.renderItem(this.getCell(e),e))},i.setItem=function(e,t){this.changeItem(e,t)},i.addItem=function(e){this._array.push(e),this.array=this._array},i.addItemAt=function(e,t){this._array.splice(t,0,e),this.array=this._array},i.deleteItem=function(e){this._array.splice(e,1),this.array=this._array},i.getCell=function(e){return this.runCallLater(this.changeCells),-1<e&&this._cells?this._cells[(e-this._startIndex)%this._cells.length]:null},i.scrollTo=function(e){if(this._scrollBar){var t=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(e/t)*this._cellSize}else this.startIndex=e},i.tweenTo=function(e,t,i){if(void 0===t&&(t=200),this._scrollBar){var n=this._isVertical?this.repeatX:this.repeatY;T.to(this._scrollBar,{value:Math.floor(e/n)*this._cellSize},t,null,i,0,!0)}else this.startIndex=e,i&&i.run()},i._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},i.commitMeasure=function(){this.runCallLater(this.changeCells)},r(0,i,"cacheAs",e.prototype._$get_cacheAs,function(e){f.superSet(U,this,"cacheAs",e),this._scrollBar&&(this._$P.cacheAs=null,"none"!==e?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),r(0,i,"content",function(){return this._content}),r(0,i,"height",e.prototype._$get_height,function(e){e!=this._height&&(f.superSet(U,this,"height",e),this._setCellChanged())}),r(0,i,"itemRender",function(){return this._itemRender},function(e){if(this._itemRender!=e){this._itemRender=e;for(var t=this._cells.length-1;-1<t;t--)this._cells[t].destroy();this._cells.length=0,this._setCellChanged()}}),r(0,i,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(e){this._removePreScrollBar();var t=new ce;t.name="scrollBar",t.right=0,e&&" "!=e&&(t.skin=e),this.scrollBar=t,this.addChild(t),this._setCellChanged()}),r(0,i,"page",function(){return this._page},function(e){this._page=e,this._array&&(this._page=0<e?e:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),r(0,i,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(e){this._removePreScrollBar();var t=new te;t.name="scrollBar",t.bottom=0,e&&" "!=e&&(t.skin=e),this.scrollBar=t,this.addChild(t),this._setCellChanged()}),r(0,i,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(e){this._repeatX=e,this._setCellChanged()}),r(0,i,"scrollBar",function(){return this._scrollBar},function(e){this._scrollBar!=e&&(this._scrollBar=e)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),r(0,i,"width",e.prototype._$get_width,function(e){e!=this._width&&(f.superSet(U,this,"width",e),this._setCellChanged())}),r(0,i,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(e){this._repeatY=e,this._setCellChanged()}),r(0,i,"spaceX",function(){return this._spaceX},function(e){this._spaceX=e,this._setCellChanged()}),r(0,i,"spaceY",function(){return this._spaceY},function(e){this._spaceY=e,this._setCellChanged()}),r(0,i,"selectedIndex",function(){return this._selectedIndex},function(e){this._selectedIndex!=e&&(this._selectedIndex=e,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(e),this.startIndex=this._startIndex)}),r(0,i,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(e){this.selectedIndex=this._array.indexOf(e)}),r(0,i,"length",function(){return this._array?this._array.length:0}),r(0,i,"selection",function(){return this.getCell(this._selectedIndex)},function(e){this.selectedIndex=this._startIndex+this._cells.indexOf(e)}),r(0,i,"startIndex",function(){return this._startIndex},function(e){this._startIndex=0<e?e:0,this.callLater(this.renderItems)}),r(0,i,"array",function(){return this._array},function(e){this.runCallLater(this.changeCells),this._array=e||[];var t=this._array.length;if(this.totalPage=Math.ceil(t/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<t?this._selectedIndex:t-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var i=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,a=Math.ceil(t/i);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=n/a,this._scrollBar.setScroll(0,(a-n)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),r(0,i,"dataSource",e.prototype._$get_dataSource,function(e){"number"==typeof(this._dataSource=e)&&Math.floor(e)==e||"string"==typeof e?this.selectedIndex=parseInt(e):e instanceof Array?this.array=e:f.superSet(U,this,"dataSource",e)}),r(0,i,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),t}(U),te=(a(ie,"laya.ui.HScrollBar",V=j),ie.prototype.initialize=function(){V.prototype.initialize.call(this),this.slider.isVertical=!1},ie);function ie(){ie.__super.call(this)}var ne=function(e){function t(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,t.__super.call(this),this.width=this.height=100}a(t,"laya.ui.Panel",e);var i=t.prototype;return i.destroy=function(e){void 0===e&&(e=!0),laya.ui.Component.prototype.destroy.call(this,e),this._content&&this._content.destroy(e),this._vScrollBar&&this._vScrollBar.destroy(e),this._hScrollBar&&this._hScrollBar.destroy(e),this._vScrollBar=null,this._hScrollBar=null,this._content=null},i.destroyChildren=function(){this._content.destroyChildren()},i.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new U)},i.addChild=function(e){return e.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(e)},i.onResize=function(){this._setScrollChanged()},i.addChildAt=function(e,t){return e.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(e,t)},i.removeChild=function(e){return e.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(e)},i.removeChildAt=function(e){return this.getChildAt(e).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(e)},i.removeChildren=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=2147483647),this._content.removeChildren(e,t),this._setScrollChanged(),this},i.getChildAt=function(e){return this._content.getChildAt(e)},i.getChildByName=function(e){return this._content.getChildByName(e)},i.getChildIndex=function(e){return this._content.getChildIndex(e)},i.changeScroll=function(){this._scrollChanged=!1;var e=this.contentWidth||1,t=this.contentHeight||1,i=this._vScrollBar,n=this._hScrollBar,a=i&&t>this._height,r=n&&e>this._width,s=a?this._width-i.width:this._width,o=r?this._height-n.height:this._height;i&&(i.x=this._width-i.width,i.y=0,i.height=this._height-(r?n.height:0),i.scrollSize=Math.max(.033*this._height,1),i.thumbPercent=o/t,i.setScroll(0,t-o,i.value)),n&&(n.x=0,n.y=this._height-n.height,n.width=this._width-(a?i.width:0),n.scrollSize=Math.max(.033*this._width,1),n.thumbPercent=s/e,n.setScroll(0,e-s,n.value))},i.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},i.setContentSize=function(e,t){var i=this._content;i.width=e,i.height=t,i.scrollRect||(i.scrollRect=new y),i.scrollRect.setTo(0,0,e,t),i.scrollRect=i.scrollRect},i.onScrollBarChange=function(e){var t=this._content.scrollRect;if(t){var i=Math.round(e.value);e.isVertical?t.y=i:t.x=i,this._content.scrollRect=t}},i.scrollTo=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.vScrollBar&&(this.vScrollBar.value=t),this.hScrollBar&&(this.hScrollBar.value=e)},i.refresh=function(){this.changeScroll()},i.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=f.superGet(U,this,"cacheAs")),f.superSet(U,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},i.onScrollEnd=function(){f.superSet(U,this,"cacheAs",this._$P.cacheAs)},i._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},r(0,i,"numChildren",function(){return this._content.numChildren}),r(0,i,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(e){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new te),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=e}),r(0,i,"contentWidth",function(){for(var e=0,t=this._content.numChildren-1;-1<t;t--){var i=this._content.getChildAt(t);e=Math.max(i.x+i.width*i.scaleX,e)}return e}),r(0,i,"contentHeight",function(){for(var e=0,t=this._content.numChildren-1;-1<t;t--){var i=this._content.getChildAt(t);e=Math.max(i.y+i.height*i.scaleY,e)}return e}),r(0,i,"width",e.prototype._$get_width,function(e){f.superSet(U,this,"width",e),this._setScrollChanged()}),r(0,i,"hScrollBar",function(){return this._hScrollBar}),r(0,i,"content",function(){return this._content}),r(0,i,"height",e.prototype._$get_height,function(e){f.superSet(U,this,"height",e),this._setScrollChanged()}),r(0,i,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(e){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new ce),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=e}),r(0,i,"vScrollBar",function(){return this._vScrollBar}),r(0,i,"cacheAs",e.prototype._$get_cacheAs,function(e){f.superSet(U,this,"cacheAs",e),this._$P.cacheAs=null,"none"!==e?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),t}(U),ae=function(t){function i(e,t){this._value=null,void 0===t&&(t=""),i.__super.call(this,e,t)}a(i,"laya.ui.Radio",t);var e=i.prototype;return e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._value=null},e.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},e.initialize=function(){t.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},e.onClick=function(e){this.selected=!0},r(0,e,"value",function(){return null!=this._value?this._value:this.label},function(e){this._value=e}),i}(G),re=(a(se,"laya.ui.HSlider",Y),se);function se(e){se.__super.call(this,e),this.isVertical=!1}var oe=function(e){function i(e,t){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,i.__super.call(this),this.skin=t,this.labels=e}a(i,"laya.ui.UIGroup",e);var t=i.prototype;return f.imps(t,{"laya.ui.IItem":!0}),t.preinitialize=function(){this.mouseEnabled=!0},t.destroy=function(e){void 0===e&&(e=!0),laya.ui.Component.prototype.destroy.call(this,e),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},t.addItem=function(e,t){void 0===t&&(t=!0);var i=e,n=this._items.length;if(i.name="item"+n,this.addChild(i),this.initItems(),t&&0<n){var a=this._items[n-1];"horizontal"==this._direction?i.x=a.x+a.width+this._space:i.y=a.y+a.height+this._space}else t&&(i.x=0,i.y=0);return n},t.delItem=function(e,t){void 0===t&&(t=!0);var i=this._items.indexOf(e);if(-1!=i){var n=e;this.removeChild(n);for(var a=i+1,r=this._items.length;a<r;a++){var s=this._items[a];s.name="item"+(a-1),t&&("horizontal"==this._direction?s.x-=n.width+this._space:s.y-=n.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var o;o=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=o}}},t.initItems=function(){this._items||(this._items=[]);for(var e=this._items.length=0;e<1e4;e++){var t=this.getChildByName("item"+e);if(null==t)break;this._items.push(t),t.selected=e===this._selectedIndex,t.clickHandler=_.create(this,this.itemClick,[e],!1)}},t.itemClick=function(e){this.selectedIndex=e},t.setSelect=function(e,t){this._items&&-1<e&&e<this._items.length&&(this._items[e].selected=t)},t.createItem=function(e,t){return null},t.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var e=0,t=0,i=this._items.length;t<i;t++){var n=this._items[t];this._skin&&(n.skin=this._skin),this._labelColors&&(n.labelColors=this._labelColors),this._labelSize&&(n.labelSize=this._labelSize),this._labelStroke&&(n.labelStroke=this._labelStroke),this._labelStrokeColor&&(n.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(n.strokeColors=this._strokeColors),this._labelBold&&(n.labelBold=this._labelBold),this._labelPadding&&(n.labelPadding=this._labelPadding),this._labelAlign&&(n.labelAlign=this._labelAlign),this._stateNum&&(n.stateNum=this._stateNum),this._labelFont&&(n.labelFont=this._labelFont),"horizontal"===this._direction?(n.y=0,n.x=e,e+=n.width+this._space):(n.x=0,n.y=e,e+=n.height+this._space)}this.changeSize()},t.commitMeasure=function(){this.runCallLater(this.changeLabels)},t._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},r(0,t,"labelStrokeColor",function(){return this._labelStrokeColor},function(e){this._labelStrokeColor!=e&&(this._labelStrokeColor=e,this._setLabelChanged())}),r(0,t,"skin",function(){return this._skin},function(e){this._skin!=e&&(this._skin=e,this._setLabelChanged())}),r(0,t,"selectedIndex",function(){return this._selectedIndex},function(e){this._selectedIndex!=e&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=e,this.setSelect(e,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),r(0,t,"labels",function(){return this._labels},function(e){if(this._labels!=e){if(this._labels=e,this.removeChildren(),this._setLabelChanged(),this._labels)for(var t=this._labels.split(","),i=0,n=t.length;i<n;i++){var a=this.createItem(this._skin,t[i]);a.name="item"+i,this.addChild(a)}this.initItems()}}),r(0,t,"strokeColors",function(){return this._strokeColors},function(e){this._strokeColors!=e&&(this._strokeColors=e,this._setLabelChanged())}),r(0,t,"labelColors",function(){return this._labelColors},function(e){this._labelColors!=e&&(this._labelColors=e,this._setLabelChanged())}),r(0,t,"labelStroke",function(){return this._labelStroke},function(e){this._labelStroke!=e&&(this._labelStroke=e,this._setLabelChanged())}),r(0,t,"labelSize",function(){return this._labelSize},function(e){this._labelSize!=e&&(this._labelSize=e,this._setLabelChanged())}),r(0,t,"stateNum",function(){return this._stateNum},function(e){this._stateNum!=e&&(this._stateNum=e,this._setLabelChanged())}),r(0,t,"labelBold",function(){return this._labelBold},function(e){this._labelBold!=e&&(this._labelBold=e,this._setLabelChanged())}),r(0,t,"labelFont",function(){return this._labelFont},function(e){this._labelFont!=e&&(this._labelFont=e,this._setLabelChanged())}),r(0,t,"labelPadding",function(){return this._labelPadding},function(e){this._labelPadding!=e&&(this._labelPadding=e,this._setLabelChanged())}),r(0,t,"direction",function(){return this._direction},function(e){this._direction=e,this._setLabelChanged()}),r(0,t,"space",function(){return this._space},function(e){this._space=e,this._setLabelChanged()}),r(0,t,"items",function(){return this._items}),r(0,t,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(e){this.selectedIndex=this._items.indexOf(e)}),r(0,t,"dataSource",e.prototype._$get_dataSource,function(e){"number"==typeof(this._dataSource=e)&&Math.floor(e)==e||"string"==typeof e?this.selectedIndex=parseInt(e):e instanceof Array?this.labels=e.join(","):f.superSet(U,this,"dataSource",e)}),i}(U),le=function(e){function t(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,t.__super.call(this),this.width=this.height=200}a(t,"laya.ui.Tree",e);var i=t.prototype;return f.imps(i,{"laya.ui.IRender":!0}),i.destroy=function(e){void 0===e&&(e=!0),laya.ui.Component.prototype.destroy.call(this,e),this._list&&this._list.destroy(e),this._list=null,this._source=null,this._renderHandler=null},i.createChildren=function(){this.addChild(this._list=new ee),this._list.renderHandler=_.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},i.onListChange=function(e){this.event("change")},i.getArray=function(){var e,t=[];for(var i in this._source)e=this._source[i],this.getParentOpenStatus(e)&&(e.x=this._spaceLeft*this.getDepth(e),t.push(e));return t},i.getDepth=function(e,t){return void 0===t&&(t=0),null==e.nodeParent?t:this.getDepth(e.nodeParent,t+1)},i.getParentOpenStatus=function(e){var t=e.nodeParent;return null==t||!!t.isOpen&&(null==t.nodeParent||this.getParentOpenStatus(t))},i.renderItem=function(e,t){var i=e.dataSource;if(i){e.left=i.x;var n=e.getChildByName("arrow");n&&(i.hasChild?(n.visible=!0,n.index=i.isOpen?1:0,n.tag=t,n.off("click",this,this.onArrowClick),n.on("click",this,this.onArrowClick)):n.visible=!1);var a=e.getChildByName("folder");a&&(2==a.clipY?a.index=i.isDirectory?0:1:a.index=i.isDirectory?i.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([e,t])}},i.onArrowClick=function(e){var t=e.currentTarget.tag;this._list.array[t].isOpen=!this._list.array[t].isOpen,this.event("open"),this._list.array=this.getArray()},i.setItemState=function(e,t){this._list.array[e]&&(this._list.array[e].isOpen=t,this._list.array=this.getArray())},i.fresh=function(){this._list.array=this.getArray(),this.repaint()},i.parseXml=function(e,t,i,n){var a,r=e.childNodes,s=r.length;if(!n){a={};var o,l=e.attributes;for(var h in l){var c=(o=l[h]).nodeName,u=o.nodeValue;a[c]="true"==u||"false"!=u&&u}a.nodeParent=i,0<s&&(a.isDirectory=!0),a.hasChild=0<s,t.push(a)}for(var d=0;d<s;d++){var _=r[d];this.parseXml(_,t,a,!1)}},i.parseOpenStatus=function(e,t){for(var i=0,n=t.length;i<n;i++){var a=t[i];if(a.isDirectory)for(var r=0,s=e.length;r<s;r++){var o=e[r];if(o.isDirectory&&this.isSameParent(o,a)&&a.label==o.label){a.isOpen=o.isOpen;break}}}},i.isSameParent=function(e,t){return null==e.nodeParent&&null==t.nodeParent||null!=e.nodeParent&&null!=t.nodeParent&&(e.nodeParent.label==t.nodeParent.label&&this.isSameParent(e.nodeParent,t.nodeParent))},i.filter=function(e){if(Boolean(e)){var t=[];this.getFilterSource(this._source,t,e),this._list.array=t}else this._list.array=this.getArray()},i.getFilterSource=function(e,t,i){var n;for(var a in i=i.toLocaleLowerCase(),e)!(n=e[a]).isDirectory&&-1<String(n.label).toLowerCase().indexOf(i)&&(n.x=0,t.push(n)),n.child&&0<n.child.length&&this.getFilterSource(n.child,t,i)},r(0,i,"spaceBottom",function(){return this._list.spaceY},function(e){this._list.spaceY=e}),r(0,i,"keepStatus",function(){return this._keepStatus},function(e){this._keepStatus=e}),r(0,i,"itemRender",function(){return this._list.itemRender},function(e){this._list.itemRender=e}),r(0,i,"array",function(){return this._list.array},function(e){this._keepStatus&&this._list.array&&e&&this.parseOpenStatus(this._list.array,e),this._source=e,this._list.array=this.getArray()}),r(0,i,"mouseHandler",function(){return this._list.mouseHandler},function(e){this._list.mouseHandler=e}),r(0,i,"dataSource",e.prototype._$get_dataSource,function(e){this._dataSource=e,f.superSet(U,this,"dataSource",e)}),r(0,i,"source",function(){return this._source}),r(0,i,"scrollBar",function(){return this._list.scrollBar}),r(0,i,"list",function(){return this._list}),r(0,i,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(e){this._list.vScrollBarSkin=e}),r(0,i,"renderHandler",function(){return this._renderHandler},function(e){this._renderHandler=e}),r(0,i,"selectedIndex",function(){return this._list.selectedIndex},function(e){this._list.selectedIndex=e}),r(0,i,"spaceLeft",function(){return this._spaceLeft},function(e){this._spaceLeft=e}),r(0,i,"selectedItem",function(){return this._list.selectedItem},function(e){this._list.selectedItem=e}),r(0,i,"width",e.prototype._$get_width,function(e){f.superSet(U,this,"width",e),this._list.width=e}),r(0,i,"height",e.prototype._$get_height,function(e){f.superSet(U,this,"height",e),this._list.height=e}),r(0,i,"xml",null,function(e){var t=[];this.parseXml(e.childNodes[0],t,null,!0),this.array=t}),r(0,i,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),t}(U),he=function(e){function t(){this._items=null,this._selectedIndex=0,t.__super.call(this),this._setIndexHandler=_.create(this,this.setIndex,null,!1)}a(t,"laya.ui.ViewStack",e);var i=t.prototype;return f.imps(i,{"laya.ui.IItem":!0}),i.setItems=function(e){this.removeChildren();for(var t=0,i=0,n=e.length;i<n;i++){var a=e[i];a&&(a.name="item"+t,this.addChild(a),t++)}this.initItems()},i.addItem=function(e){e.name="item"+this._items.length,this.addChild(e),this.initItems()},i.initItems=function(){this._items=[];for(var e=0;e<1e4;e++){var t=this.getChildByName("item"+e);if(null==t)break;this._items.push(t),t.visible=e==this._selectedIndex}},i.setSelect=function(e,t){this._items&&-1<e&&e<this._items.length&&(this._items[e].visible=t)},i.setIndex=function(e){this.selectedIndex=e},r(0,i,"dataSource",e.prototype._$get_dataSource,function(e){if("number"==typeof(this._dataSource=e)&&Math.floor(e)==e||"string"==typeof e)this.selectedIndex=parseInt(e);else for(var t in this._dataSource)this.hasOwnProperty(t)&&(this[t]=this._dataSource[t])}),r(0,i,"selectedIndex",function(){return this._selectedIndex},function(e){this._selectedIndex!=e&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=e,this.setSelect(this._selectedIndex,!0))}),r(0,i,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(e){this.selectedIndex=this._items.indexOf(e)}),r(0,i,"items",function(){return this._items}),r(0,i,"setIndexHandler",function(){return this._setIndexHandler},function(e){this._setIndexHandler=e}),t}(U),ce=(a(ue,"laya.ui.VScrollBar",j),ue);function ue(){ue.__super.call(this)}var de=function(t){function i(e){this._bg=null,this._skin=null,i.__super.call(this),void 0===e&&(e=""),this.text=e,this.skin=this.skin}a(i,"laya.ui.TextInput",t);var e=i.prototype;return e.preinitialize=function(){this.mouseEnabled=!0},e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bg&&this._bg.destroy(),this._bg=null},e.createChildren=function(){this.addChild(this._tf=new p),this._tf.padding=L.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},e._onFocus=function(){this.event("focus",this)},e._onBlur=function(){this.event("blur",this)},e._onInput=function(){this.event("input",this)},e._onEnter=function(){this.event("enter",this)},e.initialize=function(){this.width=128,this.height=22},e.select=function(){this._tf.select()},e.setSelection=function(e,t){this._tf.setSelection(e,t)},r(0,e,"text",t.prototype._$get_text,function(e){this._tf.text!=e&&(e+="",this._tf.text=e,this.event("change"))}),r(0,e,"bg",function(){return this._bg},function(e){this.graphics=this._bg=e}),r(0,e,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(e){this._tf.inputElementYAdjuster=e}),r(0,e,"multiline",function(){return this._tf.multiline},function(e){this._tf.multiline=e}),r(0,e,"skin",function(){return this._skin},function(e){this._skin!=e&&(this._skin=e,this._bg||(this.graphics=this._bg=new O),this._bg.source=g.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),r(0,e,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(e){this._bg||(this.graphics=this._bg=new O),this._bg.sizeGrid=I.fillArray(L.defaultSizeGrid,e,Number)}),r(0,e,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(e){this._tf.inputElementXAdjuster=e}),r(0,e,"width",t.prototype._$get_width,function(e){f.superSet(K,this,"width",e),this._bg&&(this._bg.width=e)}),r(0,e,"height",t.prototype._$get_height,function(e){f.superSet(K,this,"height",e),this._bg&&(this._bg.height=e)}),r(0,e,"editable",function(){return this._tf.editable},function(e){this._tf.editable=e}),r(0,e,"restrict",function(){return this._tf.restrict},function(e){this._tf.restrict=e}),r(0,e,"prompt",function(){return this._tf.prompt},function(e){this._tf.prompt=e}),r(0,e,"promptColor",function(){return this._tf.promptColor},function(e){this._tf.promptColor=e}),r(0,e,"maxChars",function(){return this._tf.maxChars},function(e){this._tf.maxChars=e}),r(0,e,"focus",function(){return this._tf.focus},function(e){this._tf.focus=e}),r(0,e,"type",function(){return this._tf.type},function(e){this._tf.type=e}),r(0,e,"asPassword",function(){return this._tf.asPassword},function(e){this._tf.asPassword=e}),i}(K),_e=(a(pe,"laya.ui.VSlider",Y),pe);function pe(){pe.__super.call(this)}var fe=function(e){function n(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,n.__super.call(this)}a(n,"laya.ui.Dialog",e);var t=n.prototype;return t.initialize=function(){this.popupEffect=n.manager.popupEffectHandler,this.closeEffect=n.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},t._dealDragArea=function(){var e=this.getChildByName("drag");e&&(this.dragArea=e.x+","+e.y+","+e.width+","+e.height,e.removeSelf())},t._onClick=function(e){var t=e.target;if(t)switch(t.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(t.name)}},t.show=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!0),this._open(!1,e,t)},t.popup=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!0),this._open(!0,e,t)},t._open=function(e,t,i){n.manager.lock(!1),this.isModal=e,n.manager.open(this,t,i)},t.onOpened=function(){},t.close=function(e,t){void 0===t&&(t=!0),n.manager.close(this,e,t)},t.onClosed=function(e){},t._onMouseDown=function(e){var t=this.getMousePoint();this._dragArea.contains(t.x,t.y)?this.startDrag():this.stopDrag()},r(0,t,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(e){if(e){var t=I.fillArray([0,0,0,0],e,Number);this._dragArea=new y(t[0],t[1],t[2],t[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),r(0,t,"isPopup",function(){return null!=this.parent}),r(0,t,"zOrder",e.prototype._$get_zOrder,function(e){f.superSet(Z,this,"zOrder",e),n.manager._checkMask()}),r(1,n,"manager",function(){return n._manager=n._manager||new F},function(e){n._manager=e}),n.setLockView=function(e){n.manager.setLockView(e)},n.lock=function(e){n.manager.lock(e)},n.closeAll=function(){n.manager.closeAll()},n.getDialogsByGroup=function(e){return n.manager.getDialogsByGroup(e)},n.closeByGroup=function(e){return n.manager.closeByGroup(e)},n.CLOSE="close",n.CANCEL="cancel",n.SURE="sure",n.NO="no",n.OK="ok",n.YES="yes",n._manager=null,n}(Z),me=function(e){function t(){t.__super.call(this)}a(t,"laya.ui.HBox",e);var i=t.prototype;return i.sortItem=function(e){e&&e.sort(function(e,t){return e.x-t.x})},i.changeItems=function(){this._itemChanged=!1;for(var e=[],t=0,i=0,n=this.numChildren;i<n;i++){var a=this.getChildAt(i);a&&a.layoutEnabled&&(e.push(a),t=this._height?this._height:Math.max(t,a.height*a.scaleY))}this.sortItem(e);var r=0;for(i=0,n=e.length;i<n;i++)(a=e[i]).x=r,r+=a.width*a.scaleX+this._space,"top"==this._align?a.y=0:"middle"==this._align?a.y=.5*(t-a.height*a.scaleY):"bottom"==this._align&&(a.y=t-a.height*a.scaleY);this.changeSize()},r(0,i,"height",e.prototype._$get_height,function(e){this._height!=e&&(f.superSet($,this,"height",e),this.callLater(this.changeItems))}),t.NONE="none",t.TOP="top",t.MIDDLE="middle",t.BOTTOM="bottom",t}($),ge=function(e){function t(){t.__super.call(this)}a(t,"laya.ui.VBox",e);var i=t.prototype;return i.changeItems=function(){this._itemChanged=!1;for(var e=[],t=0,i=0,n=this.numChildren;i<n;i++){var a=this.getChildAt(i);a&&a.layoutEnabled&&(e.push(a),t=this._width?this._width:Math.max(t,a.width*a.scaleX))}this.sortItem(e);var r=0;for(i=0,n=e.length;i<n;i++)(a=e[i]).y=r,r+=a.height*a.scaleY+this._space,"left"==this._align?a.x=0:"center"==this._align?a.x=.5*(t-a.width*a.scaleX):"right"==this._align&&(a.x=t-a.width*a.scaleX);this.changeSize()},r(0,i,"width",e.prototype._$get_width,function(e){this._width!=e&&(f.superSet($,this,"width",e),this.callLater(this.changeItems))}),t.NONE="none",t.LEFT="left",t.CENTER="center",t.RIGHT="right",t}($),ve=(a(ye,"laya.ui.RadioGroup",oe),ye.prototype.createItem=function(e,t){return new ae(e,t)},ye);function ye(){ye.__super.call(this)}var Ce=(a(Ee,"laya.ui.Tab",oe),Ee.prototype.createItem=function(e,t){return new G(e,t)},Ee);function Ee(){Ee.__super.call(this)}var Se=function(t){function i(e){this._vScrollBar=null,this._hScrollBar=null,void 0===e&&(e=""),i.__super.call(this,e)}a(i,"laya.ui.TextArea",t);var e=i.prototype;return e.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},e.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},e.onVBarChanged=function(e){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},e.onHBarChanged=function(e){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},e.changeScroll=function(){var e=this._vScrollBar&&0<this._tf.maxScrollY,t=this._hScrollBar&&0<this._tf.maxScrollX,i=e?this._width-this._vScrollBar.width:this._width,n=t?this._height-this._hScrollBar.height:this._height,a=this._tf.padding||L.labelPadding;this._tf.width=i,this._tf.height=n,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-a[2],this._vScrollBar.y=a[1],this._vScrollBar.height=this._height-(t?this._hScrollBar.height:0)-a[1]-a[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=n/Math.max(this._tf.textHeight,n),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=e),this._hScrollBar&&(this._hScrollBar.x=a[0],this._hScrollBar.y=this._height-this._hScrollBar.height-a[3],this._hScrollBar.width=this._width-(e?this._vScrollBar.width:0)-a[0]-a[2],this._hScrollBar.scrollSize=Math.max(.033*i,1),this._hScrollBar.thumbPercent=i/Math.max(this._tf.textWidth,i),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=t)},e.scrollTo=function(e){this.commitMeasure(),this._tf.scrollY=e},r(0,e,"scrollY",function(){return this._tf.scrollY}),r(0,e,"width",t.prototype._$get_width,function(e){f.superSet(de,this,"width",e),this.callLater(this.changeScroll)}),r(0,e,"hScrollBar",function(){return this._hScrollBar}),r(0,e,"height",t.prototype._$get_height,function(e){f.superSet(de,this,"height",e),this.callLater(this.changeScroll)}),r(0,e,"maxScrollX",function(){return this._tf.maxScrollX}),r(0,e,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(e){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new ce),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=e}),r(0,e,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(e){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new te),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=e}),r(0,e,"vScrollBar",function(){return this._vScrollBar}),r(0,e,"maxScrollY",function(){return this._tf.maxScrollY}),r(0,e,"scrollX",function(){return this._tf.scrollX}),i}(de);!function(){function e(){this._uiView=null,this.isCloseOther=!1,e.__super.call(this)}a(e,"laya.ui.AsynDialog",fe);var t=e.prototype;t.createView=function(e){this._uiView=e},t._open=function(e,t,i){this.isModal=e,this.isCloseOther=t,fe.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},t.onCreated=function(){this.createUI(),this.onOpen()},t.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},t.onOpen=function(){fe.manager.open(this,this.isCloseOther),fe.manager.lock(!1)},t.close=function(e,t){void 0===t&&(t=!0),fe.manager.close(this),this.onClose()},t.onClose=function(){},t.destroy=function(e){void 0===e&&(e=!0),laya.ui.View.prototype.destroy.call(this,e),this._uiView=null,this.onDestroy()},t.onDestroy=function(){}}();f.__init([Z])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,t){"use strict";for(var i in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(t[i]=n)}}),function(d,e,x){x.un,x.uns;var u=x.static,f=x.class,v=x.getset,T=x.__newvec,n=(laya.ani.AnimationContent,laya.ani.AnimationPlayer),a=(laya.ani.AnimationState,laya.ani.AnimationTemplet),m=laya.maths.Arith,s=laya.webgl.atlas.AtlasResourceManager,t=laya.webgl.shader.BaseShader,R=laya.utils.Browser,o=laya.webgl.utils.Buffer,C=laya.utils.Byte,l=(laya.ani.bone.canvasmesh.CacheAbleSkinMesh,laya.utils.ClassUtils),h=x.Config,i=(laya.events.Event,laya.events.EventDispatcher),b=laya.utils.Handler,Me=laya.net.Loader,r=laya.net.LoaderManager,F=laya.maths.MathUtil,c=laya.display.Node,_=laya.renders.Render,p=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),g=laya.resource.Resource,y=laya.utils.RunDriver,E=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),S=laya.display.Sprite,w=laya.utils.Stat,M=laya.utils.StringKey,L=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),A=laya.utils.Utils,I=laya.webgl.WebGL,D=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;x.interface("laya.d3.core.IClone"),x.interface("laya.d3.graphics.IVertex"),x.interface("laya.d3.core.render.IUpdate"),x.interface("laya.d3.core.scene.ITreeNode"),x.interface("laya.d3.core.render.IRenderable");var P=(f(N,"laya.d3.animation.AnimationClipParser01"),N.READ_DATA=function(){N._DATA.offset=N._reader.getUint32(),N._DATA.size=N._reader.getUint32()},N.READ_BLOCK=function(){for(var e=N._BLOCK.count=N._reader.getUint16(),t=N._BLOCK.blockStarts=[],i=N._BLOCK.blockLengths=[],n=0;n<e;n++)t.push(N._reader.getUint32()),i.push(N._reader.getUint32())},N.READ_STRINGS=function(){var e=N._reader.getUint32(),t=N._reader.getUint16(),i=N._reader.pos;N._reader.pos=e+N._DATA.offset;for(var n=0;n<t;n++)N._strings[n]=N._reader.readUTFString();N._reader.pos=i},N.parse=function(e,t){N._animationClip=e,(N._reader=t).__getBuffer(),N.READ_DATA(),N.READ_BLOCK(),N.READ_STRINGS();for(var i=0,n=N._BLOCK.count;i<n;i++){var a=t.getUint16(),r=N._strings[a],s=N["READ_"+r];if(null==s)throw new Error("model file err,no this function:"+a+" "+r);s.call()}},N.READ_ANIMATIONS=function(){var e,t=0,i=0,n=N._reader,a=n.__getBuffer(),r=[],s=n.getUint8();for(r.length=s,t=0;t<s;t++)r[t]=n.getUint16();var o=[],l=n.getUint16();for(o.length=l,t=0;t<l;t++)o[t]=n.getFloat32();var h=N._animationClip;h.name=N._strings[n.getUint16()];var c=h._duration=n.getFloat32();h.islooping=!!n.getByte(),h._frameRate=n.getInt16();var u=n.getInt16(),d=h._nodes=new Array;d.length=u,(h._publicClipDatas=[]).length=u;var _=h._nodesMap={},p=0,f=0;for(t=0;t<u;t++){e=d[t]=new z;var m=n.getUint16(),g=e.path=[];for(g.length=m,i=0;i<m;i++)g[i]=N._strings[n.getUint16()];var v=g.join("/"),y=_[v];y||(_[v]=y=[]),y.push(e);var C=n.getInt16();-1!==C&&(e.componentType=N._strings[C]);var E=U._propertyIndexDic[N._strings[n.getUint16()]];if(null==E)throw new Error("AnimationClipParser01:unknown property name.");var S=E<4,x=!S||S&&""===g[0];(e._cacheProperty=x)?p++:f++,e.propertyNameID=E;var T=r[n.getUint8()];e.keyFrameWidth=T/4;var w=e.keyFrames=[],M=w.length=n.getUint16(),b=null,R=NaN;for(i=0;i<M;i++){var L=w[i]=new G;R=L.startTime=o[n.getUint16()];var A=n.pos;L.inTangent=new Float32Array(a.slice(A,A+T)),n.pos+=T,A=n.pos,L.outTangent=new Float32Array(a.slice(A,A+T)),n.pos+=T,A=n.pos,L.data=new Float32Array(a.slice(A,A+T)),n.pos+=T,b&&(b.next=L,b.duration=R-b.startTime),b=L}L.next=null,L.duration=c-R}var I=h._nodeToCachePropertyMap=new Int32Array(u),D=h._cachePropertyMap=new Int32Array(p),P=h._unCachePropertyMap=new Int32Array(f);for(p=f=0,t=0;t<u;t++)(e=d[t])._cacheProperty?(I[t]=p,D[p++]=t):P[f++]=t},N._animationClip=null,N._reader=null,N._strings=[],u(N,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),N);function N(){}var O=(f(B,"laya.d3.animation.AnimationClipParser02"),B.READ_DATA=function(){B._DATA.offset=B._reader.getUint32(),B._DATA.size=B._reader.getUint32()},B.READ_BLOCK=function(){for(var e=B._BLOCK.count=B._reader.getUint16(),t=B._BLOCK.blockStarts=[],i=B._BLOCK.blockLengths=[],n=0;n<e;n++)t.push(B._reader.getUint32()),i.push(B._reader.getUint32())},B.READ_STRINGS=function(){var e=B._reader.getUint32(),t=B._reader.getUint16(),i=B._reader.pos;B._reader.pos=e+B._DATA.offset;for(var n=0;n<t;n++)B._strings[n]=B._reader.readUTFString();B._reader.pos=i},B.parse=function(e,t){B._animationClip=e,(B._reader=t).__getBuffer(),B.READ_DATA(),B.READ_BLOCK(),B.READ_STRINGS();for(var i=0,n=B._BLOCK.count;i<n;i++){var a=t.getUint16(),r=B._strings[a],s=B["READ_"+r];if(null==s)throw new Error("model file err,no this function:"+a+" "+r);s.call()}},B.READ_ANIMATIONS=function(){var e,t=0,i=0,n=B._reader,a=n.__getBuffer(),r=[],s=n.getUint8();for(r.length=s,t=0;t<s;t++)r[t]=n.getUint16();var o=[],l=n.getUint16();for(o.length=l,t=0;t<l;t++)o[t]=n.getFloat32();var h=B._animationClip;h.name=B._strings[n.getUint16()];var c=h._duration=n.getFloat32();h.islooping=!!n.getByte(),h._frameRate=n.getInt16();var u=n.getInt16(),d=h._nodes=new Array;d.length=u,(h._publicClipDatas=[]).length=u;var _=h._nodesMap={},p=0,f=0;for(t=0;t<u;t++){e=d[t]=new z;var m=n.getUint16(),g=e.path=[];for(g.length=m,i=0;i<m;i++)g[i]=B._strings[n.getUint16()];var v=g.join("/"),y=_[v];y||(_[v]=y=[]),y.push(e);var C=n.getInt16();-1!==C&&(e.componentType=B._strings[C]);var E=U._propertyIndexDic[B._strings[n.getUint16()]];if(null==E)throw new Error("AnimationClipParser02:unknown property name.");var S=E<4,x=!S||S&&""===g[0];(e._cacheProperty=x)?p++:f++,e.propertyNameID=E;var T=r[n.getUint8()];e.keyFrameWidth=T/4;var w=e.keyFrames=[],M=w.length=n.getUint16(),b=null,R=NaN;for(i=0;i<M;i++){var L=w[i]=new G;R=L.startTime=o[n.getUint16()];var A=n.pos;L.inTangent=new Float32Array(a.slice(A,A+T)),n.pos+=T,A=n.pos,L.outTangent=new Float32Array(a.slice(A,A+T)),n.pos+=T,A=n.pos,L.data=new Float32Array(a.slice(A,A+T)),n.pos+=T,b&&(b.next=L,b.duration=R-b.startTime),b=L}L.next=null,L.duration=c-R}var I=n.getUint16();for(t=0;t<I;t++){var D,P=new H;P.time=n.getFloat32(),P.eventName=B._strings[n.getUint16()];var N=n.getUint16();for(0<N&&(P.params=D=[]),i=0;i<N;i++)switch(n.getByte()){case 0:D.push(!!n.getByte());break;case 1:D.push(n.getInt32());break;case 2:D.push(n.getFloat32());break;case 3:D.push(B._strings[n.getUint16()]);break;default:throw new Error("unknown type.")}h.addEvent(P)}var O=h._nodeToCachePropertyMap=new Int32Array(u),k=h._cachePropertyMap=new Int32Array(p),V=h._unCachePropertyMap=new Int32Array(f);for(p=f=0,t=0;t<u;t++)(e=d[t])._cacheProperty?(O[t]=p,k[p++]=t):V[f++]=t},B._animationClip=null,B._reader=null,B._strings=[],u(B,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),B);function B(){}var H=(f(k,"laya.d3.animation.AnimationEvent"),k);function k(){this.time=NaN,this.eventName=null,this.params=null}var U=function(){function n(){this._childs=[],this.transform=new Pi(this)}f(n,"laya.d3.animation.AnimationNode");var e=n.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e.addChild=function(e){e._parent=this,e.transform.setParent(this.transform),this._childs.push(e)},e.removeChild=function(e){var t=this._childs.indexOf(e);-1!==t&&this._childs.splice(t,1)},e.getChildByName=function(e){for(var t=0,i=this._childs.length;t<i;t++){var n=this._childs[t];if(n.name===e)return n}return null},e.getChildByIndex=function(e){return this._childs[e]},e.getChildCount=function(){return this._childs.length},e.cloneTo=function(e){var t=e;t.name=this.name;for(var i=0,n=this._childs.length;i<n;i++){var a=this._childs[i],r=a.clone();t.addChild(r);var s=a.transform,o=r.transform;o.setLocalPosition(s.getLocalPosition()),o.setLocalRotation(s.getLocalRotation()),o.setLocalScale(s.getLocalScale()),o._localRotationEuler=s._localRotationEuler,o._setWorldMatrixIgnoreUpdate(s.getWorldMatrix())}},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},n.__init__=function(){n.registerAnimationNodeProperty("localPosition",n._getLocalPosition,n._setLocalPosition),n.registerAnimationNodeProperty("localRotation",n._getLocalRotation,n._setLocalRotation),n.registerAnimationNodeProperty("localScale",n._getLocalScale,n._setLocalScale),n.registerAnimationNodeProperty("localRotationEuler",n._getLocalRotationEuler,n._setLocalRotationEuler),n.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",n._getParticleRenderSharedMaterialTintColor,n._setParticleRenderSharedMaterialTintColor),n.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",n._getMeshRenderSharedMaterialTilingOffset,n._setMeshRenderSharedMaterialTilingOffset),n.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",n._getMeshRenderSharedMaterialAlbedo,n._setMeshRenderSharedMaterialAlbedo),n.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",n._getSkinnedMeshRenderSharedMaterialTilingOffset,n._setSkinnedMeshRenderSharedMaterialTilingOffset),n.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",n._getSkinnedMeshRenderSharedMaterialAlbedo,n._setSkinnedMeshRenderSharedMaterialAlbedo),n.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",n._getMeshRenderSharedMaterialAlbedo,n._setMeshRenderSharedMaterialAlbedo),n.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",n._getSkinnedMeshRenderSharedMaterialAlbedo,n._setSkinnedMeshRenderSharedMaterialAlbedo),n.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",n._getMeshRenderSharedMaterialIntensity,n._setMeshRenderSharedMaterialIntensity),n.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",n._getMeshRenderSharedMaterialAlpha,n._setMeshRenderSharedMaterialAlpha),n.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",n._getMeshRenderSharedMaterialAlphaColor,n._setMeshRenderSharedMaterialAlphaColor),n.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",n._getMeshRenderSharedMaterialBaseColor,n._setMeshRenderSharedMaterialBaseColor),n.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",n._getMeshRenderSharedMaterialDissolve,n._setMeshRenderSharedMaterialDissolve),n.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",n._getMeshRenderSharedMaterialDissolveSpeed,n._setMeshRenderSharedMaterialDissolveSpeed),n.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",n._getMeshRenderSharedMaterialMMultiplier,n._setMeshRenderSharedMaterialMMultiplier),n.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",n._getMeshRenderSharedMaterialBaseScrollSpeedX,n._setMeshRenderSharedMaterialBaseScrollSpeedX),n.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",n._getMeshRenderSharedMaterialBaseScrollSpeedY,n._setMeshRenderSharedMaterialBaseScrollSpeedY),n.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",n._getMeshRenderSharedMaterialSecondScrollSpeedX,n._setMeshRenderSharedMaterialSecondScrollSpeedX),n.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",n._getMeshRenderSharedMaterialSecondScrollSpeedY,n._setMeshRenderSharedMaterialSecondScrollSpeedY),n.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",n._getMeshRenderSharedMaterialDetailTilingOffset,n._setMeshRenderSharedMaterialDetailTilingOffset),n.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",n._getMeshRenderSharedMaterialDissolveTilingOffset,n._setMeshRenderSharedMaterialDissolveTilingOffset),n.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",n._getMeshRenderSharedMaterialMaskTilingOffset,n._setMeshRenderSharedMaterialMaskTilingOffset)},n.registerAnimationNodeProperty=function(e,t,i){if(n._propertyIndexDic[e])throw new Error("AnimationNode: this propertyName has registered.");n._propertyIndexDic[e]=n._propertyIDCounter,n._propertyGetFuncs[n._propertyIDCounter]=t,n._propertySetFuncs[n._propertyIDCounter]=i,n._propertyIDCounter++},n._getLocalPosition=function(e,t){return e?e.transform.getLocalPosition():t._transform.localPosition.elements},n._setLocalPosition=function(e,t,i){if(e)e.transform.setLocalPosition(i);else{var n=t._transform,a=n.localPosition;a.elements=i,n.localPosition=a}},n._getLocalRotation=function(e,t){return e?e.transform.getLocalRotation():t._transform.localRotation.elements},n._setLocalRotation=function(e,t,i){if(e)e.transform.setLocalRotation(i);else{var n=t._transform,a=n.localRotation;a.elements=i,n.localRotation=a}},n._getLocalScale=function(e,t){return e?e.transform.getLocalScale():t._transform.localScale.elements},n._setLocalScale=function(e,t,i){if(e)e.transform.setLocalScale(i);else{var n=t._transform,a=n.localScale;a.elements=i,n.localScale=a}},n._getLocalRotationEuler=function(e,t){return e?e.transform.getLocalRotationEuler():t._transform.localRotationEuler.elements},n._setLocalRotationEuler=function(e,t,i){if(e)e.transform.setLocalRotationEuler(i);else{var n=t._transform,a=n.localRotationEuler;a.elements=i,n.localRotationEuler=a}},n._getMeshRenderSharedMaterialTilingOffset=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return t.meshRender.sharedMaterial.tilingOffset.elements},n._setMeshRenderSharedMaterialTilingOffset=function(e,t,i){var n,a;if(e){var r=e.transform._entity;r&&((a=(n=r.owner.meshRender.material).tilingOffset).elements=i,n.tilingOffset=a)}else(a=(n=t.meshRender.material).tilingOffset).elements=i,n.tilingOffset=a},n._getMeshRenderSharedMaterialAlbedo=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.albedoColor.elements:null}return t.meshRender.sharedMaterial.albedoColor.elements},n._setMeshRenderSharedMaterialAlbedo=function(e,t,i){var n,a;if(e){var r=e.transform._entity;r&&((a=(n=r.owner.meshRender.material).albedoColor).elements=i,n.albedoColor=a)}else(a=(n=t.meshRender.material).albedoColor).elements=i,n.albedoColor=a},n._getSkinnedMeshRenderSharedMaterialTilingOffset=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return t.skinnedMeshRender.sharedMaterial.tilingOffset.elements},n._setSkinnedMeshRenderSharedMaterialTilingOffset=function(e,t,i){var n,a;if(e){var r=e.transform._entity;r&&((a=(n=r.owner.skinnedMeshRender.material).tilingOffset).elements=i,n.tilingOffset=a)}else(a=(n=t.skinnedMeshRender.material).tilingOffset).elements=i,n.tilingOffset=a},n._getSkinnedMeshRenderSharedMaterialAlbedo=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return t.skinnedMeshRender.sharedMaterial.albedoColor.elements},n._setSkinnedMeshRenderSharedMaterialAlbedo=function(e,t,i){var n,a;if(e){var r=e.transform._entity;r&&((a=(n=r.owner.skinnedMeshRender.material).albedoColor).elements=i,n.albedoColor=a)}else(a=(n=t.skinnedMeshRender.material).albedoColor).elements=i,n.albedoColor=a},n._getParticleRenderSharedMaterialTintColor=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.particleRender.sharedMaterial.tintColor.elements:null}return t.particleRender.sharedMaterial.tintColor.elements},n._setParticleRenderSharedMaterialTintColor=function(e,t,i){var n,a;if(e){var r=e.transform._entity;r&&((a=(n=r.owner.particleRender.material).tintColor).elements=i,n.tintColor=a)}else(a=(n=t.particleRender.material).tintColor).elements=i,n.tintColor=a},n._getMeshRenderSharedMaterialAlphaColor=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.alphaColor.elements:null}return t.meshRender.sharedMaterial.alphaColor.elements},n._setMeshRenderSharedMaterialAlphaColor=function(e,t,i){var n,a;if(e){var r=e.transform._entity;r&&((a=(n=r.owner.meshRender.material).alphaColor).elements=i,n.alphaColor=a)}else(a=(n=t.meshRender.material).alphaColor).elements=i,n.alphaColor=a},n._getMeshRenderSharedMaterialBaseColor=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.baseColor.elements:null}return t.meshRender.sharedMaterial.baseColor.elements},n._setMeshRenderSharedMaterialBaseColor=function(e,t,i){var n,a;if(e){var r=e.transform._entity;r&&((a=(n=r.owner.meshRender.material).baseColor).elements=i,n.baseColor=a)}else(a=(n=t.meshRender.material).baseColor).elements=i,n.baseColor=a},n._getMeshRenderSharedMaterialDissolve=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.dissolve:0}return t.meshRender.sharedMaterial.dissolve},n._setMeshRenderSharedMaterialDissolve=function(e,t,i){if(e){var n=e.transform._entity;n&&(n.owner.meshRender.material.dissolve=i[0])}else t.meshRender.material.dissolve=i[0]},n._getMeshRenderSharedMaterialDissolveSpeed=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.dissolveSpeed:0}return t.meshRender.sharedMaterial.dissolveSpeed},n._setMeshRenderSharedMaterialDissolveSpeed=function(e,t,i){if(e){var n=e.transform._entity;n&&(n.owner.meshRender.material.dissolveSpeed=i[0])}else t.meshRender.material.dissolveSpeed=i[0]},n._getMeshRenderSharedMaterialMMultiplier=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.mMultiplier:0}return t.meshRender.sharedMaterial.mMultiplier},n._setMeshRenderSharedMaterialMMultiplier=function(e,t,i){if(e){var n=e.transform._entity;n&&(n.owner.meshRender.material.mMultiplier=i[0])}else t.meshRender.material.mMultiplier=i[0]},n._getMeshRenderSharedMaterialBaseScrollSpeedX=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return t.meshRender.sharedMaterial.baseScrollSpeedX},n._setMeshRenderSharedMaterialBaseScrollSpeedX=function(e,t,i){if(e){var n=e.transform._entity;n&&(n.owner.meshRender.material.baseScrollSpeedX=i[0])}else t.meshRender.material.baseScrollSpeedX=i[0]},n._getMeshRenderSharedMaterialBaseScrollSpeedY=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return t.meshRender.sharedMaterial.baseScrollSpeedY},n._setMeshRenderSharedMaterialBaseScrollSpeedY=function(e,t,i){if(e){var n=e.transform._entity;n&&(n.owner.meshRender.material.baseScrollSpeedY=i[0])}else t.meshRender.material.baseScrollSpeedY=i[0]},n._getMeshRenderSharedMaterialSecondScrollSpeedX=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return t.meshRender.sharedMaterial.secondScrollSpeedX},n._setMeshRenderSharedMaterialSecondScrollSpeedX=function(e,t,i){if(e){var n=e.transform._entity;n&&(n.owner.meshRender.material.secondScrollSpeedX=i[0])}else t.meshRender.material.secondScrollSpeedX=i[0]},n._getMeshRenderSharedMaterialSecondScrollSpeedY=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return t.meshRender.sharedMaterial.secondScrollSpeedY},n._setMeshRenderSharedMaterialSecondScrollSpeedY=function(e,t,i){if(e){var n=e.transform._entity;n&&(n.owner.meshRender.material.secondScrollSpeedY=i[0])}else t.meshRender.material.secondScrollSpeedY=i[0]},n._getMeshRenderSharedMaterialAlpha=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.alpha:0}return t.meshRender.sharedMaterial.alpha},n._setMeshRenderSharedMaterialAlpha=function(e,t,i){if(e){var n=e.transform._entity;n&&(n.owner.meshRender.material.alpha=i[0])}else t.meshRender.material.alpha=i[0]},n._getMeshRenderSharedMaterialIntensity=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.intensity:0}return t.meshRender.sharedMaterial.intensity},n._setMeshRenderSharedMaterialIntensity=function(e,t,i){if(e){var n=e.transform._entity;n&&(n.owner.meshRender.material.intensity=i[0])}else t.meshRender.material.intensity=i[0]},n._getMeshRenderSharedMaterialDetailTilingOffset=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return t.meshRender.sharedMaterial.detailTilingOffset.elements},n._setMeshRenderSharedMaterialDetailTilingOffset=function(e,t,i){var n,a;if(e){var r=e.transform._entity;r&&((a=(n=r.owner.meshRender.material).detailTilingOffset).elements=i,n.detailTilingOffset=a)}else(a=(n=t.meshRender.material).detailTilingOffset).elements=i,n.detailTilingOffset=a},n._getMeshRenderSharedMaterialDissolveTilingOffset=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return t.meshRender.sharedMaterial.dissolveTilingOffset.elements},n._setMeshRenderSharedMaterialDissolveTilingOffset=function(e,t,i){var n,a;if(e){var r=e.transform._entity;r&&((a=(n=r.owner.meshRender.material).dissolveTilingOffset).elements=i,n.dissolveTilingOffset=a)}else(a=(n=t.meshRender.material).dissolveTilingOffset).elements=i,n.dissolveTilingOffset=a},n._getMeshRenderSharedMaterialMaskTilingOffset=function(e,t){if(e){var i=e.transform._entity;return i?i.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return t.meshRender.sharedMaterial.maskTilingOffset.elements},n._setMeshRenderSharedMaterialMaskTilingOffset=function(e,t,i){var n,a;if(e){var r=e.transform._entity;r&&((a=(n=r.owner.meshRender.material).maskTilingOffset).elements=i,n.maskTilingOffset=a)}else(a=(n=t.meshRender.material).maskTilingOffset).elements=i,n.maskTilingOffset=a},n._propertyIDCounter=0,n._propertyIndexDic={},n._propertySetFuncs=[],n._propertyGetFuncs=[],n}(),G=(f(V,"laya.d3.animation.Keyframe"),V);function V(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}var z=(f(W,"laya.d3.animation.KeyframeNode"),W);function W(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}var X=function(){function e(){this._tempVector30=new ai,this._tempVector31=new ai,this._tempVector32=new ai,this._a=new ai,this._b=new ai,this._c=new ai,this._d=new ai}f(e,"laya.d3.core.glitter.SplineCurvePositionVelocity");var t=e.prototype;return t.Init=function(e,t,i,n){e.cloneTo(this._d),t.cloneTo(this._c),ai.scale(e,2,this._a),ai.scale(i,2,this._tempVector30),ai.subtract(this._a,this._tempVector30,this._a),ai.add(this._a,t,this._a),ai.add(this._a,n,this._a),ai.scale(i,3,this._b),ai.scale(e,3,this._tempVector30),ai.subtract(this._b,this._tempVector30,this._b),ai.subtract(this._b,n,this._b),ai.scale(t,2,this._tempVector30),ai.subtract(this._b,this._tempVector30,this._b)},t.Slerp=function(e,t){ai.scale(this._a,e*e*e,this._tempVector30),ai.scale(this._b,e*e,this._tempVector31),ai.scale(this._c,e,this._tempVector32),ai.add(this._tempVector30,this._tempVector31,t),ai.add(t,this._tempVector32,t),ai.add(t,this._d,t)},e}(),j=function(){function k(e,t,i,n){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=e,this._h=t,this._minHeight=i,this._maxHeight=n}f(k,"laya.d3.core.HeightMap");var e=k.prototype;return e._inBounds=function(e,t){return 0<=e&&e<this._h&&0<=t&&t<this._w},e.getHeight=function(e,t){return this._inBounds(e,t)?this._datas[e][t]:NaN},v(0,e,"width",function(){return this._w}),v(0,e,"height",function(){return this._h}),v(0,e,"maxHeight",function(){return this._maxHeight}),v(0,e,"minHeight",function(){return this._minHeight}),k.creatFromMesh=function(e,t,i,n){for(var a=[],r=[],s=e.getSubMeshCount(),o=0;o<s;o++){for(var l=e.getSubMesh(o),h=l._getVertexBuffer(),c=h.getData(),u=[],d=0;d<c.length;d+=h.vertexDeclaration.vertexStride/4){var _=new ai(c[d+0],c[d+1],c[d+2]);u.push(_)}a.push(u);var p=l._getIndexBuffer();r.push(p.getData())}var f=e.boundingBox,m=f.min.x,g=f.min.z,v=f.max.x,y=f.max.z,C=f.min.y,E=f.max.y,S=v-m,x=y-g,T=n.elements[0]=S/(t-1),w=n.elements[1]=x/(i-1),M=new k(t,i,C,E),b=k._tempRay,R=b.direction.elements;R[0]=0,R[1]=-1,R[2]=0;var L=E+.1;b.origin.elements[1]=L;for(var A=0;A<i;A++){var I=g+A*w;M._datas[A]=[];for(var D=0;D<t;D++){var P=m+D*T,N=b.origin.elements;N[0]=P,N[2]=I;var O=k._getPosition(b,a,r);M._datas[A][D]=O===Number.MAX_VALUE?NaN:L-O}}return M},k.createFromImage=function(e,t,i){for(var n=e.width,a=e.height,r=new k(n,a,t,i),s=(i-t)/254,o=e.getPixels(),l=0,h=0;h<a;h++)for(var c=r._datas[h]=[],u=0;u<n;u++){var d=o[l++],_=o[l++],p=o[l++],f=o[l++];c[u]=255==d&&255==_&&255==p&&255==f?NaN:(d+_+p)/3*s+t}return r},k._getPosition=function(e,t,i){for(var n=Number.MAX_VALUE,a=0;a<t.length;a++)for(var r=t[a],s=i[a],o=0;o<s.length;o+=3){var l=r[s[o+0]],h=r[s[o+1]],c=r[s[o+2]],u=Ti.rayIntersectsTriangle(e,l,h,c);!isNaN(u)&&u<n&&(n=u)}return n},u(k,["_tempRay",function(){return this._tempRay=new ti(new ai,new ai)}]),k}(),Y=function(){function a(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}f(a,"laya.d3.core.Layer");var e=a.prototype;return e._binarySearchIndex=function(){for(var e=0,t=a._collsionTestList.length-1,i=0;e<=t;){i=Math.floor((e+t)/2);var n=a._collsionTestList[i];if(n==this._number)return i;n>this._number?t=i-1:e=i+1}return e},e._addCollider=function(e){0===this._colliders.length&&a._collsionTestList.splice(this._binarySearchIndex(),0,this._number),e._isRigidbody?(this._colliders.unshift(e),this._nonRigidbodyOffset++):this._colliders.push(e)},e._removeCollider=function(e){var t=this._colliders.indexOf(e);t<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(t,1),0===this._colliders.length&&a._collsionTestList.splice(a._collsionTestList.indexOf(this._number),1)},v(0,e,"number",function(){return this._number}),v(0,e,"visible",function(){return this._visible},function(e){this._visible=e,a._visibleLayers=e?a._visibleLayers|this.mask:a._visibleLayers&~this.mask}),v(0,e,"mask",function(){return this._mask}),v(1,a,"visibleLayers",function(){return a._visibleLayers},function(e){a._visibleLayers=e;for(var t=0,i=a._layerList.length;t<i;t++){var n=a._layerList[t];n._visible=0!=(n._mask&a._visibleLayers)}}),a.__init__=function(){a._layerList.length=31;for(var e=0;e<31;e++){var t=new a;a._layerList[e]=t,0===e?(t.name="Default Layer",t.visible=!0):(t.name="Layer-"+e,t.visible=!1),t._number=e,t._mask=Math.pow(2,e)}a.currentCreationLayer=a._layerList[0]},a.getLayerByNumber=function(e){if(e<0||30<e)throw new Error("无法返回指定Layer，该number超出范围！");return a._layerList[e]},a.getLayerByName=function(e){for(var t=0;t<31;t++)if(a._layerList[t].name===e)return a._layerList[t];throw new Error("无法返回指定Layer,该name不存在")},a.isVisible=function(e){return 0!=(e&a._currentCameraCullingMask&a._visibleLayers)},a._layerList=[],a._visibleLayers=2147483647,a._collsionTestList=[],a._currentCameraCullingMask=2147483647,a.maxCount=31,a.currentCreationLayer=null,a}(),be=function(){function e(e,t,i){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=e,this._minCount=t,this._maxCount=i}f(e,"laya.d3.core.particleShuriKen.module.Burst");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(e){var t=e;t._time=this._time,t._minCount=this._minCount,t._maxCount=this._maxCount},t.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,t,"time",function(){return this._time}),v(0,t,"minCount",function(){return this._minCount}),v(0,t,"maxCount",function(){return this._maxCount}),e}(),Re=function(){function e(e){this._color=null,this.enbale=!1,this._color=e}f(e,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var t=e.prototype;return t.cloneTo=function(e){var t=e;this._color.cloneTo(t._color),t.enbale=this.enbale},t.clone=function(){var e;switch(this._color.type){case 0:e=Ie.createByConstant(this._color.constant.clone());break;case 1:e=Ie.createByGradient(this._color.gradient.clone());break;case 2:e=Ie.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:e=Ie.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var t=new this.constructor(e);return t.enbale=this.enbale,t},v(0,t,"color",function(){return this._color}),e}(),q=function(){function e(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}f(e,"laya.d3.core.particleShuriKen.module.Emission");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),t._destroy=function(){this._bursts=null,this._destroyed=!0},t.getBurstsCount=function(){return this._bursts.length},t.getBurstByIndex=function(e){return this._bursts[e]},t.addBurst=function(e){var t=this._bursts.length;if(0<t)for(var i=0;i<t;i++)this._bursts[i].time>e.time&&this._bursts.splice(i,0,e);this._bursts.push(e)},t.removeBurst=function(e){var t=this._bursts.indexOf(e);-1!==t&&this._bursts.splice(t,1)},t.removeBurstByIndex=function(e){this._bursts.splice(e,1)},t.clearBurst=function(){this._bursts.length=0},t.cloneTo=function(e){var t=e,i=t._bursts;i.length=this._bursts.length;for(var n=0,a=this._bursts.length;n<a;n++){var r=i[n];r?this._bursts[n].cloneTo(r):i[n]=this._bursts[n].clone()}t._emissionRate=this._emissionRate,t.enbale=this.enbale},t.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,t,"destroyed",function(){return this._destroyed}),v(0,t,"emissionRate",function(){return this._emissionRate},function(e){if(e<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=e}),e}(),Le=function(){function n(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}f(n,"laya.d3.core.particleShuriKen.module.FrameOverTime");var e=n.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(e){var t=e;t._type=this._type,t._constant=this._constant,this._overTime.cloneTo(t._overTime),t._constantMin=this._constantMin,t._constantMax=this._constantMax,this._overTimeMin.cloneTo(t._overTimeMin),this._overTimeMax.cloneTo(t._overTimeMax)},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,e,"frameOverTimeData",function(){return this._overTime}),v(0,e,"constant",function(){return this._constant}),v(0,e,"type",function(){return this._type}),v(0,e,"frameOverTimeDataMin",function(){return this._overTimeMin}),v(0,e,"constantMin",function(){return this._constantMin}),v(0,e,"frameOverTimeDataMax",function(){return this._overTimeMax}),v(0,e,"constantMax",function(){return this._constantMax}),n.createByConstant=function(e){var t=new n;return t._type=0,t._constant=e,t},n.createByOverTime=function(e){var t=new n;return t._type=1,t._overTime=e,t},n.createByRandomTwoConstant=function(e,t){var i=new n;return i._type=2,i._constantMin=e,i._constantMax=t,i},n.createByRandomTwoOverTime=function(e,t){var i=new n;return i._type=3,i._overTimeMin=e,i._overTimeMax=t,i},n}(),Ae=function(){function h(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}f(h,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var e=h.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(e){var t=e;t._type=this._type,t._separateAxes=this._separateAxes,t._constant=this._constant,this._constantSeparate.cloneTo(t._constantSeparate),this._gradient.cloneTo(t._gradient),this._gradientX.cloneTo(t._gradientX),this._gradientY.cloneTo(t._gradientY),this._gradientZ.cloneTo(t._gradientZ),t._constantMin=this._constantMin,t._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(t._constantMinSeparate),this._constantMaxSeparate.cloneTo(t._constantMaxSeparate),this._gradientMin.cloneTo(t._gradientMin),this._gradientMax.cloneTo(t._gradientMax),this._gradientXMin.cloneTo(t._gradientXMin),this._gradientXMax.cloneTo(t._gradientXMax),this._gradientYMin.cloneTo(t._gradientYMin),this._gradientYMax.cloneTo(t._gradientYMax),this._gradientZMin.cloneTo(t._gradientZMin),this._gradientZMax.cloneTo(t._gradientZMax)},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,e,"gradientZ",function(){return this._gradientZ}),v(0,e,"constant",function(){return this._constant}),v(0,e,"gradient",function(){return this._gradient}),v(0,e,"separateAxes",function(){return this._separateAxes}),v(0,e,"type",function(){return this._type}),v(0,e,"constantSeparate",function(){return this._constantSeparate}),v(0,e,"gradientX",function(){return this._gradientX}),v(0,e,"gradientY",function(){return this._gradientY}),v(0,e,"gradientW",function(){return this._gradientW}),v(0,e,"gradientMin",function(){return this._gradientMin}),v(0,e,"constantMin",function(){return this._constantMin}),v(0,e,"gradientMax",function(){return this._gradientMax}),v(0,e,"constantMax",function(){return this._constantMax}),v(0,e,"gradientWMin",function(){return this._gradientWMin}),v(0,e,"constantMinSeparate",function(){return this._constantMinSeparate}),v(0,e,"constantMaxSeparate",function(){return this._constantMaxSeparate}),v(0,e,"gradientXMin",function(){return this._gradientXMin}),v(0,e,"gradientXMax",function(){return this._gradientXMax}),v(0,e,"gradientWMax",function(){return this._gradientWMax}),v(0,e,"gradientYMin",function(){return this._gradientYMin}),v(0,e,"gradientYMax",function(){return this._gradientYMax}),v(0,e,"gradientZMin",function(){return this._gradientZMin}),v(0,e,"gradientZMax",function(){return this._gradientZMax}),h.createByConstant=function(e){var t=new h;return t._type=0,t._separateAxes=!1,t._constant=e,t},h.createByConstantSeparate=function(e){var t=new h;return t._type=0,t._separateAxes=!0,t._constantSeparate=e,t},h.createByGradient=function(e){var t=new h;return t._type=1,t._separateAxes=!1,t._gradient=e,t},h.createByGradientSeparate=function(e,t,i,n){var a=new h;return a._type=1,a._separateAxes=!0,a._gradientX=e,a._gradientY=t,a._gradientZ=i,a._gradientW=n,a},h.createByRandomTwoConstant=function(e,t){var i=new h;return i._type=2,i._separateAxes=!1,i._constantMin=e,i._constantMax=t,i},h.createByRandomTwoConstantSeparate=function(e,t){var i=new h;return i._type=2,i._separateAxes=!0,i._constantMinSeparate=e,i._constantMaxSeparate=t,i},h.createByRandomTwoGradient=function(e,t){var i=new h;return i._type=3,i._separateAxes=!1,i._gradientMin=e,i._gradientMax=t,i},h.createByRandomTwoGradientSeparate=function(e,t,i,n,a,r,s,o){var l=new h;return l._type=3,l._separateAxes=!0,l._gradientXMin=e,l._gradientXMax=t,l._gradientYMin=i,l._gradientYMax=n,l._gradientZMin=a,l._gradientZMax=r,l._gradientWMin=s,l._gradientWMax=o,l},h}(),Ie=function(){function n(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}f(n,"laya.d3.core.particleShuriKen.module.GradientColor");var e=n.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(e){var t=e;t._type=this._type,this._constant.cloneTo(t._constant),this._constantMin.cloneTo(t._constantMin),this._constantMax.cloneTo(t._constantMax),this._gradient.cloneTo(t._gradient),this._gradientMin.cloneTo(t._gradientMin),this._gradientMax.cloneTo(t._gradientMax)},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,e,"gradient",function(){return this._gradient}),v(0,e,"constant",function(){return this._constant}),v(0,e,"type",function(){return this._type}),v(0,e,"gradientMin",function(){return this._gradientMin}),v(0,e,"constantMin",function(){return this._constantMin}),v(0,e,"gradientMax",function(){return this._gradientMax}),v(0,e,"constantMax",function(){return this._constantMax}),n.createByConstant=function(e){var t=new n;return t._type=0,t._constant=e,t},n.createByGradient=function(e){var t=new n;return t._type=1,t._gradient=e,t},n.createByRandomTwoConstant=function(e,t){var i=new n;return i._type=2,i._constantMin=e,i._constantMax=t,i},n.createByRandomTwoGradient=function(e,t){var i=new n;return i._type=3,i._gradientMin=e,i._gradientMax=t,i},n}(),K=function(){function e(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}f(e,"laya.d3.core.particleShuriKen.module.GradientDataColor");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t.addAlpha=function(e,t){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==e&&(e=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),this._alphaElements[this._alphaCurrentLength++]=e,this._alphaElements[this._alphaCurrentLength++]=t):console.log("GradientDataColor warning:data count must lessEqual than 4")},t.addRGB=function(e,t){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==e&&(e=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),this._rgbElements[this._rgbCurrentLength++]=e,this._rgbElements[this._rgbCurrentLength++]=t.x,this._rgbElements[this._rgbCurrentLength++]=t.y,this._rgbElements[this._rgbCurrentLength++]=t.z):console.log("GradientDataColor warning:data count must lessEqual than 4")},t.cloneTo=function(e){var t=e,i=0,n=0;t._alphaCurrentLength=this._alphaCurrentLength;var a=t._alphaElements;for(a.length=this._alphaElements.length,i=0,n=this._alphaElements.length;i<n;i++)a[i]=this._alphaElements[i];t._rgbCurrentLength=this._rgbCurrentLength;var r=t._rgbElements;for(r.length=this._rgbElements.length,i=0,n=this._rgbElements.length;i<n;i++)r[i]=this._rgbElements[i]},t.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,t,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),v(0,t,"rgbGradientCount",function(){return this._rgbCurrentLength/4}),e}(),Z=function(){function e(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}f(e,"laya.d3.core.particleShuriKen.module.GradientDataInt");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t.add=function(e,t){this._currentLength<8?(6===this._currentLength&&1!==e&&(e=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=e,this._elements[this._currentLength++]=t):console.log("Warning:data count must lessEqual than 4")},t.cloneTo=function(e){var t=e;t._currentLength=this._currentLength;var i=t._elements;i.length=this._elements.length;for(var n=0,a=this._elements.length;n<a;n++)i[n]=this._elements[n]},t.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,t,"gradientCount",function(){return this._currentLength/2}),e}(),Q=function(){function e(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}f(e,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t.add=function(e,t){this._currentLength<8?(6===this._currentLength&&1!==e&&(e=1,console.log("GradientDataNumber warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=e,this._elements[this._currentLength++]=t):console.log("GradientDataNumber warning:data count must lessEqual than 4")},t.getKeyByIndex=function(e){return this._elements[2*e]},t.getValueByIndex=function(e){return this._elements[2*e+1]},t.getAverageValue=function(){for(var e=0,t=this._currentLength-2;e<t;e+=2){this._elements[e+1];this._elements[e+3],this._elements[e+2]-this._elements[e]}return 0},t.cloneTo=function(e){var t=e;t._currentLength=this._currentLength;var i=t._elements;i.length=this._elements.length;for(var n=0,a=this._elements.length;n<a;n++)i[n]=this._elements[n]},t.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,t,"gradientCount",function(){return this._currentLength/2}),e}(),De=(function(){function e(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}f(e,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var t=e.prototype;x.imps(t,{"laya.d3.core.IClone":!0}),t.add=function(e,t){this._currentLength<8?(6===this._currentLength&&1!==e&&(e=1,console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=e,this._elements[this._currentLength++]=t.x,this._elements[this._currentLength++]=t.y):console.log("GradientDataVector2 warning:data count must lessEqual than 4")},t.cloneTo=function(e){var t=e;t._currentLength=this._currentLength;var i=t._elements;i.length=this._elements.length;for(var n=0,a=this._elements.length;n<a;n++)i[n]=this._elements[n]},t.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,t,"gradientCount",function(){return this._currentLength/3})}(),function(){function o(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}f(o,"laya.d3.core.particleShuriKen.module.GradientSize");var e=o.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e.getMaxSizeInGradient=function(){var e=0,t=0,i=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(e=0,t=this._gradientX.gradientCount;e<t;e++)i=Math.max(i,this._gradientX.getValueByIndex(e));for(e=0,t=this._gradientY.gradientCount;e<t;e++)i=Math.max(i,this._gradientY.getValueByIndex(e))}else for(e=0,t=this._gradient.gradientCount;e<t;e++)i=Math.max(i,this._gradient.getValueByIndex(e));break;case 1:i=this._separateAxes?(i=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),i=Math.max(i,this._constantMinSeparate.y),Math.max(i,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(e=0,t=this._gradientXMin.gradientCount;e<t;e++)i=Math.max(i,this._gradientXMin.getValueByIndex(e));for(e=0,t=this._gradientXMax.gradientCount;e<t;e++)i=Math.max(i,this._gradientXMax.getValueByIndex(e));for(e=0,t=this._gradientYMin.gradientCount;e<t;e++)i=Math.max(i,this._gradientYMin.getValueByIndex(e));for(e=0,t=this._gradientZMax.gradientCount;e<t;e++)i=Math.max(i,this._gradientZMax.getValueByIndex(e))}else{for(e=0,t=this._gradientMin.gradientCount;e<t;e++)i=Math.max(i,this._gradientMin.getValueByIndex(e));for(e=0,t=this._gradientMax.gradientCount;e<t;e++)i=Math.max(i,this._gradientMax.getValueByIndex(e))}}return i},e.cloneTo=function(e){var t=e;t._type=this._type,t._separateAxes=this._separateAxes,this._gradient.cloneTo(t._gradient),this._gradientX.cloneTo(t._gradientX),this._gradientY.cloneTo(t._gradientY),this._gradientZ.cloneTo(t._gradientZ),t._constantMin=this._constantMin,t._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(t._constantMinSeparate),this._constantMaxSeparate.cloneTo(t._constantMaxSeparate),this._gradientMin.cloneTo(t._gradientMin),this._gradientMax.cloneTo(t._gradientMax),this._gradientXMin.cloneTo(t._gradientXMin),this._gradientXMax.cloneTo(t._gradientXMax),this._gradientYMin.cloneTo(t._gradientYMin),this._gradientYMax.cloneTo(t._gradientYMax),this._gradientZMin.cloneTo(t._gradientZMin),this._gradientZMax.cloneTo(t._gradientZMax)},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,e,"gradientZ",function(){return this._gradientZ}),v(0,e,"gradient",function(){return this._gradient}),v(0,e,"separateAxes",function(){return this._separateAxes}),v(0,e,"type",function(){return this._type}),v(0,e,"gradientMin",function(){return this._gradientMin}),v(0,e,"constantMin",function(){return this._constantMin}),v(0,e,"gradientX",function(){return this._gradientX}),v(0,e,"gradientY",function(){return this._gradientY}),v(0,e,"gradientMax",function(){return this._gradientMax}),v(0,e,"constantMax",function(){return this._constantMax}),v(0,e,"constantMinSeparate",function(){return this._constantMinSeparate}),v(0,e,"constantMaxSeparate",function(){return this._constantMaxSeparate}),v(0,e,"gradientXMin",function(){return this._gradientXMin}),v(0,e,"gradientXMax",function(){return this._gradientXMax}),v(0,e,"gradientYMin",function(){return this._gradientYMin}),v(0,e,"gradientYMax",function(){return this._gradientYMax}),v(0,e,"gradientZMin",function(){return this._gradientZMin}),v(0,e,"gradientZMax",function(){return this._gradientZMax}),o.createByGradient=function(e){var t=new o;return t._type=0,t._separateAxes=!1,t._gradient=e,t},o.createByGradientSeparate=function(e,t,i){var n=new o;return n._type=0,n._separateAxes=!0,n._gradientX=e,n._gradientY=t,n._gradientZ=i,n},o.createByRandomTwoConstant=function(e,t){var i=new o;return i._type=1,i._separateAxes=!1,i._constantMin=e,i._constantMax=t,i},o.createByRandomTwoConstantSeparate=function(e,t){var i=new o;return i._type=1,i._separateAxes=!0,i._constantMinSeparate=e,i._constantMaxSeparate=t,i},o.createByRandomTwoGradient=function(e,t){var i=new o;return i._type=2,i._separateAxes=!1,i._gradientMin=e,i._gradientMax=t,i},o.createByRandomTwoGradientSeparate=function(e,t,i,n,a,r){var s=new o;return s._type=2,s._separateAxes=!0,s._gradientXMin=e,s._gradientXMax=t,s._gradientYMin=i,s._gradientYMax=n,s._gradientZMin=a,s._gradientZMax=r,s},o}()),Pe=function(){function o(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}f(o,"laya.d3.core.particleShuriKen.module.GradientVelocity");var e=o.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(e){var t=e;t._type=this._type,this._constant.cloneTo(t._constant),this._gradientX.cloneTo(t._gradientX),this._gradientY.cloneTo(t._gradientY),this._gradientZ.cloneTo(t._gradientZ),this._constantMin.cloneTo(t._constantMin),this._constantMax.cloneTo(t._constantMax),this._gradientXMin.cloneTo(t._gradientXMin),this._gradientXMax.cloneTo(t._gradientXMax),this._gradientYMin.cloneTo(t._gradientYMin),this._gradientYMax.cloneTo(t._gradientYMax),this._gradientZMin.cloneTo(t._gradientZMin),this._gradientZMax.cloneTo(t._gradientZMax)},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,e,"gradientZ",function(){return this._gradientZ}),v(0,e,"constant",function(){return this._constant}),v(0,e,"type",function(){return this._type}),v(0,e,"gradientXMax",function(){return this._gradientXMax}),v(0,e,"constantMin",function(){return this._constantMin}),v(0,e,"gradientX",function(){return this._gradientX}),v(0,e,"gradientY",function(){return this._gradientY}),v(0,e,"gradientXMin",function(){return this._gradientXMin}),v(0,e,"constantMax",function(){return this._constantMax}),v(0,e,"gradientYMin",function(){return this._gradientYMin}),v(0,e,"gradientYMax",function(){return this._gradientYMax}),v(0,e,"gradientZMin",function(){return this._gradientZMin}),v(0,e,"gradientZMax",function(){return this._gradientZMax}),o.createByConstant=function(e){var t=new o;return t._type=0,t._constant=e,t},o.createByGradient=function(e,t,i){var n=new o;return n._type=1,n._gradientX=e,n._gradientY=t,n._gradientZ=i,n},o.createByRandomTwoConstant=function(e,t){var i=new o;return i._type=2,i._constantMin=e,i._constantMax=t,i},o.createByRandomTwoGradient=function(e,t,i,n,a,r){var s=new o;return s._type=3,s._gradientXMin=e,s._gradientXMax=t,s._gradientYMin=i,s._gradientYMax=n,s._gradientZMin=a,s._gradientZMax=r,s},o}(),Ne=function(){function e(e){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=e}f(e,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(e){var t=e;this._angularVelocity.cloneTo(t._angularVelocity),t.enbale=this.enbale},t.clone=function(){var e;switch(this._angularVelocity.type){case 0:e=this._angularVelocity.separateAxes?Ae.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):Ae.createByConstant(this._angularVelocity.constant);break;case 1:e=this._angularVelocity.separateAxes?Ae.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):Ae.createByGradient(this._angularVelocity.gradient.clone());break;case 2:e=this._angularVelocity.separateAxes?Ae.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):Ae.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:e=this._angularVelocity.separateAxes?Ae.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):Ae.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var t=new this.constructor(e);return t.enbale=this.enbale,t},v(0,t,"angularVelocity",function(){return this._angularVelocity}),e}(),$=function(){function e(){this.enable=!1,this.randomDirection=!1}f(e,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t._getShapeBoundBox=function(e){throw new Error("BaseShape: must override it.")},t._getSpeedBoundBox=function(e){throw new Error("BaseShape: must override it.")},t.generatePositionAndDirection=function(e,t,i,n){throw new Error("BaseShape: must override it.")},t._calculateProceduralBounds=function(e,t,i){this._getShapeBoundBox(e);var n=e.min,a=e.max;ai.multiply(n,t,n),ai.multiply(a,t,a);var r=new Ht(new ai,new ai);this.randomDirection?(r.min=new ai(-1,-1,-1),r.max=new ai(1,1,1)):this._getSpeedBoundBox(r);var s=new Ht(new ai,new ai),o=s.min,l=s.max;ai.scale(r.min,i.y,o),ai.scale(r.max,i.y,l),ai.add(e.min,o,o),ai.add(e.max,l,l),ai.min(e.min,o,e.min),ai.max(e.max,o,e.max);var h=new Ht(new ai,new ai),c=h.min,u=h.max;ai.scale(r.min,i.x,c),ai.scale(r.max,i.x,u),ai.min(h.min,u,o),ai.max(h.min,u,l),ai.min(e.min,o,e.min),ai.max(e.max,o,e.max)},t.cloneTo=function(e){e.enable=this.enable},t.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},e}(),J=(f(ee,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),ee._randomPointUnitArcCircle=function(e,t,i){var n=t.elements,a=NaN;a=i?i.getFloat()*e:Math.random()*e,n[0]=Math.cos(a),n[1]=Math.sin(a)},ee._randomPointInsideUnitArcCircle=function(e,t,i){var n=t.elements;ee._randomPointUnitArcCircle(e,t,i);var a=NaN;a=i?Math.pow(i.getFloat(),.5):Math.pow(Math.random(),.5),n[0]=n[0]*a,n[1]=n[1]*a},ee._randomPointUnitCircle=function(e,t){var i=e.elements,n=NaN;n=t?t.getFloat()*Math.PI*2:Math.random()*Math.PI*2,i[0]=Math.cos(n),i[1]=Math.sin(n)},ee._randomPointInsideUnitCircle=function(e,t){var i=e.elements;ee._randomPointUnitCircle(e);var n=NaN;n=t?Math.pow(t.getFloat(),.5):Math.pow(Math.random(),.5),i[0]=i[0]*n,i[1]=i[1]*n},ee._randomPointUnitSphere=function(e,t){var i=e.elements,n=NaN,a=NaN;a=t?(n=i[2]=2*t.getFloat()-1,t.getFloat()*Math.PI*2):(n=i[2]=2*Math.random()-1,Math.random()*Math.PI*2);var r=Math.sqrt(1-n*n);i[0]=r*Math.cos(a),i[1]=r*Math.sin(a)},ee._randomPointInsideUnitSphere=function(e,t){var i=e.elements;ee._randomPointUnitSphere(e);var n=NaN;n=t?Math.pow(t.getFloat(),1/3):Math.pow(Math.random(),1/3),i[0]=i[0]*n,i[1]=i[1]*n,i[2]=i[2]*n},ee._randomPointInsideHalfUnitBox=function(e,t){var i=e.elements;t?(i[0]=t.getFloat()-.5,i[1]=t.getFloat()-.5,i[2]=t.getFloat()-.5):(i[0]=Math.random()-.5,i[1]=Math.random()-.5,i[2]=Math.random()-.5)},ee);function ee(){}var Oe=function(){function e(e){this._size=null,this.enbale=!1,this._size=e}f(e,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(e){var t=e;this._size.cloneTo(t._size),t.enbale=this.enbale},t.clone=function(){var e;switch(this._size.type){case 0:e=this._size.separateAxes?De.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):De.createByGradient(this._size.gradient.clone());break;case 1:e=this._size.separateAxes?De.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):De.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:e=this._size.separateAxes?De.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):De.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var t=new this.constructor(e);return t.enbale=this.enbale,t},v(0,t,"size",function(){return this._size}),e}(),ke=function(){function n(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}f(n,"laya.d3.core.particleShuriKen.module.StartFrame");var e=n.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(e){var t=e;t._type=this._type,t._constant=this._constant,t._constantMin=this._constantMin,t._constantMax=this._constantMax},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,e,"constant",function(){return this._constant}),v(0,e,"type",function(){return this._type}),v(0,e,"constantMin",function(){return this._constantMin}),v(0,e,"constantMax",function(){return this._constantMax}),n.createByConstant=function(e){var t=new n;return t._type=0,t._constant=e,t},n.createByRandomTwoConstant=function(e,t){var i=new n;return i._type=1,i._constantMin=e,i._constantMax=t,i},n}(),Ve=function(){function e(e,t){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new ni(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=e,this._startFrame=t}f(e,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(e){var t=e;this.tiles.cloneTo(t.tiles),t.type=this.type,t.randomRow=this.randomRow,this._frame.cloneTo(t._frame),this._startFrame.cloneTo(t._startFrame),t.cycles=this.cycles,t.enableUVChannels=this.enableUVChannels,t.enable=this.enable},t.clone=function(){var e,t;switch(this._frame.type){case 0:e=Le.createByConstant(this._frame.constant);break;case 1:e=Le.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:e=Le.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:e=Le.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:t=ke.createByConstant(this._startFrame.constant);break;case 1:t=ke.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var i=new this.constructor(e,t);return this.tiles.cloneTo(i.tiles),i.type=this.type,i.randomRow=this.randomRow,i.cycles=this.cycles,i.enableUVChannels=this.enableUVChannels,i.enable=this.enable,i},v(0,t,"frame",function(){return this._frame}),v(0,t,"startFrame",function(){return this._startFrame}),e}(),Be=function(){function e(e){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=e}f(e,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(e){var t=e;this._velocity.cloneTo(t._velocity),t.enbale=this.enbale,t.space=this.space},t.clone=function(){var e;switch(this._velocity.type){case 0:e=Pe.createByConstant(this._velocity.constant.clone());break;case 1:e=Pe.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:e=Pe.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:e=Pe.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var t=new this.constructor(e);return t.enbale=this.enbale,t.space=this.space,t},v(0,t,"velocity",function(){return this._velocity}),e}(),te=(f(ie,"laya.d3.core.particleShuriKen.ShurikenParticleData"),ie._getStartLifetimeFromGradient=function(e,t){for(var i=1,n=e.gradientCount;i<n;i++){var a=e.getKeyByIndex(i);if(t<=a){var r=e.getKeyByIndex(i-1),s=(t-r)/(a-r);return F.lerp(e.getValueByIndex(i-1),e.getValueByIndex(i),s)}}throw new Error("ShurikenParticleData: can't get value foam startLifeTimeGradient.")},ie._randomInvertRoationArray=function(e,t,i,n,a){var r=NaN;n?(n.seed=a[6],r=n.getFloat(),a[6]=n.seed):r=Math.random(),r<i?(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2]):(t[0]=e[0],t[1]=e[1],t[2]=e[2])},ie._randomInvertRoation=function(e,t,i,n){var a=NaN;return i?(i.seed=n[6],a=i.getFloat(),n[6]=i.seed):a=Math.random(),a<t&&(e=-e),e},ie.create=function(e,t,i){var n=e.autoRandomSeed,a=e._rand,r=e._randomSeeds;switch(e.startColorType){case 0:var s=e.startColorConstant.elements;ie.startColor[0]=s[0],ie.startColor[1]=s[1],ie.startColor[2]=s[2],ie.startColor[3]=s[3];break;case 2:n?F.lerpVector4(e.startColorConstantMin.elements,e.startColorConstantMax.elements,Math.random(),ie.startColor):(a.seed=r[3],F.lerpVector4(e.startColorConstantMin.elements,e.startColorConstantMax.elements,a.getFloat(),ie.startColor),r[3]=a.seed)}var o=e.colorOverLifetime;if(o&&o.enbale){var l=o.color;switch(l.type){case 0:ie.startColor[0]=ie.startColor[0]*l.constant.x,ie.startColor[1]=ie.startColor[1]*l.constant.y,ie.startColor[2]=ie.startColor[2]*l.constant.z,ie.startColor[3]=ie.startColor[3]*l.constant.w;break;case 2:var h=NaN;n?h=Math.random():(a.seed=r[10],h=a.getFloat(),r[10]=a.seed);var c=l.constantMin,u=l.constantMax;ie.startColor[0]=ie.startColor[0]*F.lerp(c.x,u.x,h),ie.startColor[1]=ie.startColor[1]*F.lerp(c.y,u.y,h),ie.startColor[2]=ie.startColor[2]*F.lerp(c.z,u.z,h),ie.startColor[3]=ie.startColor[3]*F.lerp(c.w,u.w,h)}}var d=ie.startSize;switch(e.startSizeType){case 0:if(e.threeDStartSize){var _=e.startSizeConstantSeparate;d[0]=_.x,d[1]=_.y,d[2]=_.z}else d[0]=d[1]=d[2]=e.startSizeConstant;break;case 2:if(e.threeDStartSize){var p=e.startSizeConstantMinSeparate,f=e.startSizeConstantMaxSeparate;n?(d[0]=F.lerp(p.x,f.x,Math.random()),d[1]=F.lerp(p.y,f.y,Math.random()),d[2]=F.lerp(p.z,f.z,Math.random())):(a.seed=r[4],d[0]=F.lerp(p.x,f.x,a.getFloat()),d[1]=F.lerp(p.y,f.y,a.getFloat()),d[2]=F.lerp(p.z,f.z,a.getFloat()),r[4]=a.seed)}else n?d[0]=d[1]=d[2]=F.lerp(e.startSizeConstantMin,e.startSizeConstantMax,Math.random()):(a.seed=r[4],d[0]=d[1]=d[2]=F.lerp(e.startSizeConstantMin,e.startSizeConstantMax,a.getFloat()),r[4]=a.seed)}var m=e.sizeOverLifetime;if(m&&m.enbale&&1===m.size.type){var g=m.size;if(g.separateAxes)n?(d[0]=d[0]*F.lerp(g.constantMinSeparate.x,g.constantMaxSeparate.x,Math.random()),d[1]=d[1]*F.lerp(g.constantMinSeparate.y,g.constantMaxSeparate.y,Math.random()),d[2]=d[2]*F.lerp(g.constantMinSeparate.z,g.constantMaxSeparate.z,Math.random())):(a.seed=r[11],d[0]=d[0]*F.lerp(g.constantMinSeparate.x,g.constantMaxSeparate.x,a.getFloat()),d[1]=d[1]*F.lerp(g.constantMinSeparate.y,g.constantMaxSeparate.y,a.getFloat()),d[2]=d[2]*F.lerp(g.constantMinSeparate.z,g.constantMaxSeparate.z,a.getFloat()),r[11]=a.seed);else{var v=NaN;n?v=F.lerp(g.constantMin,g.constantMax,Math.random()):(a.seed=r[11],v=F.lerp(g.constantMin,g.constantMax,a.getFloat()),r[11]=a.seed),d[0]=d[0]*v,d[1]=d[1]*v,d[2]=d[2]*v}}var y=t.renderMode;if(1!==y)switch(e.startRotationType){case 0:if(e.threeDStartRotation){var C=e.startRotationConstantSeparate,E=ie._tempVector30.elements;ie._randomInvertRoationArray(C.elements,E,e.randomizeRotationDirection,n?null:a,r),ie.startRotation[0]=E[0],ie.startRotation[1]=E[1],ie.startRotation[2]=4!==y?-E[2]:E[2]}else ie.startRotation[0]=ie._randomInvertRoation(e.startRotationConstant,e.randomizeRotationDirection,n?null:a,r);break;case 2:if(e.threeDStartRotation){var S=e.startRotationConstantMinSeparate,x=e.startRotationConstantMaxSeparate,T=ie._tempVector30.elements;n?(T[0]=F.lerp(S.x,x.x,Math.random()),T[1]=F.lerp(S.y,x.y,Math.random()),T[2]=F.lerp(S.z,x.z,Math.random())):(a.seed=r[5],T[0]=F.lerp(S.x,x.x,a.getFloat()),T[1]=F.lerp(S.y,x.y,a.getFloat()),T[2]=F.lerp(S.z,x.z,a.getFloat()),r[5]=a.seed),ie._randomInvertRoationArray(T,T,e.randomizeRotationDirection,n?null:a,r),ie.startRotation[0]=T[0],ie.startRotation[1]=T[1],ie.startRotation[2]=4!==y?-T[2]:T[2]}else n?ie.startRotation[0]=ie._randomInvertRoation(F.lerp(e.startRotationConstantMin,e.startRotationConstantMax,Math.random()),e.randomizeRotationDirection,n?null:a,r):(a.seed=r[5],ie.startRotation[0]=ie._randomInvertRoation(F.lerp(e.startRotationConstantMin,e.startRotationConstantMax,a.getFloat()),e.randomizeRotationDirection,n?null:a,r),r[5]=a.seed)}switch(e.startLifetimeType){case 0:ie.startLifeTime=e.startLifetimeConstant;break;case 1:ie.startLifeTime=ie._getStartLifetimeFromGradient(e.startLifeTimeGradient,e.emissionTime);break;case 2:n?ie.startLifeTime=F.lerp(e.startLifetimeConstantMin,e.startLifetimeConstantMax,Math.random()):(a.seed=r[7],ie.startLifeTime=F.lerp(e.startLifetimeConstantMin,e.startLifetimeConstantMax,a.getFloat()),r[7]=a.seed);break;case 3:var w=e.emissionTime;n?ie.startLifeTime=F.lerp(ie._getStartLifetimeFromGradient(e.startLifeTimeGradientMin,w),ie._getStartLifetimeFromGradient(e.startLifeTimeGradientMax,w),Math.random()):(a.seed=r[7],ie.startLifeTime=F.lerp(ie._getStartLifetimeFromGradient(e.startLifeTimeGradientMin,w),ie._getStartLifetimeFromGradient(e.startLifeTimeGradientMax,w),a.getFloat()),r[7]=a.seed)}switch(e.startSpeedType){case 0:ie.startSpeed=e.startSpeedConstant;break;case 2:n?ie.startSpeed=F.lerp(e.startSpeedConstantMin,e.startSpeedConstantMax,Math.random()):(a.seed=r[8],ie.startSpeed=F.lerp(e.startSpeedConstantMin,e.startSpeedConstantMax,a.getFloat()),r[8]=a.seed)}var M=e.textureSheetAnimation;if(M&&M.enable){var b=M.tiles,R=b.x,L=b.y,A=1/R,I=1/L,D=0,P=M.startFrame;switch(P.type){case 0:D=P.constant;break;case 1:n?D=F.lerp(P.constantMin,P.constantMax,Math.random()):(a.seed=r[14],D=F.lerp(P.constantMin,P.constantMax,a.getFloat()),r[14]=a.seed)}var N=M.frame;switch(N.type){case 0:D+=N.constant;break;case 2:n?D+=F.lerp(N.constantMin,N.constantMax,Math.random()):(a.seed=r[15],D+=F.lerp(N.constantMin,N.constantMax,a.getFloat()),r[15]=a.seed)}var O=0;switch(M.type){case 0:O=Math.floor(D/R);break;case 1:M.randomRow?n?O=Math.floor(Math.random()*L):(a.seed=r[13],O=Math.floor(a.getFloat()*L),r[13]=a.seed):O=M.rowIndex}var k=Math.floor(D%R);(ie.startUVInfo=ie.startUVInfo)[0]=A,ie.startUVInfo[1]=I,ie.startUVInfo[2]=k*A,ie.startUVInfo[3]=O*I}else(ie.startUVInfo=ie.startUVInfo)[0]=1,ie.startUVInfo[1]=1,ie.startUVInfo[2]=0,ie.startUVInfo[3]=0;switch(e.simulationSpace){case 0:var V=i.position.elements;ie.simulationWorldPostion[0]=V[0],ie.simulationWorldPostion[1]=V[1],ie.simulationWorldPostion[2]=V[2];var B=i.rotation.elements;ie.simulationWorldRotation[0]=B[0],ie.simulationWorldRotation[1]=B[1],ie.simulationWorldRotation[2]=B[2],ie.simulationWorldRotation[3]=B[3];break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}},ie.startLifeTime=NaN,ie.startSpeed=NaN,u(ie,["_tempVector30",function(){return this._tempVector30=new ai},"_tempQuaternion",function(){return this._tempQuaternion=new Jt},"startColor",function(){return this.startColor=new Float32Array(4)},"startSize",function(){return this.startSize=new Float32Array(3)},"startRotation",function(){return this.startRotation=new Float32Array(3)},"startUVInfo",function(){return this.startUVInfo=new Float32Array(4)},"simulationWorldPostion",function(){return this.simulationWorldPostion=new Float32Array(3)},"simulationWorldRotation",function(){return this.simulationWorldRotation=new Float32Array(4)}]),ie);function ie(){}var ne=function(){function e(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new _i,this._vb=On.create(e._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=Nn.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=Tn.nameKey.getID("LINE"),this._shaderCompile=Yi._preCompileShader[this._sharderNameID]}f(e,"laya.d3.core.PhasorSpriter3D");var t=e.prototype;return t.line=function(e,t,i,n){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(e.x,e.y,e.z,t.x,t.y,t.z,t.w),this.addVertex(i.x,i.y,i.z,n.x,n.y,n.z,n.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},t.circle=function(e,t,i,n,a,r){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*t,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/t,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*e,Math.cos(this._tempNumver0)*e,0,i,n,a,r),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},t.plane=function(e,t,i,n,a,r,s,o,l){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=n/2,this._tempNumver1=a/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(e-this._tempNumver0,t+this._tempNumver1,i,r,s,o,l),this.addVertex(e+this._tempNumver0,t+this._tempNumver1,i,r,s,o,l),this.addVertex(e-this._tempNumver0,t-this._tempNumver1,i,r,s,o,l),this.addVertex(e+this._tempNumver0,t-this._tempNumver1,i,r,s,o,l),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},t.box=function(e,t,i,n,a,r,s,o,l,h){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=n/2,this._tempNumver1=a/2,this._tempNumver2=r/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(e-this._tempNumver0,t+this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(e+this._tempNumver0,t+this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(e-this._tempNumver0,t-this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(e+this._tempNumver0,t-this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(e+this._tempNumver0,t+this._tempNumver1,i-this._tempNumver2,s,o,l,h),this.addVertex(e-this._tempNumver0,t+this._tempNumver1,i-this._tempNumver2,s,o,l,h),this.addVertex(e+this._tempNumver0,t-this._tempNumver1,i-this._tempNumver2,s,o,l,h),this.addVertex(e-this._tempNumver0,t-this._tempNumver1,i-this._tempNumver2,s,o,l,h),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},t.cone=function(e,t,i,n,a,r,s){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*i+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*i>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/i,this.addVertexIndex(0,t,0,n,a,r,s,this._tempUint0),this.addVertexIndex(0,0,0,n,a,r,s,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<i;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(e*this._tempNumver2,0,e*this._tempNumver3,n,a,r,s,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==i-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(e*this._tempNumver2,0,e*this._tempNumver3,n,a,r,s,this._tempUint0+(this._tempInt0+i)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==i-1?this.addIndexes(this._tempUint1+i+2):this.addIndexes(this._tempUint1+this._tempInt0+i+1),this.addIndexes(this._tempUint1+this._tempInt0+i),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},t.boundingBoxLine=function(e,t,i,n,a,r,s,o,l,h){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(e,a,r,s,o,l,h),this.addVertex(n,a,r,s,o,l,h),this.addVertex(e,t,r,s,o,l,h),this.addVertex(n,t,r,s,o,l,h),this.addVertex(n,a,i,s,o,l,h),this.addVertex(e,a,i,s,o,l,h),this.addVertex(n,t,i,s,o,l,h),this.addVertex(e,t,i,s,o,l,h),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},t.addVertex=function(e,t,i,n,a,r,s){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=e,this._vbData[this._posInVBData+1]=t,this._vbData[this._posInVBData+2]=i,this._vbData[this._posInVBData+3]=n,this._vbData[this._posInVBData+4]=a,this._vbData[this._posInVBData+5]=r,this._vbData[this._posInVBData+6]=s,this._posInVBData+=this._floatSizePerVer,this},t.addVertexIndex=function(e,t,i,n,a,r,s,o){return this._hasBegun||this.addVertexIndexException(),this._vbData[o]=e,this._vbData[o+1]=t,this._vbData[o+2]=i,this._vbData[o+3]=n,this._vbData[o+4]=a,this._vbData[o+5]=r,this._vbData[o+6]=s,(o+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=o),this},t.addIndexes=function(e){var t=arguments;this._hasBegun||this.addVertexIndexException();for(var i=0;i<t.length;i++)this._ibData[this._posInIBData]=t[i],this._posInIBData++;return this},t.begin=function(e,t){return this._hasBegun&&this.beginException0(),1!==e&&4!==e&&this.beginException1(),this._primitiveType=e,this._camera=t,this._hasBegun=!0,this},t.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},t.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(e._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),w.drawCall++,I.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},t.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},t.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},t.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},t.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},t.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},t.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(28,[new Ue(0,"vector3",0),new Ue(12,"vector4",1)])}]),e}(),ae=function(){function e(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++e._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new _i}f(e,"laya.d3.core.render.RenderElement");var t=e.prototype;return t.getDynamicBatchBakedVertexs=function(e){for(var t=this._renderObj._getVertexBuffer(e),i=t.getData().slice(),n=t.vertexDeclaration,a=n.getVertexElementByUsage(0).offset/4,r=n.getVertexElementByUsage(3).offset/4,s=this._sprite3D.transform,o=s.worldMatrix,l=s.rotation,h=n.vertexStride/4,c=0,u=i.length;c<u;c+=h){var d=c+a,_=c+r;Li.transformVector3ArrayToVector3ArrayCoordinate(i,d,o,i,d),Li.transformVector3ArrayByQuat(i,_,l,i,_)}return i},t.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},t._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},v(0,t,"id",function(){return this._id}),v(0,t,"renderObj",function(){return this._renderObj},function(e){this._renderObj!==e&&(this._renderObj=e)}),e._uniqueIDCounter=0,e}(),re=function(){function t(e){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++t._uniqueIDCounter,this._needSort=!1,this._scene=e,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[]}f(t,"laya.d3.core.render.RenderQueue");var e=t.prototype;return e._sortOpaqueFunc=function(e,t){if(e._render&&t._render){var i=e._material.renderQueue-t._material.renderQueue;return 0==i?e._render._distanceForSort-t._render._distanceForSort:i}return 0},e._sortAlphaFunc=function(e,t){if(e._render&&t._render){var i=e._material.renderQueue-t._material.renderQueue;return 0==i?t._render._distanceForSort-e._render._distanceForSort:i}return 0},e._begainRenderElement=function(e,t,i){return!!t._beforeRender(e)},e._sortAlpha=function(e){t._cameraPosition=e,this._finalElements.sort(this._sortAlphaFunc)},e._sortOpaque=function(e){t._cameraPosition=e,this._finalElements.sort(this._sortOpaqueFunc)},e._preRender=function(e){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},e._render=function(e,t){for(var i,n,a,r,s,o,l=w.loopCount,h=this._scene,c=e.camera,u=(c.id,!1),d=0,_=this._finalElements.length;d<_;d++){var p,f,m,g=this._finalElements[d];if(null!=g._onPreRenderFunction&&g._onPreRenderFunction.call(g._sprite3D,e),0===g._type){if(e.owner=m=g._sprite3D,e.renderElement=g,m._preRenderUpdateComponents(e),p=g.renderObj,f=g._material,this._begainRenderElement(e,p,f)){if(i=p._getVertexBuffers(),a=(n=p._getVertexBuffer(0)).vertexDeclaration,u=(r=e._shader=f._getShader(h._shaderDefineValue,a.shaderDefineValue,m._shaderDefineValue)).bind()||l!==r._uploadLoopCount,i){if(r._uploadVertexBuffer!==i||u){for(var v=0;v<i.length;v++){var y=i[v];r.uploadAttributesX(y.vertexDeclaration.shaderValues.data,y)}r._uploadVertexBuffer=i}}else r._uploadVertexBuffer===n&&!u||(r.uploadAttributes(a.shaderValues.data,null),r._uploadVertexBuffer=n);r._uploadScene===h&&!u||(r.uploadSceneUniforms(h._shaderValues.data),r._uploadScene=h),c===r._uploadCamera&&r._uploadSprite3D===m&&!u||(r.uploadSpriteUniforms(m._shaderValues.data),r._uploadSprite3D=m),c===r._uploadCamera&&!u||(r.uploadCameraUniforms(c._shaderValues.data),r._uploadCamera=c),r._uploadMaterial===f&&!u||(f._upload(),r._uploadMaterial=f),s!==f?(f._setRenderStateBlendDepth(),f._setRenderStateFrontFace(t,m.transform),s=f,o=m):o!==m&&(f._setRenderStateFrontFace(t,m.transform),o=m),p._render(e),r._uploadLoopCount=l}m._postRenderUpdateComponents(e)}else if(2===g._type){g.renderObj;e.owner=m=g._sprite3D,e.renderElement=g,e._batchIndexStart=g._tempBatchIndexStart,e._batchIndexEnd=g._tempBatchIndexEnd,p=g.renderObj,f=g._material,this._begainRenderElement(e,p,f)&&(a=(n=p._getVertexBuffer(0)).vertexDeclaration,u=(r=e._shader=f._getShader(h._shaderDefineValue,a.shaderDefineValue,m._shaderDefineValue)).bind()||l!==r._uploadLoopCount,r._uploadVertexBuffer===n&&!u||(r.uploadAttributes(a.shaderValues.data,null),r._uploadVertexBuffer=n),r._uploadScene===h&&!u||(r.uploadSceneUniforms(h._shaderValues.data),r._uploadScene=h),c===r._uploadCamera&&r._uploadSprite3D===m&&!u||(r.uploadSpriteUniforms(m._shaderValues.data),r._uploadSprite3D=m),c===r._uploadCamera&&!u||(r.uploadCameraUniforms(c._shaderValues.data),r._uploadCamera=c),r._uploadMaterial===f&&!u||(f._upload(),r._uploadMaterial=f),s!==f?(f._setRenderStateBlendDepth(),f._setRenderStateFrontFace(t,m.transform),s=f,o=m):o!==m&&(f._setRenderStateFrontFace(t,m.transform),o=m),p._render(e),r._uploadLoopCount=l)}}},e._renderShadow=function(e,t){for(var i,n,a,r,s,o=w.loopCount,l=this._scene,h=e.camera,c=!1,u=0,d=this._finalElements.length;u<d;u++){var _,p,f,m=this._finalElements[u];0===m._type&&(e.owner=f=m._sprite3D,t||f._projectionViewWorldUpdateCamera===h&&f._projectionViewWorldUpdateLoopCount===w.loopCount||(f._render._renderUpdate(e._projectionViewMatrix),f._projectionViewWorldUpdateLoopCount=w.loopCount,f._projectionViewWorldUpdateCamera=h),e.renderElement=m,f._preRenderUpdateComponents(e),_=m.renderObj,p=m._material,this._begainRenderElement(e,_,null)&&(n=(i=_._getVertexBuffer(0)).vertexDeclaration,c=(a=e._shader=p._getShader(l._shaderDefineValue,n.shaderDefineValue,f._shaderDefineValue)).bind()||o!==a._uploadLoopCount,a._uploadVertexBuffer===i&&!c||(a.uploadAttributes(n.shaderValues.data,null),a._uploadVertexBuffer=i),h===a._uploadCamera&&a._uploadSprite3D===f&&!c||(a.uploadSpriteUniforms(f._shaderValues.data),a._uploadSprite3D=f),h===a._uploadCamera&&!c||(a.uploadCameraUniforms(h._shaderValues.data),a._uploadCamera=h),a._uploadMaterial===p&&!c||(p._upload(),a._uploadMaterial=p),a._uploadRenderElement,r!==p?(p._setRenderStateFrontFace(!1,f.transform),r=p,s=f):s!==f&&(p._setRenderStateFrontFace(!1,f.transform),s=f),_._render(e),a._uploadLoopCount=o),f._postRenderUpdateComponents(e))}},e._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},e._addRenderElement=function(e){this._renderElements.push(e),this._needSort=!0},e._addDynamicBatchElement=function(e){this._dynamicBatchCombineRenderElements.push(e)},v(0,e,"id",function(){return this._id}),t._uniqueIDCounter=0,t._cameraPosition=null,t}(),se=(f(oe,"laya.d3.core.render.RenderState"),oe.clientWidth=0,oe.clientHeight=0,oe);function oe(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}var le=function(){function s(e,t){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new Gt(new ai,0),this._corners=[new ai,new ai,new ai,new ai,new ai,new ai,new ai,new ai],this._boundingBoxCenter=new ai,this._children=T(8),this._objects=[],this._tempBoundBoxCorners=[new ai,new ai,new ai,new ai,new ai,new ai,new ai,new ai],this._scene=e,this._currentDepth=t}f(s,"laya.d3.core.scene.OctreeNode");var e=s.prototype;return x.imps(e,{"laya.d3.core.scene.ITreeNode":!0}),e.init=function(e,t){var i=new ai,n=new ai;ai.scale(t,-.5,i),ai.scale(t,.5,n),ai.add(i,e,i),ai.add(n,e,n),this.exactBox=new Ht(i,n),this.relaxBox=new Ht(i,n)},e.addTreeNode=function(e){1===zt.boxContainsBox(this._relaxBox,e.boundingBox)?this.addNodeDown(e,0):this.addObject(e)},e.addChild=function(e){var t=this._children[e];if(null==t){t=new s(this._scene,this._currentDepth+1),(this._children[e]=t)._parent=this,ai.subtract(this._exactBox.max,this._exactBox.min,s.tempSize),ai.multiply(s.tempSize,s._octreeSplit[e],s.tempCenter),ai.add(this._exactBox.min,s.tempCenter,s.tempCenter),ai.scale(s.tempSize,.25,s.tempSize);var i=new ai,n=new ai;ai.subtract(s.tempCenter,s.tempSize,i),ai.add(s.tempCenter,s.tempSize,n),t.exactBox=new Ht(i,n),ai.scale(s.tempSize,s.relax,s.tempSize);var a=new ai,r=new ai;ai.subtract(s.tempCenter,s.tempSize,a),ai.add(s.tempCenter,s.tempSize,r),t.relaxBox=new Ht(a,r)}return t},e.addObject=function(e){(e._treeNode=this)._objects.push(e)},e.removeObject=function(e){if(e._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var t=this._objects.indexOf(e);return-1!==t&&(this._objects.splice(t,1),!0)},e.clearObject=function(){this._objects.length=0},e.addNodeUp=function(e,t){this._parent&&1!==zt.boxContainsBox(this._exactBox,e.boundingBox)?this._parent.addNodeUp(e,t-1):this.addNodeDown(e,t)},e.addNodeDown=function(e,t){if(t<this._scene.treeLevel){var i=this.inChildIndex(e.boundingBoxCenter),n=this.addChild(i);1===zt.boxContainsBox(n._relaxBox,e.boundingBox)?n.addNodeDown(e,++t):this.addObject(e)}else this.addObject(e)},e.inChildIndex=function(e){return 4*(e.z<this._boundingBoxCenter.z?0:1)+2*(e.y<this._boundingBoxCenter.y?0:1)+(e.x<this._boundingBoxCenter.x?0:1)},e.updateObject=function(e){1===zt.boxContainsBox(this._relaxBox,e.boundingBox)?(this.removeObject(e),e._treeNode=null,this.addNodeDown(e,this._currentDepth)):this._parent&&(this.removeObject(e),e._treeNode=null,this._parent.addNodeUp(e,this._currentDepth-1))},e.cullingObjects=function(e,t,i,n,a){var r,s=0,o=0,l=0,h=this._scene._dynamicBatchManager;for(s=0,r=this._objects.length;s<r;s++){var c=this._objects[s];if(Y.isVisible(c._owner.layer.mask)&&c.enable){if(t&&(w.treeSpriteCollision+=1,0===e.containsBoundSphere(c.boundingSphere)))continue;c._renderUpdate(a),c._distanceForSort=ai.distance(c.boundingSphere.center,n)+c.sortingFudge;var u=c._renderElements;for(o=0,l=u.length;o<l;o++){var d=u[o],_=d._staticBatch;if(_&&_._material===d._material)_._addBatchRenderElement(d);else{var p=d.renderObj;p.triangleCount<10&&1===p._vertexBufferCount&&p._getIndexBuffer()&&d._material.renderQueue<2&&d._canDynamicBatch&&!c._owner.isStatic?h._addPrepareRenderElement(d):this._scene.getRenderQueue(d._material.renderQueue)._addRenderElement(d)}}}}for(s=0;s<8;s++){var f=this._children[s];if(null!=f){var m=t;if(t){var g=e.containsBoundBox(f._relaxBox);if(w.treeNodeCollision+=1,0===g)continue;m=2===g}f.cullingObjects(e,m,i,n,a)}}},e.cullingShadowObjects=function(e,t,i,n,a){var r,s=0,o=0,l=0;this._scene._dynamicBatchManager;for(s=0,r=this._objects.length;s<r;s++){var h=this._objects[s];if(h.castShadow&&Y.isVisible(h._owner.layer.mask)&&h.enable){if(i&&0===e[0].containsBoundSphere(h.boundingSphere))continue;for(var c=1,u=e.length;c<u;c++){var d=t[c-1];if(0!==e[c].containsBoundSphere(h.boundingSphere)){var _=h._renderElements;for(o=0,l=_.length;o<l;o++)d._addRenderElement(_[o])}}}}for(s=0;s<8;s++){var p=this._children[s];if(null!=p){var f=i;if(i){var m=e[0].containsBoundBox(p._relaxBox);if(0===m)continue;f=2===m}p.cullingShadowObjects(e,t,f,n,a)}}},e.cullingShadowObjectsOnePSSM=function(e,t,i,n,a,r){var s,o=t[0],l=0,h=0,c=0;for(l=0,s=this._objects.length;l<s;l++){var u=this._objects[l];if(u.castShadow&&Y.isVisible(u._owner.layer.mask)&&u.enable){if(n&&0===e.containsBoundSphere(u.boundingSphere))continue;u._renderUpdate(i);var d=u._renderElements;for(h=0,c=d.length;h<c;h++)o._addRenderElement(d[h])}}for(l=0;l<8;l++){var _=this._children[l];if(null!=_){var p=n;if(n){var f=e.containsBoundBox(_._relaxBox);if(0===f)continue;p=2===f}_.cullingShadowObjectsOnePSSM(e,t,i,p,a,r)}}},e.renderBoudingBox=function(e){this._renderBoudingBox(e);for(var t=0;t<8;++t){var i=this._children[t];i&&i.renderBoudingBox(e)}},e.buildAllChild=function(e){if(e<this._scene.treeLevel)for(var t=0;t<8;t++){this.addChild(t).buildAllChild(e+1)}},e._renderBoudingBox=function(e){},v(0,e,"exactBox",function(){return this._exactBox},function(e){this._exactBox=e,ai.add(e.min,e.max,this._boundingBoxCenter),ai.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),v(0,e,"relaxBox",function(){return this._relaxBox},function(e){(this._relaxBox=e).getCorners(this._corners),Gt.createfromPoints(this._corners,this._boundingSphere)}),s.debugMode=!1,s.relax=1.15,s.CHILDNUM=8,u(s,["tempVector0",function(){return this.tempVector0=new ai},"tempSize",function(){return this.tempSize=new ai},"tempCenter",function(){return this.tempCenter=new ai},"_octreeSplit",function(){return this._octreeSplit=[new ai(.25,.25,.25),new ai(.75,.25,.25),new ai(.25,.75,.25),new ai(.75,.75,.25),new ai(.25,.25,.75),new ai(.75,.25,.75),new ai(.25,.75,.75),new ai(.75,.75,.75)]}]),s}();f(he,"laya.d3.core.scene.SceneManager");function he(){}var ce=(f(ue,"laya.d3.core.trail.module.Color",null,"Color$1"),ue.prototype.cloneTo=function(e){e._r=this._r,e._g=this._g,e._b=this._b,e._a=this._a},u(ue,["RED",function(){return this.RED=new ue(1,0,0,1)},"GREEN",function(){return this.GREEN=new ue(0,1,0,1)},"BLUE",function(){return this.BLUE=new ue(0,0,1,1)},"CYAN",function(){return this.CYAN=new ue(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new ue(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new ue(1,0,1,1)},"GRAY",function(){return this.GRAY=new ue(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new ue(1,1,1,1)},"BLACK",function(){return this.BLACK=new ue(0,0,0,1)}]),ue);function ue(e,t,i,n){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===e&&(e=1),void 0===t&&(t=1),void 0===i&&(i=1),void 0===n&&(n=1),this._r=e,this._g=t,this._b=i,this._a=n}var de=function(){function e(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}f(e,"laya.d3.core.trail.module.Gradient");var t=e.prototype;return t.setKeys=function(e,t){var i,n;this._colorKeys=e;for(var a=this.index=0;a<e.length;a++){var r=(i=e[a]).color;this._colorKeyData[this.index++]=r._r,this._colorKeyData[this.index++]=r._g,this._colorKeyData[this.index++]=r._b,this._colorKeyData[this.index++]=i.time}this._alphaKeys=t;for(var s=this.index=0;s<t.length;s++)n=t[s],this._alphaKeyData[this.index++]=n.alpha,this._alphaKeyData[this.index++]=n.time},t.cloneTo=function(e){var t=0,i=0,n=this.colorKeys,a=[];for(t=0,i=n.length;t<i;t++){var r=new pe;n[t].cloneTo(r),a.push(r)}var s=this.alphaKeys,o=[];for(t=0,i=s.length;t<i;t++){var l=new _e;s[t].cloneTo(l),o.push(l)}e.setKeys(a,o)},v(0,t,"mode",function(){return this._mode},function(e){this._mode=e}),v(0,t,"colorKeys",function(){return this._colorKeys},function(e){this._colorKeys=e;for(var t=this.index=0;t<e.length;t++){var i=e[t],n=i.color;this._colorKeyData[this.index++]=n._r,this._colorKeyData[this.index++]=n._g,this._colorKeyData[this.index++]=n._b,this._colorKeyData[this.index++]=i.time}}),v(0,t,"alphaKeys",function(){return this._alphaKeys},function(e){this._alphaKeys=e;for(var t=this.index=0;t<e.length;t++){var i=e[t];this._alphaKeyData[this.index++]=i.alpha,this._alphaKeyData[this.index++]=i.time}}),e}(),_e=function(){function e(e,t){this._alpha=NaN,this._time=NaN,void 0===e&&(e=0),void 0===t&&(t=0),this._alpha=e,this._time=t}f(e,"laya.d3.core.trail.module.GradientAlphaKey");var t=e.prototype;return t.cloneTo=function(e){e.alpha=this.alpha,e.time=this.time},v(0,t,"alpha",function(){return this._alpha},function(e){this._alpha=e}),v(0,t,"time",function(){return this._time},function(e){this._time=e}),e}(),pe=function(){function e(e,t){this._color=null,this._time=NaN,void 0===t&&(t=0),this._color=e||new ce,this._time=t}f(e,"laya.d3.core.trail.module.GradientColorKey");var t=e.prototype;return t.cloneTo=function(e){this.color.cloneTo(e.color),e.time=this.time},v(0,t,"color",function(){return this._color},function(e){this._color=e}),v(0,t,"time",function(){return this._time},function(e){this._time=e}),e}();f(fe,"laya.d3.core.trail.module.GradientMode"),fe.Blend=0,fe.Fixed=1;function fe(){}f(me,"laya.d3.core.trail.module.TextureMode"),me.Stretch=0,me.Tile=1;function me(){}var ge=(f(ve,"laya.d3.core.trail.module.TrailKeyFrame"),ve.prototype.cloneTo=function(e){e.time=this.time,e.inTangent=this.inTangent,e.outTangent=this.outTangent,e.value=this.value},ve);function ve(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}var ye=function(){function t(e){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new ai,this._curPosition=new ai,this._delVector3=new ai,this._lastFixedVertexPosition=new ai,this._pointAtoBVector3=new ai,this._pointA=new ai,this._pointB=new ai,this._owner=e,this._id=t.renderElementCount++,0==this._id?e._owner.transform.position.cloneTo(this._lastPosition):e._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new On(Ce.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new On(Ce.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}f(t,"laya.d3.core.trail.TrailRenderElement");var e=t.prototype;return x.imps(e,{"laya.d3.core.render.IRenderable":!0}),e._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},e._addTrailByFirstPosition=function(e,t){ai.subtract(t,e,this._delVector3),ai.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),ai.normalize(this._pointAtoBVector3,this._pointAtoBVector3),ai.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(e),e.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},e._addTrailByNextPosition=function(e){ai.subtract(e,this._lastFixedVertexPosition,this._delVector3),ai.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),ai.normalize(this._pointAtoBVector3,this._pointAtoBVector3),ai.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=ai.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=jt.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(e),e.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(e),this._virtualVerticesCount=2)},e._updateVerticesByPosition=function(e){this._pointe=e.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},e._updateVertexBuffer2=function(){var e,t=0,i=0,n=0;for(n=0,e=(this._verticesCount+this._virtualVerticesCount)/2;n<e;n++)i=0==this._owner.textureMode?(this._VerticesToTailLength[n]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[n],this._vertices2[t++]=1-i,this._vertices2[t++]=1-i;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},e._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},e._updateDisappear=function(){var e,t=0;for(t=this._curDisappearIndex,e=(this._verticesCount+this._virtualVerticesCount)/2;t<e;t++)this._owner._curtime-this._everyGroupVertexBirthTime[t]>=this._owner.time+jt.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},e._beforeRender=function(e){return this._camera=e.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),ai.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},e._render=function(e){this._isDead||(I.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),w.drawCall++,w.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},e._getVertexBuffer=function(e){return void 0===e&&(e=0),0===e?this._vertexBuffer1:1===e?this._vertexBuffer2:null},e._getVertexBuffers=function(){return this._vertexBuffers},e._getIndexBuffer=function(){return null},e.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},e._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},v(0,e,"_vertexBufferCount",function(){return this._vertexBuffers.length}),v(0,e,"triangleCount",function(){return 0}),t.renderElementCount=0,t}(),Ce=function(){function e(){}f(e,"laya.d3.core.trail.VertexTrail");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration1}),v(1,e,"vertexDeclaration1",function(){return e._vertexDeclaration1}),v(1,e,"vertexDeclaration2",function(){return e._vertexDeclaration2}),u(e,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new He(32,[new Ue(0,"vector3",0),new Ue(12,"vector3",41),new Ue(24,"single",33),new Ue(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new He(4,[new Ue(0,"single",38)])}]),e}(),Ee=function(){function C(e){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=e}f(C,"laya.d3.graphics.DynamicBatch");var e=C.prototype;return x.imps(e,{"laya.d3.core.render.IRenderable":!0}),e._getVertexBuffer=function(e){return void 0===e&&(e=0),0===e?this._vertexBuffer:null},e._getIndexBuffer=function(){return this._indexBuffer},e._getCombineRenderElementFromPool=function(e,t,i){var n=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return n||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=n=new ae,n._sprite3D=new na),n._sprite3D._render._renderUpdate(i),n},e._getRenderElement=function(e,t,i){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*C.maxVertexCount),this._indexDatas=new Uint16Array(C.maxIndexCount),this._vertexBuffer=On.create(this._vertexDeclaration,C.maxVertexCount,35048),this._indexBuffer=Nn.create("ushort",C.maxIndexCount,35048));for(var n=this._merageElements.length=0,a=0,r=0,s=this._combineRenderElements.length;r<s;r++){var o=this._combineRenderElements[r],l=o.getDynamicBatchBakedVertexs(0),h=o.getBakedIndices(),c=o._sprite3D.transform._isFrontFaceInvert,u=n/(this._vertexDeclaration.vertexStride/4),d=a,_=d+h.length;o._tempBatchIndexStart=d,o._tempBatchIndexEnd=_,this._indexDatas.set(h,a);var p=0;if(c)for(p=d;p<_;p+=3){this._indexDatas[p]=u+this._indexDatas[p];var f=this._indexDatas[p+1],m=this._indexDatas[p+2];this._indexDatas[p+1]=u+m,this._indexDatas[p+2]=u+f}else for(p=d;p<_;p+=3)this._indexDatas[p]=u+this._indexDatas[p],this._indexDatas[p+1]=u+this._indexDatas[p+1],this._indexDatas[p+2]=u+this._indexDatas[p+2];a+=h.length,this._vertexDatas.set(l,n),n+=l.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),r=this._combineRenderElementPoolIndex=0,s=this._materials.length;r<s;r++){var g=this._getCombineRenderElementFromPool(e,t,i);g._type=2,g._staticBatch=null;var v=(g.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[r]]._tempBatchIndexStart,y=r+1===this._materialToRenderElementsOffsets.length?a:this._combineRenderElements[this._materialToRenderElementsOffsets[r+1]]._tempBatchIndexStart;g._tempBatchIndexStart=v,g._tempBatchIndexEnd=y,g._material=this._materials[r],this._merageElements.push(g)}},e._addCombineRenderObjTest=function(e){var t=e.renderObj,i=this._currentCombineIndexCount+t._getIndexBuffer().indexCount,n=this._currentCombineVertexCount+t._getVertexBuffer().vertexCount;return!(C.maxVertexCount<n||C.maxIndexCount<i)},e._addCombineRenderObj=function(e){var t=e.renderObj;this._combineRenderElements.push(e),this._currentCombineIndexCount=this._currentCombineIndexCount+t._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+t._getVertexBuffer().vertexCount},e._addCombineMaterial=function(e){this._materials.push(e)},e._addMaterialToRenderElementOffset=function(e){this._materialToRenderElementsOffsets.push(e)},e._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},e._addToRenderQueue=function(e,t,i,n){this._getRenderElement(t,i,n);for(var a=0,r=this._materials.length;a<r;a++)e.getRenderQueue(this._materials[a].renderQueue)._addDynamicBatchElement(this._merageElements[a])},e._beforeRender=function(e){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},e._render=function(e){var t=e._batchIndexEnd-e._batchIndexStart;I.mainContext.drawElements(4,t,5123,2*e._batchIndexStart),w.drawCall++,w.trianglesFaces+=t/3},e._getVertexBuffers=function(){return null},v(0,e,"_vertexBufferCount",function(){return 1}),v(0,e,"triangleCount",function(){return this._indexBuffer.indexCount/3}),v(0,e,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),C.maxVertexCount=2e4,C.maxIndexCount=4e4,C.maxCombineTriangleCount=10,C}(),Se=function(){function C(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}f(C,"laya.d3.graphics.DynamicBatchManager");var e=C.prototype;return e.getDynamicBatch=function(e,t){var i,n=e.id.toString()+t;return this._dynamicBatches[n]?i=this._dynamicBatches[n]:this._dynamicBatches[n]=i=new Ee(e),i},e._garbageCollection=function(){for(var e in this._dynamicBatches)0===this._dynamicBatches[e].combineRenderElementsCount&&delete this._dynamicBatches[e]},e._addPrepareRenderElement=function(e){this._prepareDynamicBatchCombineElements.push(e)},e._finishCombineDynamicBatch=function(e){var t,i,n;this._prepareDynamicBatchCombineElements.sort(C._sortPrepareDynamicBatch);for(var a,r,s,o,l,h=-1,c=!0,u=0,d=-1,_=0,p=this._prepareDynamicBatchCombineElements.length;_<p;_++){var f=(r=this._prepareDynamicBatchCombineElements[_]).renderObj._getVertexBuffer(0).vertexDeclaration,m=i!==f;m&&(u=0,i=f);var g=u!==h;if(g&&(h=u),(m||g)&&(s=this.getDynamicBatch(f,u),t=null),c)if(s._addCombineRenderObjTest(r)){if(t!==(a=r._material))o&&(e.getRenderQueue(l._material.renderQueue)._addRenderElement(l),l=o=null,d=-1),o=a,d=s.combineRenderElementsCount,l=r,t=a;else if(o){var v=l.renderObj,y=r.renderObj;v._getVertexBuffer().vertexCount+y._getVertexBuffer().vertexCount>Ee.maxVertexCount||v._getIndexBuffer().indexCount+y._getIndexBuffer().indexCount>Ee.maxIndexCount?(e.getRenderQueue(l._material.renderQueue)._addRenderElement(l),o=a,d=s.combineRenderElementsCount,l=r):(s._addCombineMaterial(o),s._addMaterialToRenderElementOffset(d),s._addCombineRenderObj(l),l=o=null,d=-1,s._addCombineRenderObj(r))}else s._addCombineRenderObj(r);c=!0}else o&&(e.getRenderQueue(l._material.renderQueue)._addRenderElement(l),l=o=null,d=-1),u++,c=!1;else n=this._prepareDynamicBatchCombineElements[_-1],s._addMaterialToRenderElementOffset(s.combineRenderElementsCount),t=n._material,s._addCombineMaterial(t),s._addCombineRenderObj(n),c=!0,t!==(a=r._material)?(o=a,d=s.combineRenderElementsCount,l=r):s._addCombineRenderObj(r),t=a}o&&(e.getRenderQueue(l._material.renderQueue)._addRenderElement(l),l=o=null,d=-1),this._prepareDynamicBatchCombineElements.length=0},e._clearRenderElements=function(){for(var e in this._dynamicBatches)this._dynamicBatches[e]._clearRenderElements()},e._addToRenderQueue=function(e,t,i,n){for(var a in this._dynamicBatches){var r=this._dynamicBatches[a];0<r.combineRenderElementsCount&&r._addToRenderQueue(e,t,i,n)}},e.dispose=function(){this._dynamicBatches=null},C._sortPrepareDynamicBatch=function(e,t){return e._mainSortID-t._mainSortID},C}(),xe=(f(Te,"laya.d3.graphics.FrustumCulling"),Te.renderShadowObjectCulling=function(e,t,i,n,a){var r=0,s=0,o=0,l=0;for(r=0,o=i.length;r<o;r++){var h=i[r];h&&h._clearRenderElements()}var c,u,d,_=e._cullingRenders;if(1<a){for(r=0,o=e._cullingRendersLength;r<o;r++)if((c=_[r]).castShadow&&Y.isVisible(c._owner.layer.mask)&&c.enable)for(var p=1,f=t.length;p<f;p++)if(u=i[p-1],0!==t[p].containsBoundSphere(c.boundingSphere))for(s=0,l=(d=c._renderElements).length;s<l;s++)u._addRenderElement(d[s])}else for(r=0,o=e._cullingRendersLength;r<o;r++)if((c=_[r]).castShadow&&Y.isVisible(c._owner.layer.mask)&&c.enable&&0!==t[0].containsBoundSphere(c.boundingSphere))for(c._renderUpdate(n),u=i[0],s=0,l=(d=c._renderElements).length;s<l;s++)u._addRenderElement(d[s])},Te.renderShadowObjectCullingOctree=function(e,t,i,n,a){for(var r=0,s=i.length;r<s;r++){var o=i[r];o&&o._clearRenderElements()}1<a?e.treeRoot.cullingShadowObjects(t,i,!0,0,e):e.treeRoot.cullingShadowObjectsOnePSSM(t[0],i,n,!0,0,e)},Te.renderObjectCulling=function(e,t,i,n,a,r){var s=0,o=0,l=0,h=0,c=t._quenes,u=t._dynamicBatchManager,d=t._cullingRenders;for(s=0,o=c.length;s<o;s++){var _=c[s];_&&_._clearRenderElements()}var p=we._staticBatchManagers;for(s=0,o=p.length;s<o;s++)p[s]._clearRenderElements();u._clearRenderElements();var f=i.transform.position;for(s=0,o=t._cullingRendersLength;s<o;s++){var m=d[s];if(Y.isVisible(m._owner.layer.mask)&&m.enable&&0!==e.containsBoundSphere(m.boundingSphere)&&m._renderUpdate(r)){m._distanceForSort=ai.distance(m.boundingSphere.center,f)+m.sortingFudge;var g=m._renderElements;for(l=0,h=g.length;l<h;l++){var v=g[l],y=v._staticBatch;if(y&&y._material===v._material)y._addBatchRenderElement(v);else{var C=v.renderObj;C.triangleCount<10&&1===C._vertexBufferCount&&C._getIndexBuffer()&&v._material.renderQueue<2&&v._canDynamicBatch&&!m._owner.isStatic?u._addPrepareRenderElement(v):t.getRenderQueue(v._material.renderQueue)._addRenderElement(v)}}}}for(s=0,o=p.length;s<o;s++)p[s]._addToRenderQueue(t,n,a,r);u._finishCombineDynamicBatch(t),u._addToRenderQueue(t,n,a,r)},Te.renderObjectCullingOctree=function(e,t,i,n,a,r){var s=0,o=0,l=t._quenes,h=t._dynamicBatchManager;for(s=0,o=l.length;s<o;s++){var c=l[s];c&&c._clearRenderElements()}var u=we._staticBatchManagers;for(s=0,o=u.length;s<o;s++)u[s]._clearRenderElements();for(h._clearRenderElements(),t._cullingRenders.length=0,t.treeRoot.cullingObjects(e,!0,0,i.transform.position,r),s=0,o=u.length;s<o;s++)u[s]._addToRenderQueue(t,n,a,r);h._finishCombineDynamicBatch(t),h._addToRenderQueue(t,n,a,r)},Te.renderObjectCullingNoBoundFrustum=function(e,t,i,n,a){var r=0,s=0,o=0,l=0,h=e._quenes,c=e._dynamicBatchManager,u=e._cullingRenders;for(r=0,s=h.length;r<s;r++){var d=h[r];d&&d._clearRenderElements()}var _=we._staticBatchManagers;for(r=0,s=_.length;r<s;r++)_[r]._clearRenderElements();c._clearRenderElements();var p=t.transform.position;for(r=0,s=e._cullingRendersLength;r<s;r++){var f=u[r];if(Y.isVisible(f._owner.layer.mask)&&f.enable){f._renderUpdate(a),f._distanceForSort=ai.distance(f.boundingSphere.center,p)+f.sortingFudge;var m=f._renderElements;for(o=0,l=m.length;o<l;o++){var g=m[o],v=g._staticBatch;if(v&&v._material===g._material)v._addBatchRenderElement(g);else{var y=g.renderObj;y.triangleCount<10&&1===y._vertexBufferCount&&y._getIndexBuffer()&&g._material.renderQueue<2&&g._canDynamicBatch&&!f._owner.isStatic?c._addPrepareRenderElement(g):e.getRenderQueue(g._material.renderQueue)._addRenderElement(g)}}}}for(r=0,s=_.length;r<s;r++)_[r]._addToRenderQueue(e,i,n,a);c._finishCombineDynamicBatch(e),c._addToRenderQueue(e,i,n,a)},Te);function Te(){}var we=function(){function r(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}f(r,"laya.d3.graphics.StaticBatchManager");var e=r.prototype;return e._finishInit=function(){for(var e in this._staticBatches)this._staticBatches[e]._finishInit();this._initBatchRenderElements.length=0},e._initStaticBatchs=function(e){throw new Error("StaticBatchManager:must override this function.")},e._addInitBatchSprite=function(e){for(var t=e._render._renderElements,i=0,n=t.length;i<n;i++)this._initBatchRenderElements.push(t[i])},e._clearRenderElements=function(){for(var e in this._staticBatches)this._staticBatches[e]._clearRenderElements()},e._garbageCollection=function(e){var t=e._staticBatch,i=t._initBatchRenderElements,n=i.indexOf(e);i.splice(n,1),0===i.length&&(t.dispose(),delete this._staticBatches[t._key])},e._addToRenderQueue=function(e,t,i,n){for(var a in this._staticBatches){var r=this._staticBatches[a];0<r._batchRenderElements.length&&r._updateToRenderQueue(e,n)}},e.dispose=function(){this._staticBatches=null},r._addToStaticBatchQueue=function(e){e instanceof laya.d3.core.RenderableSprite3D&&e._addToInitStaticBatchManager();for(var t=0,i=e.numChildren;t<i;t++)r._addToStaticBatchQueue(e._childs[t])},r.combine=function(e,t){var i,n=0,a=0;if(t)for(n=0,a=t.length;n<a;n++){t[n]._addToInitStaticBatchManager()}else e&&r._addToStaticBatchQueue(e);for(n=0,a=r._staticBatchManagers.length;n<a;n++)(i=r._staticBatchManagers[n])._initStaticBatchs(e),i._finishInit()},r._staticBatchManagers=[],r}(),Fe=function(){function e(e,t,i){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=e,this._manager=t,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=i}f(e,"laya.d3.graphics.StaticBatch");var t=e.prototype;return x.imps(t,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),t._binarySearch=function(e){for(var t=0,i=this._batchRenderElements.length-1,n=0;t<=i;)n=Math.floor((t+i)/2),this._compareBatchRenderElement(this._batchRenderElements[n],e)?i=n-1:t=n+1;return t},t._compareBatchRenderElement=function(e,t){throw new Error("StaticBatch:must override this function.")},t._getVertexDecLightMap=function(e){return e===St.vertexDeclaration?gt.vertexDeclaration:e===Et.vertexDeclaration?mt.vertexDeclaration:e===ct.vertexDeclaration?rt.vertexDeclaration:e===Mt.vertexDeclaration?null:e===et.vertexDeclaration?tt.vertexDeclaration:e===Tt.vertexDeclaration?yt.vertexDeclaration:e===pt.vertexDeclaration?ft.vertexDeclaration:e===xt.vertexDeclaration?vt.vertexDeclaration:e===Et.vertexDeclaration?mt.vertexDeclaration:e===ut.vertexDeclaration?st.vertexDeclaration:e===Mt.vertexDeclaration?null:e===et.vertexDeclaration?tt.vertexDeclaration:e===wt.vertexDeclaration?Ct.vertexDeclaration:e===pt.vertexDeclaration?ft.vertexDeclaration:e},t._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},t._addBatchRenderElement=function(e){this._batchRenderElements.splice(this._binarySearch(e),0,e)},t._updateToRenderQueue=function(e,t){this._combineRenderElementPoolIndex=0,this._getRenderElement(e.getRenderQueue(this._material.renderQueue)._renderElements,e,t)},t._getRenderElement=function(e,t,i){throw new Error("StaticBatch:must override this function.")},t._finishInit=function(){throw new Error("StaticBatch:must override this function.")},t._clearRenderElements=function(){this._batchRenderElements.length=0},t.dispose=function(){},t._getVertexBuffer=function(e){return void 0===e&&(e=0),null},t._getIndexBuffer=function(){return null},t._beforeRender=function(e){return!0},t._render=function(e){},t._getVertexBuffers=function(){return null},v(0,t,"_vertexBufferCount",function(){return 1}),v(0,t,"triangleCount",function(){return 0}),e.combine=function(e){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),we.combine(e)},e.maxBatchVertexCount=65535,e}(),He=function(){function s(e,t){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++s._uniqueIDCounter,this._id>s.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",s.maxVertexDeclaration);this._shaderValues=new _i,this._vertexElementsDic={},this._vertexStride=e,this._vertexElements=t;for(var i=0;i<t.length;i++){var n=t[i],a=n.elementUsage;this._vertexElementsDic[a]=n;var r=[s._getTypeSize(n.elementFormat)/4,5126,!1,this._vertexStride,n.offset];switch(this._shaderValues.setValue(a,r),a){case 1:this._addShaderDefine(Yi.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(Yi.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(Yi.SHADERDEFINE_UV1)}}}f(s,"laya.d3.graphics.VertexDeclaration");var e=s.prototype;return e._addShaderDefine=function(e){this._shaderDefineValue|=e},e._removeShaderDefine=function(e){this._shaderDefineValue&=~e},e.getVertexElements=function(){return this._vertexElements.slice()},e.getVertexElementByUsage=function(e){return this._vertexElementsDic[e]},e.unBinding=function(){},v(0,e,"shaderDefineValue",function(){return this._shaderDefineValue}),v(0,e,"id",function(){return this._id}),v(0,e,"vertexStride",function(){return this._vertexStride}),v(0,e,"shaderValues",function(){return this._shaderValues}),s._getTypeSize=function(e){switch(e){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},s.getVertexStride=function(e){for(var t=0,i=0;i<e.Length;i++){var n=e[i],a=n.offset+s._getTypeSize(n.elementFormat);t<a&&(t=a)}return t},s._maxVertexDeclarationBit=1e3,s._uniqueIDCounter=1,u(s,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),s}(),Ue=(f(Ge,"laya.d3.graphics.VertexElement"),Ge);function Ge(e,t,i){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=e,this.elementFormat=t,this.elementUsage=i}f(ze,"laya.d3.graphics.VertexElementFormat"),ze.Single="single",ze.Vector2="vector2",ze.Vector3="vector3",ze.Vector4="vector4",ze.Color="color",ze.Byte4="byte4",ze.Short2="short2",ze.Short4="short4",ze.NormalizedShort2="normalizedshort2",ze.NormalizedShort4="normalizedshort4",ze.HalfVector2="halfvector2",ze.HalfVector4="halfvector4";function ze(){}f(We,"laya.d3.graphics.VertexElementUsage"),We.POSITION0=0,We.COLOR0=1,We.TEXTURECOORDINATE0=2,We.NORMAL0=3,We.BINORMAL0=4,We.TANGENT0=5,We.BLENDINDICES0=6,We.BLENDWEIGHT0=7,We.DEPTH0=8,We.FOG0=9,We.POINTSIZE0=10,We.SAMPLE0=11,We.TESSELLATEFACTOR0=12,We.COLOR1=13,We.NEXTTEXTURECOORDINATE0=14,We.TEXTURECOORDINATE1=15,We.NEXTTEXTURECOORDINATE1=16,We.CORNERTEXTURECOORDINATE0=17,We.VELOCITY0=18,We.STARTCOLOR0=19,We.STARTSIZE=20,We.AGEADDSCALE0=21,We.STARTROTATION=22,We.ENDCOLOR0=23,We.STARTLIFETIME=24,We.TIME0=33,We.SHAPEPOSITIONSTARTLIFETIME=30,We.DIRECTIONTIME=32,We.SIZEROTATION0=27,We.RADIUS0=28,We.RADIAN0=29,We.STARTSPEED=31,We.RANDOM0=34,We.RANDOM1=35,We.SIMULATIONWORLDPOSTION=36,We.SIMULATIONWORLDROTATION=37,We.TEXTURECOORDINATE0X=38,We.TEXTURECOORDINATE0X1=39,We.TEXTURECOORDINATE0Y=40,We.OFFSETVECTOR=41;function We(){}var Xe=function(){function e(e,t,i){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=e,this._textureCoordinate0=t,this._time=i}f(e,"laya.d3.graphics.VertexGlitter");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate0}),v(0,t,"position",function(){return this._position}),v(0,t,"time",function(){return this._time}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(24,[new Ue(0,"vector3",0),new Ue(12,"vector2",2),new Ue(20,"single",33)])}]),e}(),je=(function(){function e(e,t,i,n,a,r,s,o,l,h){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=e,this._position=t,this._velocity=i,this._startColor=n,this._endColor=a,this._sizeRotation=r,this._radius=s,this._radian=o,this._ageAddScale=l,this._time=h}f(e,"laya.d3.graphics.VertexParticle");var t=e.prototype;x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"endColor",function(){return this._endColor}),v(0,t,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),v(0,t,"sizeRotation",function(){return this._sizeRotation}),v(0,t,"velocity",function(){return this._velocity}),v(0,t,"position",function(){return this._position}),v(0,t,"startColor",function(){return this._startColor}),v(0,t,"radius",function(){return this._radius}),v(0,t,"radian",function(){return this._radian}),v(0,t,"ageAddScale",function(){return this._ageAddScale}),v(0,t,"time",function(){return this._time}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(116,[new Ue(0,"vector4",17),new Ue(16,"vector3",0),new Ue(28,"vector3",18),new Ue(40,"vector4",19),new Ue(56,"vector4",23),new Ue(72,"vector3",27),new Ue(84,"vector2",28),new Ue(92,"vector4",29),new Ue(108,"single",24),new Ue(112,"single",33)])}])}(),function(){function e(e){this._position=null,this._position=e}f(e,"laya.d3.graphics.VertexPosition");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"position",function(){return this._position}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(12,[new Ue(0,"vector3",0)])}]),e}()),Ye=function(){function e(e,t){this._position=null,this._normal=null,this._position=e,this._normal=t}f(e,"laya.d3.graphics.VertexPositionNormal");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(24,[new Ue(0,"vector3",0),new Ue(12,"vector3",3)])}]),e}(),Ke=function(){function e(e,t,i){this._position=null,this._normal=null,this._color=null,this._position=e,this._normal=t,this._color=i}f(e,"laya.d3.graphics.VertexPositionNormalColor");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"color",function(){return this._color}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(40,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1)])}]),e}(),qe=function(){function e(e,t,i,n,a){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=e,this._normal=t,this._color=i,this._blendIndex=n,this._blendWeight=a}f(e,"laya.d3.graphics.VertexPositionNormalColorSkin");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(0,t,"color",function(){return this._color}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(72,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector4",7),new Ue(56,"vector4",6)])}]),e}(),Ze=function(){function e(e,t,i,n,a,r){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=e,this._normal=t,this._color=i,this._tangent=n,this._blendIndex=a,this._blendWeight=r}f(e,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(0,t,"color",function(){return this._color}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(88,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector4",7),new Ue(56,"vector4",6),new Ue(72,"vector4",5)])}]),e}(),Qe=function(){function e(e,t,i,n,a,r){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=e,this._normal=t,this._color=i,this._tangent=n,this._blendIndex=a,this._blendWeight=r}f(e,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(0,t,"color",function(){return this._color}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(84,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector4",7),new Ue(56,"vector4",6),new Ue(72,"vector3",5)])}]),e}(),$e=function(){function e(e,t,i,n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=e,this._normal=t,this._color=i,this._tangent=n}f(e,"laya.d3.graphics.VertexPositionNormalColorSTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"color",function(){return this._color}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(56,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector4",5)])}]),e}(),Je=function(){function e(e,t,i,n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=e,this._normal=t,this._color=i,this._tangent=n}f(e,"laya.d3.graphics.VertexPositionNormalColorTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"color",function(){return this._color}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(52,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector3",5)])}]),e}(),et=function(){function e(e,t,i,n){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=e,this._normal=t,this._color=i,this._textureCoordinate=n}f(e,"laya.d3.graphics.VertexPositionNormalColorTexture");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"color",function(){return this._color}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(48,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector2",2)])}]),e}(),tt=function(){function e(e,t,i,n,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=e,this._normal=t,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=a}f(e,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"color",function(){return this._color}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(56,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector2",2),new Ue(48,"vector2",15)])}]),e}(),it=function(){function e(e,t,i,n,a,r,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=e,this._normal=t,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=a,this._blendIndex=r,this._blendWeight=s}f(e,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(0,t,"color",function(){return this._color}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(88,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector2",2),new Ue(48,"vector2",15),new Ue(56,"vector4",7),new Ue(72,"vector4",6)])}]),e}(),nt=function(){function e(e,t,i,n,a,r,s,o){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=e,this._normal=t,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=a,this._tangent=r,this._blendIndex=s,this._blendWeight=o}f(e,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(0,t,"color",function(){return this._color}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(104,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector2",2),new Ue(48,"vector2",15),new Ue(56,"vector4",7),new Ue(72,"vector4",6),new Ue(88,"vector4",5)])}]),e}(),at=function(){function e(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}f(e,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),t.VertexPositionNormalColorTexture0SkinTangent=function(e,t,i,n,a,r,s,o){this._position=e,this._normal=t,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=a,this._tangent=r,this._blendIndex=s,this._blendWeight=o},v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(0,t,"color",function(){return this._color}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(100,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector2",2),new Ue(48,"vector2",15),new Ue(56,"vector4",7),new Ue(72,"vector4",6),new Ue(88,"vector3",5)])}]),e}(),rt=function(){function e(e,t,i,n,a,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=e,this._normal=t,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=a,this._tangent=r}f(e,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"color",function(){return this._color}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(72,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector2",2),new Ue(48,"vector2",15),new Ue(56,"vector4",5)])}]),e}(),st=function(){function e(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}f(e,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),t.VertexPositionNormalColorTexture0Tangent=function(e,t,i,n,a,r){this._position=e,this._normal=t,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=a,this._tangent=r},v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"color",function(){return this._color}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(68,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector2",2),new Ue(48,"vector2",15),new Ue(56,"vector3",5)])}]),e}(),ot=function(){function e(e,t,i,n,a,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=e,this._normal=t,this._color=i,this._textureCoordinate=n,this._blendIndex=a,this._blendWeight=r}f(e,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(0,t,"color",function(){return this._color}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(80,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector2",2),new Ue(48,"vector4",7),new Ue(64,"vector4",6)])}]),e}(),lt=function(){function e(e,t,i,n,a,r,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=e,this._normal=t,this._color=i,this._textureCoordinate=n,this._tangent=a,this._blendIndex=r,this._blendWeight=s}f(e,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(0,t,"color",function(){return this._color}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(96,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector2",2),new Ue(48,"vector4",7),new Ue(64,"vector4",6),new Ue(80,"vector4",5)])}]),e}(),ht=function(){function e(e,t,i,n,a,r,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=e,this._normal=t,this._color=i,this._textureCoordinate=n,this._tangent=a,this._blendIndex=r,this._blendWeight=s}f(e,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(0,t,"color",function(){return this._color}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(92,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector2",2),new Ue(48,"vector4",7),new Ue(64,"vector4",6),new Ue(80,"vector3",5)])}]),e}(),ct=function(){function e(e,t,i,n,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=e,this._normal=t,this._color=i,this._textureCoordinate=n,this._tangent=a}f(e,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"color",function(){return this._color}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(64,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector2",2),new Ue(48,"vector4",5)])}]),e}(),ut=function(){function e(e,t,i,n,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=e,this._normal=t,this._color=i,this._textureCoordinate=n,this._tangent=a}f(e,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"color",function(){return this._color}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(60,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",1),new Ue(40,"vector2",2),new Ue(48,"vector3",5)])}]),e}(),dt=function(){function e(e,t,i){this._position=null,this._normal=null,this._tangent=null,this._position=e,this._normal=t,this._tangent=i}f(e,"laya.d3.graphics.VertexPositionNormalSTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(40,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector4",5)])}]),e}(),_t=function(){function e(e,t,i){this._position=null,this._normal=null,this._tangent=null,this._position=e,this._normal=t,this._tangent=i}f(e,"laya.d3.graphics.VertexPositionNormalTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(36,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector3",5)])}]),e}(),pt=function(){function e(e,t,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=e,this._normal=t,this._textureCoordinate=i}f(e,"laya.d3.graphics.VertexPositionNormalTexture");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(32,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2)])}]),e}(),ft=function(){function e(e,t,i,n){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=e,this._normal=t,this._textureCoordinate0=i,this._textureCoordinate1=n}f(e,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(40,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2),new Ue(32,"vector2",15)])}]),e}(),mt=function(){function e(e,t,i,n,a,r){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=e,this._normal=t,this._textureCoordinate0=i,this._textureCoordinate1=n,this._blendIndex=a,this._blendWeight=r}f(e,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(72,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2),new Ue(32,"vector2",15),new Ue(40,"vector4",7),new Ue(56,"vector4",6)])}]),e}(),gt=function(){function e(e,t,i,n,a,r,s){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=e,this._normal=t,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=a,this._blendIndex=r,this._blendWeight=s}f(e,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(88,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2),new Ue(32,"vector2",15),new Ue(40,"vector4",7),new Ue(56,"vector4",6),new Ue(72,"vector4",5)])}]),e}(),vt=function(){function e(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}f(e,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),t.VertexPositionNormalTexture0SkinTangent=function(e,t,i,n,a,r,s){this._position=e,this._normal=t,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=a,this._blendIndex=r,this._blendWeight=s},v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(84,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2),new Ue(32,"vector2",15),new Ue(40,"vector4",7),new Ue(56,"vector4",6),new Ue(72,"vector3",5)])}]),e}(),yt=function(){function e(e,t,i,n,a){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=e,this._normal=t,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=a}f(e,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(56,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2),new Ue(32,"vector2",15),new Ue(40,"vector4",5)])}]),e}(),Ct=function(){function e(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}f(e,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),t.VertexPositionNormalTexture0Tangent=function(e,t,i,n,a){this._position=e,this._normal=t,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=a},v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(52,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2),new Ue(32,"vector2",15),new Ue(40,"vector3",5)])}]),e}(),Et=function(){function e(e,t,i,n,a){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=e,this._normal=t,this._textureCoordinate=i,this._blendIndex=n,this._blendWeight=a}f(e,"laya.d3.graphics.VertexPositionNormalTextureSkin");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(64,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2),new Ue(32,"vector4",7),new Ue(48,"vector4",6)])}]),e}(),St=function(){function e(e,t,i,n,a,r){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=e,this._normal=t,this._textureCoordinate=i,this._tangent=n,this._blendIndex=a,this._blendWeight=r}f(e,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(80,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2),new Ue(32,"vector4",7),new Ue(48,"vector4",6),new Ue(64,"vector4",5)])}]),e}(),xt=function(){function e(e,t,i,n,a,r){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=e,this._normal=t,this._textureCoordinate=i,this._tangent=n,this._blendIndex=a,this._blendWeight=r}f(e,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(76,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2),new Ue(32,"vector4",7),new Ue(48,"vector4",6),new Ue(64,"vector3",5)])}]),e}(),Tt=function(){function e(e,t,i,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=e,this._normal=t,this._textureCoordinate=i,this._tangent=n}f(e,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(48,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2),new Ue(32,"vector4",5)])}]),e}(),wt=function(){function e(e,t,i,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=e,this._normal=t,this._textureCoordinate=i,this._tangent=n}f(e,"laya.d3.graphics.VertexPositionNormalTextureTangent");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(44,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2),new Ue(32,"vector3",5)])}]),e}(),Mt=function(){function e(e,t,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=e,this._normal=t,this._textureCoordinate=i}f(e,"laya.d3.graphics.VertexPositionNTBTexture");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(56,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector3",5),new Ue(36,"vector3",4),new Ue(48,"vector2",2)])}]),e}(),bt=function(){function e(e,t,i,n,a,r,s,o){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=e,this._normal=t,this._textureCoordinate0=n,this._textureCoordinate1=a,this._tangent=r,i=i,this._blendIndex=s,this._blendWeight=o}f(e,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"tangent",function(){return this._tangent}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(0,t,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,t,"blendIndex",function(){return this._blendIndex}),v(0,t,"blendWeight",function(){return this._blendWeight}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(96,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector3",5),new Ue(36,"vector3",4),new Ue(48,"vector2",2),new Ue(56,"vector2",15),new Ue(64,"vector4",7),new Ue(80,"vector4",6)])}]),e}(),Rt=function(){function e(e,t,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=e,this._normal=t,this._textureCoordinate=i}f(e,"laya.d3.graphics.VertexPositionNTBTextureSkin");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"textureCoordinate",function(){return this._textureCoordinate}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(88,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector3",5),new Ue(36,"vector3",4),new Ue(48,"vector2",2),new Ue(56,"vector4",7),new Ue(72,"vector4",6)])}]),e}(),Lt=function(){function e(e,t,i,n){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=e,this._normal=t,this._textureCoord0=i,this._textureCoord1=n}f(e,"laya.d3.graphics.VertexPositionTerrain");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"normal",function(){return this._normal}),v(0,t,"position",function(){return this._position}),v(0,t,"textureCoord0",function(){return this._textureCoord0}),v(0,t,"textureCoord1",function(){return this._textureCoord1}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(40,[new Ue(0,"vector3",0),new Ue(12,"vector3",3),new Ue(24,"vector2",2),new Ue(32,"vector2",15)])}]),e}(),At=function(){function e(e,t){this._position=null,this._textureCoordinate0=null,this._position=e,this._textureCoordinate0=t}f(e,"laya.d3.graphics.VertexPositionTexture0");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"position",function(){return this._position}),v(0,t,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(20,[new Ue(0,"vector3",0),new Ue(12,"vector2",2)])}]),e}(),It=function(){function e(e,t,i,n,a,r,s,o,l,h,c,u,d,_){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=e,this._positionStartLifeTime=t,this._velocity=i,this._startColor=n,this._startSize=a,this._startRotation0=r,this._startRotation1=s,this._startRotation2=o,this._startLifeTime=l,this._time=h,this._startSpeed=c,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=_}f(e,"laya.d3.graphics.VertexShurikenParticleBillboard");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),v(0,t,"random1",function(){return this._randoms1}),v(0,t,"startRotation2",function(){return this._startRotation2}),v(0,t,"positionStartLifeTime",function(){return this._positionStartLifeTime}),v(0,t,"velocity",function(){return this._velocity}),v(0,t,"random0",function(){return this._randoms0}),v(0,t,"startSize",function(){return this._startSize}),v(0,t,"startColor",function(){return this._startColor}),v(0,t,"startRotation0",function(){return this._startRotation0}),v(0,t,"startRotation1",function(){return this._startRotation1}),v(0,t,"startLifeTime",function(){return this._startLifeTime}),v(0,t,"time",function(){return this._time}),v(0,t,"startSpeed",function(){return this._startSpeed}),v(0,t,"simulationWorldPostion",function(){return this._simulationWorldPostion}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(152,[new Ue(0,"vector4",17),new Ue(16,"vector4",30),new Ue(32,"vector4",32),new Ue(48,"vector4",19),new Ue(64,"vector3",20),new Ue(76,"vector3",22),new Ue(88,"single",31),new Ue(92,"vector4",34),new Ue(108,"vector4",35),new Ue(124,"vector3",36),new Ue(136,"vector4",37)])}]),e}(),Dt=function(){function e(e,t,i,n,a,r,s,o,l,h,c,u,d,_){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=e,this._positionStartLifeTime=t,this._velocity=i,this._startColor=n,this._startSize=a,this._startRotation0=r,this._startRotation1=s,this._startRotation2=o,this._startLifeTime=l,this._time=h,this._startSpeed=c,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=_}f(e,"laya.d3.graphics.VertexShurikenParticleMesh");var t=e.prototype;return x.imps(t,{"laya.d3.graphics.IVertex":!0}),v(0,t,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),v(0,t,"velocity",function(){return this._velocity}),v(0,t,"position",function(){return this._positionStartLifeTime}),v(0,t,"random0",function(){return this._randoms0}),v(0,t,"startSize",function(){return this._startSize}),v(0,t,"startColor",function(){return this._startColor}),v(0,t,"startRotation0",function(){return this._startRotation0}),v(0,t,"startRotation1",function(){return this._startRotation1}),v(0,t,"random1",function(){return this._randoms1}),v(0,t,"startRotation2",function(){return this._startRotation2}),v(0,t,"startLifeTime",function(){return this._startLifeTime}),v(0,t,"time",function(){return this._time}),v(0,t,"startSpeed",function(){return this._startSpeed}),v(0,t,"simulationWorldPostion",function(){return this._simulationWorldPostion}),v(0,t,"vertexDeclaration",function(){return e._vertexDeclaration}),v(1,e,"vertexDeclaration",function(){return e._vertexDeclaration}),u(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new He(172,[new Ue(0,"vector3",0),new Ue(12,"vector4",1),new Ue(28,"vector2",2),new Ue(36,"vector4",30),new Ue(52,"vector4",32),new Ue(68,"vector4",19),new Ue(84,"vector3",20),new Ue(96,"vector3",22),new Ue(108,"single",31),new Ue(112,"vector4",34),new Ue(128,"vector4",35),new Ue(144,"vector3",36),new Ue(156,"vector4",37)])}]),e}(),Pt=function(){function y(e,t,i,n,a,r){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=i,this._materials=n,this._subMeshes=a,this._materialMap=r,this._version=t,this._onLoaded(e)}f(y,"laya.d3.loaders.LoadModelV01");var e=y.prototype;return e._onLoaded=function(e){this._readData=e,this.READ_BLOCK();for(var t=0;t<this._BLOCK.count;t++){var i=this._readData.getUint16(),n=this._strings[i],a=this["READ_"+n];if(null==a)throw new Error("model file err,no this function:"+i+" "+n);if(!a.call(this))break}return this._mesh},e.onError=function(){},e._readString=function(){return this._strings[this._readData.getUint16()]},e.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},e.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},e.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var e=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var t=0;t<this._STRINGS.size;t++)this._strings[t]=this._readData.readUTFString();return this._readData.pos=e,!0},e.READ_MATERIAL=function(){var e=this._readData.getUint16(),t=(this._readString(),this._readString());return this._materials[e]="null"!==t?Me.getRes(this._materialMap[t]):new Ji,!0},e.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var e,t=this._readData.__getBuffer(),i=0,n=this._readData.getUint32(),a=this._readData.getUint32(),r=(new Float32Array(t.slice(n+this._DATA.offset,n+this._DATA.offset+a)),this._readData.getUint32()),s=this._readData.getUint32(),o=new Float32Array(t.slice(r+this._DATA.offset,r+this._DATA.offset+s));for(this.mesh._inverseBindPoses=[],i=0,e=o.length;i<e;i+=16){var l=new qt(o[i+0],o[i+1],o[i+2],o[i+3],o[i+4],o[i+5],o[i+6],o[i+7],o[i+8],o[i+9],o[i+10],o[i+11],o[i+12],o[i+13],o[i+14],o[i+15]);this.mesh._inverseBindPoses.push(l)}break;default:throw new Error("LoadModel:unknown version.")}return!0},e.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var e=this._readString();this._shaderAttributes=e.match(y._attrReg);var t=this._readData.getUint32(),i=this._readData.getUint32(),n=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),a=this._readData.getUint32(),r=this._readData.getUint32(),s=this._readData.getUint32(),o=this._readData.__getBuffer(),l=new li(this._mesh),h=this._getVertexDeclaration(),c=On.create(h,a/h.vertexStride,35044,!0),u=n+this._DATA.offset,d=o.slice(u,u+a);c.setData(new Float32Array(d));for(var _=(l._vertexBuffer=c).vertexDeclaration.getVertexElements(),p=0;p<_.length;p++)l._bufferUsage[_[p].elementUsage]=c;var f=Nn.create("ushort",i/2,35044,!0),m=t+this._DATA.offset,g=o.slice(m,m+i);f.setData(new Uint16Array(g)),l._indexBuffer=f;var v=o.slice(r+this._DATA.offset,r+this._DATA.offset+s);return l._boneIndicesList[0]=new Uint8Array(v),this._subMeshes.push(l),!0},e.READ_DATAAREA=function(){return!1},e._getVertexDeclaration=function(){for(var e,t=!1,i=!1,n=!1,a=!1,r=!1,s=!1,o=!1,l=!1,h=!1,c=0;c<this._shaderAttributes.length;c+=8)switch(this._shaderAttributes[c]){case"POSITION":t=!0;break;case"NORMAL":i=!0;break;case"COLOR":n=!0;break;case"UV":a=!0;break;case"UV1":r=!0;break;case"BLENDWEIGHT":o=!0;break;case"BLENDINDICES":l=!0;break;case"TANGENT":s=!0;break;case"BINORMAL":h=!0}return t&&i&&n&&a&&r&&o&&l&&s?e=at.vertexDeclaration:t&&i&&n&&a&&r&&o&&l?e=it.vertexDeclaration:t&&i&&a&&r&&o&&l&&s?e=vt.vertexDeclaration:t&&i&&a&&r&&o&&l?e=mt.vertexDeclaration:t&&i&&n&&a&&o&&l&&s?e=ht.vertexDeclaration:t&&i&&n&&a&&o&&l?e=ot.vertexDeclaration:t&&i&&s&&h&&a&&o&&l?e=Rt.vertexDeclaration:t&&i&&a&&o&&l&&s?e=xt.vertexDeclaration:t&&i&&a&&o&&l?e=Et.vertexDeclaration:t&&i&&n&&o&&l&&s?e=Qe.vertexDeclaration:t&&i&&n&&o&&l?e=qe.vertexDeclaration:t&&i&&n&&a&&r&&s?e=st.vertexDeclaration:t&&i&&n&&a&&r?e=tt.vertexDeclaration:t&&i&&a&&r&&s?e=Ct.vertexDeclaration:t&&i&&a&&r?e=ft.vertexDeclaration:t&&i&&n&&a&&s?e=ut.vertexDeclaration:t&&i&&a&&s&&h?e=Mt.vertexDeclaration:t&&i&&n&&a?e=et.vertexDeclaration:t&&i&&a&&s?e=wt.vertexDeclaration:t&&i&&a?e=pt.vertexDeclaration:t&&i&&n&&s?e=Je.vertexDeclaration:t&&i&&n&&(e=Ke.vertexDeclaration),e},v(0,e,"mesh",function(){return this._mesh}),y._attrReg=new RegExp("(\\w+)|([:,;])","g"),y}(),Nt=(f(Ot,"laya.d3.loaders.LoadModelV02"),Ot.parse=function(e,t,i,n,a,r){Ot._mesh=i,Ot._materials=n,Ot._subMeshes=a,Ot._materialMap=r,Ot._version=t,Ot._readData=e,Ot.READ_DATA(),Ot.READ_BLOCK(),Ot.READ_STRINGS();for(var s=0,o=Ot._BLOCK.count;s<o;s++){Ot._readData.pos=Ot._BLOCK.blockStarts[s];var l=Ot._readData.getUint16(),h=Ot._strings[l],c=Ot["READ_"+h];if(null==c)throw new Error("model file err,no this function:"+l+" "+h);c.call()}Ot._strings.length=0,Ot._readData=null,Ot._version=null,Ot._mesh=null,Ot._materials=null,Ot._subMeshes=null,Ot._materialMap=null},Ot._readString=function(){return Ot._strings[Ot._readData.getUint16()]},Ot.READ_DATA=function(){Ot._DATA.offset=Ot._readData.getUint32(),Ot._DATA.size=Ot._readData.getUint32()},Ot.READ_BLOCK=function(){for(var e=Ot._BLOCK.count=Ot._readData.getUint16(),t=Ot._BLOCK.blockStarts=[],i=Ot._BLOCK.blockLengths=[],n=0;n<e;n++)t.push(Ot._readData.getUint32()),i.push(Ot._readData.getUint32())},Ot.READ_STRINGS=function(){var e=Ot._readData.getUint32(),t=Ot._readData.getUint16(),i=Ot._readData.pos;Ot._readData.pos=e+Ot._DATA.offset;for(var n=0;n<t;n++)Ot._strings[n]=Ot._readData.readUTFString();Ot._readData.pos=i},Ot.READ_MATERIAL=function(){Ot._readString(),Ot._readString();var e=Ot._readString();return""!==e&&Ot._materials.push(Me.getRes(Ot._materialMap[e])),!0},Ot.READ_MESH=function(){Ot._readString();var e,t=Ot._readData.__getBuffer(),i=0,n=Ot._readData.getInt16(),a=Ot._DATA.offset;for(i=0;i<n;i++){var r=a+Ot._readData.getUint32(),s=Ot._readData.getUint32(),o=new Float32Array(t.slice(r,r+s)),l=Ot._readString().match(Ot._attrReg),h=Ot._getVertexDeclaration(l),c=On.create(h,4*o.length/h.vertexStride,35044,!0);c.setData(o),Ot._mesh._vertexBuffers.push(c)}var u=a+Ot._readData.getUint32(),d=Ot._readData.getUint32(),_=new Uint16Array(t.slice(u,u+d)),p=Nn.create("ushort",d/2,35044,!0);p.setData(_),Ot._mesh._indexBuffer=p;var f=Ot._mesh._boneNames=[],m=Ot._readData.getUint16();for(f.length=m,i=0;i<m;i++)f[i]=Ot._strings[Ot._readData.getUint16()];var g=Ot._readData.getUint32(),v=Ot._readData.getUint32(),y=(new Float32Array(t.slice(a+g,a+g+v)),Ot._readData.getUint32()),C=Ot._readData.getUint32(),E=new Float32Array(t.slice(a+y,a+y+C));for(Ot._mesh._inverseBindPoses=[],i=0,e=E.length;i<e;i+=16){var S=new qt(E[i+0],E[i+1],E[i+2],E[i+3],E[i+4],E[i+5],E[i+6],E[i+7],E[i+8],E[i+9],E[i+10],E[i+11],E[i+12],E[i+13],E[i+14],E[i+15]);Ot._mesh._inverseBindPoses.push(S)}return Ot._mesh._skinnedDatas=new Float32Array(16*E.length),!0},Ot.READ_SUBMESH=function(){var e=Ot._readData.__getBuffer(),t=new li(Ot._mesh),i=Ot._readData.getInt16(),n=Ot._readData.getUint32(),a=Ot._readData.getUint32();t._vertexBuffer=Ot._mesh._vertexBuffers[i],t._vertexStart=n,t._vertexCount=a;var r=Ot._readData.getUint32(),s=Ot._readData.getUint32(),o=Ot._mesh._indexBuffer;t._indexBuffer=o,t._indexStart=r,t._indexCount=s,t._indices=new Uint16Array(o.getData().buffer,2*r,s);var l=Ot._DATA.offset,h=t._subIndexBufferStart,c=t._subIndexBufferCount,u=t._boneIndicesList,d=Ot._readData.getUint16();h.length=d,c.length=d,u.length=d;for(var _=0;_<d;_++){h[_]=Ot._readData.getUint32(),c[_]=Ot._readData.getUint32();var p=Ot._readData.getUint32(),f=Ot._readData.getUint32();t._boneIndicesList[_]=new Uint8Array(e.slice(l+p,l+p+f))}return Ot._subMeshes.push(t),!0},Ot._getVertexDeclaration=function(e){for(var t,i=!1,n=!1,a=!1,r=!1,s=!1,o=!1,l=!1,h=!1,c=!1,u=0;u<e.length;u++)switch(e[u]){case"POSITION":i=!0;break;case"NORMAL":n=!0;break;case"COLOR":a=!0;break;case"UV":r=!0;break;case"UV1":s=!0;break;case"BLENDWEIGHT":l=!0;break;case"BLENDINDICES":h=!0;break;case"TANGENT":o=!0;break;case"BINORMAL":c=!0}return i&&n&&a&&r&&s&&l&&h&&o?t=at.vertexDeclaration:i&&n&&a&&r&&s&&l&&h?t=it.vertexDeclaration:i&&n&&r&&s&&l&&h&&o?t=vt.vertexDeclaration:i&&n&&r&&s&&l&&h?t=mt.vertexDeclaration:i&&n&&a&&r&&l&&h&&o?t=ht.vertexDeclaration:i&&n&&a&&r&&l&&h?t=ot.vertexDeclaration:i&&n&&r&&l&&h&&o?t=xt.vertexDeclaration:i&&n&&r&&l&&h?t=Et.vertexDeclaration:i&&n&&a&&l&&h&&o?t=Qe.vertexDeclaration:i&&n&&a&&l&&h?t=qe.vertexDeclaration:i&&n&&a&&r&&s&&o?t=st.vertexDeclaration:i&&n&&a&&r&&s?t=tt.vertexDeclaration:i&&n&&r&&s&&o?t=Ct.vertexDeclaration:i&&n&&r&&s?t=ft.vertexDeclaration:i&&n&&a&&r&&o?t=ut.vertexDeclaration:i&&n&&r&&o&&c?t=Mt.vertexDeclaration:i&&n&&a&&r?t=et.vertexDeclaration:i&&n&&r&&o?t=wt.vertexDeclaration:i&&n&&r?t=pt.vertexDeclaration:i&&n&&a&&o?t=Je.vertexDeclaration:i&&n&&a&&(t=Ke.vertexDeclaration),t},Ot._attrReg=new RegExp("(\\w+)|([:,;])","g"),Ot._strings=[],Ot._readData=null,Ot._version=null,Ot._mesh=null,Ot._materials=null,Ot._subMeshes=null,Ot._materialMap=null,u(Ot,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),Ot);function Ot(){}var kt=(f(Vt,"laya.d3.loaders.LoadModelV03"),Vt.parse=function(e,t,i,n,a){Vt._mesh=i,Vt._subMeshes=n,Vt._materialMap=a,Vt._version=t,Vt._readData=e,Vt.READ_DATA(),Vt.READ_BLOCK(),Vt.READ_STRINGS();for(var r=0,s=Vt._BLOCK.count;r<s;r++){Vt._readData.pos=Vt._BLOCK.blockStarts[r];var o=Vt._readData.getUint16(),l=Vt._strings[o],h=Vt["READ_"+l];if(null==h)throw new Error("model file err,no this function:"+o+" "+l);h.call()}Vt._strings.length=0,Vt._readData=null,Vt._version=null,Vt._mesh=null,Vt._subMeshes=null,Vt._materialMap=null},Vt._readString=function(){return Vt._strings[Vt._readData.getUint16()]},Vt.READ_DATA=function(){Vt._DATA.offset=Vt._readData.getUint32(),Vt._DATA.size=Vt._readData.getUint32()},Vt.READ_BLOCK=function(){for(var e=Vt._BLOCK.count=Vt._readData.getUint16(),t=Vt._BLOCK.blockStarts=[],i=Vt._BLOCK.blockLengths=[],n=0;n<e;n++)t.push(Vt._readData.getUint32()),i.push(Vt._readData.getUint32())},Vt.READ_STRINGS=function(){var e=Vt._readData.getUint32(),t=Vt._readData.getUint16(),i=Vt._readData.pos;Vt._readData.pos=e+Vt._DATA.offset;for(var n=0;n<t;n++)Vt._strings[n]=Vt._readData.readUTFString();Vt._readData.pos=i},Vt.READ_MESH=function(){Vt._readString();var e,t=Vt._readData.__getBuffer(),i=0,n=Vt._readData.getInt16(),a=Vt._DATA.offset;for(i=0;i<n;i++){var r,s=a+Vt._readData.getUint32(),o=Vt._readData.getUint32(),l=new Float32Array(t.slice(s,s+o)),h=Vt._readString();switch(Vt._version){case"LAYAMODEL:03":r=Vt._vertexDeclarationMap_Discard[h];break;case"LAYAMODEL:0301":r=Vt._vertexDeclarationMap[h];break;default:throw new Error("LoadModelV03: unknown version.")}if(!r)throw new Error("LoadModelV03: unknown vertexDeclaration.");var c=On.create(r,4*l.length/r.vertexStride,35044,!0);c.setData(l),Vt._mesh._vertexBuffers.push(c)}var u=a+Vt._readData.getUint32(),d=Vt._readData.getUint32(),_=new Uint16Array(t.slice(u,u+d)),p=Nn.create("ushort",d/2,35044,!0);p.setData(_),Vt._mesh._indexBuffer=p;var f=Vt._mesh._boneNames=[],m=Vt._readData.getUint16();for(f.length=m,i=0;i<m;i++)f[i]=Vt._strings[Vt._readData.getUint16()];Vt._readData.pos+=8;var g=Vt._readData.getUint32(),v=Vt._readData.getUint32(),y=new Float32Array(t.slice(a+g,a+g+v));for(Vt._mesh._inverseBindPoses=[],i=0,e=y.length;i<e;i+=16){var C=new qt(y[i+0],y[i+1],y[i+2],y[i+3],y[i+4],y[i+5],y[i+6],y[i+7],y[i+8],y[i+9],y[i+10],y[i+11],y[i+12],y[i+13],y[i+14],y[i+15]);Vt._mesh._inverseBindPoses.push(C)}return Vt._mesh._skinnedDatas=new Float32Array(16*y.length),!0},Vt.READ_SUBMESH=function(){var e=Vt._readData.__getBuffer(),t=new li(Vt._mesh),i=Vt._readData.getInt16(),n=Vt._readData.getUint32(),a=Vt._readData.getUint32();t._vertexBuffer=Vt._mesh._vertexBuffers[i],t._vertexStart=n,t._vertexCount=a;var r=Vt._readData.getUint32(),s=Vt._readData.getUint32(),o=Vt._mesh._indexBuffer;t._indexBuffer=o,t._indexStart=r,t._indexCount=s,t._indices=new Uint16Array(o.getData().buffer,2*r,s);var l=Vt._DATA.offset,h=t._subIndexBufferStart,c=t._subIndexBufferCount,u=t._boneIndicesList,d=Vt._readData.getUint16();h.length=d,c.length=d,u.length=d;for(var _=0;_<d;_++){h[_]=Vt._readData.getUint32(),c[_]=Vt._readData.getUint32();var p=Vt._readData.getUint32(),f=Vt._readData.getUint32();u[_]=new Uint8Array(e.slice(l+p,l+p+f))}return Vt._subMeshes.push(t),!0},Vt._strings=[],Vt._readData=null,Vt._version=null,Vt._mesh=null,Vt._subMeshes=null,Vt._materialMap=null,u(Vt,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":at.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":it.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":bt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":vt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":mt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":ht.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":ot.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":xt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":Et.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":Qe.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":qe.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":st.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":tt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":Ct.vertexDeclaration,"POSITION,NORMAL,UV,UV1":ft.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":ut.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":Mt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":et.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":wt.vertexDeclaration,"POSITION,NORMAL,UV":pt.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":Je.vertexDeclaration,"POSITION,NORMAL,COLOR":Ke.vertexDeclaration,"POSITION,NORMAL,TANGENT":_t.vertexDeclaration,"POSITION,NORMAL":Ye.vertexDeclaration,"POSITION,UV":At.vertexDeclaration,POSITION:je.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":nt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":it.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":bt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":gt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":mt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":lt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":ot.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":St.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":Et.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":Ze.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":qe.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":rt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":tt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":yt.vertexDeclaration,"POSITION,NORMAL,UV,UV1":ft.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":ct.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":Mt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":et.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":Tt.vertexDeclaration,"POSITION,NORMAL,UV":pt.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$e.vertexDeclaration,"POSITION,NORMAL,COLOR":Ke.vertexDeclaration,"POSITION,NORMAL,TANGENT":dt.vertexDeclaration,"POSITION,NORMAL":Ye.vertexDeclaration,"POSITION,UV":At.vertexDeclaration,POSITION:je.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),Vt);function Vt(){}var Bt=(f(Ft,"laya.d3.loaders.MeshReader"),Ft.read=function(e,t,i,n,a){var r=new C(e);r.pos=0;var s=r.readUTFString();switch(s){case"LAYAMODEL:01":case"LAYASKINANI:01":Ft._readVersion01(r,s,t,i,n,a);break;case"LAYAMODEL:02":Nt.parse(r,s,t,i,n,a);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":kt.parse(r,s,t,n,a);break;default:throw new Error("MeshReader: unknown mesh version.")}t._setSubMeshes(n)},Ft._readVersion01=function(e,t,i,n,a,r){new Pt(e,t,i,n,a,r)},Ft);function Ft(){}var Ht=function(){function e(e,t){this.min=null,this.max=null,this.min=e,this.max=t}f(e,"laya.d3.math.BoundBox");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t.getCorners=function(e){e.length=8;var t=this.min.elements,i=this.max.elements,n=t[0],a=t[1],r=t[2],s=i[0],o=i[1],l=i[2];e[0]=new ai(n,o,l),e[1]=new ai(s,o,l),e[2]=new ai(s,a,l),e[3]=new ai(n,a,l),e[4]=new ai(n,o,r),e[5]=new ai(s,o,r),e[6]=new ai(s,a,r),e[7]=new ai(n,a,r)},t.toDefault=function(){this.min.toDefault(),this.max.toDefault()},t.cloneTo=function(e){var t=e;this.min.cloneTo(t.min),this.max.cloneTo(t.max)},t.clone=function(){var e=new this.constructor(new ai,new ai);return this.cloneTo(e),e},e.createfromPoints=function(e,t){if(null==e)throw new Error("points");var i=t.min,n=t.max,a=i.elements;a[0]=Number.MAX_VALUE,a[1]=Number.MAX_VALUE,a[2]=Number.MAX_VALUE;var r=n.elements;r[0]=-Number.MAX_VALUE,r[1]=-Number.MAX_VALUE,r[2]=-Number.MAX_VALUE;for(var s=0,o=e.length;s<o;++s)ai.min(i,e[s],i),ai.max(n,e[s],n)},e.merge=function(e,t,i){ai.min(e.min,t.min,i.min),ai.max(e.max,t.max,i.max)},e}(),Ut=function(){function h(e){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=e,this._near=new Qt(new ai),this._far=new Qt(new ai),this._left=new Qt(new ai),this._right=new Qt(new ai),this._top=new Qt(new ai),this._bottom=new Qt(new ai),h._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}f(h,"laya.d3.math.BoundFrustum");var e=h.prototype;return e.equalsBoundFrustum=function(e){return this._matrix.equalsOtherMatrix(e.matrix)},e.equalsObj=function(e){if(e instanceof laya.d3.math.BoundFrustum){var t=e;return this.equalsBoundFrustum(t)}return!1},e.getPlane=function(e){switch(e){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},e.getCorners=function(e){h._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(e[0]),h._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(e[1]),h._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(e[2]),h._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(e[3]),h._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(e[4]),h._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(e[5]),h._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(e[6]),h._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(e[7])},e.containsPoint=function(e){for(var t=Qt.PlaneIntersectionType_Front,i=Qt.PlaneIntersectionType_Front,n=0;n<6;n++){switch(n){case 0:i=zt.intersectsPlaneAndPoint(this._near,e);break;case 1:i=zt.intersectsPlaneAndPoint(this._far,e);break;case 2:i=zt.intersectsPlaneAndPoint(this._left,e);break;case 3:i=zt.intersectsPlaneAndPoint(this._right,e);break;case 4:i=zt.intersectsPlaneAndPoint(this._top,e);break;case 5:i=zt.intersectsPlaneAndPoint(this._bottom,e)}switch(i){case Qt.PlaneIntersectionType_Back:return 0;case Qt.PlaneIntersectionType_Intersecting:t=Qt.PlaneIntersectionType_Intersecting}}switch(t){case Qt.PlaneIntersectionType_Intersecting:return 2;default:return 1}},e.containsBoundBox=function(e){for(var t,i=h._tempV30,n=h._tempV31,a=1,r=0;r<6;r++){if(t=this.getPlane(r),this._getBoxToPlanePVertexNVertex(e,t.normal,i,n),zt.intersectsPlaneAndPoint(t,i)===Qt.PlaneIntersectionType_Back)return 0;zt.intersectsPlaneAndPoint(t,n)===Qt.PlaneIntersectionType_Back&&(a=2)}return a},e.containsBoundSphere=function(e){for(var t=Qt.PlaneIntersectionType_Front,i=Qt.PlaneIntersectionType_Front,n=0;n<6;n++){switch(n){case 0:i=zt.intersectsPlaneAndSphere(this._near,e);break;case 1:i=zt.intersectsPlaneAndSphere(this._far,e);break;case 2:i=zt.intersectsPlaneAndSphere(this._left,e);break;case 3:i=zt.intersectsPlaneAndSphere(this._right,e);break;case 4:i=zt.intersectsPlaneAndSphere(this._top,e);break;case 5:i=zt.intersectsPlaneAndSphere(this._bottom,e)}switch(i){case Qt.PlaneIntersectionType_Back:return 0;case Qt.PlaneIntersectionType_Intersecting:t=Qt.PlaneIntersectionType_Intersecting}}switch(t){case Qt.PlaneIntersectionType_Intersecting:return 2;default:return 1}},e._getBoxToPlanePVertexNVertex=function(e,t,i,n){var a=e.min,r=a.elements,s=e.max,o=s.elements,l=t.elements,h=l[0],c=l[1],u=l[2];a.cloneTo(i);var d=i.elements;0<=h&&(d[0]=o[0]),0<=c&&(d[1]=o[1]),0<=u&&(d[2]=o[2]),s.cloneTo(n);var _=n.elements;0<=h&&(_[0]=r[0]),0<=c&&(_[1]=r[1]),0<=u&&(_[2]=r[2])},v(0,e,"top",function(){return this._top}),v(0,e,"matrix",function(){return this._matrix},function(e){this._matrix=e,h._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),v(0,e,"near",function(){return this._near}),v(0,e,"far",function(){return this._far}),v(0,e,"left",function(){return this._left}),v(0,e,"right",function(){return this._right}),v(0,e,"bottom",function(){return this._bottom}),h._getPlanesFromMatrix=function(e,t,i,n,a,r,s){var o=e.elements,l=o[0],h=o[1],c=o[2],u=o[3],d=o[4],_=o[5],p=o[6],f=o[7],m=o[8],g=o[9],v=o[10],y=o[11],C=o[12],E=o[13],S=o[14],x=o[15],T=t.normal.elements;T[0]=u+c,T[1]=f+p,T[2]=y+v,t.distance=x+S,t.normalize();var w=i.normal.elements;w[0]=u-c,w[1]=f-p,w[2]=y-v,i.distance=x-S,i.normalize();var M=n.normal.elements;M[0]=u+l,M[1]=f+d,M[2]=y+m,n.distance=x+C,n.normalize();var b=a.normal.elements;b[0]=u-l,b[1]=f-d,b[2]=y-m,a.distance=x-C,a.normalize();var R=r.normal.elements;R[0]=u-h,R[1]=f-_,R[2]=y-g,r.distance=x-E,r.normalize();var L=s.normal.elements;L[0]=u+h,L[1]=f+_,L[2]=y+g,s.distance=x+E,s.normalize()},h._get3PlaneInterPoint=function(e,t,i){var n=e.normal,a=t.normal,r=i.normal;ai.cross(a,r,h._tempV30),ai.cross(r,n,h._tempV31),ai.cross(n,a,h._tempV32);var s=ai.dot(n,h._tempV30),o=ai.dot(a,h._tempV31),l=ai.dot(r,h._tempV32);return ai.scale(h._tempV30,-e.distance/s,h._tempV33),ai.scale(h._tempV31,-t.distance/o,h._tempV34),ai.scale(h._tempV32,-i.distance/l,h._tempV35),ai.add(h._tempV33,h._tempV34,h._tempV36),ai.add(h._tempV35,h._tempV36,h._tempV37),h._tempV37},u(h,["_tempV30",function(){return this._tempV30=new ai},"_tempV31",function(){return this._tempV31=new ai},"_tempV32",function(){return this._tempV32=new ai},"_tempV33",function(){return this._tempV33=new ai},"_tempV34",function(){return this._tempV34=new ai},"_tempV35",function(){return this._tempV35=new ai},"_tempV36",function(){return this._tempV36=new ai},"_tempV37",function(){return this._tempV37=new ai}]),h}(),Gt=function(){function c(e,t){this.center=null,this.radius=NaN,this.center=e,this.radius=t}f(c,"laya.d3.math.BoundSphere");var e=c.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e.toDefault=function(){this.center.toDefault(),this.radius=0},e.intersectsRayDistance=function(e){return zt.intersectsRayAndSphereRD(e,this)},e.intersectsRayPoint=function(e,t){return zt.intersectsRayAndSphereRP(e,this,t)},e.cloneTo=function(e){var t=e;this.center.cloneTo(t.center),t.radius=this.radius},e.clone=function(){var e=new this.constructor(new ai,new ai);return this.cloneTo(e),e},c.createFromSubPoints=function(e,t,i,n){if(null==e)throw new Error("points");if(t<0||t>=e.length)throw new Error("start"+t+"Must be in the range [0, "+(e.length-1)+"]");if(i<0||t+i>e.length)throw new Error("count"+i+"Must be in the range <= "+e.length+"}");var a=t+i,r=c._tempVector3;r.elements[0]=0,r.elements[1]=0,r.elements[2]=0;for(var s=t;s<a;++s)ai.add(e[s],r,r);var o=n.center;ai.scale(r,1/i,o);var l=0;for(s=t;s<a;++s){var h=ai.distanceSquared(o,e[s]);l<h&&(l=h)}n.radius=Math.sqrt(l)},c.createfromPoints=function(e,t){if(null==e)throw new Error("points");c.createFromSubPoints(e,0,e.length,t)},u(c,["_tempVector3",function(){return this._tempVector3=new ai}]),c}(),zt=(f(Wt,"laya.d3.math.Collision"),Wt.distancePlaneToPoint=function(e,t){return ai.dot(e.normal,t)-e.distance},Wt.distanceBoxToPoint=function(e,t){var i=e.min.elements,n=i[0],a=i[1],r=i[2],s=e.max.elements,o=s[0],l=s[1],h=s[2],c=t.elements,u=c[0],d=c[1],_=c[2],p=0;return u<n&&(p+=(n-u)*(n-u)),o<u&&(p+=(o-u)*(o-u)),d<a&&(p+=(a-d)*(a-d)),l<d&&(p+=(l-d)*(l-d)),_<r&&(p+=(r-_)*(r-_)),h<_&&(p+=(h-_)*(h-_)),Math.sqrt(p)},Wt.distanceBoxToBox=function(e,t){var i=e.min.elements,n=i[0],a=i[1],r=i[2],s=e.max.elements,o=s[0],l=s[1],h=s[2],c=t.min.elements,u=c[0],d=c[1],_=c[2],p=t.max.elements,f=p[0],m=p[1],g=p[2],v=0,y=NaN;return f<n?v+=(y=n-f)*y:o<u&&(v+=(y=u-o)*y),m<a?v+=(y=a-m)*y:l<d&&(v+=(y=d-l)*y),g<r?v+=(y=r-g)*y:h<_&&(v+=(y=_-h)*y),Math.sqrt(v)},Wt.distanceSphereToPoint=function(e,t){var i=Math.sqrt(ai.distanceSquared(e.center,t));return i-=e.radius,Math.max(i,0)},Wt.distanceSphereToSphere=function(e,t){var i=Math.sqrt(ai.distanceSquared(e.center,t.center));return i-=e.radius+t.radius,Math.max(i,0)},Wt.intersectsRayAndTriangleRD=function(e,t,i,n,a){var r=e.origin.elements,s=r[0],o=r[1],l=r[2],h=e.direction.elements,c=h[0],u=h[1],d=h[2],_=t.elements,p=_[0],f=_[1],m=_[2],g=i.elements,v=g[0],y=g[1],C=g[2],E=n.elements,S=E[0],x=E[1],T=E[2],w=Wt._tempV30.elements,M=w[0],b=w[1],R=w[2];M=v-p,b=y-f,R=C-m;var L=Wt._tempV31.elements,A=L[0],I=L[1],D=L[2];A=S-p,I=x-f,D=T-m;var P=Wt._tempV32.elements,N=P[0],O=P[1],k=P[2],V=M*(N=u*D-d*I)+b*(O=d*A-c*D)+R*(k=c*I-u*A);if(jt.isZero(V))return!1;var B=1/V,F=Wt._tempV33.elements,H=F[0],U=F[1],G=F[2],z=(H=s-p)*N+(U=o-f)*O+(G=l-m)*k;if((z*=B)<0||1<z)return!1;var W=Wt._tempV34.elements,X=W[0],j=W[1],Y=W[2],K=c*(X=U*R-G*b)+u*(j=G*M-H*R)+d*(Y=H*b-U*M);if((K*=B)<0||1<z+K)return!1;var q=A*X+I*j+D*Y;return!((q*=B)<0)},Wt.intersectsRayAndTriangleRP=function(e,t,i,n,a){return Wt.intersectsRayAndTriangleRD(e,t,i,n,NaN)?(ai.scale(e.direction,NaN,Wt._tempV30),ai.add(e.origin,Wt._tempV30,a),!0):(a=ai.ZERO,!1)},Wt.intersectsRayAndPoint=function(e,t){ai.subtract(e.origin,t,Wt._tempV30);var i=ai.dot(Wt._tempV30,e.direction),n=ai.dot(Wt._tempV30,Wt._tempV30)-jt.zeroTolerance;return!(0<n&&0<i||i*i-n<0)},Wt.intersectsRayAndRay=function(e,t,i){var n=e.origin,a=n.elements,r=a[0],s=a[1],o=a[2],l=e.direction,h=l.elements,c=h[0],u=h[1],d=h[2],_=t.origin,p=_.elements,f=p[0],m=p[1],g=p[2],v=t.direction,y=v.elements,C=y[0],E=y[1],S=y[2];ai.cross(l,v,Wt._tempV30);var x=Wt._tempV30.elements,T=ai.scalarLengthSquared(Wt._tempV30);if(jt.isZero(T)&&jt.nearEqual(f,r)&&jt.nearEqual(m,s)&&jt.nearEqual(g,o))return ai.ZERO.cloneTo(i),!0;var w=f-r,M=m-s,b=g-o,R=C,L=E,A=S,I=x[0],D=x[1],P=x[2],N=(w*L*P+M*A*I+b*R*D-w*A*D-M*R*P-b*L*I)/T,O=(w*(L=u)*P+M*(A=d)*I+b*(R=c)*D-w*A*D-M*R*P-b*L*I)/T;ai.scale(l,N,Wt._tempV30),ai.scale(v,O,Wt._tempV31),ai.add(n,Wt._tempV30,Wt._tempV32),ai.add(_,Wt._tempV31,Wt._tempV33);var k=Wt._tempV32.elements,V=Wt._tempV33.elements;return jt.nearEqual(V[0],k[0])&&jt.nearEqual(V[1],k[1])&&jt.nearEqual(V[2],k[2])?(Wt._tempV32.cloneTo(i),!0):(ai.ZERO.cloneTo(i),!1)},Wt.intersectsPlaneAndTriangle=function(e,t,i,n){var a=Wt.intersectsPlaneAndPoint(e,t),r=Wt.intersectsPlaneAndPoint(e,i),s=Wt.intersectsPlaneAndPoint(e,n);return a==Qt.PlaneIntersectionType_Front&&r==Qt.PlaneIntersectionType_Front&&s==Qt.PlaneIntersectionType_Front?Qt.PlaneIntersectionType_Front:a==Qt.PlaneIntersectionType_Back&&r==Qt.PlaneIntersectionType_Back&&s==Qt.PlaneIntersectionType_Back?Qt.PlaneIntersectionType_Back:Qt.PlaneIntersectionType_Intersecting},Wt.intersectsRayAndPlaneRD=function(e,t,i){var n=t.normal,a=ai.dot(n,e.direction);if(jt.isZero(a))return!1;var r=ai.dot(n,e.origin);return!((-t.distance-r)/a<0)},Wt.intersectsRayAndPlaneRP=function(e,t,i){return Wt.intersectsRayAndPlaneRD(e,t,NaN)?(ai.scale(e.direction,NaN,Wt._tempV30),ai.add(e.origin,Wt._tempV30,Wt._tempV31),!0):(ai.ZERO,!1)},Wt.intersectsRayAndBoxRD=function(e,t){var i=e.origin.elements,n=i[0],a=i[1],r=i[2],s=e.direction.elements,o=s[0],l=s[1],h=s[2],c=t.min.elements,u=c[0],d=c[1],_=c[2],p=t.max.elements,f=p[0],m=p[1],g=p[2],v=0,y=jt.MaxValue;if(jt.isZero(o)){if(n<u||f<n)return-1}else{var C=1/o,E=(u-n)*C,S=(f-n)*C;if(S<E){var x=E;E=S,S=x}if(v=Math.max(E,v),(y=Math.min(S,y))<v)return-1}if(jt.isZero(l)){if(a<d||m<a)return-1}else{var T=1/l,w=(d-a)*T,M=(m-a)*T;if(M<w){var b=w;w=M,M=b}if(v=Math.max(w,v),(y=Math.min(M,y))<v)return-1}if(jt.isZero(h)){if(r<_||g<r)return-1}else{var R=1/h,L=(_-r)*R,A=(g-r)*R;if(A<L){var I=L;L=A,A=I}if(v=Math.max(L,v),(y=Math.min(A,y))<v)return-1}return v},Wt.intersectsRayAndBoxRP=function(e,t,i){var n=Wt.intersectsRayAndBoxRD(e,t);return-1===n?ai.ZERO.cloneTo(i):(ai.scale(e.direction,n,Wt._tempV30),ai.add(e.origin,Wt._tempV30,Wt._tempV31),Wt._tempV31.cloneTo(i)),n},Wt.intersectsRayAndSphereRD=function(e,t){var i=t.radius;ai.subtract(e.origin,t.center,Wt._tempV30);var n=ai.dot(Wt._tempV30,e.direction),a=ai.dot(Wt._tempV30,Wt._tempV30)-i*i;if(0<a&&0<n)return-1;var r=n*n-a;if(r<0)return-1;var s=-n-Math.sqrt(r);return s<0&&(s=0),s},Wt.intersectsRayAndSphereRP=function(e,t,i){var n=Wt.intersectsRayAndSphereRD(e,t);return-1===n?ai.ZERO.cloneTo(i):(ai.scale(e.direction,n,Wt._tempV30),ai.add(e.origin,Wt._tempV30,Wt._tempV31),Wt._tempV31.cloneTo(i)),n},Wt.intersectsSphereAndTriangle=function(e,t,i,n){var a=e.center,r=e.radius;return Wt.closestPointPointTriangle(a,t,i,n,Wt._tempV30),ai.subtract(Wt._tempV30,a,Wt._tempV31),ai.dot(Wt._tempV31,Wt._tempV31)<=r*r},Wt.intersectsPlaneAndPoint=function(e,t){var i=ai.dot(e.normal,t)+e.distance;return 0<i?Qt.PlaneIntersectionType_Front:i<0?Qt.PlaneIntersectionType_Back:Qt.PlaneIntersectionType_Intersecting},Wt.intersectsPlaneAndPlane=function(e,t){ai.cross(e.normal,t.normal,Wt._tempV30);var i=ai.dot(Wt._tempV30,Wt._tempV30);return!jt.isZero(i)},Wt.intersectsPlaneAndPlaneRL=function(e,t,i){var n=e.normal,a=t.normal;ai.cross(n,a,Wt._tempV34);var r=ai.dot(Wt._tempV34,Wt._tempV34);return!jt.isZero(r)&&(ai.scale(a,e.distance,Wt._tempV30),ai.scale(n,t.distance,Wt._tempV31),ai.subtract(Wt._tempV30,Wt._tempV31,Wt._tempV32),ai.cross(Wt._tempV32,Wt._tempV34,Wt._tempV33),ai.normalize(Wt._tempV34,Wt._tempV34),new ti(Wt._tempV33,Wt._tempV34),!0)},Wt.intersectsPlaneAndBox=function(e,t){var i=e.distance,n=e.normal,a=n.elements,r=a[0],s=a[1],o=a[2],l=t.min.elements,h=l[0],c=l[1],u=l[2],d=t.max.elements,_=d[0],p=d[1],f=d[2];Wt._tempV30.elements[0]=0<r?h:_,Wt._tempV30.elements[1]=0<s?c:p,Wt._tempV30.elements[2]=0<o?u:f,Wt._tempV31.elements[0]=0<r?_:h,Wt._tempV31.elements[1]=0<s?p:c,Wt._tempV31.elements[2]=0<o?f:u;var m=ai.dot(n,Wt._tempV30);return 0<m+i?Qt.PlaneIntersectionType_Front:(m=ai.dot(n,Wt._tempV31))+i<0?Qt.PlaneIntersectionType_Back:Qt.PlaneIntersectionType_Intersecting},Wt.intersectsPlaneAndSphere=function(e,t){var i=t.radius,n=ai.dot(e.normal,t.center)+e.distance;return i<n?Qt.PlaneIntersectionType_Front:n<-i?Qt.PlaneIntersectionType_Back:Qt.PlaneIntersectionType_Intersecting},Wt.intersectsBoxAndBox=function(e,t){var i=e.min.elements,n=e.max.elements,a=t.min.elements,r=t.max.elements;return!(i[0]>r[0]||a[0]>n[0]||i[1]>r[1]||a[1]>n[1]||i[2]>r[2]||a[2]>n[2])},Wt.intersectsBoxAndSphere=function(e,t){var i=t.center,n=t.radius;return ai.Clamp(i,e.min,e.max,Wt._tempV30),ai.distanceSquared(i,Wt._tempV30)<=n*n},Wt.intersectsSphereAndSphere=function(e,t){var i=e.radius+t.radius;return ai.distanceSquared(e.center,t.center)<=i*i},Wt.boxContainsPoint=function(e,t){var i=e.min.elements,n=e.max.elements,a=t.elements;return i[0]<=a[0]&&n[0]>=a[0]&&i[1]<=a[1]&&n[1]>=a[1]&&i[2]<=a[2]&&n[2]>=a[2]?1:0},Wt.boxContainsBox=function(e,t){var i=e.min.elements,n=i[0],a=i[1],r=i[2],s=e.max.elements,o=s[0],l=s[1],h=s[2],c=t.min.elements,u=c[0],d=c[1],_=c[2],p=t.max.elements,f=p[0],m=p[1],g=p[2];return o<u||f<n?0:l<d||m<a?0:h<_||g<r?0:n<=u&&f<=f&&a<=d&&m<=l&&r<=_&&g<=h?1:2},Wt.boxContainsSphere=function(e,t){var i=e.min,n=i.elements,a=n[0],r=n[1],s=n[2],o=e.max,l=o.elements,h=l[0],c=l[1],u=l[2],d=t.center,_=d.elements,p=_[0],f=_[1],m=_[2],g=t.radius;return ai.Clamp(d,i,o,Wt._tempV30),g*g<ai.distanceSquared(d,Wt._tempV30)?0:a+g<=p&&p<=h-g&&g<h-a&&r+g<=f&&f<=c-g&&g<c-r&&s+g<=m&&m<=u-g&&g<u-s?1:2},Wt.sphereContainsPoint=function(e,t){return ai.distanceSquared(t,e.center)<=e.radius*e.radius?1:0},Wt.sphereContainsTriangle=function(e,t,i,n){var a=Wt.sphereContainsPoint(e,t),r=Wt.sphereContainsPoint(e,i),s=Wt.sphereContainsPoint(e,n);return 1==a&&1==r&&1==s?1:Wt.intersectsSphereAndTriangle(e,t,i,n)?2:0},Wt.sphereContainsBox=function(e,t){var i=e.center.elements,n=(i[0],i[1],i[2],e.radius),a=t.min.elements,r=(a[0],a[1],a[2],t.max.elements),s=(r[0],r[1],r[2],Wt._tempV30.elements);if(s[0],s[1],s[2],!Wt.intersectsBoxAndSphere(t,e))return 0;var o=n*n;return ai.scalarLengthSquared(Wt._tempV30)>o?2:ai.scalarLengthSquared(Wt._tempV30)>o?2:ai.scalarLengthSquared(Wt._tempV30)>o?2:ai.scalarLengthSquared(Wt._tempV30)>o?2:ai.scalarLengthSquared(Wt._tempV30)>o?2:ai.scalarLengthSquared(Wt._tempV30)>o?2:ai.scalarLengthSquared(Wt._tempV30)>o?2:ai.scalarLengthSquared(Wt._tempV30)>o?2:1},Wt.sphereContainsSphere=function(e,t){var i=e.radius,n=t.radius,a=ai.distance(e.center,t.center);return i+n<a?0:i-n<a?2:1},Wt.closestPointPointTriangle=function(e,t,i,n,a){ai.subtract(i,t,Wt._tempV30),ai.subtract(n,t,Wt._tempV31),ai.subtract(e,t,Wt._tempV32),ai.subtract(e,i,Wt._tempV33),ai.subtract(e,n,Wt._tempV34);var r=ai.dot(Wt._tempV30,Wt._tempV32),s=ai.dot(Wt._tempV31,Wt._tempV32),o=ai.dot(Wt._tempV30,Wt._tempV33),l=ai.dot(Wt._tempV31,Wt._tempV33),h=ai.dot(Wt._tempV30,Wt._tempV34),c=ai.dot(Wt._tempV31,Wt._tempV34);if(r<=0&&s<=0)t.cloneTo(a);else if(0<=o&&l<=o)i.cloneTo(a);else{var u=r*l-o*s;if(u<=0&&0<=r&&o<=0){var d=r/(r-o);return ai.scale(Wt._tempV30,d,a),void ai.add(t,a,a)}if(0<=c&&h<=c)n.cloneTo(a);else{var _=h*s-r*c;if(_<=0&&0<=s&&c<=0){var p=s/(s-c);return ai.scale(Wt._tempV31,p,a),void ai.add(t,a,a)}var f=o*c-h*l;if(f<=0&&0<=l-o&&0<=h-c){var m=(l-o)/(l-o+(h-c));return ai.subtract(n,i,a),ai.scale(a,m,a),void ai.add(i,a,a)}var g=1/(f+_+u),v=_*g,y=u*g;ai.scale(Wt._tempV30,v,Wt._tempV35),ai.scale(Wt._tempV31,y,Wt._tempV36),ai.add(Wt._tempV35,Wt._tempV36,a),ai.add(t,a,a)}}},Wt.closestPointPlanePoint=function(e,t,i){var n=e.normal,a=ai.dot(n,t)-e.distance;ai.scale(n,a,Wt._tempV30),ai.subtract(t,Wt._tempV30,i)},Wt.closestPointBoxPoint=function(e,t,i){ai.max(t,e.min,Wt._tempV30),ai.min(Wt._tempV30,e.max,i)},Wt.closestPointSpherePoint=function(e,t,i){var n=e.center;ai.subtract(t,n,i),ai.normalize(i,i),ai.scale(i,e.radius,i),ai.add(i,n,i)},Wt.closestPointSphereSphere=function(e,t,i){var n=e.center;ai.subtract(t.center,n,i),ai.normalize(i,i),ai.scale(i,e.radius,i),ai.add(i,n,i)},u(Wt,["_tempV30",function(){return this._tempV30=new ai},"_tempV31",function(){return this._tempV31=new ai},"_tempV32",function(){return this._tempV32=new ai},"_tempV33",function(){return this._tempV33=new ai},"_tempV34",function(){return this._tempV34=new ai},"_tempV35",function(){return this._tempV35=new ai},"_tempV36",function(){return this._tempV36=new ai}]),Wt);function Wt(){}f(Xt,"laya.d3.math.ContainmentType"),Xt.Disjoint=0,Xt.Contains=1,Xt.Intersects=2;function Xt(){}var jt=(f(Yt,"laya.d3.math.MathUtils3D"),Yt.isZero=function(e){return Math.abs(e)<Yt.zeroTolerance},Yt.nearEqual=function(e,t){return!!Yt.isZero(e-t)},Yt.fastInvSqrt=function(e){return Yt.isZero(e)?e:1/Math.sqrt(e)},u(Yt,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),Yt);function Yt(){}var Kt=function(){function l(){var e=this.elements=new Float32Array(9);e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}f(l,"laya.d3.math.Matrix3x3");var e=l.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e.determinant=function(){var e=this.elements,t=e[0],i=e[1],n=e[2],a=e[3],r=e[4],s=e[5],o=e[6],l=e[7],h=e[8];return t*(h*r-s*l)+i*(-h*a+s*o)+n*(l*a-r*o)},e.translate=function(e,t){var i=t.elements,n=this.elements,a=e.elements,r=n[0],s=n[1],o=n[2],l=n[3],h=n[4],c=n[5],u=n[6],d=n[7],_=n[8],p=a[0],f=a[1];i[0]=r,i[1]=s,i[2]=o,i[3]=l,i[4]=h,i[5]=c,i[6]=p*r+f*l+u,i[7]=p*s+f*h+d,i[8]=p*o+f*c+_},e.rotate=function(e,t){var i=t.elements,n=this.elements,a=n[0],r=n[1],s=n[2],o=n[3],l=n[4],h=n[5],c=n[6],u=n[7],d=n[8],_=Math.sin(e),p=Math.cos(e);i[0]=p*a+_*o,i[1]=p*r+_*l,i[2]=p*s+_*h,i[3]=p*o-_*a,i[4]=p*l-_*r,i[5]=p*h-_*s,i[6]=c,i[7]=u,i[8]=d},e.scale=function(e,t){var i=t.elements,n=this.elements,a=e.elements,r=a[0],s=a[1];i[0]=r*n[0],i[1]=r*n[1],i[2]=r*n[2],i[3]=s*n[3],i[4]=s*n[4],i[5]=s*n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8]},e.invert=function(e){var t=e.elements,i=this.elements,n=i[0],a=i[1],r=i[2],s=i[3],o=i[4],l=i[5],h=i[6],c=i[7],u=i[8],d=u*o-l*c,_=-u*s+l*h,p=c*s-o*h,f=n*d+a*_+r*p;f||(e=null),f=1/f,t[0]=d*f,t[1]=(-u*a+r*c)*f,t[2]=(l*a-r*o)*f,t[3]=_*f,t[4]=(u*n-r*h)*f,t[5]=(-l*n+r*s)*f,t[6]=p*f,t[7]=(-c*n+a*h)*f,t[8]=(o*n-a*s)*f},e.transpose=function(e){var t=e.elements,i=this.elements;if(e===this){var n=i[1],a=i[2],r=i[5];t[1]=i[3],t[2]=i[6],t[3]=n,t[5]=i[7],t[6]=a,t[7]=r}else t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8]},e.identity=function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1},e.cloneTo=function(e){var t,i,n;if((i=this.elements)!==(n=e.elements))for(t=0;t<9;++t)n[t]=i[t]},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},l.createFromTranslation=function(e,t){t.elements;var i=e.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=i[0],t[7]=i[1],t[8]=1},l.createFromRotation=function(e,t){var i=t.elements,n=Math.sin(e),a=Math.cos(e);i[0]=a,i[1]=n,i[2]=0,i[3]=-n,i[4]=a,i[5]=0,i[6]=0,i[7]=0,i[8]=1},l.createFromScaling=function(e,t){var i=t.elements,n=e.elements;i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=n[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1},l.createFromMatrix4x4=function(e,t){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10]},l.multiply=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements,s=a[0],o=a[1],l=a[2],h=a[3],c=a[4],u=a[5],d=a[6],_=a[7],p=a[8],f=r[0],m=r[1],g=r[2],v=r[3],y=r[4],C=r[5],E=r[6],S=r[7],x=r[8];n[0]=f*s+m*h+g*d,n[1]=f*o+m*c+g*_,n[2]=f*l+m*u+g*p,n[3]=v*s+y*h+C*d,n[4]=v*o+y*c+C*_,n[5]=v*l+y*u+C*p,n[6]=E*s+S*h+x*d,n[7]=E*o+S*c+x*_,n[8]=E*l+S*u+x*p},l.lookAt=function(e,t,i,n){ai.subtract(e,t,l._tempV30),ai.normalize(l._tempV30,l._tempV30),ai.cross(i,l._tempV30,l._tempV31),ai.normalize(l._tempV31,l._tempV31),ai.cross(l._tempV30,l._tempV31,l._tempV32);var a=l._tempV30.elements,r=l._tempV31.elements,s=l._tempV32.elements,o=n.elements;o[0]=r[0],o[3]=r[1],o[6]=r[2],o[1]=s[0],o[4]=s[1],o[7]=s[2],o[2]=a[0],o[5]=a[1],o[8]=a[2]},l.DEFAULT=new l,u(l,["_tempV30",function(){return this._tempV30=new ai},"_tempV31",function(){return this._tempV31=new ai},"_tempV32",function(){return this._tempV32=new ai}]),l}(),qt=function(){function w(e,t,i,n,a,r,s,o,l,h,c,u,d,_,p,f){void 0===e&&(e=1),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===a&&(a=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===o&&(o=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===c&&(c=1),void 0===u&&(u=0),void 0===d&&(d=0),void 0===_&&(_=0),void 0===p&&(p=0),void 0===f&&(f=1);var m=this.elements=new Float32Array(16);m[0]=e,m[1]=t,m[2]=i,m[3]=n,m[4]=a,m[5]=r,m[6]=s,m[7]=o,m[8]=l,m[9]=h,m[10]=c,m[11]=u,m[12]=d,m[13]=_,m[14]=p,m[15]=f}f(w,"laya.d3.math.Matrix4x4");var e=w.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e.getElementByRowColumn=function(e,t){if(e<0||3<e)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(t<0||3<t)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*e+t]},e.setElementByRowColumn=function(e,t,i){if(e<0||3<e)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(t<0||3<t)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*e+t]=i},e.equalsOtherMatrix=function(e){var t=this.elements,i=e.elements;return jt.nearEqual(t[0],i[0])&&jt.nearEqual(t[1],i[1])&&jt.nearEqual(t[2],i[2])&&jt.nearEqual(t[3],i[3])&&jt.nearEqual(t[4],i[4])&&jt.nearEqual(t[5],i[5])&&jt.nearEqual(t[6],i[6])&&jt.nearEqual(t[7],i[7])&&jt.nearEqual(t[8],i[8])&&jt.nearEqual(t[9],i[9])&&jt.nearEqual(t[10],i[10])&&jt.nearEqual(t[11],i[11])&&jt.nearEqual(t[12],i[12])&&jt.nearEqual(t[13],i[13])&&jt.nearEqual(t[14],i[14])&&jt.nearEqual(t[15],i[15])},e.decomposeTransRotScale=function(e,t,i){var n=w._tempMatrix4x4;return this.decomposeTransRotMatScale(e,n,i)?(Jt.createFromMatrix4x4(n,t),!0):(t.identity(),!1)},e.decomposeTransRotMatScale=function(e,t,i){var n=this.elements,a=e.elements,r=t.elements,s=i.elements;a[0]=n[12],a[1]=n[13],a[2]=n[14];var o=n[0],l=n[1],h=n[2],c=n[4],u=n[5],d=n[6],_=n[8],p=n[9],f=n[10],m=s[0]=Math.sqrt(o*o+l*l+h*h),g=s[1]=Math.sqrt(c*c+u*u+d*d),v=s[2]=Math.sqrt(_*_+p*p+f*f);if(jt.isZero(m)||jt.isZero(g)||jt.isZero(v))return r[1]=r[2]=r[3]=r[4]=r[6]=r[7]=r[8]=r[9]=r[11]=r[12]=r[13]=r[14]=0,r[0]=r[5]=r[10]=r[15]=1,!1;var y=w._tempVector0,C=y.elements;C[0]=_/v,C[1]=p/v,C[2]=f/v;var E=w._tempVector1,S=E.elements;S[0]=o/m,S[1]=l/m,S[2]=h/m;var x=w._tempVector2;ai.cross(y,E,x);var T=w._tempVector1;return ai.cross(x,y,T),r[3]=r[7]=r[11]=r[12]=r[13]=r[14]=0,r[15]=1,r[0]=T.x,r[1]=T.y,r[2]=T.z,r[4]=x.x,r[5]=x.y,r[6]=x.z,r[8]=y.x,r[9]=y.y,r[10]=y.z,r[0]*o+r[1]*l+r[2]*h<0&&(s[0]=-m),r[4]*c+r[5]*u+r[6]*d<0&&(s[1]=-g),r[8]*_+r[9]*p+r[10]*f<0&&(s[2]=-v),!0},e.decomposeYawPitchRoll=function(e){var t=e.elements,i=Math.asin(-this.elements[9]);t[1]=i,Math.cos(i)>jt.zeroTolerance?(t[2]=Math.atan2(this.elements[1],this.elements[5]),t[0]=Math.atan2(this.elements[8],this.elements[10])):(t[2]=Math.atan2(-this.elements[4],this.elements[0]),t[0]=0)},e.normalize=function(){var e=this.elements,t=e[0],i=e[1],n=e[2],a=Math.sqrt(t*t+i*i+n*n);if(!a)return e[0]=0,e[1]=0,void(e[2]=0);1!=a&&(a=1/a,e[0]=t*a,e[1]=i*a,e[2]=n*a)},e.transpose=function(){var e,t;return t=(e=this.elements)[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},e.invert=function(e){var t=this.elements,i=e.elements,n=t[0],a=t[1],r=t[2],s=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=t[8],d=t[9],_=t[10],p=t[11],f=t[12],m=t[13],g=t[14],v=t[15],y=n*l-a*o,C=n*h-r*o,E=n*c-s*o,S=a*h-r*l,x=a*c-s*l,T=r*c-s*h,w=u*m-d*f,M=u*g-_*f,b=u*v-p*f,R=d*g-_*m,L=d*v-p*m,A=_*v-p*g,I=y*A-C*L+E*R+S*b-x*M+T*w;0!==Math.abs(I)&&(I=1/I,i[0]=(l*A-h*L+c*R)*I,i[1]=(r*L-a*A-s*R)*I,i[2]=(m*T-g*x+v*S)*I,i[3]=(_*x-d*T-p*S)*I,i[4]=(h*b-o*A-c*M)*I,i[5]=(n*A-r*b+s*M)*I,i[6]=(g*E-f*T-v*C)*I,i[7]=(u*T-_*E+p*C)*I,i[8]=(o*L-l*b+c*w)*I,i[9]=(a*b-n*L-s*w)*I,i[10]=(f*x-m*E+v*y)*I,i[11]=(d*E-u*x-p*y)*I,i[12]=(l*M-o*R-h*w)*I,i[13]=(n*R-a*M+r*w)*I,i[14]=(m*C-f*S-g*y)*I,i[15]=(u*S-d*C+_*y)*I)},e.identity=function(){var e=this.elements;e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1},e.cloneTo=function(e){var t,i,n;if((i=this.elements)!==(n=e.elements))for(t=0;t<16;++t)n[t]=i[t]},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},e.getTranslationVector=function(e){var t=this.elements,i=e.elements;i[0]=t[12],i[1]=t[13],i[2]=t[14]},e.setTranslationVector=function(e){var t=this.elements,i=e.elements;t[12]=i[0],t[13]=i[1],t[14]=i[2]},e.getForward=function(e){var t=this.elements,i=e.elements;i[0]=-t[8],i[1]=-t[9],i[2]=-t[10]},e.setForward=function(e){var t=this.elements,i=e.elements;t[8]=-i[0],t[9]=-i[1],t[10]=-i[2]},w.createRotationX=function(e,t){var i=t.elements,n=Math.sin(e),a=Math.cos(e);i[1]=i[2]=i[3]=i[4]=i[7]=i[8]=i[11]=i[12]=i[13]=i[14]=0,i[0]=i[15]=1,i[5]=i[10]=a,i[6]=n,i[9]=-n},w.createRotationY=function(e,t){var i=t.elements,n=Math.sin(e),a=Math.cos(e);i[1]=i[3]=i[4]=i[6]=i[7]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[5]=i[15]=1,i[0]=i[10]=a,i[2]=-n,i[8]=n},w.createRotationZ=function(e,t){var i=t.elements,n=Math.sin(e),a=Math.cos(e);i[2]=i[3]=i[6]=i[7]=i[8]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[10]=i[15]=1,i[0]=i[5]=a,i[1]=n,i[4]=-n},w.createRotationYawPitchRoll=function(e,t,i,n){Jt.createFromYawPitchRoll(e,t,i,w._tempQuaternion),w.createRotationQuaternion(w._tempQuaternion,n)},w.createRotationAxis=function(e,t,i){var n=e.elements,a=n[0],r=n[1],s=n[2],o=Math.cos(t),l=Math.sin(t),h=a*a,c=r*r,u=s*s,d=a*r,_=a*s,p=r*s,f=i.elements;f[3]=f[7]=f[11]=f[12]=f[13]=f[14]=0,f[15]=1,f[0]=h+o*(1-h),f[1]=d-o*d+l*s,f[2]=_-o*_-l*r,f[4]=d-o*d-l*s,f[5]=c+o*(1-c),f[6]=p-o*p+l*a,f[8]=_-o*_+l*r,f[9]=p-o*p-l*a,f[10]=u+o*(1-u)},w.createRotationQuaternion=function(e,t){var i=e.elements,n=t.elements,a=i[0],r=i[1],s=i[2],o=i[3],l=a*a,h=r*r,c=s*s,u=a*r,d=s*o,_=s*a,p=r*o,f=r*s,m=a*o;n[3]=n[7]=n[11]=n[12]=n[13]=n[14]=0,n[15]=1,n[0]=1-2*(h+c),n[1]=2*(u+d),n[2]=2*(_-p),n[4]=2*(u-d),n[5]=1-2*(c+l),n[6]=2*(f+m),n[8]=2*(_+p),n[9]=2*(f-m),n[10]=1-2*(h+l)},w.createTranslate=function(e,t){var i=e.elements,n=t.elements;n[4]=n[8]=n[1]=n[9]=n[2]=n[6]=n[3]=n[7]=n[11]=0,n[0]=n[5]=n[10]=n[15]=1,n[12]=i[0],n[13]=i[1],n[14]=i[2]},w.createScaling=function(e,t){var i=e.elements,n=t.elements;n[0]=i[0],n[5]=i[1],n[10]=i[2],n[1]=n[4]=n[8]=n[12]=n[9]=n[13]=n[2]=n[6]=n[14]=n[3]=n[7]=n[11]=0,n[15]=1},w.multiply=function(e,t,i){var n,a,r,s,o,l,h,c;if(a=i.elements,r=e.elements,a===(s=t.elements))for(s=new Float32Array(16),n=0;n<16;++n)s[n]=a[n];for(n=0;n<4;n++)o=r[n],l=r[n+4],h=r[n+8],c=r[n+12],a[n]=o*s[0]+l*s[1]+h*s[2]+c*s[3],a[n+4]=o*s[4]+l*s[5]+h*s[6]+c*s[7],a[n+8]=o*s[8]+l*s[9]+h*s[10]+c*s[11],a[n+12]=o*s[12]+l*s[13]+h*s[14]+c*s[15]},w.createFromQuaternion=function(e,t){var i=t.elements,n=e.elements,a=n[0],r=n[1],s=n[2],o=n[3],l=a+a,h=r+r,c=s+s,u=a*l,d=r*l,_=r*h,p=s*l,f=s*h,m=s*c,g=o*l,v=o*h,y=o*c;i[0]=1-_-m,i[1]=d+y,i[2]=p-v,i[3]=0,i[4]=d-y,i[5]=1-u-m,i[6]=f+g,i[7]=0,i[8]=p+v,i[9]=f-g,i[10]=1-u-_,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1},w.createAffineTransformation=function(e,t,i,n){var a=e.elements,r=t.elements,s=i.elements,o=n.elements,l=r[0],h=r[1],c=r[2],u=r[3],d=l+l,_=h+h,p=c+c,f=l*d,m=l*_,g=l*p,v=h*_,y=h*p,C=c*p,E=u*d,S=u*_,x=u*p,T=s[0],w=s[1],M=s[2];o[0]=(1-(v+C))*T,o[1]=(m+x)*T,o[2]=(g-S)*T,o[3]=0,o[4]=(m-x)*w,o[5]=(1-(f+C))*w,o[6]=(y+E)*w,o[7]=0,o[8]=(g+S)*M,o[9]=(y-E)*M,o[10]=(1-(f+v))*M,o[11]=0,o[12]=a[0],o[13]=a[1],o[14]=a[2],o[15]=1},w.createLookAt=function(e,t,i,n){var a=n.elements,r=w._tempVector0,s=w._tempVector1,o=w._tempVector2;ai.subtract(e,t,o),ai.normalize(o,o),ai.cross(i,o,r),ai.normalize(r,r),ai.cross(o,r,s),n.identity(),a[0]=r.x,a[4]=r.y,a[8]=r.z,a[1]=s.x,a[5]=s.y,a[9]=s.z,a[2]=o.x,a[6]=o.y,a[10]=o.z,a[12]=-ai.dot(r,e),a[13]=-ai.dot(s,e),a[14]=-ai.dot(o,e)},w.createPerspective=function(e,t,i,n,a){var r=a.elements,s=1/Math.tan(e/2),o=1/(i-n);r[0]=s/t,r[5]=s,r[10]=(n+i)*o,r[11]=-1,r[14]=2*n*i*o,r[1]=r[2]=r[3]=r[4]=r[6]=r[7]=r[8]=r[9]=r[12]=r[13]=r[15]=0},w.createOrthoOffCenterRH=function(e,t,i,n,a,r,s){var o=s.elements,l=1/(e-t),h=1/(i-n),c=1/(a-r);o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[8]=o[9]=o[11]=0,o[15]=1,o[0]=-2*l,o[5]=-2*h,o[10]=2*c,o[12]=(e+t)*l,o[13]=(n+i)*h,o[14]=(r+a)*c},w.translation=function(e,t){var i=e.elements,n=t.elements;n[0]=n[5]=n[10]=n[15]=1,n[12]=i[0],n[13]=i[1],n[14]=i[2]},u(w,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new w},"_tempVector0",function(){return this._tempVector0=new ai},"_tempVector1",function(){return this._tempVector1=new ai},"_tempVector2",function(){return this._tempVector2=new ai},"_tempQuaternion",function(){return this._tempQuaternion=new Jt},"DEFAULT",function(){return this.DEFAULT=new w},"ZERO",function(){return this.ZERO=new w(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),w}(),Zt=function(){function y(e,t){this.extents=null,this.transformation=null,this.extents=e,this.transformation=t}f(y,"laya.d3.math.OrientedBoundBox");var e=y.prototype;return e.getCorners=function(e){var t=y._tempV30.elements,i=y._tempV31.elements,n=y._tempV32.elements,a=this.extents.elements;t[0]=a[0],t[1]=t[2]=0,i[1]=a[1],i[0]=i[2]=0,n[2]=a[2],n[0]=n[1]=0,ai.TransformNormal(y._tempV30,this.transformation,y._tempV30),ai.TransformNormal(y._tempV31,this.transformation,y._tempV31),ai.TransformNormal(y._tempV32,this.transformation,y._tempV32);var r=y._tempV33;this.transformation.getTranslationVector(r),e.length=8,ai.add(r,y._tempV30,y._tempV34),ai.add(y._tempV34,y._tempV31,y._tempV34),ai.add(y._tempV34,y._tempV32,e[0]),ai.add(r,y._tempV30,y._tempV34),ai.add(y._tempV34,y._tempV31,y._tempV34),ai.subtract(y._tempV34,y._tempV32,e[1]),ai.subtract(r,y._tempV30,y._tempV34),ai.add(y._tempV34,y._tempV31,y._tempV34),ai.subtract(y._tempV34,y._tempV32,e[2]),ai.subtract(r,y._tempV30,y._tempV34),ai.add(y._tempV34,y._tempV31,y._tempV34),ai.add(y._tempV34,y._tempV32,e[3]),ai.add(r,y._tempV30,y._tempV34),ai.subtract(y._tempV34,y._tempV31,y._tempV34),ai.add(y._tempV34,y._tempV32,e[4]),ai.add(r,y._tempV30,y._tempV34),ai.subtract(y._tempV34,y._tempV31,y._tempV34),ai.subtract(y._tempV34,y._tempV32,e[5]),ai.subtract(r,y._tempV30,y._tempV34),ai.subtract(y._tempV34,y._tempV31,y._tempV34),ai.subtract(y._tempV34,y._tempV32,e[6]),ai.subtract(r,y._tempV30,y._tempV34),ai.subtract(y._tempV34,y._tempV31,y._tempV34),ai.add(y._tempV34,y._tempV32,e[7])},e.transform=function(e){qt.multiply(this.transformation,e,this.transformation)},e.scale=function(e){ai.multiply(this.extents,e,this.extents)},e.translate=function(e){this.transformation.getTranslationVector(y._tempV30),ai.add(y._tempV30,e,y._tempV31),this.transformation.setTranslationVector(y._tempV31)},e.Size=function(e){ai.scale(this.extents,2,e)},e.getSize=function(e){var t=this.extents.elements;y._tempV30.x=t[0],y._tempV31.y=t[1],y._tempV32.z=t[2],ai.TransformNormal(y._tempV30,this.transformation,y._tempV30),ai.TransformNormal(y._tempV31,this.transformation,y._tempV31),ai.TransformNormal(y._tempV31,this.transformation,y._tempV32);var i=e.elements;i[0]=ai.scalarLength(y._tempV30),i[1]=ai.scalarLength(y._tempV31),i[2]=ai.scalarLength(y._tempV32)},e.getSizeSquared=function(e){var t=this.extents.elements;y._tempV30.x=t[0],y._tempV31.y=t[1],y._tempV32.z=t[2],ai.TransformNormal(y._tempV30,this.transformation,y._tempV30),ai.TransformNormal(y._tempV31,this.transformation,y._tempV31),ai.TransformNormal(y._tempV31,this.transformation,y._tempV32);var i=e.elements;i[0]=ai.scalarLengthSquared(y._tempV30),i[1]=ai.scalarLengthSquared(y._tempV31),i[2]=ai.scalarLengthSquared(y._tempV32)},e.getCenter=function(e){this.transformation.getTranslationVector(e)},e.containsPoint=function(e){var t=this.extents.elements,i=t[0],n=t[1],a=t[2];this.transformation.invert(y._tempM0),ai.transformCoordinate(e,y._tempM0,y._tempV30);var r=y._tempV30.elements,s=Math.abs(r[0]),o=Math.abs(r[1]),l=Math.abs(r[2]);return jt.nearEqual(s,i)&&jt.nearEqual(o,n)&&jt.nearEqual(l,a)?2:s<i&&o<n&&l<a?1:0},e.containsPoints=function(e){var t=this.extents.elements,i=t[0],n=t[1],a=t[2];this.transformation.invert(y._tempM0);for(var r=!0,s=!1,o=0;o<e.length;o++){ai.transformCoordinate(e[o],y._tempM0,y._tempV30);var l=y._tempV30.elements,h=Math.abs(l[0]),c=Math.abs(l[1]),u=Math.abs(l[2]);jt.nearEqual(h,i)&&jt.nearEqual(c,n)&&jt.nearEqual(u,a)&&(s=!0),h<i&&c<n&&u<a?s=!0:r=!1}return r?1:s?2:0},e.containsSphere=function(e,t){void 0===t&&(t=!1);var i=this.extents.elements,n=i[0],a=i[1],r=i[2],s=e.radius;this.transformation.invert(y._tempM0),ai.transformCoordinate(e.center,y._tempM0,y._tempV30);var o=NaN;if(o=t?s:(ai.scale(ai.UnitX,s,y._tempV31),ai.TransformNormal(y._tempV31,y._tempM0,y._tempV31),ai.scalarLength(y._tempV31)),ai.scale(this.extents,-1,y._tempV32),ai.Clamp(y._tempV30,y._tempV32,this.extents,y._tempV33),o*o<ai.distanceSquared(y._tempV30,y._tempV33))return 0;var l=y._tempV30.elements,h=l[0],c=l[1],u=l[2],d=y._tempV32.elements,_=d[0],p=d[1],f=d[2];return _+o<=h&&h<=n-o&&o<n-_&&p+o<=c&&c<=a-o&&o<a-p&&f+o<=u&&u<=r-o&&o<r-f?1:2},e.containsOrientedBoundBox=function(e){var t=0,i=0;e.getCorners(y._corners);var n=this.containsPoints(y._corners);if(0!=n)return n;var a=this.extents.elements;e.extents.cloneTo(y._tempV35);var r=y._tempV35.elements;y._getRows(this.transformation,y._rows1),y._getRows(e.transformation,y._rows2);var s=NaN;for(t=0;t<4;t++)for(i=0;i<4;i++)3==t||3==i?(y._tempM0.setElementByRowColumn(t,i,0),y._tempM1.setElementByRowColumn(t,i,0)):(s=ai.dot(y._rows1[t],y._rows2[i]),y._tempM0.setElementByRowColumn(t,i,s),y._tempM1.setElementByRowColumn(t,i,Math.abs(s)));e.getCenter(y._tempV34),this.getCenter(y._tempV36),ai.subtract(y._tempV34,y._tempV36,y._tempV30);var o=y._tempV31.elements;o[0]=ai.dot(y._tempV30,y._rows1[0]),o[1]=ai.dot(y._tempV30,y._rows1[1]),o[2]=ai.dot(y._tempV30,y._rows1[2]);var l=y._tempV32.elements,h=y._tempV33.elements;for(t=0;t<3;t++)if(l[0]=y._tempM1.getElementByRowColumn(t,0),l[1]=y._tempM1.getElementByRowColumn(t,1),l[2]=y._tempM1.getElementByRowColumn(t,2),a[t]+ai.dot(y._tempV35,y._tempV32)<Math.abs(o[t]))return 0;for(i=0;i<3;i++)if(l[0]=y._tempM1.getElementByRowColumn(0,i),l[1]=y._tempM1.getElementByRowColumn(1,i),l[2]=y._tempM1.getElementByRowColumn(2,i),h[0]=y._tempM0.getElementByRowColumn(0,i),h[1]=y._tempM0.getElementByRowColumn(1,i),h[2]=y._tempM0.getElementByRowColumn(2,i),ai.dot(this.extents,y._tempV32)+r[i]<Math.abs(ai.dot(y._tempV31,y._tempV33)))return 0;for(t=0;t<3;t++)for(i=0;i<3;i++){var c=(t+1)%3,u=(t+2)%3,d=(i+1)%3,_=(i+2)%3;if(a[c]*y._tempM1.getElementByRowColumn(u,i)+a[u]*y._tempM1.getElementByRowColumn(c,i)+(r[d]*y._tempM1.getElementByRowColumn(t,_)+r[_]*y._tempM1.getElementByRowColumn(t,d))<Math.abs(o[u]*y._tempM0.getElementByRowColumn(c,i)-o[c]*y._tempM0.getElementByRowColumn(u,i)))return 0}return 2},e.containsLine=function(e,t){y._corners[0]=e,y._corners[1]=t;var i=this.containsPoints(y._corners);if(0!=i)return i;var n=this.extents.elements,a=n[0],r=n[1],s=n[2];this.transformation.invert(y._tempM0),ai.transformCoordinate(e,y._tempM0,y._tempV30),ai.transformCoordinate(t,y._tempM0,y._tempV31),ai.add(y._tempV30,y._tempV31,y._tempV32),ai.scale(y._tempV32,.5,y._tempV32),ai.subtract(y._tempV30,y._tempV32,y._tempV33);var o=y._tempV33.elements,l=o[0],h=o[1],c=o[2],u=y._tempV34.elements,d=u[0]=Math.abs(o[0]),_=u[1]=Math.abs(o[1]),p=u[2]=Math.abs(o[2]),f=y._tempV32.elements,m=f[0],g=f[1],v=f[2];return Math.abs(m)>a+d?0:Math.abs(g)>r+_?0:Math.abs(v)>s+p?0:Math.abs(g*c-v*h)>r*p+s*_?0:Math.abs(m*c-v*l)>a*p+s*d?0:Math.abs(m*h-g*l)>a*_+r*d?0:2},e.containsBoundBox=function(e){var t=0,i=0,n=e.min,a=e.max;e.getCorners(y._corners);var r=this.containsPoints(y._corners);if(0!=r)return r;ai.subtract(a,n,y._tempV30),ai.scale(y._tempV30,.5,y._tempV30),ai.add(n,y._tempV30,y._tempV30),ai.subtract(a,y._tempV30,y._tempV31);var s=this.extents.elements,o=y._tempV31.elements;y._getRows(this.transformation,y._rows1),this.transformation.invert(y._tempM0);for(t=0;t<3;t++)for(i=0;i<3;i++)y._tempM1.setElementByRowColumn(t,i,Math.abs(y._tempM0.getElementByRowColumn(t,i)));this.getCenter(y._tempV35),ai.subtract(y._tempV30,y._tempV35,y._tempV32);var l=y._tempV31.elements;l[0]=ai.dot(y._tempV32,y._rows1[0]),l[1]=ai.dot(y._tempV32,y._rows1[1]),l[2]=ai.dot(y._tempV32,y._rows1[2]);var h=y._tempV33.elements,c=y._tempV34.elements;for(t=0;t<3;t++)if(h[0]=y._tempM1.getElementByRowColumn(t,0),h[1]=y._tempM1.getElementByRowColumn(t,1),h[2]=y._tempM1.getElementByRowColumn(t,2),s[t]+ai.dot(y._tempV31,y._tempV33)<Math.abs(l[t]))return 0;for(i=0;i<3;i++)if(h[0]=y._tempM1.getElementByRowColumn(0,i),h[1]=y._tempM1.getElementByRowColumn(1,i),h[2]=y._tempM1.getElementByRowColumn(2,i),c[0]=y._tempM0.getElementByRowColumn(0,i),c[1]=y._tempM0.getElementByRowColumn(1,i),c[2]=y._tempM0.getElementByRowColumn(2,i),ai.dot(this.extents,y._tempV33)+o[i]<Math.abs(ai.dot(y._tempV31,y._tempV34)))return 0;for(t=0;t<3;t++)for(i=0;i<3;i++){var u=(t+1)%3,d=(t+2)%3,_=(i+1)%3,p=(i+2)%3;if(s[u]*y._tempM1.getElementByRowColumn(d,i)+s[d]*y._tempM1.getElementByRowColumn(u,i)+(o[_]*y._tempM1.getElementByRowColumn(t,p)+o[p]*y._tempM1.getElementByRowColumn(t,_))<Math.abs(l[d]*y._tempM0.getElementByRowColumn(u,i)-l[u]*y._tempM0.getElementByRowColumn(d,i)))return 0}return 2},e.intersectsRay=function(e,t){ai.scale(this.extents,-1,y._tempV30),this.transformation.invert(y._tempM0),ai.TransformNormal(e.direction,y._tempM0,y._ray.direction),ai.transformCoordinate(e.origin,y._tempM0,y._ray.origin),y._boxBound1.min=y._tempV30,y._boxBound1.max=this.extents;var i=zt.intersectsRayAndBoxRP(y._ray,y._boxBound1,t);return-1!==i&&ai.transformCoordinate(t,this.transformation,t),i},e._getLocalCorners=function(e){e.length=8;var t=this.extents.elements;y._tempV30.x=t[0],y._tempV31.y=t[1],y._tempV32.z=t[2],ai.add(y._tempV30,y._tempV31,y._tempV33),ai.add(y._tempV33,y._tempV32,e[0]),ai.add(y._tempV30,y._tempV31,y._tempV33),ai.subtract(y._tempV33,y._tempV32,e[1]),ai.subtract(y._tempV31,y._tempV30,y._tempV33),ai.subtract(y._tempV33,y._tempV30,e[2]),ai.subtract(y._tempV31,y._tempV30,y._tempV33),ai.add(y._tempV33,y._tempV32,e[3]),ai.subtract(y._tempV30,y._tempV31,y._tempV33),ai.add(y._tempV33,y._tempV32,e[4]),ai.subtract(y._tempV30,y._tempV31,y._tempV33),ai.subtract(y._tempV33,y._tempV32,e[5]),ai.scale(e[0],-1,e[6]),ai.subtract(y._tempV32,y._tempV30,y._tempV33),ai.subtract(y._tempV33,y._tempV31,e[7])},e.equals=function(e){return this.extents==e.extents&&this.transformation==e.transformation},e.cloneTo=function(e){var t=e;this.extents.cloneTo(t.extents),this.transformation.cloneTo(t.transformation)},y.createByBoundBox=function(e,t){var i=e.min,n=e.max;ai.subtract(n,i,y._tempV30),ai.scale(y._tempV30,.5,y._tempV30),ai.add(i,y._tempV30,y._tempV31),ai.subtract(n,y._tempV31,y._tempV32),qt.translation(y._tempV31,y._tempM0);var a=y._tempV32.clone(),r=y._tempM0.clone();t.extents=a,t.transformation=r},y.createByMinAndMaxVertex=function(e,t){return ai.subtract(t,e,y._tempV30),ai.scale(y._tempV30,.5,y._tempV30),ai.add(e,y._tempV30,y._tempV31),ai.subtract(t,y._tempV31,y._tempV32),qt.translation(y._tempV31,y._tempM0),new y(y._tempV32,y._tempM0)},y._getRows=function(e,t){t.length=3;var i=e.elements,n=t[0].elements;n[0]=i[0],n[1]=i[1],n[2]=i[2];var a=t[1].elements;a[0]=i[4],a[1]=i[5],a[2]=i[6];var r=t[2].elements;r[0]=i[8],r[1]=i[9],r[2]=i[10]},y.getObbtoObbMatrix4x4=function(e,t,i,n){var a=e.transformation,r=t.transformation;if(i){y._getRows(a,y._rows1),y._getRows(r,y._rows2);for(var s=0;s<3;s++)for(var o=0;o<3;o++)n.setElementByRowColumn(s,o,ai.dot(y._rows2[s],y._rows1[o]));t.getCenter(y._tempV30),e.getCenter(y._tempV31),ai.subtract(y._tempV30,y._tempV31,y._tempV32);var l=n.elements;l[12]=ai.dot(y._tempV32,y._rows1[0]),l[13]=ai.dot(y._tempV32,y._rows1[1]),l[14]=ai.dot(y._tempV32,y._rows1[2]),l[15]=1}else a.invert(y._tempM0),qt.multiply(r,y._tempM0,n)},y.merge=function(e,t,i){var n=e.extents,a=e.transformation;y.getObbtoObbMatrix4x4(e,t,i,y._tempM0),t._getLocalCorners(y._corners),ai.transformCoordinate(y._corners[0],y._tempM0,y._corners[0]),ai.transformCoordinate(y._corners[1],y._tempM0,y._corners[1]),ai.transformCoordinate(y._corners[2],y._tempM0,y._corners[2]),ai.transformCoordinate(y._corners[3],y._tempM0,y._corners[3]),ai.transformCoordinate(y._corners[4],y._tempM0,y._corners[4]),ai.transformCoordinate(y._corners[5],y._tempM0,y._corners[5]),ai.transformCoordinate(y._corners[6],y._tempM0,y._corners[6]),ai.transformCoordinate(y._corners[7],y._tempM0,y._corners[7]),ai.scale(n,-1,y._boxBound1.min),n.cloneTo(y._boxBound1.max),Ht.createfromPoints(y._corners,y._boxBound2),Ht.merge(y._boxBound2,y._boxBound1,y._boxBound3);var r=y._boxBound3.min,s=y._boxBound3.max;ai.subtract(s,r,y._tempV30),ai.scale(y._tempV30,.5,y._tempV30),ai.add(r,y._tempV30,y._tempV32),ai.subtract(s,y._tempV32,n),ai.transformCoordinate(y._tempV32,a,y._tempV33)},u(y,["_tempV30",function(){return this._tempV30=new ai},"_tempV31",function(){return this._tempV31=new ai},"_tempV32",function(){return this._tempV32=new ai},"_tempV33",function(){return this._tempV33=new ai},"_tempV34",function(){return this._tempV34=new ai},"_tempV35",function(){return this._tempV35=new ai},"_tempV36",function(){return this._tempV36=new ai},"_tempM0",function(){return this._tempM0=new qt},"_tempM1",function(){return this._tempM1=new qt},"_corners",function(){return this._corners=[new ai,new ai,new ai,new ai,new ai,new ai,new ai,new ai]},"_rows1",function(){return this._rows1=[new ai,new ai,new ai]},"_rows2",function(){return this._rows2=[new ai,new ai,new ai]},"_ray",function(){return this._ray=new ti(new ai,new ai)},"_boxBound1",function(){return this._boxBound1=new Ht(new ai,new ai)},"_boxBound2",function(){return this._boxBound2=new Ht(new ai,new ai)},"_boxBound3",function(){return this._boxBound3=new Ht(new ai,new ai)}]),y}(),Qt=(f($t,"laya.d3.math.Plane"),$t.prototype.normalize=function(){var e=this.normal.elements,t=e[0],i=e[1],n=e[2],a=1/Math.sqrt(t*t+i*i+n*n);e[0]=t*a,e[1]=i*a,e[2]=n*a,this.distance*=a},$t.createPlaneBy3P=function(e,t,i){var n=e.elements,a=t.elements,r=i.elements,s=a[0]-n[0],o=a[1]-n[1],l=a[2]-n[2],h=r[0]-n[0],c=r[1]-n[1],u=r[2]-n[2],d=o*u-l*c,_=l*h-s*u,p=s*c-o*h,f=1/Math.sqrt(d*d+_*_+p*p),m=d*f,g=_*f,v=p*f,y=$t._TEMPVec3.elements;y[0]=m,y[1]=g,y[2]=v;var C=-(m*n[0]+g*n[1]+v*n[2]);return new $t($t._TEMPVec3,C)},$t.PlaneIntersectionType_Back=0,$t.PlaneIntersectionType_Front=1,$t.PlaneIntersectionType_Intersecting=2,u($t,["_TEMPVec3",function(){return this._TEMPVec3=new ai}]),$t);function $t(e,t){this.normal=null,this.distance=NaN,void 0===t&&(t=0),this.normal=e,this.distance=t}var Jt=function(){function a(e,t,i,n){this.elements=new Float32Array(4),void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=1),this.elements[0]=e,this.elements[1]=t,this.elements[2]=i,this.elements[3]=n}f(a,"laya.d3.math.Quaternion");var e=a.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e.scaling=function(e,t){var i=t.elements,n=this.elements;i[0]=n[0]*e,i[1]=n[1]*e,i[2]=n[2]*e,i[3]=n[3]*e},e.normalize=function(e){var t=e.elements,i=this.elements,n=i[0],a=i[1],r=i[2],s=i[3],o=n*n+a*a+r*r+s*s;0<o&&(o=1/Math.sqrt(o),t[0]=n*o,t[1]=a*o,t[2]=r*o,t[3]=s*o)},e.length=function(){var e=this.elements,t=e[0],i=e[1],n=e[2],a=e[3];return Math.sqrt(t*t+i*i+n*n+a*a)},e.rotateX=function(e,t){var i=t.elements,n=this.elements;e*=.5;var a=n[0],r=n[1],s=n[2],o=n[3],l=Math.sin(e),h=Math.cos(e);i[0]=a*h+o*l,i[1]=r*h+s*l,i[2]=s*h-r*l,i[3]=o*h-a*l},e.rotateY=function(e,t){var i=t.elements,n=this.elements;e*=.5;var a=n[0],r=n[1],s=n[2],o=n[3],l=Math.sin(e),h=Math.cos(e);i[0]=a*h-s*l,i[1]=r*h+o*l,i[2]=s*h+a*l,i[3]=o*h-r*l},e.rotateZ=function(e,t){var i=t.elements,n=this.elements;e*=.5;var a=n[0],r=n[1],s=n[2],o=n[3],l=Math.sin(e),h=Math.cos(e);i[0]=a*h+r*l,i[1]=r*h-a*l,i[2]=s*h+o*l,i[3]=o*h-s*l},e.getYawPitchRoll=function(e){ai.transformQuat(ai.ForwardRH,this,a.TEMPVector31),ai.transformQuat(ai.Up,this,a.TEMPVector32);var t=a.TEMPVector32.elements;a.angleTo(ai.ZERO,a.TEMPVector31,a.TEMPVector33);var i=a.TEMPVector33.elements;i[0]==Math.PI/2?(i[1]=a.arcTanAngle(t[2],t[0]),i[2]=0):i[0]==-Math.PI/2?(i[1]=a.arcTanAngle(-t[2],-t[0]),i[2]=0):(qt.createRotationY(-i[1],a.TEMPMatrix0),qt.createRotationX(-i[0],a.TEMPMatrix1),ai.transformCoordinate(a.TEMPVector32,a.TEMPMatrix0,a.TEMPVector32),ai.transformCoordinate(a.TEMPVector32,a.TEMPMatrix1,a.TEMPVector32),i[2]=a.arcTanAngle(t[1],-t[0])),i[1]<=-Math.PI&&(i[1]=Math.PI),i[2]<=-Math.PI&&(i[2]=Math.PI),i[1]>=Math.PI&&i[2]>=Math.PI&&(i[1]=0,i[2]=0,i[0]=Math.PI-i[0]);var n=e.elements;n[0]=i[1],n[1]=i[0],n[2]=i[2]},e.invert=function(e){var t=e.elements,i=this.elements,n=i[0],a=i[1],r=i[2],s=i[3],o=n*n+a*a+r*r+s*s,l=o?1/o:0;t[0]=-n*l,t[1]=-a*l,t[2]=-r*l,t[3]=s*l},e.identity=function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=1},e.fromArray=function(e,t){void 0===t&&(t=0),this.elements[0]=e[t+0],this.elements[1]=e[t+1],this.elements[2]=e[t+2],this.elements[3]=e[t+3]},e.cloneTo=function(e){var t,i,n;if((i=this.elements)!==(n=e.elements))for(t=0;t<4;++t)n[t]=i[t]},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},e.equals=function(e){var t=this.elements,i=e.elements;return jt.nearEqual(t[0],i[0])&&jt.nearEqual(t[1],i[1])&&jt.nearEqual(t[2],i[2])&&jt.nearEqual(t[3],i[3])},e.lengthSquared=function(){var e=this.elements[0],t=this.elements[1],i=this.elements[2],n=this.elements[3];return e*e+t*t+i*i+n*n},v(0,e,"x",function(){return this.elements[0]}),v(0,e,"y",function(){return this.elements[1]}),v(0,e,"z",function(){return this.elements[2]}),v(0,e,"w",function(){return this.elements[3]}),a.createFromYawPitchRoll=function(e,t,i,n){var a=.5*i,r=.5*t,s=.5*e,o=Math.sin(a),l=Math.cos(a),h=Math.sin(r),c=Math.cos(r),u=Math.sin(s),d=Math.cos(s),_=n.elements;_[0]=d*h*l+u*c*o,_[1]=u*c*l-d*h*o,_[2]=d*c*o-u*h*l,_[3]=d*c*l+u*h*o},a.multiply=function(e,t,i){var n=e.elements,a=t.elements,r=i.elements,s=n[0],o=n[1],l=n[2],h=n[3],c=a[0],u=a[1],d=a[2],_=a[3],p=o*d-l*u,f=l*c-s*d,m=s*u-o*c,g=s*c+o*u+l*d;r[0]=s*_+c*h+p,r[1]=o*_+u*h+f,r[2]=l*_+d*h+m,r[3]=h*_-g},a.arcTanAngle=function(e,t){return 0==e?1==t?Math.PI/2:-Math.PI/2:0<e?Math.atan(t/e):e<0?0<t?Math.atan(t/e)+Math.PI:Math.atan(t/e)-Math.PI:0},a.angleTo=function(e,t,i){ai.subtract(t,e,a.TEMPVector30),ai.normalize(a.TEMPVector30,a.TEMPVector30),i.elements[0]=Math.asin(a.TEMPVector30.y),i.elements[1]=a.arcTanAngle(-a.TEMPVector30.z,-a.TEMPVector30.x)},a.createFromAxisAngle=function(e,t,i){var n=i.elements,a=e.elements;t*=.5;var r=Math.sin(t);n[0]=r*a[0],n[1]=r*a[1],n[2]=r*a[2],n[3]=Math.cos(t)},a.createFromMatrix3x3=function(e,t){var i,n=t.elements,a=e.elements,r=a[0]+a[4]+a[8];if(0<r)i=Math.sqrt(r+1),n[3]=.5*i,i=.5/i,n[0]=(a[5]-a[7])*i,n[1]=(a[6]-a[2])*i,n[2]=(a[1]-a[3])*i;else{var s=0;a[4]>a[0]&&(s=1),a[8]>a[3*s+s]&&(s=2);var o=(s+1)%3,l=(s+2)%3;i=Math.sqrt(a[3*s+s]-a[3*o+o]-a[3*l+l]+1),n[s]=.5*i,i=.5/i,n[3]=(a[3*o+l]-a[3*l+o])*i,n[o]=(a[3*o+s]+a[3*s+o])*i,n[l]=(a[3*l+s]+a[3*s+l])*i}},a.createFromMatrix4x4=function(e,t){var i,n,a=e.elements,r=t.elements,s=a[0]+a[5]+a[10];0<s?(i=Math.sqrt(s+1),r[3]=.5*i,i=.5/i,r[0]=(a[6]-a[9])*i,r[1]=(a[8]-a[2])*i,r[2]=(a[1]-a[4])*i):a[0]>=a[5]&&a[0]>=a[10]?(n=.5/(i=Math.sqrt(1+a[0]-a[5]-a[10])),r[0]=.5*i,r[1]=(a[1]+a[4])*n,r[2]=(a[2]+a[8])*n,r[3]=(a[6]-a[9])*n):a[5]>a[10]?(n=.5/(i=Math.sqrt(1+a[5]-a[0]-a[10])),r[0]=(a[4]+a[1])*n,r[1]=.5*i,r[2]=(a[9]+a[6])*n,r[3]=(a[8]-a[2])*n):(n=.5/(i=Math.sqrt(1+a[10]-a[0]-a[5])),r[0]=(a[8]+a[2])*n,r[1]=(a[9]+a[6])*n,r[2]=.5*i,r[3]=(a[1]-a[4])*n)},a.slerp=function(e,t,i,n){var a,r,s,o,l,h=e.elements,c=t.elements,u=n.elements,d=h[0],_=h[1],p=h[2],f=h[3],m=c[0],g=c[1],v=c[2],y=c[3];return(r=d*m+_*g+p*v+f*y)<0&&(r=-r,m=-m,g=-g,v=-v,y=-y),l=1e-6<1-r?(a=Math.acos(r),s=Math.sin(a),o=Math.sin((1-i)*a)/s,Math.sin(i*a)/s):(o=1-i,i),u[0]=o*d+l*m,u[1]=o*_+l*g,u[2]=o*p+l*v,u[3]=o*f+l*y,u},a.lerp=function(e,t,i,n){var a=n.elements,r=e.elements,s=t.elements,o=r[0],l=r[1],h=r[2],c=r[3];a[0]=o+i*(s[0]-o),a[1]=l+i*(s[1]-l),a[2]=h+i*(s[2]-h),a[3]=c+i*(s[3]-c)},a.add=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements;n[0]=a[0]+r[0],n[1]=a[1]+r[1],n[2]=a[2]+r[2],n[3]=a[3]+r[3]},a.dot=function(e,t){var i=e.elements,n=t.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},a.rotationLookAt=function(e,t,i){a.lookAt(ai.ZERO,e,t,i)},a.lookAt=function(e,t,i,n){Kt.lookAt(e,t,i,a._tempMatrix3x3),a.rotationMatrix(a._tempMatrix3x3,n)},a.invert=function(e,t){var i=e.elements,n=t.elements,a=e.lengthSquared();jt.isZero(a)||(a=1/a,n[0]=-i[0]*a,n[1]=-i[1]*a,n[2]=-i[2]*a,n[3]=i[3]*a)},a.rotationMatrix=function(e,t){var i=e.elements,n=i[0],a=i[1],r=i[2],s=i[3],o=i[4],l=i[5],h=i[6],c=i[7],u=i[8],d=t.elements,_=NaN,p=NaN,f=n+o+u;0<f?(_=Math.sqrt(f+1),d[3]=.5*_,_=.5/_,d[0]=(l-c)*_,d[1]=(h-r)*_,d[2]=(a-s)*_):o<=n&&u<=n?(p=.5/(_=Math.sqrt(1+n-o-u)),d[0]=.5*_,d[1]=(a+s)*p,d[2]=(r+h)*p,d[3]=(l-c)*p):u<o?(p=.5/(_=Math.sqrt(1+o-n-u)),d[0]=(s+a)*p,d[1]=.5*_,d[2]=(c+l)*p,d[3]=(h-r)*p):(p=.5/(_=Math.sqrt(1+u-n-o)),d[0]=(h+r)*p,d[1]=(c+l)*p,d[2]=.5*_,d[3]=(a-s)*p)},a.DEFAULT=new a,u(a,["TEMPVector30",function(){return this.TEMPVector30=new ai},"TEMPVector31",function(){return this.TEMPVector31=new ai},"TEMPVector32",function(){return this.TEMPVector32=new ai},"TEMPVector33",function(){return this.TEMPVector33=new ai},"TEMPMatrix0",function(){return this.TEMPMatrix0=new qt},"TEMPMatrix1",function(){return this.TEMPMatrix1=new qt},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new Kt},"NAN",function(){return this.NAN=new a(NaN,NaN,NaN,NaN)}]),a}(),ei=function(){function e(e){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=e,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}f(e,"laya.d3.math.Rand");var t=e.prototype;return t.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},t.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},t.getSignedFloat=function(){return 2*this.getFloat()-1},v(0,t,"seed",function(){return this.seeds[0]},function(e){this.seeds[0]=e,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),e.getFloatFromInt=function(e){return 1/8388607*(8388607&e)},e.getByteFromInt=function(e){return(8388607&e)>>>15},e}(),ti=(function(){function a(e){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(e instanceof Array)||4!==e.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|e[0],this._state0L=0|e[1],this._state1U=0|e[2],this._state1L=0|e[3]}f(a,"laya.d3.math.RandX");var e=a.prototype;e.randomint=function(){var e=this._state0U,t=this._state0L,i=this._state1U,n=this._state1L,a=(n>>>0)+(t>>>0),r=i+e+(a/2>>>31)>>>0,s=a>>>0,o=0,l=0;o=(e^=o=e<<23|(-512&t)>>>9)^(this._state0U=i),l=(t^=l=t<<23)^(this._state0L=n);o^=e>>>18,l^=t>>>18|(262143&e)<<14;return o^=i>>>5,l^=n>>>5|(31&i)<<27,this._state1U=o,this._state1L=l,[r,s]},e.random=function(){var e=this.randomint(),t=e[0],i=1023<<20|t>>>12,n=0|(e[1]>>>12|(4095&t)<<20);return a._CONVERTION_BUFFER.setUint32(0,i,!1),a._CONVERTION_BUFFER.setUint32(4,n,!1),ei._CONVERTION_BUFFER.getFloat64(0,!1)-1},u(a,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new ei([0,Date.now()/65536,0,Date.now()%65536])}])}(),f(ii,"laya.d3.math.Ray"),ii);function ii(e,t){this.origin=null,this.direction=null,this.origin=e,this.direction=t}var ni=function(){function e(e,t){this.elements=new Float32Array(2),void 0===e&&(e=0),void 0===t&&(t=0);var i=this.elements;i[0]=e,i[1]=t}f(e,"laya.d3.math.Vector2");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t.fromArray=function(e,t){void 0===t&&(t=0),this.elements[0]=e[t+0],this.elements[1]=e[t+1]},t.cloneTo=function(e){var t=e.elements,i=this.elements;t[0]=i[0],t[1]=i[1]},t.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,t,"x",function(){return this.elements[0]},function(e){this.elements[0]=e}),v(0,t,"y",function(){return this.elements[1]},function(e){this.elements[1]=e}),e.scale=function(e,t,i){var n=i.elements,a=e.elements;n[0]=a[0]*t,n[1]=a[1]*t},u(e,["ZERO",function(){return this.ZERO=new e(0,0)},"ONE",function(){return this.ONE=new e(1,1)}]),e}(),ai=function(){function c(e,t,i){this.elements=new Float32Array(3),void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0);var n=this.elements;n[0]=e,n[1]=t,n[2]=i}f(c,"laya.d3.math.Vector3");var e=c.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e.fromArray=function(e,t){void 0===t&&(t=0),this.elements[0]=e[t+0],this.elements[1]=e[t+1],this.elements[2]=e[t+2]},e.cloneTo=function(e){var t=e.elements,i=this.elements;t[0]=i[0],t[1]=i[1],t[2]=i[2]},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},e.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},v(0,e,"x",function(){return this.elements[0]},function(e){this.elements[0]=e}),v(0,e,"y",function(){return this.elements[1]},function(e){this.elements[1]=e}),v(0,e,"z",function(){return this.elements[2]},function(e){this.elements[2]=e}),c.distanceSquared=function(e,t){var i=e.elements,n=t.elements,a=i[0]-n[0],r=i[1]-n[1],s=i[2]-n[2];return a*a+r*r+s*s},c.distance=function(e,t){var i=e.elements,n=t.elements,a=i[0]-n[0],r=i[1]-n[1],s=i[2]-n[2];return Math.sqrt(a*a+r*r+s*s)},c.min=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements;n[0]=Math.min(a[0],r[0]),n[1]=Math.min(a[1],r[1]),n[2]=Math.min(a[2],r[2])},c.max=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements;n[0]=Math.max(a[0],r[0]),n[1]=Math.max(a[1],r[1]),n[2]=Math.max(a[2],r[2])},c.transformQuat=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements,s=a[0],o=a[1],l=a[2],h=r[0],c=r[1],u=r[2],d=r[3],_=d*s+c*l-u*o,p=d*o+u*s-h*l,f=d*l+h*o-c*s,m=-h*s-c*o-u*l;n[0]=_*d+m*-h+p*-u-f*-c,n[1]=p*d+m*-c+f*-h-_*-u,n[2]=f*d+m*-u+_*-c-p*-h},c.scalarLength=function(e){var t=e.elements,i=t[0],n=t[1],a=t[2];return Math.sqrt(i*i+n*n+a*a)},c.scalarLengthSquared=function(e){var t=e.elements,i=t[0],n=t[1],a=t[2];return i*i+n*n+a*a},c.normalize=function(e,t){var i=e.elements,n=t.elements,a=i[0],r=i[1],s=i[2],o=a*a+r*r+s*s;0<o&&(o=1/Math.sqrt(o),n[0]=i[0]*o,n[1]=i[1]*o,n[2]=i[2]*o)},c.multiply=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements;n[0]=a[0]*r[0],n[1]=a[1]*r[1],n[2]=a[2]*r[2]},c.scale=function(e,t,i){var n=i.elements,a=e.elements;n[0]=a[0]*t,n[1]=a[1]*t,n[2]=a[2]*t},c.lerp=function(e,t,i,n){var a=n.elements,r=e.elements,s=t.elements,o=r[0],l=r[1],h=r[2];a[0]=o+i*(s[0]-o),a[1]=l+i*(s[1]-l),a[2]=h+i*(s[2]-h)},c.transformV3ToV3=function(e,t,i){var n=c._tempVector4;c.transformV3ToV4(e,t,n);var a=n.elements,r=i.elements;r[0]=a[0],r[1]=a[1],r[2]=a[2]},c.transformV3ToV4=function(e,t,i){var n=e.elements,a=n[0],r=n[1],s=n[2],o=t.elements,l=i.elements;l[0]=a*o[0]+r*o[4]+s*o[8]+o[12],l[1]=a*o[1]+r*o[5]+s*o[9]+o[13],l[2]=a*o[2]+r*o[6]+s*o[10]+o[14],l[3]=a*o[3]+r*o[7]+s*o[11]+o[15]},c.TransformNormal=function(e,t,i){var n=e.elements,a=n[0],r=n[1],s=n[2],o=t.elements,l=i.elements;l[0]=a*o[0]+r*o[4]+s*o[8],l[1]=a*o[1]+r*o[5]+s*o[9],l[2]=a*o[2]+r*o[6]+s*o[10]},c.transformCoordinate=function(e,t,i){var n=c._tempVector4.elements,a=e.elements,r=a[0],s=a[1],o=a[2],l=t.elements;n[0]=r*l[0]+s*l[4]+o*l[8]+l[12],n[1]=r*l[1]+s*l[5]+o*l[9]+l[13],n[2]=r*l[2]+s*l[6]+o*l[10]+l[14],n[3]=1/(r*l[3]+s*l[7]+o*l[11]+l[15]);var h=i.elements;h[0]=n[0]*n[3],h[1]=n[1]*n[3],h[2]=n[2]*n[3]},c.Clamp=function(e,t,i,n){var a=e.elements,r=a[0],s=a[1],o=a[2],l=t.elements,h=l[0],c=l[1],u=l[2],d=i.elements,_=d[0],p=d[1],f=d[2],m=n.elements;r=(r=_<r?_:r)<h?h:r,s=(s=p<s?p:s)<c?c:s,o=(o=f<o?f:o)<u?u:o,m[0]=r,m[1]=s,m[2]=o},c.add=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements;n[0]=a[0]+r[0],n[1]=a[1]+r[1],n[2]=a[2]+r[2]},c.subtract=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements;n[0]=a[0]-r[0],n[1]=a[1]-r[1],n[2]=a[2]-r[2]},c.cross=function(e,t,i){var n=e.elements,a=t.elements,r=i.elements,s=n[0],o=n[1],l=n[2],h=a[0],c=a[1],u=a[2];r[0]=o*u-l*c,r[1]=l*h-s*u,r[2]=s*c-o*h},c.dot=function(e,t){var i=e.elements,n=t.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]},c.equals=function(e,t){var i=e.elements,n=t.elements;return jt.nearEqual(Math.abs(i[0]),Math.abs(n[0]))&&jt.nearEqual(Math.abs(i[1]),Math.abs(n[1]))&&jt.nearEqual(Math.abs(i[2]),Math.abs(n[2]))},c.ZERO=new c(0,0,0),c.ONE=new c(1,1,1),c.NegativeUnitX=new c(-1,0,0),c.UnitX=new c(1,0,0),c.UnitY=new c(0,1,0),c.UnitZ=new c(0,0,1),c.ForwardRH=new c(0,0,-1),c.ForwardLH=new c(0,0,1),c.Up=new c(0,1,0),c.NAN=new c(NaN,NaN,NaN),u(c,["_tempVector4",function(){return this._tempVector4=new ri}]),c}(),ri=function(){function e(e,t,i,n){this.elements=new Float32Array(4),void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0);var a=this.elements;a[0]=e,a[1]=t,a[2]=i,a[3]=n}f(e,"laya.d3.math.Vector4");var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t.fromArray=function(e,t){void 0===t&&(t=0),this.elements[0]=e[t+0],this.elements[1]=e[t+1],this.elements[2]=e[t+2],this.elements[3]=e[t+3]},t.cloneTo=function(e){var t=e.elements,i=this.elements;t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3]},t.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},t.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},v(0,t,"x",function(){return this.elements[0]},function(e){this.elements[0]=e}),v(0,t,"y",function(){return this.elements[1]},function(e){this.elements[1]=e}),v(0,t,"z",function(){return this.elements[2]},function(e){this.elements[2]=e}),v(0,t,"w",function(){return this.elements[3]},function(e){this.elements[3]=e}),e.lerp=function(e,t,i,n){var a=n.elements,r=e.elements,s=t.elements,o=r[0],l=r[1],h=r[2],c=r[3];a[0]=o+i*(s[0]-o),a[1]=l+i*(s[1]-l),a[2]=h+i*(s[2]-h),a[3]=c+i*(s[3]-c)},e.transformByM4x4=function(e,t,i){var n=e.elements,a=n[0],r=n[1],s=n[2],o=n[3],l=t.elements,h=i.elements;h[0]=a*l[0]+r*l[4]+s*l[8]+o*l[12],h[1]=a*l[1]+r*l[5]+s*l[9]+o*l[13],h[2]=a*l[2]+r*l[6]+s*l[10]+o*l[14],h[3]=a*l[3]+r*l[7]+s*l[11]+o*l[15]},e.equals=function(e,t){var i=e.elements,n=t.elements;return jt.nearEqual(Math.abs(i[0]),Math.abs(n[0]))&&jt.nearEqual(Math.abs(i[1]),Math.abs(n[1]))&&jt.nearEqual(Math.abs(i[2]),Math.abs(n[2]))&&jt.nearEqual(Math.abs(i[3]),Math.abs(n[3]))},e.normalize=function(e,t){var i=e.elements,n=t.elements,a=e.length();0<a&&(n[0]=i[0]*a,n[1]=i[1]*a,n[2]=i[2]*a,n[3]=i[3]*a)},e.add=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements;n[0]=a[0]+r[0],n[1]=a[1]+r[1],n[2]=a[2]+r[2],n[3]=a[3]+r[3]},e.subtract=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements;n[0]=a[0]-r[0],n[1]=a[1]-r[1],n[2]=a[2]-r[2],n[3]=a[3]-r[3]},e.multiply=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements;n[0]=a[0]*r[0],n[1]=a[1]*r[1],n[2]=a[2]*r[2],n[3]=a[3]*r[3]},e.scale=function(e,t,i){var n=i.elements,a=e.elements;n[0]=a[0]*t,n[1]=a[1]*t,n[2]=a[2]*t,n[3]=a[3]*t},e.Clamp=function(e,t,i,n){var a=e.elements,r=a[0],s=a[1],o=a[2],l=a[3],h=t.elements,c=h[0],u=h[1],d=h[2],_=h[3],p=i.elements,f=p[0],m=p[1],g=p[2],v=p[3],y=n.elements;r=(r=f<r?f:r)<c?c:r,s=(s=m<s?m:s)<u?u:s,o=(o=g<o?g:o)<d?d:o,l=(l=v<l?v:l)<_?_:l,y[0]=r,y[1]=s,y[2]=o,y[3]=l},e.distanceSquared=function(e,t){var i=e.elements,n=t.elements,a=i[0]-n[0],r=i[1]-n[1],s=i[2]-n[2],o=i[3]-n[3];return a*a+r*r+s*s+o*o},e.distance=function(e,t){var i=e.elements,n=t.elements,a=i[0]-n[0],r=i[1]-n[1],s=i[2]-n[2],o=i[3]-n[3];return Math.sqrt(a*a+r*r+s*s+o*o)},e.dot=function(e,t){var i=e.elements,n=t.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},e.min=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements;n[0]=Math.min(a[0],r[0]),n[1]=Math.min(a[1],r[1]),n[2]=Math.min(a[2],r[2]),n[3]=Math.min(a[3],r[3])},e.max=function(e,t,i){var n=i.elements,a=e.elements,r=t.elements;n[0]=Math.max(a[0],r[0]),n[1]=Math.max(a[1],r[1]),n[2]=Math.max(a[2],r[2]),n[3]=Math.max(a[3],r[3])},u(e,["ZERO",function(){return this.ZERO=new e},"ONE",function(){return this.ONE=new e(1,1,1,1)},"UnitX",function(){return this.UnitX=new e(1,0,0,0)},"UnitY",function(){return this.UnitY=new e(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new e(0,0,1,0)},"UnitW",function(){return this.UnitW=new e(0,0,0,1)}]),e}(),si=function(){function r(e,t,i,n){this.minDepth=0,this.maxDepth=1,this.x=e,this.y=t,this.width=i,this.height=n}f(r,"laya.d3.math.Viewport");var e=r.prototype;return e.project=function(e,t,i){ai.transformV3ToV3(e,t,i);var n=e.elements,a=t.elements,r=i.elements,s=n[0]*a[3]+n[1]*a[7]+n[2]*a[11]+a[15];1!==s&&(r[0]=r[0]/s,r[1]=r[1]/s,r[2]=r[2]/s),r[0]=.5*(r[0]+1)*this.width+this.x,r[1]=.5*(1-r[1])*this.height+this.y,r[2]=r[2]*(this.maxDepth-this.minDepth)+this.minDepth},e.unprojectFromMat=function(e,t,i){var n=e.elements,a=t.elements,r=i.elements;r[0]=(n[0]-this.x)/this.width*2-1,r[1]=-((n[1]-this.y)/this.height*2-1);var s=(this.maxDepth-this.minDepth)/2;r[2]=(n[2]-this.minDepth-s)/s;var o=r[0]*a[3]+r[1]*a[7]+r[2]*a[11]+a[15];ai.transformV3ToV3(i,t,i),1!==o&&(r[0]=r[0]/o,r[1]=r[1]/o,r[2]=r[2]/o)},e.unprojectFromWVP=function(e,t,i,n,a){qt.multiply(t,i,r._tempMatrix4x4),n&&qt.multiply(r._tempMatrix4x4,n,r._tempMatrix4x4),r._tempMatrix4x4.invert(r._tempMatrix4x4),this.unprojectFromMat(e,r._tempMatrix4x4,a)},u(r,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new qt}]),r}(),oi=function(){function e(){this._alphaBlending=1,this._colorIntensity=1,this._shaderValue=new _i}f(e,"laya.d3.resource.models.Sky");var t=e.prototype;return t._setEnvironmentDiffuse=function(){this._environmentDiffuse.loaded?this.__ownerCamera._shaderValues.setValue(7,this._environmentDiffuse):this._environmentDiffuse.on("loaded",this,this._environmentDiffuseLoaded)},t._setEnvironmentSpecular=function(){if(this._environmentSpecular.loaded){var e=this._environmentSpecular.simLodInfo;e&&e instanceof Float32Array&&this.__ownerCamera._shaderValues.setValue(9,e),this.__ownerCamera._shaderValues.setValue(8,this._environmentSpecular)}else this._environmentSpecular.on("loaded",this,this._environmentSpecularLoaded)},t._environmentDiffuseLoaded=function(){this.__ownerCamera._shaderValues.setValue(7,this._environmentDiffuse)},t._environmentSpecularLoaded=function(){var e=this._environmentSpecular.simLodInfo;e&&e instanceof Float32Array&&this.__ownerCamera._shaderValues.setValue(9,e),this.__ownerCamera._shaderValues.setValue(8,this._environmentSpecular)},t._render=function(e){},t.destroy=function(){this.__ownerCamera=null},v(0,t,"_ownerCamera",null,function(e){this.__ownerCamera=e,this._environmentDiffuse&&this._setEnvironmentDiffuse(),this._environmentSpecular&&this._setEnvironmentSpecular()}),v(0,t,"alphaBlending",function(){return this._alphaBlending},function(e){this._alphaBlending=e,this._alphaBlending<0&&(this._alphaBlending=0),1<this._alphaBlending&&(this._alphaBlending=1)}),v(0,t,"envDiffuseSHBlue",null,function(e){this.__ownerCamera._shaderValues.setValue(12,e)}),v(0,t,"colorIntensity",function(){return this._colorIntensity},function(e){this._colorIntensity=e,this._colorIntensity<0&&(this._colorIntensity=0)}),v(0,t,"envDiffuseSHGreen",null,function(e){this.__ownerCamera._shaderValues.setValue(11,e)}),v(0,t,"envDiffuseSHRed",null,function(e){this.__ownerCamera._shaderValues.setValue(10,e)}),v(0,t,"environmentDiffuse",function(){return this._environmentDiffuse},function(e){e.minFifter=9728,this._environmentDiffuse=e,this.__ownerCamera&&this._setEnvironmentDiffuse()}),v(0,t,"environmentSpecular",function(){return this._environmentSpecular},function(e){this._environmentSpecular=e,this.__ownerCamera&&this._setEnvironmentSpecular()}),e.MVPMATRIX=0,e.INTENSITY=1,e.ALPHABLENDING=2,e.DIFFUSETEXTURE=3,e}(),li=function(){function R(e){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=e,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}f(R,"laya.d3.resource.models.SubMesh");var e=R.prototype;return x.imps(e,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),e._getVertexBuffer=function(e){return void 0===e&&(e=0),0===e?this._vertexBuffer:null},e._getIndexBuffer=function(){return this._indexBuffer},e._getStaticBatchBakedVertexs=function(e,t){var i,n,a=this._vertexBuffer,r=a.vertexDeclaration,s=r.getVertexElementByUsage(0).offset/4,o=r.getVertexElementByUsage(3).offset/4,l=t.meshRender.lightmapScaleOffset,h=0,c=0,u=0,d=0,_=0,p=0;if(l)if(n=r.getVertexElementByUsage(15))u=r.vertexStride/4,i=0<this._vertexCount?a.getData().slice(this._vertexStart*u,(this._vertexStart+this._vertexCount)*u):a.getData().slice(),d=n.offset/4;else{u=(p=r.vertexStride/4)+2,i=this._vertexCount?new Float32Array(this._vertexCount*(a.vertexDeclaration.vertexStride/4+2)):new Float32Array(a.vertexCount*(a.vertexDeclaration.vertexStride/4+2)),d=(_=r.getVertexElementByUsage(2).offset/4)+2;var f=a.getData();for(h=0,c=f.length/p;h<c;h++){var m=0;m=0<this._vertexCount?(this._vertexStart+h)*p:h*p;var g=h*u,v=0;for(v=0;v<d;v++)i[g+v]=f[m+v];for(v=d;v<p;v++)i[g+v+2]=f[m+v]}}else u=r.vertexStride/4,i=this._vertexCount?a.getData().slice(this._vertexStart*u,(this._vertexStart+this._vertexCount)*u):a.getData().slice();if(e){var y=e.worldMatrix,C=R._tempMatrix4x40;y.invert(C);var E=R._tempMatrix4x41,S=t.transform.worldMatrix;qt.multiply(C,S,E)}else E=t.transform.worldMatrix;var x=R._tempQuaternion0;for(E.decomposeTransRotScale(R._tempVector30,x,R._tempVector31),h=0,c=i.length/u;h<c;h++){var T=h*u+s,w=h*u+o;if(Li.transformVector3ArrayToVector3ArrayCoordinate(i,T,E,i,T),Li.transformVector3ArrayByQuat(i,w,x,i,w),l){var M=h*u+d;if(n)Li.transformLightingMapTexcoordByUV1Array(i,M,l,i,M);else{var b=h*p+_;Li.transformLightingMapTexcoordByUV0Array(f,b,l,i,M)}}}return i},e._getVertexBuffers=function(){return null},e._beforeRender=function(e){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},e._render=function(e){var t,i=0,n=e.renderElement;if(1<this._indexCount){var a=this._boneIndicesList.length;if(1<a){for(var r=0;r<a;r++)(t=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,t[r]),e._shader.uploadRenderElementUniforms(n._shaderValue.data)),I.mainContext.drawElements(4,this._subIndexBufferCount[r],5123,2*this._subIndexBufferStart[r]);w.drawCall+=a}else(t=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,t[0]),e._shader.uploadRenderElementUniforms(n._shaderValue.data)),I.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),w.drawCall++;i=this._indexCount}else i=this._indexBuffer.indexCount,(t=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,t[0]),e._shader.uploadRenderElementUniforms(n._shaderValue.data)),I.mainContext.drawElements(4,i,5123,0),w.drawCall++;w.trianglesFaces+=i/3},e.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},e.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},v(0,e,"_vertexBufferCount",function(){return 1}),v(0,e,"triangleCount",function(){return this._indexBuffer.indexCount/3}),u(R,["_tempVector30",function(){return this._tempVector30=new ai},"_tempVector31",function(){return this._tempVector31=new ai},"_tempQuaternion0",function(){return this._tempQuaternion0=new Jt},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new qt},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new qt}]),R}(),hi=(f(ci,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),ci.prototype.registerDefine=function(e){var t=Math.pow(2,this.defineCounter++);return this.defines[t]=e,t},ci);function ci(e){this.defineCounter=0,this.defines=null,e?(this.defineCounter=e.defineCounter,this.defines=e.defines.slice()):(this.defineCounter=0,this.defines=[])}var ui=(f(di,"laya.d3.shader.ShaderInit3D"),di.__init__=function(){var e,t;Yi._globalRegDefine("HIGHPRECISION",Yi.SHADERDEFINE_HIGHPRECISION),Yi._globalRegDefine("FOG",Yi.SHADERDEFINE_FOG),Yi._globalRegDefine("DIRECTIONLIGHT",Yi.SHADERDEFINE_DIRECTIONLIGHT),Yi._globalRegDefine("POINTLIGHT",Yi.SHADERDEFINE_POINTLIGHT),Yi._globalRegDefine("SPOTLIGHT",Yi.SHADERDEFINE_SPOTLIGHT),Yi._globalRegDefine("UV",Yi.SHADERDEFINE_UV0),Yi._globalRegDefine("COLOR",Yi.SHADERDEFINE_COLOR),Yi._globalRegDefine("UV1",Yi.SHADERDEFINE_UV1),Yi._globalRegDefine("CASTSHADOW",pi.SHADERDEFINE_CAST_SHADOW),Yi._globalRegDefine("SHADOWMAP_PSSM1",pi.SHADERDEFINE_SHADOW_PSSM1),Yi._globalRegDefine("SHADOWMAP_PSSM2",pi.SHADERDEFINE_SHADOW_PSSM2),Yi._globalRegDefine("SHADOWMAP_PSSM3",pi.SHADERDEFINE_SHADOW_PSSM3),Yi._globalRegDefine("SHADOWMAP_PCF_NO",pi.SHADERDEFINE_SHADOW_PCF_NO),Yi._globalRegDefine("SHADOWMAP_PCF1",pi.SHADERDEFINE_SHADOW_PCF1),Yi._globalRegDefine("SHADOWMAP_PCF2",pi.SHADERDEFINE_SHADOW_PCF2),Yi._globalRegDefine("SHADOWMAP_PCF3",pi.SHADERDEFINE_SHADOW_PCF3),Yi._globalRegDefine("DEPTHFOG",Yi.SAHDERDEFINE_DEPTHFOG),Tn.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),Tn.addInclude("Lighting.glsl","\nstruct DirectionLight\n{\n\tvec3 Color;\n\tvec3 Direction;\n};\n\nstruct PointLight\n{\n\tvec3 Color;\n\tvec3 Position;\n\tfloat Range;\n};\n\nstruct SpotLight\n{\n\tvec3 Color;\n\tvec3 Position;\n\tvec3 Direction;\n\tfloat Spot;\n\tfloat Range;\n};\n\n// U3D中使用衰减纹理,此函数模拟并非正确\n//float U3DAttenuation(in vec3 L,in float invLightRadius)\n//{\n//\tfloat fRatio = clamp(length(L) * invLightRadius,0.0,1.0);\n//\tfRatio *= fRatio;\n//\treturn 1.0 / (1.0 + 25.0 * fRatio)* clamp(4.0*(1.0 - fRatio),0.0,1.0); //fade to black as if 4 pixel texture\n//} \n\n// Same as Just Cause 2 and Crysis 2 (you can read GPU Pro 1 book for more information)\nfloat BasicAttenuation(in vec3 L,in float invLightRadius)\n{\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = clamp(1.0 - dot(distance, distance),0.0,1.0); // Equals float attenuation = saturate(1.0f - dot(L, L) / (lightRadius *  lightRadius)); \t\n\treturn attenuation * attenuation;\n} \n\n// Inspired on http://fools.slindev.com/viewtopic.php?f=11&t=21&view=unread#unread\t\nfloat NaturalAttenuation(in vec3 L,in float invLightRadius)\n{\n\tfloat attenuationFactor = 30.0;\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = dot(distance, distance); // Equals float attenuation = dot(L, L) / (lightRadius *  lightRadius);\n\tattenuation = 1.0 / (attenuation * attenuationFactor + 1.0);\n\t// Second we move down the function therewith it reaches zero at abscissa 1:\n\tattenuationFactor = 1.0 / (attenuationFactor + 1.0); //attenuationFactor contains now the value we have to subtract\n\tattenuation = max(attenuation - attenuationFactor, 0.0); // The max fixes a bug.\n\t// Finally we expand the equation along the y-axis so that it starts with a function value of 1 again.\n\tattenuation /= 1.0 - attenuationFactor;\n\treturn attenuation;\n} \n\nvoid LayaAirBlinnPhongLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir,in vec3 lightColor, in vec3 lightVec,out vec3 diffuseColor,out vec3 specularColor)\n{\n    mediump vec3 h = normalize(viewDir-lightVec);\n    lowp float ln = max (0.0, dot (-lightVec,normal));\n    float nh = max (0.0, dot (h,normal));\n\tdiffuseColor=lightColor * ln;\n\tspecularColor=lightColor *specColor*pow (nh, specColorIntensity*128.0) * gloss;\n}\n\nvoid LayaAirBlinnPhongDiectionLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in DirectionLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n\tvec3 lightVec=normalize(light.Direction);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,lightVec,diffuseColor,specularColor);\n}\n\nvoid LayaAirBlinnPhongPointLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in PointLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n\tvec3 lightVec =  pos-light.Position;\n\t//if( length(lightVec) > light.Range )\n\t//\treturn;\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,lightVec/length(lightVec),diffuseColor,specularColor);\n\tfloat attenuate = BasicAttenuation(lightVec, 1.0/light.Range);\n\tdiffuseColor *= attenuate;\n\tspecularColor*= attenuate;\n}\n\nvoid LayaAirBlinnPhongSpotLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in SpotLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n\tvec3 lightVec =  pos-light.Position;\n\t//if( length(lightVec) > light.Range )\n\t//\treturn;\n\tvec3 normalLightVec=lightVec/length(lightVec);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,normalLightVec,diffuseColor,specularColor);\n\tfloat spot = pow(max(dot(normalLightVec, normalize(light.Direction)), 0.0), light.Spot);\n\tfloat attenuate = spot*BasicAttenuation(lightVec, 1.0/light.Range);\n\tdiffuseColor *= attenuate;\n\tspecularColor*= attenuate;\n}\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent,vec3 binormal)\n{\n\tvec3 normalT =vec3(2.0*normalMapSample.x - 1.0,1.0-2.0*normalMapSample.y,2.0*normalMapSample.z - 1.0);\n\t\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent);\n\tvec3 B = normalize(binormal);\n\tmat3 TBN = mat3(T, B, N);\n\t\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\n"),Tn.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),Tn.addInclude("WaveFunction.glsl","\nuniform vec2 u_WaveInfoD[20];\nuniform vec4 u_WaveInfo[20];\n\nuniform float TEXWAVE_UV_SCALE ;//= 20.0; //每texwidth像素代表的实际距离\n/**\n\t这里的计算都是\n*/\n\n/**\n* 计算一个波形\n*  开始计算的时候都按照z向上，最后输出的时候，颠倒一下。\n* @param tm {float} 毫秒\n*/\nvoid calcGerstnerWave(float curtm, vec3 pos, float deep, vec2 uvpos, out vec3 opos, out vec3 B, out vec3 T, out vec3 N, out float foamS){\n\tfloat tm = curtm/1000.;\n\topos = pos;\n\tvec3 wpos=vec3(0.);\t\t//累加的位置\n\tN=vec3(0.,0.,0.);\t//输出的法线初始化一下\n\tT=vec3(0.,0.,0.);\n\tB=vec3(0.,0.,0.);\n\tvec2 cD ;//= D;\n\t//float deepAtt = max(0.,min(deep,1.0));\n\t//A*=deepAtt; //TODO\n\t\n\tfor( int i=0; i<4; i++){\n\t\tcD = u_WaveInfoD[i];//vec2(wi.winfo[0],wi.winfo[1]);// wi.vDir;\n\t\tfloat Q = u_WaveInfo[i].x;//wi.QorK;\n\t\tfloat A = u_WaveInfo[i].y;//wi.A;\n\t\tfloat W = u_WaveInfo[i].z;//wi.omega;\n\t\tfloat P = u_WaveInfo[i].w;//wi.phi;\n\t\tfloat dop = dot(cD,uvpos);\n\t\tfloat c = cos(dop*W - tm*P);//TODO 优化\n\t\tfloat s = sin(dop*W - tm*P);\n\t\tfloat AWs = A*W*s;\n\t\tfloat AWc = A*W*c;\n\t\tfloat _QxyAWs = -Q*cD.x*cD.y*AWs;\n\t\t\n\t\twpos += vec3(Q*A*cD.x*c,\n\t\t\t\t\tQ*A*cD.y*c,\n\t\t\t\t\tA*s);\n\t\tN += vec3(-cD.x*AWc,\n\t\t\t\t-cD.y*AWc,\n\t\t\t\tQ*AWs);//记得最后1-\n\t\tT += vec3(_QxyAWs,\n\t\t\t\tQ*cD.y*cD.y*AWs,//记得1-\n\t\t\t\tcD.y*AWc\n\t\t\t);\n\t\tB += vec3(Q*cD.x*cD.x*AWs,//记得1-\n\t\t\t\t_QxyAWs,\n\t\t\t\tcD.x*AWc\n\t\t\t);\n\t\t//float v1 = exp(-tan((dop*W - tm*P)/2.+1.07));//除2，+pi/2 这样正好能对齐\n#ifdef USE_FOAM\t\t\n\t\tfloat v1 = 0.5-sin((dop*W - tm*P)/1.+2.0)/2.;\n\t\tfoamS += pow(v1,9.)/4.;\n#endif\n\t}\n\tT.y=1.-T.y; B.x=1.-B.x;N.z=1.-N.z;\n\topos += vec3(wpos.x,wpos.z*min(deep/10.,1.),wpos.y);\n\t//y和z交换一下。现在根据uv计算的位置，所以直接交换yz就行。其他情况下有问题么\n\tT.xyz=T.xzy;\n\tB.xyz=B.xzy;\n\tN.xyz=N.xzy;\n}\n\n\nvoid calcWave(float curtm, vec2 uv, out vec3 B, out vec3 T, out vec3 N){\n\tfloat tm = curtm/1000.;\n\tN=vec3(0.,0.,0.);\t//输出的法线初始化一下\n\tvec2 uvpos = uv*TEXWAVE_UV_SCALE; //TODO 这个范围是什么 就是1？\n\tuvpos.y*=-1.;\n\tvec2 cD;// = D;\n\tconst int NumWaves = 4;\n\tfloat scale = 1./float(NumWaves);\n\tfor( int i=0; i<NumWaves; i++){\n\t\tcD = u_WaveInfoD[i];//vec2(wi.winfo[0],wi.winfo[1]);// wi.vDir;\n\t\tfloat k = 1.5;//u_WaveInfo[i].x;//wi.QorK; TODO  不知道为什么，这个取u_WaveInfo[i].x，在mi3w上就会闪。测试发现实际值也传过来了，就是1.5\n\t\tfloat A = u_WaveInfo[i].y;//wi.A;\n\t\tfloat W = u_WaveInfo[i].z;//wi.omega;\n\t\tfloat P = u_WaveInfo[i].w;//wi.phi;\n\t\t\n\t\tfloat dop = dot(cD,uvpos);\n\t\tfloat c = cos(dop*W - tm*P);//TODO 优化\n\t\tfloat s = sin(dop*W - tm*P);\n\t\t/*\n\t\tfloat AWs = A*W*s;\n\t\tfloat AWc = A*W*c;\n\t\tfloat _QxyAWs = -Q*cD.x*cD.y*AWs;\n\t\t\n\t\tN += vec3(-cD.x*AWc,\n\t\t\t\t-cD.y*AWc,\n\t\t\t\tQ*AWs);//记得最后1-\n\t\t*/\n\t\tfloat kWAc = scale*c;//k*W*A*c;  为了提高精度，这里只保留sin，cos部分，实际使用的时候再乘回来。\n\t\t//float kWAc = k*W*A*c;  \n\t\tN += vec3(\n\t\t\t-kWAc*cD.x*pow((s+1.)/2.,k-1.),\n\t\t\t-kWAc*cD.y*pow((s+1.)/2.,k-1.),\n\t\t\t1.\n\t\t);\n\t}\n\t//N.z=1.-N.z;\n\t//y和z交换一下。现在根据uv计算的位置，所以直接交换yz就行。其他情况下有问题么\n\tN.xyz=N.xzy;\n}\n"),Tn.addInclude("BRDF.glsl","vec4 LayaAirBRDF(in vec3 diffuseColor, in vec3 specularColor, in float oneMinusReflectivity, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in vec3 gi)\n{\n\tfloat perceptualRoughness = SmoothnessToPerceptualRoughness(smoothness);\n\tvec3 halfDir = SafeNormalize(viewDir - lightDir);\n\t\n\tfloat nv = abs(dot(normal, viewDir));\n\t\n\tfloat nl = clamp(dot(normal,   -lightDir),  0.0, 1.0);\n\tfloat nh = clamp(dot(normal,     halfDir),  0.0, 1.0);\n\tfloat lv = clamp(dot(lightDir,   viewDir),  0.0, 1.0);\n\tfloat lh = clamp(dot(lightDir,  -halfDir),  0.0, 1.0);\n\t\n\tfloat diffuseTerm = DisneyDiffuse(nv, nl, lh, perceptualRoughness) * nl;\n\t\n\tfloat roughness = PerceptualRoughnessToRoughness(perceptualRoughness);\n\t\n\t//#if UNITY_BRDF_GGX\n\tfloat V = SmithJointGGXVisibilityTerm(nl, nv, roughness);\n\tfloat D = GGXTerm(nh, roughness);\n\t\n\tfloat specularTerm = V * D * PI;\n\t\n\tspecularTerm = sqrt(max(0.0001, specularTerm));\n\tspecularTerm = max(0.0, specularTerm * nl);\n\t\n\tvec4 color;\n\tcolor.rgb = diffuseColor * (gi + lightColor * diffuseTerm) + specularTerm * lightColor * FresnelTerm (specularColor, lh);\n\t\n\tcolor.a = 1.0;\n\treturn color;\n}"),Tn.addInclude("PBRUtils.glsl","struct DirectionLight\n{\n\tvec3 Color;\n\tvec3 Direction;\n};\n\nvec3 UnpackScaleNormal(in vec2 uv0)\n{\n\t#ifdef NORMALTEXTURE\n\t\tvec3 normalT;\n\t\tvec4 normalMapSample = texture2D(u_NormalTexture, uv0);\n\t\tnormalT.x = 2.0 * normalMapSample.x - 1.0;\n\t\tnormalT.y = 1.0 - 2.0 * normalMapSample.y;\n\t\tnormalT.xy *= u_normalScale;\n\t\tnormalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\n\t\t\n\t\tvec3 T = normalize(v_Tangent);\n\t\tvec3 B = normalize(v_Binormal);\n\t\tvec3 N = normalize(v_Normal);\n\t\tmat3 TBN = mat3(T, B, N);\n\t\t\n\t\tvec3 bumpedNormal = TBN * normalize(normalT);\n\t\treturn bumpedNormal;\n\t#else\n\t\treturn normalize(v_Normal);\n\t#endif\n}\n\nvec4 DielectricSpecularColor = vec4(0.220916301, 0.220916301, 0.220916301, 1.0 - 0.220916301);\n\nfloat PI = 3.14159265359;\n\nvec3 FresnelTerm (in vec3 F0, in float cosA)\n{\n\treturn F0 + (vec3(1.0) - F0) * pow(1.0 - cosA, 5.0);\n}\n\nfloat PerceptualRoughnessToRoughness(in float perceptualRoughness)\n{\n\treturn perceptualRoughness * perceptualRoughness;\n}\n\nfloat PerceptualRoughnessToSpecularPower(in float perceptualRoughness)\n{\n\tfloat m = PerceptualRoughnessToRoughness(perceptualRoughness);\n\tfloat sq = max(0.0001, m * m);\n\tfloat n = (2.0 / sq) - 2.0;\n\tn = max(n, 0.0001);\n\treturn n;\n}\n\nfloat RoughnessToPerceptualRoughness(in float roughness)\n{\n\treturn sqrt(roughness);\n}\n\nfloat SmoothnessToRoughness(in float smoothness)\n{\n\treturn (1.0 - smoothness) * (1.0 - smoothness);\n}\n\nfloat SmoothnessToPerceptualRoughness(in float smoothness)\n{\n\treturn (1.0 - smoothness);\n}\n\nvec3 SafeNormalize(in vec3 inVec)\n{\n\tfloat dp3 = max(0.001,dot(inVec,inVec));\n\treturn inVec * (1.0 / sqrt(dp3));\n}\n\nfloat DisneyDiffuse(in float NdotV, in float NdotL, in float LdotH, in float perceptualRoughness)\n{\n\tfloat fd90 = 0.5 + 2.0 * LdotH * LdotH * perceptualRoughness;\n\tfloat lightScatter\t= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotL,5.0));\n\tfloat viewScatter\t= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotV,5.0));\n\n\treturn lightScatter * viewScatter;\n}\n\nfloat SmithJointGGXVisibilityTerm (float NdotL, float NdotV, float roughness)\n{\n\tfloat a = roughness;\n\tfloat lambdaV = NdotL * (NdotV * (1.0 - a) + a);\n\tfloat lambdaL = NdotV * (NdotL * (1.0 - a) + a);\n\n\treturn 0.5 / (lambdaV + lambdaL + 0.00001);\n}\n\nfloat GGXTerm (float NdotH, float roughness)\n{\n\tfloat a2 = roughness * roughness;\n\tfloat d = (NdotH * a2 - NdotH) * NdotH + 1.0;\n\treturn 0.31830988618 * a2 / (d * d + 0.0000001);\n}\n\nfloat OneMinusReflectivityFromMetallic(in float metallic)\n{\n\tfloat oneMinusDielectricSpec = DielectricSpecularColor.a;\n\treturn oneMinusDielectricSpec - metallic * oneMinusDielectricSpec;\n}\n\nfloat SpecularStrength(vec3 specular)\n{\n    //(SHADER_TARGET < 30)return specular.r; \n    return max (max (specular.r, specular.g), specular.b);\n}\n\nvec3 DiffuseAndSpecularFromMetallic(in vec3 diffuseColor, in float metallic, out vec3 specularColor, out float oneMinusReflectivity)\n{\n\tspecularColor = mix(DielectricSpecularColor.rgb, diffuseColor, metallic);\n\toneMinusReflectivity = OneMinusReflectivityFromMetallic(metallic);\n\treturn diffuseColor * oneMinusReflectivity;\n}\n\nvec3 EnergyConservationBetweenDiffuseAndSpecular(in vec3 diffuseColor, in vec3 specularColor, out float oneMinusReflectivity)\n{\n\toneMinusReflectivity = 1.0 - SpecularStrength(specularColor);\n\treturn diffuseColor * oneMinusReflectivity;\n}\n\nvec4 Occlusion(in vec2 uv0){\n\t#ifdef OCCLUSIONTEXTURE\n\t\tvec4 occlusionTextureColor = texture2D(u_OcclusionTexture, uv0);\n\t\tfloat occ = occlusionTextureColor.g;\n\t\tfloat oneMinusT = 1.0 - u_occlusionStrength;\n\t\tfloat lerpOneTo = oneMinusT + occ * u_occlusionStrength;\n\t\treturn occlusionTextureColor * lerpOneTo;\n\t#else\n\t\treturn vec4(1.0);\n\t#endif\n}\n\nvec2 ParallaxOffset(in vec3 viewDir){\n\t#ifdef PARALLAXTEXTURE\n\t\tfloat h = texture2D(u_ParallaxTexture, v_Texcoord0).g;\n\t\th = h * u_parallaxScale - u_parallaxScale / 2.0;\n\t\tvec3 v = viewDir;\n\t\tv.z += 0.42;\n\t\tvec2 offset = h * (v.xy / v.z);\n\t\treturn v_Texcoord0 + offset;\n\t#else\n\t\treturn v_Texcoord0;\n\t#endif\n}\n\n"),Tn.addInclude("PBRStandardLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRStandardLight(in vec3 diffuseColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in vec3 gi)\n{\n\tfloat oneMinusReflectivity;\n\tvec3 specularColor;\n\tdiffuseColor = DiffuseAndSpecularFromMetallic (diffuseColor, metallic, specularColor, oneMinusReflectivity);\n\t\n\tvec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n\treturn color;\n}\n\nvec4 PBRStandardDiectionLight (in vec3 diffuseColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in vec3 gi)\n{\n\tvec3 lightVec = normalize(light.Direction);\n\treturn PBRStandardLight(diffuseColor, metallic, smoothness, normal, viewDir, lightVec, light.Color, gi);\n}\n\nvec2 MetallicGloss(in float diffuseTextureAlpha, in vec2 uv0)\n{\n\tvec2 mg;\n\t\n\t#ifdef METALLICGLOSSTEXTURE\n\t\tvec4 metallicGlossTextureColor = texture2D(u_MetallicGlossTexture, uv0);\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tmg.r = metallicGlossTextureColor.r;\n\t\t\tmg.g = diffuseTextureAlpha;\n\t\t#else\n\t\t    mg = metallicGlossTextureColor.ra;\n\t\t#endif\n\t\tmg.g *= u_smoothnessScale;\n\t#else\n\t\tmg.r = u_metallic;\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tmg.g = diffuseTextureAlpha * u_smoothnessScale;\n\t\t#else\n\t\t\tmg.g = u_smoothness;\n\t\t#endif\n\t#endif\n\t\n\treturn mg;\n}\n\n'),Tn.addInclude("PBRSpecularLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRSpecularLight(in vec3 diffuseColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in vec3 gi)\n{\n\tfloat oneMinusReflectivity;\n\tdiffuseColor = EnergyConservationBetweenDiffuseAndSpecular (diffuseColor, specularColor, oneMinusReflectivity);\n\t\n\tvec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n\treturn color;\n}\n\nvec4 PBRSpecularDiectionLight (in vec3 diffuseColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in vec3 gi)\n{\n\tvec3 lightVec = normalize(light.Direction);\n\treturn PBRSpecularLight(diffuseColor, specularColor, smoothness, normal, viewDir, lightVec, light.Color, gi);\n}\n\nvec4 SpecularGloss(float diffuseTextureAlpha, in vec2 uv0)\n{\n    vec4 sg;\n\t\n\t#ifdef SPECULARTEXTURE\n\t\tvec4 specularTextureColor = texture2D(u_SpecularTexture, uv0);\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tsg.rgb = specularTextureColor.rgb;\n\t\t\tsg.a = diffuseTextureAlpha;\n\t\t#else\n\t\t\tsg = specularTextureColor;\n\t\t#endif\n\t\tsg.a *= u_smoothnessScale;\n\t#else\n\t\tsg.rgb = u_SpecularColor.rgb;\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tsg.a = diffuseTextureAlpha * u_smoothnessScale;\n\t\t#else\n\t\t\tsg.a = u_smoothness;\n\t\t#endif\n\t#endif\n\t\n    return sg;\n}\n\n');var i={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_ReflectTexture:[5,1],u_AlphaTestValue:[0,1],u_DiffuseColor:[6,1],u_MaterialSpecular:[8,1],u_Shininess:[9,1],u_MaterialReflect:[10,1],u_TilingOffset:[11,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Color":[4,4],"u_DirectionLight.Direction":[3,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Color":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Color":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]},a=Tn.nameKey.add("BLINNPHONG");e='attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n\tattribute vec4 a_Color;\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal; \n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir; \n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tmat3 worldMat;\n\t\t#ifdef BONE\n\t\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\t#else\n\t\t\tworldMat=mat3(u_WorldMat);\n\t\t#endif  \n\t\tv_Normal=worldMat*a_Normal;//TODO:法线可以用"魔法"矩阵\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tv_Tangent=worldMat*a_Tangent0.xyz;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t\t#ifdef BONE\n\t\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t\t#else\n\t\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t#endif\n\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\t\tv_Texcoord0=a_Texcoord0;\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0+v_Texcoord0.y);\n\t\t#endif\n\t#endif\n\n\t#ifdef LIGHTMAP\n\t\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t\t#else\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t\t#endif \n\t\t#else\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t\t#else\n\t\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t\t#endif \n\t\t#endif \n\t#endif\n\n\t#ifdef COLOR\n\t\tv_Color=a_Color;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}',t='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nuniform vec4 u_DiffuseColor;\n\n#ifdef COLOR\n\tvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvarying vec3 v_ViewDir; \n#endif\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\n\tuniform samplerCube u_ReflectTexture;\n\tuniform vec3 u_MaterialReflect;\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_MaterialSpecular;\n\tuniform float u_Shininess;\n\t#ifdef SPECULARMAP \n\t\tuniform sampler2D u_SpecularTexture;\n\t#endif\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\tuniform sampler2D u_NormalTexture;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n\tvec4 mainColor=u_DiffuseColor;\n\t#ifdef DIFFUSEMAP\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\t\tmainColor=mainColor*difTexColor;\n\t#endif \n\t#ifdef COLOR\n\t\tmainColor=mainColor*v_Color;\n\t#endif \n    \n\t#ifdef ALPHATEST\n\t\tif(mainColor.a<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tvec3 normal;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n\t\t#else\n\t\t\tnormal = normalize(v_Normal);\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 viewDir= normalize(v_ViewDir);\n\t\tvec3 diffuse = vec3(0.0);\n\t\tvec3 specular= vec3(0.0);\n\t\tvec3 dif,spe;\n\t\t#ifdef SPECULARMAP\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n\t\t#else\n\t\t\t#ifdef DIFFUSEMAP\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\n\t\t\t#else\n\t\t\t\tvec3 gloss=vec3(1.0);\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t\n\t#ifdef DIRECTIONLIGHT\n\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n \n\t#ifdef POINTLIGHT\n\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t#ifdef SPOTLIGHT\n\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t\n\tvec3 finalDiffuse;\n\t#ifdef LIGHTMAP\n\t\tfinalDiffuse=texture2D(u_LightMap, v_LightMapUV).rgb*2.0;\n\t\t//float exponent = texture2D(u_LightMap, v_LightMapUV).a;\n\t\t//finalDiffuse = texture2D(u_LightMap, v_LightMapUV).rgb;\n\t\t//float ratio = pow(2.0, exponent * 255.0 - (128.0 + 8.0));\n\t\t//finalDiffuse = finalDiffuse * 255.0 * ratio;\t\n\t\t//finalDiffuse = sqrt(finalDiffuse);\n\t#else\n\t\tfinalDiffuse=vec3(0.0);\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tfinalDiffuse+=diffuse;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor =vec4(mainColor.rgb*(u_AmbientColor + finalDiffuse)*shadowValue,mainColor.a);\n\t#else\n\t\tgl_FragColor =vec4(mainColor.rgb*(u_AmbientColor + finalDiffuse),mainColor.a);\n\t#endif\n\t\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t#ifdef RECEIVESHADOW\n\t\t\tgl_FragColor.rgb+=specular*shadowValue;\n\t\t#else\n\t\t\tgl_FragColor.rgb+=specular;\n\t\t#endif\n\t#endif\n\n\n\t#ifdef REFLECTMAP\n\t\tvec3 incident = -viewDir;\n\t\tvec3 reflectionVector = reflect(incident,normal);\n\t\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\t\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n\t#endif\n\t  \n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t  main_normal();\n\t#endif  \n}\n\n';var r=Yi.add(a,e,t,i,n);wn.SHADERDEFINE_DIFFUSEMAP=r.registerMaterialDefine("DIFFUSEMAP"),wn.SHADERDEFINE_NORMALMAP=r.registerMaterialDefine("NORMALMAP"),wn.SHADERDEFINE_SPECULARMAP=r.registerMaterialDefine("SPECULARMAP"),wn.SHADERDEFINE_REFLECTMAP=r.registerMaterialDefine("REFLECTMAP"),wn.SHADERDEFINE_TILINGOFFSET=r.registerMaterialDefine("TILINGOFFSET"),wn.SHADERDEFINE_ADDTIVEFOG=r.registerMaterialDefine("ADDTIVEFOG"),i={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var s=Tn.nameKey.add("SIMPLE");e="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",t='#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',r=Yi.add(s,e,t,i,n),In.SHADERDEFINE_DIFFUSEMAP=r.registerMaterialDefine("DIFFUSEMAP"),In.SHADERDEFINE_NORMALMAP=r.registerMaterialDefine("NORMALMAP"),In.SHADERDEFINE_SPECULARMAP=r.registerMaterialDefine("SPECULARMAP"),In.SHADERDEFINE_EMISSIVEMAP=r.registerMaterialDefine("EMISSIVEMAP"),In.SHADERDEFINE_AMBIENTMAP=r.registerMaterialDefine("AMBIENTMAP"),In.SHADERDEFINE_REFLECTMAP=r.registerMaterialDefine("REFLECTMAP"),In.SHADERDEFINE_UVTRANSFORM=r.registerMaterialDefine("UVTRANSFORM"),In.SHADERDEFINE_TILINGOFFSET=r.registerMaterialDefine("TILINGOFFSET"),In.SHADERDEFINE_ADDTIVEFOG=r.registerMaterialDefine("ADDTIVEFOG"),i={a_Position:0,a_Color:1},n={u_MvpMatrix:[1,2]};var o=Tn.nameKey.add("LINE");e="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n  gl_Position = u_MvpMatrix * a_Position;\n  v_Color=a_Color;\n}",t="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\n\nvoid main()\n{\n  gl_FragColor=v_Color; \n}\n\n",Yi.add(o,e,t,i,n),i={a_position:0,a_normal:3,tangent:5,binormal:4,uv:2,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_lodRect:[9,3],irrad_mat_red:[10,3],irrad_mat_green:[11,3],irrad_mat_blue:[12,3],u_hdrexposure:[13,3],u_aoObjPos:[14,1],texBaseColor:[1,1],texNormal:[2,1],texPbrInfo:[3,1],texPrefilterdEnv:[8,3],texHSNoise:[15,1],texPrefilterDiff:[7,3],u_AlphaTestValue:[0,1],texBRDFLUT:[4,1],u_UVAniAge:[5,1],u_roughness:[6,1],u_metaless:[7,1],u_UVMatrix:[8,1],u_UVAge:[9,1],modelMatrix:[0,2],mvp:[1,2],cameraPosition:[0,3],u_View:[1,3],u_Project:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var l=Tn.nameKey.add("PBR");e="\nuniform mat4 modelMatrix;\n//uniform mat4 modelViewMatrix;\n//uniform mat4 projectionMatrix;\nuniform mat4 u_View;\nuniform mat4 u_Project;\nuniform mat4 mvp;\n//uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\n#ifdef HAS_TANGENT\nattribute vec3 tangent;\nattribute vec3 binormal;\n#endif\nattribute vec2 uv;\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying vec3 vLightDir;\nvarying vec3 vViewDir;\n#ifdef HAS_TANGENT\nvarying vec3 vWorldTangent;\nvarying vec3 vWorldBinormal;\n#endif\n\n#ifdef RECEIVESHADOW\nvarying float v_posViewZ;\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\nvoid main() {\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tgl_Position = mvp*skinTransform*vec4(a_position,1.);\n\tmat4 modelMat = modelMatrix*skinTransform;\n#else\n\tgl_Position = mvp*vec4(a_position,1.);\n\tmat4 modelMat = modelMatrix;\n#endif\t\n\tvWorldPos = modelMat*vec4(a_position,1.);\n\n#ifdef CASTSHADOW \n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tvUv = uv;\n\t#endif\t\n#else\n    vUv = uv;\n\tvWorldNorm = normalize((modelMat*vec4(a_normal,0.0)).xyz);\n\t#ifdef HAS_TANGENT\n\tvWorldTangent = normalize((modelMat*vec4(tangent,0.0)).xyz);\n\tvWorldBinormal = normalize((modelMat*vec4(binormal,0.0)).xyz);\n\t#endif\n    \n    vViewDir = (vWorldPos.xyz-cameraPosition);//这个不能normalize。否则无法线性差值了\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.z;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vWorldPos;\n\t#endif\n#endif\t\n#endif\n}\n",t='//#version 300 es\n\nprecision highp float;\nprecision lowp int;\n\nconst float PI = 3.14159265358979323846264;\nconst float _2PI = 6.2831853071796;\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\n#ifdef HAS_TANGENT\nvarying vec3 vWorldTangent;\nvarying vec3 vWorldBinormal;\n#endif\nvarying vec3 vViewDir;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\n//\nuniform sampler2D texBaseColor;\nuniform sampler2D texNormal;\n//预计算的贴图\nuniform sampler2D texPrefilterdEnv;\nuniform sampler2D texBRDFLUT;\nuniform sampler2D texPrefilterDiff;\n#ifdef HAS_PBRINFO\nuniform sampler2D texPbrInfo;   //Ao, Roughness, Metallic\n#endif\nuniform float u_hdrexposure;\nuniform float u_AlphaTestValue;\n\nuniform float u_roughness;\nuniform float u_metaless;\nconst float maxlv = 7.;\t//现在只支持512分辨率的环境贴图\nconst int nmaxlv = 9;//\n\t\t\t\t\t\t\t\nuniform mat4 irrad_mat_red;\nuniform mat4 irrad_mat_green;\nuniform mat4 irrad_mat_blue;\t\t\t\t\t\t\t\n\nvec3 speccontrib = vec3(0.);\n\nconst float _maxu8 = 255.0;\nconst float _maxu16 = 65535.0;\nconst float _shift8 = 256.0;    //平移的话是*256而不是255\nvec2 _RGBAToU16(const in vec4 rgba){\n    return vec2((rgba.r*_maxu8+rgba.g*_maxu8*_shift8)/_maxu16, (rgba.b*_maxu8+rgba.a*_maxu8*_shift8)/_maxu16);\n}\nvec3 _RGBEToRGB( const in vec4 rgba ){\n    float f = pow(2.0, rgba.w * 255.0 - (128.0 + 8.0));\n    return rgba.rgb * (255.0 * f);\n}\n\nfloat saturate(float v){\n    return min(max(v,0.),1.);\n}\n\nvec4 tex2dLod(sampler2D tex, float u, float v, float lod){\n\tvec2 uv = vec2(u,v);\n\tuv+=mod(gl_FragCoord.xy-vec2(0.5),2.0)*vec2(128.,0.);\n\treturn texture2D(tex,uv,lod-16.);\n}\n\n/*\n* 对一个全景图进行采样。假设x轴指向中心。\n*/\nvec4 texPanorama(sampler2D tex, const in vec3 dir){\n\tfloat envu = atan(dir.z,dir.x)/_2PI+0.5; \t\n\tfloat envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n\treturn texture2D(tex,vec2(envu,envv));\n}\n\nvec4 texPanoramaLod(sampler2D tex, const in vec3 dir, float lod){\n\tfloat envu = atan(dir.z,dir.x)/_2PI+0.5; \t\n\tfloat envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n\treturn tex2dLod(tex,envu,envv,lod);\n}\n\n/*\n    计算sh光照。\n    使用level=2，所以需要9个系数。\n    https://cseweb.ucsd.edu/~ravir/papers/envmap/envmap.pdf\n*/\nfloat environment_exposure = 1.0;\nvec3 diff_sh9(vec3 dir){\n\tvec4 shDir = vec4(dir.x,-dir.z,dir.y,1.0);\n  return max(vec3(0.0), vec3(\n\tdot(shDir, irrad_mat_red * shDir),\n\tdot(shDir, irrad_mat_green * shDir),\n\tdot(shDir, irrad_mat_blue * shDir)\n\t)) * environment_exposure;\t\n}\n\n#ifdef HAS_TANGENT\nvec3 applyNormalTex( vec3 norm, vec3 surf_norm ) {\n    vec3 mapN = norm * 2.0 - 1.0;\n    //mapN.xy = normalScale * mapN.xy;\n    mat3 tsn = mat3( vWorldTangent, vWorldBinormal, surf_norm );\n    return normalize( tsn * mapN );\n}\n#endif\n\nvec4 pbrlight(vec3 normal, float rough, float NoV, vec3 R){\n    vec4 basecolor = texture2D(texBaseColor,vUv);\n\tbasecolor.rgb = pow(basecolor.rgb,vec3(2.2));\n\tfloat metaless = 1.0; \t\n\tconst float ismetalinfov = (128./255.);\n\tif(basecolor.a>=ismetalinfov){//这时候表示金属度\n\t\tmetaless = (basecolor.a-ismetalinfov)*2.;\n\t\tbasecolor.a = 1.0;\n\t}else{\n\t\tmetaless = 0.;\n\t\tbasecolor.a = basecolor.a*2.0;\n\t}\n\t#ifdef FIX_METALESS\n\tmetaless = u_metaless;\n\t#endif\n\t#ifdef HAS_PBRINFO\t\n\tvec4 pbrinfo = texture2D(texPbrInfo, vUv);\n\tmetaless = pbrinfo.b;\n\trough = pbrinfo.g;\n\t#endif\n    const vec3 nonmetalF0 =vec3(0.02);\n    vec3 F0 =  mix(nonmetalF0, basecolor.rgb, metaless);\n\t\n    vec4 PrefilteredColor = texPanoramaLod(texPrefilterdEnv, R, rough*maxlv);\n    PrefilteredColor.rgb = _RGBEToRGB(PrefilteredColor);\n    vec4 EnvBRDF = texture2D(texBRDFLUT,vec2(rough , NoV));//TODO lod\n    vec2 rg = _RGBAToU16(EnvBRDF);    \n    speccontrib = (F0* rg.x + saturate( 50.0 * PrefilteredColor.g ) * rg.y);\n\tvec3 color_spec = PrefilteredColor.rgb*speccontrib;\n\t\n\tvec3 color_diff=diff_sh9(normal);\n\tvec3 outc =  color_diff*mix(basecolor.rgb,vec3(0.),metaless)*(vec3(1.0)-speccontrib)+color_spec;\n\t#ifdef HAS_PBRINFO\n\toutc*=pbrinfo.r;\n\t#endif\n\treturn vec4(outc, basecolor.a);\n}\n\nvec3 oldlight(vec4 normal, float NoV, vec3 R){\n    vec4 basecolor = texture2D(texBaseColor,vUv);\n\tconst vec3 lightdir=normalize(vec3(1.,1.,0.));\n\tconst vec3 spcecol = vec3(1.,0.8,0.8);\n\tconst vec3 amb = vec3(0.5);\n\tvec3 diffv =  (vec3(saturate(dot(lightdir,normal.xyz)))+amb);\n\t//vec3 spec = spcecol* pow(saturate(dot(R,lightdir)),(1.-pbrinfo.g)*5.);\n\treturn diffv*basecolor.rgb;//+spec;\n}\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\nvarying float v_posViewZ;\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main() {\n#ifdef CASTSHADOW\n\tgl_FragColor=packDepth(gl_FragCoord.w);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(texBaseColor,vUv).w;\n\t\tif( alpha < u_AlphaTestValue ){\n\t\t\tdiscard;\n\t\t}\n\t#endif\n#else\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,vWorldPos.xyz,v_posViewZ,0.0001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,vWorldPos.xyz,v_posViewZ,0.0001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.0001);\n\t\t#endif\n\t#endif\t\n\t\n    vec3 normal =  normalize(vWorldNorm);\n\tvec4 normtex = texture2D( texNormal, vUv );\n\t#ifdef HAS_TANGENT\t\n\tnormal = applyNormalTex(normtex.xyz, normal);\n\t#endif\n    vec3 view   = -normalize(vViewDir);\n    float NoV = saturate(dot( view, normal ));\n    vec3 R = 2. * NoV * normal - view;\n\tfloat roughness = normtex.a;\n\t#ifdef FIX_ROUGHNESS\n\troughness = u_roughness;\n\t#endif\n\t\n\tvec4 pbrl = pbrlight(normal,roughness,NoV,R)*u_hdrexposure;\n    gl_FragColor.rgb =  pow(pbrl.rgb,vec3(0.45455));\n\t//gl_FragColor.rgb = oldlight(normtex,NoV,R);\n\t#ifdef RECEIVESHADOW\n\tgl_FragColor.rgb *= max(shadowValue,0.7);\n\t#endif\n\t\n    gl_FragColor.a = pbrl.a;\n\n#endif\n}\n',r=Yi.add(l,e,t,i,n),Rn.SHADERDEFINE_FIX_METALESS=r.registerMaterialDefine("FIX_METALESS"),Rn.SHADERDEFINE_FIX_ROUGHNESS=r.registerMaterialDefine("FIX_ROUGHNESS"),Rn.SHADERDEFINE_HAS_TANGENT=r.registerMaterialDefine("HAS_TANGENT"),Rn.SHADERDEFINE_HAS_PBRINFO=r.registerMaterialDefine("HAS_PBRINFO"),Rn.SHADERDEFINE_USE_GROUNDTRUTH=r.registerMaterialDefine("USE_GROUNDTRUTH"),Rn.SHADERDEFINE_TEST_CLIPZ=r.registerMaterialDefine("CLIPZ"),i={a_Position:0,a_Normal:3,a_Tangent0:5,a_Texcoord0:2,a_BoneWeights:7,a_BoneIndices:6},n={u_Bones:[0,0],u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_AlphaTestValue:[0,1],u_DiffuseColor:[7,1],u_EmissionColor:[8,1],u_DiffuseTexture:[1,1],u_NormalTexture:[3,1],u_ParallaxTexture:[4,1],u_MetallicGlossTexture:[2,1],u_OcclusionTexture:[5,1],u_EmissionTexture:[6,1],u_metallic:[9,1],u_smoothness:[10,1],u_smoothnessScale:[11,1],u_occlusionStrength:[13,1],u_normalScale:[14,1],u_parallaxScale:[15,1],u_TilingOffset:[17,1],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Color":[4,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var h=Tn.nameKey.add("PBRStandard");e="attribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n\t  varying vec4 v_lightMVPPos;\n\t  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0 = a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tmat4 skinTransform = mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\tv_PositionWorld = (u_WorldMat * position).xyz;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t\tworldMat = mat3(u_WorldMat);\n\t\tv_PositionWorld = (u_WorldMat * a_Position).xyz;\n\t#endif\n\t\n\tv_Normal = worldMat * a_Normal;\n\tv_Tangent = worldMat * a_Tangent0.xyz;\n\tv_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n  \n\tv_Texcoord0 = a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t#endif\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0 + v_Texcoord0.y);\n  \n\tv_ViewDir = u_CameraPos - v_PositionWorld;\n  \n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}",t='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\n\nuniform vec4 u_AmbientColor;\nuniform vec4 u_DiffuseColor;\n\n#ifdef DIFFUSETEXTURE\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n#ifdef METALLICGLOSSTEXTURE\n\tuniform sampler2D u_MetallicGlossTexture;\n#endif\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\n#include "PBRStandardLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nuniform DirectionLight u_DirectionLight;\n\nvoid main_castShadow()\n{\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\n\nvoid main_normal()\n{\t\n\tvec3 viewDir = normalize(v_ViewDir);\n\t\n\tvec2 uv0 = ParallaxOffset(viewDir);\n\t\n\tvec2 mg;\n\t#ifdef DIFFUSETEXTURE\n\t\tvec4 diffuseTextureColor = texture2D(u_DiffuseTexture, uv0);\n\t\tvec4 diffuseColor = diffuseTextureColor * u_DiffuseColor;\n\t\tmg = MetallicGloss(diffuseTextureColor.a, uv0);\n\t#else\n\t\tvec4 diffuseColor = u_DiffuseColor;\n\t\tmg = MetallicGloss(1.0, uv0);\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(diffuseColor.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n\t\n\tgl_FragColor = diffuseColor;\n\t\n\tvec3 normal = UnpackScaleNormal(uv0);\n  \n\tvec3 gi = (u_AmbientColor * Occlusion(uv0)).rgb;\n  \n\tvec4 color = PBRStandardDiectionLight(diffuseColor.rgb, mg.r, mg.g, normal, viewDir, u_DirectionLight, gi);\n\t\n\tcolor.a = diffuseColor.a;\n\t\n\t#ifdef EMISSION\n\t\tvec4 emissionColor = u_EmissionColor;\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\temissionColor *=  texture2D(u_EmissionTexture, uv0);\n\t\t#endif\n\t\tcolor.rgb += emissionColor.rgb;\n\t#endif\n\t\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor = vec4(color.rgb * shadowValue, color.a);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n\n',r=Yi.add(h,e,t,i,n),An.SHADERDEFINE_DIFFUSETEXTURE=r.registerMaterialDefine("DIFFUSETEXTURE"),An.SHADERDEFINE_METALLICGLOSSTEXTURE=r.registerMaterialDefine("METALLICGLOSSTEXTURE"),An.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=r.registerMaterialDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),An.SHADERDEFINE_NORMALTEXTURE=r.registerMaterialDefine("NORMALTEXTURE"),An.SHADERDEFINE_PARALLAXTEXTURE=r.registerMaterialDefine("PARALLAXTEXTURE"),An.SHADERDEFINE_OCCLUSIONTEXTURE=r.registerMaterialDefine("OCCLUSIONTEXTURE"),An.SHADERDEFINE_EMISSION=r.registerMaterialDefine("EMISSION"),An.SHADERDEFINE_EMISSIONTEXTURE=r.registerMaterialDefine("EMISSIONTEXTURE"),An.SHADERDEFINE_TILINGOFFSET=r.registerMaterialDefine("TILINGOFFSET"),i={a_Position:0,a_Normal:3,a_Tangent0:5,a_Texcoord0:2,a_BoneWeights:7,a_BoneIndices:6},n={u_Bones:[0,0],u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_AlphaTestValue:[0,1],u_DiffuseColor:[7,1],u_SpecularColor:[8,1],u_EmissionColor:[9,1],u_DiffuseTexture:[1,1],u_NormalTexture:[3,1],u_ParallaxTexture:[4,1],u_SpecularTexture:[2,1],u_OcclusionTexture:[5,1],u_EmissionTexture:[6,1],u_smoothness:[10,1],u_smoothnessScale:[11,1],u_occlusionStrength:[13,1],u_normalScale:[14,1],u_parallaxScale:[15,1],u_TilingOffset:[17,1],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Color":[4,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var c=Tn.nameKey.add("PBRSpecular");e="attribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n\t  varying vec4 v_lightMVPPos;\n\t  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0 = a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tmat4 skinTransform = mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\tv_PositionWorld = (u_WorldMat * position).xyz;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t\tworldMat = mat3(u_WorldMat);\n\t\tv_PositionWorld = (u_WorldMat * a_Position).xyz;\n\t#endif\n\t\n\tv_Normal = worldMat * a_Normal;\n\tv_Tangent = worldMat * a_Tangent0.xyz;\n\tv_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n  \n\tv_Texcoord0 = a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t#endif\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0 + v_Texcoord0.y);\n  \n\tv_ViewDir = u_CameraPos - v_PositionWorld;\n  \n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}",t='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\n\nuniform vec4 u_AmbientColor;\nuniform vec4 u_DiffuseColor;\nuniform vec4 u_SpecularColor;\n\n#ifdef DIFFUSETEXTURE\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n#ifdef SPECULARTEXTURE\n\tuniform sampler2D u_SpecularTexture;\n#endif\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\n#include "PBRSpecularLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nuniform DirectionLight u_DirectionLight;\n\nvoid main_castShadow()\n{\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\n\nvoid main_normal()\n{\t\n\tvec3 viewDir = normalize(v_ViewDir);\n\t\n\tvec2 uv0 = ParallaxOffset(viewDir);\n\t\n\tvec4 sg;\n\t#ifdef DIFFUSETEXTURE\n\t\tvec4 diffuseTextureColor = texture2D(u_DiffuseTexture, uv0);\n\t\tvec4 diffuseColor = diffuseTextureColor * u_DiffuseColor;\n\t\tsg = SpecularGloss(diffuseTextureColor.a, uv0);\n\t#else\n\t\tvec4 diffuseColor = u_DiffuseColor;\n\t\tsg = SpecularGloss(1.0, uv0);\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(diffuseColor.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\tvec3 normal = UnpackScaleNormal(uv0);\n\t\n\tvec3 gi = (u_AmbientColor * Occlusion(uv0)).rgb;\n\t\n\t//float a = (sg.r+sg.g+sg.b) / 3.0;\n  \n\tvec4 color = PBRSpecularDiectionLight(diffuseColor.rgb, sg.rgb, sg.a, normal,viewDir, u_DirectionLight, gi);\n\t\n\tcolor.a = diffuseColor.a;\n\t\n\t#ifdef EMISSION\n\t\tvec4 emissionColor = u_EmissionColor;\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\temissionColor *=  texture2D(u_EmissionTexture, uv0);\n\t\t#endif\n\t\tcolor.rgb += emissionColor.rgb;\n\t#endif\n\t\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor = vec4(color.rgb * shadowValue, color.a);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n\n',r=Yi.add(c,e,t,i,n),Ln.SHADERDEFINE_DIFFUSETEXTURE=r.registerMaterialDefine("DIFFUSETEXTURE"),Ln.SHADERDEFINE_SPECULARTEXTURE=r.registerMaterialDefine("SPECULARTEXTURE"),Ln.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=r.registerMaterialDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),Ln.SHADERDEFINE_NORMALTEXTURE=r.registerMaterialDefine("NORMALTEXTURE"),Ln.SHADERDEFINE_PARALLAXTEXTURE=r.registerMaterialDefine("PARALLAXTEXTURE"),Ln.SHADERDEFINE_OCCLUSIONTEXTURE=r.registerMaterialDefine("OCCLUSIONTEXTURE"),Ln.SHADERDEFINE_EMISSION=r.registerMaterialDefine("EMISSION"),Ln.SHADERDEFINE_EMISSIONTEXTURE=r.registerMaterialDefine("EMISSIONTEXTURE"),Ln.SHADERDEFINE_TILINGOFFSET=r.registerMaterialDefine("TILINGOFFSET"),i={a_position:0,a_normal:3,uv:2},n={irrad_mat_red:[10,3],irrad_mat_green:[11,3],irrad_mat_blue:[12,3],u_hdrexposure:[13,3],texBaseColor:[1,1],texNormal:[2,1],texSky:[11,1],texUnderWater:[3,1],texPrefilterdEnv:[8,3],texPrefilterDiff:[7,3],texWaterDisp:[4,1],texWaveDetail:[9,1],texDeepColor:[10,1],texWaterInfo:[16,1],texFoam:[17,1],GEOWAVE_UV_SCALE:[18,1],modelMatrix:[0,2],mvp:[1,2],cameraPosition:[0,3],u_curTm:[8,1],u_scrsize:[15,1],u_WaveInfoD:[13,1],u_WaveInfo:[12,1],u_WaveMainDir:[14,1],u_DeepScale:[20,1],u_SeaColor:[19,1],u_View:[1,3],u_Project:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4]};var u=Tn.nameKey.add("Water");e='\nuniform mat4 modelMatrix;\n//uniform mat4 modelViewMatrix;\n//uniform mat4 projectionMatrix;\nuniform mat4 u_View;\nuniform mat4 u_Project;\nuniform mat4 mvp;\n//uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\nuniform float u_curTm;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 uv;\n//uniform sampler2D texWaterDisp;\n#ifdef USE_VERTEX_DEEPINFO\n#else\nuniform sampler2D texWaterInfo;\nvarying vec4 vWaterInfo;\nuniform float u_DeepScale;//texWaterInfo.r*vDeepScale\n#endif\nuniform float u_WaveMainDir;\t//主波方向\nuniform float GEOWAVE_UV_SCALE ;//= 100.0;\n\n\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec3 vWorldTan;\nvarying vec3 vWorldBin;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying vec3 vLightDir;\nvarying vec3 vViewDir;\nvarying vec3 vDisp;\nvarying float fDeep;\nvarying mat2 matUVTrans;\nvarying float fFoam;\n\nconst float PI = 3.14159265358979323846264;\n\n#include "WaveFunction.glsl"\n\nvec2 getPosFromUV(vec2 uv){\n\treturn uv*50.;\n}\n\nvoid main() {\n\tvec3 pos = a_position;\n    vUv = uv;\n\t\n\t//vDisp = texture2D(texWaterDisp,uv).rgb;\n\t//vec3 disp = vDisp;\n\t\n\t//TODO 这里有个潜规则。\n\tfloat tt = pos.y; pos.y=pos.z; pos.z=-tt;\n\t\n\t#ifdef USE_VERTEX_DEEPINFO\n\tfDeep = -pos.y;\n\tpos.y=0.0;\n\t#else\n\tvWaterInfo = texture2D(texWaterInfo,uv);\n\tfDeep = vWaterInfo.r*u_DeepScale;\n\t#endif\n\t\n\t\n\t//计算波形\n\tmat4 modelMat = modelMatrix;\n\tvec3 opos, T,B,N;\n\tfloat foams=0.;\n\tvec2 uvpos = uv*GEOWAVE_UV_SCALE+vec2(modelMat[3][0],0.);//TODO 如果有旋转缩放怎么办\n\tcalcGerstnerWave(u_curTm, pos,fDeep, uvpos,opos,B,T,N,foams);\n\tfFoam = foams;\n\tgl_Position = mvp*vec4(opos,1.);\n\tvWorldPos = modelMat*vec4(opos,1.);\n\n\tvWorldNorm = normalize((modelMatrix*vec4(N,0.0)).xyz);\n\tvWorldTan = normalize((modelMatrix*vec4(T,0.0)).xyz);\n\tvWorldBin = normalize((modelMatrix*vec4(B,0.0)).xyz);\n    vViewDir = vWorldPos.xyz-cameraPosition; //这个不能取normalize，否则会引入非线性\n\t\n\tfloat s = sin(u_WaveMainDir);\n\tfloat c = cos(u_WaveMainDir);\n\tmatUVTrans = mat2(c,-s,s,c);\n}\n',t="//#version 300 es\n\nprecision highp float;\nprecision lowp int;\n\nconst float PI = 3.14159265358979323846264;\nconst float _2PI = 6.2831853071796;\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec3 vWorldTan;\nvarying vec3 vWorldBin;\nvarying vec3 vViewDir;//入射。pos-cam\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying float fDeep;\nvarying mat2 matUVTrans;\n#ifdef USE_VERTEX_DEEPINFO\n#else\nvarying vec4 vWaterInfo;\n#endif\nmat3 matTBNOff;//\n\n//\nuniform sampler2D texBaseColor;\nuniform sampler2D texNormal;\n#ifdef CUBE_ENV\nuniform samplerCube texSky;\n#else\nuniform sampler2D texSky;\n#endif\nuniform sampler2D texUnderWater;\nuniform sampler2D texWaveDetail;\n//uniform sampler2D texDeepColor;\nuniform sampler2D texFoam;\nvarying float fFoam;\nuniform float u_curTm;\nuniform vec2 u_scrsize;\nuniform vec3 u_SeaColor;//\n\nconst int NumTexWaves=4;\nconst float Amp_over_L = 0.01;\n//const vec3 SEA_COLOR1 = vec3(0.0292,0.672,0.7467);//大洋\n//const vec3 SEA_COLOR2 = vec3(0,0.927,0.43);//近海\n\nconst float _maxu8 = 255.0;\nconst float _maxu16 = 65535.0;\nconst float _shift8 = 256.0;    //平移的话是*256而不是255\nvec2 _RGBAToU16(const in vec4 rgba){\n    return vec2((rgba.r*_maxu8+rgba.g*_maxu8*_shift8)/_maxu16, (rgba.b*_maxu8+rgba.a*_maxu8*_shift8)/_maxu16);\n}\nvec3 _RGBEToRGB( const in vec4 rgba ){\n    float f = pow(2.0, rgba.w * 255.0 - (128.0 + 8.0));\n    return rgba.rgb * (255.0 * f);\n}\n\nfloat saturate(float v){\n    return min(max(v,0.),1.);\n}\n\n/*\n\t各种 ToneMap\n*/\n//Reinhard\nvec3 ReinhardToneMapping(vec3 color, float adapted_lum) {\n    const float MIDDLE_GREY = 1.;\n    color *= MIDDLE_GREY / adapted_lum;\n    return color / (1.0 + color);\n}\n\n//CE2\nvec3 CEToneMapping(vec3 color, float adapted_lum){\n    return 1. - exp(-adapted_lum * color);\n}\n\n//UC2\nvec3 F1(vec3 x){\n\tconst float A = 0.22;\n\tconst float B = 0.30;\n\tconst float C = 0.10;\n\tconst float D = 0.20;\n\tconst float E = 0.01;\n\tconst float F = 0.30;\n \n\treturn ((x * (A * x + C * B) + D * E) / (x * (A * x + B) + D * F)) - E / F;\n}\n\nvec3 Uncharted2ToneMapping(vec3 color, float adapted_lum){\n\tconst vec3 WHITE = vec3(11.2);\n\treturn F1(1.6 * adapted_lum * color) / F1(WHITE);\n}\n\n//ACES\nvec3 ACESToneMapping(vec3 color, float adapted_lum){\n\tconst float A = 2.51;\n\tconst float B = 0.03;\n\tconst float C = 2.43;\n\tconst float D = 0.59;\n\tconst float E = 0.14;\n\n\tcolor *= adapted_lum;\n\treturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\n\n/*\n* 对一个全景图进行采样。假设x轴指向中心。\n*/\nvec4 texPanorama(sampler2D tex, const in vec3 dir){\n\tfloat envu = atan(dir.z,dir.x)/_2PI+0.5; \t\n\tfloat envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n\treturn texture2D(tex,vec2(envu,envv));\n}\n\n/*\n\t与位于0点的测试棒的相交测试交点\n\t这个是瞎写的，只是为了测试\n*/\nbool hitClydiner(vec3 pos, vec3 dir, out vec3 hitpos, out vec3 hitnormal){\n\tconst float r = 0.5;\n\tfloat a = dir.x*dir.x+dir.z*dir.z;\n\tfloat b = 2.*dir.x*pos.x+2.*dir.z*pos.z;\n\tfloat c = pos.x*pos.x+pos.z*pos.z-r*r;\n\tfloat d = b*b-4.*a*c;\n\tif(d>=0.0){\n\t\tfloat t = (-b+sqrt(d))/2./a;\n\t\tt =min(t, (-b-sqrt(d))/2./a);\n\t\thitpos = pos+dir*t;\n\t\treturn true;\n\t}\n\t/*\n\tvec3 v1 = normalize(cross(dir,vec3(0.,1.,0.)));//公垂线\n\tfloat dist = dot(pos,v1);//最短距离\n\tif(abs(dist)<r){\n\t\treturn true;\n\t}\n\t*/\n\treturn false;\n}\n\n///* 根据散射公式来计算某个方向的颜色 *///\n//\nfloat phase_function(float costheta, float g, float g2){\n\treturn 1.5*( (1.0-g2) / (2.0+g2) ) * (1.0+costheta*costheta) / pow(1.0+g2-2.0*g*costheta, 1.5);\t\n}\n\nconst float _density = .2;\nconst vec3 _vLightDir=vec3(0.,-1.,0.);//必须是规格化的\nconst int _SAMPLENUM = 20;\nconst float _K1 = 1.0;\nconst float _g = -0.93;\n//\nvec3 calcScatter(vec3 start, vec3 dir, vec3 end){\n\tfloat len = length(end-start);\n\tfloat costheta = dot(dir,_vLightDir);\n\tfloat g2 = _g*_g;\n\tfloat K = _K1*len*_density*phase_function(costheta,_g,g2);\n\t//用分段的方式来积分\n\tfloat dlen = len/float(_SAMPLENUM);//距离平分\n\tfloat ddeep = (start.y-end.y)/float(_SAMPLENUM);//深度平分\n\tfloat sum=0.;\n\tfor( int i=0; i<_SAMPLENUM; i++){\n\t\tfloat fi = float(i);\n\t\tfloat v1 = exp(-_density*(dlen+ddeep)*fi);//TODO 应该可以用分析法计算出来\n\t\tsum += v1;\n\t}\n\treturn vec3(K*sum);\n}\n///* 根据散射公式来计算某个方向的亮度  END *///\n\nconst float cDeep = -2.;\t//假设水的深度\nvec3 getShuiDiColor(vec3 pos, vec3 dir, vec3 normal){\n\t//一个无限大的水底，黑白格纹理。纹理长度为1米\n\tfloat t = ( cDeep-pos.y )/dir.y;\n\tif(t<0.) return vec3(1.,0.,0.);//TEST\n\tbool bhit = false;\n\tvec3 hitpos;\n\tvec3 hitcolor;\n\tvec3 hn;\n\tif(hitClydiner(pos,dir,hitpos,hn) && hitpos.y>cDeep && hitpos.y<pos.y){\n\t\tbhit=true;\n\t\thitcolor = vec3(.8,.8,.8);\n\n\t}else\n\t{\n\t\thitpos = pos+dir*t;\n\t\tvec3 hp = floor(hitpos);\n\t\tfloat a = mod((hp.x+hp.z),2.);\n\t\thitcolor = (a<.9)?vec3(0.,0.,0.):vec3(1.,1.,1.);\n\t\t//hitcolor = texture2D(texUnderWater,hitpos.xz/10.).rgb;\n\t}\n\t\n\tfloat l = length(hitpos-pos);\n\t//return texture2D(texDeepColor,vec2(min(max(l/400.,0.),1.),0.5)).rgb;\n\t//return SEA_COLOR1*calcScatter(pos,dir,hitpos);\n\tfloat left = pow(0.8,l);//假设透过率为80%，则到达水底的时候的光强。\n\treturn mix(hitcolor,u_SeaColor,1.-left);\n}\n\n/*\n\tview已经normalize了\n*/\nvec3 getRefractColor(vec3 view,vec3 normal){\n\tvec3 T = refract(-view, normal, 0.7);\n\treturn getShuiDiColor(vWorldPos.xyz,T,normal); \n}\n\nvec4 calcWaterC(vec3 view, vec3 normal, float von, vec3 R, float rough){\n\t/*\n\t只有浪顶的法线向下，也就是波形形成了交叠的时候，才会这样，所以要通过参数控制避免出现这种情况，而不是在这里保护。\n\tif(dot(R,vec3(0.,1.,0.))<0.){\n\t\tR = -R;\n\t}\n\t*/\n\t//vec3 refr = getRefractColor(-view,normal);\n#ifdef USE_REFR_TEX\t\n\tvec3 refr = texture2D(texUnderWater, gl_FragCoord.xy/u_scrsize+normal.xz/8.).rgb;\n#else\n\tvec3 refr = u_SeaColor;\n#endif\n\tfloat F0=0.02;\n\t//菲涅尔，越大反射越强\n\tfloat f =  F0+(1.0-F0)*exp2((-5.55473*von-6.98316)*von);\n\t//float f = F0+(1.0-F0)*pow(1.-von,5.);\n\t//能看到水底的程度。反射剩余的*水中的衰减\n\t//float a = (1.-f)*(1.-deepk);\n#ifdef CUBE_ENV\n\tvec4 reflc = textureCube(texSky,R);\n#else\n\tvec4 reflc = texPanorama(texSky, R);\n#endif\n#ifdef HDR_ENV\n\tvec3 refl = _RGBEToRGB(reflc)*f;\n#else\n\tvec3 refl = reflc.rgb*f;\n#endif\n\t//return vec4(refl*(1.-rough),1.);\n\t\n\t//vec3 refl = reflc.rgb*f;\n\tvec3 final = mix(refr, u_SeaColor, min(fDeep/10.,1.))+refl*(max(0.,1.-rough));\n#ifdef HDR_ENV\n\tfinal = ACESToneMapping(final,1.);//TODO 这个要uniform传入\n#endif\n\treturn vec4(final,f);\n}\n\nvoid main() {\n    vec3 normal =  normalize(vWorldNorm);\n\t//如果uv=1为100米，希望每个细节纹理表示20米的小波形，则uv缩放是 100/20。细节纹理内部也要用这个值，即pos=uv*20\n\tvec2 ruv = matUVTrans*vUv;\n\tvec3 detailNorm = texture2D(texWaveDetail,fract(ruv*5.)).rgb*2.-vec3(1.);//TODO uv怎么算\n\tfloat texNormScale = 2.*PI*float(NumTexWaves)*Amp_over_L*2.5;\n\tdetailNorm *= vec3(texNormScale,1.,texNormScale);\n\t//旋转\n\t//细节纹理来自rendertarget，因此需要颠倒z\n\t\n\tmatTBNOff = mat3(matUVTrans[0][0],0.,matUVTrans[1][0],\n\t0.,1.,0.,\n\tmatUVTrans[0][1],0.,matUVTrans[1][1]\n\t);\n\t\n\t/*\n\tmatTBNOff = mat3(0.,0.,1.,\n\t0.,1.,0.,\n\t-1.,0.,0.\n\t);\n\t*/\n\n    mat3 tsn = mat3( vWorldBin, normal, vWorldTan);\t\n    //normal = normalize(tsn * matTBNOff * detailNorm);\n\tnormal = normalize(tsn * detailNorm); //这个应该更正确。因为本身方向就是根据uv算的，如果是静态图片才需要转换。\n\t//vec4 normtex = texture2D( texNormal, vUv );\n    vec3 view   = -normalize(vViewDir);//view 是指向camera的\n    float NoV = saturate(dot( view, normal ));\n    //vec3 R = 2. * NoV * normal - view;\n\t\n#ifdef USE_FOAM\t\n\tvec4 foamc = (texture2D(texFoam,vUv*50.)+texture2D(texFoam,vUv*20.))/2.;\n\tfloat nearcoast = 1.-min(fDeep/10.,1.);// 1.-vWaterInfo.r;\n\tfloat foams = (nearcoast/4.+fFoam)*2.*nearcoast;\n#else\n\tfloat foams =0.;\n#endif\n\t\n\tvec3 R = reflect(-view,normal);\n\tvec4 wc = calcWaterC(view, normal,NoV,R, foams);\n\n\tgl_FragColor.rgb = wc.rgb;//normalize(detailNorm).rrr;//((normal)+vec3(0.0))/1.;//normalize(normal).rgb;//texture2D(texWaveDetail,vUv).rgb;// fracColor * texture2D(texUnderWater, vUv*20.0).rgb;// vec3(1.0);//pbrl.rgb;\n    gl_FragColor.a = 1.0;//wc.a;\n#ifdef USE_FOAM\n\tgl_FragColor.rgb = mix(gl_FragColor.rgb,vec3(1.),foamc.a*foams);\n\tgl_FragColor.a = foamc.r;\n#endif\n\t//if(mod(vUv.x*100.,1.0)<0.02 || mod(vUv.y*100.,1.0)<0.02) gl_FragColor.rgb=vec3(0.5,.5,.5);\n\t//gl_FragColor.rgb = detailNorm;\n}\n",r=Yi.add(u,e,t,i,n),Pn.SHADERDEFINE_CUBE_ENV=r.registerMaterialDefine("CUBE_ENV"),Pn.SHADERDEFINE_HDR_ENV=r.registerMaterialDefine("HDR_ENV"),Pn.SHADERDEFINE_SHOW_NORMAL=r.registerMaterialDefine("SHOW_NORMAL"),Pn.SHADERDEFINE_USEVERTEXHEIGHT=r.registerMaterialDefine("USE_VERTEX_DEEPINFO"),Pn.SHADERDEFINE_USE_FOAM=r.registerMaterialDefine("USE_FOAM"),Pn.SHADERDEFINE_USE_REFRACT_TEX=r.registerMaterialDefine("USE_REFR_TEX"),i={a_CornerTextureCoordinate:17,a_MeshPosition:0,a_MeshColor:1,a_MeshTextureCoordinate:2,a_ShapePositionStartLifeTime:30,a_DirectionTime:32,a_StartColor:19,a_EndColor:23,a_StartSize:20,a_StartRotation0:22,a_StartSpeed:31,a_Random0:34,a_Random1:35,a_SimulationWorldPostion:36,a_SimulationWorldRotation:37},n={u_Tintcolor:[2,1],u_TilingOffset:[3,1],u_texture:[1,1],u_WorldPosition:[0,2],u_WorldRotation:[1,2],u_PositionScale:[4,2],u_SizeScale:[5,2],u_ScalingMode:[6,2],u_Gravity:[7,2],u_ThreeDStartRotation:[8,2],u_StretchedBillboardLengthScale:[9,2],u_StretchedBillboardSpeedScale:[10,2],u_SimulationSpace:[11,2],u_CurrentTime:[12,2],u_ColorOverLifeGradientAlphas:[22,2],u_ColorOverLifeGradientColors:[23,2],u_MaxColorOverLifeGradientAlphas:[24,2],u_MaxColorOverLifeGradientColors:[25,2],u_VOLVelocityConst:[13,2],u_VOLVelocityGradientX:[14,2],u_VOLVelocityGradientY:[15,2],u_VOLVelocityGradientZ:[16,2],u_VOLVelocityConstMax:[17,2],u_VOLVelocityGradientMaxX:[18,2],u_VOLVelocityGradientMaxY:[19,2],u_VOLVelocityGradientMaxZ:[20,2],u_VOLSpaceType:[21,2],u_SOLSizeGradient:[26,2],u_SOLSizeGradientX:[27,2],u_SOLSizeGradientY:[28,2],u_SOLSizeGradientZ:[29,2],u_SOLSizeGradientMax:[30,2],u_SOLSizeGradientMaxX:[31,2],u_SOLSizeGradientMaxY:[32,2],u_SOLSizeGradientMaxZ:[33,2],u_ROLAngularVelocityConst:[34,2],u_ROLAngularVelocityConstSeprarate:[35,2],u_ROLAngularVelocityGradient:[36,2],u_ROLAngularVelocityGradientX:[37,2],u_ROLAngularVelocityGradientY:[38,2],u_ROLAngularVelocityGradientZ:[39,2],u_ROLAngularVelocityGradientW:[40,2],u_ROLAngularVelocityConstMax:[41,2],u_ROLAngularVelocityConstMaxSeprarate:[42,2],u_ROLAngularVelocityGradientMax:[43,2],u_ROLAngularVelocityGradientMaxX:[44,2],u_ROLAngularVelocityGradientMaxY:[45,2],u_ROLAngularVelocityGradientMaxZ:[46,2],u_ROLAngularVelocityGradientMaxW:[47,2],u_TSACycles:[48,2],u_TSASubUVLength:[49,2],u_TSAGradientUVs:[50,2],u_TSAMaxGradientUVs:[51,2],u_CameraPosition:[0,3],u_CameraDirection:[5,3],u_CameraUp:[6,3],u_View:[1,3],u_Projection:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4]};var d=Tn.nameKey.add("PARTICLESHURIKEN");e="#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\tattribute vec4 a_CornerTextureCoordinate;\n#endif\n#ifdef RENDERMODE_MESH\n\tattribute vec3 a_MeshPosition;\n\tattribute vec4 a_MeshColor;\n\tattribute vec2 a_MeshTextureCoordinate;\n\tvarying vec4 v_MeshColor;\n#endif\n\nattribute vec4 a_ShapePositionStartLifeTime;\nattribute vec4 a_DirectionTime;\nattribute vec4 a_StartColor;\nattribute vec3 a_StartSize;\nattribute vec3 a_StartRotation0;\nattribute float a_StartSpeed;\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n  attribute vec4 a_Random0;\n#endif\n#if defined(TEXTURESHEETANIMATIONRANDOMCURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  attribute vec4 a_Random1;\n#endif\nattribute vec3 a_SimulationWorldPostion;\nattribute vec4 a_SimulationWorldRotation;\n\nvarying float v_Discard;\nvarying vec4 v_Color;\n#ifdef DIFFUSEMAP\n\tvarying vec2 v_TextureCoordinate;\n#endif\n\nuniform float u_CurrentTime;\nuniform vec3 u_Gravity;\n\nuniform vec3 u_WorldPosition;\nuniform vec4 u_WorldRotation;\nuniform bool u_ThreeDStartRotation;\nuniform int u_ScalingMode;\nuniform vec3 u_PositionScale;\nuniform vec3 u_SizeScale;\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\n#ifdef STRETCHEDBILLBOARD\n\tuniform vec3 u_CameraPosition;\n#endif\nuniform vec3 u_CameraDirection;//TODO:只有几种广告牌模式需要用\nuniform vec3 u_CameraUp;\n\nuniform  float u_StretchedBillboardLengthScale;\nuniform  float u_StretchedBillboardSpeedScale;\nuniform int u_SimulationSpace;\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  int  u_VOLSpaceType;\n#endif\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\n  uniform  vec3 u_VOLVelocityConst;\n#endif\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  vec2 u_VOLVelocityGradientX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientZ[4];//x为key,y为速度\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n  uniform  vec3 u_VOLVelocityConstMax;\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n  uniform  vec2 u_VOLVelocityGradientMaxX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxZ[4];//x为key,y为速度\n#endif\n\n#ifdef COLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n#ifdef RANDOMCOLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n  uniform  vec4 u_MaxColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_MaxColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n\n\n#if defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMERANDOMCURVES)\n  uniform  vec2 u_SOLSizeGradient[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\n  uniform  vec2 u_SOLSizeGradientMax[4];//x为key,y为尺寸\n#endif\n#if defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\n  uniform  vec2 u_SOLSizeGradientX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientZ[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n  uniform  vec2 u_SOLSizeGradientMaxX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxZ[4];//x为key,y为尺寸\n#endif\n\n\n#ifdef ROTATIONOVERLIFETIME\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  float u_ROLAngularVelocityConst;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  float u_ROLAngularVelocityConstMax;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradient[4];//x为key,y为旋转\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMax[4];//x为key,y为旋转\n  #endif\n#endif\n#ifdef ROTATIONOVERLIFETIMESEPERATE\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  vec3 u_ROLAngularVelocityConstSeprarate;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  vec3 u_ROLAngularVelocityConstMaxSeprarate;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradientX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientW[4];\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMaxX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientMaxW[4];\n  #endif\n#endif\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\n  uniform  float u_TSACycles;\n  uniform  vec2 u_TSASubUVLength;\n  uniform  vec2 u_TSAGradientUVs[4];//x为key,y为frame\n#endif\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n  uniform  vec2 u_TSAMaxGradientUVs[4];//x为key,y为frame\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvec3 rotationByEuler(in vec3 vector,in vec3 rot)\n{\n\tfloat halfRoll = rot.z * 0.5;\n    float halfPitch = rot.x * 0.5;\n\tfloat halfYaw = rot.y * 0.5;\n\n\tfloat sinRoll = sin(halfRoll);\n\tfloat cosRoll = cos(halfRoll);\n\tfloat sinPitch = sin(halfPitch);\n\tfloat cosPitch = cos(halfPitch);\n\tfloat sinYaw = sin(halfYaw);\n\tfloat cosYaw = cos(halfYaw);\n\n\tfloat quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\n\tfloat quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\n\tfloat quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\n\tfloat quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\n//假定axis已经归一化\nvec3 rotationByAxis(in vec3 vector,in vec3 axis, in float angle)\n{\n\tfloat halfAngle = angle * 0.5;\n\tfloat sin = sin(halfAngle);\n\t\n\tfloat quaX = axis.x * sin;\n\tfloat quaY = axis.y * sin;\n\tfloat quaZ = axis.z * sin;\n\tfloat quaW = cos(halfAngle);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\nvec3 rotationByQuaternions(in vec3 v,in vec4 q) \n{\n\treturn v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\n \n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\nfloat getCurValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat curValue;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\tcurValue=mix(lastGradientNumber.y,gradientNumber.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn curValue;\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat totalValue=0.0;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\tfloat lastValue=lastGradientNumber.y;\n\t\t\n\t\tif(key>=normalizedAge){\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\ttotalValue+=(lastValue+mix(lastValue,gradientNumber.y,age))/2.0*a_ShapePositionStartLifeTime.w*(normalizedAge-lastKey);\n\t\t\tbreak;\n\t\t}\n\t\telse{\n\t\t\ttotalValue+=(lastValue+gradientNumber.y)/2.0*a_ShapePositionStartLifeTime.w*(key-lastGradientNumber.x);\n\t\t}\n\t}\n\treturn totalValue;\n}\n#endif\n\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)\nvec4 getColorFromGradient(in vec2 gradientAlphas[4],in vec4 gradientColors[4],in float normalizedAge)\n{\n\tvec4 overTimeColor;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientAlpha=gradientAlphas[i];\n\t\tfloat alphaKey=gradientAlpha.x;\n\t\tif(alphaKey>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientAlpha=gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey=lastGradientAlpha.x;\n\t\t\tfloat age=(normalizedAge-lastAlphaKey)/(alphaKey-lastAlphaKey);\n\t\t\toverTimeColor.a=mix(lastGradientAlpha.y,gradientAlpha.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec4 gradientColor=gradientColors[i];\n\t\tfloat colorKey=gradientColor.x;\n\t\tif(colorKey>=normalizedAge)\n\t\t{\n\t\t\tvec4 lastGradientColor=gradientColors[i-1];\n\t\t\tfloat lastColorKey=lastGradientColor.x;\n\t\t\tfloat age=(normalizedAge-lastColorKey)/(colorKey-lastColorKey);\n\t\t\toverTimeColor.rgb=mix(gradientColors[i-1].yzw,gradientColor.yzw,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn overTimeColor;\n}\n#endif\n\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\nfloat getFrameFromGradient(in vec2 gradientFrames[4],in float normalizedAge)\n{\n\tfloat overTimeFrame;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientFrame=gradientFrames[i];\n\t\tfloat key=gradientFrame.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientFrame=gradientFrames[i-1];\n\t\t\tfloat lastKey=lastGradientFrame.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\toverTimeFrame=mix(lastGradientFrame.y,gradientFrame.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn floor(overTimeFrame);\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\nvec3 computeParticleLifeVelocity(in float normalizedAge)\n{\n  vec3 outLifeVelocity;\n  #ifdef VELOCITYOVERLIFETIMECONSTANT\n\t outLifeVelocity=u_VOLVelocityConst; \n  #endif\n  #ifdef VELOCITYOVERLIFETIMECURVE\n     outLifeVelocity= vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t outLifeVelocity=mix(u_VOLVelocityConst,u_VOLVelocityConstMax,vec3(a_Random1.y,a_Random1.z,a_Random1.w)); \n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n     outLifeVelocity=vec3(mix(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y),\n\t                 mix(getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z),\n\t\t\t\t\t mix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n  #endif\n\t\t\t\t\t\n  return outLifeVelocity;\n} \n#endif\n\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation)\n{\n   vec3 startPosition;\n   vec3 lifePosition;\n   #if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t#ifdef VELOCITYOVERLIFETIMECONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMECURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n\t#endif\n\t\n\tvec3 finalPosition;\n\tif(u_VOLSpaceType==0){\n\t  if(u_ScalingMode!=2)\n\t   finalPosition =rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition),worldRotation);\n\t  else\n\t   finalPosition =rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);\n\t}\n\telse{\n\t  if(u_ScalingMode!=2)\n\t    finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation)+lifePosition;\n\t  else\n\t    finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;\n\t}\n  #else\n\t startPosition=startVelocity*age;\n\t vec3 finalPosition;\n\t if(u_ScalingMode!=2)\n\t   finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation);\n\t else\n\t   finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);\n  #endif\n  \n  if(u_SimulationSpace==0)\n    finalPosition=finalPosition+a_SimulationWorldPostion;\n  else if(u_SimulationSpace==1) \n    finalPosition=finalPosition+u_WorldPosition;\n  \n  finalPosition+=0.5*gravityVelocity*age;\n \n  return  finalPosition;\n}\n\n\nvec4 computeParticleColor(in vec4 color,in float normalizedAge)\n{\n\t#ifdef COLOROVERLIFETIME\n\t  color*=getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge);\n\t#endif\n\t\n\t#ifdef RANDOMCOLOROVERLIFETIME\n\t  color*=mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge),getColorFromGradient(u_MaxColorOverLifeGradientAlphas,u_MaxColorOverLifeGradientColors,normalizedAge),a_Random0.y);\n\t#endif\n\n    return color;\n}\n\nvec2 computeParticleSizeBillbard(in vec2 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n\n#ifdef RENDERMODE_MESH\nvec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z)\n\t\t,mix(getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n#endif\n\nfloat computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConstSeprarate.z*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConstSeprarate.z,u_ROLAngularVelocityConstMaxSeprarate.z,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n\n\n#if defined(RENDERMODE_MESH)&&(defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE))\nvec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tvec3 ageRot=u_ROLAngularVelocityConstSeprarate*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tvec3 ageRot=mix(u_ROLAngularVelocityConstSeprarate,u_ROLAngularVelocityConstMaxSeprarate,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n#endif\n\nvec2 computeParticleUV(in vec2 uv,in float normalizedAge)\n{ \n\t#ifdef TEXTURESHEETANIMATIONCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat frame=getFrameFromGradient(u_TSAGradientUVs,cycleNormalizedAge-floor(cycleNormalizedAge));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\t#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat uvNormalizedAge=cycleNormalizedAge-floor(cycleNormalizedAge);\n\t    float frame=floor(mix(getFrameFromGradient(u_TSAGradientUVs,uvNormalizedAge),getFrameFromGradient(u_TSAMaxGradientUVs,uvNormalizedAge),a_Random1.x));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\treturn uv;\n}\n\nvoid main()\n{\n\tfloat age = u_CurrentTime - a_DirectionTime.w;\n\tfloat normalizedAge = age/a_ShapePositionStartLifeTime.w;\n\tvec3 lifeVelocity;\n\tif(normalizedAge<1.0){ \n\tvec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t\tlifeVelocity= computeParticleLifeVelocity(normalizedAge);//计算粒子生命周期速度\n\t#endif \n\tvec3 gravityVelocity=u_Gravity*age;\n\t\n\tvec4 worldRotation;\n\tif(u_SimulationSpace==0)\n\t\tworldRotation=a_SimulationWorldRotation;\n\telse\n\t\tworldRotation=u_WorldRotation;\n\t\n\tvec3 center=computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge,gravityVelocity,worldRotation);//计算粒子位置\n   \n   \n   #ifdef SPHERHBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        vec3 cameraUpVector =normalize(u_CameraUp);//TODO:是否外面归一化\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n        vec3 upVector = normalize(cross(sideVector,u_CameraDirection));\n\t    corner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\tfloat c = cos(rot);\n\t\t\t\tfloat s = sin(rot);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat c = cos(a_StartRotation0.x);\n\t\t\t\tfloat s = sin(a_StartRotation0.x);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#endif\n   #endif\n   \n   #ifdef STRETCHEDBILLBOARD\n\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\tvec3 velocity;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t    if(u_VOLSpaceType==0)\n\t\t  velocity=rotationByQuaternions(u_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;\n\t    else\n\t\t  velocity=rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;\n    #else\n\t    velocity= rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+gravityVelocity;\n    #endif\t\n\t\tvec3 cameraUpVector = normalize(velocity);\n\t\tvec3 direction = normalize(center-u_CameraPosition);\n        vec3 sideVector = normalize(cross(direction,normalize(velocity)));\n\t\t\n\t\tsideVector=u_SizeScale.xzy*sideVector;\n\t\tcameraUpVector=length(vec3(u_SizeScale.x,0.0,0.0))*cameraUpVector;\n\t\t\n\t    vec2 size=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\n\t    const mat2 rotaionZHalfPI=mat2(0.0, -1.0, 1.0, 0.0);\n\t    corner=rotaionZHalfPI*corner;\n\t    corner.y=corner.y-abs(corner.y);\n\t\t\n\t    float speed=length(velocity);//TODO:\n\t    center +=sign(u_SizeScale.x)*(sign(u_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*u_StretchedBillboardSpeedScale+size.y*u_StretchedBillboardLengthScale)*corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef HORIZONTALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector=vec3(0.0,0.0,1.0);\n\t    const vec3 sideVector = vec3(-1.0,0.0,0.0);\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef VERTICALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector =vec3(0.0,1.0,0.0);\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef RENDERMODE_MESH\n\t    vec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,-computeParticleRotationFloat(a_StartRotation0.z, age,normalizedAge));\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\t#ifdef ROTATIONOVERLIFETIME\n\t\t\t\t\tfloat angle=computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));//已验证\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\t\tcenter+= u_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\tcenter+=rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);//已验证\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\tcenter+=rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);//已验证\n\t\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t\t\t\t//TODO:是否应合并if(u_ThreeDStartRotation)分支代码,待测试\n\t\t\t\t\tvec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,a_StartRotation0.z), age,normalizedAge);\n\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByEuler(u_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));//已验证\n\t\t\t\t#endif\t\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);//已验证\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);\n\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));//已验证\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);\t\n\t\t\t\t\t#else\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);//已验证\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t}\n\t\t#endif\n\t\tv_MeshColor=a_MeshColor;\n   #endif\n   \n    gl_Position=u_Projection*u_View*vec4(center,1.0);\n    v_Color = computeParticleColor(a_StartColor, normalizedAge);\n\t#ifdef DIFFUSEMAP\n\t\t#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\t\t\tv_TextureCoordinate =computeParticleUV(a_CornerTextureCoordinate.zw, normalizedAge);\n\t\t#endif\n\t\t#ifdef RENDERMODE_MESH\n\t\t\tv_TextureCoordinate =computeParticleUV(a_MeshTextureCoordinate, normalizedAge);\n\t\t#endif\n\t\t\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y)*u_TilingOffset.xy+vec2(u_TilingOffset.z,-u_TilingOffset.w);//需要特殊处理\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y);//需要特殊处理\n\t\t#endif\n\t#endif\n    v_Discard=0.0;\n\t  \n\t#ifdef FOG\n\t\tv_PositionWorld=center;\n\t#endif\n   }\n   else\n\t{\n\t\tv_Discard=1.0;\n\t}\n}\n\n",t="#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\nvarying float v_Discard;\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\nuniform vec4 u_Tintcolor;\n\n#ifdef RENDERMODE_MESH\n\tvarying vec4 v_MeshColor;\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n\tuniform vec3 u_CameraPosition;\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\nvoid main()\n{\t\n\t#ifdef RENDERMODE_MESH\n\t\tgl_FragColor=v_MeshColor;\n\t#else\n\t\tgl_FragColor=vec4(1.0);\t\n\t#endif\n\t\t\n\t#ifdef DIFFUSEMAP\n\t\tif(v_Discard!=0.0)\n\t\t\tdiscard;\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\t\t#endif\n\t#else\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=v_Color;\n\t\t#endif\n\t#endif\n\t\n\t#ifdef FOG\n\t\tvec3 toEye=u_CameraPosition-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t\t\n\t\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}",r=Yi.add(d,e,t,i,n),kn.SHADERDEFINE_DIFFUSEMAP=r.registerMaterialDefine("DIFFUSEMAP"),kn.SHADERDEFINE_TINTCOLOR=r.registerMaterialDefine("TINTCOLOR"),kn.SHADERDEFINE_ADDTIVEFOG=r.registerMaterialDefine("ADDTIVEFOG"),kn.SHADERDEFINE_TILINGOFFSET=r.registerMaterialDefine("TILINGOFFSET"),aa.SHADERDEFINE_RENDERMODE_BILLBOARD=r.registerSpriteDefine("SPHERHBILLBOARD"),aa.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=r.registerSpriteDefine("STRETCHEDBILLBOARD"),aa.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=r.registerSpriteDefine("HORIZONTALBILLBOARD"),aa.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=r.registerSpriteDefine("VERTICALBILLBOARD"),aa.SHADERDEFINE_COLOROVERLIFETIME=r.registerSpriteDefine("COLOROVERLIFETIME"),aa.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=r.registerSpriteDefine("RANDOMCOLOROVERLIFETIME"),aa.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=r.registerSpriteDefine("VELOCITYOVERLIFETIMECONSTANT"),aa.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=r.registerSpriteDefine("VELOCITYOVERLIFETIMECURVE"),aa.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=r.registerSpriteDefine("VELOCITYOVERLIFETIMERANDOMCONSTANT"),aa.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=r.registerSpriteDefine("VELOCITYOVERLIFETIMERANDOMCURVE"),aa.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=r.registerSpriteDefine("TEXTURESHEETANIMATIONCURVE"),aa.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=r.registerSpriteDefine("TEXTURESHEETANIMATIONRANDOMCURVE"),aa.SHADERDEFINE_ROTATIONOVERLIFETIME=r.registerSpriteDefine("ROTATIONOVERLIFETIME"),aa.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=r.registerSpriteDefine("ROTATIONOVERLIFETIMESEPERATE"),aa.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=r.registerSpriteDefine("ROTATIONOVERLIFETIMECONSTANT"),aa.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=r.registerSpriteDefine("ROTATIONOVERLIFETIMECURVE"),aa.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=r.registerSpriteDefine("ROTATIONOVERLIFETIMERANDOMCONSTANTS"),aa.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=r.registerSpriteDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),aa.SHADERDEFINE_SIZEOVERLIFETIMECURVE=r.registerSpriteDefine("SIZEOVERLIFETIMECURVE"),aa.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=r.registerSpriteDefine("SIZEOVERLIFETIMECURVESEPERATE"),aa.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=r.registerSpriteDefine("SIZEOVERLIFETIMERANDOMCURVES"),aa.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=r.registerSpriteDefine("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),aa.SHADERDEFINE_RENDERMODE_MESH=r.registerSpriteDefine("RENDERMODE_MESH"),aa.SHADERDEFINE_SHAPE=r.registerSpriteDefine("SHAPE"),i={a_Position:0,a_Texcoord0:2,a_Time:33},n={u_Texture:[1,1],u_Albedo:[2,1],u_Color:[3,1],u_CurrentTime:[2,2],u_Duration:[3,2],u_MvpMatrix:[1,2]};var _=Tn.nameKey.add("GLITTER");e="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\nattribute float a_Time;\n\nuniform mat4 u_MvpMatrix;\nuniform  float u_CurrentTime;\nuniform  vec4 u_Color;\nuniform float u_Duration;\n\nvarying vec2 v_Texcoord;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n  gl_Position = u_MvpMatrix * a_Position;\n  \n  float age = u_CurrentTime-a_Time;\n  float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   \n  v_Texcoord=a_Texcoord0;\n  \n  v_Color=u_Color;\n  v_Color.a*=1.0-normalizedAge;\n}\n",t="#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform vec4 u_Albedo;\nuniform sampler2D u_Texture;\n\nvarying vec2 v_Texcoord;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\t\n  gl_FragColor=texture2D(u_Texture, v_Texcoord)*v_Color;\n  gl_FragColor=gl_FragColor*u_Albedo;\n}\n\n",r=Yi.add(_,e,t,i,n),i={a_Position:0},n={u_Intensity:[1,1],u_AlphaBlending:[2,1],u_CubeTexture:[3,1],u_MvpMatrix:[4,3]};var p=Tn.nameKey.add("SkyBox");e="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nvarying vec3 v_Texcoord;\n\n\nvoid main()\n{\n  gl_Position = (u_MvpMatrix*a_Position).xyww;\n  v_Texcoord=a_Position.xyz;\n}\n",t="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Intensity;\nuniform float u_AlphaBlending;\nuniform samplerCube u_CubeTexture;\n\nvarying vec3 v_Texcoord;\n\n\nvoid main()\n{\t\n  gl_FragColor=vec4(textureCube(u_CubeTexture, v_Texcoord).rgb*u_Intensity,u_AlphaBlending);\n}\n\n",Yi.add(p,e,t,i,n),i={a_Position:0,a_Texcoord0:2},n={u_Intensity:[1,1],u_AlphaBlending:[2,1],u_texture:[3,1],u_MvpMatrix:[4,3]};var f=Tn.nameKey.add("SkyDome");e="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\nuniform mat4 u_MvpMatrix;\nvarying vec2 v_Texcoord;\n\n\nvoid main()\n{\n  gl_Position = (u_MvpMatrix*a_Position).xyww;\n  v_Texcoord = a_Texcoord0;\n}\n",t="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Intensity;\nuniform float u_AlphaBlending;\nuniform sampler2D u_texture;\n\nvarying vec2 v_Texcoord;\n\n\nvoid main()\n{\t\n  gl_FragColor=vec4(texture2D(u_texture, v_Texcoord).rgb*u_Intensity,u_AlphaBlending);\n}\n\n",Yi.add(f,e,t,i,n),i={a_Position:0,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15},n={u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_SplatAlphaTexture:[0,1],u_NormalTexture:[1,1],u_DiffuseTexture1:[2,1],u_DiffuseTexture2:[3,1],u_DiffuseTexture3:[4,1],u_DiffuseTexture4:[5,1],u_DiffuseScale1:[6,1],u_DiffuseScale2:[7,1],u_DiffuseScale3:[8,1],u_DiffuseScale4:[9,1],u_MaterialDiffuse:[11,1],u_MaterialAmbient:[10,1],u_MaterialSpecular:[12,1],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var m=Tn.nameKey.add("Terrain");e="attribute vec4 a_Position;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nattribute vec2 a_Texcoord0;\nattribute vec2 a_Texcoord1;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\nuniform mat4 u_MvpMatrix;\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n\tv_Texcoord0=a_Texcoord0;\n\tv_Texcoord1=a_Texcoord1;\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tv_Normal=a_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n#endif\n\n#ifdef LIGHTMAP\n\t//这个地方使用a_Normal 并不是真的代表normal，其实凑巧法线图的uv正好是符合 light_Map的UV\n\tv_LightMapUV=vec2(a_Normal.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,(a_Normal.y-1.0)*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1\n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n\n}",t='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_MaterialDiffuse;\n\tuniform vec4 u_MaterialSpecular;\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_Normal;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tuniform vec3 u_MaterialAmbient;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\nuniform sampler2D u_SplatAlphaTexture;\nuniform sampler2D u_NormalTexture;\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform vec2 u_DiffuseScale1;\nuniform vec2 u_DiffuseScale2;\nuniform vec2 u_DiffuseScale3;\nuniform vec2 u_DiffuseScale4;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\n#ifdef LIGHTMAP\n\tuniform sampler2D u_LightMap;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n#ifdef DETAIL_NUM1\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz;\n#endif\n#ifdef DETAIL_NUM2\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz * (1.0-splatAlpha.r) + color2.xyz * splatAlpha.r;\n#endif\n#ifdef DETAIL_NUM3\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord1/u_DiffuseScale3);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz * (1.0-(splatAlpha.r+splatAlpha.g)) + color2.xyz * splatAlpha.r + color3.xyz * splatAlpha.g;\n#endif\n#ifdef DETAIL_NUM4\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord1/u_DiffuseScale3);\n\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord1/u_DiffuseScale4);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz * (1.0-(splatAlpha.r+splatAlpha.g+splatAlpha.b))+ color2.xyz * splatAlpha.r + color3.xyz * splatAlpha.g + color4.xyz * splatAlpha.b;\n#endif\n\tgl_FragColor.w = splatAlpha.a;\n\t\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n    vec3 normal = texture2D(u_NormalTexture,v_Normal.xy).xyz;\n\tnormal = normal*2.0 - vec3(1.0);\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t\t#endif\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular * shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular, gl_FragColor.a);\n\t#endif\n#endif\n\n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\n';var g=Yi.add(m,e,t,i,n);Dn.SHADERDEFINE_DETAIL_NUM1=g.registerMaterialDefine("DETAIL_NUM1"),Dn.SHADERDEFINE_DETAIL_NUM2=g.registerMaterialDefine("DETAIL_NUM2"),Dn.SHADERDEFINE_DETAIL_NUM4=g.registerMaterialDefine("DETAIL_NUM4"),Dn.SHADERDEFINE_DETAIL_NUM3=g.registerMaterialDefine("DETAIL_NUM3"),i={a_Position:0,a_Normal:3,a_Texcoord0:2},n={u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_SplatAlphaTexture:[0,1],u_DiffuseTexture1:[1,1],u_DiffuseTexture2:[2,1],u_DiffuseTexture3:[3,1],u_DiffuseTexture4:[4,1],u_DiffuseTexture5:[5,1],u_DiffuseScaleOffset1:[6,1],u_DiffuseScaleOffset2:[7,1],u_DiffuseScaleOffset3:[8,1],u_DiffuseScaleOffset4:[9,1],u_DiffuseScaleOffset5:[10,1],u_MaterialAlbedo:[14,1],u_MaterialDiffuse:[12,1],u_MaterialAmbient:[11,1],u_MaterialSpecular:[13,1],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var v=Tn.nameKey.add("ExtendTerrain");e="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\n\nvarying vec2 v_Texcoord0;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform vec4 u_LightmapScaleOffset;\n#endif\n\n#ifdef RECEIVESHADOW\n\tvarying float v_posViewZ;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n#endif\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n  \n\tv_Texcoord0 = a_Texcoord0;\n  \n\t#ifdef LIGHTMAP\n\t\tv_LightMapUV = vec2(a_Texcoord0.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,(a_Texcoord0.y-1.0)*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tv_Normal = a_Normal;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}",t='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tuniform vec3 u_MaterialDiffuse;\n\tuniform vec4 u_MaterialSpecular;\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_Normal;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\nuniform sampler2D u_SplatAlphaTexture;\n\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform sampler2D u_DiffuseTexture5;\n\nuniform vec4 u_DiffuseScaleOffset1;\nuniform vec4 u_DiffuseScaleOffset2;\nuniform vec4 u_DiffuseScaleOffset3;\nuniform vec4 u_DiffuseScaleOffset4;\nuniform vec4 u_DiffuseScaleOffset5;\n\nvarying vec2 v_Texcoord0;\n\nuniform vec3 u_MaterialAmbient;\nuniform vec4 u_MaterialAlbedo;\n\n#ifdef LIGHTMAP\n\tuniform sampler2D u_LightMap;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n\t#ifdef ExtendTerrain_DETAIL_NUM1\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r;\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM2\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r + color2.xyz * (1.0 - splatAlpha.r);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM3\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * (1.0 - splatAlpha.r - splatAlpha.g);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM4\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM5\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tvec4 color5 = texture2D(u_DiffuseTexture5, v_Texcoord0 * u_DiffuseScaleOffset5.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * splatAlpha.a + color5.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b - splatAlpha.a);\n\t#endif\n\t\tgl_FragColor.w = splatAlpha.a;\n\t\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n    vec3 normal = v_Normal;\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t#else\n\t\t#if defined(RECEIVESHADOW)\t\t\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t\t//vec3 tColor= u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue + mix(vec3(0.15,0.15,0.15),vec3(0.0),shadowValue);\n\t\t\t//gl_FragColor.rgb*=tColor;\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_MaterialAlbedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor = vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular * shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular, gl_FragColor.a);\n\t#endif\n#endif\n\n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\n\n\n\n\n';var y=Yi.add(v,e,t,i,n);y.addSpriteDefines($n.shaderDefines),y.addMaterialDefines(Mn.shaderDefines),i={a_Position:0,a_OffsetVector:41,a_Texcoord0X:38,a_Texcoord0Y:40,a_BirthTime:33},n={u_MvpMatrix:[1,2],u_VMatrix:[1,3],u_PMatrix:[2,3],u_TilingOffset:[3,1],u_MainTexture:[1,1],u_MainColor:[2,1],u_CurTime:[3,2],u_LifeTime:[4,2],u_WidthCurve:[5,2],u_WidthCurveKeyLength:[6,2],u_GradientColorkey:[7,2],u_GradientAlphakey:[8,2]};var C=Tn.nameKey.add("Trail");e="attribute vec3 a_Position;\nattribute vec3 a_OffsetVector;\nattribute vec4 a_Color;\nattribute float a_Texcoord0X;\nattribute float a_Texcoord0Y;\nattribute float a_BirthTime;\n\nuniform mat4 u_VMatrix;\nuniform mat4 u_PMatrix;\n\nuniform vec4 u_TilingOffset;\n\nuniform float u_CurTime;\nuniform float u_LifeTime;\nuniform vec4 u_WidthCurve[10];\nuniform int u_WidthCurveKeyLength;\n\nuniform vec4 u_GradientColorkey[10];\nuniform vec2 u_GradientAlphakey[10];\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nfloat hermiteInterpolate(float t, float outTangent, float inTangent, float duration, float value1, float value2)\n{\n\tfloat t2 = t * t;\n\tfloat t3 = t2 * t;\n\tfloat a = 2.0 * t3 - 3.0 * t2 + 1.0;\n\tfloat b = t3 - 2.0 * t2 + t;\n\tfloat c = t3 - t2;\n\tfloat d = -2.0 * t3 + 3.0 * t2;\n\treturn a * value1 + b * outTangent * duration + c * inTangent * duration + d * value2;\n}\n\nfloat getCurWidth(in float normalizeTime)\n{\n\tif(normalizeTime == 0.0){\n\t\treturn u_WidthCurve[0].w;\n\t}\n\telse if(normalizeTime >= 1.0){\n\t\treturn u_WidthCurve[u_WidthCurveKeyLength - 1].w;\n\t}\n\telse{\n\t\tfor(int i = 0; i < 10; i ++ )\n\t\t{\n\t\t\tif(normalizeTime == u_WidthCurve[i].x)\n\t\t\t{\n\t\t\t\treturn u_WidthCurve[i].w;\n\t\t\t}\n\t\t\t\n\t\t\tvec4 lastFrame = u_WidthCurve[i];\n\t\t\tvec4 nextFrame = u_WidthCurve[i + 1];\n\t\t\tif(normalizeTime > lastFrame.x && normalizeTime < nextFrame.x)\n\t\t\t{\n\t\t\t\tfloat duration = nextFrame.x - lastFrame.x;\n\t\t\t\tfloat t = (normalizeTime - lastFrame.x) / duration;\n\t\t\t\tfloat outTangent = lastFrame.z;\n\t\t\t\tfloat inTangent = nextFrame.y;\n\t\t\t\tfloat value1 = lastFrame.w;\n\t\t\t\tfloat value2 = nextFrame.w;\n\t\t\t\treturn hermiteInterpolate(t, outTangent, inTangent, duration, value1, value2);\n\t\t\t}\n\t\t}\t\n\t}\n}\t\n\nvec4 getColorFromGradientByBlend(in vec4 gradientColors[10], in vec2 gradientAlphas[10], in float normalizeTime)\n{\n\tvec4 color;\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec4 gradientColor = gradientColors[i];\n\t\tfloat colorKey = gradientColor.w;\n\t\tif(colorKey >= normalizeTime)\n\t\t{\n\t\t\tvec4 lastGradientColor = gradientColors[i-1];\n\t\t\tfloat lastColorKey = lastGradientColor.w;\n\t\t\tfloat age = (normalizeTime - lastColorKey) / (colorKey - lastColorKey);\n\t\t\tcolor.rgb = mix(gradientColors[i-1].xyz, gradientColor.xyz, age);\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec2 gradientAlpha = gradientAlphas[i];\n\t\tfloat alphaKey = gradientAlpha.y;\n\t\tif(alphaKey >= normalizeTime)\n\t\t{\n\t\t\tvec2 lastGradientAlpha = gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey = lastGradientAlpha.y;\n\t\t\tfloat age = (normalizeTime - lastAlphaKey) / (alphaKey - lastAlphaKey);\n\t\t\tcolor.a = mix(lastGradientAlpha.x, gradientAlpha.x, age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn color;\n}\n\nvec4 getColorFromGradientByFixed(in vec4 gradientColors[10], in vec2 gradientAlphas[10], in float normalizeTime)\n{\n\tvec4 color;\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec4 gradientColor = gradientColors[i];\n\t\tif(gradientColor.w >= normalizeTime)\n\t\t{\n\t\t\tcolor.rgb = gradientColor.xyz;\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec2 gradientAlpha = gradientAlphas[i];\n\t\tif(gradientAlpha.y >= normalizeTime)\n\t\t{\n\t\t\tcolor.a = gradientAlpha.x;\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn color;\n}\n\nvoid main()\n{\n\tfloat normalizeTime = (u_CurTime - a_BirthTime) / u_LifeTime;\n\t\n\tgl_Position = u_PMatrix * u_VMatrix * vec4(a_Position + a_OffsetVector * getCurWidth(normalizeTime),1.0);\n\t\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0 = (vec2(a_Texcoord0X, a_Texcoord0Y) * u_TilingOffset.xy) + u_TilingOffset.zw;\n\t#else\n\t\tv_Texcoord0 = vec2(a_Texcoord0X, a_Texcoord0Y);\n\t#endif\n\t\n\t#ifdef GRADIENTMODE_BLEND\n\t\tv_Color = getColorFromGradientByBlend(u_GradientColorkey, u_GradientAlphakey, normalizeTime);\n\t#else\n\t\tv_Color = getColorFromGradientByFixed(u_GradientColorkey, u_GradientAlphakey, normalizeTime);\n\t#endif\n}\n\n\n\n",t="#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform sampler2D u_MainTexture;\nuniform vec4 u_MainColor;\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nvoid main()\n{\t\n\tvec4 color = 2.0 * u_MainColor * v_Color;\n\t#ifdef DIFFUSETEXTURE\n\t\tvec4 mainTextureColor = texture2D(u_MainTexture, v_Texcoord0);\n\t\tcolor *= mainTextureColor;\n\t#endif\n\tgl_FragColor = color;\n}\n\n";var E=Yi.add(C,e,t,i,n);Vn.SHADERDEFINE_DIFFUSETEXTURE=E.registerMaterialDefine("DIFFUSETEXTURE"),Vn.SHADERDEFINE_TILINGOFFSET=E.registerSpriteDefine("TILINGOFFSET"),sa.SHADERDEFINE_GRADIENTMODE_BLEND=E.registerSpriteDefine("GRADIENTMODE_BLEND")},di);function di(){}var _i=function(){function e(){this._data=null,this._data=[]}f(e,"laya.d3.shader.ValusArray");var t=e.prototype;return t.setValue=function(e,t){this._data[e]=t},v(0,t,"data",function(){return this._data}),e}(),pi=function(){function g(){this._currentPSSM=-1,this._numberOfPSSM=3,this._maxDistance=200,this._ratioOfDistance=1/this._numberOfPSSM,this._statesDirty=!0,this._lightCulling=null,this._renderTarget=null,this._lightVPMatrix=null,this._lightCameras=null,this._shadowQuenes=null,this._shadowMapTextureSize=1024,this._scene=null,this._PCFType=0,this._shaderValueLightVP=null,this._shaderValueVPs=null,this._spiltDistance=new Array(4),this._globalParallelLightDir=new ai(0,-1,0),this._boundingSphere=new Array(4),this._boundingBox=new Array(4),this._frustumPos=new Array(16),this._uniformDistance=new Array(4),this._logDistance=new Array(4),this._dimension=new Array(4),this._tempLookAt3=new ai,this._tempLookAt4=new ri,this._tempValue=new ri,this._tempPos=new ai,this._tempLightUp=new ai,this._tempMin=new ri,this._tempMax=new ri,this._tempMatrix44=new qt,this._splitFrustumCulling=new Ut(qt.DEFAULT),this._tempScaleMatrix44=new qt,this._shadowPCFOffset=new ni(1/1024,1/1024),this._shaderValueDistance=new ri;var e=0;for(e=0;e<this._spiltDistance.length;e++)this._spiltDistance[e]=0;for(e=0;e<this._dimension.length;e++)this._dimension[e]=new ni;for(e=0;e<this._frustumPos.length;e++)this._frustumPos[e]=new ai;for(e=0;e<this._boundingBox.length;e++)this._boundingBox[e]=new Ht(new ai,new ai);for(e=0;e<this._boundingSphere.length;e++)this._boundingSphere[e]=new Gt(new ai,0);qt.createScaling(new ai(.5,.5,1),this._tempScaleMatrix44),this._tempScaleMatrix44.elements[12]=.5,this._tempScaleMatrix44.elements[13]=.5}f(g,"laya.d3.shadowMap.ParallelSplitShadowMap");var e=g.prototype;return e.setInfo=function(e,t,i,n,a,r){3<a&&(this._numberOfPSSM=3),this._scene=e,this._maxDistance=t,this.PSSMNum=a,this._globalParallelLightDir=i,this._ratioOfDistance=1/this._numberOfPSSM;for(var s=0;s<this._spiltDistance.length;s++)this._spiltDistance[s]=0;this._shadowMapTextureSize=n,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this.setPCFType(r),this._statesDirty=!0},e.setPCFType=function(e){switch(this._PCFType=e,this._PCFType){case 0:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3);break;case 1:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3);break;case 2:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3);break;case 3:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2)}},e.getPCFType=function(){return this._PCFType},e.setFarDistance=function(e){this._maxDistance!=e&&(this._maxDistance=e,this._statesDirty=!0)},e.getFarDistance=function(){return this._maxDistance},e._setGlobalParallelLightDir=function(e){this._globalParallelLightDir=e},e.getGlobalParallelLightDir=function(){return this._globalParallelLightDir},e.getCurrentPSSM=function(){return this._currentPSSM},e.getLightCamera=function(e){return this._lightCameras[e]},e._beginSampler=function(e,t){if(e<0||e>this._numberOfPSSM)throw new Error("ParallelSplitShadowMap: beginSample invalid index");this._currentPSSM=e,this._update(t)},e.endSampler=function(e){this._currentPSSM=-1},e._calcAllLightCameraInfo=function(e){if(1===this._numberOfPSSM)this._beginSampler(0,e),this.endSampler(e);else for(var t=0,i=this._numberOfPSSM+1;t<i;t++)this._beginSampler(t,e),this.endSampler(e)},e._recalculate=function(e,t,i){this._calcSplitDistance(e),this._calcBoundingBox(t,i),this._rebuildRenderInfo()},e._update=function(e){var t=e.nearPlane,i=e.fieldOfView,n=e.aspectRatio;!this._statesDirty&&this.lastNearPlane===t&&this.lastFieldOfView===i&&this.lastAspectRatio===n||(this._recalculate(t,i,n),this._uploadShaderValue(),this._statesDirty=!1,this.lastNearPlane=t,this.lastFieldOfView=i,this.lastAspectRatio=n),this._calcLightViewProject(e)},e._uploadShaderValue=function(){var e=this._scene;switch(this._numberOfPSSM){case 1:e.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),e.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2),e.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3);break;case 2:e.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2),e.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),e.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3);break;case 3:e.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3),e.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),e.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2)}var t=e._shaderValues;switch(t.setValue(15,this._shaderValueDistance.elements),t.setValue(16,this._shaderValueLightVP),t.setValue(17,this._shadowPCFOffset.elements),this._numberOfPSSM){case 3:t.setValue(18,this.getRenderTarget(1)),t.setValue(19,this.getRenderTarget(2)),t.setValue(20,this.getRenderTarget(3));break;case 2:t.setValue(18,this.getRenderTarget(1)),t.setValue(19,this.getRenderTarget(2));break;case 1:t.setValue(18,this.getRenderTarget(1))}},e._calcSplitDistance=function(e){var t=this._maxDistance,i=1/this._numberOfPSSM,n=0;for(n=0;n<=this._numberOfPSSM;n++)this._uniformDistance[n]=e+(t-e)*n*i;var a=t/e;for(n=0;n<=this._numberOfPSSM;n++){var r=Math.pow(a,n*i);this._logDistance[n]=e*r}for(n=0;n<=this._numberOfPSSM;n++)this._spiltDistance[n]=this._uniformDistance[n]*this._ratioOfDistance+this._logDistance[n]*(1-this._ratioOfDistance);this._shaderValueDistance.x=this._spiltDistance[1],this._shaderValueDistance.y=this._spiltDistance[2],this._shaderValueDistance.z=this._spiltDistance[3],this._shaderValueDistance.w=this._spiltDistance[4]},e._calcBoundingBox=function(e,t){var i,n,a,r,s=3.1415926*e/180,o=Math.tan(s/2),l=NaN,h=NaN,c=NaN,u=0;for(u=0;u<=this._numberOfPSSM;u++){h=(l=(c=this._spiltDistance[u])*o)*t;var d=this._frustumPos[4*u+0].elements;d[0]=-h,d[1]=-l,d[2]=-c,(d=this._frustumPos[4*u+1].elements)[0]=h,d[1]=-l,d[2]=-c,(d=this._frustumPos[4*u+2].elements)[0]=-h,d[1]=l,d[2]=-c,(d=this._frustumPos[4*u+3].elements)[0]=h,d[1]=l,d[2]=-c,(d=this._dimension[u].elements)[0]=h,d[1]=l}for(u=1;u<=this._numberOfPSSM;u++)i=this._dimension[u].elements,(n=this._boundingBox[u].min.elements)[0]=-i[0],n[1]=-i[1],n[2]=-this._spiltDistance[u],(a=this._boundingBox[u].max.elements)[0]=i[0],a[1]=i[1],a[2]=-this._spiltDistance[u-1],(r=this._boundingSphere[u].center.elements)[0]=.5*(n[0]+a[0]),r[1]=.5*(n[1]+a[1]),r[2]=.5*(n[2]+a[2]),this._boundingSphere[u].radius=.5*Math.sqrt(Math.pow(a[0]-n[0],2)+Math.pow(a[1]-n[1],2)+Math.pow(a[2]-n[2],2));n=this._boundingBox[0].min.elements,i=this._dimension[this._numberOfPSSM].elements,n[0]=-i[0],n[1]=-i[1],n[2]=-this._spiltDistance[this._numberOfPSSM],(a=this._boundingBox[0].max.elements)[0]=i[0],a[1]=i[1],a[2]=-this._spiltDistance[0],(r=this._boundingSphere[0].center.elements)[0]=.5*(n[0]+a[0]),r[1]=.5*(n[1]+a[1]),r[2]=.5*(n[2]+a[2]),this._boundingSphere[0].radius=.5*Math.sqrt(Math.pow(a[0]-n[0],2)+Math.pow(a[1]-n[1],2)+Math.pow(a[2]-n[2],2))},e.calcSplitFrustum=function(e){0<this._currentPSSM?qt.createPerspective(3.1416*e.fieldOfView/180,e.aspectRatio,this._spiltDistance[this._currentPSSM-1],this._spiltDistance[this._currentPSSM],this._tempMatrix44):qt.createPerspective(3.1416*e.fieldOfView/180,e.aspectRatio,this._spiltDistance[0],this._spiltDistance[this._numberOfPSSM],this._tempMatrix44),qt.multiply(this._tempMatrix44,e.viewMatrix,this._tempMatrix44),this._splitFrustumCulling.matrix=this._tempMatrix44},e._rebuildRenderInfo=function(){var e=this._numberOfPSSM+1,t=0;if(null==this._renderTarget)for(this._renderTarget=T(e),this._renderTarget[0]=null,t=1;t<e;t++)this._renderTarget[t]=new Xn(this._shadowMapTextureSize,this._shadowMapTextureSize,6408,5121,33189,!1,!1,9728,9728);else if(this._renderTarget.length!=e)for(this.disposeAllRenderTarget(),this._renderTarget.length=e,this._renderTarget[0]=null,t=1;t<e;t++)this._renderTarget[t]=new Xn(this._shadowMapTextureSize,this._shadowMapTextureSize,6408,5121,33189,!1,!1,9728,9728);else for(t=1;t<e;t++)null!=this._renderTarget[t]&&this._renderTarget[t].width==this._shadowMapTextureSize&&this._renderTarget[t].height==this._shadowMapTextureSize||(null!=this._renderTarget[t]&&this._renderTarget[t].destroy(),this._renderTarget[t]=new Xn(this._shadowMapTextureSize,this._shadowMapTextureSize,6408,5121,33189,!1,!1,9728,9728));if(null==this._lightCulling||this._lightCulling.length!=e)for(this._lightCulling?this._lightCulling.length=e:this._lightCulling=T(e),t=0;t<this._lightCulling.length;t++)this._lightCulling[t]=new Ut(qt.DEFAULT);if(null==this._lightVPMatrix||this._lightVPMatrix.length!=e)for(this._lightVPMatrix?this._lightVPMatrix.length=e:this._lightVPMatrix=T(e),t=0;t<this._lightVPMatrix.length;t++)this._lightVPMatrix[t]=new qt;if(null==this._lightCameras||this._lightCameras.length!=e)for(this._lightCameras?this._lightCameras.length=e:this._lightCameras=T(e),t=0;t<this._lightCameras.length;t++)this._lightCameras[t]=new ta,this._lightCameras[t].name="lightCamera"+t;if(null==this._shadowQuenes||this._shadowQuenes.length!=this._numberOfPSSM)for(this._shadowQuenes?this._shadowQuenes.length=this._numberOfPSSM:this._shadowQuenes=T(this._numberOfPSSM),t=0;t<this._shadowQuenes.length;t++)this._shadowQuenes[t]=new re(this._scene);if(null==this._shaderValueVPs||this._shaderValueVPs.length!=e)for(this._shaderValueVPs?this._shaderValueVPs.length=e:this._shaderValueVPs=T(e),this._shaderValueLightVP=new Float32Array(16*e),t=0;t<e;t++)this._shaderValueVPs[t]=new Float32Array(this._shaderValueLightVP.buffer,64*t)},e._calcLightViewProject=function(e){var t=this._boundingSphere[this._currentPSSM],i=e.transform.worldMatrix;t.radius;t.center.cloneTo(this._tempLookAt3),ai.transformV3ToV4(this._tempLookAt3,i,this._tempLookAt4);var n=this._tempLookAt3.elements,a=this._tempLookAt4.elements;n[0]=a[0],n[1]=a[1],n[2]=a[2];var r=this._tempLightUp.elements,s=e.forward.elements;r[0]=s[0],r[1]=1,r[2]=s[2],ai.normalize(this._tempLightUp,this._tempLightUp),ai.scale(this._globalParallelLightDir,4*t.radius,this._tempPos),ai.subtract(this._tempLookAt3,this._tempPos,this._tempPos);var o=this._lightCameras[this._currentPSSM];o.transform.position=this._tempPos,o.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1);var l=this._tempMax.elements,h=this._tempMin.elements;l[0]=l[1]=l[2]=-1e5,l[3]=1,h[0]=h[1]=h[2]=1e5,h[3]=1,qt.multiply(o.viewMatrix,i,this._tempMatrix44);var c=this._tempValue.elements,u=[];u.length=8,this._boundingBox[this._currentPSSM].getCorners(u);for(var d=0;d<8;d++){var _=u[d].elements;c[0]=_[0],c[1]=_[1],c[2]=_[2],c[3]=1,ri.transformByM4x4(this._tempValue,this._tempMatrix44,this._tempValue),h[0]=c[0]<h[0]?c[0]:h[0],h[1]=c[1]<h[1]?c[1]:h[1],h[2]=c[2]<h[2]?c[2]:h[2],l[0]=c[0]>l[0]?c[0]:l[0],l[1]=c[1]>l[1]?c[1]:l[1],l[2]=c[2]>l[2]?c[2]:l[2]}ri.add(this._tempMax,this._tempMin,this._tempValue),c[0]*=.5,c[1]*=.5,c[2]*=.5,c[3]=1,ri.transformByM4x4(this._tempValue,o.transform.worldMatrix,this._tempValue);var p=Math.abs(-this._tempMax.z),f=p>this._maxDistance?p:this._maxDistance;ai.scale(this._globalParallelLightDir,f,this._tempPos);var m=this._tempPos.elements;m[0]=c[0]-m[0],m[1]=c[1]-m[1],m[2]=c[2]-m[2],o.transform.position=this._tempPos,o.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1),qt.createOrthoOffCenterRH(h[0],l[0],h[1],l[1],1,f+.5*(l[2]-h[2]),o.projectionMatrix),o.projectionViewMatrix.cloneTo(this._lightVPMatrix[this._currentPSSM]),this._lightCulling[this._currentPSSM].matrix=this._lightVPMatrix[this._currentPSSM],g.multiplyMatrixOutFloat32Array(this._tempScaleMatrix44,this._lightVPMatrix[this._currentPSSM],this._shaderValueVPs[this._currentPSSM])},e.getLightFrustumCulling=function(e){return this._lightCulling[e]},e.getSplitFrustumCulling=function(){return this._splitFrustumCulling},e.getSplitDistance=function(e){return this._spiltDistance[e]},e.setShadowMapTextureSize=function(e){e!==this._shadowMapTextureSize&&(this._shadowMapTextureSize=e,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this._statesDirty=!0)},e.getShadowMapTextureSize=function(){return this._shadowMapTextureSize},e.beginRenderTarget=function(e){this._renderTarget[e].start()},e.endRenderTarget=function(e){this._renderTarget[e].end()},e.getRenderTarget=function(e){return this._renderTarget[e]},e.disposeAllRenderTarget=function(){for(var e=0,t=this._numberOfPSSM+1;e<t;e++)this._renderTarget[e]&&(this._renderTarget[e].destroy(),this._renderTarget[e]=null)},v(0,e,"PSSMNum",function(){return this._numberOfPSSM},function(e){e=(e=0<e?e:1)<=3?e:3,this._numberOfPSSM!=e&&(this._numberOfPSSM=e,this._ratioOfDistance=1/this._numberOfPSSM,this._statesDirty=!0)}),g.multiplyMatrixOutFloat32Array=function(e,t,i){var n,a,r,s,o,l,h;for(a=e.elements,r=t.elements,n=0;n<4;n++)s=a[n],o=a[n+4],l=a[n+8],h=a[n+12],i[n]=s*r[0]+o*r[1]+l*r[2]+h*r[3],i[n+4]=s*r[4]+o*r[5]+l*r[6]+h*r[7],i[n+8]=s*r[8]+o*r[9]+l*r[10]+h*r[11],i[n+12]=s*r[12]+o*r[13]+l*r[14]+h*r[15]},g.SHADERDEFINE_RECEIVE_SHADOW=1,g.SHADERDEFINE_CAST_SHADOW=512,g.SHADERDEFINE_SHADOW_PSSM1=1024,g.SHADERDEFINE_SHADOW_PSSM2=2048,g.SHADERDEFINE_SHADOW_PSSM3=4096,g.SHADERDEFINE_SHADOW_PCF_NO=8192,g.SHADERDEFINE_SHADOW_PCF1=16384,g.SHADERDEFINE_SHADOW_PCF2=32768,g.SHADERDEFINE_SHADOW_PCF3=65536,g.MAX_PSSM_COUNT=3,g}(),fi=function(){function S(){this._boundingSphere=null,this._boundingBox=null,this._sizeOfY=null,this._currentLODLevel=0,this._lastDistanceToEye=NaN,this._originalBoundingSphere=null,this._originalBoundingBox=null,this._originalBoundingBoxCorners=null,this._bUseStrip=!1,this._gridSize=NaN,this._beginGridX=0,this._beginGridZ=0,this._LODError=null,S.__init__(),this._currentLODLevel=0}f(S,"laya.d3.terrain.TerrainLeaf");var e=S.prototype;return e.calcVertextNorml=function(e,t,i,n,a,r){var s=0,o=0;o=-1*S.getHeightFromTerrainHeightData(e-1,t-1,i,n,a),o+=-1*S.getHeightFromTerrainHeightData(e-1,t,i,n,a),o+=-1*S.getHeightFromTerrainHeightData(e-1,t+1,i,n,a),o+=1*S.getHeightFromTerrainHeightData(e+1,t-1,i,n,a),o+=1*S.getHeightFromTerrainHeightData(e+1,t,i,n,a),o+=1*S.getHeightFromTerrainHeightData(e+1,t+1,i,n,a),s=-1*S.getHeightFromTerrainHeightData(e-1,t-1,i,n,a),s+=-1*S.getHeightFromTerrainHeightData(e,t-1,i,n,a),s+=-1*S.getHeightFromTerrainHeightData(e+1,t-1,i,n,a),s+=1*S.getHeightFromTerrainHeightData(e-1,t+1,i,n,a),s+=1*S.getHeightFromTerrainHeightData(e,t+1,i,n,a),s+=1*S.getHeightFromTerrainHeightData(e+1,t+1,i,n,a),r.x=-o,r.y=6,r.z=-s,ai.normalize(r,r)},e.calcVertextNormlUV=function(e,t,i,n,a){a.x=e/i,a.y=t/n,a.z=t/n},e.calcVertextBuffer=function(e,t,i,n,a,r,s,o,l,h,c,u){if(1==u&&!S.__ADAPT_MATRIX__){S.__ADAPT_MATRIX__=new qt;var d=new qt;qt.createRotationY(Math.PI,S.__ADAPT_MATRIX__),qt.createTranslate(new ai(0,0,(c-1)*a),d),qt.multiply(d,S.__ADAPT_MATRIX__,S.__ADAPT_MATRIX__),S.__ADAPT_MATRIX_INV__=new qt,S.__ADAPT_MATRIX__.invert(S.__ADAPT_MATRIX_INV__)}this._gridSize=a,this._beginGridX=e*S.CHUNK_GRID_NUM+i,this._beginGridZ=t*S.CHUNK_GRID_NUM+n;for(var _=s*o,p=2147483647,f=-2147483648,m=new ai,g=0,v=S.LEAF_GRID_NUM+1;g<v;g++)for(var y=0,C=S.LEAF_GRID_NUM+1;y<C;y++)S.__VECTOR3__.x=(this._beginGridX+y)*this._gridSize,S.__VECTOR3__.z=(this._beginGridZ+g)*this._gridSize,S.__VECTOR3__.y=l[(this._beginGridZ+g)*h+(this._beginGridX+y)],p=S.__VECTOR3__.y<p?S.__VECTOR3__.y:p,f=S.__VECTOR3__.y>f?S.__VECTOR3__.y:f,S.__ADAPT_MATRIX__&&ai.transformV3ToV3(S.__VECTOR3__,S.__ADAPT_MATRIX__,S.__VECTOR3__),r[_]=S.__VECTOR3__.x,r[++_]=S.__VECTOR3__.y,r[++_]=S.__VECTOR3__.z,_++,this.calcVertextNormlUV(this._beginGridX+y,this._beginGridZ+g,h,c,m),r[_]=m.x,r[++_]=m.y,r[++_]=m.z,r[++_]=(i+y)/S.CHUNK_GRID_NUM,r[++_]=(n+g)/S.CHUNK_GRID_NUM,r[++_]=this._beginGridX+y,r[++_]=this._beginGridZ+g,_++;this._sizeOfY=new ni(p-1,f+1),this.calcLODErrors(l,h,c),this.calcOriginalBoudingBoxAndSphere()},e.calcSkirtVertextBuffer=function(e,t,i,n,a,r,s,o,l,h,c){this._gridSize=a,this._beginGridX=e*S.CHUNK_GRID_NUM+i,this._beginGridZ=t*S.CHUNK_GRID_NUM+n;var u=s*o,d=0,_=0,p=S.LEAF_GRID_NUM+1,f=new ai,m=0,g=0;for(d=0;d<2;d++)for(_=0;_<p;_++)S.__VECTOR3__.x=(this._beginGridX+_)*this._gridSize,S.__VECTOR3__.y=1==d?l[this._beginGridZ*h+(this._beginGridX+_)]:-this._gridSize,S.__VECTOR3__.z=(this._beginGridZ+0)*this._gridSize,S.__ADAPT_MATRIX__&&ai.transformV3ToV3(S.__VECTOR3__,S.__ADAPT_MATRIX__,S.__VECTOR3__),r[u]=S.__VECTOR3__.x,r[++u]=S.__VECTOR3__.y,r[++u]=S.__VECTOR3__.z,u++,m=0==d?this._beginGridZ-1:this._beginGridZ,this.calcVertextNormlUV(this._beginGridX+_,m,h,c,f),r[u]=f.x,r[++u]=f.y,r[++u]=f.z,r[++u]=(i+_)/S.CHUNK_GRID_NUM,r[++u]=(n+0)/S.CHUNK_GRID_NUM,r[++u]=this._beginGridX+_,r[++u]=m,u++;for(d=0;d<2;d++)for(_=0;_<p;_++)S.__VECTOR3__.x=(this._beginGridX+_)*this._gridSize,S.__VECTOR3__.y=0==d?l[(this._beginGridZ+S.LEAF_GRID_NUM)*h+(this._beginGridX+_)]:-this._gridSize,S.__VECTOR3__.z=(this._beginGridZ+S.LEAF_GRID_NUM)*this._gridSize,S.__ADAPT_MATRIX__&&ai.transformV3ToV3(S.__VECTOR3__,S.__ADAPT_MATRIX__,S.__VECTOR3__),r[u]=S.__VECTOR3__.x,r[++u]=S.__VECTOR3__.y,r[++u]=S.__VECTOR3__.z,u++,m=0==d?this._beginGridZ+S.LEAF_GRID_NUM:this._beginGridZ+S.LEAF_GRID_NUM+1,this.calcVertextNormlUV(this._beginGridX+_,m,h,c,f),r[u]=f.x,r[++u]=f.y,r[++u]=f.z,r[++u]=(i+_)/S.CHUNK_GRID_NUM,r[++u]=(n+S.LEAF_GRID_NUM)/S.CHUNK_GRID_NUM,r[++u]=this._beginGridX+_,r[++u]=m,u++;for(d=0;d<2;d++)for(_=0;_<p;_++)S.__VECTOR3__.x=(this._beginGridX+0)*this._gridSize,S.__VECTOR3__.y=0==d?l[(this._beginGridZ+_)*h+(this._beginGridX+0)]:-this._gridSize,S.__VECTOR3__.z=(this._beginGridZ+_)*this._gridSize,S.__ADAPT_MATRIX__&&ai.transformV3ToV3(S.__VECTOR3__,S.__ADAPT_MATRIX__,S.__VECTOR3__),r[u]=S.__VECTOR3__.x,r[++u]=S.__VECTOR3__.y,r[++u]=S.__VECTOR3__.z,u++,g=0==d?this._beginGridX:this._beginGridX-1,this.calcVertextNormlUV(g,this._beginGridZ+_,h,c,f),r[u]=f.x,r[++u]=f.y,r[++u]=f.z,r[++u]=(i+0)/S.CHUNK_GRID_NUM,r[++u]=(n+_)/S.CHUNK_GRID_NUM,r[++u]=g,r[++u]=this._beginGridZ+_,u++;for(d=0;d<2;d++)for(_=0;_<p;_++)S.__VECTOR3__.x=(this._beginGridX+S.LEAF_GRID_NUM)*this._gridSize,S.__VECTOR3__.y=1==d?l[(this._beginGridZ+_)*h+(this._beginGridX+S.LEAF_GRID_NUM)]:-this._gridSize,S.__VECTOR3__.z=(this._beginGridZ+_)*this._gridSize,S.__ADAPT_MATRIX__&&ai.transformV3ToV3(S.__VECTOR3__,S.__ADAPT_MATRIX__,S.__VECTOR3__),r[u]=S.__VECTOR3__.x,r[++u]=S.__VECTOR3__.y,r[++u]=S.__VECTOR3__.z,u++,g=0==d?this._beginGridX+S.LEAF_GRID_NUM+1:this._beginGridX+S.LEAF_GRID_NUM,this.calcVertextNormlUV(g,this._beginGridZ+_,h,c,f),r[u]=f.x,r[++u]=f.y,r[++u]=f.z,r[++u]=(i+S.LEAF_GRID_NUM)/S.CHUNK_GRID_NUM,r[++u]=(n+_)/S.CHUNK_GRID_NUM,r[++u]=g,r[++u]=this._beginGridZ+_,u++},e.calcOriginalBoudingBoxAndSphere=function(){var e=new ai(this._beginGridX*this._gridSize,this._sizeOfY.x,this._beginGridZ*this._gridSize),t=new ai((this._beginGridX+S.LEAF_GRID_NUM)*this._gridSize,this._sizeOfY.y,(this._beginGridZ+S.LEAF_GRID_NUM)*this._gridSize);S.__ADAPT_MATRIX__&&(ai.transformV3ToV3(e,S.__ADAPT_MATRIX__,e),ai.transformV3ToV3(t,S.__ADAPT_MATRIX__,t)),this._originalBoundingBox=new Ht(e,t);var i=new ai;ai.subtract(t,e,i),ai.scale(i,.5,i);var n=new ai;ai.add(e,i,n),this._originalBoundingSphere=new Gt(n,ai.scalarLength(i)),this._originalBoundingBoxCorners=T(8,null),this._originalBoundingBox.getCorners(this._originalBoundingBoxCorners),this._boundingBox=new Ht(new ai(-.5,-.5,-.5),new ai(.5,.5,.5)),this._boundingSphere=new Gt(new ai(0,0,0),1)},e.calcLeafBoudingBox=function(e){for(var t=0;t<8;t++)ai.transformCoordinate(this._originalBoundingBoxCorners[t],e,ki._tempBoundBoxCorners[t]);Ht.createfromPoints(ki._tempBoundBoxCorners,this._boundingBox)},e.calcLeafBoudingSphere=function(e,t){ai.transformCoordinate(this._originalBoundingSphere.center,e,this._boundingSphere.center),this._boundingSphere.radius=this._originalBoundingSphere.radius*t},e.calcLODErrors=function(e,t,i){this._LODError=new Float32Array(S._maxLODLevel+1);for(var n=1,a=0,r=S._maxLODLevel+1;a<r;a++){for(var s=0,o=0,l=S.LEAF_GRID_NUM;o<l;o+=n)for(var h=0,c=S.LEAF_GRID_NUM;h<c;h+=n)for(var u=e[(this._beginGridZ+o)*t+(this._beginGridX+h)],d=e[(this._beginGridZ+o)*t+(this._beginGridX+h)+n],_=e[(this._beginGridZ+o+n)*t+(this._beginGridX+h)],p=e[(this._beginGridZ+o+n)*t+(this._beginGridX+h)+n],f=0;f<n;f++)for(var m=f/n,g=0;g<n;g++){var v=g/n,y=e[(this._beginGridZ+o+f)*t+(this._beginGridX+h)+g],C=v+m<=1?u+(d-u)*v+(_-u)*m:p+(_-p)*(1-v)+(d-p)*(1-m),E=Math.abs(C-y);s=Math.max(s,E)}n*=2,this._LODError[a]=s}},e.determineLod=function(e,t,i,n){var a=ai.distance(e,this._boundingSphere.center),r=S._maxLODLevel;if(!n){if(this._lastDistanceToEye==a)return this._currentLODLevel;this._lastDistanceToEye>a&&(r=this._currentLODLevel)}for(var s=r;1<=s;s--)if(ea.LOD_DISTANCE_FACTOR*this._LODError[s]/a*t<i){this._currentLODLevel=s;break}return this._lastDistanceToEye=a,this._currentLODLevel},S.__init__=function(){if(!S._bInit){var e=S.CHUNK_GRID_NUM/S.LEAF_GRID_NUM*(S.CHUNK_GRID_NUM/S.LEAF_GRID_NUM);S._planeLODIndex=T(e);var t=0,i=0,n=0,a=0,r=0,s=0,o=null,l=null;for(t=0;t<e;t++)S._planeLODIndex[t]=new Array(S._maxLODLevel+1);for(t=0,a=S._maxLODLevel+1;t<a;t++)S._planeLODIndex[0][t]=S.calcPlaneLODIndex(t);for(t=1;t<e;t++)for(s=t*S.LEAF_PLANE_VERTEXT_COUNT,i=0,r=S._maxLODLevel+1;i<r;i++){for(o=S._planeLODIndex[0][i],l=new Uint16Array(o.length),n=0;n<o.length;n++)l[n]=o[n]+s;S._planeLODIndex[t][i]=l}for(S._skirtLODIndex=T(e),t=0;t<e;t++)S._skirtLODIndex[t]=new Array(S._maxLODLevel+1);for(t=0,a=S._maxLODLevel+1;t<a;t++)S._skirtLODIndex[0][t]=S.calcSkirtLODIndex(t);for(t=1;t<e;t++)for(s=t*S.LEAF_SKIRT_VERTEXT_COUNT,i=0,r=S._maxLODLevel+1;i<r;i++){for(o=S._skirtLODIndex[0][i],l=new Uint16Array(o.length),n=0;n<o.length;n++)l[n]=o[n]+s;S._skirtLODIndex[t][i]=l}S._bInit=!0}},S.getPlaneLODIndex=function(e,t){return S._planeLODIndex[e][t]},S.getSkirtLODIndex=function(e,t){return S._skirtLODIndex[e][t]},S.calcPlaneLODIndex=function(e){S._maxLODLevel<e&&(e=S._maxLODLevel);var t=S.LEAF_GRID_NUM+1,i=0,n=null,a=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/Math.pow(2,e);n=new Uint16Array(a*a*6);for(var r=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/a,s=0;s<S.LEAF_GRID_NUM;s+=r)for(var o=0;o<S.LEAF_GRID_NUM;o+=r)n[i]=(s+r)*t+o,n[++i]=s*t+o,n[++i]=s*t+o+r,n[++i]=s*t+o+r,n[++i]=(s+r)*t+o+r,n[++i]=(s+r)*t+o,i++;return n},S.calcSkirtLODIndex=function(e){S._maxLODLevel<e&&(e=S._maxLODLevel);var t=S.CHUNK_GRID_NUM/S.LEAF_GRID_NUM*(S.CHUNK_GRID_NUM/S.LEAF_GRID_NUM)*S.LEAF_PLANE_VERTEXT_COUNT,i=S.LEAF_GRID_NUM+1,n=0,a=null,r=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/Math.pow(2,e);a=new Uint16Array(4*r*6);for(var s=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/r,o=0;o<4;o++){for(var l=0;l<S.LEAF_GRID_NUM;l+=s)a[n]=t+i+l,a[++n]=t+l,a[++n]=t+l+s,a[++n]=t+l+s,a[++n]=t+i+l+s,a[++n]=t+i+l,n++;t+=2*i}return a},S.getHeightFromTerrainHeightData=function(e,t,i,n,a){return i[(t=a<=(t=t<0?0:t)?a-1:t)*n+(e=n<=(e=e<0?0:e)?n-1:e)]},S.CHUNK_GRID_NUM=64,S.LEAF_GRID_NUM=32,S.__ADAPT_MATRIX__=null,S.__ADAPT_MATRIX_INV__=null,S._planeLODIndex=null,S._skirtLODIndex=null,S._bInit=!1,u(S,["LEAF_PLANE_VERTEXT_COUNT",function(){return this.LEAF_PLANE_VERTEXT_COUNT=(S.LEAF_GRID_NUM+1)*(S.LEAF_GRID_NUM+1)},"LEAF_SKIRT_VERTEXT_COUNT",function(){return this.LEAF_SKIRT_VERTEXT_COUNT=2*(S.LEAF_GRID_NUM+1)*4},"LEAF_VERTEXT_COUNT",function(){return this.LEAF_VERTEXT_COUNT=S.LEAF_PLANE_VERTEXT_COUNT+S.LEAF_SKIRT_VERTEXT_COUNT},"LEAF_PLANE_MAX_INDEX_COUNT",function(){return this.LEAF_PLANE_MAX_INDEX_COUNT=S.LEAF_GRID_NUM*S.LEAF_GRID_NUM*6},"LEAF_SKIRT_MAX_INDEX_COUNT",function(){return this.LEAF_SKIRT_MAX_INDEX_COUNT=4*S.LEAF_GRID_NUM*6},"LEAF_MAX_INDEX_COUNT",function(){return this.LEAF_MAX_INDEX_COUNT=S.LEAF_PLANE_MAX_INDEX_COUNT+S.LEAF_SKIRT_MAX_INDEX_COUNT},"__VECTOR3__",function(){return this.__VECTOR3__=new ai},"_maxLODLevel",function(){return this._maxLODLevel=Math.log2(S.LEAF_GRID_NUM)}]),S}(),mi=(f(gi,"laya.d3.terrain.unit.ChunkInfo"),gi);function gi(){this.alphaMap=null,this.detailID=null,this.normalMap=null}var vi=(f(yi,"laya.d3.terrain.unit.DetailTextureInfo"),yi);function yi(){this.diffuseTexture=null,this.normalTexture=null,this.scale=null,this.offset=null}var Ci=(f(Ei,"laya.d3.terrain.unit.MaterialInfo"),Ei);function Ei(){this.ambientColor=null,this.diffuseColor=null,this.specularColor=null}var Si=(f(xi,"laya.d3.utils.Physics"),xi.__init__=function(){xi._layerCollsionMatrix.length=31;for(var e=0;e<31;e++){var t=[],i=31-e;t.length=i;for(var n=0;n<i;n++)t[n]=n===i-1;xi._layerCollsionMatrix[e]=t}},xi.setLayerCollision=function(e,t,i){xi._layerCollsionMatrix[e.number][30-t.number]=i},xi.getLayerCollision=function(e,t){return xi._layerCollsionMatrix[e.number][30-t.number]},xi.setColliderCollision=function(e,t,i){i?(delete e._ignoreCollisonMap[t.id],delete t._ignoreCollisonMap[e.id]):(e._ignoreCollisonMap[t.id]=t)._ignoreCollisonMap[e.id]=e},xi.getIColliderCollision=function(e,t){return!!e._ignoreCollisonMap[t.id]},xi.rayCast=function(e,t,i,n){void 0===i&&(i=179e306),void 0===n&&(n=0),xi._outHitAllInfo.length=0;for(var a=Y.getLayerByNumber(n)._colliders,r=0,s=a.length;r<s;r++){var o=a[r];if(o.enable&&(o.raycast(e,xi._outHitInfo,i),-1!==xi._outHitInfo.distance&&xi._outHitInfo.distance<=i)){var l=new Mi;xi._outHitInfo.cloneTo(l),xi._outHitAllInfo.push(l)}}if(0==xi._outHitAllInfo.length)return t.sprite3D=null,void(t.distance=-1);for(var h=Number.MAX_VALUE,c=0,u=0;u<xi._outHitAllInfo.length;u++)xi._outHitAllInfo[u].distance<h&&(h=xi._outHitAllInfo[u].distance,c=u);xi._outHitAllInfo[c].cloneTo(t)},xi.rayCastAll=function(e,t,i,n){void 0===i&&(i=179e306),void 0===n&&(n=0),t.length=0;for(var a=Y.getLayerByNumber(n)._colliders,r=0,s=a.length;r<s;r++){var o=a[r];if(o.enable&&(xi._outHitInfo.distance=-1,xi._outHitInfo.sprite3D=null,o.raycast(e,xi._outHitInfo,i),-1!==xi._outHitInfo.distance&&xi._outHitInfo.distance<=i)){var l=new Mi;xi._outHitInfo.cloneTo(l),t.push(l)}}},xi._outHitAllInfo=[],xi._layerCollsionMatrix=[],u(xi,["_outHitInfo",function(){return this._outHitInfo=new Mi},"collisionManager",function(){return this.collisionManager=new Bi},"gravity",function(){return this.gravity=new ai(0,-9.81,0)}]),xi);function xi(){}var Ti=(f(wi,"laya.d3.utils.Picker"),wi.calculateCursorRay=function(e,t,i,n,a,r){var s=e.elements[0],o=e.elements[1],l=wi._tempVector30,h=l.elements;h[0]=s,h[1]=o,h[2]=t.minDepth;var c=wi._tempVector31,u=c.elements;u[0]=s,u[1]=o,u[2]=t.maxDepth;var d=r.origin,_=wi._tempVector32;t.unprojectFromWVP(l,i,n,a,d),t.unprojectFromWVP(c,i,n,a,_);var p=r.direction.elements;p[0]=_.x-d.x,p[1]=_.y-d.y,p[2]=_.z-d.z,ai.normalize(r.direction,r.direction)},wi.rayIntersectsPositionsAndIndices=function(e,t,i,n,a){for(var r=i.vertexStride/4,s=i.getVertexElementByUsage(0).offset/4,o=Number.MAX_VALUE,l=-1,h=-1,c=-1,u=0;u<n.length;u+=3){var d=wi._tempVector35,_=d.elements,p=n[u]*r,f=p+s;_[0]=t[f],_[1]=t[1+f],_[2]=t[2+f];var m=wi._tempVector36,g=m.elements,v=n[u+1]*r,y=v+s;g[0]=t[y],g[1]=t[1+y],g[2]=t[2+y];var C=wi._tempVector37,E=C.elements,S=n[u+2]*r,x=S+s;E[0]=t[x],E[1]=t[1+x],E[2]=t[2+x];var T=laya.d3.utils.Picker.rayIntersectsTriangle(e,d,m,C);!isNaN(T)&&T<o&&(o=T,l=p,h=v,c=S)}if(o===Number.MAX_VALUE)return a.position.toDefault(),a.distance=Number.MAX_VALUE,a.trianglePositions[0].toDefault(),a.trianglePositions[1].toDefault(),a.trianglePositions[2].toDefault(),a.triangleNormals[0].toDefault(),a.triangleNormals[1].toDefault(),a.triangleNormals[2].toDefault(),!1;a.distance=o,ai.scale(e.direction,o,a.position),ai.add(e.origin,a.position,a.position);var w=a.trianglePositions,M=w[0],b=w[1],R=w[2],L=M.elements,A=b.elements,I=R.elements,D=l+s;L[0]=t[D],L[1]=t[D+1],L[2]=t[D+2];var P=h+s;A[0]=t[P],A[1]=t[P+1],A[2]=t[P+2];var N=c+s;I[0]=t[N],I[1]=t[N+1],I[2]=t[N+2];var O=i.getVertexElementByUsage(3);if(O){var k=O.offset/4,V=a.triangleNormals,B=V[0],F=V[1],H=V[2],U=B.elements,G=F.elements,z=H.elements,W=l+k;U[0]=t[W],U[1]=t[W+1],U[2]=t[W+2];var X=h+k;G[0]=t[X],G[1]=t[X+1],G[2]=t[X+2];var j=c+k;z[0]=t[j],z[1]=t[j+1],z[2]=t[j+2]}return!0},wi.rayIntersectsTriangle=function(e,t,i,n){var a=wi._tempVector30,r=wi._tempVector31;ai.subtract(i,t,a),ai.subtract(n,t,r);var s,o=wi._tempVector32;if(ai.cross(e.direction,r,o),(s=ai.dot(a,o))>-Number.MIN_VALUE&&s<Number.MIN_VALUE)return Number.NaN;var l,h=1/s,c=wi._tempVector33;if(ai.subtract(e.origin,t,c),l=ai.dot(c,o),(l*=h)<0||1<l)return Number.NaN;var u,d,_=wi._tempVector34;return ai.cross(c,a,_),u=ai.dot(e.direction,_),(u*=h)<0||1<l+u?Number.NaN:(d=ai.dot(r,_),(d*=h)<0?Number.NaN:d)},u(wi,["_tempVector30",function(){return this._tempVector30=new ai},"_tempVector31",function(){return this._tempVector31=new ai},"_tempVector32",function(){return this._tempVector32=new ai},"_tempVector33",function(){return this._tempVector33=new ai},"_tempVector34",function(){return this._tempVector34=new ai},"_tempVector35",function(){return this._tempVector35=new ai},"_tempVector36",function(){return this._tempVector36=new ai},"_tempVector37",function(){return this._tempVector37=new ai}]),wi);function wi(){}var Mi=(f(bi,"laya.d3.utils.RaycastHit"),bi.prototype.cloneTo=function(e){e.distance=this.distance,this.trianglePositions[0].cloneTo(e.trianglePositions[0]),this.trianglePositions[1].cloneTo(e.trianglePositions[1]),this.trianglePositions[2].cloneTo(e.trianglePositions[2]),this.triangleNormals[0].cloneTo(e.triangleNormals[0]),this.triangleNormals[1].cloneTo(e.triangleNormals[1]),this.triangleNormals[2].cloneTo(e.triangleNormals[2]),this.position.cloneTo(e.position),e.sprite3D=this.sprite3D},bi);function bi(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new ai,new ai,new ai],this.trianglePositions.length=3,this.triangleNormals=[new ai,new ai,new ai],this.triangleNormals.length=3,this.position=new ai}var Ri=function(){function e(e,t){this._width=0,this._height=0,this._width=e,this._height=t}f(e,"laya.d3.utils.Size");var t=e.prototype;return v(0,t,"width",function(){return-1===this._width?se.clientWidth:this._width}),v(0,t,"height",function(){return-1===this._height?se.clientHeight:this._height}),v(1,e,"fullScreen",function(){return new e(-1,-1)}),e}(),Li=(f(Ai,"laya.d3.utils.Utils3D"),Ai._rotationTransformScaleSkinAnimation=function(e,t,i,n,a,r,s,o,l,h,c,u){var d,_,p,f,m,g=Ai._tempArray16_0,v=Ai._tempArray16_1,y=Ai._tempArray16_2,C=n+n,E=a+a,S=r+r,x=n*C,T=a*C,w=a*E,M=r*C,b=r*E,R=r*S,L=s*C,A=s*E,I=s*S;for(g[15]=1,g[0]=1-w-R,g[1]=T+I,g[2]=M-A,g[4]=T-I,g[5]=1-x-R,g[6]=b+L,g[8]=M+A,g[9]=b-L,g[10]=1-x-w,v[15]=1,v[0]=o,v[5]=l,v[10]=h,d=0;d<4;d++)_=g[d],p=g[d+4],f=g[d+8],m=g[d+12],y[d]=_,y[d+4]=p,y[d+8]=f,y[d+12]=_*e+p*t+f*i+m;for(d=0;d<4;d++)_=y[d],p=y[d+4],f=y[d+8],m=y[d+12],c[d+u]=_*v[0]+p*v[1]+f*v[2]+m*v[3],c[d+u+4]=_*v[4]+p*v[5]+f*v[6]+m*v[7],c[d+u+8]=_*v[8]+p*v[9]+f*v[10]+m*v[11],c[d+u+12]=_*v[12]+p*v[13]+f*v[14]+m*v[15]},Ai._createNodeByJson=function(e,t,i,n){if(!i)switch(t.type){case"Sprite3D":i=new xn;break;case"MeshSprite3D":i=new na;break;case"SkinnedMeshSprite3D":i=new ra;break;case"ShuriKenParticle3D":i=new aa;break;case"TrailSprite3D":i=new sa;break;case"Terrain":i=new ea;break;case"Camera":i=new ta;break;case"DirectionLight":i=new ia;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var a=t.props;if(a)for(var r in a)i[r]=a[r];var s=t.customProps;s&&(i instanceof laya.d3.core.Sprite3D?(i._parseBaseCustomProps(s),i._parseCustomProps(e,n,s,t),i._parseCustomComponent(e,n,t.components)):i._parseCustomProps(e,n,s,t));var o=t.child;if(o)for(var l=0,h=o.length;l<h;l++){var c=Ai._createNodeByJson(e,o[l],null,n);i.addChild(c)}return i},Ai._computeBoneAndAnimationDatasByBindPoseMatrxix=function(e,t,i,n,a,r){var s,o,l=0,h=0,c=e.length;for(s=0;s<c;l+=e[s].keyframeWidth,h+=16,s++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(t[l+0],t[l+1],t[l+2],t[l+3],t[l+4],t[l+5],t[l+6],t[l+7],t[l+8],t[l+9],n,h),0!=s&&(o=16*e[s].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,o,n,h,n,h));var u=i.length;for(s=0;s<u;s++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,16*r[s],i[s],a,16*s)},Ai._computeAnimationDatasByArrayAndMatrixFast=function(e,t,i,n){for(var a=0,r=e.length;a<r;a++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(t,16*n[a],e[a],i,16*a)},Ai._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(e,t,i,n,a){var r,s,o=0,l=0,h=e.length;for(r=0;r<h;o+=e[r].keyframeWidth,l+=16,r++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(t[o+7],t[o+8],t[o+9],t[o+3],t[o+4],t[o+5],t[o+6],t[o+0],t[o+1],t[o+2],n,l),0!=r&&(s=16*e[r].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,s,n,l,n,l));var c=i.length;for(r=0;r<c;r++){var u=16*r;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,u,i[r],a,u)}},Ai._computeAnimationDatasByArrayAndMatrixFastOld=function(e,t,i){for(var n=e.length,a=0;a<n;a++){var r=16*a;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(t,r,e[a],i,r)}},Ai._computeRootAnimationData=function(e,t,i){for(var n=0,a=0,r=0,s=e.length;n<s;a+=e[n].keyframeWidth,r+=16,n++)laya.d3.utils.Utils3D.createAffineTransformationArray(t[a+0],t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],t[a+7],t[a+8],t[a+9],i,r)},Ai.transformVector3ArrayByQuat=function(e,t,i,n,a){var r=i.elements,s=e[t],o=e[t+1],l=e[t+2],h=r[0],c=r[1],u=r[2],d=r[3],_=d*s+c*l-u*o,p=d*o+u*s-h*l,f=d*l+h*o-c*s,m=-h*s-c*o-u*l;n[a]=_*d+m*-h+p*-u-f*-c,n[a+1]=p*d+m*-c+f*-h-_*-u,n[a+2]=f*d+m*-u+_*-c-p*-h},Ai.mulMatrixByArray=function(e,t,i,n,a,r){var s,o,l,h,c;if(a===i){for(i=Ai._tempArray16_3,s=0;s<16;++s)i[s]=a[r+s];n=0}for(s=0;s<4;s++)o=e[t+s],l=e[t+s+4],h=e[t+s+8],c=e[t+s+12],a[r+s]=o*i[n+0]+l*i[n+1]+h*i[n+2]+c*i[n+3],a[r+s+4]=o*i[n+4]+l*i[n+5]+h*i[n+6]+c*i[n+7],a[r+s+8]=o*i[n+8]+l*i[n+9]+h*i[n+10]+c*i[n+11],a[r+s+12]=o*i[n+12]+l*i[n+13]+h*i[n+14]+c*i[n+15]},Ai.mulMatrixByArrayFast=function(e,t,i,n,a,r){var s,o,l,h,c;for(s=0;s<4;s++)o=e[t+s],l=e[t+s+4],h=e[t+s+8],c=e[t+s+12],a[r+s]=o*i[n+0]+l*i[n+1]+h*i[n+2]+c*i[n+3],a[r+s+4]=o*i[n+4]+l*i[n+5]+h*i[n+6]+c*i[n+7],a[r+s+8]=o*i[n+8]+l*i[n+9]+h*i[n+10]+c*i[n+11],a[r+s+12]=o*i[n+12]+l*i[n+13]+h*i[n+14]+c*i[n+15]},Ai.mulMatrixByArrayAndMatrixFast=function(e,t,i,n,a){var r,s,o,l,h,c=i.elements,u=c[0],d=c[1],_=c[2],p=c[3],f=c[4],m=c[5],g=c[6],v=c[7],y=c[8],C=c[9],E=c[10],S=c[11],x=c[12],T=c[13],w=c[14],M=c[15],b=t,R=t+4,L=t+8,A=t+12,I=a,D=a+4,P=a+8,N=a+12;for(r=0;r<4;r++)s=e[b+r],o=e[R+r],l=e[L+r],h=e[A+r],n[I+r]=s*u+o*d+l*_+h*p,n[D+r]=s*f+o*m+l*g+h*v,n[P+r]=s*y+o*C+l*E+h*S,n[N+r]=s*x+o*T+l*w+h*M},Ai.createAffineTransformationArray=function(e,t,i,n,a,r,s,o,l,h,c,u){var d=n+n,_=a+a,p=r+r,f=n*d,m=n*_,g=n*p,v=a*_,y=a*p,C=r*p,E=s*d,S=s*_,x=s*p;c[u+0]=(1-(v+C))*o,c[u+1]=(m+x)*o,c[u+2]=(g-S)*o,c[u+3]=0,c[u+4]=(m-x)*l,c[u+5]=(1-(f+C))*l,c[u+6]=(y+E)*l,c[u+7]=0,c[u+8]=(g+S)*h,c[u+9]=(y-E)*h,c[u+10]=(1-(f+v))*h,c[u+11]=0,c[u+12]=e,c[u+13]=t,c[u+14]=i,c[u+15]=1},Ai.transformVector3ArrayToVector3ArrayCoordinate=function(e,t,i,n,a){var r=Ai._tempArray4_0,s=e[t+0],o=e[t+1],l=e[t+2],h=i.elements;r[0]=s*h[0]+o*h[4]+l*h[8]+h[12],r[1]=s*h[1]+o*h[5]+l*h[9]+h[13],r[2]=s*h[2]+o*h[6]+l*h[10]+h[14],r[3]=1/(s*h[3]+o*h[7]+l*h[11]+h[15]),n[a+0]=r[0]*r[3],n[a+1]=r[1]*r[3],n[a+2]=r[2]*r[3]},Ai.transformLightingMapTexcoordByUV0Array=function(e,t,i,n,a){var r=i.elements;n[a+0]=e[t+0]*r[0]+r[2],n[a+1]=(e[t+1]-1)*r[1]+r[3]},Ai.transformLightingMapTexcoordByUV1Array=function(e,t,i,n,a){var r=i.elements;n[a+0]=e[t+0]*r[0]+r[2],n[a+1]=1+e[t+1]*r[1]+r[3]},Ai.getURLVerion=function(e){var t=e.indexOf("?");return 0<=t?e.substr(t):null},Ai._quaternionCreateFromYawPitchRollArray=function(e,t,i,n){var a=.5*i,r=.5*t,s=.5*e,o=Math.sin(a),l=Math.cos(a),h=Math.sin(r),c=Math.cos(r),u=Math.sin(s),d=Math.cos(s);n[0]=d*h*l+u*c*o,n[1]=u*c*l-d*h*o,n[2]=d*c*o-u*h*l,n[3]=d*c*l+u*h*o},Ai._createAffineTransformationArray=function(e,t,i,n){var a=t[0],r=t[1],s=t[2],o=t[3],l=a+a,h=r+r,c=s+s,u=a*l,d=a*h,_=a*c,p=r*h,f=r*c,m=s*c,g=o*l,v=o*h,y=o*c,C=i[0],E=i[1],S=i[2];n[0]=(1-(p+m))*C,n[1]=(d+y)*C,n[2]=(_-v)*C,n[3]=0,n[4]=(d-y)*E,n[5]=(1-(u+m))*E,n[6]=(f+g)*E,n[7]=0,n[8]=(_+v)*S,n[9]=(f-g)*S,n[10]=(1-(u+p))*S,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1},Ai._mulMatrixArray=function(e,t,i,n){var a,r,s,o,l,h=t.elements,c=h[0],u=h[1],d=h[2],_=h[3],p=h[4],f=h[5],m=h[6],g=h[7],v=h[8],y=h[9],C=h[10],E=h[11],S=h[12],x=h[13],T=h[14],w=h[15],M=n,b=n+4,R=n+8,L=n+12;for(a=0;a<4;a++)r=e[a],s=e[a+4],o=e[a+8],l=e[a+12],i[M+a]=r*c+s*u+o*d+l*_,i[b+a]=r*p+s*f+o*m+l*g,i[R+a]=r*v+s*y+o*C+l*E,i[L+a]=r*S+s*x+o*T+l*w},Ai.getYawPitchRoll=function(e,t){Ai.transformQuat(ai.ForwardRH,e,Jt.TEMPVector31),Ai.transformQuat(ai.Up,e,Jt.TEMPVector32);var i=Jt.TEMPVector32.elements;Ai.angleTo(ai.ZERO,Jt.TEMPVector31,Jt.TEMPVector33);var n=Jt.TEMPVector33.elements;n[0]==Math.PI/2?(n[1]=Ai.arcTanAngle(i[2],i[0]),n[2]=0):n[0]==-Math.PI/2?(n[1]=Ai.arcTanAngle(-i[2],-i[0]),n[2]=0):(qt.createRotationY(-n[1],Jt.TEMPMatrix0),qt.createRotationX(-n[0],Jt.TEMPMatrix1),ai.transformCoordinate(Jt.TEMPVector32,Jt.TEMPMatrix0,Jt.TEMPVector32),ai.transformCoordinate(Jt.TEMPVector32,Jt.TEMPMatrix1,Jt.TEMPVector32),n[2]=Ai.arcTanAngle(i[1],-i[0])),n[1]<=-Math.PI&&(n[1]=Math.PI),n[2]<=-Math.PI&&(n[2]=Math.PI),n[1]>=Math.PI&&n[2]>=Math.PI&&(n[1]=0,n[2]=0,n[0]=Math.PI-n[0]),t[0]=n[1],t[1]=n[0],t[2]=n[2]},Ai.arcTanAngle=function(e,t){return 0==e?1==t?Math.PI/2:-Math.PI/2:0<e?Math.atan(t/e):e<0?0<t?Math.atan(t/e)+Math.PI:Math.atan(t/e)-Math.PI:0},Ai.angleTo=function(e,t,i){ai.subtract(t,e,Jt.TEMPVector30),ai.normalize(Jt.TEMPVector30,Jt.TEMPVector30),i.elements[0]=Math.asin(Jt.TEMPVector30.y),i.elements[1]=Ai.arcTanAngle(-Jt.TEMPVector30.z,-Jt.TEMPVector30.x)},Ai.transformQuat=function(e,t,i){var n=i.elements,a=e.elements,r=t,s=a[0],o=a[1],l=a[2],h=r[0],c=r[1],u=r[2],d=r[3],_=d*s+c*l-u*o,p=d*o+u*s-h*l,f=d*l+h*o-c*s,m=-h*s-c*o-u*l;n[0]=_*d+m*-h+p*-u-f*-c,n[1]=p*d+m*-c+f*-h-_*-u,n[2]=f*d+m*-u+_*-c-p*-h},Ai.quaterionNormalize=function(e,t){var i=e[0],n=e[1],a=e[2],r=e[3],s=i*i+n*n+a*a+r*r;0<s&&(s=1/Math.sqrt(s),t[0]=i*s,t[1]=n*s,t[2]=a*s,t[3]=r*s)},Ai.matrix4x4MultiplyFFF=function(e,t,i){var n,a,r,s,o;if(i===t)for(t=new Float32Array(16),n=0;n<16;++n)t[n]=i[n];for(n=0;n<4;n++)a=e[n],r=e[n+4],s=e[n+8],o=e[n+12],i[n]=a*t[0]+r*t[1]+s*t[2]+o*t[3],i[n+4]=a*t[4]+r*t[5]+s*t[6]+o*t[7],i[n+8]=a*t[8]+r*t[9]+s*t[10]+o*t[11],i[n+12]=a*t[12]+r*t[13]+s*t[14]+o*t[15]},Ai.matrix4x4MultiplyMFM=function(e,t,i){Ai.matrix4x4MultiplyFFF(e.elements,t,i.elements)},u(Ai,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new ai},"_tempVector3_1",function(){return this._tempVector3_1=new ai},"_tempVector3_2",function(){return this._tempVector3_2=new ai},"_tempVector3_3",function(){return this._tempVector3_3=new ai},"_tempVector3_4",function(){return this._tempVector3_4=new ai},"_tempVector3_5",function(){return this._tempVector3_5=new ai},"_tempVector3_6",function(){return this._tempVector3_6=new ai},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),Ai);function Ai(){}var Ii=(f(Di,"Laya3D"),Di._cancelLoadByUrl=function(e){x.loader.cancelLoadByUrl(e),Di._innerFirstLevelLoaderManager.cancelLoadByUrl(e),Di._innerSecondLevelLoaderManager.cancelLoadByUrl(e),Di._innerThirdLevelLoaderManager.cancelLoadByUrl(e),Di._innerFourthLevelLoaderManager.cancelLoadByUrl(e)},Di._changeWebGLSize=function(e,t){I.onStageResize(e,t),se.clientWidth=e,se.clientHeight=t},Di.__init__=function(){var e=r.createMap;e.lh=[xn,"SPRITE3DHIERARCHY"],e.ls=[Sn,"SPRITE3DHIERARCHY"],e.lm=[Wn,"MESH"],e.lmat=[In,"MATERIAL"],e.lpbr=[Rn,"MATERIAL"],e.ltc=[qn,"TEXTURECUBE"],e.jpg=[Kn,"nativeimage"],e.jpeg=[Kn,"nativeimage"],e.png=[Kn,"nativeimage"],e.pkm=[Kn,"arraybuffer"],e.lsani=[a,"arraybuffer"],e.lrani=[a,"arraybuffer"],e.raw=[Gn,"arraybuffer"],e.mipmaps=[Gn,"arraybuffer"],e.thdata=[nn,"arraybuffer"],e.lt=[sn,"TERRAIN"],e.lani=[Qi,"arraybuffer"],e.lav=[$i,"json"],e.ani=[a,"arraybuffer"],Me.parserMap.SPRITE3DHIERARCHY=Di._loadHierarchy,Me.parserMap.MESH=Di._loadMesh,Me.parserMap.MATERIAL=Di._loadMaterial,Me.parserMap.TEXTURECUBE=Di._loadTextureCube,Me.parserMap.TERRAIN=Di._loadTerrain,Di._innerFirstLevelLoaderManager.on("error",null,Di._eventLoadManagerError),Di._innerSecondLevelLoaderManager.on("error",null,Di._eventLoadManagerError),Di._innerThirdLevelLoaderManager.on("error",null,Di._eventLoadManagerError),Di._innerFourthLevelLoaderManager.on("error",null,Di._eventLoadManagerError)},Di.READ_BLOCK=function(){return Di._readData.pos+=4,!0},Di.READ_DATA=function(){return Di._DATA.offset=Di._readData.getUint32(),Di._DATA.size=Di._readData.getUint32(),!0},Di.READ_STRINGS=function(){var e=[],t={offset:0,size:0};t.offset=Di._readData.getUint16(),t.size=Di._readData.getUint16(),Di._readData.pos,Di._readData.pos=t.offset+Di._DATA.offset;for(var i=0;i<t.size;i++){var n=Di._readData.readUTFString();-1===n.lastIndexOf(".lmat")&&-1===n.lastIndexOf(".lpbr")||e.push(n)}return e},Di.formatRelativePath=function(e,t){var i;if("."===t.charAt(0)){for(var n=(e+t).split("/"),a=0,r=n.length;a<r;a++)if(".."==n[a]){var s=a-1;0<s&&".."!==n[s]&&(n.splice(s,2),a-=2)}i=n.join("/")}else i=e+t;return null!=L.customFormat&&(i=L.customFormat(i,null)),i},Di._eventLoadManagerError=function(e){x.loader.event("error",e)},Di._addHierarchyInnerUrls=function(e,t,i,n,a,r){var s=Di.formatRelativePath(n,a);i&&(s+=i),e.push({url:s,clas:r}),t[a]=s},Di._getSprite3DHierarchyInnerUrls=function(e,t,i,n,a,r,s){var o,l=0,h=0;switch(e.type){case"Scene":var c=e.customProps.lightmaps;for(l=0,h=c.length;l<h;l++){var u=c[l].replace(".exr",".png");Di._addHierarchyInnerUrls(n,a,r,s,u,Kn)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var d;if(e.instanceParams)(d=e.instanceParams.loadPath)&&Di._addHierarchyInnerUrls(t,a,r,s,d,Wn);else{(d=(o=e.customProps).meshPath)&&Di._addHierarchyInnerUrls(t,a,r,s,d,Wn);var _=o.materials;if(_)for(l=0,h=_.length;l<h;l++){var p=_[l],f=p.type.split("."),m=R.window;if(f.forEach(function(e){m=m[e]}),"function"!=typeof m)throw"_getSprite3DHierarchyInnerUrls 错误: "+p.type+" 不是类";Di._addHierarchyInnerUrls(i,a,r,s,p.path,m)}}break;case"ShuriKenParticle3D":var g=(o=e.customProps).meshPath;g&&Di._addHierarchyInnerUrls(t,a,r,s,g,Wn);var v=o.material;if(v)f=v.type.split("."),m=R.window,f.forEach(function(e){m=m[e]}),Di._addHierarchyInnerUrls(i,a,r,s,v.path,m);else{var y=o.materialPath;if(y)Di._addHierarchyInnerUrls(i,a,r,s,y,kn);else{var C=o.texturePath;C&&Di._addHierarchyInnerUrls(n,a,r,s,C,Kn)}}break;case"Terrain":Di._addHierarchyInnerUrls(n,a,r,s,e.customProps.dataPath,sn)}var E=e.components;for(var S in E){var x=E[S];switch(S){case"Animator":var T=x.avatarPath;if(T)Di._addHierarchyInnerUrls(n,a,r,s,T,$i);else{var w=x.avatar;w&&Di._addHierarchyInnerUrls(n,a,r,s,w.path,$i)}var M=x.clipPaths;for(l=0,h=M.length;l<h;l++)Di._addHierarchyInnerUrls(n,a,r,s,M[l],Qi)}}var b=e.child;for(l=0,h=b.length;l<h;l++)Di._getSprite3DHierarchyInnerUrls(b[l],t,i,n,a,r,s)},Di._loadHierarchy=function(e){e.on("loaded",null,Di._onHierarchylhLoaded,[e,e._class._getGroup()]),e.load(e.url,"json",!1,null,!0)},Di._onHierarchylhLoaded=function(e,t,i){if(e._class.destroyed)e.endLoad();else{var n=e.url,a=Li.getURLVerion(n),r=L.getPath(n),s=[],o=[],l=[],h={};Di._getSprite3DHierarchyInnerUrls(i,s,o,l,h,a,r);var c=s.length+o.length+l.length,u=c+1,d=1/u;if(Di._onProcessChange(e,0,d,1),0<l.length){var _=c/u,p=b.create(null,Di._onProcessChange,[e,d,_],!1);Di._innerFourthLevelLoaderManager.create(l,b.create(null,Di._onHierarchyInnerForthLevResouLoaded,[e,t,p,i,h,s,o,d+_*l.length,_]),p,null,null,1,!0,t)}else Di._onHierarchyInnerForthLevResouLoaded(e,t,null,i,h,s,o,d,_)}},Di._onHierarchyInnerForthLevResouLoaded=function(e,t,i,n,a,r,s,o,l){if(e._class.destroyed)e.endLoad();else if(i&&i.recover(),0<s.length){var h=b.create(null,Di._onProcessChange,[e,o,l],!1);Di._innerSecondLevelLoaderManager.create(s,b.create(null,Di._onHierarchyInnerSecondLevResouLoaded,[e,t,h,n,a,r,o+l*s.length,l]),i,null,null,1,!0,t)}else Di._onHierarchyInnerSecondLevResouLoaded(e,t,null,n,a,r,o,l)},Di._onHierarchyInnerSecondLevResouLoaded=function(e,t,i,n,a,r,s,o){if(e._class.destroyed)e.endLoad();else if(i&&i.recover(),0<r.length){var l=b.create(null,Di._onProcessChange,[e,s,o],!1);Di._innerFirstLevelLoaderManager.create(r,b.create(null,Di._onHierarchyInnerFirstLevResouLoaded,[e,l,n,a]),i,null,null,1,!0,t)}else Di._onHierarchyInnerFirstLevResouLoaded(e,null,n,a)},Di._onHierarchyInnerFirstLevResouLoaded=function(e,t,i,n){t&&t.recover(),e.endLoad([i,n])},Di._loadTerrain=function(e){e.on("loaded",null,Di._onTerrainLtLoaded,[e,e._class._getGroup()]),e.load(e.url,"json",!1,null,!0)},Di._onTerrainLtLoaded=function(e,t,i){if(e._class.destroyed)e.endLoad();else{var n,a,r=e.url,s=Li.getURLVerion(r),o=L.getPath(r),l=[],h={},c=0,u=0,d=i.heightData;n=d.url,a=Di.formatRelativePath(o,n),s&&(a+=s),n=h[n]=a;var _=i.detailTexture;for(c=0,u=_.length;c<u;c++)l.push({url:_[c].diffuse});var p=i.normalMap;for(c=0,u=p.length;c<u;c++)l.push({url:p[c]});var f=i.alphaMap;for(c=0,u=f.length;c<u;c++)l.push({url:f[c],params:[!1,!1,6408,!0]});for(c=0,u=l.length;c<u;c++){var m=l[c].url;a=Di.formatRelativePath(o,m),s&&(a+=s),l[c].url=a,h[m]=a}var g=l.length,v=g+2,y=1/v;Di._onProcessChange(e,0,y,1);var C={heightMapLoaded:!1,texturesLoaded:!1},E=b.create(null,Di._onProcessChange,[e,y,y],!1);Di._innerFourthLevelLoaderManager.create(n,b.create(null,Di._onTerrainHeightMapLoaded,[e,E,i,h,C]),E,null,[d.numX,d.numZ,d.bitType,d.value],1,!0,t);var S=b.create(null,Di._onProcessChange,[e,2*y,g/v],!1);Di._innerFourthLevelLoaderManager.create(l,b.create(null,Di._onTerrainTexturesLoaded,[e,S,i,h,C]),S,null,null,1,!0,t)}},Di._onTerrainHeightMapLoaded=function(e,t,i,n,a){a.heightMapLoaded=!0,a.texturesLoaded&&(e.endLoad([i,n]),t.recover())},Di._onTerrainTexturesLoaded=function(e,t,i,n,a){a.texturesLoaded=!0,a.heightMapLoaded&&(e.endLoad([i,n]),t.recover())},Di._loadMesh=function(e){e.on("loaded",null,Di._onMeshLmLoaded,[e,e._class._getGroup()]),e.load(e.url,"arraybuffer",!1,null,!0)},Di._onMeshLmLoaded=function(e,t,i){if(e._class.destroyed)e.endLoad();else{var n,a,r,s=e.url,o=Li.getURLVerion(s),l=L.getPath(s),h={},c=0,u=0;switch((Di._readData=new C(i)).pos=0,Di._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var d=Di._readData.getUint32();Di._readData.pos=Di._readData.pos+4,u=Di._readData.getUint16(),Di._readData.pos=Di._readData.pos+8*u;var _=Di._readData.getUint32();for(u=Di._readData.getUint16(),Di._readData.pos=d+_,n=[],c=0;c<u;c++){var p=Di._readData.readUTFString();-1!==p.lastIndexOf(".lmat")&&n.push(p)}break;default:for(Di.READ_BLOCK(),c=0;c<2;c++){var f=Di._readData.getUint16(),m=Di._strings[f],g=Di["READ_"+m];if(null==g)throw new Error("model file err,no this function:"+f+" "+m);1===c?n=g.call():g.call()}}for(c=0,r=n.length;c<r;c++){var v=n[c];a=Di.formatRelativePath(l,v),o&&(a+=o),n[c]=a,h[v]=a}if(0<n.length){Di._onProcessChange(e,0,.5,1);var y=b.create(null,Di._onProcessChange,[e,.5,.5],!1);Di._innerSecondLevelLoaderManager.create(n,b.create(null,Di._onMeshMateialLoaded,[e,y,i,h]),y,null,null,1,!0,t)}else e.endLoad([i,h])}},Di._onMeshMateialLoaded=function(e,t,i,n){e.endLoad([i,n]),t.recover()},Di._getMaterialTexturePath=function(e,t,i){var n=e.length-4;return e.indexOf(".dds")!=n&&e.indexOf(".tga")!=n&&e.indexOf(".exr")!=n&&e.indexOf(".DDS")!=n&&e.indexOf(".TGA")!=n&&e.indexOf(".EXR")!=n||(e=e.substr(0,n)+".png"),e=Di.formatRelativePath(i,e),t&&(e+=t),e},Di._loadMaterial=function(e){e.on("loaded",null,Di._onMaterilLmatLoaded,[e,e._class._getGroup()]),e.load(e.url,"json",!1,null,!0)},Di._onMaterilLmatLoaded=function(e,t,i){if(e._class.destroyed)e.endLoad();else{var n,a=e.url,r=Li.getURLVerion(a),s=L.getPath(a),o=[],l={},h=i.customProps,c=i.version;if(c)switch(c){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var u=i.props.textures,d=0,_=u.length;d<_;d++){var p=u[d],f=p.path;if(f){var m=f.length-4;f.indexOf(".exr")!=m&&f.indexOf(".EXR")!=m||(f=f.substr(0,m)+".png"),n=Di.formatRelativePath(s,f),r&&(n+=r),o.push({url:n,params:p.params}),l[f]=n}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var g=h.diffuseTexture.texture2D;if(g&&(n=Di._getMaterialTexturePath(g,r,s),o.push(n),l[g]=n),h.normalTexture){var v=h.normalTexture.texture2D;v&&(n=Di._getMaterialTexturePath(v,r,s),o.push(n),l[v]=n)}if(h.specularTexture){var y=h.specularTexture.texture2D;y&&(n=Di._getMaterialTexturePath(y,r,s),o.push(n),l[y]=n)}if(h.emissiveTexture){var C=h.emissiveTexture.texture2D;C&&(n=Di._getMaterialTexturePath(C,r,s),o.push(n),l[C]=n)}if(h.ambientTexture){var E=h.ambientTexture.texture2D;E&&(n=Di._getMaterialTexturePath(E,r,s),o.push(n),l[E]=n)}if(h.reflectTexture){var S=h.reflectTexture.texture2D;S&&(n=Di._getMaterialTexturePath(S,r,s),o.push(n),l[S]=n)}}var x=o.length,T=x+1,w=1/T;if(Di._onProcessChange(e,0,w,1),0<x){var M=b.create(null,Di._onProcessChange,[e,w,x/T],!1);Di._innerFourthLevelLoaderManager.create(o,b.create(null,Di._onMateialTexturesLoaded,[e,M,i,l]),M,Kn,null,1,!0,t)}else Di._onMateialTexturesLoaded(e,null,i,null)}},Di._onMateialTexturesLoaded=function(e,t,i,n){e.endLoad([i,n]),t&&t.recover()},Di._loadTextureCube=function(e){e.on("loaded",null,Di._onTextureCubeLtcLoaded,[e]),e.load(e.url,"json",!1,null,!0)},Di._onTextureCubeLtcLoaded=function(e,t){if(e._class.destroyed)e.endLoad();else{var i=L.getPath(e.url),n=[Di.formatRelativePath(i,t.px),Di.formatRelativePath(i,t.nx),Di.formatRelativePath(i,t.py),Di.formatRelativePath(i,t.ny),Di.formatRelativePath(i,t.pz),Di.formatRelativePath(i,t.nz)];Di._onProcessChange(e,0,1/7,1);var a=b.create(null,Di._onProcessChange,[e,1/7,6/7],!1);Di._innerFourthLevelLoaderManager.load(n,b.create(null,Di._onTextureCubeImagesLoaded,[e,n,a]),a,"nativeimage")}},Di._onTextureCubeImagesLoaded=function(e,t,i){var n=[];n.length=6;for(var a=0;a<6;a++){var r=t[a];n[a]=Me.getRes(r),Me.clearRes(r)}e.endLoad(n),i.recover()},Di._onProcessChange=function(e,t,i,n){(n=t+n*i)<1&&e.event("progress",n)},Di.init=function(e,t,i,n,a,r){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===a&&(a=!0),void 0===r&&(r=!0),y.update3DLoop=function(){Bi._triggerCollision()},y.cancelLoadByUrl=function(e){Di._cancelLoadByUrl(e)},h.isAntialias=i,h.isAlpha=n,h.premultipliedAlpha=a,h.isStencil=r,I.enable()?(y.changeWebGLSize=Di._changeWebGLSize,_.is3DMode=!0,x.init(e,t),Y.__init__(),Si.__init__(),Mn.__init__(),ui.__init__(),na.__init__(),U.__init__(),Di.__init__(),s.maxTextureCount=2,(Di.debugMode||le.debugMode)&&(Di._debugPhasorSprite=new ne)):alert("Laya3D init error,must support webGL!")},Di.HIERARCHY="SPRITE3DHIERARCHY",Di.MESH="MESH",Di.MATERIAL="MATERIAL",Di.PBRMATERIAL="PBRMTL",Di.TEXTURECUBE="TEXTURECUBE",Di.TERRAIN="TERRAIN",Di._readData=null,Di._debugPhasorSprite=null,Di.debugMode=!1,u(Di,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new r},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new r},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new r},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new r}]),Di);function Di(){}var Pi=function(){function a(e){a.__super.call(this),this._owner=e,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}f(a,"laya.d3.animation.AnimationTransform3D",i);var e=a.prototype;return e._getlocalMatrix=function(){return this._localUpdate&&(Li._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},e._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var e=0,t=this._childs.length;e<t;e++)this._childs[e]._onWorldTransform()}},e._setWorldMatrixAndUpdate=function(e){if(this._worldMatrix=e,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var t=this._getlocalMatrix(),i=0;i<16;++i)this._worldMatrix[i]=t[i];else Li.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},e._setWorldMatrixNoUpdate=function(e){this._worldMatrix=e},e._setWorldMatrixIgnoreUpdate=function(e){this._worldMatrix=e,this._worldUpdate=!1},e.getLocalPosition=function(){return this._localPosition},e.setLocalPosition=function(e){if(this._parent)this._localPosition=e,this._localUpdate=!0,this._onWorldTransform();else{var t=this._entity.owner._transform,i=this._entity.localPosition,n=i.elements;n[0]=e[0],n[1]=e[1],n[2]=e[2],t.localPosition=i}},e.getLocalRotation=function(){if(this._localQuaternionUpdate){var e=this._localRotationEuler;Li._quaternionCreateFromYawPitchRollArray(e[1]/a._angleToRandin,e[0]/a._angleToRandin,e[2]/a._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},e.setLocalRotation=function(e){if(this._parent)this._localRotation=e,Li.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var t=this._entity.owner._transform,i=this._entity.localRotation,n=i.elements;n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],t.localRotation=i}},e.getLocalScale=function(){return this._localScale},e.setLocalScale=function(e){if(this._parent)this._localScale=e,this._localUpdate=!0,this._onWorldTransform();else{var t=this._entity.owner._transform,i=this._entity.localScale,n=i.elements;n[0]=e[0],n[1]=e[1],n[2]=e[2],t.localScale=i}},e.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){Li.getYawPitchRoll(this._localRotation,a._tempVector3);var e=a._tempVector3,t=this._localRotationEuler;t[0]=e[1]*a._angleToRandin,t[1]=e[0]*a._angleToRandin,t[2]=e[2]*a._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},e.setLocalRotationEuler=function(e){if(this._parent)Li._quaternionCreateFromYawPitchRollArray(e[1]/a._angleToRandin,e[0]/a._angleToRandin,e[2]/a._angleToRandin,this._localRotation),this._localRotationEuler=e,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var t=this._entity.owner._transform,i=this._entity.localRotationEuler,n=i.elements;n[0]=e[0],n[1]=e[1],n[2]=e[2],t.localRotationEuler=i}},e.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)Li.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var e=this._getlocalMatrix(),t=0;t<16;++t)this._worldMatrix[t]=e[t];this._worldUpdate=!1}return this._worldMatrix},e.setParent=function(e){if(this._parent!==e){if(this._parent){var t=this._parent._childs,i=t.indexOf(this);t.splice(i,1)}e&&(e._childs.push(this),e&&this._onWorldTransform()),this._parent=e}},u(a,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),a}(),Ni=function(){function e(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,e.__super.call(this),this._destroyed=!1,this._id=e._uniqueIDCounter,e._uniqueIDCounter++}f(e,"laya.d3.component.Component3D",i);var t=e.prototype;return x.imps(t,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),t._initialize=function(e){this._owner=e,this._enable=!0,this.started=!1,this._load(e)},t._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},t._load=function(e){},t._start=function(e){},t._update=function(e){},t._lateUpdate=function(e){},t._preRenderUpdate=function(e){},t._postRenderUpdate=function(e){},t._unload=function(e){this.offAll()},t._cloneTo=function(e){},v(0,t,"id",function(){return this._id}),v(0,t,"destroyed",function(){return this._destroyed}),v(0,t,"owner",function(){return this._owner}),v(0,t,"enable",function(){return this._enable},function(e){this._enable!==e&&(this._enable=e,this.event("enablechanged",this._enable))}),v(0,t,"isSingleton",function(){return e._isSingleton}),e._isSingleton=!0,e._uniqueIDCounter=1,e}(),Oi=function(){function e(){this._destroyed=!1,e.__super.call(this),this._destroyed=!1}f(e,"laya.d3.core.GeometryFilter",i);var t=e.prototype;return x.imps(t,{"laya.resource.IDestroy":!0}),t._destroy=function(){this.offAll(),this._destroyed=!0},v(0,t,"_isAsyncLoaded",function(){return!0}),v(0,t,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),v(0,t,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),v(0,t,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),v(0,t,"destroyed",function(){return this._destroyed}),e}(),ki=function(){function n(e){n.__super.call(this),this._id=++n._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new Ht(new ai,new ai),this._boundingBoxCenter=new ai,this._boundingSphere=new Gt(new ai,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=e,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}f(n,"laya.d3.core.render.BaseRender",i);var e=n.prototype;return x.imps(e,{"laya.resource.IDestroy":!0}),e._changeMaterialReference=function(e,t){e&&e._removeReference(),t._addReference()},e._getInstanceMaterial=function(e,t){var i=new e.constructor;return e.cloneTo(i),i.name=i.name+"(Instance)",this._materialsInstance[t]=!0,this._changeMaterialReference(this._materials[t],i),this._materials[t]=i},e._setShaderValuelightMap=function(e){this._setShaderValueTexture(3,e)},e._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},e._renderRenderableBoundBox=function(){var e=Ii._debugPhasorSprite,t=this.boundingBox,i=n._tempBoundBoxCorners;t.getCorners(i),e.line(i[0],n._greenColor,i[1],n._greenColor),e.line(i[2],n._greenColor,i[3],n._greenColor),e.line(i[4],n._greenColor,i[5],n._greenColor),e.line(i[6],n._greenColor,i[7],n._greenColor),e.line(i[0],n._greenColor,i[3],n._greenColor),e.line(i[1],n._greenColor,i[2],n._greenColor),e.line(i[2],n._greenColor,i[6],n._greenColor),e.line(i[3],n._greenColor,i[7],n._greenColor),e.line(i[0],n._greenColor,i[4],n._greenColor),e.line(i[1],n._greenColor,i[5],n._greenColor),e.line(i[4],n._greenColor,i[7],n._greenColor),e.line(i[5],n._greenColor,i[6],n._greenColor)},e._calculateBoundingSphere=function(){throw"BaseRender: must override it."},e._calculateBoundingBox=function(){throw"BaseRender: must override it."},e._setShaderValueTexture=function(e,t){this._owner._shaderValues.setValue(e,t)},e._setShaderValueMatrix4x4=function(e,t){this._owner._shaderValues.setValue(e,t?t.elements:null)},e._setShaderValueColor=function(e,t){this._owner._shaderValues.setValue(e,t?t.elements:null)},e._setShaderValueBuffer=function(e,t){this._owner._shaderValues.setValue(e,t)},e._setShaderValueInt=function(e,t){this._owner._shaderValues.setValue(e,t)},e._setShaderValueBool=function(e,t){this._owner._shaderValues.setValue(e,t)},e._setShaderValueNumber=function(e,t){this._owner._shaderValues.setValue(e,t)},e._setShaderValueVector2=function(e,t){this._owner._shaderValues.setValue(e,t?t.elements:null)},e._addShaderDefine=function(e){this._owner._shaderDefineValue|=e},e._removeShaderDefine=function(e){this._owner._shaderDefineValue&=~e},e._renderUpdate=function(e){return!0},e._applyLightMapParams=function(){if(0<=this._lightmapIndex){var e=this._owner.scene;if(e){var t=e.getlightmaps()[this._lightmapIndex];t?(this._addShaderDefine($n.SAHDERDEFINE_LIGHTMAP),t.loaded?this._setShaderValuelightMap(t):t.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine($n.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($n.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($n.SAHDERDEFINE_LIGHTMAP)},e._updateOctreeNode=function(){var e=this._treeNode;e&&this._octreeNodeNeedChange&&(e.updateObject(this),this._octreeNodeNeedChange=!1)},e._destroy=function(){this.offAll();var e=0,t=0;for(e=0,t=this._renderElements.length;e<t;e++)this._renderElements[e]._destroy();for(e=0,t=this._materials.length;e<t;e++)this._materials[e]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},v(0,e,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),v(0,e,"id",function(){return this._id}),v(0,e,"material",function(){var e=this._materials[0];if(e&&!this._materialsInstance[0]){var t=this._getInstanceMaterial(e,0);this.event("materialchanged",[this,0,t])}return this._materials[0]},function(e){this.sharedMaterial=e}),v(0,e,"sharedMaterial",function(){return this._materials[0]},function(e){var t=this._materials[0];t!==e&&(this._materials[0]=e,this._materialsInstance[0]=!1,this._changeMaterialReference(t,e),this.event("materialchanged",[this,0,e]))}),v(0,e,"lightmapIndex",function(){return this._lightmapIndex},function(e){this._lightmapIndex=e,this._applyLightMapParams()}),v(0,e,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(e){this._lightmapScaleOffset=e,this._setShaderValueColor(2,e),this._addShaderDefine($n.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),v(0,e,"enable",function(){return this._enable},function(e){this._enable=e,this.event("enablechanged",[this,e])}),v(0,e,"materials",function(){for(var e=0,t=this._materials.length;e<t;e++)if(!this._materialsInstance[e]){var i=this._getInstanceMaterial(this._materials[e],e);this.event("materialchanged",[this,e,i])}return this._materials.slice()},function(e){this.sharedMaterials=e}),v(0,e,"sharedMaterials",function(){return this._materials.slice()},function(e){if(!e)throw new Error("MeshRender: shadredMaterials value can't be null.");var t=e.length;this._materialsInstance.length=t;for(var i=0;i<t;i++){var n=this._materials[i];n!==e[i]&&(this._materialsInstance[i]=!1,this._changeMaterialReference(n,e[i]),this.event("materialchanged",[this,i,e[i]]))}this._materials=e}),v(0,e,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),v(0,e,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var e=this.boundingBox;ai.add(e.min,e.max,this._boundingBoxCenter),ai.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),v(0,e,"receiveShadow",function(){return this._receiveShadow},function(e){this._receiveShadow!==e&&((this._receiveShadow=e)?this._addShaderDefine(pi.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(pi.SHADERDEFINE_RECEIVE_SHADOW))}),v(0,e,"destroyed",function(){return this._destroyed}),n._uniqueIDCounter=0,u(n,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new ai,new ai,new ai,new ai,new ai,new ai,new ai,new ai]},"_greenColor",function(){return this._greenColor=new ri(0,1,0,1)}]),n}(),Vi=function(){function o(e){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,o.__super.call(this),this._localPosition=new ai,this._localRotation=new Jt(0,0,0,1),this._localScale=new ai(1,1,1),this._localRotationEuler=new ai,this._localMatrix=new qt,this._position=new ai,this._rotation=new Jt(0,0,0,1),this._scale=new ai(1,1,1),this._worldMatrix=new qt,this._forward=new ai,this._up=new ai,this._right=new ai,this._owner=e,this._childs=[]}f(o,"laya.d3.core.Transform3D",i);var e=o.prototype;return e._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)qt.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var e=o._tempVector30;ai.multiply(this.pivot,this._localScale,e);var t=o._tempVector31;ai.subtract(e,this.pivot,t);var i=o._tempVector32,n=this.localRotation;ai.transformQuat(e,n,i),ai.subtract(i,e,i);var a=o._tempVector33;ai.subtract(this._localPosition,t,a),ai.subtract(a,i,a),qt.createAffineTransformation(a,n,this._localScale,this._localMatrix)}},e._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var e=0,t=this._childs.length;e<t;e++)this._childs[e]._onWorldPositionRotationTransform()}},e._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var e=0,t=this._childs.length;e<t;e++)this._childs[e]._onWorldPositionScaleTransform()}},e._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var e=0,t=this._childs.length;e<t;e++)this._childs[e]._onWorldPositionTransform()}},e._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var e=0,t=this._childs.length;e<t;e++)this._childs[e]._onWorldPositionRotationTransform()}},e._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var e=0,t=this._childs.length;e<t;e++)this._childs[e]._onWorldPositionScaleTransform()}},e._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var e=0,t=this._childs.length;e<t;e++)this._childs[e]._onWorldTransform()}},e.translate=function(e,t){void 0===t&&(t=!0),t?(qt.createFromQuaternion(this.localRotation,o._tempMatrix0),ai.transformCoordinate(e,o._tempMatrix0,o._tempVector30),ai.add(this.localPosition,o._tempVector30,this._localPosition),this.localPosition=this._localPosition):(ai.add(this.position,e,this._position),this.position=this._position)},e.rotate=function(e,t,i){var n;void 0===t&&(t=!0),void 0===i&&(i=!0),n=i?e:(ai.scale(e,Math.PI/180,o._tempVector30),o._tempVector30),Jt.createFromYawPitchRoll(n.y,n.x,n.z,o._tempQuaternion0),t?(Jt.multiply(this._localRotation,o._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(Jt.multiply(o._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},e.lookAt=function(e,t,i){void 0===i&&(i=!1);var n,a=e.elements;if(i){if(n=this._localPosition.elements,Math.abs(n[0]-a[0])<jt.zeroTolerance&&Math.abs(n[1]-a[1])<jt.zeroTolerance&&Math.abs(n[2]-a[2])<jt.zeroTolerance)return;Jt.lookAt(this._localPosition,e,t,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var r=this.position;if(n=r.elements,Math.abs(n[0]-a[0])<jt.zeroTolerance&&Math.abs(n[1]-a[1])<jt.zeroTolerance&&Math.abs(n[2]-a[2])<jt.zeroTolerance)return;Jt.lookAt(r,e,t,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},v(0,e,"_isFrontFaceInvert",function(){var e=this.scale,t=e.x<0;return e.y<0&&(t=!t),e.z<0&&(t=!t),t}),v(0,e,"owner",function(){return this._owner}),v(0,e,"localRotation",function(){if(this._localQuaternionUpdate){var e=this._localRotationEuler.elements;Jt.createFromYawPitchRoll(e[1]/o._angleToRandin,e[0]/o._angleToRandin,e[2]/o._angleToRandin,this._localRotation)}return this._localRotation},function(e){this._localRotation=e,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),v(0,e,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?qt.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(e){null===this._parent?e.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),qt.multiply(this._localMatrix,e,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=e,this._worldUpdate=!1}),v(0,e,"worldNeedUpdate",function(){return this._worldUpdate}),v(0,e,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(e){this._localMatrix=e,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),v(0,e,"dummy",function(){return this._dummy},function(e){this._dummy!==e&&(this._dummy&&(this._dummy._entity=null),e&&(e._entity=this),this._dummy=e)}),v(0,e,"localPosition",function(){return this._localPosition},function(e){this._localPosition=e,this._localUpdate=!0,this._onWorldPositionTransform()}),v(0,e,"position",function(){if(this._positionUpdate){if(null!=this._parent){var e=this._parent.position;ai.multiply(this._localPosition,this._parent.scale,o._tempVector30),ai.transformQuat(o._tempVector30,this._parent.rotation,o._tempVector30),ai.add(e,o._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(e){if(null!=this._parent){ai.subtract(e,this._parent.position,this._localPosition);var t=this._parent.scale.elements,i=t[0],n=t[1],a=t[2];if(1!==i||1!==n||1!==a){var r=o._tempVector30,s=r.elements;s[0]=1/i,s[1]=1/n,s[2]=1/a,ai.multiply(this._localPosition,r,this._localPosition)}this._parent.rotation.invert(o._tempQuaternion0),ai.transformQuat(this._localPosition,o._tempQuaternion0,this._localPosition)}else e.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=e,this._positionUpdate=!1}),v(0,e,"localScale",function(){return this._localScale},function(e){this._localScale=e,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),v(0,e,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(o._tempVector30);var e=o._tempVector30.elements,t=this._localRotationEuler.elements;t[0]=e[1]*o._angleToRandin,t[1]=e[0]*o._angleToRandin,t[2]=e[2]*o._angleToRandin}return this._localRotationEuler},function(e){this._localRotationEuler=e,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),v(0,e,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?Jt.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(e){null!=this._parent?(this._parent.rotation.invert(o._tempQuaternion0),Jt.multiply(e,o._tempQuaternion0,this._localRotation)):e.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=e,this._rotationUpdate=!1}),v(0,e,"scale",function(){return this._scaleUpdate&&(null!==this._parent?ai.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(e){if(null!==this._parent){var t=this._parent.scale.elements,i=o._tempVector30.elements;i[0]=1/t[0],i[1]=1/t[1],i[2]=1/t[2],ai.multiply(e,o._tempVector30,this._localScale)}else e.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=e,this._scaleUpdate=!1}),v(0,e,"rotationEuler",null,function(e){Jt.createFromYawPitchRoll(e.y,e.x,e.z,this._rotation),this.rotation=this._rotation}),v(0,e,"forward",function(){var e=this.worldMatrix.elements;return this._forward.elements[0]=-e[8],this._forward.elements[1]=-e[9],this._forward.elements[2]=-e[10],this._forward}),v(0,e,"up",function(){var e=this.worldMatrix.elements;return this._up.elements[0]=e[4],this._up.elements[1]=e[5],this._up.elements[2]=e[6],this._up}),v(0,e,"right",function(){var e=this.worldMatrix.elements;return this._right.elements[0]=e[0],this._right.elements[1]=e[1],this._right.elements[2]=e[2],this._right}),v(0,e,"parent",function(){return this._parent},function(e){if(this._parent!==e){if(this._parent){var t=this._parent._childs,i=t.indexOf(this);t.splice(i,1)}e&&(e._childs.push(this),e&&this._onWorldTransform()),this._parent=e}}),u(o,["_tempVector30",function(){return this._tempVector30=new ai},"_tempVector31",function(){return this._tempVector31=new ai},"_tempVector32",function(){return this._tempVector32=new ai},"_tempVector33",function(){return this._tempVector33=new ai},"_tempQuaternion0",function(){return this._tempQuaternion0=new Jt},"_tempMatrix0",function(){return this._tempMatrix0=new qt},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),o}(),Bi=(function(){function e(){this._rotation=0,this._matNeedUpdte=!1,e.__super.call(this),this._matrix=new qt,this._offset=new ni,this._tiling=new ni(1,1)}f(e,"laya.d3.core.TransformUV",i);var t=e.prototype;x.imps(t,{"laya.d3.core.IClone":!0}),t._updateMatrix=function(){e._tempOffsetV3.elements[0]=this._offset.x,e._tempOffsetV3.elements[1]=this._offset.y,Jt.createFromYawPitchRoll(0,0,this._rotation,e._tempRotationQua),e._tempTitlingV3.elements[0]=this._tiling.x,e._tempTitlingV3.elements[1]=this._tiling.y,qt.createAffineTransformation(e._tempOffsetV3,e._tempRotationQua,e._tempTitlingV3,this._matrix)},t.cloneTo=function(e){e._matrix=this._matrix.clone(),e._offset=this._offset.clone(),e._rotation=this._rotation,e._tiling=this._tiling.clone()},t.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,t,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),v(0,t,"tiling",function(){return this._tiling},function(e){this._tiling=e,this._matNeedUpdte=!0}),v(0,t,"offset",function(){return this._offset},function(e){this._offset=e,this._matNeedUpdte=!0}),v(0,t,"rotation",function(){return this._rotation},function(e){this._rotation=e,this._matNeedUpdte=!0}),u(e,["_tempOffsetV3",function(){return this._tempOffsetV3=new ai(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new Jt},"_tempTitlingV3",function(){return this._tempTitlingV3=new ai(1,1,1)}])}(),f(Fi,"laya.d3.utils.CollisionManager",i),Fi._onTrigger=function(e,t,i,n,a){var r=0,s=0,o=e.id,l=t.id;if(!e._ignoreCollisonMap[l]){var h=Si.collisionManager,c=e._runtimeCollisonTestMap[l];if(null!=c)if(c)if(e._collisonTo(t))if(e._runtimeCollisonMap[l]){for(r=0,s=i.length;r<s;r++)i[r].onTriggerStay(t);for(r=0,s=n.length;r<s;r++)n[r].onTriggerStay(e);h.event("triggerstay",[e,t])}else{for(e._runtimeCollisonMap[l]=t,e._runtimeCollisonTestMap[l]=!1,t._runtimeCollisonMap[o]=e,a&&(t._runtimeCollisonTestMap[o]=!1),r=0,s=i.length;r<s;r++)i[r].onTriggerEnter(t);for(r=0,s=n.length;r<s;r++)n[r].onTriggerEnter(e);h.event("triggerenter",[e,t])}else{var u=e._runtimeCollisonMap;if(u[l]){for(delete u[l],delete e._runtimeCollisonTestMap[l],delete t._runtimeCollisonMap[o],a&&delete t._runtimeCollisonTestMap[o],r=0,s=i.length;r<s;r++)i[r].onTriggerExit(t);for(r=0,s=n.length;r<s;r++)n[r].onTriggerExit(e);h.event("triggerexit",[e,t])}}else{for(r=0,s=i.length;r<s;r++)i[r].onTriggerStay(t);for(r=0,s=n.length;r<s;r++)n[r].onTriggerStay(e);h.event("triggerstay",[e,t])}else if(e._collisonTo(t)){for(e._runtimeCollisonMap[l]=t,e._runtimeCollisonTestMap[l]=!1,t._runtimeCollisonMap[o]=e,a&&(t._runtimeCollisonTestMap[o]=!1),r=0,s=i.length;r<s;r++)i[r].onTriggerEnter(t);for(r=0,s=n.length;r<s;r++)n[r].onTriggerEnter(e);h.event("triggerenter",[e,t])}}},Fi._triggerCollision=function(){for(var e=Y._collsionTestList,t=e.length,i=Si._layerCollsionMatrix,n=0;n<t;n++)for(var a=e[n],r=Y.getLayerByNumber(a),s=r._colliders,o=r._nonRigidbodyOffset,l=t-1;n<=l;l--){var h=e[l];if(i[a][30-h]){var c,u,d,_=0,p=0,f=0,m=0,g=Y.getLayerByNumber(h),v=g._colliders,y=g._nonRigidbodyOffset;if(r!==g){for(_=0;_<o;_++)if((c=s[_]).enable){for(d=c.owner._scripts,f=0,m=y;f<m;f++)(u=v[f]).enable&&Fi._onTrigger(c,u,d,u.owner._scripts,!0);for(f=y,m=v.length;f<m;f++)(u=v[f]).enable&&Fi._onTrigger(c,u,d,u.owner._scripts,!1)}for(_=o,p=s.length;_<p;_++)if((c=s[_]).enable)for(d=c.owner._scripts,f=0,m=g._nonRigidbodyOffset;f<m;f++)(u=v[f]).enable&&Fi._onTrigger(u,c,d,u.owner._scripts,!1)}else for(_=0;_<o;_++)if((c=s[_]).enable){for(d=c.owner._scripts,f=_+1,m=o;f<m;f++)(u=v[f]).enable&&Fi._onTrigger(c,u,d,u.owner._scripts,!0);for(f=o,m=s.length;f<m;f++)(u=v[f]).enable&&Fi._onTrigger(c,u,d,u.owner._scripts,!1)}}}},Fi);function Fi(){Fi.__super.call(this)}!function(a){function e(){e.__super.call(this)}f(e,"laya.d3.core.glitter.SplineCurvePosition",a);var t=e.prototype;t._CalcVelocity=function(e,t,i){ai.subtract(e,t,i),ai.scale(i,.5,i)},t.Init=function(e,t,i,n){this._CalcVelocity(t,e,this._tempVector30),this._CalcVelocity(n,i,this._tempVector31),a.prototype.Init.call(this,t,this._tempVector30,n,this._tempVector31)}}(X);var Hi=function(i){function e(){this.x=NaN,this.y=NaN,this.z=NaN,e.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}f(e,"laya.d3.core.particleShuriKen.module.shape.BoxShape",i);var t=e.prototype;return t._getShapeBoundBox=function(e){var t=e.min.elements;t[0]=.5*-this.x,t[1]=.5*-this.y,t[2]=.5*-this.z;var i=e.max.elements;i[0]=.5*this.x,i[1]=.5*this.y,i[2]=.5*this.z},t._getSpeedBoundBox=function(e){var t=e.min.elements;t[0]=0,t[1]=0,t[2]=0;var i=e.max.elements;i[0]=0,i[1]=1,i[2]=0},t.generatePositionAndDirection=function(e,t,i,n){var a=e.elements,r=t.elements;i?(i.seed=n[16],J._randomPointInsideHalfUnitBox(e,i),n[16]=i.seed):J._randomPointInsideHalfUnitBox(e),a[0]=this.x*a[0],a[1]=this.y*a[1],a[2]=this.z*a[2],this.randomDirection?i?(i.seed=n[17],J._randomPointUnitSphere(t,i),n[17]=i.seed):J._randomPointUnitSphere(t):(r[0]=0,r[1]=0,r[2]=1)},t.cloneTo=function(e){i.prototype.cloneTo.call(this,e);var t=e;t.x=this.x,t.y=this.y,t.z=this.z,t.randomDirection=this.randomDirection},e}($),Ui=function(i){function s(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,s.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}f(s,"laya.d3.core.particleShuriKen.module.shape.CircleShape",i);var e=s.prototype;return e._getShapeBoundBox=function(e){var t=e.min.elements;t[0]=t[2]=-this.radius,t[1]=0;var i=e.max.elements;i[0]=i[2]=this.radius,i[1]=0},e._getSpeedBoundBox=function(e){var t=e.min.elements;t[0]=t[1]=-1,t[2]=0;var i=e.max.elements;i[0]=i[1]=1,i[2]=0},e.generatePositionAndDirection=function(e,t,i,n){var a=e.elements,r=s._tempPositionPoint.elements;i?(i.seed=n[16],this.emitFromEdge?J._randomPointUnitArcCircle(this.arc,s._tempPositionPoint,i):J._randomPointInsideUnitArcCircle(this.arc,s._tempPositionPoint,i),n[16]=i.seed):this.emitFromEdge?J._randomPointUnitArcCircle(this.arc,s._tempPositionPoint):J._randomPointInsideUnitArcCircle(this.arc,s._tempPositionPoint),a[0]=-r[0],a[1]=r[1],a[2]=0,ai.scale(e,this.radius,e),this.randomDirection?i?(i.seed=n[17],J._randomPointUnitSphere(t,i),n[17]=i.seed):J._randomPointUnitSphere(t):e.cloneTo(t)},e.cloneTo=function(e){i.prototype.cloneTo.call(this,e);var t=e;t.radius=this.radius,t.arc=this.arc,t.emitFromEdge=this.emitFromEdge,t.randomDirection=this.randomDirection},u(s,["_tempPositionPoint",function(){return this._tempPositionPoint=new ni}]),s}($),Gi=function(i){function d(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,d.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}f(d,"laya.d3.core.particleShuriKen.module.shape.ConeShape",i);var e=d.prototype;return e._getShapeBoundBox=function(e){var t=this.radius+this.length*Math.sin(this.angle),i=this.length*Math.cos(this.angle),n=e.min.elements;n[0]=n[1]=-t,n[2]=0;var a=e.max.elements;a[0]=a[1]=t,a[2]=i},e._getSpeedBoundBox=function(e){var t=Math.sin(this.angle),i=e.min.elements;i[0]=i[1]=-t,i[2]=0;var n=e.max.elements;n[0]=i[1]=t,n[2]=1},e.generatePositionAndDirection=function(e,t,i,n){var a,r=e.elements,s=t.elements,o=d._tempPositionPoint.elements,l=NaN,h=NaN,c=Math.cos(this.angle),u=Math.sin(this.angle);switch(this.emitType){case 0:i?(i.seed=n[16],J._randomPointInsideUnitCircle(d._tempPositionPoint,i),n[16]=i.seed):J._randomPointInsideUnitCircle(d._tempPositionPoint),l=o[0],h=o[1],r[0]=l*this.radius,r[1]=h*this.radius,r[2]=0,this.randomDirection?(i?(i.seed=n[17],J._randomPointInsideUnitCircle(d._tempDirectionPoint,i),n[17]=i.seed):J._randomPointInsideUnitCircle(d._tempDirectionPoint),a=d._tempDirectionPoint.elements,s[0]=a[0]*u,s[1]=a[1]*u):(s[0]=l*u,s[1]=h*u),s[2]=c;break;case 1:i?(i.seed=n[16],J._randomPointUnitCircle(d._tempPositionPoint,i),n[16]=i.seed):J._randomPointUnitCircle(d._tempPositionPoint),l=o[0],h=o[1],r[0]=l*this.radius,r[1]=h*this.radius,r[2]=0,this.randomDirection?(i?(i.seed=n[17],J._randomPointInsideUnitCircle(d._tempDirectionPoint,i),n[17]=i.seed):J._randomPointInsideUnitCircle(d._tempDirectionPoint),a=d._tempDirectionPoint.elements,s[0]=a[0]*u,s[1]=a[1]*u):(s[0]=l*u,s[1]=h*u),s[2]=c;break;case 2:i?(i.seed=n[16],J._randomPointInsideUnitCircle(d._tempPositionPoint,i)):J._randomPointInsideUnitCircle(d._tempPositionPoint),l=o[0],h=o[1],r[0]=l*this.radius,r[1]=h*this.radius,s[r[2]=0]=l*u,s[1]=h*u,s[2]=c,ai.normalize(t,t),i?(ai.scale(t,this.length*i.getFloat(),t),n[16]=i.seed):ai.scale(t,this.length*Math.random(),t),ai.add(e,t,e),this.randomDirection&&(i?(i.seed=n[17],J._randomPointUnitSphere(t,i),n[17]=i.seed):J._randomPointUnitSphere(t));break;case 3:i?(i.seed=n[16],J._randomPointUnitCircle(d._tempPositionPoint,i)):J._randomPointUnitCircle(d._tempPositionPoint),l=o[0],h=o[1],r[0]=l*this.radius,r[1]=h*this.radius,s[r[2]=0]=l*u,s[1]=h*u,s[2]=c,ai.normalize(t,t),i?(ai.scale(t,this.length*i.getFloat(),t),n[16]=i.seed):ai.scale(t,this.length*Math.random(),t),ai.add(e,t,e),this.randomDirection&&(i?(i.seed=n[17],J._randomPointUnitSphere(t,i),n[17]=i.seed):J._randomPointUnitSphere(t));break;default:throw new Error("ConeShape:emitType is invalid.")}},e.cloneTo=function(e){i.prototype.cloneTo.call(this,e);var t=e;t.angle=this.angle,t.radius=this.radius,t.length=this.length,t.emitType=this.emitType,t.randomDirection=this.randomDirection},u(d,["_tempPositionPoint",function(){return this._tempPositionPoint=new ni},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new ni}]),d}($),zi=function(i){function e(){this.radius=NaN,this.emitFromShell=!1,e.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}f(e,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",i);var t=e.prototype;return t._getShapeBoundBox=function(e){var t=e.min.elements;t[0]=t[1]=t[2]=-this.radius;var i=e.max.elements;i[0]=i[1]=this.radius,i[2]=0},t._getSpeedBoundBox=function(e){var t=e.min.elements;t[0]=t[1]=-1,t[2]=0;var i=e.max.elements;i[0]=i[1]=i[2]=1},t.generatePositionAndDirection=function(e,t,i,n){var a=e.elements;i?(i.seed=n[16],this.emitFromShell?J._randomPointUnitSphere(e,i):J._randomPointInsideUnitSphere(e,i),n[16]=i.seed):this.emitFromShell?J._randomPointUnitSphere(e):J._randomPointInsideUnitSphere(e),ai.scale(e,this.radius,e);var r=a[2];r<0&&(a[2]=-1*r),this.randomDirection?i?(i.seed=n[17],J._randomPointUnitSphere(t,i),n[17]=i.seed):J._randomPointUnitSphere(t):e.cloneTo(t)},t.cloneTo=function(e){i.prototype.cloneTo.call(this,e);var t=e;t.radius=this.radius,t.emitFromShell=this.emitFromShell,t.randomDirection=this.randomDirection},e}($),Wi=function(i){function e(){this.radius=NaN,this.emitFromShell=!1,e.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}f(e,"laya.d3.core.particleShuriKen.module.shape.SphereShape",i);var t=e.prototype;return t._getShapeBoundBox=function(e){var t=e.min.elements;t[0]=t[1]=t[2]=-this.radius;var i=e.max.elements;i[0]=i[1]=i[2]=this.radius},t._getSpeedBoundBox=function(e){var t=e.min.elements;t[0]=t[1]=t[2]=-1;var i=e.max.elements;i[0]=i[1]=i[2]=1},t.generatePositionAndDirection=function(e,t,i,n){i?(i.seed=n[16],this.emitFromShell?J._randomPointUnitSphere(e,i):J._randomPointInsideUnitSphere(e,i),n[16]=i.seed):this.emitFromShell?J._randomPointUnitSphere(e):J._randomPointInsideUnitSphere(e),ai.scale(e,this.radius,e),this.randomDirection?i?(i.seed=n[17],J._randomPointUnitSphere(t,i),n[17]=i.seed):J._randomPointUnitSphere(t):e.cloneTo(t)},t.cloneTo=function(e){i.prototype.cloneTo.call(this,e);var t=e;t.radius=this.radius,t.emitFromShell=this.emitFromShell,t.randomDirection=this.randomDirection},e}($),Xi=(f(ji,"laya.d3.core.render.SubMeshRenderElement",ae),ji);function ji(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,ji.__super.call(this)}var Yi=function(){function g(e,t,i,n,a,r){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=e,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[pi.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[$n.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[$n.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[ra.SHADERDEFINE_BONE]="BONE",this._materialInt2name[Ji.SHADERDEFINE_ALPHATEST]="ALPHATEST";g.__super.call(this,e,t,i,null,{}),this._attributeMap=n;var s;for(s in a){var o=a[s];switch(o[1]){case 0:this._renderElementUniformMap[s]=o[0];break;case 1:this._materialUniformMap[s]=o[0];break;case 2:this._spriteUniformMap[s]=o[0];break;case 3:this._cameraUniformMap[s]=o[0];break;case 4:this._sceneUniformMap[s]=o[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}f(g,"laya.d3.shader.ShaderCompile3D",E);var e=g.prototype;return e._definesToNameDic=function(e,t){for(var i={},n=1,a=0;a<32&&!(e<(n=1<<a));a++)if(e&n){var r=t[n];r&&(i[r]="")}return i},e.withCompile=function(e,t,i){var n,a,r;if(a=this.sharders[e])if(r=a[t]){if(n=r[i])return n}else r=a[t]=[];else r=(a=this.sharders[e]=[])[t]=[];var s,o=this._definesToNameDic(e,g._globalInt2name),l=this._definesToNameDic(t,this._spriteInt2name),h=this._definesToNameDic(i,this._materialInt2name);if(laya.d3.shader.ShaderCompile3D.debugMode){var c="";for(s in o)c+=s+" ";var u="";for(s in l)u+=s+" ";var d="";for(s in h)d+=s+" ";console.log("ShaderCompile3DDebugMode---(Name:"+Tn.nameKey.getName(this._name)+" PublicDefine:"+e+" SpriteDefine:"+t+" MaterialDefine:"+i+" PublicDefineGroup:"+c+" SpriteDefineGroup:"+u+"MaterialDefineGroup: "+d+")---ShaderCompile3DDebugMode")}var _={},p="";if(o)for(s in o)p+="#define "+s+"\n",_[s]=!0;if(l)for(s in l)p+="#define "+s+"\n",_[s]=!0;if(h)for(s in h)p+="#define "+s+"\n",_[s]=!0;var f=this._VS.toscript(_,[]),m=this._PS.toscript(_,[]);return n=Tn.create(p+f.join("\n"),p+m.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap),r[i]=n},e.precompileShaderWithShaderDefine=function(e,t,i){this.withCompile(e,t,i)},e.addMaterialDefines=function(e){var t=e.defines;for(var i in t){var n=t[i],a=parseInt(i);this._materialInt2name[a]=n,this._materialName2Int[n]=a}},e.addSpriteDefines=function(e){var t=e.defines;for(var i in t){var n=t[i],a=parseInt(i);this._spriteInt2name[a]=n,this._spriteName2Int[n]=a}},e.getMaterialDefineByName=function(e){return this._materialName2Int[e]},e.registerMaterialDefine=function(e){var t=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[t]=e,this._materialName2Int[e]=t},e.registerSpriteDefine=function(e){var t=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[t]=e,this._spriteName2Int[e]=t},g._globalRegDefine=function(e,t){g._globalInt2name[t]=e},g.add=function(e,t,i,n,a){return laya.d3.shader.ShaderCompile3D._preCompileShader[e]=new g(e,t,i,n,a,E.includes)},g.get=function(e){return laya.d3.shader.ShaderCompile3D._preCompileShader[Tn.nameKey.getID(e)]},g._preCompileShader={},g._globalInt2name=[],g.debugMode=!1,g.SHADERDEFINE_HIGHPRECISION=1,g.SHADERDEFINE_FOG=4,g.SHADERDEFINE_DIRECTIONLIGHT=8,g.SHADERDEFINE_POINTLIGHT=16,g.SHADERDEFINE_SPOTLIGHT=32,g.SHADERDEFINE_UV0=64,g.SHADERDEFINE_COLOR=128,g.SHADERDEFINE_UV1=256,g.SAHDERDEFINE_DEPTHFOG=131072,g}(),Ki=function(){function p(){p.__super.call(this)}f(p,"laya.d3.graphics.MeshSprite3DStaticBatchManager",we);var e=p.prototype;return e._getStaticBatch=function(e,t,i,n){var a,r;return r=e?e.id.toString()+i.id.toString()+t.id.toString()+n.toString():i.id.toString()+t.id.toString()+n.toString(),this._staticBatches[r]?a=this._staticBatches[r]:this._staticBatches[r]=a=new qi(r,this,e,t,i),a},e._initStaticBatchs=function(e){var t,i;this._initBatchRenderElements.sort(p._sortPrepareStaticBatch);for(var n,a=!1,r=0,s=0,o=this._initBatchRenderElements.length;s<o;s++){var l,h=this._initBatchRenderElements[s],c=h.renderObj._getVertexBuffer(0);h._sprite3D;if(i===c.vertexDeclaration&&t===h._material)if(a)n._addCombineBatchRenderObjTest(h)?(l=h._staticBatch)!==n&&(l&&l._deleteCombineBatchRenderObj(h),n._addCombineBatchRenderObj(h)):(a=!1,r++);else{var u=this._initBatchRenderElements[s-1],d=u.renderObj,_=h.renderObj;a=!(65535<d._getVertexBuffer().vertexCount+_._getVertexBuffer().vertexCount)&&(n=this._getStaticBatch(e,i,t,r),(l=u._staticBatch)!==n&&(l&&l._deleteCombineBatchRenderObj(u),n._addCombineBatchRenderObj(u)),(l=h._staticBatch)!==n&&(l&&l._deleteCombineBatchRenderObj(h),n._addCombineBatchRenderObj(h)),!0)}else a=!1,r=0;t=h._material,i=c.vertexDeclaration}},p._sortPrepareStaticBatch=function(e,t){var i=e._render,n=t._render,a=i.lightmapIndex-n.lightmapIndex;if(0!=a)return a;var r=i.receiveShadow-n.receiveShadow;if(0!=r)return r;var s=e._mainSortID-t._mainSortID;return 0==s?e.renderObj.triangleCount-t.renderObj.triangleCount:s},p}(),qi=function(){function r(e,t,i,n,a){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,r.__super.call(this,e,t,i),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=n,this._material=a}f(r,"laya.d3.graphics.SubMeshStaticBatch",Fe);var e=r.prototype;return e._compareBatchRenderElement=function(e,t){return e._batchIndexStart>t._batchIndexStart},e._addCombineBatchRenderObjTest=function(e){var t=e.renderObj._vertexCount;return!(65535<(0<t?this._currentCombineVertexCount+t:this._currentCombineVertexCount+e.renderObj._getVertexBuffer().vertexCount))},e._addCombineBatchRenderObj=function(e){var t=e.renderObj,i=t._vertexCount;this._initBatchRenderElements.push(e),e._staticBatch=this,0<i?(this._currentCombineIndexCount+=t._indexCount,this._currentCombineVertexCount+=i):(this._currentCombineIndexCount=this._currentCombineIndexCount+t._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+t._getVertexBuffer().vertexCount),this._needFinishCombine=!0},e._deleteCombineBatchRenderObj=function(e){var t=e.renderObj,i=this._initBatchRenderElements.indexOf(e);if(-1!==i){this._initBatchRenderElements.splice(i,1),e._staticBatch=null;var n=t._vertexCount;0<n?(this._currentCombineIndexCount=this._currentCombineIndexCount-t._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-n):(this._currentCombineIndexCount=this._currentCombineIndexCount-t._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-t._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},e._finishInit=function(){if(this._needFinishCombine){var e=0,t=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var i=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),n=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=On.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=Nn.create("ushort",this._currentCombineIndexCount,35044);for(var a=0,r=this._initBatchRenderElements.length;a<r;a++){var s=this._initBatchRenderElements[a],o=s.renderObj,l=o._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,s._sprite3D),h=o.getIndices(),c=s._sprite3D.transform._isFrontFaceInvert,u=e/(this._vertexDeclaration.vertexStride/4)-o._vertexStart,d=t,_=d+h.length;s._batchIndexStart=d,s._batchIndexEnd=_,n.set(h,t);var p=0;if(c)for(p=d;p<_;p+=3){n[p]=u+n[p];var f=n[p+1],m=n[p+2];n[p+1]=u+m,n[p+2]=u+f}else for(p=d;p<_;p+=3)n[p]=u+n[p],n[p+1]=u+n[p+1],n[p+2]=u+n[p+2];t+=h.length,i.set(l,e),e+=l.length}this._vertexBuffer.setData(i),this._indexBuffer.setData(n),this._needFinishCombine=!1}},e._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new Xi)},e._getRenderElement=function(e,t,i){for(var n,a,r=this._batchRenderElements.length,s=!0,o=0;o<r;o++){var l,h,c=(a=this._batchRenderElements[o])._sprite3D._render;if(0!==o&&(s=(l=(n=this._batchRenderElements[o-1])._sprite3D._render).lightmapIndex!==c.lightmapIndex||l.receiveShadow!==c.receiveShadow||n._batchIndexEnd!==a._batchIndexStart),s){(h=this._getCombineRenderElementFromPool()).renderObj=this,h._material=this._material,h._batchIndexStart=a._batchIndexStart,h._batchIndexEnd=a._batchIndexEnd;var u,d=c.lightmapIndex,_=d+1,p=this._batchOwnerIndices[_],f=(p=p||(this._batchOwnerIndices[_]=[]))[a._render.receiveShadow?1:0];void 0===f?(p[c.receiveShadow?1:0]=this._batchOwners.length,(u=new na(null,"StaticBatchMeshSprite3D"))._scene=t,u._transform=this._rootOwner?this._rootOwner._transform:null,u._render.lightmapIndex=d,u._render.receiveShadow=a._render.receiveShadow,this._batchOwners.push(u)):u=this._batchOwners[f],u._render._renderUpdate(i),h._sprite3D=u,e.push(h)}else h._batchIndexEnd=a._batchIndexEnd}},e._beforeRender=function(e){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},e._render=function(e){var t=e.renderElement,i=t._batchIndexStart,n=t._batchIndexEnd-i;I.mainContext.drawElements(4,n,5123,2*i),w.drawCall++,w.trianglesFaces+=n/3},e.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},e._getVertexBuffer=function(e){return void 0===e&&(e=0),this._vertexBuffer},r}(),Zi=(function(e){function _(){_.__super.call(this),_._nameNumber++,this.loadShaderParams(),this.createResource(),this.alphaBlending=1,this.colorIntensity=1}f(_,"laya.d3.resource.models.SkyBox",e);var t=_.prototype;t._getShader=function(e){var t=e.scene._shaderDefineValue;return this._shader=this._shaderCompile.withCompile(t,0,0),this._shader},t.createResource=function(){this._numberVertices=36,this._numberIndices=36;var e=new Uint16Array(this._numberIndices),t=_._vertexDeclaration.vertexStride/4,i=new Float32Array(this._numberVertices*t),n=new ai(-.5,.5,.5),a=new ai(-.5,-.5,.5),r=new ai(.5,.5,.5),s=new ai(.5,-.5,.5),o=new ai(-.5,.5,-.5),l=new ai(.5,.5,-.5),h=new ai(-.5,-.5,-.5),c=new ai(.5,-.5,-.5),u=0;u=this._addVertex(i,u,n),u=this._addVertex(i,u,a),u=this._addVertex(i,u,r),u=this._addVertex(i,u,a),u=this._addVertex(i,u,s),u=this._addVertex(i,u,r),u=this._addVertex(i,u,o),u=this._addVertex(i,u,l),u=this._addVertex(i,u,h),u=this._addVertex(i,u,h),u=this._addVertex(i,u,l),u=this._addVertex(i,u,c),u=this._addVertex(i,u,n),u=this._addVertex(i,u,l),u=this._addVertex(i,u,o),u=this._addVertex(i,u,n),u=this._addVertex(i,u,r),u=this._addVertex(i,u,l),u=this._addVertex(i,u,a),u=this._addVertex(i,u,h),u=this._addVertex(i,u,c),u=this._addVertex(i,u,a),u=this._addVertex(i,u,c),u=this._addVertex(i,u,s),u=this._addVertex(i,u,n),u=this._addVertex(i,u,h),u=this._addVertex(i,u,a),u=this._addVertex(i,u,o),u=this._addVertex(i,u,h),u=this._addVertex(i,u,n),u=this._addVertex(i,u,r),u=this._addVertex(i,u,s),u=this._addVertex(i,u,c),u=this._addVertex(i,u,l),u=this._addVertex(i,u,r),u=this._addVertex(i,u,c);for(var d=0;d<36;d++)e[d]=d;this._vertexBuffer=new On(_._vertexDeclaration,this._numberVertices,35044,!0),this._indexBuffer=new Nn("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(i),this._indexBuffer.setData(e)},t._addVertex=function(e,t,i){var n=i.elements;return e[t+0]=n[0],e[t+1]=n[1],e[t+2]=n[2],t+3},t.loadShaderParams=function(){this._sharderNameID=Tn.nameKey.getID("SkyBox"),this._shaderCompile=Yi._preCompileShader[this._sharderNameID]},t._render=function(e){this._textureCube&&this._textureCube.loaded&&(this._vertexBuffer._bind(),this._indexBuffer._bind(),this._shader=this._getShader(e),this._shader.bind(),e.camera.transform.worldMatrix.cloneTo(_._tempMatrix4x40),_._tempMatrix4x40.transpose(),qt.multiply(e._projectionMatrix,_._tempMatrix4x40,_._tempMatrix4x41),e.camera._shaderValues.setValue(4,_._tempMatrix4x41.elements),this._shader.uploadCameraUniforms(e.camera._shaderValues.data),this._shaderValue.setValue(1,this._colorIntensity),this._shaderValue.setValue(2,this._alphaBlending),this._shaderValue.setValue(3,this.textureCube),this._shader.uploadAttributes(_._vertexDeclaration.shaderValues.data,null),this._shader.uploadMaterialUniforms(this._shaderValue.data),I.mainContext.drawElements(4,36,5123,0),w.trianglesFaces+=12,w.drawCall++)},t.destroy=function(){e.prototype.destroy.call(this),this._textureCube&&(this._textureCube._removeReference(),this._textureCube=null)},v(0,t,"textureCube",function(){return this._textureCube},function(e){this._textureCube!==e&&(this._textureCube&&this._textureCube._removeReference(),(this._textureCube=e)&&e._addReference())}),_._nameNumber=1,u(_,["_tempMatrix4x40",function(){return this._tempMatrix4x40=new qt},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new qt},"_vertexDeclaration",function(){return this._vertexDeclaration=new He(12,[new Ue(0,"vector3",0)])}])}(oi),function(e){function p(){this._stacks=16,this._slices=16,this._radius=1,p.__super.call(this),p._nameNumber++,this.loadShaderParams(),this.recreateResource(),this.alphaBlending=1,this.colorIntensity=1}f(p,"laya.d3.resource.models.SkyDome",e);var t=p.prototype;t._getShader=function(e){var t=e.scene._shaderDefineValue;return this._shader=this._shaderCompile.withCompile(t,0,0),this._shader},t.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=3*this._stacks*(this._slices+1)*2;for(var e=new Uint16Array(this._numberIndices),t=p._vertexDeclaration.vertexStride/4,i=new Float32Array(this._numberVertices*t),n=Math.PI/this._stacks,a=2*Math.PI/this._slices,r=0,s=0,o=0,l=0;l<this._stacks+1;l++)for(var h=Math.sin(l*n),c=Math.cos(l*n),u=0;u<this._slices+1;u++){var d=h*Math.sin(u*a),_=h*Math.cos(u*a);i[s+0]=d*this._radius,i[s+1]=c*this._radius,i[s+2]=_*this._radius,i[s+3]=-u/this._slices+.75,i[s+4]=l/this._stacks,s+=t,l!=this._stacks-1&&(e[o++]=r+1,e[o++]=r,e[o++]=r+(this._slices+1),e[o++]=r+(this._slices+1),e[o++]=r,e[o++]=r+this._slices,r++)}this._vertexBuffer=new On(p._vertexDeclaration,this._numberVertices,35044),this._indexBuffer=new Nn("ushort",this._numberIndices,35044),this._vertexBuffer.setData(i),this._indexBuffer.setData(e)},t.loadShaderParams=function(){this._sharderNameID=Tn.nameKey.getID("SkyDome"),this._shaderCompile=Yi._preCompileShader[this._sharderNameID]},t._render=function(e){this._texture&&this._texture.loaded&&(this._vertexBuffer._bind(),this._indexBuffer._bind(),this._shader=this._getShader(e),this._shader.bind(),e.camera.transform.worldMatrix.cloneTo(p._tempMatrix4x40),p._tempMatrix4x40.transpose(),qt.multiply(e._projectionMatrix,p._tempMatrix4x40,p._tempMatrix4x41),e.camera._shaderValues.setValue(4,p._tempMatrix4x41.elements),this._shader.uploadCameraUniforms(e.camera._shaderValues.data),this._shaderValue.setValue(1,this._colorIntensity),this._shaderValue.setValue(2,this._alphaBlending),this._shaderValue.setValue(3,this.texture),this._shader.uploadAttributes(p._vertexDeclaration.shaderValues.data,null),this._shader.uploadMaterialUniforms(this._shaderValue.data),I.mainContext.drawElements(4,this._indexBuffer.indexCount,5123,0),w.trianglesFaces+=this._numberIndices/3,w.drawCall++)},t.onEnvDescLoaded=function(e){var t="",i=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));0<i&&(t=e.substr(0,i+1));var n=x.loader.getRes(e);null!=n.ev&&this.__ownerCamera?this.__ownerCamera._shaderValues.setValue(13,Math.pow(2,n.ev)):this.__ownerCamera._shaderValues.setValue(13,Math.pow(2,0)),this.texture=Kn.load(t+n.skytex),this.environmentSpecular=Gn.load(t+n.prefiltedEnv);var a=new Float32Array(n.IrradianceMat);this.envDiffuseSHRed=a.slice(0,16),this.envDiffuseSHGreen=a.slice(16,32),this.envDiffuseSHBlue=a.slice(32,48)},t.loadEnvInfo=function(e){x.loader.load(e,b.create(this,this.onEnvDescLoaded,[e]))},t.destroy=function(){e.prototype.destroy.call(this),this._texture&&(this._texture._removeReference(),this._texture=null)},v(0,t,"texture",function(){return this._texture},function(e){this._texture!==e&&(this._texture&&this._texture._removeReference(),(this._texture=e)&&e._addReference())}),p._nameNumber=1,u(p,["_tempMatrix4x40",function(){return this._tempMatrix4x40=new qt},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new qt},"_vertexDeclaration",function(){return this._vertexDeclaration=new He(20,[new Ue(0,"vector3",0),new Ue(12,"vector2",2)])}])}(oi),function(){function e(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,e.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}f(e,"laya.d3.core.ComponentNode",c);var t=e.prototype;return t.addComponent=function(e){var t,i=this._componentsMap.indexOf(e);if(-1===i)t=[],this._componentsMap.push(e),this._typeComponentsIndices.push(t);else if(t=this._typeComponentsIndices[i],this._components[t[0]].isSingleton)throw new Error("无法单实例创建"+e+"组件，"+e+"组件已存在！");var n=l.getInstance(e);return t.push(this._components.length),this._components.push(n),n instanceof laya.d3.component.Script&&this._scripts.push(n),n._initialize(this),n},t._removeComponent=function(e,t){var i=this._typeComponentsIndices[e],n=i[t],a=this._components[n];this._components.splice(n,1),a instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(a),1),i.splice(t,1),0===i.length&&(this._typeComponentsIndices.splice(e,1),this._componentsMap.splice(e,1));for(var r=0,s=this._componentsMap.length;r<s;r++)for(var o=(i=this._typeComponentsIndices[r]).length-1;0<=o;o--){var l=i[o];if(!(n<l))break;i[o]=--l}a._destroy()},t.getComponentByType=function(e,t){void 0===t&&(t=0);var i=this._componentsMap.indexOf(e);return-1===i?null:this._components[this._typeComponentsIndices[i][t]]},t.getComponentsByType=function(e,t){var i=this._componentsMap.indexOf(e);if(-1!==i){var n=this._typeComponentsIndices[i],a=n.length;t.length=a;for(var r=0;r<a;r++)t[r]=this._components[n[r]]}else t.length=0},t.getComponentByIndex=function(e){return this._components[e]},t.removeComponentByType=function(e,t){void 0===t&&(t=0);var i=this._componentsMap.indexOf(e);-1!==i&&this._removeComponent(i,t)},t.removeComponentsByType=function(e){var t=this._componentsMap.indexOf(e);if(-1!==t)for(var i=this._typeComponentsIndices[t],n=0,a=i.length;n<a;i.length<a?a--:n++)this._removeComponent(t,n)},t.removeAllComponent=function(){for(var e=0,t=this._componentsMap.length;e<t;this._componentsMap.length<t?t--:e++)this.removeComponentsByType(this._componentsMap[e])},t._updateComponents=function(e){for(var t=0,i=this._components.length;t<i;t++){var n=this._components[t];n.started||(n._start(e),n.started=!0),n.enable&&n._update(e)}},t._lateUpdateComponents=function(e){for(var t=0;t<this._components.length;t++){var i=this._components[t];i.started||(i._start(e),i.started=!0),i.enable&&i._lateUpdate(e)}},t._preRenderUpdateComponents=function(e){for(var t=0;t<this._components.length;t++){var i=this._components[t];i.started||(i._start(e),i.started=!0),i.enable&&i._preRenderUpdate(e)}},t._postRenderUpdateComponents=function(e){for(var t=0;t<this._components.length;t++){var i=this._components[t];i.started||(i._start(e),i.started=!0),i.enable&&i._postRenderUpdate(e)}},e}()),Qi=function(){function t(){this._realTimeCurrentFrameIndexes=null,this._realTimeCurrentTimes=null,this._fullKeyframeIndicesCache=null,this._animationDatasCache=null,this._avatarDatasCache=null,this._skinnedDatasCache=null,this._version=null,this._nodes=null,this._nodesMap=null,this._cachePropertyMap=null,this._nodeToCachePropertyMap=null,this._unCachePropertyMap=null,this._duration=NaN,this._frameRate=0,this._animationEvents=null,this._publicClipDatas=null,this.islooping=!1,t.__super.call(this),this._fullKeyframeIndicesCache={},this._animationDatasCache=[],this._avatarDatasCache=[],this._skinnedDatasCache=[],this._animationEvents=[]}f(t,"laya.d3.animation.AnimationClip",g);var e=t.prototype;return e.duration=function(){return this._duration},e._hermiteInterpolate=function(e,t,i,n){for(var a=e.data,r=e.outTangent,s=e.next,o=s.data,l=s.inTangent,h=!1,c=NaN,u=NaN,d=NaN,_=NaN,p=0,f=n.length;p<f;p++){var m=r[p],g=l[p];if(Number.isFinite(m)&&Number.isFinite(g)){if(!h){var v=t*t,y=v*t;c=2*y-3*v+1,u=y-2*v+t,d=y-v,_=-2*y+3*v,h=!0}n[p]=c*a[p]+u*m*i+d*g*i+_*o[p]}else n[p]=a[p]}},e._getFullKeyframeIndicesWithCache=function(e){return this._fullKeyframeIndicesCache[e]},e._cacheFullKeyframeIndices=function(e,t){this._fullKeyframeIndicesCache[e]=t},e._getAnimationDataWithCache=function(e,t){var i=this._animationDatasCache[e];return i?i[t]:null},e._cacheAnimationData=function(e,t,i){(this._animationDatasCache[e]||(this._animationDatasCache[e]=[]))[t]=i},e._getAvatarDataWithCache=function(e,t,i){var n=this._avatarDatasCache[e.id];if(n){var a=n[t];return a?a[i]:null}return null},e._cacheAvatarData=function(e,t,i,n){var a=this._avatarDatasCache[e.id]||(this._avatarDatasCache[e.id]=[]);(a[t]||(a[t]=[]))[i]=n},e._evaluateAnimationlDatasCacheMode=function(e,t,i,n,a){for(var r=0,s=0,o=0,l=a?a.length:this._nodes.length;o<l;o++){var h=a?a[o]:o,c=this._nodes[h],u=c._cacheProperty;if(e[h]){var d,_=t[h],p=_[i.currentFrameIndex],f=0;if(-1!==p){var m=c.keyFrames[p];if(m.next){a&&!u?d=(d=n[h])||(n[h]=new Float32Array(c.keyFrameWidth)):(d=new Float32Array(c.keyFrameWidth),n[o]=d);var g=NaN,v=m.duration;g=0!==v?(i.currentFrameTime-m.startTime)/v:0,this._hermiteInterpolate(m,g,v,d)}else{if(a&&!u)d=(d=n[h])||(n[h]=new Float32Array(c.keyFrameWidth));else{if(-1!==(f=i._lastFrameIndex)&&_[f]===p)continue;d=new Float32Array(c.keyFrameWidth),n[o]=d}var y=m.data;for(r=0,s=d.length;r<s;r++)d[r]=y[r]}}else{if(a&&!u)d=(d=n[h])||(n[h]=new Float32Array(c.keyFrameWidth));else{if(-1!==(f=i._lastFrameIndex)&&_[f]===p)continue;d=new Float32Array(c.keyFrameWidth),n[o]=d}var C=c.keyFrames[0].data;for(r=0,s=d.length;r<s;r++)d[r]=C[r]}}}},e._evaluateAnimationlDatasRealTime=function(e,t,i,n){var a=0,r=0,s=this._nodes;if(!this._realTimeCurrentFrameIndexes){for(this._realTimeCurrentFrameIndexes=new Int32Array(s.length),a=0,r=s.length;a<r;a++)this._realTimeCurrentFrameIndexes[a]=-1;this._realTimeCurrentTimes=new Float32Array(s.length)}for(a=0,r=n?n.length:this._nodes.length;a<r;a++){var o=n?n[a]:a,l=s[o];t<this._realTimeCurrentTimes[o]&&(this._realTimeCurrentFrameIndexes[o]=-1),this._realTimeCurrentTimes[o]=t;for(var h=this._realTimeCurrentFrameIndexes[o]+1,c=l.keyFrames,u=c.length;h<u;){if(c[h].startTime>t){this._realTimeCurrentFrameIndexes[o]=h-1;break}h++}h===u&&(this._realTimeCurrentFrameIndexes[o]=u-1);var d=0,_=0,p=i[o];p=p||(i[o]=new Float32Array(l.keyFrameWidth));var f=c[this._realTimeCurrentFrameIndexes[o]];if(f){if(f.next){var m=f.duration,g=NaN;g=0!==m?(t-f.startTime)/m:0,this._hermiteInterpolate(f,g,m,p)}else{var v=f.data;for(d=0,_=p.length;d<_;d++)p[d]=v[d]}}else{var y=l.keyFrames[0].data;for(d=0,_=p.length;d<_;d++)p[d]=y[d]}var C=e[o];C&&(n?U._propertySetFuncs[l.propertyNameID](C,null,p):U._propertySetFuncs[l.propertyNameID](null,C,p))}},e._binarySearchEventIndex=function(e){for(var t=0,i=this._animationEvents.length-1,n=0;t<=i;){n=Math.floor((t+i)/2);var a=this._animationEvents[n].time;if(a==e)return n;e<a?i=n-1:t=n+1}return t},e.addEvent=function(e){var t=this._binarySearchEventIndex(e.time);this._animationEvents.splice(t,0,e)},e.onAsynLoaded=function(e,t,i){var n=new C(t);switch(this._version=n.readUTFString(),this._version){case"LAYAANIMATION:01":P.parse(this,n);break;case"LAYAANIMATION:02":O.parse(this,n)}this.completeCreate(),this._endLoaded()},e.disposeResource=function(){this._realTimeCurrentFrameIndexes=null,this._realTimeCurrentTimes=null,this._fullKeyframeIndicesCache=null,this._animationDatasCache=null,this._avatarDatasCache=null,this._skinnedDatasCache=null,this._version=null,this._nodes=null,this._nodesMap=null,this._cachePropertyMap=null,this._nodeToCachePropertyMap=null,this._unCachePropertyMap=null,this._publicClipDatas=null},t.load=function(e){return x.loader.create(e,null,null,t)},t}(),$i=function(){function t(){t.__super.call(this)}f(t,"laya.d3.core.Avatar",g);var e=t.prototype;return x.imps(e,{"laya.d3.core.IClone":!0}),e._initCloneToAnimator=function(e,t){t._avatarNodeMap[e.name]=e,t._avatarNodes.push(e);for(var i=0,n=e.getChildCount();i<n;i++)this._initCloneToAnimator(e.getChildByIndex(i),t)},e._parseNode=function(e,t){var i=e.props.name;if(t.name=i,t._parent){var n=e.customProps,a=t.transform;a._localRotationEuler=new Float32Array(3),a.setLocalPosition(new Float32Array(n.translate)),a.setLocalRotation(new Float32Array(n.rotation)),a.setLocalScale(new Float32Array(n.scale)),a._setWorldMatrixAndUpdate(new Float32Array(16))}for(var r=e.child,s=0,o=r.length;s<o;s++){var l=r[s],h=new U;t.addChild(h),this._parseNode(l,h)}},e.onAsynLoaded=function(e,t,i){if(this._rootNode=new U,t.version){this._version=t.version;var n=t.rootNode;n&&this._parseNode(n,this._rootNode)}else this._parseNode(t,this._rootNode);this._endLoaded()},e._cloneDatasToAnimator=function(e){var t=this._rootNode.clone();t.transform._setWorldMatrixIgnoreUpdate(null);e._avatarNodeMap={},e._avatarNodes=[],this._initCloneToAnimator(t,e)},e.cloneTo=function(e){var t=e,i=this._rootNode.clone();t._rootNode=i},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},t.load=function(e){return x.loader.create(e,null,null,t)},t}(),Ji=function(n){function e(){e.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new _i,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new ri(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}f(e,"laya.d3.core.material.BaseMaterial",n);var t=e.prototype;return x.imps(t,{"laya.d3.core.IClone":!0}),t._addShaderDefine=function(e){this._shaderDefineValue|=e},t._removeShaderDefine=function(e){this._shaderDefineValue&=~e},t._addDisablePublicShaderDefine=function(e){this._disablePublicShaderDefine|=e},t._removeDisablePublicShaderDefine=function(e){this._disablePublicShaderDefine&=~e},t._setBuffer=function(e,t){this._shaderValues.setValue(e,t),this._values[e]=t},t._getBuffer=function(e){return this._values[e]},t._setMatrix4x4=function(e,t){this._shaderValues.setValue(e,t?t.elements:null),this._values[e]=t},t._getMatrix4x4=function(e){return this._values[e]},t._setInt=function(e,t){this._shaderValues.setValue(e,t),this._values[e]=t},t._getInt=function(e){return this._values[e]},t._setNumber=function(e,t){this._shaderValues.setValue(e,t),this._values[e]=t},t._getNumber=function(e){return this._values[e]},t._setBool=function(e,t){this._shaderValues.setValue(e,t),this._values[e]=t},t._getBool=function(e){return this._values[e]},t._setVector2=function(e,t){this._shaderValues.setValue(e,t?t.elements:null),this._values[e]=t},t._getVector2=function(e){return this._values[e]},t._setColor=function(e,t){this._shaderValues.setValue(e,t?t.elements:null),this._values[e]=t},t._getColor=function(e){return this._values[e]},t._setTexture=function(e,t){var i=this._values[e];this._values[e]=t,this._shaderValues.setValue(e,t),0<this.referenceCount&&(i&&i._removeReference(),t&&t._addReference())},t._getTexture=function(e){return this._values[e]},t._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},t._getShader=function(e,t,i){var n=(e|t)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(n,i,this._shaderDefineValue),this._shader},t._setRenderStateBlendDepth=function(){var e=I.mainContext;switch(D.setDepthMask(e,this.depthWrite),0===this.depthTest?D.setDepthTest(e,!1):(D.setDepthTest(e,!0),D.setDepthFunc(e,this.depthTest)),this.blend){case 0:D.setBlend(e,!1);break;case 1:D.setBlend(e,!0),D.setBlendFunc(e,this.srcBlend,this.dstBlend);break;case 2:D.setBlend(e,!0)}},t._setRenderStateFrontFace=function(e,t){var i=I.mainContext,n=0;switch(this.cull){case 0:D.setCullFace(i,!1);break;case 1:D.setCullFace(i,!0),n=e?t&&t._isFrontFaceInvert?2305:2304:t&&t._isFrontFaceInvert?2304:2305,D.setFrontFace(i,n);break;case 2:D.setCullFace(i,!0),n=e?t&&t._isFrontFaceInvert?2304:2305:t&&t._isFrontFaceInvert?2305:2304,D.setFrontFace(i,n)}},t.onAsynLoaded=function(e,t,i){var n=t[0],a=t[1];switch(n.version){case"LAYAMATERIAL:01":var r=0,s=0,o=n.props;for(var l in o)switch(l){case"vectors":var h=o[l];for(r=0,s=h.length;r<s;r++){var c=h[r],u=c.value;switch(u.length){case 2:this[c.name]=new ni(u[0],u[1]);break;case 3:this[c.name]=new ai(u[0],u[1],u[2]);break;case 4:this[c.name]=new ri(u[0],u[1],u[2],u[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var d=o[l];for(r=0,s=d.length;r<s;r++){var _=d[r],p=_.path;p&&(this[_.name]=Me.getRes(a[p]))}break;case"defines":var f=o[l];for(r=0,s=f.length;r<s;r++){var m=this._shaderCompile.getMaterialDefineByName(f[r]);this._addShaderDefine(m)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[l]=o[l];break;case"renderQueue":switch(o[l]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[l]=o[l]}break;case"LAYAMATERIAL:02":for(l in o=n.props)switch(l){case"vectors":for(r=0,s=(h=o[l]).length;r<s;r++)switch((u=(c=h[r]).value).length){case 2:this[c.name]=new ni(u[0],u[1]);break;case 3:this[c.name]=new ai(u[0],u[1],u[2]);break;case 4:this[c.name]=new ri(u[0],u[1],u[2],u[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(r=0,s=(d=o[l]).length;r<s;r++)(p=(_=d[r]).path)&&(this[_.name]=Me.getRes(a[p]));break;case"defines":for(r=0,s=(f=o[l]).length;r<s;r++)m=this._shaderCompile.getMaterialDefineByName(f[r]),this._addShaderDefine(m);break;default:this[l]=o[l]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},t._addReference=function(){n.prototype._addReference.call(this);for(var e=0,t=this._values.length;e<t;e++){var i=this._values[e];i&&i instanceof laya.d3.resource.BaseTexture&&i._addReference()}},t._removeReference=function(){n.prototype._removeReference.call(this);for(var e=0,t=this._values.length;e<t;e++){var i=this._values[e];i&&i instanceof laya.d3.resource.BaseTexture&&i._removeReference()}},t.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null;for(var e=0,t=this._values.length;e<t;e++){var i=this._values[e];i&&i instanceof laya.d3.resource.BaseTexture&&i._removeReference()}this._values=null},t.setShaderName=function(e){var t=Tn.nameKey.getID(e);if(-1===t)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=Yi._preCompileShader[t]},t.cloneTo=function(e){var t=e;t.name=this.name,t.cull=this.cull,t.blend=this.blend,t.srcBlend=this.srcBlend,t.dstBlend=this.dstBlend,t.srcBlendRGB=this.srcBlendRGB,t.dstBlendRGB=this.dstBlendRGB,t.srcBlendAlpha=this.srcBlendAlpha,t.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(t.blendConstColor),t.blendEquation=this.blendEquation,t.blendEquationRGB=this.blendEquationRGB,t.blendEquationAlpha=this.blendEquationAlpha,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.renderQueue=this.renderQueue,t._shader=this._shader,t._disablePublicShaderDefine=this._disablePublicShaderDefine,t._shaderDefineValue=this._shaderDefineValue;var i,n=0,a=t._shaderValues;t._shaderValues.data.length=this._shaderValues.data.length;var r=this._values.length,s=t._values;for(n=0,i=s.length=r;n<i;n++){var o=this._values[n];if(o)if("number"==typeof o)s[n]=o,a.data[n]=o;else if("number"==typeof o&&Math.floor(o)==o)s[n]=o,a.data[n]=o;else if("boolean"==typeof o)s[n]=o,a.data[n]=o;else if(o instanceof laya.d3.math.Vector2){var l=s[n]||(s[n]=new ni);o.cloneTo(l),a.data[n]=l.elements}else if(o instanceof laya.d3.math.Vector3){var h=s[n]||(s[n]=new ai);o.cloneTo(h),a.data[n]=h.elements}else if(o instanceof laya.d3.math.Vector4){var c=s[n]||(s[n]=new ri);o.cloneTo(c),a.data[n]=c.elements}else if(o instanceof laya.d3.math.Matrix4x4){var u=s[n]||(s[n]=new qt);o.cloneTo(u),a.data[n]=u.elements}else o instanceof laya.d3.resource.BaseTexture&&(s[n]=o,a.data[n]=o)}},t.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},v(0,t,"alphaTestValue",function(){return this._getNumber(0)},function(e){this._setNumber(0,e)}),v(0,t,"alphaTest",function(){return this._alphaTest},function(e){(this._alphaTest=e)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),e.__init__=function(){e.SHADERDEFINE_ALPHATEST=e.shaderDefines.registerDefine("ALPHATEST")},e.RENDERQUEUE_OPAQUE=2e3,e.RENDERQUEUE_ALPHATEST=2450,e.RENDERQUEUE_TRANSPARENT=3e3,e.CULL_NONE=0,e.CULL_FRONT=1,e.CULL_BACK=2,e.BLEND_DISABLE=0,e.BLEND_ENABLE_ALL=1,e.BLEND_ENABLE_SEPERATE=2,e.BLENDPARAM_ZERO=0,e.BLENDPARAM_ONE=1,e.BLENDPARAM_SRC_COLOR=768,e.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,e.BLENDPARAM_DST_COLOR=774,e.BLENDPARAM_ONE_MINUS_DST_COLOR=775,e.BLENDPARAM_SRC_ALPHA=770,e.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,e.BLENDPARAM_DST_ALPHA=772,e.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,e.BLENDPARAM_SRC_ALPHA_SATURATE=776,e.BLENDEQUATION_ADD=0,e.BLENDEQUATION_SUBTRACT=1,e.BLENDEQUATION_REVERSE_SUBTRACT=2,e.DEPTHTEST_OFF=0,e.DEPTHTEST_NEVER=512,e.DEPTHTEST_LESS=513,e.DEPTHTEST_EQUAL=514,e.DEPTHTEST_LEQUAL=515,e.DEPTHTEST_GREATER=516,e.DEPTHTEST_NOTEQUAL=517,e.DEPTHTEST_GEQUAL=518,e.DEPTHTEST_ALWAYS=519,e.SHADERDEFINE_ALPHATEST=1,e.ALPHATESTVALUE=0,u(e,["shaderDefines",function(){return this.shaderDefines=new hi}]),e}(g),en=function(){function e(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,e.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}f(e,"laya.d3.resource.BaseTexture",g);var t=e.prototype;return v(0,t,"width",function(){return this._width}),v(0,t,"repeat",function(){return this._repeat},function(e){if(this._repeat!==e&&(this._repeat=e,this._source)){var t=I.mainContext;D.bindTexture(t,this._type,this._source),m.isPOT(this._width,this._height)&&this._repeat?(t.texParameteri(this._type,10242,10497),t.texParameteri(this._type,10243,10497)):(t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071))}}),v(0,t,"height",function(){return this._height}),v(0,t,"magFifter",function(){return this._magFifter},function(e){(this._magFifter=e)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(e)}),v(0,t,"wrapModeV",function(){return this._wrapModeV}),v(0,t,"size",function(){return this._size}),v(0,t,"wrapModeU",function(){return this._wrapModeU}),v(0,t,"mipmap",function(){return this._mipmap},function(e){this._mipmap=e,this._mipmap!=e&&this._conchTexture&&this._conchTexture.setMipMap(e)}),v(0,t,"minFifter",function(){return this._minFifter},function(e){this._minFifter=e,this._minFifter!=e&&this._conchTexture&&this._conchTexture.setMinFifter(e)}),v(0,t,"format",function(){return this._format}),v(0,t,"source",function(){return this.activeResource(),this._source}),v(0,t,"defaulteTexture",function(){return jn.grayTexture}),e.WARPMODE_REPEAT=0,e.WARPMODE_CLAMP=1,e}(),tn=function(){function e(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,e.__super.call(this),this._boundingBoxCorners=T(8,null)}f(e,"laya.d3.resource.models.BaseMesh",g);var t=e.prototype;return t._getPositions=function(){throw new Error("未Override,请重载该属性！")},t._generateBoundingObject=function(){this._boundingSphere=new Gt(new ai,0),Gt.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new Ht(new ai,new ai),Ht.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},t.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},t.getRenderElement=function(e){throw new Error("未Override,请重载该属性！")},v(0,t,"subMeshCount",function(){return this._subMeshCount}),v(0,t,"boundingBox",function(){return this._boundingBox}),v(0,t,"boundingBoxCorners",function(){return this._boundingBoxCorners}),v(0,t,"boundingSphere",function(){return this._boundingSphere}),e}(),nn=(f(an,"laya.d3.terrain.TerrainHeightData",g),an.prototype.onAsynLoaded=function(e,t,i){var n;this._width=i[0],this._height=i[1],this._bitType=i[2],this._value=i[3];var a=NaN;8==this._bitType?(n=new Uint8Array(t),a=1/255):16==this._bitType&&(n=new Int16Array(t),a=1/32766),this._terrainHeightData=new Float32Array(this._height*this._width);for(var r=0,s=this._height*this._width;r<s;r++)this._terrainHeightData[r]=n[r]*a*this._value/2;this._endLoaded()},an.load=function(e,t,i,n,a){return x.loader.create(e,null,null,an,[t,i,n,a],1,!1)},an);function an(){this._terrainHeightData=null,this._width=0,this._height=0,this._bitType=0,this._value=NaN,an.__super.call(this)}var rn,sn=function(){function t(){this._version=NaN,this._cameraCoordinateInverse=!1,this._gridSize=NaN,this._chunkNumX=0,this._chunkNumZ=0,this._heightDataX=0,this._heightDataZ=0,this._heightDataBitType=0,this._heightDataValue=NaN,this._heightDataUrl=null,this._detailTextureInfos=null,this._chunkInfos=null,this._heightData=null,this._materialInfo=null,this._alphaMaps=null,this._normalMaps=null,t.__super.call(this)}f(t,"laya.d3.terrain.TerrainRes",g);var e=t.prototype;return e.parseData=function(e){var t=e[0],i=e[1];if(this._version=t.version,1==this._version){this._cameraCoordinateInverse=t.cameraCoordinateInverse,this._gridSize=t.gridSize,this._chunkNumX=t.chunkNumX,this._chunkNumZ=t.chunkNumZ;var n=t.heightData;if(this._heightDataX=n.numX,this._heightDataZ=n.numZ,this._heightDataBitType=n.bitType,this._heightDataValue=n.value,this._heightDataUrl=i[n.url],this._materialInfo=new Ci,t.material){var a=t.material.ambient,r=t.material.diffuse,s=t.material.specular;this._materialInfo.ambientColor=new ai(a[0],a[1],a[2]),this._materialInfo.diffuseColor=new ai(r[0],r[1],r[2]),this._materialInfo.specularColor=new ri(s[0],s[1],s[2],s[3])}var o=t.detailTexture;this._detailTextureInfos=T(o.length);for(var l=0;l<o.length;l++){var h=o[l],c=new vi;c.diffuseTexture=i[h.diffuse],c.normalTexture=h.normal?i[h.normal]:null,h.scale?c.scale=new ni(h.scale[0],h.scale[1]):c.scale=new ni(1,1),h.offset?c.offset=new ni(h.offset[0],h.offset[1]):c.offset=new ni(0,0),this._detailTextureInfos[l]=c}var u=t.alphaMap;for(this._alphaMaps=T(u.length),l=0;l<this._alphaMaps.length;l++)this._alphaMaps[l]=t.alphaMap[l];var d=t.normalMap;for(this._normalMaps=T(d.length),l=0;l<this._normalMaps.length;l++)this._normalMaps[l]=t.normalMap[l];var _=t.chunkInfo;if(this._chunkNumX*this._chunkNumZ!=_.length)return alert("terrain data error"),!1;for(this._chunkInfos=T(_.length),l=0;l<_.length;l++){var p=_[l],f=new mi,m=p.alphaMap.length,g=p.detailID.length;if(m!=g)return alert("terrain chunk data error"),!1;f.alphaMap=T(m),f.detailID=T(g),f.normalMap=i[this._normalMaps[p.normalMap]];for(var v=0;v<m;v++){f.alphaMap[v]=i[this._alphaMaps[p.alphaMap[v]]];var y=p.detailID[v],C=y.length;f.detailID[v]=new Uint8Array(C);for(var E=0;E<C;E++)f.detailID[v][E]=y[E]}this._chunkInfos[l]=f}this._heightData=Me.getRes(this._heightDataUrl),this.onLoadTerrainComplete(this._heightData)}return!0},e.onLoadTerrainComplete=function(e){this._endLoaded()},e.onAsynLoaded=function(e,t,i){this.parseData(t)},t.load=function(e){return x.loader.create(e,null,null,t,null,1,!1)},t}(),on=function(t){function e(){this._player=null,this._templet=null,e.__super.call(this),this._player=new n}f(e,"laya.d3.component.animation.KeyframeAnimations",t);var i=e.prototype;return i._updateAnimtionPlayer=function(){this._player._update(x.timer.delta)},i._addUpdatePlayerToTimer=function(){x.timer.frameLoop(1,this,this._updateAnimtionPlayer)},i._removeUpdatePlayerToTimer=function(){x.timer.clear(this,this._updateAnimtionPlayer)},i._onOwnerActiveHierarchyChanged=function(e){this._owner.displayedInStage&&(e?this._addUpdatePlayerToTimer():this._removeUpdatePlayerToTimer())},i._load=function(e){e.activeInHierarchy&&this._addUpdatePlayerToTimer(),e.on("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged)},i._unload=function(e){t.prototype._unload.call(this,e),e.activeInHierarchy&&this._removeUpdatePlayerToTimer(),e.off("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged),this._player._destroy(),this._player=null,this._templet=null},v(0,i,"url",null,function(e){console.log("Warning: discard property,please use templet property instead.");var t=x.loader.create(e,null,null,a);this._templet!==t&&(0!==this._player.state&&this._player.stop(!0),this._templet=t,this._player.templet=t,this.event("animationchanged",this))}),v(0,i,"player",function(){return this._player}),v(0,i,"templet",function(){return this._templet},function(e){this._templet!==e&&(0!==this._player.state&&this._player.stop(!0),this._templet=e,this._player.templet=e,this.event("animationchanged",this))}),v(0,i,"currentFrameIndex",function(){return this._player.currentKeyframeIndex}),v(0,i,"currentAnimationClipIndex",function(){return this._player.currentAnimationClipIndex}),v(0,i,"nodeCount",function(){return this._templet.getNodeCount(this._player.currentAnimationClipIndex)}),e}(Ni),ln=function(i){function c(){c.__super.call(this),this._clipNames=[],this._clips=[],this._playStartFrames=[],this._playEndFrames=[],this._cacheNodesSpriteOwners=[],this._cacheNodesAvatarOwners=[],this._cacheNodesDefaultlValues=[],this._cacheNodesToSpriteMap=[],this._cacheSpriteToNodesMap=[],this._cacheFullFrames=[],this._publicClipsDatas=[],this._playEventIndex=-1,this._updateTransformPropertyLoopCount=-1,this._lastFrameIndex=-1,this._defaultClipIndex=-1,this._cachePlayRate=1,this._currentPlayClip=null,this._currentFrameIndex=-1,this._currentTime=0,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this.isCache=!0,this.cacheFrameRate=60,this.playbackRate=1,this.playOnWake=!0}f(c,"laya.d3.component.Animator",i);var e=c.prototype;return x.imps(e,{"laya.resource.IDestroy":!0}),e._getAvatarOwnersByClip=function(e){var t=this._clips[e]._nodes,i=t.length,n=this._cacheNodesAvatarOwners[e];n.length=i;var a=this._cacheNodesDefaultlValues[e];a.length=i;for(var r=0;r<i;r++){for(var s=this._avatarNodes[0],o=t[r],l=o.path,h=0,c=l.length;h<c;h++){var u=l[h];if(""===u)break;if(!(s=s.getChildByName(u)))break}if(s){n[r]=s;var d=U._propertyGetFuncs[o.propertyNameID](s);if(d){var _=new Float32Array(o.keyFrameWidth);for(a[r]=_,h=0,c=d.length;h<c;h++)_[h]=d[h]}}}},e._handleSpriteOwnersByClip=function(e){var t=this._clips[e]._nodes,i=t.length,n=this._cacheNodesSpriteOwners[e];n.length=i;var a=this._cacheNodesDefaultlValues[e];a.length=i;for(var r=0;r<i;r++){var s=this._owner,o=t[r],l=o.path,h=0,c=0;for(h=0,c=l.length;h<c;h++){var u=l[h];if(""===u)break;if(!(s=s.getChildByName(u)))break}if(s){n[r]=s;var d=U._propertyGetFuncs[o.propertyNameID](null,s);if(d){var _=new Float32Array(o.keyFrameWidth);for(a[r]=_,h=0,c=d.length;h<c;h++)_[h]=d[h]}}}},e._offClipAndAvatarRelateEvent=function(e,t){e.loaded?t.loaded||t.off("loaded",this,this._getAvatarOwnersByClip):e.off("loaded",this,this._getAvatarOwnersAndInitDatasAsync)},e._getAvatarOwnersByClipAsync=function(e,t){t.loaded?this._getAvatarOwnersByClip(e):t.once("loaded",this,this._getAvatarOwnersByClip,[e])},e._offGetSpriteOwnersByClipAsyncEvent=function(e){e.loaded||e.off("loaded",this,this._getSpriteOwnersByClipAsync)},e._getSpriteOwnersByClipAsync=function(e,t){t.loaded?this._handleSpriteOwnersByClip(e):t.once("loaded",this,this._handleSpriteOwnersByClip,[e])},e._getAvatarOwnersAndInitDatasAsync=function(){for(var e=0,t=this._clips.length;e<t;e++)this._getAvatarOwnersByClipAsync(e,this._clips[e]);for(this._avatar._cloneDatasToAnimator(this),e=0,t=this._avatarNodes.length;e<t;e++)this._checkAnimationNode(this._avatarNodes[e],this._owner)},e._offGetClipCacheFullKeyframeIndicesEvent=function(e){e.loaded||e.off("loaded",this,this._computeCacheFullKeyframeIndices)},e._computeCacheFullKeyframeIndices=function(e){var t=this._clips[e],i=this._cacheFrameRateInterval*this._cachePlayRate,n=t._getFullKeyframeIndicesWithCache(i);if(n)this._cacheFullFrames[e]=n;else{n=this._cacheFullFrames[e]=[];var a=t._nodes,r=a.length;n.length=r;for(var s=Math.ceil(t._duration/i-1e-5)+1,o=0;o<r;o++){var l=a[o],h=new Int32Array(s);h.fill(-1);for(var c=l.keyFrames,u=0,d=c.length;u<d;u++)for(var _=c[u],p=_.startTime,f=p+_.duration;p<=f;){h[Math.ceil(p/i-1e-5)]=u,p+=i}n[o]=h}t._cacheFullKeyframeIndices(i,n)}},e._updateAnimtionPlayer=function(){this._updatePlayer(x.timer.delta/1e3)},e._onOwnerActiveHierarchyChanged=function(){this._owner.activeInHierarchy?(x.timer.frameLoop(1,this,this._updateAnimtionPlayer),this.playOnWake&&this.clip&&this.play()):(0!==this.playState&&(this._stoped=!0),x.timer.clear(this,this._updateAnimtionPlayer))},e._eventScript=function(e,t){for(var i=this._currentPlayClip._animationEvents,n=i.length;this._playEventIndex<n;this._playEventIndex++){var a=i[this._playEventIndex],r=a.time;if(!(e<=r&&r<t))break;for(var s=this._owner._scripts,o=0,l=s.length;o<l;o++){var h=s[o],c=h[a.eventName];c&&c.apply(h,a.params)}}},e._setPlayParams=function(e,t){var i=this._currentTime;this._currentTime=e,this._currentFrameIndex=Math.max(Math.floor(this.currentPlayTime/t-1e-5),0),this._currentFrameTime=this._currentFrameIndex*t,this._eventScript(i,e)},e._setPlayParamsWhenStop=function(e,t){var i=this._currentTime;this._currentTime=e,this._currentFrameIndex=Math.max(Math.floor(e/t-1e-5),0),this._currentFrameTime=this._currentFrameIndex*t,this._eventScript(i,e),this._currentPlayClip=null},e._revertKeyframeNodes=function(e,t){var i=this._cacheNodesDefaultlValues[t],n=e._nodes;if(this._avatar)for(var a=this._cacheNodesAvatarOwners[t],r=0,s=a.length;r<s;r++){var o=a[r];o&&U._propertySetFuncs[n[r].propertyNameID](o,null,i[r])}else{var l=this._cacheNodesSpriteOwners[t];for(r=0,s=l.length;r<s;r++){var h=l[r];h&&U._propertySetFuncs[n[r].propertyNameID](null,h,i[r])}}},e._onAnimationStop=function(){var e,t,i,n=0,a=0;this._lastFrameIndex=-1;var r=this._currentPlayClip._nodes;if(this._avatar){var s=this._cacheNodesAvatarOwners[this._currentPlayClipIndex];for(n=0,a=s.length;n<a;n++){var o=s[n];i=(t=(e=r[n]).keyFrames)[t.length-1].data,o&&U._propertySetFuncs[e.propertyNameID](o,null,i)}}else{var l=this._cacheNodesSpriteOwners[this._currentPlayClipIndex];for(n=0,a=l.length;n<a;n++){var h=l[n];i=(t=(e=r[n]).keyFrames)[t.length-1].data,h&&U._propertySetFuncs[e.propertyNameID](null,h,i)}}},e._setAnimationClipPropertyToAnimationNode=function(e,t,i){for(var n=0,a=t.length;n<a;n++){var r=t[n],s=e[r];if(s){var o=this._currentPlayClip._nodes[r],l=i[r];l&&U._propertySetFuncs[o.propertyNameID](s,null,l)}}},e._setAnimationClipPropertyToSprite3D=function(e,t){for(var i=0,n=e.length;i<n;i++){var a=e[i];if(a){var r=this._currentPlayClip._nodes[i],s=t[i];s&&U._propertySetFuncs[r.propertyNameID](null,a,s)}}},e._handleSpriteOwnersBySprite=function(e,t,i,n){var a=this._clips[e],r=i.join("/"),s=a._nodesMap[r];if(s)for(var o=this._cacheNodesSpriteOwners[e],l=a._nodes,h=this._cacheNodesDefaultlValues[e],c=0,u=s.length;c<u;c++){var d=s[c],_=l.indexOf(d);if(t){o[_]=n;var p=U._propertyGetFuncs[d.propertyNameID](null,n);if(p){var f=h[_];f||(h[_]=f=new Float32Array(d.keyFrameWidth));for(var m=0,g=p.length;m<g;m++)f[m]=p[m]}}else o[_]=null}},e._evaluateAvatarNodesCacheMode=function(e,t,i,n,a){t._evaluateAnimationlDatasCacheMode(e,this._cacheFullFrames[this._currentPlayClipIndex],this,i,a),this._setAnimationClipPropertyToAnimationNode(e,a,i);for(var r=0,s=this._avatarNodes.length;r<s;r++){var o=this._avatarNodes[r].transform;if(o._worldUpdate){var l=new Float32Array(16);n[r]=l,o._setWorldMatrixAndUpdate(l)}else{var h=o.getWorldMatrix();n[r]=h||c.deafaultMatrix}}},e._evaluateAvatarNodesRealTime=function(e,t,i,n,a){t._evaluateAnimationlDatasRealTime(e,this.currentPlayTime,i,a),this._setAnimationClipPropertyToAnimationNode(e,a,i);for(var r=0,s=this._avatarNodes.length;r<s;r++){var o=this._avatarNodes[r].transform;o._worldUpdate?o._setWorldMatrixNoUpdate(n[r]):n[r]=c.deafaultMatrix}},e._updateAvatarNodesToSpriteCacheMode=function(e,t){for(var i=0,n=this._cacheSpriteToNodesMap.length;i<n;i++){var a=this._cacheSpriteToNodesMap[i],r=t[a];if(r!==c.deafaultMatrix){var s=this._avatarNodes[a].transform._entity,o=s.worldMatrix;Li.matrix4x4MultiplyMFM(this._owner._transform.worldMatrix,r,o),s.worldMatrix=o}}},e._updateAvatarNodesToSpriteRealTime=function(){for(var e=0,t=this._cacheSpriteToNodesMap.length;e<t;e++){var i=this._avatarNodes[this._cacheSpriteToNodesMap[e]],n=i.transform._entity,a=i.transform;if(a._worldUpdate){var r=c._tempMatrix4x40;a._setWorldMatrixAndUpdate(r);var s=n.worldMatrix;Li.matrix4x4MultiplyMFM(this._owner._transform.worldMatrix,r,s),n.worldMatrix=s}}},e._updatePlayer=function(e){if(null!=this._currentPlayClip&&!this._stoped&&this._currentPlayClip.loaded){var t=this._cacheFrameRateInterval*this._cachePlayRate,i=0;this._startUpdateLoopCount!==w.loopCount&&(i=e*this.playbackRate,this._elapsedPlaybackTime+=i);var n=this._currentPlayClip._frameRate,a=this._playStartFrames[this._currentPlayClipIndex]/n,r=Math.min(this._playEndFrames[this._currentPlayClipIndex]/n,this._currentPlayClip._duration)-a;if(!this._currentPlayClip.islooping&&this._elapsedPlaybackTime>=r)return this._onAnimationStop(),this._setPlayParamsWhenStop(r,t),void this.event("stopped");if(i+=this._currentTime,0<r)if(r<=i)for(;(i-=r)<r&&(this._setPlayParams(i,t),this.event("complete")),this._playEventIndex=0,this._eventScript(0,i),r<=i;);else this._setPlayParams(i,t);else this._currentTime=this._currentFrameTime=this._currentFrameIndex=this._playEventIndex=0,this.event("complete")}},e._update=function(e){var t=this._currentPlayClip;if(2===this.playState&&t&&t.loaded){var i=this.playbackRate*x.timer.scale,n=this._cachePlayRate;this._canCache=this.isCache&&n<=i;var a,r=-1;if(this._canCache){if(r=this._currentFrameIndex,this._lastFrameIndex===r)return;if(a=t._getAnimationDataWithCache(n,r),this._avatar){var s=this._cacheNodesAvatarOwners[this._currentPlayClipIndex],o=t._cachePropertyMap,l=o.length;0<l&&(a||((a=[]).length=l,t._cacheAnimationData(n,r,a),t._evaluateAnimationlDatasCacheMode(s,this._cacheFullFrames[this._currentPlayClipIndex],this,a,o)),this._setAnimationClipPropertyToAnimationNode(s,o,a)),this._curAvatarNodeDatas=t._getAvatarDataWithCache(this._avatar,this._cachePlayRate,r),this._curAvatarNodeDatas||(this._curAvatarNodeDatas=[],this._curAvatarNodeDatas.length=this._avatarNodes.length,t._cacheAvatarData(this._avatar,this._cachePlayRate,r,this._curAvatarNodeDatas),this._evaluateAvatarNodesCacheMode(s,t,t._publicClipDatas,this._curAvatarNodeDatas,t._unCachePropertyMap)),this._updateAvatarNodesToSpriteCacheMode(t,this._curAvatarNodeDatas)}else{var h=this._cacheNodesSpriteOwners[this._currentPlayClipIndex];a||((a=[]).length=this._currentPlayClip._nodes.length,t._evaluateAnimationlDatasCacheMode(h,this._cacheFullFrames[this._currentPlayClipIndex],this,a,null),t._cacheAnimationData(n,r,a)),this._setAnimationClipPropertyToSprite3D(h,a)}}else if(a=t._publicClipDatas,this._avatar){if(t._evaluateAnimationlDatasRealTime(this._cacheNodesAvatarOwners[this._currentPlayClipIndex],this.currentPlayTime,a,t._cachePropertyMap),!this._publicAvatarNodeDatas){this._publicAvatarNodeDatas=[];var c=this._avatarNodes.length;this._publicAvatarNodeDatas.length=c;for(var u=1;u<c;u++)this._publicAvatarNodeDatas[u]=new Float32Array(16)}this._curAvatarNodeDatas=this._publicAvatarNodeDatas,this._evaluateAvatarNodesRealTime(this._cacheNodesAvatarOwners[this._currentPlayClipIndex],t,a,this._curAvatarNodeDatas,t._unCachePropertyMap),this._updateAvatarNodesToSpriteRealTime()}else t._evaluateAnimationlDatasRealTime(this._cacheNodesSpriteOwners[this._currentPlayClipIndex],this.currentPlayTime,a,null);this._lastFrameIndex=r}},e._checkAnimationNode=function(e,t){e.name!==t.name||t._transform.dummy||t._isLinkSpriteToAnimationNode(this,e,!0);for(var i=0,n=t._childs.length;i<n;i++)this._checkAnimationNode(e,t.getChildAt(i))},e._load=function(e){e.activeInHierarchy&&x.timer.frameLoop(1,this,this._updateAnimtionPlayer),this._owner.on("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged)},e._unload=function(e){i.prototype._unload.call(this,e),e.activeInHierarchy&&x.timer.clear(this,this._updateAnimtionPlayer),this._owner.off("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged),this._curAvatarNodeDatas=null},e._destroy=function(){i.prototype._destroy.call(this);for(var e=0,t=this._clips.length;e<t;e++)this._clips[e]._removeReference();this._currentPlayClip=null,this._clipNames=null,this._cacheNodesSpriteOwners=null,this._cacheNodesAvatarOwners=null,this._cacheNodesDefaultlValues=null,this._clips=null,this._cacheFullFrames=null},e._cloneTo=function(e){var t=e;t.avatar=this.avatar;this._clips.length;for(var i=0,n=this._clips.length;i<n;i++)t.addClip(this._clips[i]);if(this.clip&&(t.clip=this.clip),this._linkSpritesData)for(var a in t._linkSpritesData={},this._linkSpritesData)t._linkSpritesData[a]=this._linkSpritesData[a].slice()},e.addClip=function(e,t,i,n){void 0===i&&(i=0),void 0===n&&(n=4294967295),t=t||e.name;var a=this._clipNames.indexOf(t);if(-1!==a){if(this._clips[a]!==e)throw new Error("Animation:this playName has exist with another clip.")}else{var r=this._clips.indexOf(e);if(i<0||n<0)throw new Error("Animator:startFrame and endFrame must large than zero.");if(n<i)throw new Error("Animator:startFrame must less than endFrame.");this._clipNames.push(t),this._clips.push(e),this._playStartFrames.push(i),this._playEndFrames.push(n),this._cacheNodesSpriteOwners.push([]),this._cacheNodesAvatarOwners.push([]),this._cacheNodesDefaultlValues.push([]),this._publicClipsDatas.push([]),e._addReference(),r=this._clips.length-1,this._avatar?this._avatar.loaded?this._getAvatarOwnersByClipAsync(r,e):this._avatar.once("loaded",this,this._getAvatarOwnersByClipAsync,[r,e]):this._getSpriteOwnersByClipAsync(r,e),e.loaded?this._computeCacheFullKeyframeIndices(r):e.once("loaded",this,this._computeCacheFullKeyframeIndices,[r])}},e.removeClip=function(e){var t=this._clips.indexOf(e);-1!==t&&(this._avatar?this._offClipAndAvatarRelateEvent(this._avatar,e):this._offGetSpriteOwnersByClipAsyncEvent(e),this._offGetClipCacheFullKeyframeIndicesEvent(e),this._clipNames.splice(t,1),this._clips.splice(t,1),this._playStartFrames.splice(t,1),this._playEndFrames.splice(t,1),this._cacheNodesSpriteOwners.splice(t,1),this._cacheNodesAvatarOwners.splice(t,1),this._cacheNodesDefaultlValues.splice(t,1),this._publicClipsDatas.splice(t,1),e._removeReference())},e.removeClipByName=function(e){var t=this._clipNames.indexOf(e);if(-1!==t){var i=this._clips[t];this._avatar?this._offClipAndAvatarRelateEvent(this._avatar,i):this._offGetSpriteOwnersByClipAsyncEvent(i),this._offGetClipCacheFullKeyframeIndicesEvent(i),this._clipNames.splice(t,1),this._clips.splice(t,1),this._playStartFrames.splice(t,1),this._playEndFrames.splice(t,1),this._cacheNodesSpriteOwners.splice(t,1),this._cacheNodesAvatarOwners.splice(t,1),this._cacheNodesDefaultlValues.splice(t,1),this._publicClipsDatas.splice(t,1)}},e.getClip=function(e){var t=this._clipNames.indexOf(e);return-1!==t?this._clips[t]:null},e.getClipCount=function(){return this._clips.length},e.play=function(e,t){if(void 0===t&&(t=1),!e&&-1==this._defaultClipIndex)throw new Error("Animator:must have  default clip value,please set clip property.");e?(this._currentPlayClipIndex=this._clipNames.indexOf(e),this._currentPlayClip=this._clips[this._currentPlayClipIndex]):(this._currentPlayClipIndex=this._defaultClipIndex,this._currentPlayClip=this._clips[this._defaultClipIndex]),this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this._playEventIndex=0,this.playbackRate=t,this._stoped=!1,this._currentFrameIndex=0,this._startUpdateLoopCount=w.loopCount,this._lastPlayAnimationClip&&this._lastPlayAnimationClip!==this._currentPlayClip&&this._revertKeyframeNodes(this._lastPlayAnimationClip,this._lastPlayAnimationClipIndex),this._updatePlayer(0),this._lastPlayAnimationClip=this._currentPlayClip,this._lastPlayAnimationClipIndex=this._currentPlayClipIndex},e.stop=function(){0!==this.playState&&(this._stoped=!0,this.event("stopped"))},e._getLinkSpritePath=function(e,t){t.unshift(e.name);var i=e._parent;i._hierarchyAnimator===this?this._getLinkSpritePath(i,t):t.shift()},e.linkSprite3DToAvatarNode=function(e,t){if(t._hierarchyAnimator!==this)throw"Animator:sprite3D must belong to this Animator";if(this._avatar){var i=this._avatarNodeMap[e];if(i){this._linkSpritesData=this._linkSpritesData||{};var n=[];return this._getLinkSpritePath(t,n),this._linkSpritesData[e]=n,t._isLinkSpriteToAnimationNode(this,i,!0),!0}return!1}return!1},e.unLinkSprite3DToAvatarNode=function(e){if(this._avatar){var t=e.transform.dummy;if(t){var i=this._avatarNodeMap[t._owner.name];return e._isLinkSpriteToAnimationNode(this,i,!1),!0}return!1}return!1},v(0,e,"playState",function(){return null==this._currentPlayClip?0:this._stoped?0:2}),v(0,e,"avatar",function(){return this._avatar},function(e){if(this._avatar!==e){var t=this._avatar;this._avatar=e;for(var i=this._clips.length,n=0;n<i;n++)this._offClipAndAvatarRelateEvent(t,this._clips[n]);e&&(e.loaded?this._getAvatarOwnersAndInitDatasAsync():e.once("loaded",this,this._getAvatarOwnersAndInitDatasAsync))}}),v(0,e,"cacheFrameRate",function(){return this._cacheFrameRate},function(e){if(this._cacheFrameRate!==e){this._cacheFrameRate=e,this._cacheFrameRateInterval=1/this._cacheFrameRate;for(var t=0,i=this._clips.length;t<i;t++)this._clips[t].loaded&&this._computeCacheFullKeyframeIndices(t)}}),v(0,e,"clip",function(){return this._clips[this._defaultClipIndex]},function(e){var t=e?this._clips.indexOf(e):-1;this._defaultClipIndex!==t&&(-1!==this._defaultClipIndex&&this.removeClip(this._clips[this._defaultClipIndex]),-1!==t&&this.addClip(e,e.name),this._defaultClipIndex=t)}),v(0,e,"currentFrameIndex",function(){return this._currentFrameIndex}),v(0,e,"cachePlayRate",function(){return this._cachePlayRate},function(e){if(this._cachePlayRate!==e){this._cachePlayRate=e;for(var t=0,i=this._clips.length;t<i;t++)this._clips[t].loaded&&this._computeCacheFullKeyframeIndices(t)}}),v(0,e,"currentFrameTime",function(){return this._currentFrameTime}),v(0,e,"currentPlayClip",function(){return this._currentPlayClip}),v(0,e,"currentPlayTime",function(){return this._currentTime+this._playStartFrames[this._currentPlayClipIndex]/this._currentPlayClip._frameRate}),v(0,e,"playbackTime",null,function(e){if(null!=this._currentPlayClip&&this._currentPlayClip&&this._currentPlayClip.loaded){this._startUpdateLoopCount=w.loopCount;var t=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=e,this._currentFrameIndex=Math.floor(this.currentPlayTime/t),this._currentFrameTime=this._currentFrameIndex*t}}),v(0,e,"paused",function(){return this._stoped},function(e){(this._stoped=e)&&this.event("paused")}),u(c,["deafaultMatrix",function(){return this.deafaultMatrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new Float32Array(16)}]),c}(Ni),hn=(function(t){function e(){this._attachSkeleton=null,this._extenData=null,this.attachBones=null,this.matrixs=null,e.__super.call(this),this.attachBones=[],this.matrixs=[]}f(e,"laya.d3.component.AttachPoint",t);var i=e.prototype;i._load=function(e){t.prototype._load.call(this,e),this._attachSkeleton=e.getComponentByType(Bn)},i._update=function(e){if(this._attachSkeleton&&!this._attachSkeleton.destroyed&&0!==this._attachSkeleton.player.state&&this._attachSkeleton.curBonesDatas){var t=this._attachSkeleton.player,i=this._attachSkeleton.templet;this.matrixs.length=this.attachBones.length;for(var n=this._attachSkeleton.curBonesDatas,a=this.owner.transform.worldMatrix,r=0,s=this.attachBones.length;r<s;r++){for(var o=16*i.getNodeIndexWithName(t.currentAnimationClipIndex,this.attachBones[r]),l=this.matrixs[r],h=(l=l||(this.matrixs[r]=new qt)).elements,c=0;c<16;c++)h[c]=n[o+c];qt.multiply(a,l,l)}this.event("complete")}}}(Ni),function(e){function t(){t.__super.call(this),this._isRigidbody=!1,this._runtimeCollisonMap={},this._runtimeCollisonTestMap={},this._ignoreCollisonMap={},this.isTrigger=!0}f(t,"laya.d3.component.physics.Collider",e);var i=t.prototype;return i._clearCollsionMap=function(){for(var e in this._runtimeCollisonMap){var t=this._runtimeCollisonMap[e];delete t._runtimeCollisonMap[this.id],t._isRigidbody&&delete t._runtimeCollisonTestMap[this.id];var i=t.id;delete this._runtimeCollisonMap[i],this._isRigidbody&&delete this._runtimeCollisonTestMap[i]}},i._unload=function(e){for(var t in this._runtimeCollisonMap){var i=this._runtimeCollisonMap[t];delete i._runtimeCollisonMap[this.id],i._isRigidbody&&delete i._runtimeCollisonTestMap[this.id],delete this._ignoreCollisonMap[t]._ignoreCollisonMap[this.id]}},i._setIsRigidbody=function(e){if(this._isRigidbody!==e){this._isRigidbody=e;var t=this._owner;if(t.displayedInStage){var i=t.layer;i._removeCollider(this),i._addCollider(this)}}},i._getType=function(){return-1},i._collisonTo=function(e){return!1},i.raycast=function(e,t,i){throw void 0===i&&(i=179e306),new Error("Collider:Must override it.")},v(0,i,"enable",e.prototype._$get_enable,function(e){this._enable!==e&&(this._owner.displayedInStage&&(e||this._clearCollsionMap()),this._enable=e,this.event("enablechanged",this._enable))}),v(0,i,"isSingleton",function(){return t._isSingleton}),t._isSingleton=!1,t}(Ni)),cn=(f(un,"laya.d3.component.Rigidbody",rn=Ni),v(0,un.prototype,"enable",rn.prototype._$get_enable,function(e){if(this._enable!==e){for(var t=this._owner._colliders,i=0,n=t.length;i<n;i++){var a=t[i];a._setIsRigidbody(e);var r=a._runtimeCollisonMap,s=a._runtimeCollisonTestMap;if(!e)for(var o in r)delete s[o]}this._enable=e,this.event("enablechanged",this._enable)}}),un);function un(){un.__super.call(this)}!function(){function e(){e.__super.call(this)}f(e,"laya.d3.component.Script",Ni);var t=e.prototype;t.onTriggerEnter=function(e){},t.onTriggerExit=function(e){},t.onTriggerStay=function(e){},v(0,t,"isSingleton",function(){return e._isSingleton}),e._isSingleton=!1}();var dn=function(){function t(e){t.__super.call(this,e)}f(t,"laya.d3.core.GlitterRender",ki);var e=t.prototype;return e._calculateBoundingBox=function(){var e=this._boundingBox.min.elements;e[0]=-Number.MAX_VALUE,e[1]=-Number.MAX_VALUE,e[2]=-Number.MAX_VALUE;var t=this._boundingBox.min.elements;t[0]=Number.MAX_VALUE,t[1]=Number.MAX_VALUE,t[2]=Number.MAX_VALUE},e._calculateBoundingSphere=function(){var e=this._boundingSphere.center.elements;e[0]=0,e[1]=0,e[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},e._renderUpdate=function(e){this._setShaderValueMatrix4x4(0,this._owner.transform.worldMatrix);var t=this._owner.getProjectionViewWorldMatrix(e);this._setShaderValueMatrix4x4(1,t);var i=this._owner.templet;return this._setShaderValueNumber(3,i.lifeTime),this._setShaderValueNumber(2,i._currentTime),!0},t}(),_n=function(e){function t(e){this._owner=null,this._sharedMesh=null,t.__super.call(this),this._owner=e}f(t,"laya.d3.core.MeshFilter",e);var i=t.prototype;return i._sharedMeshLoaded=function(){this.event("loaded")},i._destroy=function(){e.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},v(0,i,"sharedMesh",function(){return this._sharedMesh},function(e){var t=this._sharedMesh;t&&t._removeReference(),(this._sharedMesh=e)._addReference(),this.event("meshchanged",[this,t,e]),e.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),v(0,i,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),v(0,i,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),v(0,i,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),v(0,i,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),t}(Oi),pn=function(){function t(e){t.__super.call(this,e),e.meshFilter.on("meshchanged",this,this._onMeshChanged)}f(t,"laya.d3.core.MeshRender",ki);var e=t.prototype;return e._onMeshChanged=function(e,t,i){i.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:i.once("loaded",this,this._onMeshLoaed)},e._onMeshLoaed=function(e,t){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},e._calculateBoundingSphereByInitSphere=function(e){var t=NaN,i=this._owner.transform,n=i.scale.elements,a=Math.abs(n[0]),r=Math.abs(n[1]),s=Math.abs(n[2]);t=r<=a&&s<=a?a:s<=r?r:s,ai.transformCoordinate(e.center,i.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=e.radius*t},e._calculateBoundBoxByInitCorners=function(e){for(var t=this._owner.transform.worldMatrix,i=0;i<8;i++)ai.transformCoordinate(e[i],t,ki._tempBoundBoxCorners[i]);Ht.createfromPoints(ki._tempBoundBoxCorners,this._boundingBox)},e._calculateBoundingSphere=function(){var e=this._owner.meshFilter.sharedMesh;null==e||null==e.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(e.boundingSphere)},e._calculateBoundingBox=function(){var e=this._owner.meshFilter.sharedMesh;null==e||null==e.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(e.boundingBoxCorners)},e._renderUpdate=function(e){var t=this._owner.transform;if(t){this._setShaderValueMatrix4x4(0,t.worldMatrix);var i=this._owner.getProjectionViewWorldMatrix(e);this._setShaderValueMatrix4x4(1,i)}else this._setShaderValueMatrix4x4(0,qt.DEFAULT),this._setShaderValueMatrix4x4(1,e);return Ii.debugMode&&this._renderRenderableBoundBox(),!0},t}(),fn=function(e){function K(e){K.__super.call(this),this._tempRotationMatrix=new qt,this._uvLength=new ni,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._owner=e,this._ownerRender=e.particleRender,this._boundingBoxCorners=T(8,null),this._boundingSphere=new Gt(new ai,Number.MAX_VALUE),this._boundingBox=new Ht(new ai(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),new ai(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this._currentTime=0,this._isEmitting=!1,this._isPlaying=!1,this._isPaused=!1,this._burstsIndex=0,this._frameRateTime=0,this._emissionTime=0,this._totalDelayTime=0,this._simulateUpdate=!1,this._bufferMaxParticles=1,this.duration=5,this.looping=!0,this.prewarm=!1,this.startDelayType=0,this.startDelay=0,this.startDelayMin=0,this.startDelayMax=0,this._startLifetimeType=0,this._startLifetimeConstant=5,this._startLifeTimeGradient=new Q,this._startLifetimeConstantMin=0,this._startLifetimeConstantMax=5,this._startLifeTimeGradientMin=new Q,this._startLifeTimeGradientMax=new Q,this._maxStartLifetime=5,this.startSpeedType=0,this.startSpeedConstant=5,this.startSpeedConstantMin=0,this.startSpeedConstantMax=5,this.threeDStartSize=!1,this.startSizeType=0,this.startSizeConstant=1,this.startSizeConstantSeparate=new ai(1,1,1),this.startSizeConstantMin=0,this.startSizeConstantMax=1,this.startSizeConstantMinSeparate=new ai(0,0,0),this.startSizeConstantMaxSeparate=new ai(1,1,1),this.threeDStartRotation=!1,this.startRotationType=0,this.startRotationConstant=0,this.startRotationConstantSeparate=new ai(0,0,0),this.startRotationConstantMin=0,this.startRotationConstantMax=0,this.startRotationConstantMinSeparate=new ai(0,0,0),this.startRotationConstantMaxSeparate=new ai(0,0,0),this.randomizeRotationDirection=0,this.startColorType=0,this.startColorConstant=new ri(1,1,1,1),this.startColorConstantMin=new ri(1,1,1,1),this.startColorConstantMax=new ri(1,1,1,1),this.gravityModifier=0,this.simulationSpace=1,this.scaleMode=0,this.playOnAwake=!0,this._rand=new ei(0),this.autoRandomSeed=!0,this.randomSeed=new Uint32Array(1),this._randomSeeds=new Uint32Array(K._RANDOMOFFSET.length),this.isPerformanceMode=!0,this._emission=new q,this._emission.enbale=!0,this._owner.on("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged)}f(K,"laya.d3.core.particleShuriKen.ShurikenParticleSystem",e);var t=K.prototype;return x.imps(t,{"laya.d3.core.render.IRenderable":!0,"laya.d3.core.IClone":!0}),t._getVertexBuffer=function(e){return void 0===e&&(e=0),0===e?this._vertexBuffer:null},t._getIndexBuffer=function(){return this._indexBuffer},t._generateBoundingSphere=function(){var e=this._boundingSphere.center.elements;e[0]=0,e[1]=0,e[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},t._generateBoundingBox=function(){var e=this._owner.particleRender,t=this._boundingBox.min,i=this._boundingBox.max,n=0,a=0,r=NaN;switch(this.startLifetimeType){case 0:r=this.startLifetimeConstant;break;case 1:r=-Number.MAX_VALUE;var s=s;for(n=0,a=s.gradientCount;n<a;n++)r=Math.max(r,s.getValueByIndex(n));break;case 2:r=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:r=-Number.MAX_VALUE;var o=o;for(n=0,a=o.gradientCount;n<a;n++)r=Math.max(r,o.getValueByIndex(n));var l=l;for(n=0,a=l.gradientCount;n<a;n++)r=Math.max(r,l.getValueByIndex(n))}var h,c,u,d,_=NaN,p=NaN;switch(this.startSpeedType){case 0:_=p=this.startSpeedConstant;break;case 1:break;case 2:_=this.startLifetimeConstantMin,p=this.startLifetimeConstantMax}this._shape&&this._shape.enable||(h=c=ai.ZERO,u=ai.ZERO,d=ai.UnitZ);var f,m,g=new ai(u.x*_,u.y*_,u.z*_),v=new ai(d.x*p,d.y*p,d.z*p);if(this._velocityOverLifetime&&this._velocityOverLifetime.enbale){var y=this._velocityOverLifetime.velocity;switch(y.type){case 0:y.constant;break;case 1:new ai(y.gradientX.getAverageValue(),y.gradientY.getAverageValue(),y.gradientZ.getAverageValue());break;case 2:y.constantMin,y.constantMax;break;case 3:new ai(y.gradientXMin.getAverageValue(),y.gradientYMin.getAverageValue(),y.gradientZMin.getAverageValue()),new ai(y.gradientXMax.getAverageValue(),y.gradientYMax.getAverageValue(),y.gradientZMax.getAverageValue())}}var C,E,S=this._owner.transform,x=S.position,T=K._tempVector39,w=T.elements,M=e.renderMode;switch(this.scaleMode){case 0:var b=S.scale;f=b,w[0]=b.x,w[1]=b.z,w[2]=b.y,1===M&&(m=b);break;case 1:var R=S.localScale;f=R,w[0]=R.x,w[1]=R.z,w[2]=R.y,1===M&&(m=R);break;case 2:f=S.scale,w[0]=w[1]=w[2]=1,1===M&&(m=ai.ONE)}switch(this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(C=new ai(g.x*r,g.y*r,g.z*r),E=new ai(v.x*r,v.y*r,v.z*r),2!=this.scaleMode?(ai.add(h,C,t),ai.multiply(f,t,t),ai.add(c,E,i),ai.multiply(f,i,i)):(ai.multiply(f,h,t),ai.add(t,C,t),ai.multiply(f,c,i),ai.add(i,E,i))),this.simulationSpace){case 0:break;case 1:ai.add(t,x,t),ai.add(i,x,i)}var L=NaN,A=NaN;switch(this.startSizeType){case 0:if(this.threeDStartSize){var I=I;L=Math.max(I.x,I.y),1===M&&(A=I.y)}else L=this.startSizeConstant,1===M&&(A=this.startSizeConstant);break;case 1:break;case 2:if(this.threeDStartSize){var D=D;L=Math.max(D.x,D.y),1===M&&(A=D.y)}else L=this.startSizeConstantMax,1===M&&(A=this.startSizeConstantMax)}if(this._sizeOverLifetime&&this._sizeOverLifetime.enbale){this._sizeOverLifetime.size;L*=this._sizeOverLifetime.size.getMaxSizeInGradient()}var P=K._tempVector30,N=P.elements,O=NaN,k=NaN;switch(M){case 0:O=L*K.halfKSqrtOf2,ai.scale(T,L,P),ai.subtract(t,P,t),ai.add(i,P,i);break;case 1:var V=K._tempVector31,B=K._tempVector32,F=K._tempVector33,H=K._tempVector34;this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(ai.multiply(m,v,B),ai.multiply(m,g,F));var U=A*e.stretchedBillboardLengthScale,G=ai.scalarLength(B)*e.stretchedBillboardSpeedScale+U,z=ai.scalarLength(F)*e.stretchedBillboardSpeedScale+U,W=K._tempVector35,X=K._tempVector36;ai.normalize(B,W),ai.scale(W,G,H),ai.subtract(E,H,H),ai.normalize(F,X),ai.scale(X,z,V),ai.add(C,V,V),O=L*K.halfKSqrtOf2,ai.scale(T,O,P);var j=K._tempVector37,Y=K._tempVector38;ai.scale(W,.5,j),ai.scale(X,.5,Y),ai.multiply(j,T,j),ai.multiply(Y,T,Y),ai.add(t,Y,t),ai.min(t,H,t),ai.subtract(t,P,t),ai.subtract(i,j,i),ai.max(i,V,i),ai.add(i,P,i);break;case 2:k=.5*(L*=Math.cos(.7853981633974483)),N[0]=T.x*k,N[1]=T.z*k,ai.subtract(t,P,t),ai.add(i,P,i);break;case 3:k=.5*(L*=Math.cos(.7853981633974483)),ai.scale(T,k,P),ai.subtract(t,P,t),ai.add(i,P,i)}this._boundingBox.getCorners(this._boundingBoxCorners)},t._updateEmission=function(){if(x.stage.isVisibility&&this.isAlive)if(this._simulateUpdate)this._simulateUpdate=!1;else{var e=this._startUpdateLoopCount===w.loopCount||this._isPaused?0:x.timer.delta/1e3;e=Math.min(K._maxElapsedTime,e),this._updateParticles(e)}},t._updateParticles=function(e){4===this._ownerRender.renderMode&&!this._ownerRender.mesh||(this._currentTime+=e,this._retireActiveParticles(),this._freeRetiredParticles(),this._totalDelayTime+=e,this._totalDelayTime<this._playStartDelay||this._emission.enbale&&this._isEmitting&&!this._isPaused&&this._advanceTime(e,this._currentTime))},t._updateParticlesSimulationRestart=function(e){this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._burstsIndex=0,this._frameRateTime=e,this._emissionTime=0,this._totalDelayTime=0;var t=this._currentTime=e;t<this._playStartDelay?this._totalDelayTime=t:this._emission.enbale&&this._advanceTime(e,e)},t._addUpdateEmissionToTimer=function(){x.timer.frameLoop(1,this,this._updateEmission)},t._removeUpdateEmissionToTimer=function(){x.timer.clear(this,this._updateEmission)},t._onOwnerActiveHierarchyChanged=function(e){this._owner.displayedInStage&&(e?this._addUpdateEmissionToTimer():this._removeUpdateEmissionToTimer())},t._retireActiveParticles=function(){for(;this._firstActiveElement!=this._firstNewElement;){var e=this._firstActiveElement*this._floatCountPerVertex*this._vertexStride,t=e+this._timeIndex;if(1e-4+(this._currentTime-this._vertices[t])<this._vertices[e+this._startLifeTimeIndex])break;this._vertices[t]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this._bufferMaxParticles&&(this._firstActiveElement=0)}},t._freeRetiredParticles=function(){for(;this._firstRetiredElement!=this._firstActiveElement;){var e=this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*this._vertexStride+this._timeIndex];if(this.isPerformanceMode&&e<3)break;this._firstRetiredElement++,this._firstRetiredElement>=this._bufferMaxParticles&&(this._firstRetiredElement=0)}},t._burst=function(e,t){for(var i=0,n=this._emission._bursts,a=n.length;this._burstsIndex<a;this._burstsIndex++){var r=n[this._burstsIndex],s=r.time;if(!(e<=s&&s<t))break;var o=0;this.autoRandomSeed?o=F.lerp(r.minCount,r.maxCount,Math.random()):(this._rand.seed=this._randomSeeds[0],o=F.lerp(r.minCount,r.maxCount,this._rand.getFloat()),this._randomSeeds[0]=this._rand.seed),i+=o}return i},t._advanceTime=function(e,t){var i=0,n=this._emissionTime;this._emissionTime+=e;var a=0;if(this._emissionTime>this.duration){if(!this.looping){for(a=Math.min(this.maxParticles-this.aliveParticleCount,a),i=0;i<a;i++)this.emit(t);return this._isPlaying=!1,void this.stop()}a+=this._burst(n,this._emissionTime),this._emissionTime-=this.duration,this.event("complete"),this._burstsIndex=0,a+=this._burst(0,this._emissionTime)}else a+=this._burst(n,this._emissionTime);for(a=Math.min(this.maxParticles-this.aliveParticleCount,a),i=0;i<a;i++)this.emit(t);var r=this.emission.emissionRate;if(0<r){var s=1/r;for(this._frameRateTime+=s,this._frameRateTime=this._currentTime-(this._currentTime-this._frameRateTime)%this._maxStartLifetime;this._frameRateTime<=t&&this.emit(this._frameRateTime);)this._frameRateTime+=s;this._frameRateTime=Math.floor(t/s)*s}},t._initBufferDatas=function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy());var e=this._ownerRender,t=e.renderMode;if(-1!==t&&0<this.maxParticles){var i,n,a=0,r=0,s=0,o=0,l=0,h=e.mesh;if(4===t){if(h){if(1<h._vertexBuffers.length)throw new Error("ShurikenParticleSystem: submesh Count mesh be One or all subMeshes have the same vertexDeclaration.");n=Dt.vertexDeclaration,this._floatCountPerVertex=n.vertexStride/4,this._startLifeTimeIndex=12,this._timeIndex=16,this._vertexStride=h._vertexBuffers[0].vertexCount;var c=this._bufferMaxParticles*this._vertexStride,u=c%65535;if(1<Math.floor(c/65535)+1)throw new Error("ShurikenParticleSystem:the maxParticleCount multiply mesh vertexCount is large than 65535.");this._vertexBuffer=On.create(n,u,35048),this._vertices=new Float32Array(this._floatCountPerVertex*u),this._indexStride=h._indexBuffer.indexCount;var d=h._indexBuffer.getData(),_=this._bufferMaxParticles*this._indexStride;for(this._indexBuffer=Nn.create("ushort",_,35044),i=new Uint16Array(_),a=o=0;a<this._bufferMaxParticles;a++){var p=a*this._vertexStride;for(r=0,s=d.length;r<s;r++)i[o++]=p+d[r]}this._indexBuffer.setData(i)}}else{for(n=It.vertexDeclaration,this._floatCountPerVertex=n.vertexStride/4,this._startLifeTimeIndex=7,this._timeIndex=11,this._vertexStride=4,this._vertexBuffer=On.create(n,this._bufferMaxParticles*this._vertexStride,35048),this._vertices=new Float32Array(this._floatCountPerVertex*this._bufferMaxParticles*this._vertexStride),a=0;a<this._bufferMaxParticles;a++)l=a*this._floatCountPerVertex*this._vertexStride,this._vertices[l]=-.5,this._vertices[l+1]=-.5,this._vertices[l+2]=0,this._vertices[l+3]=1,l+=this._floatCountPerVertex,this._vertices[l]=.5,this._vertices[l+1]=-.5,this._vertices[l+2]=1,this._vertices[l+3]=1,l+=this._floatCountPerVertex,this._vertices[l]=.5,this._vertices[l+1]=.5,this._vertices[l+2]=1,this._vertices[l+3]=0,l+=this._floatCountPerVertex,this._vertices[l]=-.5,this._vertices[l+1]=.5,this._vertices[l+2]=0,this._vertices[l+3]=0;for(this._indexStride=6,this._indexBuffer=Nn.create("ushort",6*this._bufferMaxParticles,35044),i=new Uint16Array(6*this._bufferMaxParticles),a=0;a<this._bufferMaxParticles;a++){o=6*a;var f=a*this._vertexStride,m=2+f;i[o++]=f,i[o++]=m,i[o++]=1+f,i[o++]=f,i[o++]=3+f,i[o++]=m}this._indexBuffer.setData(i)}}},t._destroy=function(){e.prototype._destroy.call(this),this._owner.activeInHierarchy&&this._removeUpdateEmissionToTimer(),this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._emission._destroy(),this._owner=null,this._vertices=null,this._vertexBuffer=null,this._indexBuffer=null,this._emission=null,this._shape=null,this.startLifeTimeGradient=null,this.startLifeTimeGradientMin=null,this.startLifeTimeGradientMax=null,this.startSizeConstantSeparate=null,this.startSizeConstantMinSeparate=null,this.startSizeConstantMaxSeparate=null,this.startRotationConstantSeparate=null,this.startRotationConstantMinSeparate=null,this.startRotationConstantMaxSeparate=null,this.startColorConstant=null,this.startColorConstantMin=null,this.startColorConstantMax=null,this._velocityOverLifetime=null,this._colorOverLifetime=null,this._sizeOverLifetime=null,this._rotationOverLifetime=null,this._textureSheetAnimation=null},t.emit=function(e){var t=K._tempPosition,i=K._tempDirection;if(this._shape&&this._shape.enable)this.autoRandomSeed?this._shape.generatePositionAndDirection(t,i):this._shape.generatePositionAndDirection(t,i,this._rand,this._randomSeeds);else{var n=t.elements,a=i.elements;n[0]=n[1]=n[2]=0,a[0]=a[1]=0,a[2]=1}return this.addParticle(t,i,e)},t.addParticle=function(e,t,i){ai.normalize(t,t);var n=this._firstFreeElement+1;if(n>=this._bufferMaxParticles&&(n=0),n===this._firstRetiredElement)return!1;if(te.create(this,this._ownerRender,this._owner.transform),this._currentTime-i>=te.startLifeTime)return!0;var a=NaN,r=NaN,s=NaN,o=NaN,l=NaN,h=NaN,c=NaN,u=this._velocityOverLifetime&&this._velocityOverLifetime.enbale;if(u){var d=this._velocityOverLifetime.velocity.type;2===d||3===d?this.autoRandomSeed?(a=Math.random(),r=Math.random(),s=Math.random()):(this._rand.seed=this._randomSeeds[9],a=this._rand.getFloat(),r=this._rand.getFloat(),s=this._rand.getFloat(),this._randomSeeds[9]=this._rand.seed):u=!1}else u=!1;var _=this._colorOverLifetime&&this._colorOverLifetime.enbale;_?3===this._colorOverLifetime.color.type?this.autoRandomSeed?o=Math.random():(this._rand.seed=this._randomSeeds[10],o=this._rand.getFloat(),this._randomSeeds[10]=this._rand.seed):_=!1:_=!1;var p=this._sizeOverLifetime&&this._sizeOverLifetime.enbale;p?3===this._sizeOverLifetime.size.type?this.autoRandomSeed?l=Math.random():(this._rand.seed=this._randomSeeds[11],l=this._rand.getFloat(),this._randomSeeds[11]=this._rand.seed):p=!1:p=!1;var f=this._rotationOverLifetime&&this._rotationOverLifetime.enbale;if(f){var m=this._rotationOverLifetime.angularVelocity.type;2===m||3===m?this.autoRandomSeed?h=Math.random():(this._rand.seed=this._randomSeeds[12],h=this._rand.getFloat(),this._randomSeeds[12]=this._rand.seed):f=!1}else f=!1;var g=this._textureSheetAnimation&&this._textureSheetAnimation.enable;g?3===this._textureSheetAnimation.frame.type?this.autoRandomSeed?c=Math.random():(this._rand.seed=this._randomSeeds[15],c=this._rand.getFloat(),this._randomSeeds[15]=this._rand.seed):g=!1:g=!1;var v,y=this._firstFreeElement*this._floatCountPerVertex*this._vertexStride,C=te.startUVInfo[0],E=te.startUVInfo[1],S=te.startUVInfo[2],x=te.startUVInfo[3],T=e.elements,w=t.elements,M=0,b=0,R=0,L=0,A=0,I=this._ownerRender;if(4===I.renderMode){var D=I.mesh._vertexBuffers[0];v=D.getData();var P=D.vertexDeclaration;b=P.getVertexElementByUsage(0).offset/4;var N=P.getVertexElementByUsage(1);R=N?N.offset/4:-1;var O=P.getVertexElementByUsage(2);L=O?O.offset/4:-1,M=P.vertexStride/4,A=0}else{this._vertices[2+y]=S,this._vertices[3+y]=x+E;var k=y+this._floatCountPerVertex;this._vertices[k+2]=S+C,this._vertices[k+3]=x+E;var V=k+this._floatCountPerVertex;this._vertices[V+2]=S+C,this._vertices[V+3]=x;var B=V+this._floatCountPerVertex;this._vertices[B+2]=S,this._vertices[B+3]=x}for(var F=y,H=y+this._floatCountPerVertex*this._vertexStride;F<H;F+=this._floatCountPerVertex){var U=0;if(4===I.renderMode){U=F;var G=M*A++,z=G+b;this._vertices[U++]=v[z++],this._vertices[U++]=v[z++],this._vertices[U++]=v[z],-1===R?(this._vertices[U++]=1,this._vertices[U++]=1,this._vertices[U++]=1,this._vertices[U++]=1):(z=G+R,this._vertices[U++]=v[z++],this._vertices[U++]=v[z++],this._vertices[U++]=v[z++],this._vertices[U++]=v[z]),-1===L?(this._vertices[U++]=0,this._vertices[U++]=0):(z=G+L,this._vertices[U++]=S+v[z++]*C,this._vertices[U++]=x+v[z]*E)}else U=F+4;switch(this._vertices[U++]=T[0],this._vertices[U++]=T[1],this._vertices[U++]=T[2],this._vertices[U++]=te.startLifeTime,this._vertices[U++]=w[0],this._vertices[U++]=w[1],this._vertices[U++]=w[2],this._vertices[U++]=i,this._vertices[U++]=te.startColor[0],this._vertices[U++]=te.startColor[1],this._vertices[U++]=te.startColor[2],this._vertices[U++]=te.startColor[3],this._vertices[U++]=te.startSize[0],this._vertices[U++]=te.startSize[1],this._vertices[U++]=te.startSize[2],this._vertices[U++]=te.startRotation[0],this._vertices[U++]=te.startRotation[1],this._vertices[U++]=te.startRotation[2],this._vertices[U++]=te.startSpeed,_&&(this._vertices[U+1]=o),p&&(this._vertices[U+2]=l),f&&(this._vertices[U+3]=h),g&&(this._vertices[U+4]=c),u&&(this._vertices[U+5]=a,this._vertices[U+6]=r,this._vertices[U+7]=s),this.simulationSpace){case 0:U+=8,this._vertices[U++]=te.simulationWorldPostion[0],this._vertices[U++]=te.simulationWorldPostion[1],this._vertices[U++]=te.simulationWorldPostion[2],this._vertices[U++]=te.simulationWorldRotation[0],this._vertices[U++]=te.simulationWorldRotation[1],this._vertices[U++]=te.simulationWorldRotation[2],this._vertices[U++]=te.simulationWorldRotation[3];break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}}return this._firstFreeElement=n,!0},t.addNewParticlesToVertexBuffer=function(){var e=0;this._firstNewElement<this._firstFreeElement?(e=this._firstNewElement*this._vertexStride*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,e,e,(this._firstFreeElement-this._firstNewElement)*this._vertexStride*this._floatCountPerVertex)):(e=this._firstNewElement*this._vertexStride*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,e,e,(this._bufferMaxParticles-this._firstNewElement)*this._vertexStride*this._floatCountPerVertex),0<this._firstFreeElement&&this._vertexBuffer.setData(this._vertices,0,0,this._firstFreeElement*this._vertexStride*this._floatCountPerVertex)),this._firstNewElement=this._firstFreeElement},t._beforeRender=function(e){return this._firstNewElement!=this._firstFreeElement&&this.addNewParticlesToVertexBuffer(),this._drawCounter++,this._firstActiveElement!=this._firstFreeElement&&(this._vertexBuffer._bind(),this._indexBuffer._bind(),!0)},t._render=function(e){var t=0,i=I.mainContext;this._firstActiveElement<this._firstFreeElement?(t=(this._firstFreeElement-this._firstActiveElement)*this._indexStride,i.drawElements(4,t,5123,2*this._firstActiveElement*this._indexStride),w.trianglesFaces+=t/3,w.drawCall++):(t=(this._bufferMaxParticles-this._firstActiveElement)*this._indexStride,i.drawElements(4,t,5123,2*this._firstActiveElement*this._indexStride),w.trianglesFaces+=t/3,w.drawCall++,0<this._firstFreeElement&&(t=this._firstFreeElement*this._indexStride,i.drawElements(4,t,5123,0),w.trianglesFaces+=t/3,w.drawCall++))},t.play=function(){if(this._burstsIndex=0,this._isEmitting=!0,this._isPlaying=!0,this._isPaused=!1,this._emissionTime=0,this._totalDelayTime=0,!this.autoRandomSeed)for(var e=0,t=this._randomSeeds.length;e<t;e++)this._randomSeeds[e]=this.randomSeed[0]+K._RANDOMOFFSET[e];switch(this.startDelayType){case 0:this._playStartDelay=this.startDelay;break;case 1:this.autoRandomSeed?this._playStartDelay=F.lerp(this.startDelayMin,this.startDelayMax,Math.random()):(this._rand.seed=this._randomSeeds[2],this._playStartDelay=F.lerp(this.startDelayMin,this.startDelayMax,this._rand.getFloat()),this._randomSeeds[2]=this._rand.seed);break;default:throw new Error("Utils3D: startDelayType is invalid.")}this._frameRateTime=this._currentTime+this._playStartDelay,this._startUpdateLoopCount=w.loopCount,this.event("played")},t.pause=function(){this._isPaused=!0,this.event("paused")},t.simulate=function(e,t){void 0===t&&(t=!0),this._simulateUpdate=!0,t?this._updateParticlesSimulationRestart(e):(this._isPaused=!1,this._updateParticles(e)),this.pause()},t.stop=function(){this._burstsIndex=0,this._isEmitting=!1,this._emissionTime=0,this.event("stopped")},t.cloneTo=function(e){var t=e;t.duration=this.duration,t.looping=this.looping,t.prewarm=this.prewarm,t.startDelayType=this.startDelayType,t.startDelay=this.startDelay,t.startDelayMin=this.startDelayMin,t.startDelayMax=this.startDelayMax,t._maxStartLifetime=this._maxStartLifetime,t.startLifetimeType=this.startLifetimeType,t.startLifetimeConstant=this.startLifetimeConstant,this.startLifeTimeGradient.cloneTo(t.startLifeTimeGradient),t.startLifetimeConstantMin=this.startLifetimeConstantMin,t.startLifetimeConstantMax=this.startLifetimeConstantMax,this.startLifeTimeGradientMin.cloneTo(t.startLifeTimeGradientMin),this.startLifeTimeGradientMax.cloneTo(t.startLifeTimeGradientMax),t.startSpeedType=this.startSpeedType,t.startSpeedConstant=this.startSpeedConstant,t.startSpeedConstantMin=this.startSpeedConstantMin,t.startSpeedConstantMax=this.startSpeedConstantMax,t.threeDStartSize=this.threeDStartSize,t.startSizeType=this.startSizeType,t.startSizeConstant=this.startSizeConstant,this.startSizeConstantSeparate.cloneTo(t.startSizeConstantSeparate),t.startSizeConstantMin=this.startSizeConstantMin,t.startSizeConstantMax=this.startSizeConstantMax,this.startSizeConstantMinSeparate.cloneTo(t.startSizeConstantMinSeparate),this.startSizeConstantMaxSeparate.cloneTo(t.startSizeConstantMaxSeparate),t.threeDStartRotation=this.threeDStartRotation,t.startRotationType=this.startRotationType,t.startRotationConstant=this.startRotationConstant,this.startRotationConstantSeparate.cloneTo(t.startRotationConstantSeparate),t.startRotationConstantMin=this.startRotationConstantMin,t.startRotationConstantMax=this.startRotationConstantMax,this.startRotationConstantMinSeparate.cloneTo(t.startRotationConstantMinSeparate),this.startRotationConstantMaxSeparate.cloneTo(t.startRotationConstantMaxSeparate),t.randomizeRotationDirection=this.randomizeRotationDirection,t.startColorType=this.startColorType,this.startColorConstant.cloneTo(t.startColorConstant),this.startColorConstantMin.cloneTo(t.startColorConstantMin),this.startColorConstantMax.cloneTo(t.startColorConstantMax),t.gravityModifier=this.gravityModifier,t.simulationSpace=this.simulationSpace,t.scaleMode=this.scaleMode,t.playOnAwake=this.playOnAwake,t.maxParticles=this.maxParticles,this._emission&&(t._emission=this._emission.clone()),this.shape&&(t.shape=this.shape.clone()),this.velocityOverLifetime&&(t.velocityOverLifetime=this.velocityOverLifetime.clone()),this.colorOverLifetime&&(t.colorOverLifetime=this.colorOverLifetime.clone()),this.sizeOverLifetime&&(t.sizeOverLifetime=this.sizeOverLifetime.clone()),this.rotationOverLifetime&&(t.rotationOverLifetime=this.rotationOverLifetime.clone()),this.textureSheetAnimation&&(t.textureSheetAnimation=this.textureSheetAnimation.clone()),t.isPerformanceMode=this.isPerformanceMode,t._isEmitting=this._isEmitting,t._isPlaying=this._isPlaying,t._isPaused=this._isPaused,t._playStartDelay=this._playStartDelay,t._frameRateTime=this._frameRateTime,t._emissionTime=this._emissionTime,t._totalDelayTime=this._totalDelayTime,t._burstsIndex=this._burstsIndex},t.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},t._getVertexBuffers=function(){return null},v(0,t,"maxParticles",function(){return this._bufferMaxParticles-1},function(e){var t=e+1;t!==this._bufferMaxParticles&&(this._bufferMaxParticles=t,this._initBufferDatas())}),v(0,t,"isEmitting",function(){return this._isEmitting}),v(0,t,"isAlive",function(){return!!(this._isPlaying||0<this.aliveParticleCount)}),v(0,t,"shape",function(){return this._shape},function(e){this._shape!==e&&(e&&e.enable?this._ownerRender._addShaderDefine(aa.SHADERDEFINE_SHAPE):this._ownerRender._removeShaderDefine(aa.SHADERDEFINE_SHAPE),this._shape=e)}),v(0,t,"rotationOverLifetime",function(){return this._rotationOverLifetime},function(e){var t=this._ownerRender;if(e){var i=e.angularVelocity;if(!i)return;var n=i.separateAxes,a=i.type;if(e.enbale)switch(n?t._addShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE):t._addShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIME),a){case 0:t._addShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);break;case 1:t._addShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);break;case 2:t._addShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);break;case 3:t._addShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES)}else t._removeShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIME),t._removeShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),t._removeShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),t._removeShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),t._removeShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),t._removeShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);switch(a){case 0:n?t._setShaderValueColor(35,i.constantSeparate):t._setShaderValueNumber(34,i.constant);break;case 1:n?(t._setShaderValueBuffer(37,i.gradientX._elements),t._setShaderValueBuffer(38,i.gradientY._elements),t._setShaderValueBuffer(39,i.gradientZ._elements),t._setShaderValueBuffer(40,i.gradientW._elements)):t._setShaderValueBuffer(36,i.gradient._elements);break;case 2:n?(t._setShaderValueColor(35,i.constantMinSeparate),t._setShaderValueColor(42,i.constantMaxSeparate)):(t._setShaderValueNumber(34,i.constantMin),t._setShaderValueNumber(41,i.constantMax));break;case 3:n?(t._setShaderValueBuffer(37,i.gradientXMin._elements),t._setShaderValueBuffer(44,i.gradientXMax._elements),t._setShaderValueBuffer(38,i.gradientYMin._elements),t._setShaderValueBuffer(45,i.gradientYMax._elements),t._setShaderValueBuffer(39,i.gradientZMin._elements),t._setShaderValueBuffer(46,i.gradientZMax._elements),t._setShaderValueBuffer(40,i.gradientWMin._elements),t._setShaderValueBuffer(47,i.gradientWMax._elements)):(t._setShaderValueBuffer(36,i.gradientMin._elements),t._setShaderValueBuffer(43,i.gradientMax._elements))}}else t._removeShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIME),t._removeShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),t._removeShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),t._removeShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),t._removeShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),t._removeShaderDefine(aa.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES),t._setShaderValueColor(35,null),t._setShaderValueColor(42,null),t._setShaderValueNumber(34,void 0),t._setShaderValueNumber(41,void 0),t._setShaderValueBuffer(37,null),t._setShaderValueBuffer(44,null),t._setShaderValueBuffer(38,null),t._setShaderValueBuffer(45,null),t._setShaderValueBuffer(39,null),t._setShaderValueBuffer(46,null),t._setShaderValueBuffer(40,null),t._setShaderValueBuffer(47,null),t._setShaderValueBuffer(36,null),t._setShaderValueBuffer(43,null);this._rotationOverLifetime=e}),v(0,t,"emission",function(){return this._emission}),v(0,t,"emissionTime",function(){return this._emissionTime>this.duration?this.duration:this._emissionTime}),v(0,t,"aliveParticleCount",function(){return this._firstNewElement>=this._firstRetiredElement?this._firstNewElement-this._firstRetiredElement:this._bufferMaxParticles-this._firstRetiredElement+this._firstNewElement}),v(0,t,"isPlaying",function(){return this._isPlaying}),v(0,t,"isPaused",function(){return this._isPaused}),v(0,t,"startLifetimeType",function(){return this._startLifetimeType},function(e){var t=0,i=0;switch(this.startLifetimeType){case 0:this._maxStartLifetime=this.startLifetimeConstant;break;case 1:this._maxStartLifetime=-Number.MAX_VALUE;var n=n;for(t=0,i=n.gradientCount;t<i;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,n.getValueByIndex(t));break;case 2:this._maxStartLifetime=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:this._maxStartLifetime=-Number.MAX_VALUE;var a=a;for(t=0,i=a.gradientCount;t<i;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,a.getValueByIndex(t));var r=r;for(t=0,i=r.gradientCount;t<i;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,r.getValueByIndex(t))}this._startLifetimeType=e}),v(0,t,"_originalBoundingSphere",function(){return this._boundingSphere}),v(0,t,"startLifetimeConstant",function(){return this._startLifetimeConstant},function(e){0===this._startLifetimeType&&(this._maxStartLifetime=e),this._startLifetimeConstant=e}),v(0,t,"startLifetimeConstantMin",function(){return this._startLifetimeConstantMin},function(e){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(e,this._startLifetimeConstantMax)),this._startLifetimeConstantMin=e}),v(0,t,"startLifeTimeGradient",function(){return this._startLifeTimeGradient},function(e){if(1===this._startLifetimeType){this._maxStartLifetime=-Number.MAX_VALUE;for(var t=0,i=e.gradientCount;t<i;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,e.getValueByIndex(t))}this._startLifeTimeGradient=e}),v(0,t,"startLifetimeConstantMax",function(){return this._startLifetimeConstantMax},function(e){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(this._startLifetimeConstantMin,e)),this._startLifetimeConstantMax=e}),v(0,t,"startLifeTimeGradientMin",function(){return this._startLifeTimeGradientMin},function(e){if(3===this._startLifetimeType){var t=0,i=0;for(this._maxStartLifetime=-Number.MAX_VALUE,t=0,i=e.gradientCount;t<i;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,e.getValueByIndex(t));for(t=0,i=this._startLifeTimeGradientMax.gradientCount;t<i;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMax.getValueByIndex(t))}this._startLifeTimeGradientMin=e}),v(0,t,"startLifeTimeGradientMax",function(){return this._startLifeTimeGradientMax},function(e){if(3===this._startLifetimeType){var t=0,i=0;for(this._maxStartLifetime=-Number.MAX_VALUE,t=0,i=this._startLifeTimeGradientMin.gradientCount;t<i;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMin.getValueByIndex(t));for(t=0,i=e.gradientCount;t<i;t++)this._maxStartLifetime=Math.max(this._maxStartLifetime,e.getValueByIndex(t))}this._startLifeTimeGradientMax=e}),v(0,t,"velocityOverLifetime",function(){return this._velocityOverLifetime},function(e){var t=this._ownerRender;if(e){var i=e.velocity,n=i.type;if(e.enbale)switch(n){case 0:t._addShaderDefine(aa.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);break;case 1:t._addShaderDefine(aa.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);break;case 2:t._addShaderDefine(aa.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);break;case 3:t._addShaderDefine(aa.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE)}else t._removeShaderDefine(aa.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),t._removeShaderDefine(aa.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),t._removeShaderDefine(aa.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),t._removeShaderDefine(aa.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);switch(n){case 0:t._setShaderValueColor(13,i.constant);break;case 1:t._setShaderValueBuffer(14,i.gradientX._elements),t._setShaderValueBuffer(15,i.gradientY._elements),t._setShaderValueBuffer(16,i.gradientZ._elements);break;case 2:t._setShaderValueColor(13,i.constantMin),t._setShaderValueColor(17,i.constantMax);break;case 3:t._setShaderValueBuffer(14,i.gradientXMin._elements),t._setShaderValueBuffer(18,i.gradientXMax._elements),t._setShaderValueBuffer(15,i.gradientYMin._elements),t._setShaderValueBuffer(19,i.gradientYMax._elements),t._setShaderValueBuffer(16,i.gradientZMin._elements),t._setShaderValueBuffer(20,i.gradientZMax._elements)}t._setShaderValueInt(21,e.space)}else t._removeShaderDefine(aa.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),t._removeShaderDefine(aa.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),t._removeShaderDefine(aa.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),t._removeShaderDefine(aa.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE),t._setShaderValueColor(13,null),t._setShaderValueBuffer(14,null),t._setShaderValueBuffer(15,null),t._setShaderValueBuffer(16,null),t._setShaderValueColor(13,null),t._setShaderValueColor(17,null),t._setShaderValueBuffer(14,null),t._setShaderValueBuffer(18,null),t._setShaderValueBuffer(15,null),t._setShaderValueBuffer(19,null),t._setShaderValueBuffer(16,null),t._setShaderValueBuffer(20,null),t._setShaderValueInt(21,void 0);this._velocityOverLifetime=e}),v(0,t,"colorOverLifetime",function(){return this._colorOverLifetime},function(e){var t=this._ownerRender;if(e){var i=e.color;if(e.enbale)switch(i.type){case 1:t._addShaderDefine(aa.SHADERDEFINE_COLOROVERLIFETIME);break;case 3:t._addShaderDefine(aa.SHADERDEFINE_RANDOMCOLOROVERLIFETIME)}else t._removeShaderDefine(aa.SHADERDEFINE_COLOROVERLIFETIME),t._removeShaderDefine(aa.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);switch(i.type){case 1:var n=i.gradient;t._setShaderValueBuffer(22,n._alphaElements),t._setShaderValueBuffer(23,n._rgbElements);break;case 3:var a=i.gradientMin,r=i.gradientMax;t._setShaderValueBuffer(22,a._alphaElements),t._setShaderValueBuffer(23,a._rgbElements),t._setShaderValueBuffer(24,r._alphaElements),t._setShaderValueBuffer(25,r._rgbElements)}}else t._removeShaderDefine(aa.SHADERDEFINE_COLOROVERLIFETIME),t._removeShaderDefine(aa.SHADERDEFINE_RANDOMCOLOROVERLIFETIME),t._setShaderValueBuffer(22,n._alphaElements),t._setShaderValueBuffer(23,n._rgbElements),t._setShaderValueBuffer(22,a._alphaElements),t._setShaderValueBuffer(23,a._rgbElements),t._setShaderValueBuffer(24,r._alphaElements),t._setShaderValueBuffer(25,r._rgbElements);this._colorOverLifetime=e}),v(0,t,"sizeOverLifetime",function(){return this._sizeOverLifetime},function(e){var t=this._ownerRender;if(e){var i=e.size,n=i.separateAxes,a=i.type;if(e.enbale)switch(a){case 0:n?t._addShaderDefine(aa.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE):t._addShaderDefine(aa.SHADERDEFINE_SIZEOVERLIFETIMECURVE);break;case 2:n?t._addShaderDefine(aa.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE):t._addShaderDefine(aa.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES)}else t._removeShaderDefine(aa.SHADERDEFINE_SIZEOVERLIFETIMECURVE),t._removeShaderDefine(aa.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),t._removeShaderDefine(aa.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),t._removeShaderDefine(aa.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);switch(a){case 0:n?(t._setShaderValueBuffer(27,i.gradientX._elements),t._setShaderValueBuffer(28,i.gradientY._elements),t._setShaderValueBuffer(29,i.gradientZ._elements)):t._setShaderValueBuffer(26,i.gradient._elements);break;case 2:n?(t._setShaderValueBuffer(27,i.gradientXMin._elements),t._setShaderValueBuffer(31,i.gradientXMax._elements),t._setShaderValueBuffer(28,i.gradientYMin._elements),t._setShaderValueBuffer(32,i.gradientYMax._elements),t._setShaderValueBuffer(29,i.gradientZMin._elements),t._setShaderValueBuffer(33,i.gradientZMax._elements)):(t._setShaderValueBuffer(26,i.gradientMin._elements),t._setShaderValueBuffer(30,i.gradientMax._elements))}}else t._removeShaderDefine(aa.SHADERDEFINE_SIZEOVERLIFETIMECURVE),t._removeShaderDefine(aa.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),t._removeShaderDefine(aa.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),t._removeShaderDefine(aa.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE),t._setShaderValueBuffer(27,null),t._setShaderValueBuffer(31,null),t._setShaderValueBuffer(28,null),t._setShaderValueBuffer(32,null),t._setShaderValueBuffer(29,null),t._setShaderValueBuffer(33,null),t._setShaderValueBuffer(26,null),t._setShaderValueBuffer(30,null);this._sizeOverLifetime=e}),v(0,t,"textureSheetAnimation",function(){return this._textureSheetAnimation},function(e){var t=this._ownerRender;if(e){var i=e.frame,n=i.type;if(e.enable)switch(n){case 1:t._addShaderDefine(aa.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);break;case 3:t._addShaderDefine(aa.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE)}else t._removeShaderDefine(aa.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),t._removeShaderDefine(aa.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);if(1===n||3===n){t._setShaderValueInt(48,e.cycles);var a=e.tiles,r=this._uvLength.elements;r[0]=1/a.x,r[1]=1/a.y,t._setShaderValueVector2(49,this._uvLength)}switch(n){case 1:t._setShaderValueBuffer(50,i.frameOverTimeData._elements);break;case 3:t._setShaderValueBuffer(50,i.frameOverTimeDataMin._elements),t._setShaderValueBuffer(51,i.frameOverTimeDataMax._elements)}}else t._removeShaderDefine(aa.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),t._removeShaderDefine(aa.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE),t._setShaderValueInt(48,void 0),t._setShaderValueVector2(49,null),t._setShaderValueBuffer(50,null),t._setShaderValueBuffer(51,null);this._textureSheetAnimation=e}),v(0,t,"_vertexBufferCount",function(){return 1}),v(0,t,"triangleCount",function(){return this._indexBuffer?this._indexBuffer.indexCount/3:0}),v(0,t,"_originalBoundingBox",function(){return this._boundingBox}),v(0,t,"_originalBoundingBoxCorners",function(){return this._boundingBoxCorners}),K.halfKSqrtOf2=.71,u(K,["_RANDOMOFFSET",function(){return this._RANDOMOFFSET=new Uint32Array([592910910,3276756734,322376503,306581307,1793934638,3737431713,2527743459,2368504881,4085612399,3774601268,326370691,1494990940,1089181156,3159510623,2941263940,2786374529,271901988,4233252447])},"_maxElapsedTime",function(){return this._maxElapsedTime=1/3},"_tempVector30",function(){return this._tempVector30=new ai},"_tempVector31",function(){return this._tempVector31=new ai},"_tempVector32",function(){return this._tempVector32=new ai},"_tempVector33",function(){return this._tempVector33=new ai},"_tempVector34",function(){return this._tempVector34=new ai},"_tempVector35",function(){return this._tempVector35=new ai},"_tempVector36",function(){return this._tempVector36=new ai},"_tempVector37",function(){return this._tempVector37=new ai},"_tempVector38",function(){return this._tempVector38=new ai},"_tempVector39",function(){return this._tempVector39=new ai},"_tempPosition",function(){return this._tempPosition=new ai},"_tempDirection",function(){return this._tempDirection=new ai}]),K}(Oi),mn=function(e){function t(e){this._finalGravity=new ai,this._tempRotationMatrix=new qt,t.__super.call(this,e),this._defaultBoundBox=new Ht(new ai,new ai),this._renderMode=-1,this.stretchedBillboardCameraSpeedScale=0,this.stretchedBillboardSpeedScale=0,this.stretchedBillboardLengthScale=1}f(t,"laya.d3.core.particleShuriKen.ShurikenParticleRender",e);var i=t.prototype;return i._calculateBoundingBox=function(){var e=this._boundingBox.min.elements;e[0]=-Number.MAX_VALUE,e[1]=-Number.MAX_VALUE,e[2]=-Number.MAX_VALUE;var t=this._boundingBox.min.elements;t[0]=Number.MAX_VALUE,t[1]=Number.MAX_VALUE,t[2]=Number.MAX_VALUE},i._calculateBoundingSphere=function(){var e=this._owner.particleSystem._boundingSphere,t=NaN,i=this._owner.transform,n=i.scale.elements,a=Math.abs(n[0]),r=Math.abs(n[1]),s=Math.abs(n[2]);t=r<=a&&s<=a?a:s<=r?r:s,ai.transformCoordinate(e.center,i.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=e.radius*t},i._renderUpdate=function(e){var t=this._owner.particleSystem;if(!x.stage.isVisibility||!t.isAlive)return!1;var i=this._owner.transform;switch(t.simulationSpace){case 0:break;case 1:this._setShaderValueColor(0,i.position),this._setShaderValueColor(1,i.rotation);break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}switch(t.scaleMode){case 0:var n=i.scale;this._setShaderValueColor(4,n),this._setShaderValueColor(5,n);break;case 1:var a=i.localScale;this._setShaderValueColor(4,a),this._setShaderValueColor(5,a);break;case 2:this._setShaderValueColor(4,i.scale),this._setShaderValueColor(5,ai.ONE)}var r=this._finalGravity.elements,s=Si.gravity.elements,o=t.gravityModifier;return r[0]=s[0]*o,r[1]=s[1]*o,r[2]=s[2]*o,this._setShaderValueBuffer(7,r),this._setShaderValueInt(11,t.simulationSpace),this._setShaderValueBool(8,t.threeDStartRotation),this._setShaderValueInt(6,t.scaleMode),this._setShaderValueInt(9,this.stretchedBillboardLengthScale),this._setShaderValueInt(10,this.stretchedBillboardSpeedScale),this._setShaderValueNumber(12,t._currentTime),Ii.debugMode&&this._renderRenderableBoundBox(),!0},i._destroy=function(){e.prototype._destroy.call(this),this._mesh&&(this._mesh._removeReference(),this._mesh=null)},v(0,i,"boundingBox",function(){return this._owner.particleSystem.isAlive?(this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox):this._defaultBoundBox}),v(0,i,"renderMode",function(){return this._renderMode},function(e){if(this._renderMode!==e){switch(this._renderMode){case 0:this._removeShaderDefine(aa.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:this._removeShaderDefine(aa.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:this._removeShaderDefine(aa.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:this._removeShaderDefine(aa.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:this._removeShaderDefine(aa.SHADERDEFINE_RENDERMODE_MESH)}switch(this._renderMode=e){case 0:this._addShaderDefine(aa.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:this._addShaderDefine(aa.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:this._addShaderDefine(aa.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:this._addShaderDefine(aa.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:this._addShaderDefine(aa.SHADERDEFINE_RENDERMODE_MESH);break;default:throw new Error("ShurikenParticleRender: unknown renderMode Value.")}this._owner.particleSystem._initBufferDatas()}}),v(0,i,"mesh",function(){return this._mesh},function(e){this._mesh!==e&&(this._mesh&&this._mesh._removeReference(),(this._mesh=e)&&e._addReference(),this._owner.particleSystem._initBufferDatas())}),t}(ki),gn=function(t){function i(e){this._owner=null,this._trailRenderElements=null,this._minVertexDistance=NaN,this._widthMultiplier=NaN,this._time=NaN,this._widthCurve=null,this._colorGradient=null,this._textureMode=0,this._curtime=0,this._curSubTrailFinishCurTime=0,this._curSubTrailFinished=!1,this._hasLifeSubTrail=!1,this._trailTotalLength=0,this._trailSupplementLength=0,this._trailDeadLength=0,this._isStart=!1,this._trailRenderElementIndex=0,i.__super.call(this),this._curSubTrailFinishPosition=new ai,this._curSubTrailFinishDirection=new ai,this._owner=e,this._trailRenderElements=[],this.addRenderElement()}f(i,"laya.d3.core.trail.TrailFilter",t);var e=i.prototype;return e.getRenderElementsCount=function(){return this._trailRenderElements.length},e.addRenderElement=function(){for(var e=0;e<this._trailRenderElements.length;e++)if(1==this._trailRenderElements[e]._isDead)return this._trailRenderElements[e].reActivate(),e;var t=new ye(this);return this._trailRenderElements.push(t),this._trailRenderElements.length-1},e.getRenderElement=function(e){return this._trailRenderElements[e]},e._update=function(e){this._curtime+=e.elapsedTime/1e3,this._owner._render._setShaderValueNumber(3,this._curtime),this._curSubTrailFinished&&(this._curSubTrailFinished=!1,this._trailRenderElementIndex=this.addRenderElement(),this.event("trailfilterchange",[this._trailRenderElementIndex,this._trailRenderElements[this._trailRenderElementIndex]]))},e.reset=function(){for(var e=0;e<this._trailRenderElements.length;e++)this._trailRenderElements[e].reActivate();this._isStart=!1,this._hasLifeSubTrail=!1,this._curSubTrailFinished=!1,this._curSubTrailFinishCurTime=0,this._trailTotalLength=0,this._trailSupplementLength=0,this._trailDeadLength=0},e._destroy=function(){t.prototype._destroy.call(this);for(var e=0;e<this._trailRenderElements.length;e++)this._trailRenderElements[e]._destroy();this._trailRenderElements=null,this._widthCurve=null,this._colorGradient=null,this._curSubTrailFinishPosition=null,this._curSubTrailFinishDirection=null},v(0,e,"widthMultiplier",function(){return this._widthMultiplier},function(e){this._widthMultiplier=e}),v(0,e,"time",function(){return this._time},function(e){this._time=e,this._owner._render._setShaderValueNumber(4,e)}),v(0,e,"widthCurve",function(){return this._widthCurve},function(e){this._widthCurve=e;var t,i=new Float32Array(4*e.length),n=0,a=0;for(n=0,t=e.length;n<t;n++)i[a++]=e[n].time,i[a++]=e[n].inTangent,i[a++]=e[n].outTangent,i[a++]=e[n].value;this._owner._render._setShaderValueBuffer(5,i),this._owner._render._setShaderValueInt(6,e.length)}),v(0,e,"minVertexDistance",function(){return this._minVertexDistance},function(e){this._minVertexDistance=e}),v(0,e,"colorGradient",function(){return this._colorGradient},function(e){this._colorGradient=e,this._owner._render._setShaderValueBuffer(7,e._colorKeyData),this._owner._render._setShaderValueBuffer(8,e._alphaKeyData),0==e.mode?this._owner._render._addShaderDefine(sa.SHADERDEFINE_GRADIENTMODE_BLEND):this._owner._render._removeShaderDefine(sa.SHADERDEFINE_GRADIENTMODE_BLEND)}),v(0,e,"textureMode",function(){return this._textureMode},function(e){this._textureMode=e}),i}(Oi),vn=function(){function t(e){t.__super.call(this,e)}f(t,"laya.d3.core.trail.TrailRenderer",ki);var e=t.prototype;return e._calculateBoundingBox=function(){var e=this._boundingBox.min.elements;e[0]=-Number.MAX_VALUE,e[1]=-Number.MAX_VALUE,e[2]=-Number.MAX_VALUE;var t=this._boundingBox.min.elements;t[0]=Number.MAX_VALUE,t[1]=Number.MAX_VALUE,t[2]=Number.MAX_VALUE},e._calculateBoundingSphere=function(){var e=this._boundingSphere.center.elements;e[0]=0,e[1]=0,e[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},e._renderUpdate=function(e){return!0},t}(),yn=function(e){function t(e){this._floatCountPerVertex=6,this._owner=null,this._vertices=null,this._vertexBuffer=null,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=NaN,this._drawCounter=0,this.scLeft=null,this.scRight=null,this._numPositionMode=0,this._numPositionVelocityMode=0,this._lastTime=NaN,this._needPatch=!1,this._lastPatchAddPos0=null,this._lastPatchAddPos1=null,this._lastPatchAddTime=NaN,this.lifeTime=NaN,this.minSegmentDistance=NaN,this.minInterpDistance=NaN,this.maxSlerpCount=0,this._maxSegments=0,t.__super.call(this),this._tempVector0=new ai,this._tempVector1=new ai,this._tempVector2=new ai,this._tempVector3=new ai,this._posModeLastPosition0=new ai,this._posModeLastPosition1=new ai,this._posModePosition0=new ai,this._posModePosition1=new ai,this._posVelModePosition0=new ai,this._posVelModeVelocity0=new ai,this._posVelModePosition1=new ai,this._posVelModeVelocity1=new ai,this._owner=e,this._lastTime=0,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=0,this._drawCounter=0,this._needPatch=!1,this._lastPatchAddPos0=new ai,this._lastPatchAddPos1=new ai,this.scLeft=new X,this.scRight=new X,this.lifeTime=.5,this.minSegmentDistance=.1,this.minInterpDistance=.6,this.maxSlerpCount=128,this._maxSegments=200,this._owner.on("activeinhierarchychanged",this,this._onActiveHierarchyChanged)}f(t,"laya.d3.resource.tempelet.GlitterTemplet",e);var i=t.prototype;return x.imps(i,{"laya.d3.core.render.IRenderable":!0}),i._getVertexBuffer=function(e){return void 0===e&&(e=0),0===e?this._vertexBuffer:null},i._getIndexBuffer=function(){return null},i._initialize=function(){this._vertexBuffer=On.create(Xe.vertexDeclaration,2*this.maxSegments,35048),this._vertices=new Float32Array(this.maxSegments*this._floatCountPerVertex*2)},i._onActiveHierarchyChanged=function(e){e||(this._numPositionMode=0,this._numPositionVelocityMode=0,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=0,this._drawCounter=0)},i._updateTextureCoordinates=function(){this._firstActiveElement<this._firstFreeElement?this._updateSubTextureCoordinates(this._firstActiveElement,2*(this._firstFreeElement-this._firstActiveElement)):(this._updateSubTextureCoordinates(this._firstActiveElement,2*(this.maxSegments-this._firstActiveElement)),0<this._firstFreeElement&&this._updateSubTextureCoordinates(0,2*this._firstFreeElement))},i._updateSubTextureCoordinates=function(e,t){for(var i=2*e,n=0;n<t;n+=2){var a=i+n,r=a*this._floatCountPerVertex,s=(a+1)*this._floatCountPerVertex;this._vertices[3+r]=this._vertices[3+s]=(this._vertices[5+r]-this._currentTime)/this.lifeTime}},i._retireActiveGlitter=function(){for(var e=this.lifeTime,t=2*this._floatCountPerVertex;this._firstActiveElement!=this._firstNewElement;){var i=this._firstActiveElement*t+5;if(this._currentTime-this._vertices[i]<e)break;this._vertices[i]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this.maxSegments&&(this._firstActiveElement=0)}},i._freeRetiredGlitter=function(){for(var e=2*this._floatCountPerVertex;this._firstRetiredElement!=this._firstActiveElement;){if(this._drawCounter-this._vertices[this._firstRetiredElement*e+5]<3)break;this._firstRetiredElement++,this._firstRetiredElement>=this.maxSegments&&(this._firstRetiredElement=0)}},i._calcVelocity=function(e,t,i){ai.subtract(e,t,i),ai.scale(i,.5,i)},i._addNewGlitterSegementToVertexBuffer=function(){var e=0;this._firstActiveElement<this._firstFreeElement?(e=2*this._firstActiveElement*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,e,e,2*(this._firstFreeElement-this._firstActiveElement)*this._floatCountPerVertex)):(e=2*this._firstActiveElement*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,e,e,2*(this.maxSegments-this._firstActiveElement)*this._floatCountPerVertex),0<this._firstFreeElement&&this._vertexBuffer.setData(this._vertices,0,0,2*this._firstFreeElement*this._floatCountPerVertex)),this._firstNewElement=this._firstFreeElement},i._addGlitter=function(e,t,i){this._needPatch&&(this._needPatch=!1,this._addGlitter(this._lastPatchAddPos0,this._lastPatchAddPos1,this._lastPatchAddTime));var n=this._firstFreeElement+1;n>=this.maxSegments&&(n=0,e.cloneTo(this._lastPatchAddPos0),t.cloneTo(this._lastPatchAddPos1),this._lastPatchAddTime=i,this._needPatch=!0),n===this._firstRetiredElement&&console.log("GlitterTemplet:current segement count have large than maxSegments,please adjust the  value of maxSegments or add Glitter Vertex Frequency.");var a=e.elements,r=t.elements,s=0,o=this._firstFreeElement*this._floatCountPerVertex*2;for(s=0;s<3;s++)this._vertices[o+s]=a[s];this._vertices[3+o]=0,this._vertices[4+o]=0,this._vertices[5+o]=i;var l=o+this._floatCountPerVertex;for(s=0;s<3;s++)this._vertices[l+s]=r[s];this._vertices[l+3]=0,this._vertices[l+4]=1,this._vertices[l+5]=i,this._firstFreeElement=n},i._update=function(e){this._currentTime+=e/1e3,this._retireActiveGlitter(),this._freeRetiredGlitter(),this._firstActiveElement==this._firstFreeElement&&(this._currentTime=0),this._firstRetiredElement==this._firstActiveElement&&(this._drawCounter=0),this._updateTextureCoordinates()},i._beforeRender=function(e){return this._firstNewElement!=this._firstFreeElement&&this._addNewGlitterSegementToVertexBuffer(),this._drawCounter++,this._firstActiveElement!=this._firstFreeElement&&(this._vertexBuffer.bindWithIndexBuffer(null),!0)},i._render=function(e){var t=0,i=I.mainContext;this._firstActiveElement<this._firstFreeElement?(t=2*(this._firstFreeElement-this._firstActiveElement),i.drawArrays(5,2*this._firstActiveElement,t),w.trianglesFaces+=t-2,w.drawCall++):(t=2*(this.maxSegments-this._firstActiveElement),i.drawArrays(5,2*this._firstActiveElement,t),w.trianglesFaces+=t-2,w.drawCall++,0<this._firstFreeElement&&(t=2*this._firstFreeElement,i.drawArrays(5,0,t),w.trianglesFaces+=t-2,w.drawCall++))},i.addVertexPosition=function(e,t){if(this._owner.activeInHierarchy)if(this._numPositionMode<2)0===this._numPositionMode?(e.cloneTo(this._posModeLastPosition0),t.cloneTo(this._posModeLastPosition1)):(e.cloneTo(this._posModePosition0),t.cloneTo(this._posModePosition1)),this._numPositionMode++;else{var i=this._tempVector2;this._calcVelocity(e,this._posModeLastPosition0,i);var n=this._tempVector3;this._calcVelocity(t,this._posModeLastPosition1,n),this.addVertexPositionVelocity(this._posModePosition0,i,this._posModePosition1,n),this._posModePosition0.cloneTo(this._posModeLastPosition0),this._posModePosition1.cloneTo(this._posModeLastPosition1),e.cloneTo(this._posModePosition0),t.cloneTo(this._posModePosition1)}},i.addVertexPositionVelocity=function(e,t,i,n){if(this._owner.activeInHierarchy){if(0===this._numPositionVelocityMode)this._numPositionVelocityMode++;else{var a=this._tempVector0;ai.subtract(e,this._posVelModePosition0,a);var r=ai.scalarLength(a);ai.subtract(i,this._posVelModePosition1,a);var s=ai.scalarLength(a),o=0,l=l;if(r<l&&s<l)return;if(1===(o=1+Math.floor(Math.max(r,s)/this.minInterpDistance)))this._addGlitter(e,i,this._currentTime);else{o=Math.min(o,this.maxSlerpCount),this.scLeft.Init(this._posVelModePosition0,this._posVelModeVelocity0,e,t),this.scRight.Init(this._posVelModePosition1,this._posVelModeVelocity1,i,n);for(var h=1/o,c=h,u=this._currentTime-this._lastTime,d=1;d<=o;d++){var _=this._tempVector0;this.scLeft.Slerp(c,_);var p=this._tempVector1;this.scRight.Slerp(c,p);var f=this._lastTime+u*d/o;this._addGlitter(_,p,f),c+=h}}}this._lastTime=this._currentTime,e.cloneTo(this._posVelModePosition0),t.cloneTo(this._posVelModeVelocity0),i.cloneTo(this._posVelModePosition1),n.cloneTo(this._posVelModeVelocity1)}},i._destroy=function(){e.prototype._destroy.call(this),this._tempVector0=null,this._tempVector1=null,this._tempVector2=null,this._tempVector3=null,this._owner=null,this._vertices=null,this._vertexBuffer.destroy(),this._vertexBuffer=null,this.scLeft=null,this.scRight=null,this._posModeLastPosition0=null,this._posModeLastPosition1=null,this._posModePosition0=null,this._posModePosition1=null,this._posVelModePosition0=null,this._posVelModeVelocity0=null,this._posVelModePosition1=null,this._posVelModeVelocity1=null,this._lastPatchAddPos0=null,this._lastPatchAddPos1=null},i._getVertexBuffers=function(){return null},v(0,i,"maxSegments",function(){return this._maxSegments-1},function(e){var t=e+1;t!==this._maxSegments&&(this._maxSegments=t,this._vertexBuffer&&this._vertexBuffer.destroy(),this._initialize())}),v(0,i,"_vertexBufferCount",function(){return 1}),v(0,i,"triangleCount",function(){var e=0;return this._firstActiveElement<this._firstFreeElement?e=2*(this._firstFreeElement-this._firstActiveElement)-2:(e=2*(this.maxSegments-this._firstActiveElement)-2,e+=2*this._firstFreeElement-2),e}),v(0,i,"_originalBoundingSphere",function(){return x.superGet(Oi,this,"_originalBoundingSphere")}),v(0,i,"_originalBoundingBox",function(){return x.superGet(Oi,this,"_originalBoundingBox")}),t}(Oi),Cn=function(e){function h(e,t,i,n,a,r,s,o){this._owner=null,this._gridSize=NaN,this.memorySize=0,this._numberVertices=0,this._maxNumberIndices=0,this._currentNumberIndices=0,this._numberTriangle=0,this._vertexBuffer=null,this._indexBuffer=null,this._boundingSphere=null,this._boundingBox=null,this._indexArrayBuffer=null,this._boundingBoxCorners=null,this._leafs=null,this._leafNum=0,this._terrainHeightData=null,this._terrainHeightDataWidth=0,this._terrainHeightDataHeight=0,this._chunkOffsetX=0,this._chunkOffsetZ=0,this._cameraCoordinateInverse=!1,this._cameraPos=null,this._currentLOD=0,this._perspectiveFactor=NaN,this._LODTolerance=0,h.__super.call(this),this._owner=e,this._cameraPos=new ai,this._chunkOffsetX=t,this._chunkOffsetZ=i,this._gridSize=n,this._terrainHeightData=a,this._terrainHeightDataWidth=r,this._terrainHeightDataHeight=s,this._leafNum=fi.CHUNK_GRID_NUM/fi.LEAF_GRID_NUM*(fi.CHUNK_GRID_NUM/fi.LEAF_GRID_NUM),this._leafs=T(this._leafNum),this._cameraCoordinateInverse=o;for(var l=0;l<this._leafNum;l++)this._leafs[l]=new fi;this.recreateResource()}f(h,"laya.d3.terrain.TerrainFilter",e);var t=h.prototype;return x.imps(t,{"laya.d3.core.render.IRenderable":!0}),t._destroy=function(){e.prototype._destroy.call(this),this._owner=null,this._vertexBuffer&&this._vertexBuffer.destroy(),this._indexBuffer&&this._indexBuffer.destroy()},t.recreateResource=function(){this._currentNumberIndices=0,this._numberTriangle=0;var e=fi.LEAF_VERTEXT_COUNT,t=fi.LEAF_MAX_INDEX_COUNT;this._numberVertices=e*this._leafNum,this._maxNumberIndices=t*this._leafNum,this._indexArrayBuffer=new Uint16Array(this._maxNumberIndices);var i=Lt.vertexDeclaration,n=i.vertexStride/4,a=new Float32Array(this._numberVertices*n),r=fi.CHUNK_GRID_NUM/fi.LEAF_GRID_NUM,s=0,o=0,l=0;for(s=0;s<this._leafNum;s++)o=s%r,l=Math.floor(s/r),this._leafs[s].calcVertextBuffer(this._chunkOffsetX,this._chunkOffsetZ,o*fi.LEAF_GRID_NUM,l*fi.LEAF_GRID_NUM,this._gridSize,a,s*fi.LEAF_PLANE_VERTEXT_COUNT,n,this._terrainHeightData,this._terrainHeightDataWidth,this._terrainHeightDataHeight,this._cameraCoordinateInverse);for(s=0;s<this._leafNum;s++)o=s%r,l=Math.floor(s/r),this._leafs[s].calcSkirtVertextBuffer(this._chunkOffsetX,this._chunkOffsetZ,o*fi.LEAF_GRID_NUM,l*fi.LEAF_GRID_NUM,this._gridSize,a,this._leafNum*fi.LEAF_PLANE_VERTEXT_COUNT+s*fi.LEAF_SKIRT_VERTEXT_COUNT,n,this._terrainHeightData,this._terrainHeightDataWidth,this._terrainHeightDataHeight);this.assembleIndexInit(),this._vertexBuffer=new On(i,this._numberVertices,35044,!1),this._indexBuffer=new Nn("ushort",this._maxNumberIndices,35044,!1),this._vertexBuffer.setData(a),this._indexBuffer.setData(this._indexArrayBuffer),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.calcOriginalBoudingBoxAndSphere()},t.setLODLevel=function(e){if(4!=e.length)return!0;var t=(e[0]+1<<24)+(e[1]+1<<16)+(e[2]+1<<8)+(e[3]+1);return this._currentLOD!=t&&(this._currentLOD=t,!0)},t.assembleIndexInit=function(){this._currentNumberIndices=0;for(var e=this._numberTriangle=0,t=0;t<this._leafNum;t++){var i=fi.getPlaneLODIndex(t,0);this._indexArrayBuffer.set(i,e),e+=i.length;var n=fi.getSkirtLODIndex(t,0);this._indexArrayBuffer.set(n,e),e+=n.length,this._currentNumberIndices+=i.length+n.length}this._numberTriangle=this._currentNumberIndices/3},t.isNeedAssemble=function(e,t){var i=Math.min(e.viewport.width,e.viewport.height)/(2*Math.tan(Math.PI*e.fieldOfView/180));return this._perspectiveFactor!=i?(this._perspectiveFactor=i,1):this._LODTolerance!=ea.LOD_TOLERANCE_VALUE?(this._LODTolerance=ea.LOD_TOLERANCE_VALUE,1):0==ai.equals(t,this._cameraPos)?(this._cameraPos.x=t.x,this._cameraPos.y=t.y,this._cameraPos.z=t.z,2):0},t.assembleIndex=function(e,t){var i=this.isNeedAssemble(e,t);if(0<i){for(var n=0;n<this._leafNum;n++)h._TEMP_ARRAY_BUFFER[n]=this._leafs[n].determineLod(t,this._perspectiveFactor,ea.LOD_TOLERANCE_VALUE,1==i);if(this.setLODLevel(h._TEMP_ARRAY_BUFFER)){this._currentNumberIndices=0;var a=this._numberTriangle=0;for(n=0;n<this._leafNum;n++){var r=h._TEMP_ARRAY_BUFFER[n],s=fi.getPlaneLODIndex(n,r);this._indexArrayBuffer.set(s,a),a+=s.length;var o=fi.getSkirtLODIndex(n,r);this._indexArrayBuffer.set(o,a),a+=o.length,this._currentNumberIndices+=s.length+o.length}return this._numberTriangle=this._currentNumberIndices/3,!0}}return!1},t.calcOriginalBoudingBoxAndSphere=function(){for(var e=new ni(2147483647,-2147483647),t=0;t<this._leafNum;t++)e.x=this._leafs[t]._sizeOfY.x<e.x?this._leafs[t]._sizeOfY.x:e.x,e.y=this._leafs[t]._sizeOfY.y>e.y?this._leafs[t]._sizeOfY.y:e.y;var i=new ai(this._chunkOffsetX*fi.CHUNK_GRID_NUM*this._gridSize,e.x,this._chunkOffsetZ*fi.CHUNK_GRID_NUM*this._gridSize),n=new ai((this._chunkOffsetX+1)*fi.CHUNK_GRID_NUM*this._gridSize,e.y,(this._chunkOffsetZ+1)*fi.CHUNK_GRID_NUM*this._gridSize);fi.__ADAPT_MATRIX__&&(ai.transformV3ToV3(i,fi.__ADAPT_MATRIX__,i),ai.transformV3ToV3(n,fi.__ADAPT_MATRIX__,n)),this._boundingBox=new Ht(i,n);var a=new ai;ai.subtract(n,i,a),ai.scale(a,.5,a);var r=new ai;ai.add(i,a,r),this._boundingSphere=new Gt(r,ai.scalarLength(a)),this._boundingBoxCorners=T(8,null),this._boundingBox.getCorners(this._boundingBoxCorners)},t.calcLeafBoudingBox=function(e){for(var t=0;t<this._leafNum;t++)this._leafs[t].calcLeafBoudingBox(e)},t.calcLeafBoudingSphere=function(e,t){for(var i=0;i<this._leafNum;i++)this._leafs[i].calcLeafBoudingSphere(e,t)},t._getVertexBuffer=function(e){return void 0===e&&(e=0),0==e?this._vertexBuffer:null},t._getIndexBuffer=function(){return this._indexBuffer},t._beforeRender=function(e){if(this._vertexBuffer._bind(),this._indexBuffer._bind(),0==e.renderElement._material.blend){var t=e.camera;this.assembleIndex(t,t.position)&&this._indexBuffer.setData(this._indexArrayBuffer)}return!0},t._getVertexBuffers=function(){return null},t._render=function(e){I.mainContext.drawElements(ea.RENDER_LINE_MODEL?1:4,this._currentNumberIndices,5123,0),w.trianglesFaces+=this._numberTriangle,w.drawCall++},v(0,t,"_originalBoundingSphere",function(){return this._boundingSphere}),v(0,t,"_originalBoundingBox",function(){return this._boundingBox}),v(0,t,"_vertexBufferCount",function(){return this._numberVertices}),v(0,t,"triangleCount",function(){return this._numberTriangle}),u(h,["_TEMP_ARRAY_BUFFER",function(){return this._TEMP_ARRAY_BUFFER=new Uint32Array(fi.CHUNK_GRID_NUM/fi.LEAF_GRID_NUM*fi.CHUNK_GRID_NUM/fi.LEAF_GRID_NUM)}]),h}(Oi),En=function(e){function t(e){this._terrainSprite3DOwner=null,t.__super.call(this,e),this._terrainSprite3DOwner=e}f(t,"laya.d3.terrain.TerrainRender",e);var i=t.prototype;return i._calculateBoundingSphere=function(){var e=this._terrainSprite3DOwner.terrainFilter;if(null==e)this._boundingSphere.toDefault();else{var t=e._originalBoundingSphere,i=NaN,n=this._terrainSprite3DOwner.transform,a=n.scale;i=a.x>=a.y&&a.x>=a.z?a.x:a.y>=a.z?a.y:a.z,ai.transformCoordinate(t.center,n.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=t.radius*i,e.calcLeafBoudingSphere(n.worldMatrix,i)}},i._calculateBoundingBox=function(){var e=this._terrainSprite3DOwner.terrainFilter;if(null==e)this._boundingBox.toDefault();else{for(var t=this._terrainSprite3DOwner.transform.worldMatrix,i=e._boundingBoxCorners,n=0;n<8;n++)ai.transformCoordinate(i[n],t,ki._tempBoundBoxCorners[n]);Ht.createfromPoints(ki._tempBoundBoxCorners,this._boundingBox),e.calcLeafBoudingBox(t)}},i._renderUpdate=function(e){this._setShaderValueMatrix4x4(0,this._owner.transform.worldMatrix);var t=this._owner.getProjectionViewWorldMatrix(e);return this._setShaderValueMatrix4x4(1,t),!0},i._destroy=function(){e.prototype._destroy.call(this),this._terrainSprite3DOwner=null},t}(ki),Sn=function(t){function n(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,n.__super.call(this),this._renderState=new se,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new _i,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new Se,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new ai(.7,.7,.7),this.ambientColor=new ai(.212,.227,.259),I.shaderHighPrecision&&this.addShaderDefine(Yi.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}f(n,"laya.d3.core.scene.Scene",t);var e=n.prototype;return x.imps(e,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),e._setUrl=function(e){this._url=e},e._getGroup=function(){return this._group},e._setGroup=function(e){this._group=e},e._display=function(){x.stage._scenes.push(this),x.stage._scenes.sort(n._sortScenes);for(var e=0,t=this._childs.length;e<t;e++){var i=this._childs[e];i.active&&i._activeHierarchy()}},e._unDisplay=function(){var e=x.stage._scenes;e.splice(e.indexOf(this),1);for(var t=0,i=this._childs.length;t<i;t++){var n=this._childs[t];n.active&&n._inActiveHierarchy()}},e._addChild3D=function(e){e.transform._onWorldTransform(),e._setBelongScene(this),this.displayedInStage&&e.active&&e._activeHierarchy()},e._removeChild3D=function(e){e.transform.parent=null,this.displayedInStage&&e.active&&e._inActiveHierarchy(),e._setUnBelongScene()},e.initOctree=function(e,t,i,n,a){void 0===a&&(a=6),this.treeSize=new ai(e,t,i),this.treeLevel=a,this.treeRoot=new le(this,0),this.treeRoot.init(n,this.treeSize)},e._prepareUpdateToRenderState=function(e,t){t.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,t.scene=this},e._prepareSceneToRender=function(e){var t=this._lights.length;if(0<t)for(var i=0,n=0;n<t&&!(this._lights[n]._prepareToScene(e)&&++i>=this._enableLightCount);n++);},e._updateChilds=function(e){for(var t=0,i=this._childs.length;t<i;++t)this._childs[t]._update(e)},e._preRenderScene=function(e,t,i){var n,a=t._viewMatrix,r=t._projectionMatrix,s=t._projectionViewMatrix,o=0,l=t.camera;for(l.useOcclusionCulling?this.treeRoot?xe.renderObjectCullingOctree(i,this,l,a,r,s):xe.renderObjectCulling(i,this,l,a,r,s):xe.renderObjectCullingNoBoundFrustum(this,l,a,r,s),o=0,n=this._quenes.length;o<n;o++)this._quenes[o]&&this._quenes[o]._preRender(t)},e._clear=function(e,t){var i=t._viewport,n=t.camera,a=i.x,r=n.renderTargetSize.height-i.y-i.height,s=i.width,o=i.height;e.viewport(a,r,s,o);var l=256,h=n.renderTarget;switch(n.clearFlag){case 0:var c=n.clearColor;if(c){e.enable(3089),e.scissor(a,r,s,o);var u=c.elements;e.clearColor(u[0],u[1],u[2],u[3]),l|=16384}if(h)switch(c||(l=16384),h.depthStencilFormat){case 33189:l|=256;break;case 36168:l|=1024;break;case 34041:l|=256,l|=1024}e.clear(l),c&&e.disable(3089);break;case 1:case 2:if(h)switch(l=16384,h.depthStencilFormat){case 33189:l|=256;break;case 36168:l|=1024;break;case 34041:l|=256,l|=1024}e.clear(l);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},e._renderScene=function(e,t){var i,n,a=t.camera,r=0;for(r=0;r<2;r++)(n=this._quenes[r])&&(a.renderTarget?n._render(t,!0):n._render(t,!1));if(1===a.clearFlag){var s=a.sky;s&&(D.setCullFace(e,!1),D.setDepthFunc(e,515),D.setDepthMask(e,!1),s._render(t),D.setDepthFunc(e,513),D.setDepthMask(e,!0))}for(r=2,i=this._quenes.length;r<i;r++)(n=this._quenes[r])&&(n._sortAlpha(t.camera.transform.position),a.renderTarget?n._render(t,!0):n._render(t,!1))},e._set3DRenderConfig=function(e){e.disable(3042),D._blend=!1,e.blendFunc(770,771),D._sFactor=770,D._dFactor=771,e.disable(2929),D._depthTest=!1,e.enable(2884),D._cullFace=!0,e.depthMask(1),D._depthMask=!0,e.frontFace(2304),D._frontFace=2304},e._set2DRenderConfig=function(e){D.setBlend(e,!0),D.setBlendFunc(e,1,771),D.setDepthTest(e,!1),D.setCullFace(e,!1),D.setDepthMask(e,!0),D.setFrontFace(e,2305),e.viewport(0,0,p.width,p.height)},e._parseCustomProps=function(e,t,i,n){var a=n.customProps.lightmaps,r=a.length,s=this._lightmaps;s.length=r;for(var o=0;o<r;o++)s[o]=Me.getRes(t[a[o].replace(".exr",".png")]);this.setlightmaps(s);var l=n.customProps.ambientColor;l&&(this.ambientColor=new ai(l[0],l[1],l[2]));var h=n.customProps.fogColor;h&&(this.fogColor=new ai(h[0],h[1],h[2]))},e._addLight=function(e){this._lights.indexOf(e)<0&&this._lights.push(e)},e._removeLight=function(e){var t=this._lights.indexOf(e);0<=t&&this._lights.splice(t,1)},e._updateScene=function(){var e=this._renderState;this._prepareUpdateToRenderState(I.mainContext,e),this._updateComponents(e),this._updateChilds(e),this._lateUpdateComponents(e),this._time+=e.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},e._updateSceneConch=function(){var e=this._renderState;this._prepareUpdateToRenderState(I.mainContext,e),this._updateComponents(e),this._lateUpdateComponents(e),this._prepareSceneToRender(e);for(var t=0,i=this._cameraPool.length;t<i;t++){var n=this._cameraPool[t];(e.camera=n)._prepareCameraToRender()}},e._preRenderShadow=function(e,t,i,n,a){this.treeRoot?xe.renderShadowObjectCullingOctree(this,t,i,n,a):xe.renderShadowObjectCulling(this,t,i,n,a);for(var r=0,s=i.length;r<s;r++)i[r]&&i[r]._preRender(e)},e._renderShadowMap=function(e,t,i){var n=this.parallelSplitShadowMaps[0];n._calcAllLightCameraInfo(i);var a,r,s,o=n.PSSMNum;if(this._preRenderShadow(t,n._lightCulling,n._shadowQuenes,n._lightVPMatrix[0],o),this.addShaderDefine(pi.SHADERDEFINE_CAST_SHADOW),1<o)for(var l=0;l<o;l++)a=n.getRenderTarget(l+1),n.beginRenderTarget(l+1),e.clearColor(1,1,1,1),e.clear(16640),e.viewport(0,0,a.width,a.height),t.camera=s=n.getLightCamera(l),s._prepareCameraToRender(),s._prepareCameraViewProject(s.viewMatrix,s.projectionMatrix),t._projectionViewMatrix=n._lightVPMatrix[l+1],(r=n._shadowQuenes[l])._preRender(t),r._renderShadow(t,!1),n.endRenderTarget(l+1);else a=n.getRenderTarget(1),n.beginRenderTarget(1),e.clearColor(1,1,1,1),e.clear(16640),e.viewport(0,0,a.width,a.height),t.camera=s=n.getLightCamera(0),s._prepareCameraToRender(),s._prepareCameraViewProject(s.viewMatrix,s.projectionMatrix),t._projectionViewMatrix=n._lightVPMatrix[0],(r=n._shadowQuenes[0])._preRender(t),r._renderShadow(t,!0),n.endRenderTarget(1);this.removeShaderDefine(pi.SHADERDEFINE_CAST_SHADOW)},e.addTreeNode=function(e){this.treeRoot.addTreeNode(e)},e.removeTreeNode=function(e){this.treeSize&&e._treeNode&&e._treeNode.removeObject(e)},e.setlightmaps=function(e){this._lightmaps=e;for(var t=0,i=this._renderableSprite3Ds.length;t<i;t++)this._renderableSprite3Ds[t]._render._applyLightMapParams()},e.getlightmaps=function(){return this._lightmaps},e.addChildAt=function(e,t){if(!(e instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!e||this.destroyed||e===this)return e;if(e.zOrder&&this._set$P("hasZorder",!0),0<=t&&t<=this._childs.length){if(e._parent===this){var i=this.getChildIndex(e);this._childs.splice(i,1),this._childs.splice(t,0,e),this.conchModel&&(this.conchModel.removeChild(e.conchModel),this.conchModel.addChildAt(e.conchModel,t)),this._childChanged()}else e.parent&&e.parent.removeChild(e),this._childs===c.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(t,0,e),this.conchModel&&this.conchModel.addChildAt(e.conchModel,t),(e.parent=this)._addChild3D(e);return e}throw new Error("appendChildAt:The index is out of bounds")},e.addChild=function(e){if(!(e instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!e||this.destroyed||e===this)return e;if(e.zOrder&&this._set$P("hasZorder",!0),e._parent===this){var t=this.getChildIndex(e);t!==this._childs.length-1&&(this._childs.splice(t,1),this._childs.push(e),this.conchModel&&(this.conchModel.removeChild(e.conchModel),this.conchModel.addChildAt(e.conchModel,this._childs.length-1)),this._childChanged())}else e.parent&&e.parent.removeChild(e),this._childs===c.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(e),this.conchModel&&this.conchModel.addChildAt(e.conchModel,this._childs.length-1),(e.parent=this)._childChanged(),this._addChild3D(e);return e},e.removeChildAt=function(e){var t=this.getChildAt(e);return t&&(this._removeChild3D(t),this._childs.splice(e,1),this.conchModel&&this.conchModel.removeChild(t.conchModel),t.parent=null),t},e.removeChildren=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=2147483647),this._childs&&0<this._childs.length){var i=this._childs;if(0===e&&r<=t){var n=i;this._childs=c.ARRAY_EMPTY}else n=i.splice(e,t-e);for(var a=0,r=n.length;a<r;a++)this._removeChild3D(n[a]),n[a].parent=null,this.conchModel&&this.conchModel.removeChild(n[a].conchModel)}return this},e.addFrustumCullingObject=function(e){this.treeRoot?this.addTreeNode(e):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(e):this._cullingRenders[this._cullingRendersLength]=e,e._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},e.removeFrustumCullingObject=function(e){if(this.treeRoot)this.removeTreeNode(e);else{this._cullingRendersLength--;var t=e._indexInSceneFrustumCullingObjects;if(t!==this._cullingRendersLength){var i=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[t]=i)._indexInSceneFrustumCullingObjects=t,e._indexInSceneFrustumCullingObjects=-1}}},e.getRenderQueue=function(e){return e<3e3?this._quenes[1]||(this._quenes[1]=new re(this)):this._quenes[2]||(this._quenes[2]=new re(this))},e.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new re(this)},e.addShaderDefine=function(e){this._shaderDefineValue|=e},e.removeShaderDefine=function(e){this._shaderDefineValue&=~e},e.addScript=function(e){return this._addComponent(e)},e.getScriptByType=function(e,t){return void 0===t&&(t=0),this._getComponentByType(e,t)},e.getScriptsByType=function(e,t){this._getComponentsByType(e,t)},e.getScriptByIndex=function(e){return this._getComponentByIndex(e)},e.removeScriptByType=function(e,t){void 0===t&&(t=0),this._removeComponentByType(e,t)},e.removeScriptsByType=function(e){this._removeComponentByType(e)},e.removeAllScript=function(){this._removeAllComponent()},e.render=function(e,t,i){(_._context.ctx._renderKey=0)<this._childs.length&&e.addRenderObject(this)},e.renderSubmit=function(){var e=I.mainContext,t=this._renderState;this._set3DRenderConfig(e),this._prepareSceneToRender(this._renderState);var i,n=0,a=0;if(Ii.debugMode||le.debugMode)for(n=0,a=this._cameraPool.length;n<a;n++)i=this._cameraPool[n],Ii._debugPhasorSprite.begin(1,i),i.activeInHierarchy&&i._renderCamera(e,t,this),Ii._debugPhasorSprite.end();else for(n=0,a=this._cameraPool.length;n<a;n++)(i=this._cameraPool[n]).activeInHierarchy&&i._renderCamera(e,t,this);return this._set2DRenderConfig(e),1},e.onAsynLoaded=function(e,t,i){var n=t[0];if("Scene"!==n.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var a=t[1];Li._createNodeByJson(this,n,this,a),this.event("hierarchyloaded",[this]),this.__loaded=!0},e.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,Me.clearRes(this.url),this.loaded||Ii._cancelLoadByUrl(this.url))},e.getRenderType=function(){return 0},e.releaseRender=function(){},e._addComponent=function(e){var t,i=this._componentsMap.indexOf(e);if(-1===i)t=[],this._componentsMap.push(e),this._typeComponentsIndices.push(t);else if(t=this._typeComponentsIndices[i],this._components[t[0]].isSingleton)throw new Error("无法单实例创建"+e+"组件，"+e+"组件已存在！");var n=l.getInstance(e);t.push(this._components.length),this._components.push(n);return n._initialize(this),n},e._removeComponent=function(e,t){var i=this._typeComponentsIndices[e],n=i[t],a=this._components[n];this._components.splice(n,1),i.splice(t,1),0===i.length&&(this._typeComponentsIndices.splice(e,1),this._componentsMap.splice(e,1));for(var r=0,s=this._componentsMap.length;r<s;r++)for(var o=(i=this._typeComponentsIndices[r]).length-1;0<=o;o--){var l=i[o];if(!(n<l))break;i[o]=--l}a._destroy()},e._getComponentByType=function(e,t){void 0===t&&(t=0);var i=this._componentsMap.indexOf(e);return-1===i?null:this._components[this._typeComponentsIndices[i][t]]},e._getComponentsByType=function(e,t){var i=this._componentsMap.indexOf(e);if(-1!==i){var n=this._typeComponentsIndices[i],a=n.length;t.length=a;for(var r=0;r<a;r++)t[r]=this._components[n[r]]}else t.length=0},e._getComponentByIndex=function(e){return this._components[e]},e._removeComponentByType=function(e,t){void 0===t&&(t=0);var i=this._componentsMap.indexOf(e);-1!==i&&this._removeComponent(i,t)},e._removeComponentsByType=function(e){var t=this._componentsMap.indexOf(e);if(-1!==t)for(var i=this._typeComponentsIndices[t],n=0,a=i.length;n<a;i.length<a?a--:n++)this._removeComponent(t,n)},e._removeAllComponent=function(){for(var e=0,t=this._componentsMap.length;e<t;this._componentsMap.length<t?t--:e++)this._removeComponentsByType(this._componentsMap[e])},e._updateComponents=function(e){for(var t=0,i=this._components.length;t<i;t++){var n=this._components[t];n.started||(n._start(e),n.started=!0),n.enable&&n._update(e)}},e._lateUpdateComponents=function(e){for(var t=0;t<this._components.length;t++){var i=this._components[t];i.started||(i._start(e),i.started=!0),i.enable&&i._lateUpdate(e)}},e._preRenderUpdateComponents=function(e){for(var t=0;t<this._components.length;t++){var i=this._components[t];i.started||(i._start(e),i.started=!0),i.enable&&i._preRenderUpdate(e)}},e._postRenderUpdateComponents=function(e){for(var t=0;t<this._components.length;t++){var i=this._components[t];i.started||(i._start(e),i.started=!0),i.enable&&i._postRenderUpdate(e)}},v(0,e,"_loaded",null,function(e){this.__loaded=e}),v(0,e,"fogColor",function(){return this._fogColor},function(e){this._fogColor=e,this._shaderValues.setValue(0,e.elements)}),v(0,e,"enableFog",function(){return this._enableFog},function(e){this._enableFog!==e&&((this._enableFog=e)?(this.addShaderDefine(Yi.SHADERDEFINE_FOG),this.removeShaderDefine(Yi.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(Yi.SHADERDEFINE_FOG))}),v(0,e,"url",function(){return this._url}),v(0,e,"loaded",function(){return this.__loaded}),v(0,e,"enableDepthFog",function(){return this._enableDepthFog},function(e){this._enableDepthFog!=e&&((this._enableDepthFog=e)?(this.addShaderDefine(Yi.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(Yi.SHADERDEFINE_FOG)):this.removeShaderDefine(Yi.SAHDERDEFINE_DEPTHFOG))}),v(0,e,"fogStart",function(){return this._fogStart},function(e){this._fogStart=e,this._shaderValues.setValue(1,e)}),v(0,e,"fogRange",function(){return this._fogRange},function(e){this._fogRange=e,this._shaderValues.setValue(2,e)}),v(0,e,"ambientColor",function(){return this._ambientColor},function(e){this._ambientColor=e,this._shaderValues.setValue(21,e.elements)}),v(0,e,"scene",function(){return this}),v(0,e,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),n._sortScenes=function(e,t){if(e.parent!==x.stage||t.parent!==x.stage)return e.parent!==x.stage&&t.parent!==x.stage?n._sortScenes(e.parent,t.parent):e.parent===x.stage?-1:1;var i=x.stage._childs;return i.indexOf(e)-i.indexOf(t)},n.load=function(e){return x.loader.create(e,null,null,n)},n.FOGCOLOR=0,n.FOGSTART=1,n.FOGRANGE=2,n.LIGHTDIRECTION=3,n.LIGHTDIRCOLOR=4,n.POINTLIGHTPOS=5,n.POINTLIGHTRANGE=6,n.POINTLIGHTATTENUATION=7,n.POINTLIGHTCOLOR=8,n.SPOTLIGHTPOS=9,n.SPOTLIGHTDIRECTION=10,n.SPOTLIGHTSPOT=11,n.SPOTLIGHTRANGE=12,n.SPOTLIGHTATTENUATION=13,n.SPOTLIGHTCOLOR=14,n.SHADOWDISTANCE=15,n.SHADOWLIGHTVIEWPROJECT=16,n.SHADOWMAPPCFOFFSET=17,n.SHADOWMAPTEXTURE1=18,n.SHADOWMAPTEXTURE2=19,n.SHADOWMAPTEXTURE3=20,n.AMBIENTCOLOR=21,n.TIME=22,n}(S),xn=function(){function t(e){t.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new qt,this._shaderValues=new _i,this._colliders=[],this._id=++t._uniqueIDCounter,this._transform=new Vi(this),this.name=e||"Sprite3D-"+t._nameNumberCounter++,this.layer=Y.currentCreationLayer,this.active=!0}f(t,"laya.d3.core.Sprite3D",Zi);var e=t.prototype;return x.imps(e,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),e._setUrl=function(e){this._url=e},e._getGroup=function(){return this._group},e._setGroup=function(e){this._group=e},e._addChild3D=function(e){e.transform.parent=this.transform,this._hierarchyAnimator&&(e._hierarchyAnimator||e._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(e,!0,[e.name])),this._scene&&(e._setBelongScene(this._scene),this._activeInHierarchy&&e._active&&e._activeHierarchy())},e._removeChild3D=function(e){e.transform.parent=null,this._scene&&(this._activeInHierarchy&&e._active&&e._inActiveHierarchy(),e._setUnBelongScene()),this._hierarchyAnimator&&(e._hierarchyAnimator==this._hierarchyAnimator&&e._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(e,!1,[e.name]))},e._parseBaseCustomProps=function(e){var t=this.transform.localPosition;t.fromArray(e.translate),this.transform.localPosition=t;var i=this.transform.localRotation;i.fromArray(e.rotation),this.transform.localRotation=i;var n=this.transform.localScale;n.fromArray(e.scale),this.transform.localScale=n;var a=e.layer;null!=a&&(this.layer=Y.getLayerByNumber(a))},e._parseCustomComponent=function(e,t,i){for(var n in i){var a=i[n];switch(n){case"Animator":var r=this.addComponent(ln);if(a.avatarPath)r.avatar=Me.getRes(t[a.avatarPath]);else{var s=a.avatar;if(s){r.avatar=Me.getRes(t[s.path]);var o=s.linkSprites;o&&e.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[r,o])}}for(var l=a.clipPaths,h=l.length,c=0;c<h;c++)r.addClip(Me.getRes(t[l[c]]));r.clip=Me.getRes(t[l[0]]);var u=a.playOnWake;void 0!==u&&(r.playOnWake=u);break;case"Rigidbody":this.addComponent(cn);break;case"SphereCollider":var d=this.addComponent(Un);d.isTrigger=a.isTrigger;var _=d.center;_.fromArray(a.center),d.center=_,d.radius=a.radius;break;case"BoxCollider":var p=this.addComponent(Fn);p.isTrigger=a.isTrigger,p.center.fromArray(a.center);var f=p.size;f.fromArray(a.size),p.size=f;break;case"MeshCollider":this.addComponent(Hn)}}},e._onRootNodeHierarchyLoaded=function(e,t){for(var i in t){for(var n=this,a=t[i],r=0,s=a.length;r<s;r++){var o=a[r];if(""===o)break;if(!(n=n.getChildByName(o)))break}n&&e.linkSprite3DToAvatarNode(i,n)}},e._setHierarchyAnimator=function(e,t){this._changeHierarchyAnimator(e);for(var i=0,n=this._childs.length;i<n;i++){var a=this._childs[i];a._hierarchyAnimator==t&&a._setHierarchyAnimator(e,t)}},e._clearHierarchyAnimator=function(e,t){this._changeHierarchyAnimator(t);for(var i=0,n=this._childs.length;i<n;i++){var a=this._childs[i];a._hierarchyAnimator==e&&a._clearHierarchyAnimator(e,t)}},e._getAnimatorToLinkSprite3D=function(e,t,i){var n=this.getComponentByType(ln);if(n&&(n.avatar?n.avatar._version||e._setAnimatorToLinkAvatar(n,t):e._setAnimatorToLinkSprite3DNoAvatar(n,t,i)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){i.unshift(this._parent.name);var a=this._parent;a._hierarchyAnimator&&a._getAnimatorToLinkSprite3D(e,t,i)}},e._setAnimatorToLinkSprite3DNoAvatar=function(e,t,i){var n=0,a=0;for(n=0,a=e.getClipCount();n<a;n++)e._handleSpriteOwnersBySprite(n,t,i,this);for(n=0,a=this._childs.length;n<a;n++){var r=this._childs[n],s=i.length;i.push(r.name),r._setAnimatorToLinkSprite3DNoAvatar(e,t,i),i.splice(s,1)}},e._changeHierarchyAnimator=function(e){this._hierarchyAnimator=e},e._isLinkSpriteToAnimationNode=function(e,t,i){var n=e._avatarNodes.indexOf(t),a=e._cacheSpriteToNodesMap;if(i)this._transform.dummy=t.transform,e._cacheNodesToSpriteMap[n]=a.length,a.push(n);else{this._transform.dummy=null;var r=e._cacheNodesToSpriteMap[n];e._cacheNodesToSpriteMap[n]=null,a.splice(r,1)}},e._setBelongScene=function(e){this._scene=e;for(var t=0,i=this._childs.length;t<i;t++)this._childs[t]._setBelongScene(e)},e._setUnBelongScene=function(){this._scene=null;for(var e=0,t=this._childs.length;e<t;e++)this._childs[e]._setUnBelongScene()},e._activeHierarchy=function(){var e=0,t=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),e=0,t=this._colliders.length;e<t;e++)this._layer._addCollider(this._colliders[e]);for(this.event("activeinhierarchychanged",!0),e=0,t=this._childs.length;e<t;e++){var i=this._childs[e];i._active&&i._activeHierarchy()}},e._inActiveHierarchy=function(){var e=0,t=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),e=0,t=this._colliders.length;e<t;e++){var i=this._colliders[e];i._clearCollsionMap(),this._layer._removeCollider(i)}for(this.event("activeinhierarchychanged",!1),e=0,t=this._childs.length;e<t;e++){var n=this._childs[e];n._active&&n._inActiveHierarchy()}},e.addComponent=function(e){var t,i=this._componentsMap.indexOf(e);if(-1===i)t=[],this._componentsMap.push(e),this._typeComponentsIndices.push(t);else if(t=this._typeComponentsIndices[i],this._components[t[0]].isSingleton)throw new Error("无法单实例创建"+e+"组件，"+e+"组件已存在！");var n=l.getInstance(e);if(t.push(this._components.length),this._components.push(n),n instanceof laya.d3.component.physics.Collider)this.getComponentByType(cn)&&(n._isRigidbody=!0),this._activeInHierarchy&&this._layer._addCollider(n),this._colliders.push(n);else if(n instanceof laya.d3.component.Animator){var a=n;this._setHierarchyAnimator(a,this._parent?this._parent._hierarchyAnimator:null),this._setAnimatorToLinkSprite3DNoAvatar(a,!0,[])}else if(n instanceof laya.d3.component.Rigidbody)for(var r=0,s=this._colliders.length;r<s;r++)this._colliders[r]._setIsRigidbody(!0);return n instanceof laya.d3.component.Script&&this._scripts.push(n),n._initialize(this),n},e._removeComponent=function(e,t){var i=0,n=0,a=this._typeComponentsIndices[e],r=a[t],s=this._components[r];if(s instanceof laya.d3.component.physics.Collider){var o=s;this._activeInHierarchy&&this._layer._removeCollider(o),this._colliders.splice(this._colliders.indexOf(o),1)}else if(s instanceof laya.d3.component.Animator){var l=s;this._clearHierarchyAnimator(l,this._parent?this._parent._hierarchyAnimator:null)}else if(s instanceof laya.d3.component.Rigidbody)for(i=0,n=this._colliders.length;i<n;i++){var h=this._colliders[i];h._setIsRigidbody(!1);var c=h._runtimeCollisonMap,u=h._runtimeCollisonTestMap;for(var d in c)delete u[d]}for(this._components.splice(r,1),s instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(s),1),a.splice(t,1),0===a.length&&(this._typeComponentsIndices.splice(e,1),this._componentsMap.splice(e,1)),i=0,n=this._componentsMap.length;i<n;i++)for(var _=(a=this._typeComponentsIndices[i]).length-1;0<=_;_--){var p=a[_];if(!(r<p))break;a[_]=--p}s._destroy()},e._clearSelfRenderObjects=function(){},e._addSelfRenderObjects=function(){},e._parseCustomProps=function(e,t,i,n){},e._updateChilds=function(e){var t=this._childs.length;if(0!==t)for(var i=0;i<t;++i)this._childs[i]._update(e)},e._getSortID=function(e,t){return 1e3*t.id+e._getVertexBuffer().vertexDeclaration.id},e._update=function(e){(e.owner=this)._activeInHierarchy&&(this._updateComponents(e),this._lateUpdateComponents(e),w.spriteCount++,this._childs.length&&this._updateChilds(e))},e.getProjectionViewWorldMatrix=function(e){return qt.multiply(e,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},e.loadHierarchy=function(e){this.addChild(laya.d3.core.Sprite3D.load(e))},e.addChildAt=function(e,t){if(!(e instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!e||this.destroyed||e===this)return e;if(e.zOrder&&this._set$P("hasZorder",!0),0<=t&&t<=this._childs.length){if(e._parent===this){var i=this.getChildIndex(e);this._childs.splice(i,1),this._childs.splice(t,0,e),this.conchModel&&(this.conchModel.removeChild(e.conchModel),this.conchModel.addChildAt(e.conchModel,t)),this._childChanged()}else e.parent&&e.parent.removeChild(e),this._childs===c.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(t,0,e),this.conchModel&&this.conchModel.addChildAt(e.conchModel,t),(e.parent=this)._addChild3D(e);return e}throw new Error("appendChildAt:The index is out of bounds")},e.addChild=function(e){if(!(e instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!e||this.destroyed||e===this)return e;if(e.zOrder&&this._set$P("hasZorder",!0),e._parent===this){var t=this.getChildIndex(e);t!==this._childs.length-1&&(this._childs.splice(t,1),this._childs.push(e),this.conchModel&&(this.conchModel.removeChild(e.conchModel),this.conchModel.addChildAt(e.conchModel,this._childs.length-1)),this._childChanged())}else e.parent&&e.parent.removeChild(e),this._childs===c.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(e),this.conchModel&&this.conchModel.addChildAt(e.conchModel,this._childs.length-1),(e.parent=this)._childChanged(),this._addChild3D(e);return e},e.removeChildAt=function(e){var t=this.getChildAt(e);return t&&(this._removeChild3D(t),this._childs.splice(e,1),this.conchModel&&this.conchModel.removeChild(t.conchModel),t.parent=null),t},e.removeChildren=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=2147483647),this._childs&&0<this._childs.length){var i=this._childs;if(0===e&&r<=t){var n=i;this._childs=c.ARRAY_EMPTY}else n=i.splice(e,t-e);for(var a=0,r=n.length;a<r;a++)this._removeChild3D(n[a]),n[a].parent=null,this.conchModel&&this.conchModel.removeChild(n[a].conchModel)}return this},e.onAsynLoaded=function(e,t,i){var n=t[0];if("Sprite3D"!==n.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var a=t[1];Li._createNodeByJson(this,n,this,a),this.event("hierarchyloaded",[this]),this.__loaded=!0},e.cloneTo=function(e){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var t=e;t.name=this.name,t._destroyed=this._destroyed,t.timer=this.timer,t._$P=this._$P,t.active=this._active;var i=t.transform.localPosition;this.transform.localPosition.cloneTo(i),t.transform.localPosition=i;var n=t.transform.localRotation;this.transform.localRotation.cloneTo(n),t.transform.localRotation=n;var a=t.transform.localScale;this.transform.localScale.cloneTo(a),t.transform.localScale=a,t.isStatic=this.isStatic;var r=0,s=0;for(r=0,s=this._componentsMap.length;r<s;r++){var o=t.addComponent(this._componentsMap[r]);this._components[r]._cloneTo(o)}for(r=0,s=this._childs.length;r<s;r++)t.addChild(this._childs[r].clone());var l=t.getComponentByType(ln);if(l){var h=l._linkSpritesData;if(h)for(var c in h){for(var u=h[c],d=t,_=0,p=u.length;_<p&&(d=d.getChildByName(u[_]));_++);if(d){var f=l._avatarNodeMap[c];d._isLinkSpriteToAnimationNode(l,f,!0)}}}},e.clone=function(){var e=new this.constructor;return this.cloneTo(e),e},e.destroy=function(e){if(void 0===e&&(e=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,e);var t,i=0;for(i=0,t=this._components.length;i<t;i++)this._components[i]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,Me.clearRes(this.url),this.loaded||Ii._cancelLoadByUrl(this.url)}},e._handleSpriteToAvatar=function(e,t){e._avatarNodes;var i=e._avatarNodeMap[this.name];i&&i.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(e,i,t)},e._setAnimatorToLinkAvatar=function(e,t){this._handleSpriteToAvatar(e,t);for(var i=0,n=this._childs.length;i<n;i++){this._childs[i]._setAnimatorToLinkAvatar(e,t)}},v(0,e,"activeInHierarchy",function(){return this._activeInHierarchy}),v(0,e,"_loaded",null,function(e){this.__loaded=e}),v(0,e,"active",function(){return this._active},function(e){this._active!==e&&(this._active=e,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(e?this._activeHierarchy():this._inActiveHierarchy()))}),v(0,e,"componentsCount",function(){return this._components.length}),v(0,e,"loaded",function(){return this.__loaded}),v(0,e,"id",function(){return this._id}),v(0,e,"url",function(){return this._url}),v(0,e,"layer",function(){return this._layer},function(e){if(this._layer!==e){if(!e)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var t=0,i=this._colliders.length;if(this._layer)for(t=0;t<i;t++)this._layer._removeCollider(this._colliders[t]);for(t=0;t<i;t++)e._addCollider(this._colliders[t])}this._layer=e,this.event("layerchanged",e)}}),v(0,e,"scene",function(){return this._scene}),v(0,e,"transform",function(){return this._transform}),t.instantiate=function(e,t,i,n,a){void 0===i&&(i=!0);var r=e.clone();t&&t.addChild(r);var s=r.transform;if(i){var o=s.worldMatrix;e.transform.worldMatrix.cloneTo(o),s.worldMatrix=o}else n&&(s.position=n),a&&(s.rotation=a);return r},t.load=function(e){return x.loader.create(e,null,null,t)},t.WORLDMATRIX=0,t.MVPMATRIX=1,t._uniqueIDCounter=0,t._nameNumberCounter=0,t}(),Tn=function(){function h(e,t,i,n,a,r,s,o){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],h.__super.call(this),!e||!t)throw"Shader Error";this._id=++h._count,this._vs=e,this._ps=t,this._attributeMap=i,this._sceneUniformMap=n,this._cameraUniformMap=a,this._spriteUniformMap=r,this._materialUniformMap=s,this._renderElementUniformMap=o,this.recreateResource()}f(h,"laya.d3.shader.Shader3D",t);var e=h.prototype;return e.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},e.disposeResource=function(){I.mainContext.deleteShader(this._vshader),I.mainContext.deleteShader(this._pshader),I.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var e=[this._vs,this._ps],t=I.mainContext;if(this._program=t.createProgram(),this._vshader=h._createShader(t,e[0],35633),this._pshader=h._createShader(t,e[1],35632),t.attachShader(this._program,this._vshader),t.attachShader(this._program,this._pshader),t.linkProgram(this._program),!_.isConchApp&&Yi.debugMode&&!t.getProgramParameter(this._program,35714))throw t.getProgramInfoLog(this._program);var i,n=0,a=0,r=0;for(r=_.isConchApp?t.getProgramParameterEx(this._vs,this._ps,"",35721):t.getProgramParameter(this._program,35721),n=0;n<r;n++){var s=null;i={vartype:"attribute",ivartype:0,attrib:s=_.isConchApp?t.getActiveAttribEx(this._vs,this._ps,"",n):t.getActiveAttrib(this._program,n),location:t.getAttribLocation(this._program,s.name),name:s.name,type:s.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(i)}var o=0;for(o=_.isConchApp?t.getProgramParameterEx(this._vs,this._ps,"",35718):t.getProgramParameter(this._program,35718),n=0;n<o;n++){var l=null;l=_.isConchApp?t.getActiveUniformEx(this._vs,this._ps,"",n):t.getActiveUniform(this._program,n),0<(i={vartype:"uniform",ivartype:1,attrib:s,location:t.getUniformLocation(this._program,l.name),name:l.name,type:l.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(i.name=i.name.substr(0,i.name.length-3),i.isArray=!0,i.location=t.getUniformLocation(this._program,i.name)),this._uniformParams.push(i)}for(n=0,a=this._attributeParams.length;n<a;n++)(i=this._attributeParams[n]).indexOfParams=n,i.index=1,i.value=[i.location,null],i.codename=i.name,i.name=null!=this._attributeMap[i.codename]?this._attributeMap[i.codename]:i.codename,this._attributeParamsMap.push(i.name),this._attributeParamsMap.push(i),i._this=this,i.uploadedValue=[],i.fun=this._attribute;for(n=0,a=this._uniformParams.length;n<a;n++)switch((i=this._uniformParams[n]).indexOfParams=n,i.index=1,i.value=[i.location,null],i.codename=i.name,null!=this._sceneUniformMap[i.codename]?(i.name=this._sceneUniformMap[i.codename],this._sceneUniformParamsMap.push(i.name),this._sceneUniformParamsMap.push(i)):null!=this._cameraUniformMap[i.codename]?(i.name=this._cameraUniformMap[i.codename],this._cameraUniformParamsMap.push(i.name),this._cameraUniformParamsMap.push(i)):null!=this._spriteUniformMap[i.codename]?(i.name=this._spriteUniformMap[i.codename],this._spriteUniformParamsMap.push(i.name),this._spriteUniformParamsMap.push(i)):null!=this._materialUniformMap[i.codename]?(i.name=this._materialUniformMap[i.codename],this._materialUniformParamsMap.push(i.name),this._materialUniformParamsMap.push(i)):null!=this._renderElementUniformMap[i.codename]?(i.name=this._renderElementUniformMap[i.codename],this._renderElementUniformParamsMap.push(i.name),this._renderElementUniformParamsMap.push(i)):console.log("Shader:can't find uinform name:"+i.codename+" in shader file."),i._this=this,i.uploadedValue=[],i.type){case 5124:i.fun=i.isArray?this._uniform1iv:this._uniform1i;break;case 5126:i.fun=i.isArray?this._uniform1fv:this._uniform1f;break;case 35664:i.fun=i.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:i.fun=i.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:i.fun=i.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:i.fun=this._uniform_sampler2D;break;case 35680:i.fun=this._uniform_samplerCube;break;case 35676:i.fun=this._uniformMatrix4fv;break;case 35670:i.fun=this._uniform1i;break;case 35674:i.fun=this._uinformMatrix2fv;break;case 35675:i.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},e._attribute=function(e,t){var i=I.mainContext,n=o._enableAtributes,a=e.location;return n[a]||i.enableVertexAttribArray(a),i.vertexAttribPointer(a,t[0],t[1],t[2],t[3],t[4]),n[a]=o._bindVertexBuffer,1},e._uniform1f=function(e,t){var i=e.uploadedValue;return i[0]!==t?(I.mainContext.uniform1f(e.location,i[0]=t),1):0},e._uniform1fv=function(e,t){if(t.length<4){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]||i[3]!==t[3]?(I.mainContext.uniform1fv(e.location,t),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],1):0}return I.mainContext.uniform1fv(e.location,t),1},e._uniform_vec2=function(e,t){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]?(I.mainContext.uniform2f(e.location,i[0]=t[0],i[1]=t[1]),1):0},e._uniform_vec2v=function(e,t){if(t.length<2){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]||i[3]!==t[3]?(I.mainContext.uniform2fv(e.location,t),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],1):0}return I.mainContext.uniform2fv(e.location,t),1},e._uniform_vec3=function(e,t){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]?(I.mainContext.uniform3f(e.location,i[0]=t[0],i[1]=t[1],i[2]=t[2]),1):0},e._uniform_vec3v=function(e,t){return I.mainContext.uniform3fv(e.location,t),1},e._uniform_vec4=function(e,t){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]||i[3]!==t[3]?(I.mainContext.uniform4f(e.location,i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3]),1):0},e._uniform_vec4v=function(e,t){return I.mainContext.uniform4fv(e.location,t),1},e._uniformMatrix2fv=function(e,t){return I.mainContext.uniformMatrix2fv(e.location,!1,t),1},e._uniformMatrix3fv=function(e,t){return I.mainContext.uniformMatrix3fv(e.location,!1,t),1},e._uniformMatrix4fv=function(e,t){return I.mainContext.uniformMatrix4fv(e.location,!1,t),1},e._uinformMatrix2fv=function(e,t){return I.mainContext.uniformMatrix2fv(e.location,!1,t),1},e._uinformMatrix3fv=function(e,t){return I.mainContext.uniformMatrix3fv(e.location,!1,t),1},e._uniform1i=function(e,t){var i=e.uploadedValue;return i[0]!==t?(I.mainContext.uniform1i(e.location,i[0]=t),1):0},e._uniform1iv=function(e,t){return I.mainContext.uniform1iv(e.location,t),1},e._uniform_ivec2=function(e,t){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]?(I.mainContext.uniform2i(e.location,i[0]=t[0],i[1]=t[1]),1):0},e._uniform_ivec2v=function(e,t){return I.mainContext.uniform2iv(e.location,t),1},e._uniform_vec3i=function(e,t){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]?(I.mainContext.uniform3i(e.location,i[0]=t[0],i[1]=t[1],i[2]=t[2]),1):0},e._uniform_vec3vi=function(e,t){return I.mainContext.uniform3iv(e.location,t),1},e._uniform_vec4i=function(e,t){var i=e.uploadedValue;return i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]||i[3]!==t[3]?(I.mainContext.uniform4i(e.location,i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3]),1):0},e._uniform_vec4vi=function(e,t){return I.mainContext.uniform4iv(e.location,t),1},e._uniform_sampler2D=function(e,t){var i=t.source||t.defaulteTexture.source,n=I.mainContext,a=e.uploadedValue;if(null!=a[0])return n.activeTexture(h._TEXTURES[a[0]]),i&&D.bindTexture(n,3553,i),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return a[0]=this._curActTexIndex,n.uniform1i(e.location,this._curActTexIndex),n.activeTexture(h._TEXTURES[this._curActTexIndex]),i&&D.bindTexture(n,3553,i),this._curActTexIndex++,1},e._uniform_samplerCube=function(e,t){var i=t.source||t.defaulteTexture.source,n=I.mainContext,a=e.uploadedValue;if(null!=a[0])return n.activeTexture(h._TEXTURES[a[0]]),i?D.bindTexture(n,34067,i):D.bindTexture(n,34067,Yn.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return a[0]=this._curActTexIndex,n.uniform1i(e.location,this._curActTexIndex),n.activeTexture(h._TEXTURES[this._curActTexIndex]),i?D.bindTexture(n,34067,i):D.bindTexture(n,34067,Yn.grayTexture.source),this._curActTexIndex++,1},e._noSetValue=function(e){console.log("no....:"+e.name)},e.bind=function(){return t.activeShader=this,(t.bindShader=this).activeResource(),D.UseProgram(this._program)},e.uploadAttributes=function(e,t){for(var i,n,a=0,r=0,s=this._attributeParamsMap.length;r<s;r+=2)n=this._attributeParamsMap[r+1],null!=(i=e[this._attributeParamsMap[r]])&&(t&&t[n.name]&&t[n.name].bind(),a+=n.fun.call(this,n,i));w.shaderCall+=a},e.uploadAttributesX=function(e,t){for(var i,n,a=0,r=0,s=this._attributeParamsMap.length;r<s;r+=2)n=this._attributeParamsMap[r+1],null!=(i=e[this._attributeParamsMap[r]])&&(t._bind(),a+=n.fun.call(this,n,i));w.shaderCall+=a},e.uploadSceneUniforms=function(e){for(var t,i,n=0,a=0,r=this._sceneUniformParamsMap.length;a<r;a+=2)i=this._sceneUniformParamsMap[a+1],null!=(t=e[this._sceneUniformParamsMap[a]])&&(n+=i.fun.call(this,i,t));w.shaderCall+=n},e.uploadCameraUniforms=function(e){for(var t,i,n=0,a=0,r=this._cameraUniformParamsMap.length;a<r;a+=2)i=this._cameraUniformParamsMap[a+1],null!=(t=e[this._cameraUniformParamsMap[a]])&&(n+=i.fun.call(this,i,t));w.shaderCall+=n},e.uploadSpriteUniforms=function(e){for(var t,i,n=0,a=0,r=this._spriteUniformParamsMap.length;a<r;a+=2)i=this._spriteUniformParamsMap[a+1],null!=(t=e[this._spriteUniformParamsMap[a]])&&(n+=i.fun.call(this,i,t));w.shaderCall+=n},e.uploadMaterialUniforms=function(e){for(var t,i,n=0,a=0,r=this._materialUniformParamsMap.length;a<r;a+=2)i=this._materialUniformParamsMap[a+1],null!=(t=e[this._materialUniformParamsMap[a]])&&(n+=i.fun.call(this,i,t));w.shaderCall+=n},e.uploadRenderElementUniforms=function(e){for(var t,i,n=0,a=0,r=this._renderElementUniformParamsMap.length;a<r;a+=2)i=this._renderElementUniformParamsMap[a+1],null!=(t=e[this._renderElementUniformParamsMap[a]])&&(n+=i.fun.call(this,i,t));w.shaderCall+=n},h.create=function(e,t,i,n,a,r,s,o){return new h(e,t,i,n,a,r,s,o)},h.addInclude=function(e,t){E.addInclude(e,t)},h._createShader=function(e,t,i){var n=e.createShader(i);if(e.shaderSource(n,t),e.compileShader(n),Yi.debugMode&&!e.getShaderParameter(n,35713))throw e.getShaderInfoLog(n);return n},h.PERIOD_RENDERELEMENT=0,h.PERIOD_MATERIAL=1,h.PERIOD_SPRITE=2,h.PERIOD_CAMERA=3,h.PERIOD_SCENE=4,h._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],h._count=0,u(h,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new M}]),h}(),wn=function(i){function t(){t.__super.call(this),this.setShaderName("BLINNPHONG"),this._albedoIntensity=1,this._albedoColor=new ri(1,1,1,1),this._setColor(6,new ri(1,1,1,1)),this._setColor(8,new ai(1,1,1)),this._setNumber(9,.078125),this._setColor(10,new ai(1,1,1)),this._setNumber(0,.5),this._setColor(11,new ri(1,1,0,0)),this._enableLighting=!0,this.renderMode=0}f(t,"laya.d3.core.material.BlinnPhongMaterial",i);var e=t.prototype;return e.disableLight=function(){this._addDisablePublicShaderDefine(Yi.SHADERDEFINE_POINTLIGHT|Yi.SHADERDEFINE_SPOTLIGHT|Yi.SHADERDEFINE_DIRECTIONLIGHT)},e.disableFog=function(){this._addDisablePublicShaderDefine(Yi.SHADERDEFINE_FOG)},e.cloneTo=function(e){i.prototype.cloneTo.call(this,e);var t=e;t._enableLighting=this._enableLighting,t._albedoIntensity=this._albedoIntensity,this._albedoColor.cloneTo(t._albedoColor)},v(0,e,"renderMode",null,function(e){switch(e){case 0:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this.depthTest=513,this._removeShaderDefine(t.SHADERDEFINE_ADDTIVEFOG);break;case 1:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this.depthTest=513,this._removeShaderDefine(t.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this.depthTest=513,this._removeShaderDefine(t.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this.depthTest=513,this._addShaderDefine(t.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(e)}),v(0,e,"normalTexture",function(){return this._getTexture(2)},function(e){e?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,e)}),v(0,e,"reflectColor",function(){return this._getColor(10)},function(e){this._setColor(10,e)}),v(0,e,"tilingOffset",function(){return this._getColor(11)},function(e){if(e){var t=e.elements;1!=t[0]||1!=t[1]||0!=t[2]||0!=t[3]?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(11,e)}),v(0,e,"specularColor",function(){return this._getColor(8)},function(e){this._setColor(8,e)}),v(0,e,"albedoColor",function(){return this._albedoColor},function(e){var t=this._getColor(6);ri.scale(e,this._albedoIntensity,t),this._albedoColor=e}),v(0,e,"albedoIntensity",function(){return this._albedoIntensity},function(e){if(this._albedoIntensity!==e){var t=this._getColor(6);ri.scale(this._albedoColor,e,t),this._albedoIntensity=e}}),v(0,e,"albedoTexture",function(){return this._getTexture(1)},function(e){e?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,e)}),v(0,e,"shininess",function(){return this._getNumber(9)},function(e){e=Math.max(0,Math.min(1,e)),this._setNumber(9,e)}),v(0,e,"specularTexture",function(){return this._getTexture(3)},function(e){e?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,e)}),v(0,e,"reflectTexture",function(){return this._getTexture(5)},function(e){e?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(5,e)}),v(0,e,"enableLighting",function(){return this._enableLighting},function(e){this._enableLighting!==e&&(e?this._removeDisablePublicShaderDefine(Yi.SHADERDEFINE_POINTLIGHT|Yi.SHADERDEFINE_SPOTLIGHT|Yi.SHADERDEFINE_DIRECTIONLIGHT):this._addDisablePublicShaderDefine(Yi.SHADERDEFINE_POINTLIGHT|Yi.SHADERDEFINE_SPOTLIGHT|Yi.SHADERDEFINE_DIRECTIONLIGHT),this._enableLighting=e)}),t.__init__=function(){t.SHADERDEFINE_DIFFUSEMAP=t.shaderDefines.registerDefine("DIFFUSEMAP"),t.SHADERDEFINE_NORMALMAP=t.shaderDefines.registerDefine("NORMALMAP"),t.SHADERDEFINE_SPECULARMAP=t.shaderDefines.registerDefine("SPECULARMAP"),t.SHADERDEFINE_REFLECTMAP=t.shaderDefines.registerDefine("REFLECTMAP"),t.SHADERDEFINE_TILINGOFFSET=t.shaderDefines.registerDefine("TILINGOFFSET"),t.SHADERDEFINE_ADDTIVEFOG=t.shaderDefines.registerDefine("ADDTIVEFOG")},t.load=function(e){return x.loader.create(e,null,null,t)},t.SPECULARSOURCE_DIFFUSEMAPALPHA=0,t.SPECULARSOURCE_SPECULARMAP=0,t.RENDERMODE_OPAQUE=0,t.RENDERMODE_CUTOUT=1,t.RENDERMODE_TRANSPARENT=2,t.RENDERMODE_ADDTIVE=3,t.SHADERDEFINE_DIFFUSEMAP=0,t.SHADERDEFINE_NORMALMAP=0,t.SHADERDEFINE_SPECULARMAP=0,t.SHADERDEFINE_REFLECTMAP=0,t.SHADERDEFINE_TILINGOFFSET=0,t.SHADERDEFINE_ADDTIVEFOG=0,t.ALBEDOTEXTURE=1,t.NORMALTEXTURE=2,t.SPECULARTEXTURE=3,t.EMISSIVETEXTURE=4,t.REFLECTTEXTURE=5,t.ALBEDOCOLOR=6,t.MATERIALSPECULAR=8,t.SHININESS=9,t.MATERIALREFLECT=10,t.TILINGOFFSET=11,u(t,["defaultMaterial",function(){return this.defaultMaterial=new t},"shaderDefines",function(){return this.shaderDefines=new hi(Ji.shaderDefines)}]),t}(Ji),Mn=function(){function e(){e.__super.call(this),this.setShaderName("ExtendTerrain"),this.renderMode=1}f(e,"laya.d3.core.material.ExtendTerrainMaterial",Ji);var t=e.prototype;return t._setDetailNum=function(e){switch(e){case 1:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 2:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 3:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 4:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 5:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4)}},t.disableLight=function(){this._addDisablePublicShaderDefine(Yi.SHADERDEFINE_POINTLIGHT|Yi.SHADERDEFINE_SPOTLIGHT|Yi.SHADERDEFINE_DIRECTIONLIGHT)},v(0,t,"diffuseScaleOffset2",null,function(e){this._setColor(7,e)}),v(0,t,"splatAlphaTexture",function(){return this._getTexture(0)},function(e){this._setTexture(0,e)}),v(0,t,"diffuseScaleOffset3",null,function(e){this._setColor(8,e)}),v(0,t,"diffuseTexture1",null,function(e){this._setTexture(1,e),this._setDetailNum(1)}),v(0,t,"renderMode",null,function(e){switch(e){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 2:this.renderQueue=2e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.depthTest=515;break;default:throw new Error("ExtendTerrainMaterial:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(e)}),v(0,t,"diffuseTexture2",function(){return this._getTexture(2)},function(e){this._setTexture(2,e),this._setDetailNum(2)}),v(0,t,"diffuseScaleOffset1",null,function(e){this._setColor(6,e)}),v(0,t,"diffuseTexture3",function(){return this._getTexture(3)},function(e){this._setTexture(3,e),this._setDetailNum(3)}),v(0,t,"diffuseTexture4",function(){return this._getTexture(4)},function(e){this._setTexture(4,e),this._setDetailNum(4)}),v(0,t,"diffuseTexture5",function(){return this._getTexture(5)},function(e){this._setTexture(5,e),this._setDetailNum(5)}),v(0,t,"diffuseScaleOffset4",null,function(e){this._setColor(9,e)}),v(0,t,"diffuseScaleOffset5",null,function(e){this._setColor(10,e)}),v(0,t,"albedo",function(){return this._getColor(14)},function(e){this._setColor(14,e)}),v(0,t,"ambientColor",function(){return this._getColor(11)},function(e){this._setColor(11,e)}),v(0,t,"diffuseColor",function(){return this._getColor(12)},function(e){this._setColor(12,e)}),v(0,t,"specularColor",function(){return this._getColor(13)},function(e){this._setColor(13,e)}),e.__init__=function(){e.SHADERDEFINE_DETAIL_NUM1=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM1"),e.SHADERDEFINE_DETAIL_NUM2=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM2"),e.SHADERDEFINE_DETAIL_NUM3=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM3"),e.SHADERDEFINE_DETAIL_NUM4=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM4"),e.SHADERDEFINE_DETAIL_NUM5=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM5")},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_TRANSPARENT=2,e.SPLATALPHATEXTURE=0,e.DIFFUSETEXTURE1=1,e.DIFFUSETEXTURE2=2,e.DIFFUSETEXTURE3=3,e.DIFFUSETEXTURE4=4,e.DIFFUSETEXTURE5=5,e.DIFFUSESCALEOFFSET1=6,e.DIFFUSESCALEOFFSET2=7,e.DIFFUSESCALEOFFSET3=8,e.DIFFUSESCALEOFFSET4=9,e.DIFFUSESCALEOFFSET5=10,e.MATERIALAMBIENT=11,e.MATERIALDIFFUSE=12,e.MATERIALSPECULAR=13,e.MATERIALALBEDO=14,e.SHADERDEFINE_DETAIL_NUM1=0,e.SHADERDEFINE_DETAIL_NUM2=0,e.SHADERDEFINE_DETAIL_NUM3=0,e.SHADERDEFINE_DETAIL_NUM4=0,e.SHADERDEFINE_DETAIL_NUM5=0,u(e,["shaderDefines",function(){return this.shaderDefines=new hi(Ji.shaderDefines)}]),e}(),bn=function(t){function i(){i.__super.call(this),this.setShaderName("GLITTER"),this.renderMode=1,this._setColor(3,new ri(1,1,1,1)),this._setColor(2,new ri(1,1,1,1))}f(i,"laya.d3.core.material.GlitterMaterial",t);var e=i.prototype;return e.setShaderName=function(e){t.prototype.setShaderName.call(this,e)},v(0,e,"renderMode",null,function(e){switch(e){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0;break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0;break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(e)}),v(0,e,"diffuseTexture",function(){return this._getTexture(1)},function(e){this._setTexture(1,e)}),v(0,e,"albedo",function(){return this._getColor(2)},function(e){this._setColor(2,e)}),v(0,e,"color",function(){return this._getColor(3)},function(e){this._setColor(3,e)}),i.load=function(e){return x.loader.create(e,null,null,i)},i.RENDERMODE_OPAQUE=1,i.RENDERMODE_OPAQUEDOUBLEFACE=2,i.RENDERMODE_TRANSPARENT=13,i.RENDERMODE_TRANSPARENTDOUBLEFACE=14,i.RENDERMODE_ADDTIVE=15,i.RENDERMODE_ADDTIVEDOUBLEFACE=16,i.RENDERMODE_DEPTHREAD_TRANSPARENT=5,i.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,i.RENDERMODE_DEPTHREAD_ADDTIVE=7,i.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,i.RENDERMODE_NONDEPTH_TRANSPARENT=9,i.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,i.RENDERMODE_NONDEPTH_ADDTIVE=11,i.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,i.DIFFUSETEXTURE=1,i.ALBEDO=2,i.UNICOLOR=3,u(i,["defaultMaterial",function(){return this.defaultMaterial=new i}]),i}(Ji),Rn=function(n){function i(){if(this._transformUV=null,i.__super.call(this),!laya.d3.core.material.PBRMaterial.pbrlutTex){var e=R.window.__pbrlutdata;if(!e)throw alert("no pbr lutdata, need pbrlut.js"),"no pbr lutdata, need pbrlut.js";var t=Gn.create(new Uint32Array(e).buffer,256,256,9728,9728,!1);laya.d3.core.material.PBRMaterial.pbrlutTex=t}this._setTexture(4,laya.d3.core.material.PBRMaterial.pbrlutTex),this.setShaderName("PBR"),this._setNumber(0,.5),this.use_groundtruth=!1}f(i,"laya.d3.core.material.PBRMaterial",n);var e=i.prototype;return e.disableLight=function(){this._addDisablePublicShaderDefine(Yi.SHADERDEFINE_POINTLIGHT|Yi.SHADERDEFINE_SPOTLIGHT|Yi.SHADERDEFINE_DIRECTIONLIGHT)},e.disableFog=function(){this._addDisablePublicShaderDefine(Yi.SHADERDEFINE_FOG)},e.onAsynLoaded=function(e,t,i){n.prototype.onAsynLoaded.call(this,e,t,i)},e.radicalInverse_VdC=function(e){var t,i=new Uint32Array(1);return t=(16711935&(t=(252645135&(t=(858993459&(t=(1431655765&(t=(t=e)<<16|t>>>16))<<1|(2863311530&t)>>>1))<<2|(3435973836&t)>>>2))<<4|(4042322160&t)>>>4))<<8|(4278255360&t)>>>8,i[0]=t,2.3283064365386963e-10*i[0]},e.createHammersleyTex=function(e,t){var i=new Uint8Array(e*t*4),n=0,a=0;for(a=0;a<e*t;a++){var r=this.radicalInverse_VdC(a);i[n++]=255*r,i[n++]=0,i[n++]=0,i[n++]=255}return i},v(0,e,"normalTexture",function(){return this._getTexture(2)},function(e){this._setTexture(2,e)}),v(0,e,"has_tangent",null,function(e){this._addShaderDefine(i.SHADERDEFINE_HAS_TANGENT)}),v(0,e,"roughness",function(){return this._getNumber(6)},function(e){this._setNumber(6,e),this._addShaderDefine(i.SHADERDEFINE_FIX_ROUGHNESS)}),v(0,e,"metaless",function(){return this._getNumber(7)},function(e){this._setNumber(7,e),this._addShaderDefine(i.SHADERDEFINE_FIX_METALESS)}),v(0,e,"pbrlutTexture",function(){return this._getTexture(4)},function(e){this._setTexture(4,e)}),v(0,e,"use_groundtruth",null,function(e){if(e){if(this._addShaderDefine(i.SHADERDEFINE_USE_GROUNDTRUTH),!laya.d3.core.material.PBRMaterial.HammersleyNoiseTex){var t=this.createHammersleyTex(32,32);laya.d3.core.material.PBRMaterial.HammersleyNoiseTex=Gn.create(t.buffer,32,32,9728,9728,!1)}this._setTexture(15,i.HammersleyNoiseTex)}else laya.d3.core.material.PBRMaterial.HammersleyNoiseTex=null,this._removeShaderDefine(i.SHADERDEFINE_USE_GROUNDTRUTH)}),v(0,e,"transformUV",function(){return this._transformUV},function(e){this._transformUV=e,this._setMatrix4x4(8,e.matrix),this._conchMaterial&&this._conchMaterial.setShaderValue(8,e.matrix.elements,0)}),v(0,e,"diffuseTexture",function(){return this._getTexture(1)},function(e){this._setTexture(1,e)}),v(0,e,"renderMode",null,function(e){switch(e){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1;break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1;break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3;break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;default:throw new Error("PBRMaterial:renderMode value error.")}}),v(0,e,"pbrInfoTexture",function(){return this._getTexture(3)},function(e){this._setTexture(3,e),this._addShaderDefine(i.SHADERDEFINE_HAS_PBRINFO)}),v(0,e,"testClipZ",null,function(e){this._addShaderDefine(i.SHADERDEFINE_TEST_CLIPZ)}),i.__init__=function(){i.SHADERDEFINE_FIX_METALESS=i.shaderDefines.registerDefine("FIX_METALESS"),i.SHADERDEFINE_FIX_ROUGHNESS=i.shaderDefines.registerDefine("FIX_ROUGHNESS"),i.SHADERDEFINE_HAS_TANGENT=i.shaderDefines.registerDefine("HAS_TANGENT"),i.SHADERDEFINE_HAS_PBRINFO=i.shaderDefines.registerDefine("HAS_PBRINFO"),i.SHADERDEFINE_USE_GROUNDTRUTH=i.shaderDefines.registerDefine("USE_GROUNDTRUTH"),i.SHADERDEFINE_TEST_CLIPZ=i.shaderDefines.registerDefine("CLIPZ")},i.load=function(e){return x.loader.create(e,null,null,i)},i.DIFFUSETEXTURE=1,i.NORMALTEXTURE=2,i.PBRINFOTEXTURE=3,i.PBRLUTTEXTURE=4,i.UVANIAGE=5,i.MATERIALROUGHNESS=6,i.MATERIALMETALESS=7,i.UVMATRIX=8,i.UVAGE=9,i.AOOBJPOS=14,i.HSNOISETEXTURE=15,i.SHADERDEFINE_FIX_ROUGHNESS=0,i.SHADERDEFINE_FIX_METALESS=0,i.SHADERDEFINE_HAS_TANGENT=0,i.SHADERDEFINE_TEST_CLIPZ=0,i.SHADERDEFINE_HAS_PBRINFO=0,i.SHADERDEFINE_USE_GROUNDTRUTH=0,i.RENDERMODE_OPAQUE=1,i.RENDERMODE_OPAQUEDOUBLEFACE=2,i.RENDERMODE_CUTOUT=3,i.RENDERMODE_CUTOUTDOUBLEFACE=4,i.RENDERMODE_TRANSPARENT=13,i.pbrlutTex=null,i.HammersleyNoiseTex=null,u(i,["defaultMaterial",function(){return this.defaultMaterial=new i},"shaderDefines",function(){return this.shaderDefines=new hi(Ji.shaderDefines)}]),i}(Ji),Ln=function(){function e(){e.__super.call(this),this.setShaderName("PBRSpecular"),this._setColor(7,new ri(1,1,1,1)),this._setColor(9,new ri(0,0,0,0)),this._setColor(8,new ri(.2,.2,.2,.2)),this._setNumber(10,.5),this._setNumber(11,1),this._setNumber(12,0),this._setNumber(13,1),this._setNumber(14,1),this._setNumber(15,.001),this._setBool(16,!1),this._setNumber(0,.5)}f(e,"laya.d3.core.material.PBRSpecularMaterial",Ji);var t=e.prototype;return v(0,t,"albedoColor",function(){return this._getColor(7)},function(e){this._setColor(7,e)}),v(0,t,"specularTexture",function(){return this._getTexture(2)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SPECULARTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SPECULARTEXTURE),this._setTexture(2,e)}),v(0,t,"albedoTexture",function(){return this._getTexture(1)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._setTexture(1,e)}),v(0,t,"occlusionTexture",function(){return this._getTexture(5)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_OCCLUSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_OCCLUSIONTEXTURE),this._setTexture(5,e)}),v(0,t,"normalTexture",function(){return this._getTexture(3)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_NORMALTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_NORMALTEXTURE),this._setTexture(3,e)}),v(0,t,"parallaxTexture",function(){return this._getTexture(4)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_PARALLAXTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_PARALLAXTEXTURE),this._setTexture(4,e)}),v(0,t,"emissionColor",function(){return this._getColor(9)},function(e){this._setColor(9,e)}),v(0,t,"normalTextureScale",function(){return this._getNumber(14)},function(e){this._setNumber(14,e)}),v(0,t,"parallaxTextureScale",function(){return this._getNumber(15)},function(e){e=Math.max(.005,Math.min(.08,e)),this._setNumber(15,e)}),v(0,t,"occlusionTextureStrength",function(){return this._getNumber(13)},function(e){e=Math.max(0,Math.min(1,e)),this._setNumber(13,e)}),v(0,t,"specularColor",function(){return this._getColor(8)},function(e){this._setColor(8,e)}),v(0,t,"smoothness",function(){return this._getNumber(10)},function(e){e=Math.max(0,Math.min(1,e)),this._setNumber(10,e)}),v(0,t,"smoothnessTextureScale",function(){return this._getNumber(11)},function(e){e=Math.max(0,Math.min(1,e)),this._setNumber(11,e)}),v(0,t,"smoothnessSource",function(){return this._getNumber(12)},function(e){1==e?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA):(this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA),e=0),this._setNumber(12,e)}),v(0,t,"enableEmission",function(){return this._getBool(16)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSION):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSION),this._setBool(16,e)}),v(0,t,"emissionTexture",function(){return this._getTexture(6)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSIONTEXTURE),this._setTexture(6,e)}),v(0,t,"tilingOffset",function(){return this._getColor(17)},function(e){if(e){var t=e.elements;1!=t[0]||1!=t[1]||0!=t[2]||0!=t[3]?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(17,e)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_SPECULARTEXTURE=e.shaderDefines.registerDefine("SPECULARTEXTURE"),e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=e.shaderDefines.registerDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),e.SHADERDEFINE_NORMALTEXTURE=e.shaderDefines.registerDefine("NORMALTEXTURE"),e.SHADERDEFINE_PARALLAXTEXTURE=e.shaderDefines.registerDefine("PARALLAXTEXTURE"),e.SHADERDEFINE_OCCLUSIONTEXTURE=e.shaderDefines.registerDefine("OCCLUSIONTEXTURE"),e.SHADERDEFINE_EMISSION=e.shaderDefines.registerDefine("EMISSION"),e.SHADERDEFINE_EMISSIONTEXTURE=e.shaderDefines.registerDefine("EMISSIONTEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.SmoothnessSource_MetallicGlossTexture_Alpha=0,e.SmoothnessSource_DiffuseTexture_Alpha=1,e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_NORMALTEXTURE=0,e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=0,e.SHADERDEFINE_SPECULARTEXTURE=0,e.SHADERDEFINE_OCCLUSIONTEXTURE=0,e.SHADERDEFINE_PARALLAXTEXTURE=0,e.SHADERDEFINE_EMISSION=0,e.SHADERDEFINE_EMISSIONTEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.SPECULARTEXTURE=2,e.NORMALTEXTURE=3,e.PARALLAXTEXTURE=4,e.OCCLUSIONTEXTURE=5,e.EMISSIONTEXTURE=6,e.DIFFUSECOLOR=7,e.SPECULARCOLOR=8,e.EMISSIONCOLOR=9,e.SMOOTHNESS=10,e.SMOOTHNESSSCALE=11,e.SMOOTHNESSSOURCE=12,e.OCCLUSIONSTRENGTH=13,e.NORMALSCALE=14,e.PARALLAXSCALE=15,e.ENABLEEMISSION=16,e.TILINGOFFSET=17,u(e,["shaderDefines",function(){return this.shaderDefines=new hi(Ji.shaderDefines)}]),e}(),An=function(){function e(){e.__super.call(this),this.setShaderName("PBRStandard"),this._setColor(7,new ri(1,1,1,1)),this._setColor(8,new ri(0,0,0,0)),this._setNumber(9,0),this._setNumber(10,.5),this._setNumber(11,1),this._setNumber(12,0),this._setNumber(13,1),this._setNumber(14,1),this._setNumber(15,.001),this._setBool(16,!1),this._setNumber(0,.5)}f(e,"laya.d3.core.material.PBRStandardMaterial",Ji);var t=e.prototype;return v(0,t,"albedoColor",function(){return this._getColor(7)},function(e){this._setColor(7,e)}),v(0,t,"albedoTexture",function(){return this._getTexture(1)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._setTexture(1,e)}),v(0,t,"enableEmission",function(){return this._getBool(16)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSION):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSION),this._setBool(16,e)}),v(0,t,"metallicGlossTexture",function(){return this._getTexture(2)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE),this._setTexture(2,e)}),v(0,t,"occlusionTexture",function(){return this._getTexture(5)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_OCCLUSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_OCCLUSIONTEXTURE),this._setTexture(5,e)}),v(0,t,"normalTexture",function(){return this._getTexture(3)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_NORMALTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_NORMALTEXTURE),this._setTexture(3,e)}),v(0,t,"parallaxTexture",function(){return this._getTexture(4)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_PARALLAXTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_PARALLAXTEXTURE),this._setTexture(4,e)}),v(0,t,"emissionColor",function(){return this._getColor(8)},function(e){this._setColor(8,e)}),v(0,t,"normalTextureScale",function(){return this._getNumber(14)},function(e){this._setNumber(14,e)}),v(0,t,"parallaxTextureScale",function(){return this._getNumber(15)},function(e){e=Math.max(.005,Math.min(.08,e)),this._setNumber(15,e)}),v(0,t,"occlusionTextureStrength",function(){return this._getNumber(13)},function(e){e=Math.max(0,Math.min(1,e)),this._setNumber(13,e)}),v(0,t,"metallic",function(){return this._getNumber(9)},function(e){e=Math.max(0,Math.min(1,e)),this._setNumber(9,e)}),v(0,t,"smoothness",function(){return this._getNumber(10)},function(e){e=Math.max(0,Math.min(1,e)),this._setNumber(10,e)}),v(0,t,"smoothnessTextureScale",function(){return this._getNumber(11)},function(e){e=Math.max(0,Math.min(1,e)),this._setNumber(11,e)}),v(0,t,"smoothnessSource",function(){return this._getNumber(12)},function(e){1==e?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA):(this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA),e=0),this._setNumber(12,e)}),v(0,t,"emissionTexture",function(){return this._getTexture(6)},function(e){e?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSIONTEXTURE),this._setTexture(6,e)}),v(0,t,"tilingOffset",function(){return this._getColor(17)},function(e){if(e){var t=e.elements;1!=t[0]||1!=t[1]||0!=t[2]||0!=t[3]?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(17,e)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_METALLICGLOSSTEXTURE=e.shaderDefines.registerDefine("METALLICGLOSSTEXTURE"),e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=e.shaderDefines.registerDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),e.SHADERDEFINE_NORMALTEXTURE=e.shaderDefines.registerDefine("NORMALTEXTURE"),e.SHADERDEFINE_PARALLAXTEXTURE=e.shaderDefines.registerDefine("PARALLAXTEXTURE"),e.SHADERDEFINE_OCCLUSIONTEXTURE=e.shaderDefines.registerDefine("OCCLUSIONTEXTURE"),e.SHADERDEFINE_EMISSION=e.shaderDefines.registerDefine("EMISSION"),e.SHADERDEFINE_EMISSIONTEXTURE=e.shaderDefines.registerDefine("EMISSIONTEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.SmoothnessSource_MetallicGlossTexture_Alpha=0,e.SmoothnessSource_DiffuseTexture_Alpha=1,e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_NORMALTEXTURE=0,e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=0,e.SHADERDEFINE_METALLICGLOSSTEXTURE=0,e.SHADERDEFINE_OCCLUSIONTEXTURE=0,e.SHADERDEFINE_PARALLAXTEXTURE=0,e.SHADERDEFINE_EMISSION=0,e.SHADERDEFINE_EMISSIONTEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.METALLICGLOSSTEXTURE=2,e.NORMALTEXTURE=3,e.PARALLAXTEXTURE=4,e.OCCLUSIONTEXTURE=5,e.EMISSIONTEXTURE=6,e.DIFFUSECOLOR=7,e.EMISSIONCOLOR=8,e.METALLIC=9,e.SMOOTHNESS=10,e.SMOOTHNESSSCALE=11,e.SMOOTHNESSSOURCE=12,e.OCCLUSIONSTRENGTH=13,e.NORMALSCALE=14,e.PARALLAXSCALE=15,e.ENABLEEMISSION=16,e.TILINGOFFSET=17,u(e,["shaderDefines",function(){return this.shaderDefines=new hi(Ji.shaderDefines)}]),e}(),In=function(o){function l(){this._transformUV=null,l.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new ai(.6,.6,.6)),this._setColor(10,new ai(1,1,1)),this._setColor(11,new ri(1,1,1,8)),this._setColor(12,new ai(1,1,1)),this._setColor(7,new ri(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new ri(1,1,0,0)),this.renderMode=1}f(l,"laya.d3.core.material.StandardMaterial",o);var e=l.prototype;return e.disableLight=function(){this._addDisablePublicShaderDefine(Yi.SHADERDEFINE_POINTLIGHT|Yi.SHADERDEFINE_SPOTLIGHT|Yi.SHADERDEFINE_DIRECTIONLIGHT)},e.disableFog=function(){this._addDisablePublicShaderDefine(Yi.SHADERDEFINE_FOG)},e.onAsynLoaded=function(e,t,i){var n=t[0];if(n.version)o.prototype.onAsynLoaded.call(this,e,t,i);else{var a=t[1],r=n.props;for(var s in r)this[s]=r[s];l._parseStandardMaterial(a,this,n),this._endLoaded()}},e.cloneTo=function(e){o.prototype.cloneTo.call(this,e);var t=e;this._transformUV&&(t._transformUV=this._transformUV.clone())},v(0,e,"ambientColor",function(){return this._getColor(9)},function(e){this._setColor(9,e)}),v(0,e,"ambientTexture",function(){return this._getTexture(5)},function(e){e?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,e)}),v(0,e,"renderMode",null,function(e){switch(e){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(e)}),v(0,e,"reflectColor",function(){return this._getColor(12)},function(e){this._setColor(12,e)}),v(0,e,"tilingOffset",function(){return this._getColor(15)},function(e){if(e){var t=e.elements;1!=t[0]||1!=t[1]||0!=t[2]||0!=t[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,e)}),v(0,e,"albedo",function(){return this._getColor(7)},function(e){this._setColor(7,e)}),v(0,e,"diffuseColor",function(){return this._getColor(10)},function(e){this._setColor(10,e)}),v(0,e,"albedoColor",function(){return this._getColor(7)},function(e){this._setColor(7,e)}),v(0,e,"specularColor",function(){return this._getColor(11)},function(e){this._setColor(11,e)}),v(0,e,"diffuseTexture",function(){return this._getTexture(1)},function(e){e?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,e)}),v(0,e,"normalTexture",function(){return this._getTexture(2)},function(e){e?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,e)}),v(0,e,"specularTexture",function(){return this._getTexture(3)},function(e){e?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,e)}),v(0,e,"emissiveTexture",function(){return this._getTexture(4)},function(e){e?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,e)}),v(0,e,"reflectTexture",function(){return this._getTexture(6)},function(e){e?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,e)}),v(0,e,"transformUV",function(){return this._transformUV},function(e){this._transformUV=e,this._setMatrix4x4(13,e.matrix),e?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,e.matrix.elements,0)}),l.__init__=function(){l.SHADERDEFINE_DIFFUSEMAP=l.shaderDefines.registerDefine("DIFFUSEMAP"),l.SHADERDEFINE_NORMALMAP=l.shaderDefines.registerDefine("NORMALMAP"),l.SHADERDEFINE_SPECULARMAP=l.shaderDefines.registerDefine("SPECULARMAP"),l.SHADERDEFINE_EMISSIVEMAP=l.shaderDefines.registerDefine("EMISSIVEMAP"),l.SHADERDEFINE_AMBIENTMAP=l.shaderDefines.registerDefine("AMBIENTMAP"),l.SHADERDEFINE_REFLECTMAP=l.shaderDefines.registerDefine("REFLECTMAP"),l.SHADERDEFINE_UVTRANSFORM=l.shaderDefines.registerDefine("UVTRANSFORM"),l.SHADERDEFINE_TILINGOFFSET=l.shaderDefines.registerDefine("TILINGOFFSET"),l.SHADERDEFINE_ADDTIVEFOG=l.shaderDefines.registerDefine("ADDTIVEFOG")},l.load=function(e){return x.loader.create(e,null,null,l)},l._parseStandardMaterial=function(e,t,i){var n=i.customProps,a=n.ambientColor;t.ambientColor=new ai(a[0],a[1],a[2]);var r=n.diffuseColor;t.diffuseColor=new ai(r[0],r[1],r[2]);var s=n.specularColor;t.specularColor=new ri(s[0],s[1],s[2],s[3]);var o=n.reflectColor;t.reflectColor=new ai(o[0],o[1],o[2]);var l=n.albedoColor;l&&(t.albedo=new ri(l[0],l[1],l[2],l[3]));var h=n.diffuseTexture.texture2D;h&&(t.diffuseTexture=Me.getRes(e[h]));var c=n.normalTexture.texture2D;c&&(t.normalTexture=Me.getRes(e[c]));var u=n.specularTexture.texture2D;u&&(t.specularTexture=Me.getRes(e[u]));var d=n.emissiveTexture.texture2D;d&&(t.emissiveTexture=Me.getRes(e[d]));var _=n.ambientTexture.texture2D;_&&(t.ambientTexture=Me.getRes(e[_]));var p=n.reflectTexture.texture2D;p&&(t.reflectTexture=Me.getRes(e[p]))},l.RENDERMODE_OPAQUE=1,l.RENDERMODE_OPAQUEDOUBLEFACE=2,l.RENDERMODE_CUTOUT=3,l.RENDERMODE_CUTOUTDOUBLEFACE=4,l.RENDERMODE_TRANSPARENT=13,l.RENDERMODE_TRANSPARENTDOUBLEFACE=14,l.RENDERMODE_ADDTIVE=15,l.RENDERMODE_ADDTIVEDOUBLEFACE=16,l.RENDERMODE_DEPTHREAD_TRANSPARENT=5,l.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,l.RENDERMODE_DEPTHREAD_ADDTIVE=7,l.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,l.RENDERMODE_NONDEPTH_TRANSPARENT=9,l.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,l.RENDERMODE_NONDEPTH_ADDTIVE=11,l.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,l.SHADERDEFINE_DIFFUSEMAP=0,l.SHADERDEFINE_NORMALMAP=0,l.SHADERDEFINE_SPECULARMAP=0,l.SHADERDEFINE_EMISSIVEMAP=0,l.SHADERDEFINE_AMBIENTMAP=0,l.SHADERDEFINE_REFLECTMAP=0,l.SHADERDEFINE_UVTRANSFORM=0,l.SHADERDEFINE_TILINGOFFSET=0,l.SHADERDEFINE_ADDTIVEFOG=0,l.DIFFUSETEXTURE=1,l.NORMALTEXTURE=2,l.SPECULARTEXTURE=3,l.EMISSIVETEXTURE=4,l.AMBIENTTEXTURE=5,l.REFLECTTEXTURE=6,l.ALBEDO=7,l.UVANIAGE=8,l.MATERIALAMBIENT=9,l.MATERIALDIFFUSE=10,l.MATERIALSPECULAR=11,l.MATERIALREFLECT=12,l.UVMATRIX=13,l.UVAGE=14,l.TILINGOFFSET=15,u(l,["defaultMaterial",function(){return this.defaultMaterial=new l},"shaderDefines",function(){return this.shaderDefines=new hi(Ji.shaderDefines)}]),l}(Ji),Dn=function(t){function i(){this._diffuseScale1=null,this._diffuseScale2=null,this._diffuseScale3=null,this._diffuseScale4=null,i.__super.call(this),this.setShaderName("Terrain"),this.renderMode=1,this._diffuseScale1=new ni,this._diffuseScale2=new ni,this._diffuseScale3=new ni,this._diffuseScale4=new ni,this.ambientColor=new ai(.6,.6,.6),this.diffuseColor=new ai(1,1,1),this.specularColor=new ri(.2,.2,.2,32)}f(i,"laya.d3.core.material.TerrainMaterial",t);var e=i.prototype;return e.setDiffuseScale1=function(e,t){this._diffuseScale1.x=e,this._diffuseScale1.y=t,this._setColor(6,this._diffuseScale1)},e.setDiffuseScale2=function(e,t){this._diffuseScale2.x=e,this._diffuseScale2.y=t,this._setColor(7,this._diffuseScale2)},e.setDiffuseScale3=function(e,t){this._diffuseScale3.x=e,this._diffuseScale3.y=t,this._setColor(8,this._diffuseScale3)},e.setDiffuseScale4=function(e,t){this._diffuseScale4.x=e,this._diffuseScale4.y=t,this._setColor(9,this._diffuseScale4)},e.setDetailNum=function(e){switch(e){case 1:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 2:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 3:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 4:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3)}},e.disableLight=function(){this._addDisablePublicShaderDefine(Yi.SHADERDEFINE_POINTLIGHT|Yi.SHADERDEFINE_SPOTLIGHT|Yi.SHADERDEFINE_DIRECTIONLIGHT)},e.setShaderName=function(e){t.prototype.setShaderName.call(this,e)},v(0,e,"renderMode",null,function(e){switch(e){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 2:this.renderQueue=2e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.depthTest=515;break;default:throw new Error("TerrainMaterial:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(e)}),v(0,e,"diffuseTexture2",function(){return this._getTexture(3)},function(e){this._setTexture(3,e)}),v(0,e,"ambientColor",function(){return this._getColor(10)},function(e){this._setColor(10,e)}),v(0,e,"diffuseTexture4",function(){return this._getTexture(5)},function(e){this._setTexture(5,e)}),v(0,e,"diffuseColor",function(){return this._getColor(11)},function(e){this._setColor(11,e)}),v(0,e,"diffuseTexture1",function(){return this._getTexture(2)},function(e){this._setTexture(2,e)}),v(0,e,"specularColor",function(){return this._getColor(12)},function(e){this._setColor(12,e)}),v(0,e,"diffuseTexture3",function(){return this._getTexture(4)},function(e){this._setTexture(4,e)}),v(0,e,"splatAlphaTexture",function(){return this._getTexture(0)},function(e){this._setTexture(0,e)}),v(0,e,"normalTexture",function(){return this._getTexture(1)},function(e){this._setTexture(1,e)}),i.__init__=function(){i.SHADERDEFINE_DETAIL_NUM1=i.shaderDefines.registerDefine("DETAIL_NUM1"),i.SHADERDEFINE_DETAIL_NUM2=i.shaderDefines.registerDefine("DETAIL_NUM2"),i.SHADERDEFINE_DETAIL_NUM4=i.shaderDefines.registerDefine("DETAIL_NUM4"),i.SHADERDEFINE_DETAIL_NUM3=i.shaderDefines.registerDefine("DETAIL_NUM3")},i.load=function(e){return x.loader.create(e,null,null,i)},i.RENDERMODE_OPAQUE=1,i.RENDERMODE_TRANSPARENT=2,i.SPLATALPHATEXTURE=0,i.NORMALTEXTURE=1,i.DIFFUSETEXTURE1=2,i.DIFFUSETEXTURE2=3,i.DIFFUSETEXTURE3=4,i.DIFFUSETEXTURE4=5,i.DIFFUSESCALE1=6,i.DIFFUSESCALE2=7,i.DIFFUSESCALE3=8,i.DIFFUSESCALE4=9,i.MATERIALAMBIENT=10,i.MATERIALDIFFUSE=11,i.MATERIALSPECULAR=12,i.SHADERDEFINE_DETAIL_NUM1=0,i.SHADERDEFINE_DETAIL_NUM2=0,i.SHADERDEFINE_DETAIL_NUM3=0,i.SHADERDEFINE_DETAIL_NUM4=0,u(i,["defaultMaterial",function(){return this.defaultMaterial=new i},"shaderDefines",function(){return this.shaderDefines=new hi(Ji.shaderDefines)}]),i}(Ji),Pn=function(n){function t(){this._useVertexDeep=!1,t.__super.call(this),this.setShaderName("Water")}f(t,"laya.d3.core.material.WaterMaterial",n);var e=t.prototype;return e.disableFog=function(){this._addDisablePublicShaderDefine(Yi.SHADERDEFINE_FOG)},e.onAsynLoaded=function(e,t,i){n.prototype.onAsynLoaded.call(this,e,t,i)},v(0,e,"diffuseTexture",function(){return this._getTexture(1)},function(e){this._setTexture(1,e)}),v(0,e,"normalTexture",function(){return this._getTexture(2)},function(e){this._setTexture(2,e)}),v(0,e,"underWaterTexture",function(){return this._getTexture(3)},function(e){this._setTexture(3,e)}),v(0,e,"deepColorTexture",function(){return this._getTexture(10)},function(e){this._setTexture(10,e)}),v(0,e,"useFoam",null,function(e){e?this._addShaderDefine(t.SHADERDEFINE_USE_FOAM):this._removeShaderDefine(t.SHADERDEFINE_USE_FOAM)}),v(0,e,"skyTexture",function(){return this._getTexture(11)},function(e){this._setTexture(11,e)}),v(0,e,"deepScale",function(){return this._getNumber(20)},function(e){this._setNumber(20,e)}),v(0,e,"detailTexture",function(){return this._getTexture(9)},function(e){this._setTexture(9,e)}),v(0,e,"foamTexture",function(){return this._getTexture(17)},function(e){this._setTexture(17,e)}),v(0,e,"waterInfoTexture",function(){return this._getTexture(16)},function(e){this._setTexture(16,e)}),v(0,e,"vertexDispTexture",function(){return this._getTexture(4)},function(e){this._setTexture(4,e)}),v(0,e,"currentTm",function(){return this._getNumber(8)},function(e){this._setNumber(8,e)}),v(0,e,"waveInfo",function(){return this._getBuffer(12)},function(e){this._setBuffer(12,e)}),v(0,e,"waveInfoD",function(){return this._getBuffer(13)},function(e){this._setBuffer(13,e)}),v(0,e,"waveMainDir",function(){return this._getNumber(14)},function(e){this._setNumber(14,e*Math.PI/180)}),v(0,e,"geoWaveUVScale",function(){return this._getNumber(18)},function(e){this._setNumber(18,e)}),v(0,e,"windSpeed",function(){return 0},function(e){}),v(0,e,"scrsize",null,function(e){this._setBuffer(15,e)}),v(0,e,"seaColor",function(){return this._getBuffer(19)},function(e){this._setBuffer(19,e)}),v(0,e,"useVertexDeep",function(){return this._useVertexDeep},function(e){(this._useVertexDeep=e)?this._addShaderDefine(t.SHADERDEFINE_USEVERTEXHEIGHT):this._removeShaderDefine(t.SHADERDEFINE_USEVERTEXHEIGHT)}),v(0,e,"windDir",function(){return 0},function(e){}),v(0,e,"useRefractTexture",null,function(e){e?this._addShaderDefine(t.SHADERDEFINE_USE_REFRACT_TEX):this._removeShaderDefine(t.SHADERDEFINE_USE_REFRACT_TEX)}),v(0,e,"renderMode",null,function(e){switch(e){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1;break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1;break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3;break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;default:throw new Error("PBRMaterial:renderMode value error.")}}),t.__init__=function(){t.SHADERDEFINE_CUBE_ENV=t.shaderDefines.registerDefine("CUBE_ENV"),t.SHADERDEFINE_HDR_ENV=t.shaderDefines.registerDefine("HDR_ENV"),t.SHADERDEFINE_SHOW_NORMAL=t.shaderDefines.registerDefine("SHOW_NORMAL"),t.SHADERDEFINE_USEVERTEXHEIGHT=t.shaderDefines.registerDefine("USE_VERTEX_DEEPINFO"),t.SHADERDEFINE_USE_FOAM=t.shaderDefines.registerDefine("USE_FOAM"),t.SHADERDEFINE_USE_REFRACT_TEX=t.shaderDefines.registerDefine("USE_REFR_TEX")},t.load=function(e){return x.loader.create(e,null,null,t)},t.DIFFUSETEXTURE=1,t.NORMALTEXTURE=2,t.UNDERWATERTEXTURE=3,t.VERTEXDISPTEXTURE=4,t.UVANIAGE=5,t.UVMATRIX=6,t.UVAGE=7,t.CURTM=8,t.DETAILTEXTURE=9,t.DEEPCOLORTEXTURE=10,t.SKYTEXTURE=11,t.WAVEINFO=12,t.WAVEINFOD=13,t.WAVEMAINDIR=14,t.SCRSIZE=15,t.WATERINFO=16,t.FOAMTEXTURE=17,t.GEOWAVE_UV_SCALE=18,t.SEA_COLOR=19,t.WAVEINFODEEPSCALE=20,t.SHADERDEFINE_SHOW_NORMAL=0,t.SHADERDEFINE_CUBE_ENV=0,t.SHADERDEFINE_HDR_ENV=0,t.SHADERDEFINE_USE_FOAM=0,t.SHADERDEFINE_USE_REFRACT_TEX=0,t.SHADERDEFINE_USEVERTEXHEIGHT=0,t.RENDERMODE_OPAQUE=1,t.RENDERMODE_OPAQUEDOUBLEFACE=2,t.RENDERMODE_CUTOUT=3,t.RENDERMODE_CUTOUTDOUBLEFACE=4,t.RENDERMODE_TRANSPARENT=13,u(t,["defaultMaterial",function(){return this.defaultMaterial=new t},"shaderDefines",function(){return this.shaderDefines=new hi(Ji.shaderDefines)}]),t}(Ji),Nn=function(e){function r(e,t,i,n){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===i&&(i=35044),void 0===n&&(n=!1),r.__super.call(this),this._indexType=e,this._indexCount=t,this._bufferUsage=i,this._bufferType=34963,this._canRead=n;var a;if("ushort"==e)this._indexTypeByteCount=2;else{if("ubyte"!=e)throw new Error("unidentification index type.");this._indexTypeByteCount=1}a=this._indexTypeByteCount*t,this._byteLength=a,this._bind(),o._gl.bufferData(this._bufferType,a,this._bufferUsage),n?("ushort"==e?this._buffer=new Uint16Array(t):"ubyte"==e&&(this._buffer=new Uint8Array(t)),this.memorySize=2*a):this.memorySize=a}f(r,"laya.d3.graphics.IndexBuffer3D",e);var t=r.prototype;return t.setData=function(e,t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=4294967295);var a=0;if("ushort"==this._indexType?(a=2,0===i&&4294967295===n||(e=new Uint16Array(e.buffer,i*a,n))):"ubyte"==this._indexType&&(a=1,0===i&&4294967295===n||(e=new Uint8Array(e.buffer,i*a,n))),this._bind(),o._gl.bufferSubData(this._bufferType,t*a,e),this._canRead)if(0!==t||0!==i||4294967295!==n){var r=this._buffer.length-t;r<n&&(n=r);for(var s=0;s<n;s++)this._buffer[t+s]=e[s]}else this._buffer=e},t.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},t.disposeResource=function(){e.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},v(0,t,"indexType",function(){return this._indexType}),v(0,t,"indexTypeByteCount",function(){return this._indexTypeByteCount}),v(0,t,"indexCount",function(){return this._indexCount}),v(0,t,"canRead",function(){return this._canRead}),r.INDEXTYPE_UBYTE="ubyte",r.INDEXTYPE_USHORT="ushort",r.create=function(e,t,i,n){return void 0===i&&(i=35044),void 0===n&&(n=!1),new r(e,t,i,n)},r}(o),On=function(r){function a(e,t,i,n){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===n&&(n=!1),a.__super.call(this),this._vertexDeclaration=e,this._vertexCount=t,this._bufferUsage=i,this._bufferType=34962,this._canRead=n,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*t,this._bind(),o._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),n&&(this._buffer=new Float32Array(this._byteLength/4))}f(a,"laya.d3.graphics.VertexBuffer3D",r);var e=a.prototype;return e.bindWithIndexBuffer=function(e){e&&e._bind(),this._bind()},e.setData=function(e,t,i,n){if(void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=4294967295),0===i&&4294967295===n||(e=new Float32Array(e.buffer,4*i,n)),this._bind(),o._gl.bufferSubData(this._bufferType,4*t,e),this._canRead)if(0!==t||0!==i||4294967295!==n){var a=this._buffer.length-t;a<n&&(n=a);for(var r=0;r<n;r++)this._buffer[t+r]=e[r]}else this._buffer=e},e.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},e.disposeResource=function(){for(var e=I.mainContext,t=this._vertexDeclaration.getVertexElements(),i=o._enableAtributes,n=0,a=t.length;n<a;n++)i[n]===this._glBuffer&&(e.disableVertexAttribArray(n),i[n]=null);r.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},v(0,e,"vertexDeclaration",function(){return this._vertexDeclaration}),v(0,e,"vertexCount",function(){return this._vertexCount}),v(0,e,"canRead",function(){return this._canRead}),a.create=function(e,t,i,n){return void 0===i&&(i=35044),void 0===n&&(n=!1),new a(e,t,i,n)},a}(o),kn=function(o){function l(){l.__super.call(this),this.setShaderName("PARTICLESHURIKEN"),this.renderMode=6}f(l,"laya.d3.core.particleShuriKen.ShurikenParticleMaterial",o);var e=l.prototype;return e.onAsynLoaded=function(e,t,i){var n=t[0];if(n.version)o.prototype.onAsynLoaded.call(this,e,t,i);else{var a=t[1],r=n.props;for(var s in r)this[s]=r[s];l._parseShurikenParticleMaterial(a,this,n),this._endLoaded()}},v(0,e,"renderMode",null,function(e){switch(e){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(e)}),v(0,e,"tintColor",function(){return this._getColor(2)},function(e){e?this._addShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR):this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR),this._setColor(2,e)}),v(0,e,"tilingOffset",function(){return this._getColor(3)},function(e){if(e){var t=e.elements;1!=t[0]||1!=t[1]||0!=t[2]||0!=t[3]?this._addShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(3,e)}),v(0,e,"diffuseTexture",function(){return this._getTexture(1)},function(e){e?this._addShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,e)}),l.__init__=function(){l.SHADERDEFINE_DIFFUSEMAP=l.shaderDefines.registerDefine("DIFFUSEMAP"),l.SHADERDEFINE_TINTCOLOR=l.shaderDefines.registerDefine("TINTCOLOR"),l.SHADERDEFINE_ADDTIVEFOG=l.shaderDefines.registerDefine("ADDTIVEFOG"),l.SHADERDEFINE_TILINGOFFSET=l.shaderDefines.registerDefine("TILINGOFFSET")},l.load=function(e){return x.loader.create(e,null,null,l)},l._parseShurikenParticleMaterial=function(e,t,i){var n=i.customProps,a=n.diffuseTexture.texture2D;a&&(t.diffuseTexture=Me.getRes(e[a]));var r=n.tintColor;r&&(t.tintColor=new ri(r[0],r[1],r[2],r[3]))},l.RENDERMODE_OPAQUE=1,l.RENDERMODE_OPAQUEDOUBLEFACE=2,l.RENDERMODE_CUTOUT=3,l.RENDERMODE_CUTOUTDOUBLEFACE=4,l.RENDERMODE_TRANSPARENT=13,l.RENDERMODE_TRANSPARENTDOUBLEFACE=14,l.RENDERMODE_ADDTIVE=15,l.RENDERMODE_ADDTIVEDOUBLEFACE=16,l.RENDERMODE_DEPTHREAD_TRANSPARENT=5,l.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,l.RENDERMODE_DEPTHREAD_ADDTIVE=7,l.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,l.RENDERMODE_NONDEPTH_TRANSPARENT=9,l.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,l.RENDERMODE_NONDEPTH_ADDTIVE=11,l.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,l.SHADERDEFINE_DIFFUSEMAP=0,l.SHADERDEFINE_TINTCOLOR=0,l.SHADERDEFINE_TILINGOFFSET=0,l.SHADERDEFINE_ADDTIVEFOG=0,l.DIFFUSETEXTURE=1,l.TINTCOLOR=2,l.TILINGOFFSET=3,u(l,["defaultMaterial",function(){return this.defaultMaterial=new l},"shaderDefines",function(){return this.shaderDefines=new hi(Ji.shaderDefines)}]),l}(Ji),Vn=function(){function t(){t.__super.call(this),this.setShaderName("Trail"),this._setColor(2,new ri(1,1,1,1))}f(t,"laya.d3.core.trail.TrailMaterial",Ji);var e=t.prototype;return v(0,e,"tintColor",function(){return this._getColor(2)},function(e){this._setColor(2,e)}),v(0,e,"diffuseTexture",function(){return this._getTexture(1)},function(e){e?this._addShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._removeShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._setTexture(1,e)}),v(0,e,"tilingOffset",function(){return this._getColor(3)},function(e){if(e){var t=e.elements;1!=t[0]||1!=t[1]||0!=t[2]||0!=t[3]?this._addShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(3,e)}),t.__init__=function(){t.SHADERDEFINE_DIFFUSETEXTURE=t.shaderDefines.registerDefine("DIFFUSETEXTURE"),t.SHADERDEFINE_TILINGOFFSET=t.shaderDefines.registerDefine("TILINGOFFSET")},t.load=function(e){return x.loader.create(e,null,null,t)},t.SHADERDEFINE_DIFFUSETEXTURE=0,t.SHADERDEFINE_TILINGOFFSET=0,t.DIFFUSETEXTURE=1,t.TINTCOLOR=2,t.TILINGOFFSET=3,u(t,["defaultMaterial",function(){return this.defaultMaterial=new t},"shaderDefines",function(){return this.shaderDefines=new hi(Ji.shaderDefines)}]),t}(),Bn=(function(t){function e(){this._animationSprites=null,this._animationSpritesInitLocalMatrix=null,this._tempCurAnimationData=null,this._curOriginalData=null,this._lastFrameIndex=-1,this._curAnimationDatas=null,e.__super.call(this),this._animationSprites=[],this._animationSpritesInitLocalMatrix=[]}f(e,"laya.d3.component.animation.RigidAnimations",t);var i=e.prototype;i._init=function(){for(var e=this._templet.getNodes(this.currentAnimationClipIndex),t=this._owner,i=e.length,n=0,a=new Uint16Array(this._templet.getPublicExtData()),r=0;r<i;r++){var s=a.slice(n+1,n+1+a[n]);n+=a[n]+1;for(var o=1;o<s.length;o++){s[o];t=t._childs[s[o]]}var l=t.getChildByName(e[r].name);if(!l)break;this._animationSprites[r]=l;var h=this._animationSpritesInitLocalMatrix[r];h=h||(this._animationSpritesInitLocalMatrix[r]=new qt),l.transform.localMatrix.cloneTo(h),t=this._owner}},i._animtionPlay=function(){this._templet.loaded?this._init():this._templet.once("loaded",this,this._init)},i._animtionStop=function(){if(this._lastFrameIndex=-1,this._player.returnToZeroStopped){this._curAnimationDatas=null;for(var e=0;e<this._animationSprites.length;e++)this._animationSprites[e].transform.localMatrix=this._animationSpritesInitLocalMatrix[e]}},i._effectAnimation=function(e){for(var t=0,i=this._animationSprites.length;t<i;t++){for(var n=this._animationSprites[t],a=n.transform.localMatrix,r=a.elements,s=0;s<16;s++)r[s]=this._curAnimationDatas[16*t+s];n.transform.localMatrix=a}},i._load=function(e){t.prototype._load.call(this,e),this._player.on("stopped",this,this._animtionStop),this._player.on("played",this,this._animtionPlay)},i._update=function(e){if(2===this._player.state&&this._templet&&this._templet.loaded){var t=this._player.playbackRate*x.timer.scale,i=this._player.cachePlayRate,n=this._player.isCache&&i<=t,a=n?this.currentFrameIndex:-1;if(-1===a||this._lastFrameIndex!==a){var r=this.currentAnimationClipIndex,s=this._templet.getNodes(r),o=this._templet._animationDatasCache;if(n){var l=this._templet.getAnimationDataWithCache(i,o,r,a);if(l)return this._curAnimationDatas=l,this._lastFrameIndex=a,void this._effectAnimation(s)}var h=16*s.length;n?this._curAnimationDatas=new Float32Array(h):(this._tempCurAnimationData||(this._tempCurAnimationData=new Float32Array(h)),this._curAnimationDatas=this._tempCurAnimationData),this._curOriginalData||(this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(r))),n?this._templet.getOriginalData(r,this._curOriginalData,this._player._fullFrames[r],a,this._player.currentFrameTime):this._templet.getOriginalDataUnfixedRate(r,this._curOriginalData,this._player.currentPlayTime),Li._computeRootAnimationData(s,this._curOriginalData,this._curAnimationDatas),n&&this._templet.setAnimationDataWithCache(i,o,r,a,this._curAnimationDatas),this._lastFrameIndex=a,this._effectAnimation(s)}}},i._unload=function(e){t.prototype._unload.call(this,e),this._animationSprites=null,this._animationSpritesInitLocalMatrix=null,this._tempCurAnimationData=null,this._curOriginalData=null,this._curAnimationDatas=null},v(0,i,"url",null,function(e){console.log("Warning: discard property,please use templet property instead.");var t=x.loader.create(e,null,null,a);this._templet!==t&&(0!==this._player.state&&this._player.stop(!0),this._templet=t,this._player.templet=t,this._curOriginalData=null,this._curAnimationDatas=null,this._tempCurAnimationData=null,this._templet._animationDatasCache||(this._templet._animationDatasCache=[]),this.event("animationchanged",this))}),v(0,i,"templet",t.prototype._$get_templet,function(e){this._templet!==e&&(0!==this._player.state&&this._player.stop(!0),this._templet=e,this._player.templet=e,this._curOriginalData=null,this._curAnimationDatas=null,this._tempCurAnimationData=null,this._templet._animationDatasCache||(this._templet._animationDatasCache=[]),this.event("animationchanged",this))})}(on),function(i){function S(){this._tempCurAnimationData=null,this._tempCurBonesData=null,this._curOriginalData=null,this._lastFrameIndex=-1,this._curMeshAnimationData=null,this._curBonesDatas=null,this._curAnimationDatas=null,this._ownerMesh=null,this._boneIndexToMeshList=null,this._oldVersion=!1,S.__super.call(this),this._boneIndexToMeshList=[]}f(S,"laya.d3.component.animation.SkinAnimations",i);var e=S.prototype;return e._computeBoneIndexToMeshOnTemplet=function(){this._templet.loaded?this._computeBoneIndexToMeshOnMesh():this._templet.once("loaded",this,this._computeBoneIndexToMeshOnMesh)},e._computeBoneIndexToMeshOnMesh=function(){"LAYAANIMATION:02"===this._templet._aniVersion?this._oldVersion=!1:this._oldVersion=!0;var e=this._owner.meshFilter.sharedMesh;e.loaded?this._computeBoneIndexToMesh(e):e.on("loaded",this,this._computeBoneIndexToMesh)},e._computeBoneIndexToMesh=function(e){var t=e._boneNames;if(t)for(var i=t.length,n=this._templet._anis,a=0,r=n.length;a<r;a++){var s=this._boneIndexToMeshList[a];(s=s||(this._boneIndexToMeshList[a]=[])).length=i;for(var o=n[a],l=0;l<i;l++)s[l]=o.bone3DMap[t[l]]}},e._getAnimationDatasWithCache=function(e,t,i,n,a){var r=i[n];if(r){var s=r[e];if(s){var o=s[t.id];return o?o[a]:null}return null}return null},e._setAnimationDatasWithCache=function(e,t,i,n,a,r){var s=i[n]||(i[n]={}),o=s[e]||(s[e]={});(o[t.id]||(o[t.id]=[]))[a]=r},e._onAnimationPlayMeshLoaded=function(){for(var e=this._ownerMesh.meshRender._renderElements,t=0,i=e.length;t<i;t++)e[t]._canDynamicBatch=!1},e._onAnimationPlay=function(){this._ownerMesh._render._addShaderDefine(ra.SHADERDEFINE_BONE);var e=this._ownerMesh.meshFilter.sharedMesh;e.loaded?this._onAnimationPlayMeshLoaded():e.once("loaded",this,this._onAnimationPlayMeshLoaded)},e._onAnimationStop=function(){this._lastFrameIndex=-1,this._player.returnToZeroStopped&&(this._curBonesDatas=null,this._curAnimationDatas=null,this._ownerMesh._render._removeShaderDefine(ra.SHADERDEFINE_BONE));for(var e=this._ownerMesh.meshRender._renderElements,t=0,i=e.length;t<i;t++)e[t]._canDynamicBatch=!0},e._load=function(e){i.prototype._load.call(this,e),this._ownerMesh=e,this._player.on("played",this,this._onAnimationPlay),this._player.on("stopped",this,this._onAnimationStop),this._owner.meshFilter.on("meshchanged",this,this._computeBoneIndexToMeshOnTemplet)},e._update=function(e){var t=this._ownerMesh.meshFilter.sharedMesh;if(2===this._player.state&&this._templet&&this._templet.loaded&&t.loaded){var i=this._player.playbackRate*x.timer.scale,n=this._player.cachePlayRate,a=this._player.isCache&&n<=i,r=a?this.currentFrameIndex:-1;if(-1===r||this._lastFrameIndex!==r){var s=this.currentAnimationClipIndex,o=this._templet._animationDatasCache[0],l=this._templet._animationDatasCache[1];if(a){var h=this._getAnimationDatasWithCache(n,t,l,s,r);if(h)return this._curAnimationDatas=h,this._curBonesDatas=this._templet.getAnimationDataWithCache(n,o,s,r),void(this._lastFrameIndex=r)}var c=!1;a&&(this._curBonesDatas=this._templet.getAnimationDataWithCache(n,o,s,r),c=!!this._curBonesDatas);var u=this._templet.getNodes(s),d=16*u.length,_=t.InverseAbsoluteBindPoses;this._oldVersion?this._curMeshAnimationData||(this._curMeshAnimationData=new Float32Array(d)):this._curMeshAnimationData||(this._curMeshAnimationData=new Float32Array(16*_.length));var p,f,m=0,g=0,v=0,y=t.getSubMeshCount();if(a){for(this._curAnimationDatas=[],this._curAnimationDatas.length=y,m=0;m<y;m++)for(p=this._curAnimationDatas[m]=[],v=(f=t.getSubMesh(m))._boneIndicesList.length,p.length=v,g=0;g<v;g++)p[g]=new Float32Array(16*f._boneIndicesList[g].length);c||(this._curBonesDatas=new Float32Array(d))}else{if(!this._tempCurAnimationData)for(this._tempCurAnimationData=[],this._tempCurAnimationData.length=y,m=0;m<y;m++)for(p=this._tempCurAnimationData[m]=[],v=(f=t.getSubMesh(m))._boneIndicesList.length,p.length=v,g=0;g<v;g++)p[g]=new Float32Array(16*f._boneIndicesList[g].length);this._tempCurBonesData||(this._tempCurBonesData=new Float32Array(d)),this._curAnimationDatas=this._tempCurAnimationData,this._curBonesDatas=this._tempCurBonesData}if(this._curOriginalData||(this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(s))),a?this._templet.getOriginalData(s,this._curOriginalData,this._player._fullFrames[s],r,this._player.currentFrameTime):this._templet.getOriginalDataUnfixedRate(s,this._curOriginalData,this._player.currentPlayTime),this._oldVersion)a&&c?Li._computeAnimationDatasByArrayAndMatrixFastOld(_,this._curBonesDatas,this._curMeshAnimationData):Li._computeBoneAndAnimationDatasByBindPoseMatrxixOld(u,this._curOriginalData,_,this._curBonesDatas,this._curMeshAnimationData);else{var C=this._boneIndexToMeshList[s];a&&c?Li._computeAnimationDatasByArrayAndMatrixFast(_,this._curBonesDatas,this._curMeshAnimationData,C):Li._computeBoneAndAnimationDatasByBindPoseMatrxix(u,this._curOriginalData,_,this._curBonesDatas,this._curMeshAnimationData,C)}for(m=0;m<y;m++){var E=t.getSubMesh(m)._boneIndicesList;for(v=E.length,p=this._curAnimationDatas[m],g=0;g<v;g++)S._splitAnimationDatas(E[g],this._curMeshAnimationData,p[g])}a&&(this._setAnimationDatasWithCache(n,t,l,s,r,this._curAnimationDatas),c||this._templet.setAnimationDataWithCache(n,o,s,r,this._curBonesDatas)),this._lastFrameIndex=r}}},e._preRenderUpdate=function(e){var t=e.renderElement.renderObj;this._curAnimationDatas?t._skinAnimationDatas=this._curAnimationDatas[t._indexInMesh]:t._skinAnimationDatas=null},e._unload=function(e){2==this.player.state&&this._ownerMesh._render._removeShaderDefine(ra.SHADERDEFINE_BONE),this._templet&&!this._templet.loaded&&this._templet.off("loaded",this,this._computeBoneIndexToMeshOnMesh);var t=this._ownerMesh.meshFilter.sharedMesh;t.loaded||t.off("loaded",this,this._onAnimationPlayMeshLoaded),i.prototype._unload.call(this,e),this._tempCurAnimationData=null,this._tempCurBonesData=null,this._curOriginalData=null,this._curMeshAnimationData=null,this._curBonesDatas=null,this._curAnimationDatas=null,this._ownerMesh=null},v(0,e,"curBonesDatas",function(){return this._curBonesDatas}),v(0,e,"templet",i.prototype._$get_templet,function(e){this._templet!==e&&(0!==this._player.state&&this._player.stop(!0),this._templet=e,this._player.templet=e,this._computeBoneIndexToMeshOnTemplet(),this._curOriginalData=null,this._curMeshAnimationData=null,this._tempCurBonesData=null,this._tempCurAnimationData=null,this._templet._animationDatasCache||(this._templet._animationDatasCache=[[],[]]),this.event("animationchanged",this))}),S._splitAnimationDatas=function(e,t,i){for(var n=0,a=e.length,r=0;n<a;n++)for(var s=0;s<16;s++,r++)i[r]=t[(e[n]<<4)+s]},S}(on)),Fn=function(){function l(){this._size=null,this._transformOrientedBoundBox=null,this.center=null,l.__super.call(this),this._needUpdate=!1}f(l,"laya.d3.component.physics.BoxCollider",hn);var e=l.prototype;return e._updateCollider=function(){if(this._needUpdate){var e=this._transformOrientedBoundBox.transformation,t=this._owner.transform,i=t.rotation,n=t.scale,a=this.center.elements;0===a[0]&&0===a[1]&&0===a[2]?qt.createAffineTransformation(t.position,i,ai.ONE,e):(ai.multiply(this.center,n,l._deviationV3),ai.transformQuat(l._deviationV3,i,l._deviationV3),ai.add(t.position,l._deviationV3,l._deviationV3),qt.createAffineTransformation(l._deviationV3,i,ai.ONE,e)),this._transformOrientedBoundBox.transformation=e;var r=this._transformOrientedBoundBox.extents.elements,s=this._size.elements,o=n.elements;r[0]=.5*s[0]*o[0],r[1]=.5*s[1]*o[1],r[2]=.5*s[2]*o[2],this._needUpdate=!1}},e._onWorldMatrixChanged=function(){for(var e in this._needUpdate=!0,this._runtimeCollisonMap)this._runtimeCollisonTestMap[e]=!0,this._runtimeCollisonMap[e]._runtimeCollisonTestMap[this.id]=!0},e._initialize=function(e){laya.d3.component.Component3D.prototype._initialize.call(this,e),this._transformOrientedBoundBox=new Zt(new ai,new qt),this._size=new ai,this.center=new ai,e.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},e._getType=function(){return 1},e._collisonTo=function(e){switch(e._getType()){case 0:return 0!==this.boundBox.containsSphere(e.boundSphere);case 1:return 0!==this.boundBox.containsOrientedBoundBox(e.boundBox);case 2:var t=e;if(0===this.boundBox.containsBoundBox(t._boundBox))return!1;for(var i=e.mesh._positions,n=0,a=i.length;n<a;n++)if(1===this.boundBox.containsPoint(i[n]))return!0;return!1;default:throw new Error("BoxCollider:unknown collider type.")}},e._cloneTo=function(e){var t=e,i=t.size;this.size.cloneTo(i),t.size=i,this.center.cloneTo(t.center)},e.raycast=function(e,t,i){void 0===i&&(i=179e306),this._updateCollider();var n=this._transformOrientedBoundBox.intersectsRay(e,t.position);return-1!==n&&n<=i?(t.distance=n,t.sprite3D=this._owner,!0):(t.distance=-1,t.sprite3D=null,!1)},e.setFromBoundBox=function(e){Zt.createByBoundBox(e,this._transformOrientedBoundBox);var t=this._transformOrientedBoundBox.extents;this._size=new ai(2*t.x,2*t.y,2*t.z),this.center=new ai,ai.add(e.min,e.max,this.center),ai.scale(this.center,.5,this.center),this._needUpdate=!0},v(0,e,"boundBox",function(){return this._updateCollider(),this._transformOrientedBoundBox}),v(0,e,"size",function(){return this._size},function(e){this._size=e,this._needUpdate=!0}),u(l,["_deviationV3",function(){return this._deviationV3=new ai},"_obbCenterV3",function(){return this._obbCenterV3=new ai}]),l}(),Hn=function(){function E(){this._transformBoundingBox=null,this._mesh=null,E.__super.call(this),this._transformBoundingBox=new Ht(new ai,new ai),this._needUpdate=!1}f(E,"laya.d3.component.physics.MeshCollider",hn);var e=E.prototype;return e._updateBoundBoxCollider=function(){if(this._needUpdate){for(var e=this._owner.transform.worldMatrix,t=this._mesh.boundingBoxCorners,i=0;i<8;i++)ai.transformCoordinate(t[i],e,E._tempBoundBoxCorners[i]);Ht.createfromPoints(E._tempBoundBoxCorners,this._transformBoundingBox),this._needUpdate=!1}},e._raycastMesh=function(e,t,i,n){void 0===n&&(n=179e306);var a=t.transform.worldMatrix,r=E._tempMatrix4x40;a.invert(r);var s=e.origin,o=e.direction,l=E._tempRay0;ai.transformCoordinate(s,r,l.origin),ai.TransformNormal(o,r,l.direction);for(var h=Number.MAX_VALUE,c=0,u=this._mesh.getRenderElementsCount();c<u;c++){var d=this._mesh.getRenderElement(c),_=d._getVertexBuffer(0),p=_.getData(),f=d._getIndexBuffer().getData(),m=E._tempRaycastHit;if(Ti.rayIntersectsPositionsAndIndices(l,p,_.vertexDeclaration,f,m)){ai.transformCoordinate(m.position,a,m.position);var g=E._tempVector30;ai.subtract(s,m.position,g);var v=ai.scalarLength(g);if(v<n&&v<h){m.distance=v,m.sprite3D=t;var y=m.trianglePositions;ai.transformCoordinate(y[0],a,y[0]),ai.transformCoordinate(y[1],a,y[1]),ai.transformCoordinate(y[2],a,y[2]);var C=m.triangleNormals;return ai.transformCoordinate(C[0],a,C[0]),ai.transformCoordinate(C[1],a,C[1]),ai.transformCoordinate(C[2],a,C[2]),h=v,m.cloneTo(i),!0}return!1}}return!1},e._onWorldMatrixChanged=function(){this._needUpdate=!0},e._initialize=function(e){laya.d3.component.Component3D.prototype._initialize.call(this,e),e.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},e._getType=function(){return 2},e._collisonTo=function(e){var t=0,i=0,n=this.mesh._positions;switch(e._getType()){case 0:var a=e;if(0===zt.sphereContainsBox(a.boundSphere,this._boundBox))return!1;for(t=0,i=n.length;t<i;t++)if(1===zt.sphereContainsPoint(a.boundSphere,n[t]))return!0;return!1;case 1:var r=e;if(0===r.boundBox.containsBoundBox(this._boundBox))return!1;for(t=0,i=n.length;t<i;t++)if(1===r.boundBox.containsPoint(n[t]))return!0;return!1;case 2:var s=e;return 1!==zt.intersectsBoxAndBox(s._boundBox,this._boundBox);default:throw new Error("MeshCollider:unknown collider type.")}},e._cloneTo=function(e){e.mesh=this._mesh},e.raycast=function(e,t,i){if(void 0===i&&(i=179e306),null==this._mesh||!this._mesh.loaded)return!1;var n=zt.intersectsRayAndBoxRD(e,this._boundBox);return!!(-1!==n&&n<=i&&this._raycastMesh(e,this._owner,t,i))||(t.distance=-1,t.sprite3D=null,!1)},v(0,e,"_boundBox",function(){return this._updateBoundBoxCollider(),this._transformBoundingBox}),v(0,e,"mesh",function(){return this._mesh},function(e){this._mesh=e}),u(E,["_tempRay0",function(){return this._tempRay0=new ti(new ai,new ai)},"_tempVector30",function(){return this._tempVector30=new ai},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new qt},"_tempRaycastHit",function(){return this._tempRaycastHit=new Mi},"_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new ai,new ai,new ai,new ai,new ai,new ai,new ai,new ai]}]),E}(),Un=function(){function e(){this._originalBoundSphere=null,this._transformBoundSphere=null,e.__super.call(this),this._needUpdate=!1}f(e,"laya.d3.component.physics.SphereCollider",hn);var t=e.prototype;return t._updateCollider=function(){if(this._needUpdate){var e=NaN,t=this._owner.transform,i=t.scale;e=i.x>=i.y&&i.x>=i.z?i.x:i.y>=i.z?i.y:i.z,ai.transformCoordinate(this._originalBoundSphere.center,t.worldMatrix,this._transformBoundSphere.center),this._transformBoundSphere.radius=this._originalBoundSphere.radius*e,this._needUpdate=!1}},t._onWorldMatrixChanged=function(){for(var e in this._needUpdate=!0,this._runtimeCollisonMap)this._runtimeCollisonTestMap[e]=!0,this._runtimeCollisonMap[e]._runtimeCollisonTestMap[this.id]=!0},t._initialize=function(e){laya.d3.component.Component3D.prototype._initialize.call(this,e),this._originalBoundSphere=new Gt(new ai(0,0,0),.5),this._transformBoundSphere=new Gt(new ai(0,0,0),.5),e.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},t._getType=function(){return 0},t._collisonTo=function(e){switch(e._getType()){case 0:return 0!==zt.sphereContainsSphere(this.boundSphere,e.boundSphere);case 1:return 0!==e.boundBox.containsSphere(this.boundSphere);case 2:var t=e;if(0===zt.sphereContainsBox(this.boundSphere,t._boundBox))return!1;for(var i=t.mesh._positions,n=0,a=i.length;n<a;n++)if(1===zt.sphereContainsPoint(this.boundSphere,i[n]))return!0;return!1;default:throw new Error("SphereCollider:unknown collider type.")}},t._cloneTo=function(e){var t=e;t.radius=this.radius;var i=t.center;this.center.cloneTo(i),t.center=i},t.raycast=function(e,t,i){void 0===i&&(i=179e306),this._updateCollider();var n=this._transformBoundSphere.intersectsRayPoint(e,t.position);return-1!==n&&n<=i?(t.distance=n,t.sprite3D=this._owner,!0):(t.distance=-1,t.sprite3D=null,!1)},v(0,t,"center",function(){return this._originalBoundSphere.center},function(e){this._originalBoundSphere.center=e}),v(0,t,"radius",function(){return this._originalBoundSphere.radius},function(e){this._originalBoundSphere.radius=e}),v(0,t,"boundSphere",function(){return this._updateCollider(),this._transformBoundSphere}),e}(),Gn=function(){function p(){this.simLodInfo=null,this._src=null,this._buffer=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,p.__super.call(this),this._type=3553}f(p,"laya.d3.resource.DataTexture2D",en);var e=p.prototype;return e.genDebugMipmaps=function(){var e=[];return e.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),e.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),e.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),e.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),e.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),e.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),e.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),e.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),e.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),e.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),e},e._onTextureLoaded=function(e){},e._createWebGlTexture=function(){if(!this._buffer&&!this._mipmaps)throw"create GLTextur err:no data";var e=I.mainContext;e.getExtension("EXT_shader_texture_lod");var t=this._source=e.createTexture(),i=this._width,n=this._height,a=D.curBindTexTarget,r=D.curBindTexValue;if(D.bindTexture(e,this._type,t),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var s=0;e.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var o=0;o<this._mipmaps.length;o++){if(this._mipmaps[o].byteLength!=l*h*4)throw"mipmap size error  level:"+o;e.texSubImage2D(this._type,0,p.simLodRect[s++],p.simLodRect[s++],p.simLodRect[s++],p.simLodRect[s++],6408,5121,new Uint8Array(this._mipmaps[o]))}this.minFifter=9729,this.magFifter=9729}else{var l=this._width,h=this._height;for(s=0,e.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),o=0;o<this._mipmaps.length;o++){if(this._mipmaps[o].byteLength!=l*h*4)throw"mipmap size error  level:"+o;e.texImage2D(this._type,o,6408,l,h,0,6408,5121,new Uint8Array(this._mipmaps[o])),(l/=2)<1&&(l=1),(h/=2)<1&&(h=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else e.texImage2D(this._type,0,6408,i,n,0,6408,5121,new Uint8Array(this._buffer));var c=this._minFifter,u=this._magFifter,d=this._repeat?10497:33071,_=m.isPOT(i,n);if(!_)throw"data texture must be POT";this._mipmap||this._mipmaps?-1!==c||(c=9987):-1!==c||(c=9729),-1!==u||(u=9729),e.texParameteri(this._type,10241,c),e.texParameteri(this._type,10240,u),e.texParameteri(this._type,10242,d),this._mipmaps?e.texParameteri(this._type,10243,33071):e.texParameteri(this._type,10243,d),this._mipmap&&e.generateMipmap(this._type),a&&r&&D.bindTexture(e,a,r),this.src&&0<this.src.length&&(this._buffer=null),this.memorySize=_?i*n*4*(1+1/3):i*n*4,this._recreateLock=!1},e.recreateResource=function(){if(this._buffer||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},e.onAsynLoaded=function(e,t,i){var n;i&&(n=i[0].call(this,t)),n&&(this._width=n.width,this._height=n.height,this._buffer=n.data),this._src=e,this._size=new Ri(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},e.getPixels=function(){return new Uint8Array(this._buffer)},e.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(I.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this.memorySize=0)},v(0,e,"src",function(){return this._src}),p.create=function(e,t,i,n,a,r){if(void 0===n&&(n=9729),void 0===a&&(a=9729),void 0===r&&(r=!0),!e||e.byteLength<t*i*4)throw"DataTexture2D create error";var s=new p;return s._buffer=e,s._width=t,s._height=i,s._mipmap=r,s._magFifter=n,s._minFifter=a,s._size=new Ri(s._width,s._height),s._conchTexture?alert("怎么给runtime传递datatexture数据"):s.activeResource(),s},p.load=function(e,t,i,n,a){if(void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=9729),void 0===a&&(a=9729),"mipmaps"===A.getFileExtension(e)){var r=x.loader.create(e,null,null,p,[function(e){this._mipmaps=[];var t=new Uint32Array(e);this._width=t[0];var i=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,i=1024),this._width!=i)throw console.error("现在只支持512x256的环境贴图。当前的是"+t[0]),"现在只支持512x256的环境贴图。当前的是"+t[0];this._height=t[1];for(var n=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,a=this._height,r=8;;){var s=n*a*4;if(r+s>e.byteLength)throw"load mipmaps data size error ";var o=new Uint8Array(e,r,s);if(this._mipmaps.push(o),r+=s,1==n&&1==a)break;(n/=2)<1&&(n=1),(a/=2)<1&&(a=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){r.simLodInfo=new Float32Array(40);for(var s=0;s<r.simLodInfo.length;)r.simLodInfo[s]=(p.simLodRect[s]+.5)/1024,s++,r.simLodInfo[s]=(p.simLodRect[s]+.5)/256,s++,r.simLodInfo[s]=Math.max(p.simLodRect[s]-1,.1)/1024,s++,r.simLodInfo[s]=Math.max(p.simLodRect[s]-1.5,.1)/256,s++}return r}if("number"==typeof t)return x.loader.create(e,null,null,p,[function(e){return this._width=t,this._height=i,this._buffer=e,null}]);if("function"==typeof t)return x.loader.create(e,null,null,p,[t]);throw new Error("unknown params.")},p.lodasatlas=!1,u(p,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),p}(),zn=function(){function e(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,e.__super.call(this)}f(e,"laya.d3.resource.models.PrimitiveMesh",tn);var t=e.prototype;return x.imps(t,{"laya.d3.core.render.IRenderable":!0}),t._getVertexBuffer=function(e){return void 0===e&&(e=0),0===e?this._vertexBuffer:null},t._getVertexBuffers=function(){return null},t._getIndexBuffer=function(){return this._indexBuffer},t._getPositions=function(){var e,t=[],i=this._vertexBuffer.vertexDeclaration.getVertexElements(),n=0;for(n=0;n<i.length;n++){var a=i[n];if("vector3"===a.elementFormat&&0===a.elementUsage){e=a;break}}var r=this._vertexBuffer.getData();for(n=0;n<r.length;n+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var s=n+e.offset/4,o=new ai(r[s+0],r[s+1],r[s+2]);t.push(o)}return t},t.getRenderElement=function(e){return this},t.getRenderElementsCount=function(){return 1},t.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this.memorySize=0},t._beforeRender=function(e){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},t._render=function(e){I.mainContext.drawElements(4,this._numberIndices,5123,0),w.drawCall++,w.trianglesFaces+=this._numberIndices/3},v(0,t,"_vertexBufferCount",function(){return 1}),v(0,t,"triangleCount",function(){return this._indexBuffer.indexCount/3}),e}(),Wn=function(){function t(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,t.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}f(t,"laya.d3.resource.models.Mesh",tn);var e=t.prototype;return e._getPositions=function(){var e,t,i,n,a,r=[],s=0,o=0,l=0;if(0!==this._vertexBuffers.length){var h=this._vertexBuffers.length;for(s=0;s<h;s++){for(i=(e=this._vertexBuffers[s]).vertexDeclaration.getVertexElements(),o=0;o<i.length;o++)if("vector3"===(n=i[o]).elementFormat&&0===n.elementUsage){t=n;break}for(a=e.getData(),o=0;o<a.length;o+=e.vertexDeclaration.vertexStride/4)l=o+t.offset/4,r.push(new ai(a[l+0],a[l+1],a[l+2]))}}else{var c=this._subMeshes.length;for(s=0;s<c;s++){for(i=(e=this._subMeshes[s]._getVertexBuffer()).vertexDeclaration.getVertexElements(),o=0;o<i.length;o++)if("vector3"===(n=i[o]).elementFormat&&0===n.elementUsage){t=n;break}for(a=e.getData(),o=0;o<a.length;o+=e.vertexDeclaration.vertexStride/4)l=o+t.offset/4,r.push(new ai(a[l+0],a[l+1],a[l+2]))}}return r},e._setSubMeshes=function(e){this._subMeshes=e,this._subMeshCount=e.length;for(var t=0;t<this._subMeshCount;t++)e[t]._indexInMesh=t;this._positions=this._getPositions(),this._generateBoundingObject()},e.onAsynLoaded=function(e,t,i){var n=t[0],a=t[1];Bt.read(n,this,this._materials,this._subMeshes,a),this.completeCreate(),this._endLoaded()},e.getSubMesh=function(e){return this._subMeshes[e]},e.getSubMeshCount=function(){return this._subMeshes.length},e.getRenderElementsCount=function(){return this._subMeshes.length},e.getRenderElement=function(e){return this._subMeshes[e]},e.disposeResource=function(){for(var e=0;e<this._subMeshes.length;e++)this._subMeshes[e].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},v(0,e,"materials",function(){return this._materials.slice()}),v(0,e,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),t.load=function(e){return x.loader.create(e,null,null,t)},t}(),Xn=function(){function h(e,t,i,n,a,r,s,o,l){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===i&&(i=6408),void 0===n&&(n=5121),void 0===a&&(a=33189),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===o&&(o=-1),void 0===l&&(l=-1),h.__super.call(this),this._type=3553,this._width=e,this._height=t,this._size=new Ri(e,t),this._surfaceFormat=i,this._surfaceType=n,this._depthStencilFormat=a,_.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=r,this._repeat=s,this._minFifter=o,this._magFifter=l,this.activeResource(),this._alreadyResolved=!0}f(h,"laya.d3.resource.RenderTexture",en);var e=h.prototype;return e.recreateResource=function(){var e=I.mainContext;this._frameBuffer=e.createFramebuffer(),this._source=e.createTexture();var t=D.curBindTexTarget,i=D.curBindTexValue;D.bindTexture(e,this._type,this._source),e.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var n=this._minFifter,a=this._magFifter,r=this._repeat?10497:33071;if(m.isPOT(this._width,this._height)?(this._mipmap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==a||(a=9729),e.texParameteri(this._type,10241,n),e.texParameteri(this._type,10240,a),e.texParameteri(this._type,10242,r),e.texParameteri(this._type,10243,r),this._mipmap&&e.generateMipmap(this._type)):(-1!==n||(n=9729),-1!==a||(a=9729),e.texParameteri(this._type,10241,n),e.texParameteri(this._type,10240,a),e.texParameteri(this._type,10242,33071),e.texParameteri(this._type,10243,33071)),e.bindFramebuffer(36160,this._frameBuffer),e.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,this._depthStencilBuffer),e.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),this._depthStencilFormat){case 33189:e.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:e.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:e.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}e.bindFramebuffer(36160,null),t&&i&&D.bindTexture(e,t,i),e.bindRenderbuffer(36161,null),this.memorySize=this._width*this._height*4,this.completeCreate()},e.start=function(){I.mainContext.bindFramebuffer(36160,this.frameBuffer),(h._currentRenderTarget=this)._alreadyResolved=!1},e.end=function(){I.mainContext.bindFramebuffer(36160,null),h._currentRenderTarget=null,this._alreadyResolved=!0},e.getData=function(e,t,i,n){var a=I.mainContext;if(a.bindFramebuffer(36160,this._frameBuffer),!(36053===a.checkFramebufferStatus(36160)))return a.bindFramebuffer(36160,null),null;var r=new Uint8Array(this._width*this._height*4);return a.readPixels(e,t,i,n,this._surfaceFormat,this._surfaceType,r),a.bindFramebuffer(36160,null),r},e.disposeResource=function(){if(this._frameBuffer){var e=I.mainContext;e.deleteTexture(this._source),e.deleteFramebuffer(this._frameBuffer),e.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},v(0,e,"surfaceFormat",function(){return this._surfaceFormat}),v(0,e,"surfaceType",function(){return this._surfaceType}),v(0,e,"depthStencilFormat",function(){return this._depthStencilFormat}),v(0,e,"source",function(){return this._alreadyResolved?x.superGet(en,this,"source"):null}),v(0,e,"depthStencilBuffer",function(){return this._depthStencilBuffer}),v(0,e,"frameBuffer",function(){return this._frameBuffer}),h._currentRenderTarget=null,h}(),jn=function(){function t(e){this._color=null,this._pixels=null,t.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new Ri(this.width,this.height),this._color=e,this._pixels=new Uint8Array([255*e.x,255*e.y,255*e.z,255*e.w])}f(t,"laya.d3.resource.SolidColorTexture2D",en);var e=t.prototype;return e._createWebGlTexture=function(){var e=I.mainContext,t=this._source=e.createTexture(),i=this._width,n=this._height,a=D.curBindTexTarget,r=D.curBindTexValue;D.bindTexture(e,this._type,t),e.texImage2D(this._type,0,6408,i,n,0,6408,5121,this._pixels);var s=this._minFifter,o=this._magFifter,l=this._repeat?10497:33071,h=m.isPOT(i,n);h?(this._mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==o||(o=9729),e.texParameteri(this._type,10241,s),e.texParameteri(this._type,10240,o),e.texParameteri(this._type,10242,l),e.texParameteri(this._type,10243,l),this._mipmap&&e.generateMipmap(this._type)):(-1!==s||(s=9729),-1!==o||(o=9729),e.texParameteri(this._type,10241,s),e.texParameteri(this._type,10240,o),e.texParameteri(this._type,10242,33071),e.texParameteri(this._type,10243,33071)),a&&r&&D.bindTexture(e,a,r),this.memorySize=h?i*n*4*(1+1/3):i*n*4},e.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},e.disposeResource=function(){this._source&&(I.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},u(t,["magentaTexture",function(){return this.magentaTexture=new t(new ri(1,0,1,1))},"grayTexture",function(){return this.grayTexture=new t(new ri(.5,.5,.5,1))}]),t}(),Yn=function(){function t(e){this._color=null,this._pixels=null,this._texCount=6,t.__super.call(this),this._type=34067,this._width=1,this._height=1,this._size=new Ri(this.width,this.height),this._color=e,this._pixels=new Uint8Array([255*e.x,255*e.y,255*e.z,255*e.w])}f(t,"laya.d3.resource.SolidColorTextureCube",en);var e=t.prototype;return e._createWebGlTexture=function(){var e=I.mainContext,t=this._source=e.createTexture(),i=this._width,n=this._height,a=D.curBindTexTarget,r=D.curBindTexValue;D.bindTexture(e,this._type,t),e.texImage2D(34069,0,6408,i,n,0,6408,5121,this._pixels),e.texImage2D(34070,0,6408,i,n,0,6408,5121,this._pixels),e.texImage2D(34071,0,6408,i,n,0,6408,5121,this._pixels),e.texImage2D(34072,0,6408,i,n,0,6408,5121,this._pixels),e.texImage2D(34073,0,6408,i,n,0,6408,5121,this._pixels),e.texImage2D(34074,0,6408,i,n,0,6408,5121,this._pixels);var s=this.minFifter,o=this.magFifter,l=this._repeat?10497:33071,h=m.isPOT(i,n);h?(this.mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==o||(o=9729),e.texParameteri(this._type,10241,s),e.texParameteri(this._type,10240,o),e.texParameteri(this._type,10242,l),e.texParameteri(this._type,10243,l),this.mipmap&&e.generateMipmap(this._type)):(-1!==s||(s=9729),-1!==o||(o=9729),e.texParameteri(this._type,10241,s),e.texParameteri(this._type,10240,o),e.texParameteri(this._type,10242,33071),e.texParameteri(this._type,10243,33071)),a&&r&&D.bindTexture(e,a,r),this.memorySize=h?i*n*4*(1+1/3)*this._texCount:i*n*4*this._texCount},e.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},e.disposeResource=function(){this._source&&(I.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},u(t,["magentaTexture",function(){return this.magentaTexture=new t(new ri(1,0,1,1))},"grayTexture",function(){return this.grayTexture=new t(new ri(.5,.5,.5,1))}]),t}(),Kn=function(){function a(e,t,i,n){this._canRead=!1,this._image=null,this._pixels=null,void 0===e&&(e=!1),void 0===t&&(t=!0),void 0===i&&(i=6408),void 0===n&&(n=!0),a.__super.call(this),this._type=3553,this._repeat=t,this._canRead=e,this._format=i,this._mipmap=n}f(a,"laya.d3.resource.Texture2D",en);var e=a.prototype;return e._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var e=I.mainContext,t=this._source=e.createTexture(),i=this._width,n=this._height,a=D.curBindTexTarget,r=D.curBindTexValue;switch(D.bindTexture(e,this._type,t),this._format){case 6407:case 6408:this._canRead?e.texImage2D(this._type,0,this._format,i,n,0,this._format,5121,this._pixels):e.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case I.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:e.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image)}var s=this._minFifter,o=this._magFifter,l=this._repeat?10497:33071,h=0==this._wrapModeU?10497:33071,c=0==this._wrapModeV?10497:33071,u=m.isPOT(i,n);u?(this._mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==o||(o=9729),e.texParameteri(this._type,10241,s),e.texParameteri(this._type,10240,o),e.texParameteri(this._type,10242,l),e.texParameteri(this._type,10243,l),e.texParameteri(this._type,10242,h),e.texParameteri(this._type,10243,c),this._mipmap&&e.generateMipmap(this._type)):(-1!==s||(s=9729),-1!==o||(o=9729),e.texParameteri(this._type,10241,s),e.texParameteri(this._type,10240,o),e.texParameteri(this._type,10242,33071),e.texParameteri(this._type,10243,33071)),a&&r&&D.bindTexture(e,a,r),this._image.onload=null,this._image=null,this.memorySize=u?i*n*4*(1+1/3):i*n*4},e.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},e.onAsynLoaded=function(e,t,i){if(i){var n=i[0];void 0!==n&&(this._canRead=n);var a=i[1];void 0!==a&&(this._repeat=a);var r=i[2];void 0!==r&&(this._format=r);var s=i[3];void 0!==s&&(this._mipmap=s);var o=i.wrapModeU;void 0!==o&&(this._wrapModeU=o);var l=i.wrapModeV;void 0!==l&&(this._wrapModeV=l)}switch(this._format){case 6407:case 6408:var h=(this._image=t).width,c=t.height;this._width=h,this._height=c,this._size=new Ri(h,c),this._canRead&&(_.isConchApp?t instanceof d.HTMLElement&&(this._pixels=new Uint8Array(t.getImageData(0,0,h,c))):(R.canvas.size(h,c),R.canvas.clear(),R.context.drawImage(t,0,0,h,c),this._pixels=new Uint8Array(R.context.getImageData(0,0,h,c).data.buffer)));break;case I.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var u=new C(t);u.readUTFBytes(4),u.readUTFBytes(2),u.getInt16();u.endian="bigEndian",this._width=u.getInt16(),this._height=u.getInt16(),this._size=new Ri(this._width,this._height);u.getInt16(),u.getInt16();this._image=new Uint8Array(t,u.pos)}this.recreateResource(),this._endLoaded()},e.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},e.disposeResource=function(){this._source&&(I.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},v(0,e,"_src",function(){return this.url}),v(0,e,"src",function(){return this.url}),a.load=function(e){return x.loader.create(e,null,null,a)},a}(),qn=function(){function t(){t.__super.call(this),this._type=34067}f(t,"laya.d3.resource.TextureCube",en);var e=t.prototype;return e._onTextureLoaded=function(e){this._images=e;for(var t=2147483647,i=2147483647,n=0;n<6;n++){var a=e[n];t=Math.min(t,a.width),i=Math.min(i,a.height)}this._width=t,this._height=i,this._size=new Ri(t,i)},e._createWebGlTexture=function(){var e=0;for(e=0;e<6;e++)if(!this._images[e])throw"create GLTextur err:no data:"+this._images[e];var t=I.mainContext,i=this._source=t.createTexture(),n=this._width,a=this._height,r=D.curBindTexTarget,s=D.curBindTexValue;D.bindTexture(t,this._type,i),t.texImage2D(34069,0,6408,6408,5121,this._images[0]),t.texImage2D(34070,0,6408,6408,5121,this._images[1]),t.texImage2D(34071,0,6408,6408,5121,this._images[2]),t.texImage2D(34072,0,6408,6408,5121,this._images[3]),t.texImage2D(34073,0,6408,6408,5121,this._images[4]),t.texImage2D(34074,0,6408,6408,5121,this._images[5]);var o=this.minFifter,l=this.magFifter,h=this._repeat?10497:33071,c=m.isPOT(n,a);for(c?(this.mipmap?-1!==o||(o=9987):-1!==o||(o=9729),-1!==l||(l=9729),t.texParameteri(this._type,10241,o),t.texParameteri(this._type,10240,l),t.texParameteri(this._type,10242,h),t.texParameteri(this._type,10243,h),this.mipmap&&t.generateMipmap(this._type)):(-1!==o||(o=9729),-1!==l||(l=9729),t.texParameteri(this._type,10241,o),t.texParameteri(this._type,10240,l),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),r&&s&&D.bindTexture(t,r,s),e=0;e<6;e++)this._images[e].onload=null,this._images[e]=null;this.memorySize=c?n*a*4*(1+1/3)*6:n*a*4*6},e.recreateResource=function(){null!=this._url&&(this._createWebGlTexture(),this.completeCreate())},e.onAsynLoaded=function(e,t,i){this._onTextureLoaded(t),this.activeResource(),this._endLoaded()},e.disposeResource=function(){this._source&&(I.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},v(0,e,"defaulteTexture",function(){return Yn.grayTexture}),t.load=function(e){return x.loader.create(e,null,null,t)},t}(),Zn=function(n){function m(e){this._hasIndependentBound=!0,m.__super.call(this,e),this._owner.transform.off("worldmatrixneedchanged",this,this._onWorldMatNeedChange),this._cacheAnimationNodeIndex=[],this._cacheAnimationNode=[],this._localBoundingBoxCorners=T(8,null),this._owner.meshFilter.on("meshchanged",this,this._$3__onMeshChanged)}f(m,"laya.d3.core.SkinnedMeshRender",n);var e=m.prototype;return e._getCacheAnimationNodes=function(){var e=this._cacheMesh._boneNames,t=e.length;this._cacheAnimationNode.length=t,this._cacheAnimationNodeIndex.length=t;for(var i=this._cacheAnimator._avatarNodes,n=this._cacheAnimator._avatarNodeMap,a=0;a<t;a++){var r=n[e[a]];this._cacheAnimationNode[a]=r,this._cacheAnimationNodeIndex[a]=i.indexOf(r)}},e._offComputeBoneIndexToMeshEvent=function(e,t){e.loaded?t.loaded||t.off("loaded",this,this._getCacheAnimationNodes):e.off("loaded",this,this._computeBoneIndexToMeshWithAsyncMesh)},e._computeBoneIndexToMeshWithAsyncAvatar=function(){this._cacheAvatar.loaded?this._computeBoneIndexToMeshWithAsyncMesh():this._cacheAvatar.once("loaded",this,this._computeBoneIndexToMeshWithAsyncMesh)},e._computeBoneIndexToMeshWithAsyncMesh=function(){this._cacheMesh.loaded?this._getCacheAnimationNodes():this._cacheMesh.on("loaded",this,this._getCacheAnimationNodes)},e._$3__onMeshChanged=function(e,t,i){this._cacheMesh=i,t&&!t.loaded&&i.off("loaded",this,this._onMeshLoaded),i.loaded?this._onMeshLoaded(i):i.on("loaded",this,this._onMeshLoaded),this._cacheAvatar&&(t&&this._offComputeBoneIndexToMeshEvent(this._cacheAvatar,t),i&&this._computeBoneIndexToMeshWithAsyncAvatar())},e._onMeshLoaded=function(e){var t=e.subMeshCount;this._subSkinnedDatas=[],this._subSkinnedDatas.length=t;for(var i=0;i<t;i++)for(var n=this._subSkinnedDatas[i]=[],a=e.getSubMesh(i)._boneIndicesList,r=0,s=a.length;r<s;r++)n[r]=new Float32Array(16*a[r].length)},e._setCacheAnimator=function(e){this._cacheAnimator=e,this._rootBone&&(this._rootIndex=e._avatarNodes.indexOf(e._avatarNodeMap[this._rootBone]))},e._setRootBone=function(e){this._rootBone=e,this._cacheAnimator&&(this._rootIndex=this._cacheAnimator._avatarNodes.indexOf(this._cacheAnimator._avatarNodeMap[e]))},e._setCacheAvatar=function(e){this._cacheAvatar!==e&&(this._cacheMesh?(this._cacheAvatar&&this._offComputeBoneIndexToMeshEvent(this._cacheAvatar,this._cacheMesh),(this._cacheAvatar=e)&&(this._addShaderDefine(ra.SHADERDEFINE_BONE),this._computeBoneIndexToMeshWithAsyncAvatar())):this._cacheAvatar=e)},e._calculateBoundingBox=function(){if(this._hasIndependentBound){if(this._cacheAnimator){var e=this._owner.transform,t=e.worldMatrix;if(this._cacheAnimator._canCache){var i=this._cacheAnimator._curAvatarNodeDatas;Li.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,i[this._rootIndex],t)}else Li.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,this._cacheAnimator._avatarNodeMap[this._rootBone].transform.getWorldMatrix(),t);e.worldMatrix=t,null==this._cacheAnimator._avatarNodeMap[this._rootBone]||null==this._localBoundBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(this._localBoundingBoxCorners)}}else n.prototype._calculateBoundingBox.call(this)},e._calculateBoundingSphere=function(){if(this._hasIndependentBound){if(this._cacheAnimator){var e=this._owner.transform,t=e.worldMatrix;if(this._cacheAnimator._canCache){var i=this._cacheAnimator._curAvatarNodeDatas;Li.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,i[this._rootIndex],t)}else Li.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,this._cacheAnimator._avatarNodeMap[this._rootBone].transform.getWorldMatrix(),t);e.worldMatrix=t,null==this._cacheAnimator._avatarNodeMap[this._rootBone]||null==this.localBoundSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(this.localBoundSphere)}}else n.prototype._calculateBoundingSphere.call(this)},e._updateOctreeNode=function(){var e=this._treeNode;e&&e.updateObject(this)},e._renderUpdate=function(e){var t,i=this._cacheAnimator,n=this._cacheMesh.subMeshCount,a=this._owner.transform;if(i){var r=i._canCache,s=this._cacheAnimator._curAvatarNodeDatas,o=i.owner;if(this._setShaderValueMatrix4x4(0,o._transform.worldMatrix),t=o.getProjectionViewWorldMatrix(e),this._setShaderValueMatrix4x4(1,t),this._cacheMesh&&this._cacheMesh.loaded&&this._cacheAvatar&&this._cacheAvatar.loaded){var l=0,h=0,c=this._cacheMesh._inverseBindPoses,u=this._cacheMesh._skinnedDatas;if(r)for(l=0,h=c.length;l<h;l++)Li._mulMatrixArray(s[this._cacheAnimationNodeIndex[l]],c[l],u,16*l);else for(l=0,h=c.length;l<h;l++)Li._mulMatrixArray(this._cacheAnimationNode[l].transform.getWorldMatrix(),c[l],u,16*l);for(l=0;l<n;l++){for(var d=this._cacheMesh.getSubMesh(l)._boneIndicesList,_=d.length,p=this._subSkinnedDatas[l],f=0;f<_;f++)m._splitAnimationDatas(d[f],u,p[f]);this._renderElements[l]._skinAnimationDatas=p}}}else this._setShaderValueMatrix4x4(0,a.worldMatrix),t=this._owner.getProjectionViewWorldMatrix(e),this._setShaderValueMatrix4x4(1,t);return Ii.debugMode&&this._renderRenderableBoundBox(),!0},v(0,e,"localBoundBox",function(){return this._localBoundBox},function(e){(this._localBoundBox=e).getCorners(this._localBoundingBoxCorners)}),v(0,e,"boundingSphere",function(){return this._calculateBoundingSphere(),this._boundingSphere}),v(0,e,"boundingBox",function(){return this._calculateBoundingBox(),this._boundingBox}),v(0,e,"boundingBoxCenter",function(){var e=this.boundingBox;return ai.add(e.min,e.max,this._boundingBoxCenter),ai.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenter}),m._splitAnimationDatas=function(e,t,i){for(var n=0,a=e.length,r=0;n<a;n++)for(var s=e[n]<<4,o=0;o<16;o++,r++)i[r]=t[s+o]},m}(pn),Qn=function(t){function i(e,t){i.__super.call(this),void 0===e&&(e=.3),void 0===t&&(t=1e3),this._tempVector3=new ai,this._position=new ai,this._up=new ai,this._forward=new ai,this._right=new ai,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=Ri.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=e,this._farPlane=t,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),x.stage.on("resize",this,this._onScreenSizeChanged)}f(i,"laya.d3.core.BaseCamera",t);var e=i.prototype;return e._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var e=this.scene._cameraPool,t=e.length-1,i=0;i<t;i++)if(e[i].renderingOrder>e[t].renderingOrder){var n=e[i];e[i]=e[t],e[t]=n}},e._calculateProjectionMatrix=function(){},e._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},e._prepareCameraToRender=function(){Y._currentCameraCullingMask=this.cullingMask;var e=this._shaderValues;e.setValue(0,this.transform.position.elements),e.setValue(5,this.forward.elements),e.setValue(6,this.up.elements)},e._prepareCameraViewProject=function(e,t){var i=this._shaderValues;i.setValue(1,e.elements),i.setValue(2,t.elements)},e._renderCamera=function(e,t,i){},e.addLayer=function(e){29!==e.number&&30!=e.number&&(this.cullingMask=this.cullingMask|e.mask)},e.removeLayer=function(e){29!==e.number&&30!=e.number&&(this.cullingMask=this.cullingMask&~e.mask)},e.addAllLayers=function(){this.cullingMask=2147483647},e.removeAllLayers=function(){this.cullingMask=0|Y.getLayerByNumber(29).mask|Y.getLayerByNumber(30).mask},e.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},e.moveForward=function(e){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=e,this.transform.translate(this._tempVector3)},e.moveRight=function(e){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=e,this.transform.translate(this._tempVector3)},e.moveVertical=function(e){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=e,this.transform.translate(this._tempVector3,!1)},e._addSelfRenderObjects=function(){var e=this.scene._cameraPool,t=e.length;if(0<t){for(var i=t-1;0<=i;i--)if(this.renderingOrder<=e[i].renderingOrder){e.splice(i+1,0,this);break}}else e.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},e._clearSelfRenderObjects=function(){var e=this.scene._cameraPool;e.splice(e.indexOf(this),1)},e.destroy=function(e){void 0===e&&(e=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,x.stage.off("resize",this,this._onScreenSizeChanged),t.prototype.destroy.call(this,e)},v(0,e,"sky",function(){return this._sky},function(e){(this._sky=e)._ownerCamera=this}),v(0,e,"forward",function(){var e=this.transform.worldMatrix.elements,t=this._forward.elements;return t[0]=-e[8],t[1]=-e[9],t[2]=-e[10],this._forward}),v(0,e,"position",function(){var e=this.transform.worldMatrix.elements,t=this._position.elements;return t[0]=e[12],t[1]=e[13],t[2]=e[14],this._position}),v(0,e,"renderTarget",function(){return this._renderTarget},function(e){null!=(this._renderTarget=e)&&(this._renderTargetSize=e.size)}),v(0,e,"up",function(){var e=this.transform.worldMatrix.elements,t=this._up.elements;return t[0]=e[4],t[1]=e[5],t[2]=e[6],this._up}),v(0,e,"right",function(){var e=this.transform.worldMatrix.elements,t=this._right.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],this._right}),v(0,e,"renderTargetSize",function(){return this._renderTargetSize},function(e){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=e,this._calculateProjectionMatrix()}),v(0,e,"fieldOfView",function(){return this._fieldOfView},function(e){this._fieldOfView=e,this._calculateProjectionMatrix()}),v(0,e,"nearPlane",function(){return this._nearPlane},function(e){this._nearPlane=e,this._calculateProjectionMatrix()}),v(0,e,"farPlane",function(){return this._farPlane},function(e){this._farPlane=e,this._calculateProjectionMatrix()}),v(0,e,"orthographic",function(){return this._orthographic},function(e){this._orthographic=e,this._calculateProjectionMatrix()}),v(0,e,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(e){this._orthographicVerticalSize=e,this._calculateProjectionMatrix()}),v(0,e,"renderingOrder",function(){return this._renderingOrder},function(e){this._renderingOrder=e,this._sortCamerasByRenderingOrder()}),i.CAMERAPOS=0,i.VIEWMATRIX=1,i.PROJECTMATRIX=2,i.VPMATRIX=3,i.VPMATRIX_NO_TRANSLATE=4,i.CAMERADIRECTION=5,i.CAMERAUP=6,i.ENVIRONMENTDIFFUSE=7,i.ENVIRONMENTSPECULAR=8,i.SIMLODINFO=9,i.DIFFUSEIRRADMATR=10,i.DIFFUSEIRRADMATG=11,i.DIFFUSEIRRADMATB=12,i.HDREXPOSURE=13,i.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",i.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",i.CLEARFLAG_SOLIDCOLOR=0,i.CLEARFLAG_SKY=1,i.CLEARFLAG_DEPTHONLY=2,i.CLEARFLAG_NONE=3,u(i,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new qt(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new qt},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new qt}]),i}(xn),$n=function(i){function t(e){this._render=null,this._geometryFilter=null,t.__super.call(this,e)}f(t,"laya.d3.core.RenderableSprite3D",i);var e=t.prototype;return e._addToInitStaticBatchManager=function(){},e._setBelongScene=function(e){i.prototype._setBelongScene.call(this,e),e._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},e._setUnBelongScene=function(){var e=this._scene._renderableSprite3Ds,t=e.indexOf(this);e.splice(t,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),i.prototype._setUnBelongScene.call(this)},e._update=function(e){(e.owner=this)._activeInHierarchy&&(this._updateComponents(e),this._render._updateOctreeNode(),this._lateUpdateComponents(e),w.spriteCount++,this._childs.length&&this._updateChilds(e))},e.destroy=function(e){void 0===e&&(e=!0),i.prototype.destroy.call(this,e),this._render._destroy(),this._render=null},t.__init__=function(){t.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=t.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),t.SAHDERDEFINE_LIGHTMAP=t.shaderDefines.registerDefine("LIGHTMAP")},t.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,t.SAHDERDEFINE_LIGHTMAP=4,t.LIGHTMAPSCALEOFFSET=2,t.LIGHTMAP=3,u(t,["shaderDefines",function(){return this.shaderDefines=new hi}]),t}(xn),Jn=function(){function t(){this._intensityColor=null,this._intensity=NaN,this._shadow=!1,this._shadowFarPlane=0,this._shadowMapSize=0,this._shadowMapCount=0,this._shadowMapPCFType=0,this._parallelSplitShadowMap=null,this._lightmapBakedType=0,this.color=null,t.__super.call(this),this._intensity=1,this._intensityColor=new ai,this.color=new ai(1,1,1),this._shadow=!1,this._shadowFarPlane=8,this._shadowMapSize=512,this._shadowMapCount=1,this._shadowMapPCFType=0,this._lightmapBakedType=t.LIGHTMAPBAKEDTYPE_REALTIME}f(t,"laya.d3.core.light.LightSprite",xn);var e=t.prototype;return e._parseCustomProps=function(e,t,i,n){var a=i.color,r=this.color.elements;r[0]=a[0],r[1]=a[1],r[2]=a[2]},e._addSelfRenderObjects=function(){this.lightmapBakedType!==t.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._addLight(this)},e._clearSelfRenderObjects=function(){this.lightmapBakedType!==t.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._removeLight(this)},e._prepareToScene=function(e){return!1},v(0,e,"lightmapBakedType",function(){return this._lightmapBakedType},function(e){this._lightmapBakedType!==e&&(this._lightmapBakedType=e,this._activeInHierarchy&&(e!==t.LIGHTMAPBAKEDTYPE_BAKED?this._scene._addLight(this):this._scene._removeLight(this)))}),v(0,e,"shadowPCFType",function(){return this._shadowMapPCFType},function(e){this._shadowMapPCFType=e,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setPCFType(e)}),v(0,e,"intensity",function(){return this._intensity},function(e){this._intensity=e}),v(0,e,"shadow",function(){return this._shadow},function(e){throw new Error("LightSprite: must override it.")}),v(0,e,"shadowDistance",function(){return this._shadowFarPlane},function(e){this._shadowFarPlane=e,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setFarDistance(e)}),v(0,e,"shadowPSSMCount",function(){return this._shadowMapCount},function(e){this._shadowMapCount=e,this._parallelSplitShadowMap&&(this._parallelSplitShadowMap.PSSMNum=e)}),v(0,e,"shadowResolution",function(){return this._shadowMapSize},function(e){this._shadowMapSize=e,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setShadowMapTextureSize(e)}),v(0,e,"diffuseColor",function(){return console.log("LightSprite: discard property,please use color property instead."),this.color},function(e){console.log("LightSprite: discard property,please use color property instead."),this.color=e}),t.LIGHTMAPBAKEDTYPE_REALTIME=0,t.LIGHTMAPBAKEDTYPE_MIXED=1,t.LIGHTMAPBAKEDTYPE_BAKED=2,t}(),ea=function(){function h(e){this._terrainRes=null,this._lightmapScaleOffset=null,h.__super.call(this),this._lightmapScaleOffset=new ri(1,1,0,0),e&&((this._terrainRes=e).loaded?this.buildTerrain(e):e.once("loaded",this,this.buildTerrain))}f(h,"laya.d3.terrain.Terrain",xn);var e=h.prototype;return e._parseCustomProps=function(e,t,i,n){this.terrainRes=Me.getRes(t[i.dataPath]);var a=i.lightmapIndex;null!=a&&this.setLightmapIndex(a);var r=i.lightmapScaleOffset;r&&this.setLightmapScaleOffset(new ri(r[0],r[1],r[2],r[3]))},e.setLightmapIndex=function(e){for(var t=0;t<this._childs.length;t++){this._childs[t].terrainRender.lightmapIndex=e}},e.setLightmapScaleOffset=function(e){if(e){e.cloneTo(this._lightmapScaleOffset);for(var t=0;t<this._childs.length;t++){this._childs[t].terrainRender.lightmapScaleOffset=this._lightmapScaleOffset}}},e.disableLight=function(){for(var e=0,t=this._childs.length;e<t;e++)for(var i=this._childs[e],n=0,a=i._render.sharedMaterials.length;n<a;n++){i._render.sharedMaterials[n].disableLight()}},e.buildTerrain=function(e){for(var t=e._chunkNumX,i=e._chunkNumZ,n=e._heightData,a=0,r=0;r<i;r++)for(var s=0;s<t;s++){for(var o=new oa(s,r,e._gridSize,n._terrainHeightData,n._width,n._height,e._cameraCoordinateInverse),l=e._chunkInfos[a++],h=0;h<l.alphaMap.length;h++){var c=l.detailID[h].length,u=0<c?e._detailTextureInfos[l.detailID[h][0]].diffuseTexture:null,d=1<c?e._detailTextureInfos[l.detailID[h][1]].diffuseTexture:null,_=2<c?e._detailTextureInfos[l.detailID[h][2]].diffuseTexture:null,p=3<c?e._detailTextureInfos[l.detailID[h][3]].diffuseTexture:null,f=0<c?e._detailTextureInfos[l.detailID[h][0]].scale:null,m=1<c?e._detailTextureInfos[l.detailID[h][1]].scale:null,g=2<c?e._detailTextureInfos[l.detailID[h][2]].scale:null,v=3<c?e._detailTextureInfos[l.detailID[h][3]].scale:null;o.buildRenderElementAndMaterial(c,l.normalMap,l.alphaMap[h],u,d,_,p,e._materialInfo.ambientColor,e._materialInfo.diffuseColor,e._materialInfo.specularColor,f?f.x:1,f?f.y:1,m?m.x:1,m?m.y:1,g?g.x:1,g?g.y:1,v?v.x:1,v?v.y:1)}o.terrainRender.receiveShadow=!0,o.terrainRender.lightmapScaleOffset=this._lightmapScaleOffset,this.addChild(o)}},e.width=function(){return this._terrainRes._chunkNumX*fi.CHUNK_GRID_NUM*this._terrainRes._gridSize},e.depth=function(){return this._terrainRes._chunkNumZ*fi.CHUNK_GRID_NUM*this._terrainRes._gridSize},e.getHeightXZ=function(e,t){if(!this._terrainRes||!this._terrainRes.loaded)return NaN;if(e-=this.transform.position.x,t-=this.transform.position.z,h.__VECTOR3__||(h.__VECTOR3__=new ai),h.__VECTOR3__.elements[0]=e,h.__VECTOR3__.elements[1]=0,h.__VECTOR3__.elements[2]=t,ai.transformV3ToV3(h.__VECTOR3__,fi.__ADAPT_MATRIX_INV__,h.__VECTOR3__),e=h.__VECTOR3__.elements[0],t=h.__VECTOR3__.elements[2],e<0||e>this.width()||t<0||t>this.depth())return NaN;var i=this._terrainRes._gridSize,n=parseInt(""+e/i),a=parseInt(""+t/i),r=e-n*i,s=t-a*i,o=NaN,l=this._terrainRes._heightData;return i<r+s?(o=l._terrainHeightData[(a+1-1)*l._width+n+1])+(l._terrainHeightData[(a+1-1)*l._width+n]-o)*((i-r)/i)+(l._terrainHeightData[(a-1)*l._width+n+1]-o)*((i-s)/i):(o=l._terrainHeightData[Math.max(0,a-1)*l._width+n])+(l._terrainHeightData[Math.min(l._width*l._height-1,(a+1-1)*l._width+n)]-o)*(s/i)+(l._terrainHeightData[Math.min(l._width*l._height-1,Math.max(0,a-1)*l._width+n+1)]-o)*(r/i)},v(0,e,"terrainRes",null,function(e){e&&((this._terrainRes=e).loaded?this.buildTerrain(e):e.once("loaded",this,this.buildTerrain))}),h.load=function(e){return x.loader.create(e,null,null,h,null,1,!1)},h.RENDER_LINE_MODEL=!1,h.LOD_TOLERANCE_VALUE=4,h.LOD_DISTANCE_FACTOR=2,h.__VECTOR3__=null,h}(),ta=(function(){function n(e,t,i){this._long=NaN,this._width=NaN,this._height=NaN,void 0===e&&(e=1),void 0===t&&(t=1),void 0===i&&(i=1),n.__super.call(this),this._long=e,this._width=t,this._height=i,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}f(n,"laya.d3.resource.models.BoxMesh",zn);var e=n.prototype;e.recreateResource=function(){this._numberVertices=24,this._numberIndices=36;var e=pt.vertexDeclaration,t=(e.vertexStride,this._long/2),i=this._height/2,n=this._width/2,a=new Float32Array([-t,i,-n,0,1,0,0,0,t,i,-n,0,1,0,1,0,t,i,n,0,1,0,1,1,-t,i,n,0,1,0,0,1,-t,-i,-n,0,-1,0,0,1,t,-i,-n,0,-1,0,1,1,t,-i,n,0,-1,0,1,0,-t,-i,n,0,-1,0,0,0,-t,i,-n,-1,0,0,0,0,-t,i,n,-1,0,0,1,0,-t,-i,n,-1,0,0,1,1,-t,-i,-n,-1,0,0,0,1,t,i,-n,1,0,0,1,0,t,i,n,1,0,0,0,0,t,-i,n,1,0,0,0,1,t,-i,-n,1,0,0,1,1,-t,i,n,0,0,1,0,0,t,i,n,0,0,1,1,0,t,-i,n,0,0,1,1,1,-t,-i,n,0,0,1,0,1,-t,i,-n,0,0,-1,1,0,t,i,-n,0,0,-1,0,0,t,-i,-n,0,0,-1,0,1,-t,-i,-n,0,0,-1,1,1]),r=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new On(e,this._numberVertices,35044,!0),this._indexBuffer=new Nn("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(a),this._indexBuffer.setData(r),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},v(0,e,"long",function(){return this._long},function(e){this._long!==e&&(this._long=e,this.releaseResource(),this.activeResource())}),v(0,e,"width",function(){return this._width},function(e){this._width!==e&&(this._width=e,this.releaseResource(),this.activeResource())}),v(0,e,"height",function(){return this._height},function(e){this._height!==e&&(this._height=e,this.releaseResource(),this.activeResource())})}(),function(){function a(e,t,i,n){this._radius=NaN,this._height=NaN,this._slices=0,void(this._stacks=0)===e&&(e=.5),void 0===t&&(t=2),void 0===i&&(i=16),void 0===n&&(n=32),a.__super.call(this),this._radius=e,this._height=t<2*e?2*e:t,this._stacks=i,this._slices=n,this.recreateResource(),this._positions=this._getPositions(),this._generateBoundingObject()}f(a,"laya.d3.resource.models.CapsuleMesh",zn);var e=a.prototype;e.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this.slices+1)*2+2*(this._slices+1),this._numberIndices=3*this._stacks*(this._slices+1)*2*2+2*this._slices*3;var e=pt.vertexDeclaration,t=e.vertexStride/4,i=new Float32Array(this._numberVertices*t),n=new Uint16Array(this._numberIndices),a=Math.PI/2/this._stacks,r=2*Math.PI/this._slices,s=this._height/2-this._radius,o=0,l=0,h=0,c=0,u=0,d=0,_=0,p=0;for(_=0;_<=this._stacks;_++)for(p=0;p<=this._slices;p++)o=this._radius*Math.cos(_*a)*Math.cos(p*r+Math.PI),l=this._radius*Math.sin(_*a),h=this._radius*Math.cos(_*a)*Math.sin(p*r+Math.PI),i[c++]=o,i[c++]=l+s,i[c++]=h,i[c++]=o,i[c++]=l,i[c++]=h,i[c++]=1-p/this._slices,i[c++]=(1-_/this._stacks)*(Math.PI*this._radius/2/(this._height+Math.PI*this._radius)),_<this._stacks&&(n[u++]=_*(this._slices+1)+p+(this._slices+1),n[u++]=_*(this._slices+1)+p,n[u++]=_*(this._slices+1)+p+1,n[u++]=_*(this._slices+1)+p+this._slices,n[u++]=_*(this._slices+1)+p,n[u++]=_*(this._slices+1)+p+(this._slices+1));for(d+=(this._stacks+1)*(this._slices+1),_=0;_<=this._stacks;_++)for(p=0;p<=this._slices;p++)o=this._radius*Math.cos(_*a)*Math.cos(p*r+Math.PI),l=this._radius*Math.sin(-_*a),h=this._radius*Math.cos(_*a)*Math.sin(p*r+Math.PI),i[c++]=o,i[c++]=l-s,i[c++]=h,i[c++]=o,i[c++]=l,i[c++]=h,i[c++]=1-p/this._slices,i[c++]=(_/this._stacks*(Math.PI*this._radius/2)+(this._height+Math.PI*this._radius/2))/(this._height+Math.PI*this._radius),_<this._stacks&&(n[u++]=d+_*(this._slices+1)+p,n[u++]=d+_*(this._slices+1)+p+(this._slices+1),n[u++]=d+_*(this._slices+1)+p+1,n[u++]=d+_*(this._slices+1)+p,n[u++]=d+_*(this._slices+1)+p+this._slices,n[u++]=d+_*(this._slices+1)+p+(this._slices+1));for(d+=(this._stacks+1)*(this._slices+1),p=0;p<=this._slices;p++)o=this._radius*Math.cos(p*r+Math.PI),l=s,h=this._radius*Math.sin(p*r+Math.PI),i[c++]=o,i[c+8*(this._slices+1)-1]=o,i[c++]=l,i[c+8*(this._slices+1)-1]=-l,i[c++]=h,i[c+8*(this._slices+1)-1]=h,i[c++]=o,i[c+8*(this._slices+1)-1]=o,i[c++]=0,i[c+8*(this._slices+1)-1]=0,i[c++]=h,i[c+8*(this._slices+1)-1]=h,i[c++]=1-1*p/this._slices,i[c+8*(this._slices+1)-1]=1-1*p/this._slices,i[c++]=Math.PI*this._radius/2/(this._height+Math.PI*this._radius),i[c+8*(this._slices+1)-1]=(Math.PI*this._radius/2+this._height)/(this._height+Math.PI*this._radius);for(p=0;p<this._slices;p++)n[u++]=p+d+(this._slices+1),n[u++]=p+d+1,n[u++]=p+d,n[u++]=p+d+(this._slices+1),n[u++]=p+d+(this._slices+1)+1,n[u++]=p+d+1;d+=2*(this._slices+1),this._vertexBuffer=new On(e,this._numberVertices,35044,!0),this._indexBuffer=new Nn("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(i),this._indexBuffer.setData(n),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},v(0,e,"radius",function(){return this._radius},function(e){this._radius!==e&&(this._radius=e,this.releaseResource(),this.activeResource())}),v(0,e,"height",function(){return this._height},function(e){this._height!==e&&(this._height=e,this.releaseResource(),this.activeResource())}),v(0,e,"stacks",function(){return this._stacks},function(e){this._stacks!==e&&(this._stacks=e,this.releaseResource(),this.activeResource())}),v(0,e,"slices",function(){return this._slices},function(e){this._slices!==e&&(this._slices=e,this.releaseResource(),this.activeResource())})}(),function(){function n(e,t,i){this._radius=NaN,this._height=NaN,void(this._slices=0)===e&&(e=.5),void 0===t&&(t=2),void 0===i&&(i=32),n.__super.call(this),this._radius=e,this._height=t,this._slices=i,this.recreateResource(),this._positions=this._getPositions(),this._generateBoundingObject()}f(n,"laya.d3.resource.models.CylinderMesh",zn);var e=n.prototype;e.recreateResource=function(){this._numberVertices=this._slices+1+1+2*(this._slices+1)+(this._slices+1+1),this._numberIndices=3*this._slices+6*this._slices+3*this._slices;for(var e=pt.vertexDeclaration,t=e.vertexStride/4,i=new Float32Array(this._numberVertices*t),n=new Uint16Array(this._numberIndices),a=2*Math.PI/this._slices,r=this._height/2,s=0,o=0,l=0,h=0,c=0,u=0,d=0,_=0;_<=this._slices;_++)0===_&&(i[u++]=0,i[u++]=r,i[u++]=0,i[u++]=0,i[u++]=1,i[u++]=0,i[u++]=.5,i[u++]=.5),s=_*a,l=Math.cos(s)*this._radius,h=r,c=Math.sin(s)*this._radius,i[u++]=l,i[u++]=h,i[u++]=c,i[u++]=0,i[u++]=1,i[u++]=0,i[u++]=.5+.5*Math.cos(s),i[u++]=.5+.5*Math.sin(s);for(var p=0;p<this._slices;p++)n[d++]=0,n[d++]=p+1,n[d++]=p+2;o+=this._slices+1+1;for(var f=0;f<=this._slices;f++)s=f*a,l=Math.cos(s+Math.PI)*this._radius,h=r,c=Math.sin(s+Math.PI)*this._radius,i[u++]=l,i[u+8*(this._slices+1)-1]=l,i[u++]=h,i[u+8*(this._slices+1)-1]=-h,i[u++]=c,i[u+8*(this._slices+1)-1]=c,i[u++]=l,i[u+8*(this._slices+1)-1]=l,i[u++]=0,i[u+8*(this._slices+1)-1]=0,i[u++]=c,i[u+8*(this._slices+1)-1]=c,i[u++]=1-1*f/this._slices,i[u+8*(this._slices+1)-1]=1-1*f/this._slices,i[u++]=0,i[u+8*(this._slices+1)-1]=1;u+=8*(this._slices+1);for(var m=0;m<this._slices;m++)n[d++]=m+o+(this._slices+1),n[d++]=m+o+1,n[d++]=m+o,n[d++]=m+o+(this._slices+1),n[d++]=m+o+(this._slices+1)+1,n[d++]=m+o+1;o+=2*(this._slices+1);for(var g=0;g<=this._slices;g++)0===g&&(i[u++]=0,i[u++]=-r,i[u++]=0,i[u++]=0,i[u++]=-1,i[u++]=0,i[u++]=.5,i[u++]=.5),s=g*a,l=Math.cos(s+Math.PI)*this._radius,h=-r,c=Math.sin(s+Math.PI)*this._radius,i[u++]=l,i[u++]=h,i[u++]=c,i[u++]=0,i[u++]=-1,i[u++]=0,i[u++]=.5+.5*Math.cos(s),i[u++]=.5+.5*Math.sin(s);for(var v=0;v<this._slices;v++)n[d++]=0+o,n[d++]=v+2+o,n[d++]=v+1+o;o+=this._slices+1+1,this._vertexBuffer=new On(e,this._numberVertices,35044,!0),this._indexBuffer=new Nn("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(i),this._indexBuffer.setData(n),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},v(0,e,"radius",function(){return this._radius},function(e){this._radius!==e&&(this._radius=e,this.releaseResource(),this.activeResource())}),v(0,e,"height",function(){return this._height},function(e){this._height!==e&&(this._height=e,this.releaseResource(),this.activeResource())}),v(0,e,"slices",function(){return this._slices},function(e){this._slices!==e&&(this._slices=e,this.releaseResource(),this.activeResource())})}(),function(){function a(e,t,i,n){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===e&&(e=10),void 0===t&&(t=10),void 0===i&&(i=10),void 0===n&&(n=10),a.__super.call(this),this._long=e,this._width=t,this._stacks=i,this._slices=n,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}f(a,"laya.d3.resource.models.PlaneMesh",zn);var e=a.prototype;e.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var e=new Uint16Array(this._numberIndices),t=pt.vertexDeclaration,i=t.vertexStride/4,n=new Float32Array(this._numberVertices*i),a=this._long/2,r=this._width/2,s=this._long/this._stacks,o=this._width/this._slices,l=0,h=0;h<=this._slices;h++)for(var c=0;c<=this._stacks;c++)n[l++]=c*s-a,n[l++]=0,n[l++]=h*o-r,n[l++]=0,n[l++]=1,n[l++]=0,n[l++]=1*c/this._stacks,n[l++]=1*h/this._slices;var u=0;for(h=0;h<this._slices;h++)for(c=0;c<this._stacks;c++)e[u++]=(h+1)*(this._stacks+1)+c,e[u++]=h*(this._stacks+1)+c,e[u++]=(h+1)*(this._stacks+1)+c+1,e[u++]=h*(this._stacks+1)+c,e[u++]=h*(this._stacks+1)+c+1,e[u++]=(h+1)*(this._stacks+1)+c+1;this._vertexBuffer=new On(t,this._numberVertices,35044,!0),this._indexBuffer=new Nn("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(e),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},v(0,e,"long",function(){return this._long},function(e){this._long!==e&&(this._long=e,this.releaseResource(),this.activeResource())}),v(0,e,"width",function(){return this._width},function(e){this._width!==e&&(this._width=e,this.releaseResource(),this.activeResource())}),v(0,e,"stacks",function(){return this._stacks},function(e){this._stacks!==e&&(this._stacks=e,this.releaseResource(),this.activeResource())}),v(0,e,"slices",function(){return this._slices},function(e){this._slices!==e&&(this._slices=e,this.releaseResource(),this.activeResource())})}(),function(){function i(e,t){this._long=NaN,this._width=NaN,void 0===e&&(e=1),void 0===t&&(t=1),i.__super.call(this),this._long=e,this._width=t,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}f(i,"laya.d3.resource.models.QuadMesh",zn);var e=i.prototype;e.recreateResource=function(){this._numberVertices=4,this._numberIndices=6;var e=pt.vertexDeclaration,t=(e.vertexStride,this._long/2),i=this._width/2,n=new Float32Array([-t,i,0,0,0,1,0,0,t,i,0,0,0,1,1,0,-t,-i,0,0,0,1,0,1,t,-i,0,0,0,1,1,1]),a=new Uint16Array([0,1,2,3,2,1]);this._vertexBuffer=new On(e,this._numberVertices,35044,!0),this._indexBuffer=new Nn("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(a),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},v(0,e,"long",function(){return this._long},function(e){this._long!==e&&(this._long=e,this.releaseResource(),this.activeResource())}),v(0,e,"width",function(){return this._width},function(e){this._width!==e&&(this._width=e,this.releaseResource(),this.activeResource())})}(),function(){function n(e,t,i){this._radius=NaN,this._slices=0,void(this._stacks=0)===e&&(e=.5),void 0===t&&(t=32),void 0===i&&(i=32),n.__super.call(this),this._radius=e,this._stacks=t,this._slices=i,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}f(n,"laya.d3.resource.models.SphereMesh",zn);var e=n.prototype;e.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=3*this._stacks*(this._slices+1)*2;for(var e=new Uint16Array(this._numberIndices),t=pt.vertexDeclaration,i=t.vertexStride/4,n=new Float32Array(this._numberVertices*i),a=Math.PI/this._stacks,r=2*Math.PI/this._slices,s=0,o=0,l=0,h=0;h<this._stacks+1;h++)for(var c=Math.sin(h*a),u=Math.cos(h*a),d=0;d<this._slices+1;d++){var _=c*Math.sin(d*r+1*Math.PI/2),p=c*Math.cos(d*r+1*Math.PI/2);n[o+0]=_*this._radius,n[o+1]=u*this._radius,n[o+2]=p*this._radius,n[o+3]=_,n[o+4]=u,n[o+5]=p,n[o+6]=d/this._slices,n[o+7]=h/this._stacks,o+=i,h!=this._stacks-1&&(e[l++]=s+(this._slices+1),e[l++]=s,e[l++]=s+1,e[l++]=s+this._slices,e[l++]=s,e[l++]=s+(this._slices+1),s++)}this._vertexBuffer=new On(t,this._numberVertices,35044,!0),this._indexBuffer=new Nn("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(e),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},v(0,e,"radius",function(){return this._radius},function(e){this._radius!==e&&(this._radius=e,this.releaseResource(),this.activeResource())}),v(0,e,"slices",function(){return this._slices},function(e){this._slices!==e&&(this._slices=e,this.releaseResource(),this.activeResource())}),v(0,e,"stacks",function(){return this._stacks},function(e){this._stacks!==e&&(this._stacks=e,this.releaseResource(),this.activeResource())})}(),function(){function s(e,t,i){void 0===e&&(e=0),void 0===t&&(t=.3),void 0===i&&(i=1e3),this._viewMatrix=new qt,this._projectionMatrix=new qt,this._projectionViewMatrix=new qt,this._viewport=new si(0,0,0,0),this._normalizedViewport=new si(0,0,1,1),this._aspectRatio=e,this._boundFrustumUpdate=!0,this._boundFrustum=new Ut(qt.DEFAULT),s.__super.call(this,t,i),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}f(s,"laya.d3.core.Camera",Qn);var e=s.prototype;return e._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},e._parseCustomProps=function(e,t,i,n){var a=i.clearColor;this.clearColor=new ri(a[0],a[1],a[2],a[3]);var r=i.viewport;this.normalizedViewport=new si(r[0],r[1],r[2],r[3])},e._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var e=this.orthographicVerticalSize*this.aspectRatio*.5,t=.5*this.orthographicVerticalSize;qt.createOrthoOffCenterRH(-e,e,-t,t,this.nearPlane,this.farPlane,this._projectionMatrix)}else qt.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},e._update=function(e){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,e)},e._renderCamera=function(e,t,i){var n,a;i.parallelSplitShadowMaps[0]&&i._renderShadowMap(e,t,this),(t.camera=this)._prepareCameraToRender(),i._preRenderUpdateComponents(t),n=t._viewMatrix=this.viewMatrix;var r=this._renderTarget;r?(r.start(),qt.multiply(Qn._invertYScaleMatrix,this._projectionMatrix,Qn._invertYProjectionMatrix),qt.multiply(Qn._invertYScaleMatrix,this.projectionViewMatrix,Qn._invertYProjectionViewMatrix),a=t._projectionMatrix=Qn._invertYProjectionMatrix,t._projectionViewMatrix=Qn._invertYProjectionViewMatrix):(a=t._projectionMatrix=this._projectionMatrix,t._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(n,a),t._viewport=this.viewport,i._preRenderScene(e,t,this.boundFrustum),i._clear(e,t),i._renderScene(e,t),i._postRenderUpdateComponents(t),r&&r.end()},e.viewportPointToRay=function(e,t){Ti.calculateCursorRay(e,this.viewport,this._projectionMatrix,this.viewMatrix,null,t)},e.normalizedViewportPointToRay=function(e,t){var i=s._tempVector20,n=this.viewport,a=e.elements,r=i.elements;r[0]=a[0]*n.width,r[1]=a[1]*n.height,Ti.calculateCursorRay(i,this.viewport,this._projectionMatrix,this.viewMatrix,null,t)},e.worldToViewportPoint=function(e,t){qt.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(e,this._projectionViewMatrix,t);var i=t.elements;i[0]=i[0]/x.stage.clientScaleX,i[1]=i[1]/x.stage.clientScaleY},e.worldToNormalizedViewportPoint=function(e,t){qt.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(e,this._projectionViewMatrix,t);var i=t.elements;i[0]=i[0]/x.stage.clientScaleX,i[1]=i[1]/x.stage.clientScaleY},e.convertScreenCoordToOrthographicCoord=function(e,t){if(this._orthographic){var i=se.clientWidth,n=se.clientHeight,a=this.orthographicVerticalSize*this.aspectRatio/i,r=this.orthographicVerticalSize/n,s=e.elements,o=t.elements;return o[0]=(-i/2+s[0])*a,o[1]=(n/2-s[1])*r,o[2]=(this.nearPlane-this.farPlane)*(s[2]+1)/2-this.nearPlane,ai.transformCoordinate(t,this.transform.worldMatrix,t),!0}return!1},v(0,e,"projectionViewMatrix",function(){return qt.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),v(0,e,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var e=this.viewport;return e.width/e.height},function(e){if(e<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=e,this._calculateProjectionMatrix()}),v(0,e,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),v(0,e,"needViewport",function(){var e=this.normalizedViewport;return 0===e.x&&0===e.y&&1===e.width&&1===e.height}),v(0,e,"viewport",function(){if(this._viewportExpressedInClipSpace){var e=this._normalizedViewport,t=this.renderTargetSize,i=t.width,n=t.height;this._viewport.x=e.x*i,this._viewport.y=e.y*n,this._viewport.width=e.width*i,this._viewport.height=e.height*n}return this._viewport},function(e){if(null!=this.renderTarget&&(e.x<0||e.y<0||0==e.width||0==e.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=e,this._calculateProjectionMatrix()}),v(0,e,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var e=this._viewport,t=this.renderTargetSize,i=t.width,n=t.height;this._normalizedViewport.x=e.x/i,this._normalizedViewport.y=e.y/n,this._normalizedViewport.width=e.width/i,this._normalizedViewport.height=e.height/n}return this._normalizedViewport},function(e){e.x<0&&(e.x=0,console.warn("Camera: viewport.x must large than 0.0.")),e.y<0&&(e.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<e.x+e.width&&(e.width=1-e.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<e.y+e.height&&(e.height=1-e.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=e,this._calculateProjectionMatrix()}),v(0,e,"projectionMatrix",function(){return this._projectionMatrix},function(e){this._projectionMatrix=e,this._useUserProjectionMatrix=!0}),v(0,e,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),u(s,["_tempVector20",function(){return this._tempVector20=new ni}]),s}()),ia=(function(t){function i(){i.__super.call(this),this._render=new dn(this),this._render.on("materialchanged",this,this._onMaterialChanged);var e=new bn;this._render.sharedMaterial=e,this._geometryFilter=new yn(this),e.renderMode=8,this._changeRenderObject(0)}f(i,"laya.d3.core.glitter.Glitter",t);var e=i.prototype;e._changeRenderObject=function(e){var t=this._render._renderElements,i=t[e];(i=i||(t[e]=new ae))._render=this._render;var n=this._render.sharedMaterials[e];n=n||bn.defaultMaterial;var a=this._geometryFilter;return i._mainSortID=0,i._sprite3D=this,i.renderObj=a,i._material=n,i},e._onMaterialChanged=function(e,t,i){t<e._renderElements.length&&this._changeRenderObject(t)},e._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},e._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},e._update=function(e){this._geometryFilter._update(e.elapsedTime),t.prototype._update.call(this,e)},e.addGlitterByPositions=function(e,t){this._geometryFilter.addVertexPosition(e,t)},e.addGlitterByPositionsVelocitys=function(e,t,i,n){this._geometryFilter.addVertexPositionVelocity(e,t,i,n)},e.cloneTo=function(e){var t=e,i=t.templet,n=this._geometryFilter;i.lifeTime=n.lifeTime,i.minSegmentDistance=n.minSegmentDistance,i.minInterpDistance=n.minInterpDistance,i.maxSlerpCount=n.maxSlerpCount,i._maxSegments=n._maxSegments;var a=t._render,r=this._render;a.sharedMaterials=r.sharedMaterials,a.enable=r.enable,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,e)},e.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._geometryFilter._destroy(),this._geometryFilter=null)},v(0,e,"templet",function(){return this._geometryFilter}),v(0,e,"glitterRender",function(){return this._render}),i.CURRENTTIME=2,i.DURATION=3}($n),function(e){function t(){this._direction=null,this._updateDirection=!1,t.__super.call(this),this._updateDirection=!1,this._direction=new ai,this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChange)}f(t,"laya.d3.core.light.DirectionLight",e);var i=t.prototype;return i._initShadow=function(){if(this._shadow)this._parallelSplitShadowMap=new pi,this.scene.parallelSplitShadowMaps.push(this._parallelSplitShadowMap),this.transform.worldMatrix.getForward(this._direction),ai.normalize(this._direction,this._direction),this._parallelSplitShadowMap.setInfo(this.scene,this._shadowFarPlane,this._direction,this._shadowMapSize,this._shadowMapCount,this._shadowMapPCFType);else{var e=this.scene.parallelSplitShadowMaps;e.splice(e.indexOf(this._parallelSplitShadowMap),1),this._parallelSplitShadowMap.disposeAllRenderTarget(),this._parallelSplitShadowMap=null,this.scene.removeShaderDefine(pi.SHADERDEFINE_SHADOW_PSSM1),this.scene.removeShaderDefine(pi.SHADERDEFINE_SHADOW_PSSM2),this.scene.removeShaderDefine(pi.SHADERDEFINE_SHADOW_PSSM3)}},i._addSelfRenderObjects=function(){e.prototype._addSelfRenderObjects.call(this),this._shadow&&this._initShadow()},i._clearSelfRenderObjects=function(){var e=this.scene,t=e._shaderValues;t.setValue(4,null),t.setValue(3,null),e.removeShaderDefine(Yi.SHADERDEFINE_DIRECTIONLIGHT)},i._prepareToScene=function(e){var t=e.scene;if(t.enableLight&&this._activeInHierarchy){var i=t._shaderValues;return t.addShaderDefine(Yi.SHADERDEFINE_DIRECTIONLIGHT),ai.scale(this.color,this._intensity,this._intensityColor),i.setValue(4,this._intensityColor.elements),this.transform.worldMatrix.getForward(this._direction),ai.normalize(this._direction,this._direction),i.setValue(3,this._direction.elements),!0}return t.removeShaderDefine(Yi.SHADERDEFINE_DIRECTIONLIGHT),!1},i._onWorldMatrixChange=function(){this._updateDirection=!0},v(0,i,"shadow",e.prototype._$get_shadow,function(e){this._shadow!==e&&(this._shadow=e,this.scene&&this._initShadow())}),v(0,i,"direction",function(){return console.log("Warning: discard property,please use transform's property instead."),this._updateDirection&&(this.transform.worldMatrix.getForward(this._direction),ai.normalize(this._direction,this._direction),this._updateDirection=!1),this._direction},function(e){console.log("Warning: discard property,please use transform's property instead.");var t=this.transform.worldMatrix;t.setForward(e),this.transform.worldMatrix=t,ai.normalize(e,e),this._direction=e,this.shadow&&this._parallelSplitShadowMap&&this._parallelSplitShadowMap._setGlobalParallelLightDir(this._direction)}),t}(Jn)),na=(function(){function e(){this._range=NaN,this._attenuation=null,e.__super.call(this),this._range=6,this._attenuation=new ai(.6,.6,.6)}f(e,"laya.d3.core.light.PointLight",Jn);var t=e.prototype;t._clearSelfRenderObjects=function(){var e=this.scene,t=e._shaderValues;t.setValue(8,null),t.setValue(5,null),t.setValue(6,null),t.setValue(7,null),e.removeShaderDefine(Yi.SHADERDEFINE_POINTLIGHT)},t._prepareToScene=function(e){var t=e.scene;if(t.enableLight&&this._activeInHierarchy){var i=t._shaderValues;return t.addShaderDefine(Yi.SHADERDEFINE_POINTLIGHT),ai.scale(this.color,this._intensity,this._intensityColor),i.setValue(8,this._intensityColor.elements),i.setValue(5,this.transform.position.elements),i.setValue(6,this.range),i.setValue(7,this.attenuation.elements),!0}return t.removeShaderDefine(Yi.SHADERDEFINE_POINTLIGHT),!1},v(0,t,"range",function(){return this._range},function(e){this._range=e}),v(0,t,"attenuation",function(){return this._attenuation},function(e){this._attenuation=e})}(),function(){function e(){this._updateDirection=!1,this._direction=null,this._spot=NaN,this._range=NaN,this._attenuation=null,e.__super.call(this),this._updateDirection=!1,this.direction=new ai(0,-1,-1),this._attenuation=new ai(.6,.6,.6),this._spot=96,this._range=6,this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChange)}f(e,"laya.d3.core.light.SpotLight",Jn);var t=e.prototype;t._onWorldMatrixChange=function(){this._updateDirection=!0},t._clearSelfRenderObjects=function(){var e=this.scene,t=e._shaderValues;t.setValue(14,null),t.setValue(9,null),t.setValue(10,null),t.setValue(12,null),t.setValue(11,null),t.setValue(13,null),e.removeShaderDefine(Yi.SHADERDEFINE_SPOTLIGHT)},t._prepareToScene=function(e){var t=e.scene;if(t.enableLight&&this._activeInHierarchy){var i=t._shaderValues;return t.addShaderDefine(Yi.SHADERDEFINE_SPOTLIGHT),ai.scale(this.color,this._intensity,this._intensityColor),i.setValue(14,this._intensityColor.elements),i.setValue(9,this.transform.position.elements),this.transform.worldMatrix.getForward(this._direction),ai.normalize(this._direction,this._direction),i.setValue(10,this._direction.elements),i.setValue(12,this.range),i.setValue(11,this.spot),i.setValue(13,this.attenuation.elements),!0}return t.removeShaderDefine(Yi.SHADERDEFINE_SPOTLIGHT),!1},v(0,t,"spot",function(){return this._spot},function(e){this._spot=e}),v(0,t,"direction",function(){return console.log("Warning: discard property,please use transform's property instead."),this._updateDirection&&(this.transform.worldMatrix.getForward(this._direction),this._updateDirection=!1),this._direction},function(e){console.log("Warning: discard property,please use transform's property instead.");var t=this.transform.worldMatrix;t.setForward(e),this.transform.worldMatrix=t,this._direction=e}),v(0,t,"range",function(){return this._range},function(e){this._range=e}),v(0,t,"attenuation",function(){return this._attenuation},function(e){this._attenuation=e})}(),function(i){function n(e,t){n.__super.call(this,t),this._geometryFilter=new _n(this),this._render=new pn(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),e&&(this._geometryFilter.sharedMesh=e)instanceof laya.d3.resource.models.Mesh&&(e.loaded?this._render.sharedMaterials=e.materials:e.once("loaded",this,this._applyMeshMaterials))}f(n,"laya.d3.core.MeshSprite3D",i);var e=n.prototype;return e._changeRenderObjectByMesh=function(e){var t=this._render._renderElements,i=t[e];(i=i||(t[e]=new Xi))._render=this._render;var n=this._render.sharedMaterials[e];n=n||In.defaultMaterial;var a=this._geometryFilter.sharedMesh.getRenderElement(e);return i._mainSortID=this._getSortID(a,n),i._sprite3D=this,i.renderObj=a,i._material=n,i},e._changeRenderObjectByMaterial=function(e,t){var i=this._render._renderElements[e];t=t||In.defaultMaterial;var n=this._geometryFilter.sharedMesh.getRenderElement(e);return i._mainSortID=this._getSortID(n,t),i._sprite3D=this,i.renderObj=n,i._material=t,i},e._changeRenderObjectsByMesh=function(){var e=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=e;for(var t=0;t<e;t++)this._changeRenderObjectByMesh(t)},e._onMeshChanged=function(e){var t=e.sharedMesh;t.loaded?this._changeRenderObjectsByMesh():t.once("loaded",this,this._onMeshLoaded)},e._onMeshLoaded=function(e){e===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},e._onMaterialChanged=function(e,t,i){t<this._render._renderElements.length&&this._changeRenderObjectByMaterial(t,i)},e._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},e._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},e._parseCustomProps=function(e,t,i,n){var a=this.meshRender,r=i.lightmapIndex;null!=r&&(a.lightmapIndex=r);var s,o,l=i.lightmapScaleOffset;if(l&&(a.lightmapScaleOffset=new ri(l[0],l[1],l[2],l[3])),n.instanceParams)(s=n.instanceParams.loadPath)&&(o=Me.getRes(t[s]),(this.meshFilter.sharedMesh=o).loaded?a.sharedMaterials=o.materials:o.once("loaded",this,this._applyMeshMaterials));else{(s=i.meshPath)&&(o=Me.getRes(t[s]),this.meshFilter.sharedMesh=o);var h=i.materials;if(h){var c=a.sharedMaterials,u=h.length;c.length=u;for(var d=0;d<u;d++)c[d]=Me.getRes(t[h[d].path]);a.sharedMaterials=c}}},e._applyMeshMaterials=function(e){for(var t=this._render.sharedMaterials,i=e.materials,n=0,a=i.length;n<a;n++)t[n]||(t[n]=i[n]);this._render.sharedMaterials=t},e._addToInitStaticBatchManager=function(){n._staticBatchManager._addInitBatchSprite(this)},e.cloneTo=function(e){var t=e;t._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var i=this._render,n=t._render;n.enable=i.enable,n.sharedMaterials=i.sharedMaterials,n.castShadow=i.castShadow;var a=i.lightmapScaleOffset;a&&(n.lightmapScaleOffset=a.clone()),n.lightmapIndex=i.lightmapIndex,n.receiveShadow=i.receiveShadow,n.sortingFudge=i.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,e)},e.destroy=function(e){if(void 0===e&&(e=!0),!this.destroyed){var t=this.meshFilter.sharedMesh;t.loaded||t.off("loaded",this,this._applyMeshMaterials),i.prototype.destroy.call(this,e),this._geometryFilter._destroy()}},v(0,e,"meshFilter",function(){return this._geometryFilter}),v(0,e,"meshRender",function(){return this._render}),n.__init__=function(){we._staticBatchManagers.push(n._staticBatchManager)},n.load=function(e){return x.loader.create(e,null,null,n)},u(n,["_staticBatchManager",function(){return this._staticBatchManager=new Ki}]),n}($n)),aa=function(t){function we(e){we.__super.call(this),this._render=new mn(this),this._render.on("materialchanged",this,this._onMaterialChanged),this._geometryFilter=new fn(this),this._createRenderElement(0),e&&(this._render.sharedMaterial=e)}f(we,"laya.d3.core.particleShuriKen.ShuriKenParticle3D",t);var e=we.prototype;return e._initParticleVelocity=function(e){for(var t=new Q,i=e.velocitys,n=0,a=i.length;n<a;n++){var r=i[n];t.add(r.key,r.value)}return t},e._initParticleColor=function(e){var t=new K,i=e.alphas,n=0,a=0;for(n=0,a=i.length;n<a;n++){var r=i[n];t.addAlpha(r.key,r.value)}var s=e.rgbs;for(n=0,a=s.length;n<a;n++){var o=s[n],l=o.value;t.addRGB(o.key,new ai(l[0],l[1],l[2]))}return t},e._initParticleSize=function(e){for(var t=new Q,i=e.sizes,n=0,a=i.length;n<a;n++){var r=i[n];t.add(r.key,r.value)}return t},e._initParticleRotation=function(e){for(var t=new Q,i=e.angularVelocitys,n=0,a=i.length;n<a;n++){var r=i[n];t.add(r.key,r.value/180*Math.PI)}return t},e._initParticleFrame=function(e){for(var t=new Z,i=e.frames,n=0,a=i.length;n<a;n++){var r=i[n];t.add(r.key,r.value)}return t},e._createRenderElement=function(e){var t=this._render._renderElements[e]=new ae;t._render=this._render;var i=this._render.sharedMaterials[e];i=i||kn.defaultMaterial;var n=this._geometryFilter;t._mainSortID=0,t._sprite3D=this,t.renderObj=n,t._material=i},e._onMaterialChanged=function(e,t,i){var n=e._renderElements;t<n.length&&(n[t]._material=i||kn.defaultMaterial)},e._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},e._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},e._parseCustomProps=function(e,t,i,n){var a,r=Math.PI/180,s=0,o=0,l=this.particleRender,h=i.material;if(h)a=Me.getRes(t[h.path]);else{var c=i.materialPath;c?a=Me.getRes(t[c]):(a=new kn).diffuseTexture=t?Me.getRes(t[i.texturePath]):Kn.load(i.texturePath)}l.sharedMaterial=a;var u=i.meshPath;u&&(l.mesh=Me.getRes(t[u])),l.renderMode=i.renderMode,l.stretchedBillboardCameraSpeedScale=i.stretchedBillboardCameraSpeedScale,l.stretchedBillboardSpeedScale=i.stretchedBillboardSpeedScale,l.stretchedBillboardLengthScale=i.stretchedBillboardLengthScale,l.sortingFudge=i.sortingFudge?i.sortingFudge:0;var d=this.particleSystem;d.isPerformanceMode=i.isPerformanceMode,d.duration=i.duration,d.looping=i.looping,d.prewarm=i.prewarm,d.startDelayType=i.startDelayType,d.startDelay=i.startDelay,d.startDelayMin=i.startDelayMin,d.startDelayMax=i.startDelayMax,d.startLifetimeType=i.startLifetimeType,d.startLifetimeConstant=i.startLifetimeConstant,d.startLifeTimeGradient=we._initStartLife(i.startLifetimeGradient),d.startLifetimeConstantMin=i.startLifetimeConstantMin,d.startLifetimeConstantMax=i.startLifetimeConstantMax,d.startLifeTimeGradientMin=we._initStartLife(i.startLifetimeGradientMin),d.startLifeTimeGradientMax=we._initStartLife(i.startLifetimeGradientMax),d.startSpeedType=i.startSpeedType,d.startSpeedConstant=i.startSpeedConstant,d.startSpeedConstantMin=i.startSpeedConstantMin,d.startSpeedConstantMax=i.startSpeedConstantMax,d.threeDStartSize=i.threeDStartSize,d.startSizeType=i.startSizeType,d.startSizeConstant=i.startSizeConstant;var _=i.startSizeConstantSeparate,p=d.startSizeConstantSeparate.elements;p[0]=_[0],p[1]=_[1],p[2]=_[2],d.startSizeConstantMin=i.startSizeConstantMin,d.startSizeConstantMax=i.startSizeConstantMax;var f=i.startSizeConstantMinSeparate,m=d.startSizeConstantMinSeparate.elements;m[0]=f[0],m[1]=f[1],m[2]=f[2];var g=i.startSizeConstantMaxSeparate,v=d.startSizeConstantMaxSeparate.elements;v[0]=g[0],v[1]=g[1],v[2]=g[2],d.threeDStartRotation=i.threeDStartRotation,d.startRotationType=i.startRotationType,d.startRotationConstant=i.startRotationConstant*r;var y=i.startRotationConstantSeparate,C=d.startRotationConstantSeparate.elements;C[0]=y[0]*r,C[1]=y[1]*r,C[2]=y[2]*r,d.startRotationConstantMin=i.startRotationConstantMin*r,d.startRotationConstantMax=i.startRotationConstantMax*r;var E=i.startRotationConstantMinSeparate,S=d.startRotationConstantMinSeparate.elements;S[0]=E[0]*r,S[1]=E[1]*r,S[2]=E[2]*r;var x=i.startRotationConstantMaxSeparate,T=d.startRotationConstantMaxSeparate.elements;T[0]=x[0]*r,T[1]=x[1]*r,T[2]=x[2]*r,d.randomizeRotationDirection=i.randomizeRotationDirection,d.startColorType=i.startColorType;var w=i.startColorConstant,M=d.startColorConstant.elements;M[0]=w[0],M[1]=w[1],M[2]=w[2],M[3]=w[3];var b=i.startColorConstantMin,R=d.startColorConstantMin.elements;R[0]=b[0],R[1]=b[1],R[2]=b[2],R[3]=b[3];var L=i.startColorConstantMax,A=d.startColorConstantMax.elements;A[0]=L[0],A[1]=L[1],A[2]=L[2],A[3]=L[3],d.gravityModifier=i.gravityModifier,d.simulationSpace=i.simulationSpace,d.scaleMode=i.scaleMode,d.playOnAwake=i.playOnAwake,d.maxParticles=i.maxParticles;var I=i.autoRandomSeed;null!=I&&(d.autoRandomSeed=I);var D=i.randomSeed;null!=D&&(d.randomSeed[0]=D);var P=i.emission,N=d.emission;if(P){N.emissionRate=P.emissionRate;var O=P.bursts;if(O)for(s=0,o=O.length;s<o;s++){var k=O[s];N.addBurst(new be(k.time,k.min,k.max))}N.enbale=P.enable}else N.enbale=!1;var V=i.shape;if(V){var B;switch(V.shapeType){case 0:var F;B=F=new Wi,F.radius=V.sphereRadius,F.emitFromShell=V.sphereEmitFromShell,F.randomDirection=V.sphereRandomDirection;break;case 1:var H;B=H=new zi,H.radius=V.hemiSphereRadius,H.emitFromShell=V.hemiSphereEmitFromShell,H.randomDirection=V.hemiSphereRandomDirection;break;case 2:var U;B=U=new Gi,U.angle=V.coneAngle*r,U.radius=V.coneRadius,U.length=V.coneLength,U.emitType=V.coneEmitType,U.randomDirection=V.coneRandomDirection;break;case 3:var G;B=G=new Hi,G.x=V.boxX,G.y=V.boxY,G.z=V.boxZ,G.randomDirection=V.boxRandomDirection;break;case 7:var z;B=z=new Ui,z.radius=V.circleRadius,z.arc=V.circleArc*r,z.emitFromEdge=V.circleEmitFromEdge,z.randomDirection=V.circleRandomDirection;break;default:var W;B=W=new Ui,W.radius=V.circleRadius,W.arc=V.circleArc*r,W.emitFromEdge=V.circleEmitFromEdge,W.randomDirection=V.circleRandomDirection}B.enable=V.enable,d.shape=B}var X=i.velocityOverLifetime;if(X){var j,Y=X.velocity;switch(Y.type){case 0:var K=Y.constant;j=Pe.createByConstant(new ai(K[0],K[1],K[2]));break;case 1:j=Pe.createByGradient(this._initParticleVelocity(Y.gradientX),this._initParticleVelocity(Y.gradientY),this._initParticleVelocity(Y.gradientZ));break;case 2:var q=Y.constantMin,Z=Y.constantMax;j=Pe.createByRandomTwoConstant(new ai(q[0],q[1],q[2]),new ai(Z[0],Z[1],Z[2]));break;case 3:j=Pe.createByRandomTwoGradient(this._initParticleVelocity(Y.gradientXMin),this._initParticleVelocity(Y.gradientXMax),this._initParticleVelocity(Y.gradientYMin),this._initParticleVelocity(Y.gradientYMax),this._initParticleVelocity(Y.gradientZMin),this._initParticleVelocity(Y.gradientZMax))}var Q=new Be(j);Q.space=X.space,Q.enbale=X.enable,d.velocityOverLifetime=Q}var $=i.colorOverLifetime;if($){var J,ee=$.color;switch(ee.type){case 0:var te=ee.constant;J=Ie.createByConstant(new ri(te[0],te[1],te[2],te[3]));break;case 1:J=Ie.createByGradient(this._initParticleColor(ee.gradient));break;case 2:var ie=ee.constantMin,ne=ee.constantMax;J=Ie.createByRandomTwoConstant(new ri(ie[0],ie[1],ie[2],ie[3]),new ri(ne[0],ne[1],ne[2],ne[3]));break;case 3:J=Ie.createByRandomTwoGradient(this._initParticleColor(ee.gradientMin),this._initParticleColor(ee.gradientMax))}var ae=new Re(J);ae.enbale=$.enable,d.colorOverLifetime=ae}var re=i.sizeOverLifetime;if(re){var se,oe=re.size;switch(oe.type){case 0:se=oe.separateAxes?De.createByGradientSeparate(this._initParticleSize(oe.gradientX),this._initParticleSize(oe.gradientY),this._initParticleSize(oe.gradientZ)):De.createByGradient(this._initParticleSize(oe.gradient));break;case 1:if(oe.separateAxes){var le=oe.constantMinSeparate,he=oe.constantMaxSeparate;se=De.createByRandomTwoConstantSeparate(new ai(le[0],le[1],le[2]),new ai(he[0],he[1],he[2]))}else se=De.createByRandomTwoConstant(oe.constantMin,oe.constantMax);break;case 2:se=oe.separateAxes?De.createByRandomTwoGradientSeparate(this._initParticleSize(oe.gradientXMin),this._initParticleSize(oe.gradientYMin),this._initParticleSize(oe.gradientZMin),this._initParticleSize(oe.gradientXMax),this._initParticleSize(oe.gradientYMax),this._initParticleSize(oe.gradientZMax)):De.createByRandomTwoGradient(this._initParticleSize(oe.gradientMin),this._initParticleSize(oe.gradientMax))}var ce=new Oe(se);ce.enbale=re.enable,d.sizeOverLifetime=ce}var ue=i.rotationOverLifetime;if(ue){var de,_e=ue.angularVelocity;switch(_e.type){case 0:_e.separateAxes||(de=Ae.createByConstant(_e.constant*r));break;case 1:_e.separateAxes||(de=Ae.createByGradient(this._initParticleRotation(_e.gradient)));break;case 2:if(_e.separateAxes){var pe=_e.constantMinSeparate,fe=_e.constantMaxSeparate;de=Ae.createByRandomTwoConstantSeparate(new ai(pe[0]*r,pe[1]*r,pe[2]*r),new ai(fe[0]*r,fe[1]*r,fe[2]*r))}else de=Ae.createByRandomTwoConstant(_e.constantMin*r,_e.constantMax*r);break;case 3:_e.separateAxes||(de=Ae.createByRandomTwoGradient(this._initParticleRotation(_e.gradientMin),this._initParticleRotation(_e.gradientMax)))}var me=new Ne(de);me.enbale=ue.enable,d.rotationOverLifetime=me}var ge=i.textureSheetAnimation;if(ge){var ve,ye=ge.frame;switch(ye.type){case 0:ve=Le.createByConstant(ye.constant);break;case 1:ve=Le.createByOverTime(this._initParticleFrame(ye.overTime));break;case 2:ve=Le.createByRandomTwoConstant(ye.constantMin,ye.constantMax);break;case 3:ve=Le.createByRandomTwoOverTime(this._initParticleFrame(ye.overTimeMin),this._initParticleFrame(ye.overTimeMax))}var Ce,Ee=ge.startFrame;switch(Ee.type){case 0:Ce=ke.createByConstant(Ee.constant);break;case 1:Ce=ke.createByRandomTwoConstant(Ee.constantMin,Ee.constantMax)}var Se=new Ve(ve,Ce);Se.enable=ge.enable;var xe=ge.tiles;Se.tiles=new ni(xe[0],xe[1]),Se.type=ge.type,Se.randomRow=ge.randomRow;var Te=ge.rowIndex;void 0!==Te&&(Se.rowIndex=Te),Se.cycles=ge.cycles,d.textureSheetAnimation=Se}},e._activeHierarchy=function(){laya.d3.core.Sprite3D.prototype._activeHierarchy.call(this),this.particleSystem.playOnAwake&&this.particleSystem.play()},e._inActiveHierarchy=function(){laya.d3.core.Sprite3D.prototype._inActiveHierarchy.call(this),this.particleSystem.isAlive&&this.particleSystem.simulate(0,!0)},e.cloneTo=function(e){var t=e,i=t._geometryFilter;this._geometryFilter.cloneTo(i);var n=t._render,a=this._render;n.sharedMaterials=a.sharedMaterials,n.enable=a.enable,n.renderMode=a.renderMode,n.mesh=a.mesh,n.stretchedBillboardCameraSpeedScale=a.stretchedBillboardCameraSpeedScale,n.stretchedBillboardSpeedScale=a.stretchedBillboardSpeedScale,n.stretchedBillboardLengthScale=a.stretchedBillboardLengthScale,n.sortingFudge=a.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,e)},e.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._geometryFilter._destroy(),this._geometryFilter=null)},v(0,e,"particleSystem",function(){return this._geometryFilter}),v(0,e,"particleRender",function(){return this._render}),we.__init__=function(){we.SHADERDEFINE_RENDERMODE_BILLBOARD=we.shaderDefines.registerDefine("SPHERHBILLBOARD"),we.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=we.shaderDefines.registerDefine("STRETCHEDBILLBOARD"),we.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=we.shaderDefines.registerDefine("HORIZONTALBILLBOARD"),we.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=we.shaderDefines.registerDefine("VERTICALBILLBOARD"),we.SHADERDEFINE_COLOROVERLIFETIME=we.shaderDefines.registerDefine("COLOROVERLIFETIME"),we.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=we.shaderDefines.registerDefine("RANDOMCOLOROVERLIFETIME"),we.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=we.shaderDefines.registerDefine("VELOCITYOVERLIFETIMECONSTANT"),we.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=we.shaderDefines.registerDefine("VELOCITYOVERLIFETIMECURVE"),we.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=we.shaderDefines.registerDefine("VELOCITYOVERLIFETIMERANDOMCONSTANT"),we.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=we.shaderDefines.registerDefine("VELOCITYOVERLIFETIMERANDOMCURVE"),we.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=we.shaderDefines.registerDefine("TEXTURESHEETANIMATIONCURVE"),we.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=we.shaderDefines.registerDefine("TEXTURESHEETANIMATIONRANDOMCURVE"),we.SHADERDEFINE_ROTATIONOVERLIFETIME=we.shaderDefines.registerDefine("ROTATIONOVERLIFETIME"),we.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=we.shaderDefines.registerDefine("ROTATIONOVERLIFETIMESEPERATE"),we.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=we.shaderDefines.registerDefine("ROTATIONOVERLIFETIMECONSTANT"),we.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=we.shaderDefines.registerDefine("ROTATIONOVERLIFETIMECURVE"),we.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=we.shaderDefines.registerDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),we.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=we.shaderDefines.registerDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),we.SHADERDEFINE_SIZEOVERLIFETIMECURVE=we.shaderDefines.registerDefine("SIZEOVERLIFETIMECURVE"),we.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=we.shaderDefines.registerDefine("SIZEOVERLIFETIMECURVESEPERATE"),we.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=we.shaderDefines.registerDefine("SIZEOVERLIFETIMERANDOMCURVES"),we.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=we.shaderDefines.registerDefine("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),we.SHADERDEFINE_RENDERMODE_MESH=we.shaderDefines.registerDefine("RENDERMODE_MESH"),we.SHADERDEFINE_SHAPE=we.shaderDefines.registerDefine("SHAPE")},we.load=function(e){return x.loader.create(e,null,null,we)},we._initStartLife=function(e){for(var t=new Q,i=e.startLifetimes,n=0,a=i.length;n<a;n++){var r=i[n];t.add(r.key,r.value)}return t},we.SHADERDEFINE_RENDERMODE_BILLBOARD=0,we.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=0,we.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=0,we.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=0,we.SHADERDEFINE_COLOROVERLIFETIME=0,we.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=0,we.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=0,we.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=0,we.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=0,we.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=0,we.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=0,we.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=0,we.SHADERDEFINE_ROTATIONOVERLIFETIME=0,we.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=0,we.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=0,we.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=0,we.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=0,we.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=0,we.SHADERDEFINE_SIZEOVERLIFETIMECURVE=0,we.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=0,we.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=0,we.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=0,we.SHADERDEFINE_RENDERMODE_MESH=0,we.SHADERDEFINE_SHAPE=0,we.WORLDPOSITION=0,we.WORLDROTATION=1,we.POSITIONSCALE=4,we.SIZESCALE=5,we.SCALINGMODE=6,we.GRAVITY=7,we.THREEDSTARTROTATION=8,we.STRETCHEDBILLBOARDLENGTHSCALE=9,we.STRETCHEDBILLBOARDSPEEDSCALE=10,we.SIMULATIONSPACE=11,we.CURRENTTIME=12,we.VOLVELOCITYCONST=13,we.VOLVELOCITYGRADIENTX=14,we.VOLVELOCITYGRADIENTY=15,we.VOLVELOCITYGRADIENTZ=16,we.VOLVELOCITYCONSTMAX=17,we.VOLVELOCITYGRADIENTXMAX=18,we.VOLVELOCITYGRADIENTYMAX=19,we.VOLVELOCITYGRADIENTZMAX=20,we.VOLSPACETYPE=21,we.COLOROVERLIFEGRADIENTALPHAS=22,we.COLOROVERLIFEGRADIENTCOLORS=23,we.MAXCOLOROVERLIFEGRADIENTALPHAS=24,we.MAXCOLOROVERLIFEGRADIENTCOLORS=25,we.SOLSIZEGRADIENT=26,we.SOLSIZEGRADIENTX=27,we.SOLSIZEGRADIENTY=28,we.SOLSizeGradientZ=29,we.SOLSizeGradientMax=30,we.SOLSIZEGRADIENTXMAX=31,we.SOLSIZEGRADIENTYMAX=32,we.SOLSizeGradientZMAX=33,we.ROLANGULARVELOCITYCONST=34,we.ROLANGULARVELOCITYCONSTSEPRARATE=35,we.ROLANGULARVELOCITYGRADIENT=36,we.ROLANGULARVELOCITYGRADIENTX=37,we.ROLANGULARVELOCITYGRADIENTY=38,we.ROLANGULARVELOCITYGRADIENTZ=39,we.ROLANGULARVELOCITYGRADIENTW=40,we.ROLANGULARVELOCITYCONSTMAX=41,we.ROLANGULARVELOCITYCONSTMAXSEPRARATE=42,we.ROLANGULARVELOCITYGRADIENTMAX=43,we.ROLANGULARVELOCITYGRADIENTXMAX=44,we.ROLANGULARVELOCITYGRADIENTYMAX=45,we.ROLANGULARVELOCITYGRADIENTZMAX=46,we.ROLANGULARVELOCITYGRADIENTWMAX=47,we.TEXTURESHEETANIMATIONCYCLES=48,we.TEXTURESHEETANIMATIONSUBUVLENGTH=49,we.TEXTURESHEETANIMATIONGRADIENTUVS=50,we.TEXTURESHEETANIMATIONGRADIENTMAXUVS=51,u(we,["shaderDefines",function(){return this.shaderDefines=new hi($n.shaderDefines)}]),we}($n),ra=function(t){function i(e,t){this._subMeshOffset=null,i.__super.call(this,t),this._subMeshOffset=[],this._geometryFilter=new _n(this),this._render=new Zn(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),e&&(this._geometryFilter.sharedMesh=e)}f(i,"laya.d3.core.SkinnedMeshSprite3D",t);var e=i.prototype;return e._changeRenderObjectByMesh=function(e){var t=this._render._renderElements,i=t[e];(i=i||(t[e]=new Xi))._render=this._render;var n=this._render.sharedMaterials[e];n=n||In.defaultMaterial;var a=this._geometryFilter.sharedMesh.getRenderElement(e);return i._mainSortID=this._getSortID(a,n),i._sprite3D=this,i.renderObj=a,i._material=n,i},e._changeRenderObjectByMaterial=function(e,t){var i=this._render._renderElements[e];t=t||In.defaultMaterial;var n=this._geometryFilter.sharedMesh.getRenderElement(e);return i._mainSortID=this._getSortID(n,t),i._sprite3D=this,i.renderObj=n,i._material=t,i},e._changeRenderObjectsByMesh=function(){var e=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=e;for(var t=0;t<e;t++)this._changeRenderObjectByMesh(t)},e._onMeshChanged=function(e){var t=e.sharedMesh;t.loaded?this._changeRenderObjectsByMesh():t.once("loaded",this,this._changeRenderObjectsByMesh)},e._onMaterialChanged=function(e,t,i){t<this._render._renderElements.length&&this._changeRenderObjectByMaterial(t,i)},e._parseCustomProps=function(e,t,i,n){var a=this.skinnedMeshRender,r=i.lightmapIndex;null!=r&&(a.lightmapIndex=r);var s,o,l=i.lightmapScaleOffset;if(l&&(a.lightmapScaleOffset=new ri(l[0],l[1],l[2],l[3])),n.instanceParams)(s=n.instanceParams.loadPath)&&(o=Me.getRes(t[s]),(this.meshFilter.sharedMesh=o).loaded?a.sharedMaterials=o.materials:o.once("loaded",this,this._applyMeshMaterials));else{(s=i.meshPath)&&(o=Me.getRes(t[s]),this.meshFilter.sharedMesh=o);var h=i.materials;if(h){var c=a.sharedMaterials,u=h.length;c.length=u;for(var d=0;d<u;d++)c[d]=Me.getRes(t[h[d].path]);a.sharedMaterials=c}var _=i.rootBone;_&&a._setRootBone(_);var p=i.boundBox;if(p){var f=p.min,m=p.max,g=new Ht(new ai(f[0],f[1],f[2]),new ai(m[0],m[1],m[2]));a.localBoundBox=g}else a._hasIndependentBound=!1;var v=i.boundSphere;if(v){var y=v.center,C=new Gt(new ai(y[0],y[1],y[2]),v.radius);a.localBoundSphere=C}}},e._changeHierarchyAnimator=function(e){if(e){var t=this.skinnedMeshRender;t._setCacheAnimator(e);var i=e.avatar;i&&t._setCacheAvatar(i)}laya.d3.core.Sprite3D.prototype._changeHierarchyAnimator.call(this,e)},e._clearSelfRenderObjects=function(){this._scene.removeFrustumCullingObject(this._render)},e._addSelfRenderObjects=function(){this._scene.addFrustumCullingObject(this._render)},e._applyMeshMaterials=function(e){for(var t=this._render.sharedMaterials,i=e.materials,n=0,a=i.length;n<a;n++)t[n]||(t[n]=i[n]);this._render.sharedMaterials=t},e.cloneTo=function(e){var t=e;t._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var i=this._render,n=t._render;n.enable=i.enable,n.sharedMaterials=i.sharedMaterials,n.castShadow=i.castShadow;var a=i.lightmapScaleOffset;a&&(n.lightmapScaleOffset=a.clone()),n.receiveShadow=i.receiveShadow,n.sortingFudge=i.sortingFudge,n._rootBone=i._rootBone;var r=i.localBoundSphere;r&&(n.localBoundSphere=r.clone());var s=i.localBoundBox;s&&(n.localBoundBox=s.clone()),n._hasIndependentBound=i._hasIndependentBound,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,e)},e.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._geometryFilter._destroy())},v(0,e,"meshFilter",function(){return this._geometryFilter}),v(0,e,"skinnedMeshRender",function(){return this._render}),i.__init__=function(){i.SHADERDEFINE_BONE=i.shaderDefines.registerDefine("BONE")},i.load=function(e){return x.loader.create(e,null,null,i)},i.SHADERDEFINE_BONE=8,i.BONES=0,u(i,["shaderDefines",function(){return this.shaderDefines=new hi($n.shaderDefines)}]),i}($n),sa=(function(){function r(e,t,i,n,a){void 0===e&&(e=.1),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=.3),void 0===a&&(a=1e3),this._tempMatrix=new qt,this._leftViewMatrix=new qt,this._leftProjectionMatrix=new qt,this._leftProjectionViewMatrix=new qt,this._leftViewport=new si(0,0,0,0),this._leftNormalizedViewport=new si(0,0,.5,1),this._leftAspectRatio=t,this._rightViewMatrix=new qt,this._rightProjectionMatrix=new qt,this._rightProjectionViewMatrix=new qt,this._rightViewport=new si(0,0,0,0),this._rightNormalizedViewport=new si(.5,0,.5,1),this._rightAspectRatio=i,this._pupilDistande=e,this._leftBoundFrustumUpdate=!0,this._leftBoundFrustum=new Ut(qt.DEFAULT),this._rightBoundFrustumUpdate=!0,this._rightBoundFrustum=new Ut(qt.DEFAULT),r.__super.call(this,n,a),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}f(r,"laya.d3.core.VRCamera",Qn);var e=r.prototype;e._onWorldMatrixChanged=function(){this._leftBoundFrustumUpdate=this._rightBoundFrustumUpdate=!0},e._calculatePupilOffset=function(){var e=this._tempVector3;return ai.scale(this.right,this._pupilDistande/2,e),e.elements},e._calculateLeftProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var e=this.orthographicVerticalSize*this.leftAspectRatio*.5,t=.5*this.orthographicVerticalSize;qt.createOrthoOffCenterRH(-e,e,-t,t,this.nearPlane,this.farPlane,this._leftProjectionMatrix)}else qt.createPerspective(3.1416*this.fieldOfView/180,this.leftAspectRatio,this.nearPlane,this.farPlane,this._rightProjectionMatrix);this._leftBoundFrustumUpdate=!0},e._calculateRightProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var e=this.orthographicVerticalSize*this.rightAspectRatio*.5,t=.5*this.orthographicVerticalSize;qt.createOrthoOffCenterRH(-e,e,t,t,this.nearPlane,this.farPlane,this._rightProjectionMatrix)}else qt.createPerspective(3.1416*this.fieldOfView/180,this.rightAspectRatio,this.nearPlane,this.farPlane,this._rightProjectionMatrix);this._rightBoundFrustumUpdate=!0},e._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var e=this.orthographicVerticalSize*this.leftAspectRatio*.5,t=.5*this.orthographicVerticalSize,i=this.orthographicVerticalSize*this.rightAspectRatio*.5,n=.5*this.orthographicVerticalSize;qt.createOrthoOffCenterRH(-e,e,-t,t,this.nearPlane,this.farPlane,this._leftProjectionMatrix),qt.createOrthoOffCenterRH(-i,i,n,n,this.nearPlane,this.farPlane,this._rightProjectionMatrix)}else qt.createPerspective(3.1416*this.fieldOfView/180,this.leftAspectRatio,this.nearPlane,this.farPlane,this._leftProjectionMatrix),qt.createPerspective(3.1416*this.fieldOfView/180,this.rightAspectRatio,this.nearPlane,this.farPlane,this._rightProjectionMatrix);this._leftBoundFrustumUpdate=this._rightBoundFrustumUpdate=!0},e._renderCamera=function(e,t,i){var n,a;(t.camera=this)._prepareCameraToRender(),i._preRenderUpdateComponents(t),n=t._viewMatrix=this.leftViewMatrix;var r,s,o=this._renderTarget;o?(o.start(),qt.multiply(Qn._invertYScaleMatrix,this._leftProjectionMatrix,Qn._invertYProjectionMatrix),qt.multiply(Qn._invertYScaleMatrix,this.leftProjectionViewMatrix,Qn._invertYProjectionViewMatrix),a=t._projectionMatrix=Qn._invertYProjectionMatrix,t._projectionViewMatrix=Qn._invertYProjectionViewMatrix):(a=t._projectionMatrix=this._leftProjectionMatrix,t._projectionViewMatrix=this.leftProjectionViewMatrix),this._prepareCameraViewProject(n,a),t._viewport=this.leftViewport,i._preRenderScene(e,t,this.leftBoundFrustum),i._clear(e,t),i._renderScene(e,t),r=t._viewMatrix=this.rightViewMatrix,o?(o.start(),qt.multiply(Qn._invertYScaleMatrix,this._rightProjectionMatrix,Qn._invertYProjectionMatrix),qt.multiply(Qn._invertYScaleMatrix,this.rightProjectionViewMatrix,Qn._invertYProjectionViewMatrix),t._projectionMatrix=Qn._invertYProjectionMatrix,s=t._projectionViewMatrix=Qn._invertYProjectionViewMatrix):(s=t._projectionMatrix=this._rightProjectionMatrix,t._projectionViewMatrix=this.rightProjectionViewMatrix),this._prepareCameraViewProject(r,s),t._viewport=this.rightViewport,i._preRenderScene(e,t,this.rightBoundFrustum),i._clear(e,t),i._renderScene(e,t),i._postRenderUpdateComponents(t),o&&o.end()},v(0,e,"rightBoundFrustum",function(){return this._rightBoundFrustumUpdate&&(this._rightBoundFrustum.matrix=this.rightProjectionViewMatrix),this._rightBoundFrustum}),v(0,e,"leftNormalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var e=this._leftViewport,t=this.renderTargetSize,i=t.width,n=t.height;this._leftNormalizedViewport.x=e.x/i,this._leftNormalizedViewport.y=e.y/n,this._leftNormalizedViewport.width=e.width/i,this._leftNormalizedViewport.height=e.height/n}return this._leftNormalizedViewport}),v(0,e,"rightViewport",function(){if(this._viewportExpressedInClipSpace){var e=this._rightNormalizedViewport,t=this.renderTargetSize,i=t.width,n=t.height;this._rightViewport.x=e.x*i,this._rightViewport.y=e.y*n,this._rightViewport.width=e.width*i,this._rightViewport.height=e.height*n}return this._rightViewport}),v(0,e,"viewport",null,function(e){if(null!=this.renderTarget&&(e.x<0||e.y<0||0==e.width||0==e.height))throw new Error("VRCamera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._leftViewport=new si(0,0,e.width/2,e.height),this._rightViewport=new si(e.width/2,0,e.width/2,e.height),this._calculateProjectionMatrix()}),v(0,e,"leftAspectRatio",function(){if(0!==this._leftAspectRatio)return this._leftAspectRatio;var e=this.leftViewport;return e.width/e.height}),v(0,e,"rightAspectRatio",function(){if(0!==this._rightAspectRatio)return this._rightAspectRatio;var e=this.rightViewport;return e.width/e.height}),v(0,e,"aspectRatio",null,function(e){if(e<0)throw new Error("VRCamera: the aspect ratio has to be a positive real number.");this._leftAspectRatio=e,this._rightAspectRatio=e,this._calculateRightProjectionMatrix()}),v(0,e,"rightNormalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var e=this._rightViewport,t=this.renderTargetSize,i=t.width,n=t.height;this._rightNormalizedViewport.x=e.x/i,this._rightNormalizedViewport.y=e.y/n,this._rightNormalizedViewport.width=e.width/i,this._rightNormalizedViewport.height=e.height/n}return this._rightNormalizedViewport}),v(0,e,"normalizedViewport",null,function(e){if(e.x<0||e.y<0||1<e.x+e.width||1<e.x+e.height)throw new Error("VRCamera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!0,this._leftNormalizedViewport=new si(0,0,e.width/2,e.height),this._rightNormalizedViewport=new si(e.width/2,0,e.width/2,e.height),this._calculateProjectionMatrix()}),v(0,e,"leftViewport",function(){if(this._viewportExpressedInClipSpace){var e=this._leftNormalizedViewport,t=this.renderTargetSize,i=t.width,n=t.height;this._leftViewport.x=e.x*i,this._leftViewport.y=e.y*n,this._leftViewport.width=e.width*i,this._leftViewport.height=e.height*n}return this._leftViewport}),v(0,e,"needLeftViewport",function(){var e=this.leftNormalizedViewport;return 0===e.x&&0===e.y&&1===e.width&&1===e.height}),v(0,e,"needRightViewport",function(){var e=this.rightNormalizedViewport;return 0===e.x&&0===e.y&&1===e.width&&1===e.height}),v(0,e,"leftViewMatrix",function(){var e=this._calculatePupilOffset(),t=this._tempMatrix;this.transform.worldMatrix.cloneTo(t);var i=t.elements;return i[12]-=e[0],i[13]-=e[1],i[14]-=e[2],t.invert(this._leftViewMatrix),this._leftViewMatrix}),v(0,e,"rightViewMatrix",function(){var e=this._calculatePupilOffset(),t=this._tempMatrix;this.transform.worldMatrix.cloneTo(t);var i=t.elements;return i[12]+=e[0],i[13]+=e[1],i[14]+=e[2],t.invert(this._rightViewMatrix),this._rightViewMatrix}),v(0,e,"leftProjectionMatrix",function(){return this._leftProjectionMatrix}),v(0,e,"leftProjectionViewMatrix",function(){return qt.multiply(this.leftProjectionMatrix,this.leftViewMatrix,this._leftProjectionViewMatrix),this._leftProjectionViewMatrix}),v(0,e,"rightProjectionMatrix",function(){return this._rightProjectionMatrix}),v(0,e,"rightProjectionViewMatrix",function(){return qt.multiply(this.rightProjectionMatrix,this.rightViewMatrix,this._rightProjectionViewMatrix),this._rightProjectionViewMatrix}),v(0,e,"leftBoundFrustum",function(){return this._leftBoundFrustumUpdate&&(this._leftBoundFrustum.matrix=this.leftProjectionViewMatrix),this._leftBoundFrustum})}(),function(t){function e(){e.__super.call(this),this._geometryFilter=new gn(this),this._render=new vn(this),this._changeRenderObjectsByMaterial(this._render,0,Vn.defaultMaterial),this._render.on("materialchanged",this,this._changeRenderObjectsByMaterial),this._geometryFilter.on("trailfilterchange",this,this._changeRenderObjectsByRenderElement)}f(e,"laya.d3.core.trail.TrailSprite3D",t);var i=e.prototype;return i._changeRenderObjectsByMaterial=function(e,t,i){var n=this._geometryFilter.getRenderElementsCount();this._render._renderElements.length=n;for(var a=0;a<n;a++)this._changeRenderObjectByMaterial(a,i)},i._changeRenderObjectByMaterial=function(e,t){var i=this._render._renderElements;t=t||Vn.defaultMaterial;var n=i[e];(n=n||(i[e]=new ae))._sprite3D=this,n.renderObj=this._geometryFilter.getRenderElement(e),n._render=this._render,n._material=t},i._changeRenderObjectsByRenderElement=function(e,t){var i=this._render._renderElements,n=i[e];(n=n||(i[e]=new ae))._sprite3D=this,n.renderObj=t,n._render=this._render,n._material=this._render.sharedMaterial},i._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},i._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},i._update=function(e){t.prototype._update.call(this,e),this._geometryFilter._update(e)},i._parseCustomProps=function(e,t,i,n){var a=this._render,r=this._geometryFilter,s=0,o=0,l=i.materials;if(l){var h=a.sharedMaterials,c=l.length;for(h.length=c,s=0;s<c;s++)h[s]=Me.getRes(t[l[s].path]);a.sharedMaterials=h}var u=n.props;r.time=u.time,r.minVertexDistance=u.minVertexDistance,r.widthMultiplier=u.widthMultiplier,r.textureMode=u.textureMode;var d=[],_=i.widthCurve;for(s=0,o=_.length;s<o;s++){var p=new ge;p.time=_[s].time,p.inTangent=_[s].inTangent,p.outTangent=_[s].outTangent,p.value=_[s].value,d.push(p)}r.widthCurve=d;var f=i.colorGradient,m=new de;m.mode=f.mode;var g,v,y=[],C=f.colorKeys;for(s=0,o=C.length;s<o;s++)v=C[s],g=new pe(new ce(v.value[0],v.value[1],v.value[2],1),v.time),y.push(g);var E,S,x=[],T=f.alphaKeys;for(s=0,o=T.length;s<o;s++)S=T[s],E=new _e(S.value,S.time),x.push(E);m.setKeys(y,x),r.colorGradient=m},i.reset=function(){this.trailFilter.reset()},i.cloneTo=function(e){laya.d3.core.Sprite3D.prototype.cloneTo.call(this,e);var t,i=0,n=e,a=n.trailFilter;a.time=this.trailFilter.time,a.minVertexDistance=this.trailFilter.minVertexDistance,a.widthMultiplier=this.trailFilter.widthMultiplier;var r=this.trailFilter.widthCurve,s=[];for(i=0,t=r.length;i<t;i++){var o=new ge;r[i].cloneTo(o),s.push(o)}a.widthCurve=s;var l=new de;this.trailFilter.colorGradient.cloneTo(l),a.colorGradient=l,a.textureMode=this.trailFilter.textureMode,n.trailRender.sharedMaterial=this.trailRender.sharedMaterial},i.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._geometryFilter._destroy(),this._geometryFilter=null)},v(0,i,"trailFilter",function(){return this._geometryFilter}),v(0,i,"trailRender",function(){return this._render}),e.__init__=function(){e.SHADERDEFINE_GRADIENTMODE_BLEND=e.shaderDefines.registerDefine("GRADIENTMODE_BLEND")},e.CURTIME=3,e.LIFETIME=4,e.WIDTHCURVE=5,e.WIDTHCURVEKEYLENGTH=6,e.GRADIENTCOLORKEY=7,e.GRADIENTALPHAKEY=8,e.SHADERDEFINE_GRADIENTMODE_BLEND=0,u(e,["shaderDefines",function(){return this.shaderDefines=new hi($n.shaderDefines)}]),e}($n)),oa=function(t){function l(e,t,i,n,a,r,s,o){l.__super.call(this,o),this._geometryFilter=new Cn(this,e,t,i,n,a,r,s),this._render=new En(this)}f(l,"laya.d3.terrain.TerrainChunk",t);var e=l.prototype;return e.buildRenderElementAndMaterial=function(e,t,i,n,a,r,s,o,l,h,c,u,d,_,p,f,m,g){void 0===c&&(c=1),void 0===u&&(u=1),void 0===d&&(d=1),void 0===_&&(_=1),void 0===p&&(p=1),void 0===f&&(f=1),void 0===m&&(m=1),void 0===g&&(g=1);var v=new Dn;l&&(v.diffuseColor=l),o&&(v.ambientColor=o),h&&(v.specularColor=h),v.splatAlphaTexture=Me.getRes(i),v.normalTexture=t?Me.getRes(t):null,v.diffuseTexture1=n?Me.getRes(n):null,v.diffuseTexture2=a?Me.getRes(a):null,v.diffuseTexture3=r?Me.getRes(r):null,v.diffuseTexture4=s?Me.getRes(s):null,v.setDiffuseScale1(c,u),v.setDiffuseScale2(d,_),v.setDiffuseScale3(p,f),v.setDiffuseScale4(m,g),v.setDetailNum(e),0!=this._render._renderElements.length&&(v.renderMode=2);var y=new ae;y._mainSortID=0,y._sprite3D=this,y.renderObj=this._geometryFilter,y._material=v,this._render._materials.push(v),this._render._renderElements.push(y)},e._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},e._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},e._applyMeshMaterials=function(e){for(var t=this._render.sharedMaterials,i=e.materials,n=0,a=i.length;n<a;n++)t[n]||(t[n]=i[n]);this._render.sharedMaterials=t},e.cloneTo=function(e){console.log("Terrain Chunk can't clone")},e.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._geometryFilter._destroy())},v(0,e,"terrainFilter",function(){return this._geometryFilter}),v(0,e,"terrainRender",function(){return this._render}),l.load=function(e){return x.loader.create(e,null,null,l,null,1,!1)},l}($n);!function(){function y(e,t,i){this._minX=NaN,this._minZ=NaN,this._cellSize=null,this._heightMap=null,y.__super.call(this,e,i),this._heightMap=t,this._cellSize=new ni}f(y,"laya.d3.core.MeshTerrainSprite3D",na);var e=y.prototype;e._disableRotation=function(){var e=this.transform.rotation;e.elements[0]=0,e.elements[1]=0,e.elements[2]=0,e.elements[3]=1,this.transform.rotation=e},e._getScaleX=function(){var e=this.transform.worldMatrix.elements,t=e[0],i=e[1],n=e[2];return Math.sqrt(t*t+i*i+n*n)},e._getScaleZ=function(){var e=this.transform.worldMatrix.elements,t=e[8],i=e[9],n=e[10];return Math.sqrt(t*t+i*i+n*n)},e._initCreateFromMesh=function(e,t){this._heightMap=j.creatFromMesh(this.meshFilter.sharedMesh,e,t,this._cellSize);var i=this.meshFilter.sharedMesh.boundingBox,n=i.min;i.max;this._minX=n.x,this._minZ=n.z},e._initCreateFromMeshHeightMap=function(e,t,i){var n=this,a=this.meshFilter.sharedMesh.boundingBox;e.loaded?(this._heightMap=j.createFromImage(e,t,i),this._computeCellSize(a)):e.once("loaded",null,function(){n._heightMap=j.createFromImage(e,t,i),n._computeCellSize(a)});var r=a.min;a.max;this._minX=r.x,this._minZ=r.z},e._computeCellSize=function(e){var t=e.min,i=e.max,n=t.x,a=t.z,r=i.x-n,s=i.z-a;this._cellSize.elements[0]=r/(this._heightMap.width-1),this._cellSize.elements[1]=s/(this._heightMap.height-1)},e._update=function(e){this._disableRotation(),laya.d3.core.RenderableSprite3D.prototype._update.call(this,e)},e.getHeight=function(e,t){y._tempVector3.elements[0]=e,y._tempVector3.elements[1]=0,y._tempVector3.elements[2]=t,this._disableRotation();var i=this.transform.worldMatrix;i.invert(y._tempMatrix4x4),ai.transformCoordinate(y._tempVector3,y._tempMatrix4x4,y._tempVector3),e=y._tempVector3.elements[0],t=y._tempVector3.elements[2];var n=(e-this._minX)/this._cellSize.x,a=(t-this._minZ)/this._cellSize.y,r=Math.floor(a),s=Math.floor(n),o=n-s,l=a-r,h=i.elements,c=h[4],u=h[5],d=h[6],_=Math.sqrt(c*c+u*u+d*d),p=h[13],f=this._heightMap.getHeight(r,s+1),m=this._heightMap.getHeight(r+1,s);if(isNaN(f)||isNaN(m))return NaN;if(o+l<=1){var g=this._heightMap.getHeight(r,s);return isNaN(g)?NaN:(g+o*(f-g)+l*(m-g))*_+p}var v=this._heightMap.getHeight(r+1,s+1);return isNaN(v)?NaN:(v+(1-o)*(m-v)+(1-l)*(f-v))*_+p},v(0,e,"minX",function(){var e=this.transform.worldMatrix.elements;return this._minX*this._getScaleX()+e[12]}),v(0,e,"width",function(){return(this._heightMap.width-1)*this._cellSize.x*this._getScaleX()}),v(0,e,"minZ",function(){var e=this.transform.worldMatrix.elements;return this._minZ*this._getScaleZ()+e[14]}),v(0,e,"depth",function(){return(this._heightMap.height-1)*this._cellSize.y*this._getScaleZ()}),y.createFromMesh=function(e,t,i,n){var a=new y(e,null,n);return e.loaded?a._initCreateFromMesh(t,i):e.once("loaded",a,a._initCreateFromMesh,[t,i]),a},y.createFromMeshAndHeightMap=function(e,t,i,n,a){var r=new y(e,null,a);return e.loaded?r._initCreateFromMeshHeightMap(t,i,n):e.once("loaded",r,r._initCreateFromMeshHeightMap,[t,i,n]),r},u(y,["_tempVector3",function(){return this._tempVector3=new ai},"_tempMatrix4x4",function(){return this._tempMatrix4x4=new qt}])}()}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,t){"use strict";for(var i in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(t[i]=n)}}),function(n){"use strict";var e;window.location.protocol;function t(){}function i(e){window.localStorage?this.store=window.localStorage:this.store={keys:[],values:[],setItem:function(e,t){var i=this.keys.indexOf(e);-1<i?this.values[i]=t:(this.values.push(t),this.keys.push(e))},getItem:function(e){var t=this.keys.indexOf(e);return-1<t?this.values[t]:null},removeItem:function(e){var t=this.keys.indexOf(e);return-1<t?this.values.splice(t,1)[0]:null},clear:function(){this.values.length=0,this.keys.length=0},key:function(e){return e<this.keys.length?this.keys[e]:null},length:function(){return this.keys.length}},this.storageName=e}function r(){}n.LayaStruct=(t.getUserStruct=function(){return{SP_UID:"",SP:"",NICKNAME:"",AVTOR_URL:"",DEV_OS:"",DEV_OS_VER:"",DEV_IMEI:"",DEV_IMSI:"",DEV_MAC:"",SP_TOKEN:"",IP:"",ACCESS_TOKEN:"",GAME_ID:"",IS_VIP:"",CITY:"",SEX:"",PROVINCE:"",COUNTRY:"",HEADIMG:"",DEV_MOBILE:"",EMAIL:"",EQUIPMENT_NUM:"",SP_NAME:""}},t.getLoginStruct=function(){return{spuid:"",sptoken:"",userId:"",typeId:"",sp:"",nickName:"",email:"",equipmentNum:"",mobile:"",headimg:"",country:"",province:"",city:"",language:"",isvip:""}},t.spLoginInfo=function(){return{result:"",desc:"",nickName:"",avatarUrl:"",sessionKey:"",spuid:"",sex:""}},t),n.LayaMakerMarket=function(){function e(){this.layaStorage=new LayaStorageH5("Storage"),this.loginCallBack=null,this.rewardedVideoAd=null,this.ADObj={},this.reportedGameDataCache=[]}e.instance=null,e.getInstance=function(){return null==e.instance&&(n.LBMH5=e.instance=new e),e.instance};var t=e.prototype;return t.login=function(e){LBMH5.loginCallBack=e,LayaCommon.checkWeiXin()&&this.wxLogin()},t.wxLogin=function(){wx.checkSession({success:function(){console.log("checkSession ok");var e=LBMH5.layaStorage.getItem("minigame_userinfo");null!=e?(console.log("userinfo ok"),LBMH5.loginCallBack&&LBMH5.loginCallBack(1,e)):LBMH5.sessionExpired()},fail:function(){LBMH5.sessionExpired()}})},t.sessionExpired=function(){console.log("checkSession fail"),wx.login({success:function(e){console.log("login ok"+JSON.stringify(e)),LBMH5.authCodeResult(e)},fail:function(e){console.log("login fail"),LBMH5.loginCallBack&&LBMH5.loginCallBack(-1)}})},t.authCodeResult=function(e){wx.getUserInfo({success:function(e){console.log("getUserInfo ok"+JSON.stringify(e)),LBMH5.layaStorage.setItem("minigame_userinfo",JSON.stringify(e.userInfo)),LBMH5.loginCallBack&&LBMH5.loginCallBack(1,e.userInfo)},fail:function(e){console.log("getUserInfo fail"+e.errMsg),LBMH5.loginCallBack&&LBMH5.loginCallBack(-2)}})},t.createVideoAD=function(e){if(LayaCommon.checkWeiXin())return LBMH5.ADObj[e]=wx.createRewardedVideoAd({adUnitId:e}),LBMH5.ADObj[e]},t.showADVideo=function(e,t){if(LayaCommon.checkWeiXin()){var i=LBMH5.ADObj[e],n=t;(i=i||LBMH5.createVideoAD(e)).load().then(function(){i.show()}).catch(function(e){console.log(e.errMsg),i.destory&&i.destory(),n&&n(-1,e)}),i.onClose(function(e){e&&e.isEnded||null==e?(console.log("观看完成发送奖励"),n&&n(1)):(console.log("取消"),n&&n(0)),i.offClose(),i.offError(),i.offLoad()})}},t.createBannerAD=function(e,t){if(LayaCommon.checkWeiXin())return LBMH5.ADObj[e]=wx.createBannerAd({adUnitId:e,style:t}),LBMH5.ADObj[e]},t.showADBanner=function(e,t,i,n){void 0===i&&(i=!1);var a=n,r=LBMH5.ADObj[e];return r=r||LBMH5.createBannerAD(e,t),i&&(r.destory(),r=LBMH5.createBannerAD(e,t)),r.onError(function(e){console.log(e),a&&a(0)}),r.onLoad(function(){console.log("banner 广告加载成功"),a&&a(1)}),r.show(),r},t.hideADBanner=function(e){var t=LBMH5.ADObj[e];t&&(t.offError(),t.offLoad(),t.hide())},t.getWXGroupGameData=function(e,t,i){var n=i;wx.getGroupCloudStorage({shareTicket:e,keyList:t,success:function(e){console.log("----------------getGroupCloudStorage-------------ok-----------"),e.data&&(console.log(e.data),n&&n(1,e.data))},fail:function(e){console.log("------------getGroupCloudStorage--------------fail-------"),console.log(e),n&&n(0)}})},t.getWXGameData=function(e,t){var i=t;wx.getFriendCloudStorage({keyList:e,success:function(e){console.log("----------------getFriendUserGameData-------------ok-----------"),e.data&&(console.log(e.data),i&&i(1,e.data))},fail:function(e){console.log("------------getFriendUserGameData--------------fail-------"),console.log(e),i&&i(0)}})},t.getWXUserInfo=function(e,t){var i=t;wx.getUserInfo({openIdList:e,lang:"zh_CN",success:function(e){console.log("success",e.data),i&&i(1,e.data)},fail:function(e){console.log("fail",e),i&&i(0)}})},t.getSelfWXGameData=function(n,e){var a=e;wx.getUserCloudStorage({keyList:n,success:function(e){console.log("----------------getUserCloudStorage--------------ok----------",n);var t=e.KVDataList;if(t.length){var i=JSON.parse(t[0].value);a&&a(1,parseInt(i.wxgame.value1))}else a&&a(1,0)},fail:function(e){console.log("------------getUserCloudStorage--------------fail-------"),console.log(e),a&&a(0)}})},t.reportedWXGameData=function(e,t,i){var n=i,a=[],r=LBMH5.reportedGameDataCache[e];r?r.wxgame.value1=t:(r={wxgame:{}}).wxgame.value1=t,r.wxgame.update_time=Math.floor(Date.now()/1e3),LBMH5.reportedGameDataCache[e]=r,a.push({key:e,value:JSON.stringify(r)}),wx.setUserCloudStorage({KVDataList:a,success:function(e){console.log("-----success:"+JSON.stringify(e)),n&&n(1)},fail:function(e){console.log("-----fail:"+JSON.stringify(e)),n&&n(0)},complete:function(e){console.log("-----complete:"+JSON.stringify(e))}})},t.postMessage=function(e){wx.postMessage(e)},t.onMessage=function(e){var t=e;wx.onMessage(function(e){t&&t(e)})},t.sendShare=function(e,t,i,n,a,r){if(LayaCommon.checkWeiXin()){var s={};if(s.title=e,a){var o=n;a.toTempFilePath({x:0,y:0,width:500,height:400,destWidth:500,destHeight:400,success:function(e){s.image_url=e.tempFilePath,s.share_param=i,r?LBMH5.initWXShareConfig(s,o):LBMH5.wxShare(s,o)}})}else s.image_url=t,s.share_param=i,r?LBMH5.initWXShareConfig(s,n):LBMH5.wxShare(s,n)}},t.wxShare=function(e,t){var i=t,n=e,a={};wx.showShareMenu(),wx.updateShareMenu({withShareTicket:!0,success:function(e){wx.shareAppMessage({title:n.title,imageUrl:n.image_url,query:n.share_param,success:function(e){console.log("--Share----updateShareMenu------success data = "+JSON.stringify(e)),a.state=0,a.data=e,i&&i(a)},fail:function(e){console.log("--Share----updateShareMenu------fail----------"),a.state=1,a.data=e,i&&i(a),console.log(e)}})},fail:function(e){console.log("--Share----updateShareMenu------fail----------"),a.state=1,a.data=e,i&&i(a),console.log(e)}})},t.initWXShareConfig=function(e,t){var i=t,n=e;wx.showShareMenu(),wx.updateShareMenu({withShareTicket:!0,success:function(e){console.log("------updateShareMenu------success----------"),console.log(e),wx.onShareAppMessage(function(e){return console.log("onShareAppMessage"),{getGroupMsgTicket:!0,title:n.title,imageUrl:n.image_url,query:n.share_param,success:function(e){console.log(e),i&&i(1)},fail:function(){i&&i(0)}}})},fail:function(e){console.log("------updateShareMenu------fail----------"),console.log(e)}})},t.logout=function(e,t){},t.recharge=function(e,t){},t.init=function(e,t,i){t&&((t=JSON.parse(t)).openId&&t.openKey&&(n.openId=t.openId,n.openKey=t.openKey),i&&i(JSON.stringify({result:0})))},e.instance=null,e}(),n.LayaStorageH5=((e=i.prototype).getItem=function(e){var t=this.store.getItem(this.storageName)||"{}",i=JSON.parse(t);return i.hasOwnProperty(e)?i[e]:null},e.removeLocalStore=function(e){var t=this.store.getItem(this.storageName)||"{}",i=JSON.parse(t);i.hasOwnProperty(e)&&delete i[e],this.store.setItem(this.storageName,JSON.stringify(i))},e.clearLocalStore=function(){this.store.setItem(this.storageName,"{}")},e.setItem=function(e,t){var i=this.store.getItem(this.storageName)||"{}",n=JSON.parse(i);n[e]=t,this.store.setItem(this.storageName,JSON.stringify(n))},i),n.LayaCommon=(r.closeWnd=function(e){var t=document.getElementById(e);t&&document.body.removeChild(t)},r.openUrl=function(e,t,i){var n=document.createElement("iframe");if(n.frameBorder="0",n.scrolling="auto",n.setAttribute("id",e),i){var a=i,r=document.createElement("style");r.innerHTML=a,r.setAttribute("id",e+"Style"),document.head.appendChild(r)}else n.style.position="relative",n.style.left="0px",n.style.top="0px",n.style.height="100%",n.style.width="100%",n.style.zIndex=9998,n.style.backgroundColor="#ffffff";n.src=t,document.body.appendChild(n)},r.checkWeiXin=function(){return"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)},r.loadScript=function(e,t,i){var n=document.createElement("script");n.onload=function(){t&&t({result:0})},n.onerror=function(){i&&i({result:-100,desc:"脚本下载失败"})},document.head.appendChild(n),n.src=e},r.getUniqueID=function(e){for(var t="",i=1;i<=32;i++)t+=Math.floor(16*Math.random()).toString(16),8!=i&&12!=i&&16!=i&&20!=i||(t+=e||"");return t},r.createCallback=function(i,e){function n(e){if(window[n.funcName]&&(window[n.funcName]=null,delete window[n.funcName]),document&&document.head){var t=document.getElementById(n.funcName);t&&document.head.removeChild(t)}i&&i(e)}return e=e||"callback"+r.getUniqueID("_"),window[e]=(n.funcName=e,n),e},r.getJson=function(t,i,e){var n=r.createCallback(function(e){0!=e.ret&&r.errorLog({type:"market",error_type:"LayaH5Market",url:t,errorInfo:JSON.stringify(e)}),i&&i(e)}),a=document.createElement("script");document.head.appendChild(a),a.id=n,a.onerror=function(){-1==t.indexOf("developer.layabox.com")&&r.errorLog({type:"market",error_type:"LayaH5Market",url:t,errorInfo:"Request Fail"}),e&&e({result:-101,desc:"json download error"})},a.src=-1<t.indexOf("?")?t+"&callback="+n:t+"?callback="+n},r.getPostJson=function(e,t,i,n,a){r.getJson("//ucenter.layabox.com/HRProxy/http?url="+e+"&params="+t+"&ac="+i+"&access_token="+n,function(e){a&&a(e)},function(e){a&&a(e)})},r.errorLog=function(e){var t=[];for(var i in e)t.push(i+"="+encodeURIComponent(e[i]));t.push("errResourceUrl="+encodeURIComponent(window.location.href))},r),LayaMakerMarket.getInstance()}(window);var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(r,s,o,l){return new(o=o||Promise)(function(e,t){function i(e){try{a(l.next(e))}catch(e){t(e)}}function n(e){try{a(l.throw(e))}catch(e){t(e)}}function a(t){t.done?e(t.value):new o(function(e){e(t.value)}).then(i,n)}a((l=l.apply(r,s||[])).next())})},__generator=this&&this.__generator||function(i,n){var a,r,s,e,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,r&&(s=2&t[0]?r.return:t[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,t[1])).done)return s;switch(r=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return o.label++,{value:t[1],done:!1};case 5:o.label++,r=t[1],t=[0];continue;case 7:t=o.ops.pop(),o.trys.pop();continue;default:if(!(s=0<(s=o.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){o=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){o.label=t[1];break}if(6===t[0]&&o.label<s[1]){o.label=s[1],s=t;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(t);break}s[2]&&o.ops.pop(),o.trys.pop();continue}t=n.call(i,o)}catch(e){t=[6,e],r=0}finally{a=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function CameraMoveScript(){CameraMoveScript.super(this),this.lastMouseX=NaN,this.lastMouseY=NaN,this.yawPitchRoll=new Laya.Vector3,this.tempRotationZ=new Laya.Quaternion,this.isMouseDown=!1,this.rotaionSpeed=6e-5,this.mainCameraAnimation=null,this.scene=null}Laya.class(CameraMoveScript,"CameraMoveScript",Laya.Script),CameraMoveScript.prototype._initialize=function(e){CameraMoveScript.__super.prototype._initialize.call(this,e),Laya.stage.on("mousedown",this,this.mouseDown),Laya.stage.on("mouseup",this,this.mouseUp),Laya.stage.on("mouseout",this,this.mouseOut),this.camera=e},CameraMoveScript.prototype._update=function(e){CameraMoveScript.__super.prototype._update.call(this,e),this.updateCamera(e.elapsedTime)},CameraMoveScript.prototype.updateCamera=function(e){if(!isNaN(this.lastMouseX)&&!isNaN(this.lastMouseY)){this.owner.scene;if(Laya.KeyBoardManager.hasKeyDown(87)&&this.camera.moveForward(-.002*e),Laya.KeyBoardManager.hasKeyDown(83)&&this.camera.moveForward(.002*e),Laya.KeyBoardManager.hasKeyDown(65)&&this.camera.moveRight(-.002*e),Laya.KeyBoardManager.hasKeyDown(68)&&this.camera.moveRight(.002*e),Laya.KeyBoardManager.hasKeyDown(81)&&this.camera.moveVertical(.002*e),Laya.KeyBoardManager.hasKeyDown(69)&&this.camera.moveVertical(-.002*e),this.isMouseDown){var t=Laya.stage.mouseX-this.lastMouseX,i=Laya.stage.mouseY-this.lastMouseY,n=this.yawPitchRoll.elements;n[0]-=t*this.rotaionSpeed*e,n[1]-=i*this.rotaionSpeed*e,this.updateRotation()}}this.lastMouseX=Laya.stage.mouseX,this.lastMouseY=Laya.stage.mouseY},CameraMoveScript.prototype.updateRotation=function(){var e=this.yawPitchRoll.elements;Math.abs(e[1])<1.5&&(Laya.Quaternion.createFromYawPitchRoll(e[0],e[1],e[2],this.tempRotationZ),this.camera.transform.localRotation=this.tempRotationZ)},CameraMoveScript.prototype.mouseDown=function(e){this.camera.transform.localRotation.getYawPitchRoll(this.yawPitchRoll),this.lastMouseX=Laya.stage.mouseX,this.lastMouseY=Laya.stage.mouseY,this.isMouseDown=!0},CameraMoveScript.prototype.mouseUp=function(e){this.isMouseDown=!1},CameraMoveScript.prototype.mouseOut=function(e){this.isMouseDown=!1},CameraMoveScript.prototype._destroy=function(){Laya.stage.off("mousedown",this,this.mouseDown),Laya.stage.off("mouseup",this,this.mouseUp),Laya.stage.off("mouseout",this,this.mouseOut),this._unload(this._owner),this._owner=null,this._destroyed=!0};var GameConfig=function(){function e(){}return e.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"});s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update);document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}},e.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},e.width=1136,e.height=640,e.scaleMode="showall",e.screenMode="none",e.alignV="top",e.alignH="left",e.sceneRoot="",e.debug=!1,e.stat=!1,e}();define("sheets/vo/Sheets",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function i(){}t.PConfigBase=i;function n(){}t.BallSkinBase=n;function a(){}t.RandomBallBase=a;function r(){}t.ColorBase=r}),define("sheets/vo/BallSkin",["require","exports","sheets/vo/Sheets"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=i.BallSkinBase,__extends(r,n),r.get=function(e){return this[e]?this[e]:SheetManager.get("ballSkin",e,r)},r.getAllSkin=function(){var e=SheetManager.getList("ballSkin"),t=[];for(var i in e)if("keys"!=i){var n=this.get(i);t.push(n)}return t},r.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},r);function r(){return null!==n&&n.apply(this,arguments)||this}t.BallSkin=a}),define("wx/GameSaveDataMag",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.saveData=function(t,i,n,a){i&&"string"!=typeof i&&(i=JSON.stringify(i)),null!=typeof wx&&null!=t&&""!=t.trim()&&null!=t&&null!=i&&null!=i&&wx.setStorage({key:t,data:i,success:function(e){null!=n&&n(),console.log("保存本地====:"+t+"值===:"+i+"成功+"+JSON.stringify(e))},fail:function(e){null!=a&&a(),console.log("保存本地====:"+t+"值===:"+i+"失败+"+JSON.stringify(e))}})},n.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},n.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},n.getData=function(i,n){null!=typeof wx&&null!=i&&""!=i.trim()&&null!=i&&wx.getStorage({key:i,success:function(e){console.log("获取本地数值====:"+i+"值===:"+e.data);var t=JSON.parse(e.data);n(t)},fail:function(e){console.log("获取本地数值====:"+i+"异常:"+JSON.stringify(e)),n(null)}})},n.getDataSize=function(){if(null!=typeof wx)try{var e=wx.getStorageInfoSync();console.log("所有的key",e.keys),console.log("占用空间大小",e.currentSize),console.log("限制空间大小",e.limitSize)}catch(e){console.log("本地数据获取异常")}},n.delData=function(t){if(null!=typeof wx&&null!=t&&""!=t.trim()&&null!=t)try{wx.removeStorageSync("key"),console.log("清理"+t+"数值成功")}catch(e){console.log("清理"+t+"异常")}},n.delAllData=function(){if(null!=typeof wx)try{wx.clearStorageSync()}catch(e){console.log("清理异常")}},n);function n(){}t.GameSaveDataMag=i}),define("utils/GameSetting",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},n.ismingame=!1,n);function n(){}t.GameSetting=i}),define("wx/wxInterface",["require","exports","utils/GameSetting"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(s.prototype.postMessage=function(e){null!=typeof wx&&wx.postMessage(e)},Object.defineProperty(s,"I",{get:function(){return s._ins||(s._ins=new s),s._ins},enumerable:!0,configurable:!0}),s.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},s.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},s.prototype.login=function(e){void 0===e&&(e=null);var t=e;Laya.Browser.window.wx.login({success:function(e){playerCenter.code=e.code,t&&t()},fail:function(e){}})},s.prototype.initWxFun=function(){Laya.Browser.window.sharedCanvas.width=750,Laya.Browser.window.sharedCanvas.height=1334;var e=s.shareObj.room.title,t=s.shareObj.room.url,i=playerCenter.openId+"="+playerCenter.openId;this.inf.sendShare(e,t,i,function(e){e.state?console.log("转发失败"):console.log("转发成功")},null,!0)},s.prototype.share=function(e,t){if(void 0===t&&(t=0),r.GameSetting.ismingame){var i=s.shareObj[""+e].title,n=s.shareObj[""+e].url,a=playerCenter.openId+"="+playerCenter.openId;"battle"==e&&(i=i+t.toString()+s.shareObj[""+e].tail),this.inf.sendShare(i,n,a,function(e){e.state||console.log("分享成功")})}},s.prototype.report=function(e){var t={type:"score"};t.data=e,this.postMessage(t)},s.prototype.createVideo=function(e,t){void 0===t&&(t="adunit-9341eb80a0ce37e6"),r.GameSetting.ismingame&&this.inf.showADVideo(t,e)},s.prototype.showBanner=function(e,t){if(void 0===e&&(e=300),void 0===t&&(t="adunit-428940ccb2f4099c"),r.GameSetting.ismingame){this._adUnit=t;var i={left:0,top:0};i.width=e;var n=this.inf.showADBanner(t,i,!0,function(e){1==e&&(n.style.left=(Laya.Browser.clientWidth-n.style.realWidth)/2,n.style.top=Laya.Browser.clientHeight-n.style.realHeight)});Laya.timer.once(2e4,this,function(){this.hidebanner()})}},s.prototype.hidebanner=function(){r.GameSetting.ismingame&&(this.inf.hideADBanner(this._adUnit),this.showBanner())},s.prototype.goOtherGame=function(e,t){"undefined"!=typeof wx&&wx.navigateToMiniProgram({appId:e,fail:function(e){t(e)}})},s);function s(){this.inf=Laya.Browser.window.LayaMakerMarket.instance,r.GameSetting.ismingame&&this.postMessage({type:"resizeShared",width:Laya.stage.width,height:Laya.stage.height,matrix:Laya.stage._canvasTransform,isLoad:!1})}t.wxInterface=i}),define("game/utils/SoundUtils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(Object.defineProperty(n,"instance",{get:function(){return this.mInstance||(this.mInstance=new n)},enumerable:!0,configurable:!0}),n.prototype.playBGM=function(e,t){void 0===t&&(t=!1),this.mcloseBgm||(this.nowurl=e,this.sound=Laya.SoundManager.playMusic(e,1e6,null,t?this.lastTime:0),console.log("设置音乐"))},n.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},n.prototype.startBGM=function(){this.mcloseBgm&&(this.mcloseBgm=!1,this.playBGM(this.nowurl,!0),console.log("重新播放",this.nowurl,this.mcloseBgm))},n.prototype.stopBGM=function(){this.mcloseBgm||(this.mcloseBgm=!0,this.lastTime=this.sound.position,Laya.SoundManager.stopMusic(),console.log("停止播放",this.nowurl,this.mcloseBgm))},Object.defineProperty(n.prototype,"closeSound",{set:function(e){(this.mCloseSound=e)||this.stopSound(),console.log("音效状态",e)},enumerable:!0,configurable:!0}),n.prototype.playSound=function(e,t){void 0===t&&(t=null),Laya.SoundManager.autoReleaseSound&&(Laya.SoundManager.autoReleaseSound=!1),this.mCloseSound||Laya.SoundManager.playSound(e,1,Laya.Handler.create(this,function(){t&&t.run()}))},n.prototype.stopSound=function(){Laya.SoundManager.stopAllSound()},n);function n(){this.mcloseBgm=!1,this.mCloseSound=!1}t.SoundUtils=i}),define("game/scene/GameSystem",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.getPos=function(e){return this.road.getPos(e)},n.normalskinnum=15,n.huaskinnum=33,n.MUSIC_BG="https://xz-cdn.youkongwan.com/game/ballgo/mp3/bgm.mp3",n.MUSIC_BG1="https://xz-cdn.youkongwan.com/game/ballgo/mp3/bgm2.mp3",n.MUSIC_HIT="https://xz-cdn.youkongwan.com/game/ballgo/mp3/hit.mp3",n.SPINE_LOGO="https://xz-cdn.youkongwan.com/game/ballgo/spine/headline.sk",n.SPINE_CHOUQ="https://xz-cdn.youkongwan.com/game/ballgo/spine/tomy.sk",n.UI_IMG="https://xz-cdn.youkongwan.com/game/ballgo/atlas/comp.atlas",n.DATA_JSON_SIGIN="https://xz-cdn.youkongwan.com/game/ballgo/data/sigin.json",n.DATA_JSON_INIVE="https://xz-cdn.youkongwan.com/game/ballgo/data/inive.json",n.DATA_JSON_BASE="https://xz-cdn.youkongwan.com/game/ballgo/data/base.json",n.DATA_JSON_SKIN="https://xz-cdn.youkongwan.com/game/ballgo/data/skin.json",n.DATA_JSON_APPID="https://xz-cdn.youkongwan.com/game/ballgo/data/aniad.json",n.MUSIC_ADDSPEED="res/mp3/addSpeed.mp3",n.MUSIC_BAOXIANG="res/mp3/baoxiang.mp3",n.MUSIC_HITROBOT="res/mp3/hitRobot.mp3",n.MUSIC_JUMP="res/mp3/jump.mp3",n.MUSIC_BLUE="res/mp3/getBlue.mp3",n.MUSIC_DIANJI="res/mp3/dianji.mp3",n);function n(){}t.GameSystem=i}),define("game/View/InviteItem",["require","exports","game/utils/SoundUtils","game/scene/GameSystem","wx/wxInterface"],function(e,t,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=(r=ui.main.InviteItemUI,__extends(o,r),o.prototype.onInvite=function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),a.wxInterface.I.share("invite")},Object.defineProperty(o.prototype,"dataSource",{get:function(){return this.mData},set:function(e){if(null!=e){this.fnt_num.text=e.index;var t=e.bonusType;0==t&&this.icon.loadImage("comp/dio_icon.png"),3==t&&this.icon.loadImage("comp/img_blue.png"),this.fnt_price.text=e.num}},enumerable:!0,configurable:!0}),o.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},o.prototype.onDown=function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),Laya.stage.event("Tip",[{title:"请先邀请好友"}])},o.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},o);function o(){var e=r.call(this)||this;return e.btn_getdia.on(Laya.Event.CLICK,e,e.onDown),e.share_bt.on(Laya.Event.CLICK,e,e.onInvite),e}t.InviteItem=s}),define("game/View/InviteWin",["require","exports","utils/GameSetting","game/View/InviteItem","wx/dataCenter","wx/wxInterface"],function(e,t,i,n,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,o=(s=ui.main.InviteWinUI,__extends(l,s),l.prototype.createChildren=function(){s.prototype.createChildren.call(this),this.list.itemRender=n.InviteItem,this.list.vScrollBarSkin="",this.list.scrollBar.elasticBackTime=500,this.list.scrollBar.elasticDistance=200},l.getJson=function(t){Laya.loader.load(t,Laya.Handler.create(this,function(){var e=Laya.loader.getRes(t);l.data=e}),null,Laya.Loader.JSON)},l.prototype.onOpened=function(){this.enable(),s.prototype.onOpened.call(this)},l.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},l.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},l.prototype.closeView=function(){this.disable(),this.close()},l.prototype.enable=function(){i.GameSetting.ismingame&&this.btn_invite.on(Laya.Event.MOUSE_UP,this,this.onInvite),this.btn_close.on(Laya.Event.MOUSE_UP,this,this.closeView);var e=l.data.inive;this.list.array=e},l.prototype.disable=function(){Laya.stage.event("showClub"),this.btn_invite.off(Laya.Event.MOUSE_UP,this,this.onInvite),this.btn_close.off(Laya.Event.MOUSE_UP,this,this.closeView)},l.prototype.getDiamond=function(){playerCenter.Dionum.chest+=parseInt(l.invite_dia),Laya.stage.event("updata_dia"),i.GameSetting.ismingame&&a.dataCenter.I.send("diamond",JSON.stringify(playerCenter.Dionum))},l.prototype.onInvite=function(){i.GameSetting.ismingame&&r.wxInterface.I.share("invite")},l._returnArr=[],l.data=null,l);function l(){return null!==s&&s.apply(this,arguments)||this}t.InviteWin=o}),define("game/View/SignItem",["require","exports","game/utils/SoundUtils","game/scene/GameSystem"],function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=ui.main.sginItemUI,__extends(s,a),Object.defineProperty(s.prototype,"dataSource",{set:function(e){e&&(this.box_got.visible=!1,this.mdata=e,this.text_day.text="第"+e.deta+"天",0==e.type?(this.img_gift.skin="comp/dio_icon.png",this.img_tip.text="+"+e.num):3==e.type&&(this.img_gift.skin="comp/img_blue.png",this.img_tip.text="+"+e.num),e.reg&&(this.box_got.visible=!0))},enumerable:!0,configurable:!0}),s.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},s.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},s.prototype.getReward=function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),this.mdata&&!this.mdata.reg&&Laya.stage.event("sign",[this.mdata.deta-1])},s);function s(){var e=a.call(this)||this;return e.on(Laya.Event.MOUSE_DOWN,e,e.getReward),e}t.SignItem=r}),define("newfunction/gamecore/libs/md5",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.md5=function(e){function o(e,t){return e<<t|e>>>32-t}function l(e,t){var i,n,a,r,s;return a=2147483648&e,r=2147483648&t,s=(1073741823&e)+(1073741823&t),(i=1073741824&e)&(n=1073741824&t)?2147483648^s^a^r:i|n?1073741824&s?3221225472^s^a^r:1073741824^s^a^r:s^a^r}function t(e,t,i,n,a,r,s){return l(o(e=l(e,l(l(function(e,t,i){return e&t|~e&i}(t,i,n),a),s)),r),t)}function i(e,t,i,n,a,r,s){return l(o(e=l(e,l(l(function(e,t,i){return e&i|t&~i}(t,i,n),a),s)),r),t)}function n(e,t,i,n,a,r,s){return l(o(e=l(e,l(l(function(e,t,i){return e^t^i}(t,i,n),a),s)),r),t)}function a(e,t,i,n,a,r,s){return l(o(e=l(e,l(l(function(e,t,i){return t^(e|~i)}(t,i,n),a),s)),r),t)}function r(e){var t,i="",n="";for(t=0;t<=3;t++)i+=(n="0"+(e>>>8*t&255).toString(16)).substr(n.length-2,2);return i}var s,h,c,u,d,_,p,f,m,g=Array();for(g=function(e){for(var t,i=e.length,n=i+8,a=16*(1+(n-n%64)/64),r=Array(a-1),s=0,o=0;o<i;)s=o%4*8,r[t=(o-o%4)/4]=r[t]|e.charCodeAt(o)<<s,o++;return s=o%4*8,r[t=(o-o%4)/4]=r[t]|128<<s,r[a-2]=i<<3,r[a-1]=i>>>29,r}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):(127<n&&n<2048?t+=String.fromCharCode(n>>6|192):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128)),t+=String.fromCharCode(63&n|128))}return t}(e)),_=1732584193,p=4023233417,f=2562383102,m=271733878,s=0;s<g.length;s+=16)p=a(p=a(p=a(p=a(p=n(p=n(p=n(p=n(p=i(p=i(p=i(p=i(p=t(p=t(p=t(p=t(c=p,f=t(u=f,m=t(d=m,_=t(h=_,p,f,m,g[s+0],7,3614090360),p,f,g[s+1],12,3905402710),_,p,g[s+2],17,606105819),m,_,g[s+3],22,3250441966),f=t(f,m=t(m,_=t(_,p,f,m,g[s+4],7,4118548399),p,f,g[s+5],12,1200080426),_,p,g[s+6],17,2821735955),m,_,g[s+7],22,4249261313),f=t(f,m=t(m,_=t(_,p,f,m,g[s+8],7,1770035416),p,f,g[s+9],12,2336552879),_,p,g[s+10],17,4294925233),m,_,g[s+11],22,2304563134),f=t(f,m=t(m,_=t(_,p,f,m,g[s+12],7,1804603682),p,f,g[s+13],12,4254626195),_,p,g[s+14],17,2792965006),m,_,g[s+15],22,1236535329),f=i(f,m=i(m,_=i(_,p,f,m,g[s+1],5,4129170786),p,f,g[s+6],9,3225465664),_,p,g[s+11],14,643717713),m,_,g[s+0],20,3921069994),f=i(f,m=i(m,_=i(_,p,f,m,g[s+5],5,3593408605),p,f,g[s+10],9,38016083),_,p,g[s+15],14,3634488961),m,_,g[s+4],20,3889429448),f=i(f,m=i(m,_=i(_,p,f,m,g[s+9],5,568446438),p,f,g[s+14],9,3275163606),_,p,g[s+3],14,4107603335),m,_,g[s+8],20,1163531501),f=i(f,m=i(m,_=i(_,p,f,m,g[s+13],5,2850285829),p,f,g[s+2],9,4243563512),_,p,g[s+7],14,1735328473),m,_,g[s+12],20,2368359562),f=n(f,m=n(m,_=n(_,p,f,m,g[s+5],4,4294588738),p,f,g[s+8],11,2272392833),_,p,g[s+11],16,1839030562),m,_,g[s+14],23,4259657740),f=n(f,m=n(m,_=n(_,p,f,m,g[s+1],4,2763975236),p,f,g[s+4],11,1272893353),_,p,g[s+7],16,4139469664),m,_,g[s+10],23,3200236656),f=n(f,m=n(m,_=n(_,p,f,m,g[s+13],4,681279174),p,f,g[s+0],11,3936430074),_,p,g[s+3],16,3572445317),m,_,g[s+6],23,76029189),f=n(f,m=n(m,_=n(_,p,f,m,g[s+9],4,3654602809),p,f,g[s+12],11,3873151461),_,p,g[s+15],16,530742520),m,_,g[s+2],23,3299628645),f=a(f,m=a(m,_=a(_,p,f,m,g[s+0],6,4096336452),p,f,g[s+7],10,1126891415),_,p,g[s+14],15,2878612391),m,_,g[s+5],21,4237533241),f=a(f,m=a(m,_=a(_,p,f,m,g[s+12],6,1700485571),p,f,g[s+3],10,2399980690),_,p,g[s+10],15,4293915773),m,_,g[s+1],21,2240044497),f=a(f,m=a(m,_=a(_,p,f,m,g[s+8],6,1873313359),p,f,g[s+15],10,4264355552),_,p,g[s+6],15,2734768916),m,_,g[s+13],21,1309151649),f=a(f,m=a(m,_=a(_,p,f,m,g[s+4],6,4149444226),p,f,g[s+11],10,3174756917),_,p,g[s+2],15,718787259),m,_,g[s+9],21,3951481745),_=l(_,h),p=l(p,c),f=l(f,u),m=l(m,d);return(r(_)+r(p)+r(f)+r(m)).toLowerCase()}}),define("newfunction/gamecore/base/GameValues",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.saveLocalData=function(e,t){},n.getLocalData=function(e){},Object.defineProperty(n,"enableLog",{get:function(){return n._enableLog},set:function(e){n._enableLog!=e&&(n._enableLog=e,null==n._originalLogFun&&(n._originalLogFun=console.log,console.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n._enableLog&&n._originalLogFun.apply(null,e),n.logHandler&&n.logHandler(e)}))},enumerable:!0,configurable:!0}),Object.defineProperty(n,"currentPlatform",{get:function(){return 0==n._currentPlatform&&(n.currentPlatform="undefined"!=typeof BK?3:"undefined"!=typeof tt?2:"undefined"!=typeof wx?1:"undefined"!=typeof qg?5:"undefined"!=typeof FBInstant?4:1),n._currentPlatform},set:function(e){n._currentPlatform!=e&&(n._currentPlatform=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n,"isIOS",{get:function(){if(null==n._isIOS)try{navigator.userAgent&&(n._isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)),!n._isIOS&&navigator.platform&&(n._isIOS=/iPad|iPhone|iPod/.test(navigator.platform))}catch(e){n._isIOS=!1}return n._isIOS},enumerable:!0,configurable:!0}),Object.defineProperty(n,"isAndroid",{get:function(){if(null==n._isAndroid)try{var e=navigator.userAgent.toLowerCase();n._isAndroid=-1<e.indexOf("android")}catch(e){n._isAndroid=!1}return n._isAndroid},enumerable:!0,configurable:!0}),n.gameVersion="1.0",n.isDebug=!1,n._enableLog=!0,n._originalLogFun=null,n.logHandler=null,n._currentPlatform=0,n._isIOS=void 0,n._isAndroid=void 0,n);function n(){}t.default=i}),define("newfunction/gamecore/deer/DeerRequest",["require","exports","newfunction/gamecore/deer/DeerSDK","newfunction/gamecore/libs/md5","newfunction/gamecore/base/GameValues"],function(e,t,s,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(Object.defineProperty(n.prototype,"isComplete",{get:function(){return this._isComplete},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),n.prototype.onSuccess=function(e){null!=e&&(!0!==this._isComplete?-1==this._successHandlers.indexOf(e)&&this._successHandlers.push(e):!0===this._isSuccess&&e(this._data))},n.prototype.requestSuccessHandler=function(e){null!=this._dataFactory&&(e=this._dataFactory(e)),this._isComplete=!0,this._isSuccess=!0,this._data=e;for(var t=0;t<this._successHandlers.length;t++)(0,this._successHandlers[t])(e);this._successHandlers=[]},n.prototype.onFail=function(e){null!=e&&(!0!==this._isComplete?-1==this._failHandlers.indexOf(e)&&this._failHandlers.push(e):!1===this._isSuccess&&e(this._data))},n.prototype.requestFailHandler=function(e){if(this._hasTriedTimes<this.tryTimes)return this._hasTriedTimes++,void this.sendRequest();this._isComplete=!0,this._isSuccess=!1,this._data=e;for(var t=0;t<this._failHandlers.length;t++)(0,this._failHandlers[t])(e);this._failHandlers=[]},n.prototype.sendRequest=function(){var e;if(this._apiURL.match(/^https?:/i)?e=this._apiURL:(e=o.default.isDebug?s.DEER_API_URL_TEST:s.DEER_API_URL,"/"!=this._apiURL.charAt(0)&&(this._apiURL="/"+this._apiURL),"/"!=(e+=this._apiURL).charAt(e.length-1)&&(e+="/")),console.log("---------------------------------------"),console.log("【sendRequest】"),console.log("url is "+e),console.log("data is",this._requestData),"undefined"!=typeof wx){null==this._requestData.ts&&(this._requestData.ts=Math.floor(s.default.instance.serverTime.getTime()/1e3)),this.md5Data(this._requestData);var i=this;wx.request({url:e,data:i._requestData,header:{"Content-Type":"application/x-www-form-urlencoded"},method:this._requestMethod.toUpperCase(),success:function(e){console.log("【sendRequest】success",i._apiURL,e);var t=e.data;if(t){try{t.data.status=t.status}catch(e){}i.requestSuccessHandler(t.data)}else i.requestSuccessHandler(null)},fail:function(e){console.log("【sendRequest】fail",i._apiURL,e),i.requestFailHandler(e)},complete:function(){console.log("【sendRequest】complete",i._apiURL)}})}},n.prototype.destory=function(){this._failHandlers=[],this._successHandlers=[],this._dataFactory=null},n.prototype.md5Data=function(e){if(e){var t=Object.keys(e);t.sort();for(var i="",n=0;n<t.length;n++){var a=t[n];0!=a.indexOf("__")&&(""!=i&&(i+="&"),i+=a+"="+e[a])}i+="&"+this.md5key,e.__md5=r.md5(i)}},n);function n(e,t,i,n,a,r){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=null),void 0===a&&(a=null),void 0===r&&(r="GET"),this.tryTimes=1,this._successHandlers=[],this._failHandlers=[],this._hasTriedTimes=0,null!=i&&this._successHandlers.push(i),null!=n&&this._failHandlers.push(n),t&&(t.__v=s.DEER_SDK_VERSION,t.__gv=o.default.gameVersion),this._apiURL=e,this._requestData=t,this._dataFactory=a,this._requestMethod=r||"GET",this.sendRequest()}t.default=i}),define("newfunction/gamecore/managers/event/EventData",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(Object.defineProperty(n.prototype,"isStopedPropagation",{get:function(){return this._isStopedPropagation},enumerable:!0,configurable:!0}),n.prototype.stopPropagation=function(){this._isStopedPropagation=!0},n);function n(e,t){this._isStopedPropagation=!1,this.type=e,this.data=t}t.default=i}),define("newfunction/gamecore/base/Callback",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function i(e,t){this.callback=e,this.thisObj=t}t.default=i}),define("newfunction/gamecore/managers/event/EventCallBack",["require","exports","newfunction/gamecore/base/Callback"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=i.default,__extends(r,n),r.prototype.clone=function(){var e=new r(this.callback,this.thisObj);return e.index=this.index,e.type=this.type,e},r);function r(e,t){var i=n.call(this,e,t)||this;return i.once=!1,i}t.default=a}),define("newfunction/gamecore/base/Dictionary",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(Object.defineProperty(n.prototype,"length",{get:function(){return this.m_keys.length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"values",{get:function(){return this.m_values.concat()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"keys",{get:function(){return this.m_keys.concat()},enumerable:!0,configurable:!0}),n.prototype.indexOf=function(e){return this.m_keys.indexOf(e)},n.prototype.add=function(e,t){var i=this.indexOf(e);0<=i?this.m_values[i]=t:(this.m_keys.push(e),this.m_values.push(t))},n.prototype.get=function(e){var t=this.indexOf(e);return 0<=t?this.m_values[t]:null},n.prototype.remove=function(e){var t=this.indexOf(e);return 0<=t?(this.m_keys.splice(t,1),this.m_values.splice(t,1)[0]):null},n.prototype.clear=function(){this.m_keys.length=0,this.m_keys=[],this.m_values.length=0,this.m_values=[]},n.prototype.getRandomData=function(){var e=Math.random()*this.keys.length<<0;return this.m_values[e]},n.prototype.getRandomKey=function(){var e=Math.random()*this.keys.length<<0;return this.m_keys[e]},n);function n(){this.m_keys=[],this.m_values=[]}t.default=i}),define("newfunction/gamecore/managers/event/EventDispacher",["require","exports","newfunction/gamecore/managers/event/EventData","newfunction/gamecore/managers/event/EventCallBack","newfunction/gamecore/base/Dictionary"],function(e,t,n,c,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(r.prototype.addEventListener=function(e,t,i,n,a){if(void 0===n&&(n=0),void 0===a&&(a=!1),t&&i){var r=new c.default(t,i);r.type=e,r.index=n,r.once=a;var s=this._callbackMaps.get(e);if(s){for(var o=!1,l=s.length-1;0<=l;l--){var h=s[l];if(h.thisObj===i&&h.callback===t){h.once=a,h.index=n,o=!0;break}}o||(s.push(r),s.sort(this.sortPriority))}else this._callbackMaps.add(e,[r])}},r.prototype.sortPriority=function(e,t){return t.index-e.index},r.prototype.hasEventListener=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null);var n=this._callbackMaps.get(e);if(n){if(!t||!i)return!0;for(var a=0,r=n.length;a<r;a++){var s=n[a];if(s.callback===t&&s.thisObj===i)return!0}}return!1},r.prototype.removeEventListener=function(e,t,i){var n=this._callbackMaps.get(e);if(n)for(var a=0,r=n.length;a<r;a++){var s=n[a];s.callback===t&&s.thisObj===i&&(n.splice(a,1),r--,a--)}},r.prototype.dispatchEvent=function(e){for((e.target=this)._sendBuffer.push(e);0<this._sendBuffer.length;){e=this._sendBuffer.shift();var t=this._callbackMaps.get(e.type);if(t)for(var i=t.concat(),n=0,a=i.length;n<a;n++){var r=i[n];if(-1!=t.indexOf(r)&&(r.callback.call(r.thisObj,e),r.once&&this.removeEventListener(e.type,r.callback,r.thisObj),e.isStopedPropagation))break}else console.log("事件ID:"+e.type+"无监听回调")}},r.prototype.dispatchEventWith=function(e,t){void 0===t&&(t=null);var i=new n.default(e,t);this.dispatchEvent(i)},r.prototype.destory=function(){this._callbackMaps=new i.default,this._sendBuffer=[]},r);function r(){this._callbackMaps=new i.default,this._sendBuffer=[]}t.default=a}),define("newfunction/gamecore/deer/DeerSDKEventNames",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.READY="ready",n.CHANGE="change",n.HANDSHAKE_COMPLETE="handshakeComplete",n.CONFIG_READY="configReady",n.NEW_MESSAGES="newMessages",n.FRIENDS_UPDATE="friendsUpdate",n.LUCKY_MONEY_UPDATE="luckyMoneyUpdate",n);function n(){}t.default=i}),define("newfunction/gamecore/platforms/QQCM_gameInfo",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={gameId:null,gameName:null,roomId:null,openId:null,seesionId:null,sex:0,accessTokenCode:0,accessToken:null,gameParam:null,QQVer:null,platform:null,model:null}}),define("newfunction/gamecore/deer/DeerSDK",["require","exports","newfunction/gamecore/deer/DeerRequest","newfunction/gamecore/managers/event/EventDispacher","newfunction/gamecore/deer/DeerSDKEventNames","newfunction/gamecore/platforms/QQCM_gameInfo","newfunction/gamecore/base/GameValues"],function(e,t,l,i,h,a,c){"use strict";var o,n,r,s,u,d,_,p;Object.defineProperty(t,"__esModule",{value:!0}),t.DEER_SDK_VERSION="1.5",t.DEER_API_URL="https://deer-cms.youkongwan.com",t.DEER_API_URL_TEST="https://deer-cms-test.youkongwan.com",t.DEER_SAVE_GAME_DATA_DELAY=30,(n=o=t.DeerDeviceType||(t.DeerDeviceType={}))[n.ALL=0]="ALL",n[n.IOS=1]="IOS",n[n.ANDROID=2]="ANDROID",(r=t.DeerAdType||(t.DeerAdType={}))[r.RECOMMEND=1]="RECOMMEND",r[r.HOT=2]="HOT",r[r.GAME_OVER=3]="GAME_OVER",r[r.TASK=4]="TASK",r[r.BOARD=5]="BOARD",r[r.RICH=9]="RICH",r[r.BANNER=10]="BANNER",r[r.ANIMATION=11]="ANIMATION",r[r.SPLASH=12]="SPLASH",r[r.POP=13]="POP",(u=s=t.DeerItemType||(t.DeerItemType={}))[u.REBIRTH=1]="REBIRTH",u[u.DIAMDOND=2]="DIAMDOND",u[u.SCORE=3]="SCORE",(_=d=t.DeerTrackAction||(t.DeerTrackAction={}))[_.GAME_START=1001]="GAME_START",_[_.GAME_SHARE=1002]="GAME_SHARE",_[_.SHOW_REWARD_AD_SUC=1003]="SHOW_REWARD_AD_SUC",_[_.AD_REQUEST=2001]="AD_REQUEST",_[_.AD_SHOW=2002]="AD_SHOW",_[_.AD_CLICK=2003]="AD_CLICK",_[_.AD_NAVIGATE=2004]="AD_NAVIGATE",_[_.SHARE_IMG_SHOW=3001]="SHARE_IMG_SHOW",_[_.SHARE_IMG_CLICK=3002]="SHARE_IMG_CLICK",(p=t.DeerMessageType||(t.DeerMessageType={}))[p.MAIL=1]="MAIL",p[p.ADD_FRIEND_REQUEST=2]="ADD_FRIEND_REQUEST",p[p.U2U=3]="U2U",p[p.WORLD_CHAT_MSG=10]="WORLD_CHAT_MSG",p[p.SYSTEM_MSG=11]="SYSTEM_MSG";var f=(m.prototype.setReaded=function(){this.readed||M.instance.game_messageReaded(this.id)},m);function m(){this.id=0,this.type=0,this.createTime=null,this.readed=!1}t.DeerMessageVO=f;var g,v,y=(Object.defineProperty(C.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"openID",{get:function(){return this._openID},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"address",{get:function(){return this._address},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"nickname",{get:function(){return this._nickname},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"avatar",{get:function(){return this._avatar},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"isVIP",{get:function(){return this._isVIP},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"achieveValue",{get:function(){return this._achieveValue},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"lastLoginTime",{get:function(){return this._lastLoginTime},enumerable:!0,configurable:!0}),C);function C(t){var i=this;if(void 0===t&&(t=null),this.index=-1,this.amount=0,this._id=0,this._nickname="",this._isVIP=!1,this._achieveValue=0,t){if(t.user_id&&(this._id=parseInt(t.user_id),delete t.user_id),t.avatar_url&&(this._avatar=t.avatar_url,delete t.avatar_url),t.address&&(this._address=t.address,delete t.address),t.player_name&&(this._nickname=t.player_name,delete t.player_name),t.openId&&(this._openID=t.openId,delete t.openId),t.achieve_v&&(this._achieveValue=t.achieve_v,delete t.achieve_v),t.user_attr){var e=parseInt(""+t.user_attr);0<e&&(this._isVIP=1==(1&e)),delete t.user_attr}t.last_time&&0<t.last_time&&(this._lastLoginTime=new Date,this._lastLoginTime.setTime(1e3*t.last_time),delete t.last_time),Object.keys(t).forEach(function(e){try{i[e]=t[e]}catch(e){}})}}t.DeerUserVO=y,(v=g=t.DeerFriendType||(t.DeerFriendType={}))[v.UNKNOW=0]="UNKNOW",v[v.MANUAL=1]="MANUAL",v[v.SHARE=2]="SHARE";var E,S=(__extends(x,E=y),Object.defineProperty(x.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),x);function x(e){void 0===e&&(e=null);var t=this,i=null;return e&&e.type&&(i=parseInt(e.type),delete e.type),t=E.call(this,e)||this,i&&(t._type=i),t}t.DeerFriendVO=S;var T=function(){this.id=0,this.amount=0};t.DeerLuckyMoney=T;var w,M=(w=i.default,__extends(b,w),b.initSDK=function(e,t,i){void 0===t&&(t=void 0),void 0===i&&(i=void 0),b.instance.isReady||(b.instance._appID=e,t&&!b.instance._inviterChannel&&(b.instance._inviterChannel=""+t),i&&!b.instance._inviterAdID&&(b.instance._inviterAdID=""+i),b.instance.addEventListener(h.default.HANDSHAKE_COMPLETE,b.instance.handshakeCompleteHandler,b.instance),b.instance.wxLogin())},Object.defineProperty(b,"instance",{get:function(){return b._instance||(b._instance=new b(new R)),b._instance},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"appID",{get:function(){return this._appID},enumerable:!0,configurable:!0}),b.prototype.analyseWXData=function(e){console.log("【DeerSDK】analyseWXData",e);try{this._isFromMyFavorite=1104==e.scene,e.referrerInfo&&e.referrerInfo.appId&&(this._fromAppID=e.referrerInfo.appId)}catch(e){}try{var t=e.query;if(t.deer_uid&&(this._inviterUserID=t.deer_uid),t.deer_nn&&(this._inviterNickname=decodeURIComponent(t.deer_nn)),t.deer_av&&(this._inviterAvatar=decodeURIComponent(t.deer_av)),t.deer_chid&&(this._inviterChannel=t.deer_chid),t.deer_adid&&(this._inviterAdID=t.deer_adid),t.deer_enid&&(this._inviterAdEnterID=t.deer_enid),t.deer_shrid&&(this._inviterShareImgID=t.deer_shrid),t.deer_chid&&c.default.saveLocalData("deer_chid",t.deer_chid),t.deer_adid&&c.default.saveLocalData("deer_adid",t.deer_adid),t.time){var i=parseInt(t.time);!isNaN(i)&&0<i&&(this._inviterTime=new Date,this._inviterTime.setTime(i))}}catch(e){}},b.prototype.handshakeCompleteHandler=function(e){if(this.removeEventListener(h.default.HANDSHAKE_COMPLETE,this.handshakeCompleteHandler,this),console.log("******************* 【DeerSDK】 *******************"),console.log("*******************  "+(this._isReady?"握手成功":"握手失败")+"  *******************"),console.log("**************************************************"),this._isReady){var t=0;this._inviterUserID&&(t=1),this.track(d.GAME_START,{v:t}),this._inviterShareImgID&&this.track(d.SHARE_IMG_CLICK,{share_id:this._inviterShareImgID}),this.game_getConfigDataFromService(),this._inviterUserID&&this.user_friendAdd(parseInt(this._inviterUserID),g.SHARE)}},Object.defineProperty(b.prototype,"sdkVersion",{get:function(){return t.DEER_SDK_VERSION},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"wx",{get:function(){return this._wxProxy},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"userVO",{get:function(){return this._userVO},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isOnline",{get:function(){return this._isOnline},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"serverTime",{get:function(){if(isNaN(this._serverTimeS))return new Date;var e=new Date;return e.setTime(1e3*this._serverTimeS),e},enumerable:!0,configurable:!0}),b.prototype.addServerTime=function(){this._serverTimeS++,this._passedSeconds++,0<this._passedSeconds&&this._passedSeconds%5==0&&this.sendTracks(),this._game_sdts_data&&this._serverTimeS-this._game_sdts_time>t.DEER_SAVE_GAME_DATA_DELAY&&this.game_saveDataToServiceNow(this._game_sdts_data),this.game_messageRefreshInterval(),!this._user_friendsAll&&b.instance.hasEventListener(h.default.NEW_MESSAGES)&&this.user_friendsRefresh()},Object.defineProperty(b.prototype,"isReady",{get:function(){return this._isReady},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isHandshakeCompleted",{get:function(){return this._isHandshakeCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isNewUser",{get:function(){return this._isNewUser},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isDisabled",{get:function(){return this._isDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fromAppID",{get:function(){return this._fromAppID},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"inviterUserID",{get:function(){return this._inviterUserID},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"inviterNickname",{get:function(){return this._inviterNickname},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"inviterAvatar",{get:function(){return this._inviterAvatar},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"inviterAdID",{get:function(){return this._inviterAdID},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"inviterAdEnterID",{get:function(){return this._inviterAdEnterID},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"inviterChannel",{get:function(){return this._inviterChannel},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"inviterTime",{get:function(){return this._inviterTime},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isFromMyFavorite",{get:function(){return this._isFromMyFavorite},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"canUseEasingPolicy",{get:function(){return this._isOnline&&this._remoteAllowed},enumerable:!0,configurable:!0}),b.prototype.handshakeRetry=function(){this._isHandshakeCompleted&&!this._isReady&&(this._isHandshakeCompleted=!1,this.addEventListener(h.default.HANDSHAKE_COMPLETE,this.handshakeCompleteHandler,this),b.instance.wxLogin())},b.prototype.wxLogin=function(){if("undefined"==typeof wx)return this._isHandshakeCompleted=!0,void this.dispatchEventWith(h.default.HANDSHAKE_COMPLETE);wx.login({success:this.wxLoginSucCallback.bind(this),fail:this.wxLoginFailCallback.bind(this)})},b.prototype.wxLoginSucCallback=function(e){var i=this;if(console.log("【DeerSDK wx.login成功】"),console.log(JSON.stringify(e)),!e||!e.code)return this._isHandshakeCompleted=!0,void this.dispatchEventWith(h.default.HANDSHAKE_COMPLETE);var n=e.code;if(3==c.default.currentPlatform)wx.getUserInfo({withCredentials:!0,lang:"zh_CN",success:function(e){i._userInfo=e.userInfo;var t={app_id:i._appID,game_id:a.default.gameId,open_key:n,open_id:a.default.openId,avatar:i._userInfo.avatarUrl,nickName:i._userInfo.nickName,gender:i._userInfo.gender};i._fromAppID&&(t.from_app=i._fromAppID),i._inviterAdID&&(t.iv_adid=i._inviterAdID),i._inviterAdEnterID&&(t.iv_enid=i._inviterAdEnterID),i._inviterChannel&&(t.iv_chid=i._inviterChannel),new l.default("/api/user_info_qq",t,i.userInfoSucCallback.bind(i),i.userInfoFailCallback.bind(i))},fail:function(e){console.log("【DeerSDK】 wx.getUserInfo 失败，QQ厘米秀")}});else if(5==c.default.currentPlatform)wx.getUserInfo({success:function(e){console.log("getUserInfo, res=",e),i._userInfo=e.userInfo;var t=JSON.parse(JSON.stringify(i._userInfo));t.app_id=i._appID,new l.default("/api/user_info_oppo/",t,i.userInfoSucCallback.bind(i),i.userInfoFailCallback.bind(i))},fail:function(e){console.log("【DeerSDK】 wx.getUserInfo 失败，Oppo")}});else if(6==c.default.currentPlatform)wx.getUserInfo({success:function(e){console.log("getUserInfo, res=",e),i._userInfo=e.userInfo;var t=JSON.parse(JSON.stringify(i._userInfo));t.app_id=i._appID,new l.default("/api/user_info_ios/",t,i.userInfoSucCallback.bind(i),i.userInfoFailCallback.bind(i))},fail:function(e){console.log("【DeerSDK】 wx.getUserInfo 失败，Oppo")}});else{var t={app_id:this._appID,code:n};this._fromAppID&&(t.from_app=this._fromAppID),this._inviterAdID&&(t.iv_adid=this._inviterAdID),this._inviterAdEnterID&&(t.iv_enid=this._inviterAdEnterID),this._inviterChannel&&(t.iv_chid=this._inviterChannel),new l.default("/api/user_info",t,this.userInfoSucCallback.bind(this),this.userInfoFailCallback.bind(this)),this.getWXUserInfo()}},b.prototype.wxLoginFailCallback=function(e){console.log("【DeerSDK wx.login失败】"),this._isHandshakeCompleted=!0,this.dispatchEventWith(h.default.HANDSHAKE_COMPLETE)},b.prototype.getWXUserInfo=function(){var t=this;1==c.default.currentPlatform?wx.getSetting({success:function(e){e.authSetting["scope.userInfo"]?t.doWXUserInfoIsReady():setTimeout(t.getWXUserInfo.bind(t),1e4)}}):this.doWXUserInfoIsReady()},b.prototype.doWXUserInfoIsReady=function(){var n=this;this._userInfo||(console.log("【DeerSDK wx.getUserInfo 成功】"),wx.login({success:function(e){var i=e.code;wx.getUserInfo({withCredentials:!0,lang:"zh_CN",success:function(e){n._userInfo=e.userInfo;var t={app_id:n._appID,code:i,iv:e.iv,raw_data:e.rawData,encrypted_data:e.encryptedData,signature:e.signature};n._inviterAdID&&(t.in_adid=n._inviterAdID),n._inviterAdEnterID&&(t.iv_enid=n._inviterAdEnterID),n._inviterChannel&&(t.in_chid=n._inviterChannel),new l.default("/api/user_info",t)}})}}))},b.prototype.userInfoSucCallback=function(e){try{this.analyseLoginData(e),console.log("DeerSdk Ready ok!"),this._isReady=!0,this.dispatchEventWith(h.default.READY)}catch(e){console.log("【DeerSDK握手成功，数据解析失败】")}this._isHandshakeCompleted=!0,this.dispatchEventWith(h.default.HANDSHAKE_COMPLETE)},b.prototype.userInfoFailCallback=function(e){this._isHandshakeCompleted=!0,this.dispatchEventWith(h.default.HANDSHAKE_COMPLETE)},b.prototype.analyseLoginData=function(e){if(this._game_id=parseInt(e.game_id),e.game_uid&&(this._game_userID=""+e.game_uid),this._userVO=new y(e.user_detail),null!=e.time?this._serverTimeS=Math.floor(e.time):this._serverTimeS=Math.floor((new Date).getTime()/1e3),setInterval(function(){b.instance.addServerTime()},1e3),this._session=e.session_key,!this._session)throw new Error("session is null");if(e.msg_id&&(this._userDataID=e.msg_id),this._isNewUser=!0===e.new_user,this._game_detail=e.game_detail,this._game_detail){this._isDisabled=!0===this._game_detail.disable,this._remoteAllowed=!0===this._game_detail.refe,delete this._game_detail.refe;var t=this._game_detail.game_version,i=c.default.gameVersion;try{i=i||"0";for(var n=(t=t||"0").split("."),a=i.split("."),r=Math.max(a.length,n.length);a.length<r;)a.push("0");for(;n.length<r;)n.push("0");for(var s=!0,o=0;o<r;o++){var l=parseInt(a[o]),h=parseInt(n[o]);if(l!=h){h<l&&(s=!1);break}}this._isOnline=s}catch(e){}}},b.prototype.user_setVIP=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=null),this._isReady){if(this._userVO.isVIP!==e){this._userVO._isVIP=e;var n={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,type:e?1:0};this._game_getConfigDataRequest=new l.default("/api/save_user_vip",n,this.user_setVIP_suc.bind(this),this.user_setVIP_suc_fail.bind(this)),this._game_getConfigDataRequest.onFail(i),this._game_getConfigDataRequest.onSuccess(t)}}else i&&i()},b.prototype.user_setVIP_suc=function(e){},b.prototype.user_setVIP_suc_fail=function(e){this._userVO._isVIP=!this._userVO.isVIP},Object.defineProperty(b.prototype,"user_friendsAll",{get:function(){return this._user_friendsAll?this._user_friendsAll.concat():(this.user_friendsRefresh(),null)},enumerable:!0,configurable:!0}),b.prototype.user_friendsRefresh=function(e,t){if(void 0===e&&(e=null),void 0===t&&(t=null),!this._user_refreshFriendsRequest){var i={user_id:this._userVO.id,session_key:this._session};this._user_refreshFriendsRequest=new l.default("/friend/friend_list",i,this.user_friendsRefresh_suc.bind(this),this.user_friendsRefresh_fail.bind(this),this.user_friendsRefresh_data.bind(this))}this._user_refreshFriendsRequest.onFail(t),this._user_refreshFriendsRequest.onSuccess(e)},b.prototype.user_friendsRefresh_data=function(e){var i=[];try{e.forEach(function(e){var t=new S(e);t.id&&i.push(t)})}catch(e){}return i},b.prototype.user_friendsRefresh_suc=function(e){this._user_refreshFriendsRequest=null,this._user_friendsAll=e,this._user_friendsAll||(this._user_friendsAll=[]),this.dispatchEventWith(h.default.FRIENDS_UPDATE)},b.prototype.user_friendsRefresh_fail=function(e){this._user_refreshFriendsRequest=null},b.prototype.user_friendAdd=function(e,t,i,n){void 0===i&&(i=null),void 0===n&&(n=null);var a={user_id:this._userVO.id,friend_id:e,type:t,session_key:this._session},r=new l.default("/friend/add_friend",a,this.user_friendAdd_suc.bind(this),this.user_friendAdd_fail.bind(this));r.onFail(n),r.onSuccess(i)},b.prototype.user_friendAdd_suc=function(e){try{var t=new S(e);t.id&&t.avatar&&t.nickname&&(this._user_friendsAll||(this._user_friendsAll=[]),this._user_friendsAll.push(t),this.dispatchEventWith(h.default.FRIENDS_UPDATE))}catch(e){}},b.prototype.user_friendAdd_fail=function(e){},b.prototype.user_friendRemove=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null);var n={user_id:this._userVO.id,friend_id:e,session_key:this._session},a=new l.default("/friend/del_friend",n,this.user_friendRemove_suc.bind(this),this.user_friendRemove_fail.bind(this));a.onFail(i),a.onSuccess(t)},b.prototype.user_friendRemove_suc=function(e){try{var t=new S(e);if(t.id&&t.avatar&&t.nickname&&this._user_friendsAll)for(var i=this._user_friendsAll.length,n=0;n<i;n++)if(this._user_friendsAll[n].id==t.id){this._user_friendsAll.splice(n,1),this.dispatchEventWith(h.default.FRIENDS_UPDATE);break}}catch(e){}},b.prototype.user_friendRemove_fail=function(e){},b.prototype.user_friendsCount=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var i={user_id:this._userVO.id,session_key:this._session},n=new l.default("/friend/friend_num",i,this.user_friendsCount_suc.bind(this),this.user_friendsCount_fail.bind(this));n.onFail(t),n.onSuccess(e)},b.prototype.user_friendsCount_suc=function(e){},b.prototype.user_friendsCount_fail=function(e){},Object.defineProperty(b.prototype,"game_id",{get:function(){return this._game_id},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"game_userID",{get:function(){return this._game_userID},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"game_detail",{get:function(){return this._game_detail},enumerable:!0,configurable:!0}),b.prototype.game_getAShareData=function(){if(!this._game_detail)return null;var e=this._game_detail.share_msgs;return e&&0!=e.length?e[Math.floor(e.length*Math.random())]:null},Object.defineProperty(b.prototype,"game_config",{get:function(){return this._game_config},enumerable:!0,configurable:!0}),b.prototype.game_getRecentGames=function(){},b.prototype.game_getConfigDataFromService=function(e,t){if(void 0===e&&(e=null),void 0===t&&(t=null),this._isReady)if(this._game_config)e&&e(this._game_config);else{if(null==this._game_getConfigDataRequest){var i={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session};this._game_getConfigDataRequest=new l.default("/api/get_game_data",i,this.game_getConfigDataFromService_suc.bind(this),this.game_getConfigDataFromService_fail.bind(this))}this._game_getConfigDataRequest.onFail(t),this._game_getConfigDataRequest.onSuccess(e)}else t&&t()},b.prototype.game_getConfigDataFromService_suc=function(e){var t=null==this._game_config;try{this._game_config=JSON.parse(e)}catch(e){console.log("解析游戏配置数据失败！"),this._game_config={}}console.log("游戏配置数据为",this._game_config),t&&this.dispatchEventWith(h.default.CONFIG_READY),this._game_getConfigDataRequest=null},b.prototype.game_getConfigDataFromService_fail=function(e){this._game_getConfigDataRequest=null},Object.defineProperty(b.prototype,"game_score",{get:function(){return this.item_getAmount(s.SCORE)},enumerable:!0,configurable:!0}),b.prototype.game_saveScoreToService=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null),this._isReady?(e=Math.floor(e))<=this.game_score?console.log("提交分数"+e+"小于最高分"+this.game_score):this.item_saveAmountToService(s.SCORE,e,t,i):i&&i()},b.prototype.game_getScoreFromService=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._isReady?this.item_getAmountFromService(s.SCORE,e,t):t&&t()},b.prototype.game_getGlobalRankingData=function(e,t){if(void 0===e&&(e=null),void 0===t&&(t=null),this._isReady){if(!this._game_getGlobalRankingDataRequest){var i={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,type:s.SCORE};this._game_getGlobalRankingDataRequest=new l.default("/api/score_rank",i,this.game_getGlobalRankingData_suc.bind(this),this.game_getGlobalRankingData_fail.bind(this),this.game_getGlobalRankingData_data.bind(this))}this._game_getGlobalRankingDataRequest.onFail(t),this._game_getGlobalRankingDataRequest.onSuccess(e)}else t&&t()},b.prototype.game_getGlobalRankingData_data=function(e){if(e){var t=void 0;e.my_score&&(t=e.my_score=new y(e.my_score));var i=e.score_rank;if(i)for(var n=0,a=i.length;n<a;n++){var r=new y(i[n]);i[n]=r,t&&(t.avatar&&t.avatar==r.avatar?(t.index=n+1,t=null):t.openID&&t.openID==r.openID&&(t.index=n+1,t=null)),r.index=n+1}}return e},b.prototype.game_getGlobalRankingData_suc=function(e){this._game_getGlobalRankingDataRequest=null},b.prototype.game_getGlobalRankingData_fail=function(e){this._game_getGlobalRankingDataRequest=null},b.prototype.game_saveDataToService=function(e){this._game_sdts_data=e},b.prototype.game_saveDataToServiceNow=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null),this._isReady||i&&i(),this._game_sdts_data=null,this._game_sdts_time=this._serverTimeS;var n={ud:e},a={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,msg:JSON.stringify(n)};new l.default("/api/save_game_user_data",a,t,i,null,"POST")},b.prototype.game_getDataFromService=function(i,e){if(void 0===i&&(i=null),void 0===e&&(e=null),this._isReady){var t={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session};new l.default("/api/get_game_user_data",t,function(e){try{var t=JSON.parse(e);i&&i(t.ud)}catch(e){i&&i({})}},e)}else e&&e()},Object.defineProperty(b.prototype,"game_dataID",{get:function(){return this._userDataID},enumerable:!0,configurable:!0}),b.prototype.game_saveDataIDToService=function(t,e,i){var n=this;if(void 0===e&&(e=null),void 0===i&&(i=null),this._userDataID!=t)if(this._isReady){var a={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,msg_id:t},r=new l.default("/api/save_msg_id",a,function(e){n._game_userID=t},function(e){});r.onSuccess(e),r.onFail(i)}else i&&i();else e&&e()},b.prototype.game_getRandomUsers=function(e,t){if(void 0===e&&(e=null),void 0===t&&(t=null),this._isReady){if(!this._game_getRandomUsersRequest){var i={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session};this._game_getRandomUsersRequest=new l.default("/api/random_users",i,this.game_getRandomUsers_suc.bind(this),this.game_getRandomUsers_fail.bind(this),this.game_getRandomUsers_data.bind(this))}this._game_getRandomUsersRequest.onSuccess(e),this._game_getRandomUsersRequest.onFail(t)}else t&&t()},b.prototype.game_getRandomUsers_data=function(e){try{for(var t=this._userVO.id,i=[],n=e.msg,a=0,r=n.length;a<r;a++)n[a].user_id!=t&&i.push(new y(n[a]));return 0<i.length&&(this._lastRandomUsers=i.concat()),i}catch(e){console.log("analyse random user data error",e)}return this._lastRandomUsers&&0<this._lastRandomUsers.length?this._lastRandomUsers.concat():[]},b.prototype.game_getRandomUsers_suc=function(e){this._game_getRandomUsersRequest=null},b.prototype.game_getRandomUsers_fail=function(e){this._game_getRandomUsersRequest=null},b.prototype.game_messageRefreshInterval=function(){b.instance.hasEventListener(h.default.NEW_MESSAGES)&&this._serverTimeS-this._game_messageLastRefreshTime>b.MESSAGE_MIN_DELAY_SECOND&&this.game_messageRefresh()},b.prototype.game_messageRefresh=function(e){if(void 0===e&&(e=0),this._isReady){var t=0;1<this._game_messageRefreshIndex&&(t=Math.floor(this._game_messageLastRefreshTime-b.MESSAGE_MIN_DELAY_SECOND-10));var i={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,index:this._game_messageRefreshIndex,msg_type:e,last_time:t};new l.default("/msg/roll_msg",i,this.game_messageRefresh_suc.bind(this),this.game_messageRefresh_fail.bind(this)),this._game_messageLastRefreshTime=this._serverTimeS}},Object.defineProperty(b.prototype,"game_messageAll",{get:function(){return this._game_messageAll},enumerable:!0,configurable:!0}),b.prototype.game_messageRefresh_suc=function(e){this._game_messageStack||(this._game_messageStack=[]);try{for(var t=e,i=t.length,n=0;n<i;n++){var a=t[n];if(a){var r=parseInt(""+a.id);if(!(r<=0||0<=this._game_messageIDs.indexOf(r))){var s=new f;s.id=r,s.type=a.msg_type,s.readed=!0===a.has_readed,s.title=a.msg_title,s.content=a.msg_content,s.data=a.msg_data;try{var o=JSON.parse(s.data);s.data=o}catch(e){}if(a.from_user_detail){var l=new y(a.from_user_detail);l.id&&(s.fromUser=l)}s.createTime=new Date,s.createTime.setTime(1e3*a.create_time),this._game_messageIDs.push(r),this._game_messageAll.push(s),this._game_messageStack.push(s)}}}this._game_messageRefreshIndex++}catch(e){}0<this._game_messageStack.length&&this.hasEventListener(h.default.NEW_MESSAGES)&&(this.dispatchEventWith(h.default.NEW_MESSAGES,this._game_messageStack),this._game_messageStack=null)},b.prototype.game_messageRefresh_fail=function(e){},b.prototype.game_messageReaded=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=null),this._isReady&&!(e<=0)){var n={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,msg_id:e};new l.default("/msg/readed_msg",n,t,i)}},b.prototype.game_messageSendToUser=function(e,t,i,n,a,r){if(void 0===n&&(n=null),void 0===a&&(a=null),void 0===r&&(r=null),this._isReady&&!(e<=0)){var s={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,to_user_id:e,msg_title:t,msg_content:i};n&&(s.msg_data=JSON.stringify(n)),new l.default("/msg/user_to_user",s,a,r)}},b.prototype.game_achievementSave=function(e,t,i,n){if(void 0===t&&(t=0),void 0===i&&(i=null),void 0===n&&(n=null),this._isReady&&e){var a={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,achieve_id:e,achieve_v:t};new l.default("/achieve/save_achieve",a,i,n)}},b.prototype.game_achievementObtainedUsers=function(e,t,i,n,a){if(void 0===t&&(t=10),void 0===i&&(i=1),void 0===n&&(n=null),void 0===a&&(a=null),this._isReady&&e){var r={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,achieve_id:e,num:t,order:i};new l.default("/achieve/get_achieve",r,n,a,this.game_achievementObtainedUsers_data.bind(this))}},b.prototype.game_achievementObtainedUsers_data=function(e){var t=[];try{for(var i=e,n=0;n<i.length;n++){var a=new y(i[n]);a&&a.id&&a.nickname&&t.push(a)}}catch(e){}return t},Object.defineProperty(b.prototype,"luckyMoney_myBalance",{get:function(){return this._luckyMoney_myBalance},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"luckyMoney_minWithdrawalAmount",{get:function(){return this._luckyMoney_minWithdrawalAmount},enumerable:!0,configurable:!0}),b.prototype.luckyMoney_registerTypes=function(e){var t=this;if(e){if(this._luckyMoneyTypes)throw new Error("You'd registered the types of lucky toney!");this._luckyMoneyData={},this._luckyMoneyTypes=e.concat(),this.isReady?(this.luckyMoney_refreshMyBalance(),this.luckyMoney_refresh()):this.addEventListener(h.default.READY,function(e){t.luckyMoney_refreshMyBalance(),t.luckyMoney_refresh()},this,0,!0)}},b.prototype.luckyMoney_refresh=function(e){if(void 0===e&&(e=null),this._isReady&&(e=e||this._luckyMoneyTypes)&&0!=e.length){var t={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,strategy_id:e.join(",")};new l.default("/packet/get_order",t,this.luckyMoney_refresh_suc.bind(this),this.luckyMoney_refresh_fail.bind(this),this.luckyMoney_refresh_data.bind(this))}},b.prototype.luckyMoney_refresh_data=function(e){var n=this;try{e.forEach(function(e){var t=new T;t.id=e.user_order_id,t.amount=e.order_money,t.type=e.strategy_id;var i=n._luckyMoneyData[t.type];(i=i||(n._luckyMoneyData[t.type]=[])).push(t)}),this.dispatchEventWith(h.default.LUCKY_MONEY_UPDATE)}catch(e){console.log("analyse lucky money data error",e)}return[]},b.prototype.luckyMoney_refresh_suc=function(e){},b.prototype.luckyMoney_refresh_fail=function(e){},b.prototype.luckyMoney_dispach=function(t,e,i){var n=this;if(void 0===e&&(e=null),void 0===i&&(i=null),this._isReady&&t){var a={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,order_id:t.id,strategy_id:t.type},r=new l.default("/packet/send_packet",a,function(e){e&&0<e.balance&&(n._luckyMoney_myBalance=e.balance,n.dispatchEventWith(h.default.LUCKY_MONEY_UPDATE)),n.luckyMoney_refresh([t.type])},function(e){});r.onSuccess(e),r.onFail(i)}else i&&i()},b.prototype.luckyMoney_getOne=function(e){var t=this._luckyMoneyData[e];return t&&0<t.length?t.shift():null},b.prototype.luckyMoney_exist=function(e){var t=this._luckyMoneyData[e];return!!(t&&0<t.length)},b.prototype.luckyMoney_refreshMyBalance=function(){if(this._isReady){var e={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session};new l.default("/packet/get_user_amount",e,this.luckyMoney_getMyBalance_suc.bind(this),this.luckyMoney_getMyBalance_fail.bind(this))}},b.prototype.luckyMoney_getMyBalance_suc=function(e){try{0<e.balance&&(this._luckyMoney_myBalance=e.balance),0<e.min_withdraw_amount&&(this._luckyMoney_minWithdrawalAmount=e.min_withdraw_amount),this.dispatchEventWith(h.default.LUCKY_MONEY_UPDATE)}catch(e){}},b.prototype.luckyMoney_getMyBalance_fail=function(e){},b.prototype.luckyMoney_withdraw=function(e,t,i){if(void 0===e&&(e=null),void 0===t&&(t=null),void 0===i&&(i=null),this._isReady){if(!this._luckyMoney_withdrawRequest){var n={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session};this._luckyMoney_withdrawRequest=new l.default("/packet/withdraw",n,this.luckyMoney_withdraw_suc.bind(this),this.luckyMoney_withdraw_fail.bind(this))}this._luckyMoney_withdrawRequest.onFail(t),this._luckyMoney_withdrawRequest.onSuccess(e),i&&this._luckyMoney_withdrawNeedFollowCallbacks.push(i)}else t&&t()},b.prototype.luckyMoney_withdraw_suc=function(e){e&&(-3==e.status?(this._luckyMoney_withdrawRequest.destory(),this._luckyMoney_withdrawNeedFollowCallbacks.forEach(function(e){e()})):0<e.balance&&(this._luckyMoney_myBalance=e.balance,this.dispatchEventWith(h.default.LUCKY_MONEY_UPDATE))),this._luckyMoney_withdrawRequest=null,this._luckyMoney_withdrawNeedFollowCallbacks=[]},b.prototype.luckyMoney_withdraw_fail=function(e){this._luckyMoney_withdrawRequest=null,this._luckyMoney_withdrawNeedFollowCallbacks=[]},b.prototype.item_getAmount=function(e){var t=this._item_map[e];return null==t||null==t?0:t},b.prototype.item_getAllFromService=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var i={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session};new l.default("/api/get_user_items",i,e,t).onSuccess(this.item_getAllFromService_success.bind(this))},b.prototype.item_getAllFromService_success=function(e){var i=this;try{e.forEach(function(e){var t=""+e.type_id;i._item_map[t]=e.amount})}catch(e){}},b.prototype.item_getAmountFromService=function(i,e,t){var n=this;void 0===e&&(e=null),void 0===t&&(t=null);var a={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,type:i};new l.default("/api/get_item_amount",a,e,t).onSuccess(function(e){var t=e.amount;0<t.length&&(n._item_map[i]=parseInt(t),console.log("记录道具:类型,数量",i,t))})},b.prototype.item_saveAmountToService=function(e,t,i,n){var a=this;void 0===i&&(i=null),void 0===n&&(n=null);var r={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,type:e,amount:t},s=this._item_map[e];this._item_map[e]=t,new l.default("/api/save_item_amount",r,i,n).onFail(function(){a._item_map[e]=s,console.log("【道具保存失败】恢复原始值",e,s)})},b.prototype.ad_getAds=function(e,t){void 0===t&&(t=null);var i=this._adDataMap["ad_"+e];if(t){var n=this._adDataMap["ad_"+e+"_"+t];n&&0<n.length&&(i=n)}return i?i.concat():null},b.prototype.ad_addAds=function(n,e){var a=this;e&&0<e.length&&(this._adDataMap["ad_"+n]=e).forEach(function(e){e.adType=n;var t=e.flag;if(t){var i="ad_"+n+"_"+t;null==a._adDataMap[i]&&(a._adDataMap[i]=[]),a._adDataMap[i].push(e)}})},b.prototype.ad_getAdData=function(i,n,e,a){var r=this;void 0===n&&(n=null),void 0===e&&(e=null),void 0===a&&(a=null);var t=this.ad_getAds(i,a);if(t)null!=n&&n(t);else{var s=this._adRequestMap[i];if(!s){var o={app_id:this._appID,entry_id:i};s=new l.default("/adv/adv",o,function(e){if(delete r._adRequestMap["ad_"+i],r.track(d.AD_REQUEST,{enter_id:i}),r.ad_addAds(i,e),null!=n){var t=r.ad_getAds(i,a);n(t)}},function(){delete r._adRequestMap["ad_"+i]},this.ad_getAdData_dataFactory.bind(this))}s.onFail(e)}},b.prototype.ad_getAdData_dataFactory=function(e){var t=[];try{for(var i=e,n=0;n<i.length;n++){var a=i[n],r=new I;r.id=parseInt(a.id),r.appID=a.app_id,r.name=a.name,r.path=a.path,r.desc=a.desc,r.icon=a.icon,r.img_256_129=a.adv_img,r.img_1000_840=a.rich_img,r.previewImg=a.pub_img,r.bannerImg=a.strip_img,r.splashImg=a.screen_img,a.spine&&(r.spine={atlas:a.spine.dh_desc,png:a.spine.dh_chartlet,aniJson:a.spine.dh_file}),r.adValue=parseInt(a.avd_value),r.laya_spine=a.laya_spine;var s=!0;null!=a.equipment&&(r.device=parseInt(a.equipment),(r.device!=o.ANDROID||c.default.isAndroid)&&(r.device!=o.IOS||c.default.isIOS)||(s=!1)),s&&t.push(r)}}catch(e){}return t.concat()},b.prototype.getShareQueryData=function(){var e={deer_uid:this._userVO.id,time:(new Date).getTime()};return this._userInfo&&(e.deer_nn=this._userInfo.nickName,e.deer_av=this._userInfo.avatarUrl),this._inviterChannel&&(e.deer_chid=this._inviterChannel),this._inviterAdID&&(e.deer_adid=this._inviterAdID),this._inviterAdEnterID&&(e.deer_enid=this._inviterAdEnterID),e},b.prototype.track=function(e,t){if(void 0===t&&(t=null),(t=t||{}).aid=e,this._isReady&&(t.user_id=this._userVO.id,t.game_id=this._game_id,t.session=this._session),c.default.gameVersion&&(t.game_v=c.default.gameVersion),t.game_t=this._passedSeconds,this._inviterChannel&&(t.iv_chid=this._inviterChannel),this._inviterAdID&&(t.iv_adid=this._inviterAdID),this._inviterAdEnterID&&(t.iv_adid=this._inviterAdEnterID),this._trackDataStack.push(t),this.trackProxyFun)try{this.trackProxyFun(e,t)}catch(e){}},b.prototype.sendTracks=function(){if(0!=this._trackDataStack.length){var e={more_data:JSON.stringify(this._trackDataStack)};new l.default("api/game_statistic",e,null,null,null,"POST"),this._trackDataStack=[]}},b.prototype.getRequestData=function(){var e={};return e.user_id=this._userVO.id,e.game_id=this._game_id,e.session=this._session,e},b.prototype.sendFeedback=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null);var n={user_id:this._userVO.id,game_id:this._game_id,session_key:this._session,tell:e.cellphone,fb_wx:e.wx,fb_content:e.content};new l.default("/api/feedback",n,t,i)},b.MESSAGE_MIN_DELAY_SECOND=30,b);function b(e){var t=w.call(this)||this;t._userVO=new y,t._isOnline=!0,t._passedSeconds=0,t._isReady=!1,t._isHandshakeCompleted=!1,t._isNewUser=!1,t._isDisabled=!1,t._fromAppID=null,t._inviterUserID=null,t._inviterNickname=null,t._inviterAvatar=null,t._inviterAdID=null,t._inviterAdEnterID=null,t._inviterChannel=null,t._inviterTime=null,t._inviterShareImgID=null,t._isFromMyFavorite=!1,t._remoteAllowed=!0,t._game_id=0,t._game_userID=null,t._game_config=null,t._game_sdts_time=0,t._game_sdts_data=null,t._userDataID=null,t._game_messageLastRefreshTime=0,t._game_messageRefreshIndex=1,t._game_messageIDs=[],t._game_messageAll=[],t._luckyMoneyData={},t._luckyMoney_myBalance=0,t._luckyMoney_minWithdrawalAmount=0,t._luckyMoney_withdrawNeedFollowCallbacks=[],t._item_map={},t._adDataMap={},t._adRequestMap={},t.trackProxyFun=null,t._trackDataStack=[];var i=c.default.getLocalData("deer_chid"),n=c.default.getLocalData("deer_adid"),a=c.default.getLocalData("deer_enid");if(i&&(t._inviterChannel=i),n&&(t._inviterAdID=n),a&&(t._inviterAdEnterID=a),l.default.prototype.md5key="sign_deer_sdk","undefined"!=typeof wx){wx.onHide(function(){t._game_sdts_data&&t.game_saveDataToServiceNow(t._game_sdts_data),t.sendTracks()}),wx.onShow(function(e){console.log("【DeerSDK onShow】",e),e&&t.analyseWXData(e)});var r=wx.getLaunchOptionsSync();t.analyseWXData(r)}return t._wxProxy=new L,t}t.default=M;var R=function(){},L=(A.prototype.shareAppMessage=function(e){"undefined"!=typeof wx&&(M.instance.track(d.GAME_SHARE,{v:2}),this.addShareQueryData(e),console.log("WXProxy shareAppMessage",e),wx.shareAppMessage(e))},A.prototype.addShareQueryData=function(e){if(e){var t=M.instance.getShareQueryData(),i=e.imageUrl;if(i){var n=M.instance.game_detail;if(n&&n.share_msgs)for(var a=n.share_msgs,r=0;r<a.length;r++)if(a[r].share_img==i){M.instance.track(d.SHARE_IMG_SHOW,{share_id:a[r].share_id}),t.deer_shrid=a[r].share_id;break}}var s=e.query||"";Object.keys(t).forEach(function(e){""!=s&&(s+="&"),s+=e+"="+encodeURIComponent(t[e])}),""!=s&&(e.query=s)}},A.prototype.onShareAppMessage=function(t){var i=this;"undefined"!=typeof wx&&(wx.onShareAppMessage(function(){var e=t();return e?(M.instance.track(d.GAME_SHARE,{v:1}),i.addShareQueryData(e),e):{}}),wx.showShareMenu({withShareTicket:!0}))},A.prototype.createRewardedVideoAd=function(e){if("undefined"==typeof wx)return null;var t=wx.createRewardedVideoAd(e);return t?(t.onClose(function(e){e&&1==e.isEnded&&M.instance.track(d.SHOW_REWARD_AD_SUC)}),t):null},A);function A(){}var I=(D.prototype.reportShown=function(){M.instance.track(d.AD_SHOW,{enter_id:this.adType,ad_id:this.id})},D.prototype.reportNavigate=function(){M.instance.track(d.AD_NAVIGATE,{enter_id:this.adType,ad_id:this.id,path:this.path})},D.prototype.navigate=function(t,e,i){var n=this;void 0===t&&(t=!0),void 0===e&&(e=null),void 0===i&&(i=null),M.instance.track(d.AD_CLICK,{enter_id:this.adType,ad_id:this.id,path:this.path});var a=this.appID;3==c.default.currentPlatform&&(a=this.gameID);var r=this.path;r&&(0<=r.indexOf("?")?r+="&deer_enid="+this.adType:r+="?deer_enid="+this.adType,-1==r.indexOf("deer_adid=")&&(r+="&deer_adid="+this.id)),"undefined"!=typeof wx&&wx.navigateToMiniProgram({appId:a,path:r,fail:function(e){if(i&&i(e),t&&null!=n.previewImg&&0<=n.previewImg.indexOf("http"))try{wx.previewImage({urls:[n.previewImg]})}catch(e){}},success:function(){n.reportNavigate(),e&&e()}})},D);function D(){this.id=0,this.device=0,this.icon=null,this.img_256_129=null,this.img_1000_840=null,this.bannerImg=null,this.splashImg=null,this.spine=null,this.adValue=0,this.path=null,this.laya_spine=null,this.adType=0}t.DeerAdVO=I}),define("game/View/SignWin",["require","exports","game/utils/SoundUtils","game/scene/GameSystem","utils/GameSetting","game/View/SignItem","wx/dataCenter","wx/wxInterface","newfunction/gamecore/deer/DeerSDK"],function(e,t,n,a,r,i,s,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c,u=(c=ui.main.SignWinUI,__extends(d,c),d.getJson=function(t){Laya.loader.load(t,Laya.Handler.create(this,function(){var e=Laya.loader.getRes(t);d._json=e,console.log("签到数据",d._json)}),null,Laya.Loader.JSON)},d.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},d.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},d.prototype.onOpened=function(){this.enable(),c.prototype.onOpened.call(this)},d.prototype.enable=function(){this.isReady=0,this.isDown=0,Laya.stage.on("sign",this,this.getReWard),this.img_7d.on(Laya.Event.MOUSE_DOWN,this,this.getReWard,[6]),this.btn_getRw.on(Laya.Event.MOUSE_DOWN,this,this.getPPP),this.btn_double.on(Laya.Event.MOUSE_DOWN,this,this.videoDouble),this.btn_close.on(Laya.Event.MOUSE_DOWN,this,this.closeView),this.signData=d._json.reward,this.signName=d._json.name,s.dataCenter.I.get("lastTime",this.initdata.bind(this)),Laya.stage.event("show")},d.prototype.initdata=function(e){if(e){var t=l.default.instance.serverTime,i=new Date(e);d.overDay=t.getDay()!=i.getDay()||t.getMonth()!=i.getMonth()?1:0}else d.overDay=1;var n=this;s.dataCenter.I.get(n.signName,function(e){function t(){for(var e=0,t=0;t<n.signData.length;t++)n.signData[t].reg=playerCenter.register[t],n.signData[t].deta=t+1,0==n.signData[t].reg&&(e=1);e||(s.dataCenter.I.send("lastTime",Laya.Browser.now()),d.overDay=0),n._list.array=n.signData.slice(0,6);var i=n.signData[6];i.reg&&(n.box_got.visible=!0),0==i.type?(n.img_dia.skin="comp/dio_icon.png",n.text_dia.text="+"+i.num,n.box_dia.x=n.img_7d.width/2-n.box_dia.width/2):3==i.type&&(n.img_dia.skin="comp/img_blue.png",n.text_dia.text="+"+i.num,n.box_dia.x=n.img_7d.width/2-n.box_dia.width/2),n.isReady=1}e?(playerCenter.register=e,t()):(playerCenter.register=[0,0,0,0,0,0,0],s.dataCenter.I.send(n.signName,JSON.stringify(playerCenter.register),t))})},d.prototype.disable=function(){Laya.stage.off("sign",this,this.getReWard),this.img_7d.off(Laya.Event.MOUSE_DOWN,this,this.getReWard),this.btn_getRw.off(Laya.Event.MOUSE_DOWN,this,this.getPPP),this.btn_double.off(Laya.Event.MOUSE_DOWN,this,this.videoDouble),this.btn_close.off(Laya.Event.MOUSE_DOWN,this,this.closeView)},d.prototype.closeView=function(){n.SoundUtils.instance.playSound(a.GameSystem.MUSIC_DIANJI),this.disable(),c.prototype.close.call(this),Laya.stage.event("hind")},d.prototype.notReady=function(){Laya.stage.event("Tip",[{title:"数据还没准备好"}])},d.prototype.videoDouble=function(){n.SoundUtils.instance.playSound(a.GameSystem.MUSIC_DIANJI),!this.isReady||!playerCenter.register&&playerCenter.register.length?this.notReady():this.isDown||(this.isDown=1,o.wxInterface.I.createVideo(function(e){if(1==e){for(var t=0;t<playerCenter.register.length;t++)if(0==playerCenter.register[t]){this.signData[t].num*=2;break}this.getReWard(t)}else Laya.stage.event("Tip",[{title:"广告调取失败"}]);this.isDown=0}.bind(this)))},d.prototype.getPPP=function(){if(n.SoundUtils.instance.playSound(a.GameSystem.MUSIC_DIANJI),!this.isReady||!playerCenter.register&&playerCenter.register.length)this.notReady();else{for(var e=0;e<playerCenter.register.length&&0!=playerCenter.register[e];e++);this.getReWard(e)}},d.prototype.changeSelect=function(){},d.prototype.getReWard=function(e){if(n.SoundUtils.instance.playSound(a.GameSystem.MUSIC_DIANJI),this.isReady)if(r.GameSetting.ismingame&&0!=d.overDay&&!this.isDwon){for(var t=0;t<playerCenter.register.length;t++)if(0==playerCenter.register[t]){if(t!=e)return void Laya.stage.event("Tip",[{title:"今日已签到"}]);break}this.isDwon=1,this.box_got.visible&&(o.wxInterface.I.share("invite"),Laya.timer.once(1e3,this,this.tip));var i=this.signData[e];0==i.type?this.getDiamond("chest",i.num):3==i.type&&this.getDiamond("sapphire",i.num)}else Laya.stage.event("Tip",[{title:"今日已签到"}]);else this.notReady()},d.prototype.tip=function(){Laya.stage.event("Tip",[{title:"领取成功!"}])},d.prototype.getDiamond=function(i,n,e){void 0===e&&(e=null);var a=e,r=this;s.dataCenter.I.get("diamond",function(e){var t=0;null!=e&&null!=e[i]&&(t=e[i]),playerCenter.Dionum[i]=t+n,s.dataCenter.I.send("diamond",playerCenter.Dionum,a),Laya.stage.event("updata_dia"),a||r.sendreg()})},d.prototype.getSkin=function(e){playerCenter.skinArr[e]||(playerCenter.skinArr[e]=1,playerCenter.skinHad[e].had=1,s.dataCenter.I.send("skinArr",playerCenter.skinArr)),this.sendreg()},d.prototype.sendreg=function(){for(var e=0;e<playerCenter.register.length&&0!=playerCenter.register[e];e++);this.isDwon=0,this.tip(),playerCenter.register[e]=1,this.signData[e].reg=1,this._list.array=this.signData.slice(0,6),this._list.refresh(),this.box_got.visible=this.signData[6].reg,s.dataCenter.I.send(this.signName,JSON.stringify(playerCenter.register),function(){console.log("保存时间================="),s.dataCenter.I.send("lastTime",Laya.Browser.now())}),d.overDay=0},d);function d(){var e=c.call(this)||this;return e.isReady=0,e.signData=[],e.isDown=0,e._list.itemRender=i.SignItem,e.box_got.visible=!1,e._list.array=new Array(6),e}t.SignWin=u}),define("wx/dataCenter",["require","exports","wx/GameSaveDataMag","utils/GameSetting","sheets/vo/BallSkin","game/View/SignWin","newfunction/gamecore/deer/DeerSDK"],function(e,t,n,i,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=Laya.HttpRequest,__extends(o,a),Object.defineProperty(o,"I",{get:function(){return o.instance||(o.instance=new o),o.instance},enumerable:!0,configurable:!0}),o.prototype.init=function(){},o.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},o.prototype.login=function(){if(-1!=this.linkNum)if(this.linkNum++,console.log("第"+this.linkNum+"次连接!"),this.offAll(),4<this.linkNum)Laya.stage.event("Tip",{title:"网络已断开",cb:function(){i.GameSetting.ismingame&&Laya.Browser.window.wx.exitMiniProgram()}});else{this.offAll();var o=this,e="https://ball.714398.com/index.php?m=login&type=wechat&appid=wx3c91a34715dd852b&code="+playerCenter.code;a.prototype.send.call(this,e,""),this.once(Laya.Event.COMPLETE,this,function(e){(e=JSON.parse(e)).code&&!playerCenter.token||(playerCenter.token||(playerCenter.openId=e.openid,playerCenter.token=e.token),o.get("skinArr",function(e){var t=s.BallSkin.getAllSkin(),i=0,n=[];if(!e.code){for(var a=e.data.skinArr.split(","),r=0;r<t.length;r++)i=0==r||1==parseInt(a[r])?1:0,n.push(i),t[r].had=i,t[r].num=r;playerCenter.skinArr=n,playerCenter.skinHad=t,o.get("diamond",function(e){if(!e.code&&e.data){var t="",s={};e.data.diamond&&(t=typeof e.data.diamond),"string"==typeof e.data.diamond.chest||"object"==typeof e.data.diamond.chest||"string"==t?(s.chest=0,s.sapphire=0,playerCenter.Dionum=s):"number"==t||0==e.data.diamond?(s.chest=e.data.diamond,s.sapphire=0,playerCenter.Dionum=s):playerCenter.Dionum=e.data.diamond,o.get("lastTime",function(e){e.code||e.data&&e.data.lastTime&&(playerCenter.lastLogin=e.data.lastTime);var a=Laya.Browser.now(),r=new Date(a),t=new Date(playerCenter.lastLogin);r.getDay()==t.getDay()&&r.getMonth()==t.getMonth()||(l.SignWin.overDay=1),o.get("loginTime",function(e){if(!e.code){var t=function(){o.send("loginTime",a,function(){function e(){o.linkNum=-1,Laya.stage.event("GameStart"),Laya.timer.clear(o,o.login)}"{}"==JSON.stringify(s)?e():o.send("diamond",JSON.stringify(s),e)})};if(e.data&&e.data.loginTime){var i=new Date(e.data.loginTime);if(r.getDay()!=i.getDay()||r.getMonth()!=i.getMonth()){var n=[];o.send("invite",n,t)}else t()}else n=[],o.send("invite",n,t)}})})}else console.log("------------获取钻石失败")})}}))}),Laya.timer.once(4e3,this,this.login)}},o.prototype.send=function(e,t,i){void 0===i&&(i=null),n.GameSaveDataMag.saveData(e,t,i)},o.prototype.get=function(e,t){void 0===t&&(t=null),n.GameSaveDataMag.getData(e,t)},o.prototype.sendOther=function(e){this.other=e;var t="https://ball.714398.com/index.php?m=data_load_other&key=invite&appid=wx3c91a34715dd852b&openid="+this.other;a.prototype.send.call(this,t,""),this.once(Laya.Event.COMPLETE,this,this.isNewday)},o.prototype.isNewday=function(e){if(this.prvatedata=JSON.parse(e),!this.prvatedata.code&&this.prvatedata.data){var t="https://ball.714398.com/index.php?m=data_load_other&key=loginTime&appid=wx3c91a34715dd852b&openid="+this.other;a.prototype.send.call(this,t),this.once(Laya.Event.COMPLETE,this,this.onCompleteOther)}},o.prototype.onCompleteOther=function(e){e=JSON.parse(e);var t,i=this.prvatedata,n=[];if(!e.code&&e.data){if(e.data.loginTime){var a=c.default.instance.serverTime,r=new Date(e.data.loginTime);a.getDay()==r.getDay()&&a.getMonth()==r.getMonth()||(t=1)}var s;if(i.data.invite&&i.data.invite,(s={}).url=playerCenter.userInfo.avatarUrl,s.state=0,n.push(s),n.length){var o=JSON.stringify(n);this.once(Laya.Event.COMPLETE,this,function(){this.saveOther(o,t)}),this.send("isShare",Laya.Browser.now())}}},o.prototype.saveOther=function(e,t){var i="https://ball.714398.com/index.php?m=data_save_other&key=invite&val="+e+"&appid=wx3c91a34715dd852b&openid="+this.other,n=a.prototype.send;a.prototype.send.call(this,i,"","post"),this.once(Laya.Event.COMPLETE,this,function(){if(t){console.log("存储他人数据");var e="https://ball.714398.com/index.php?m=data_save_other&key=loginTime&val="+Laya.Browser.now()+"&appid=wx3c91a34715dd852b&openid="+this.other;n(e,"","post")}else Laya.stage.event("readyGame")})},o);function o(){var e=a.call(this)||this;return e.linkNum=0,e}t.dataCenter=r}),define("com/help/GameConfig",["require","exports","wx/dataCenter","newfunction/gamecore/deer/DeerSDK"],function(e,t,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.isNewDay=function(a,r){s.dataCenter.I.get(SAVEKEY.EVERYDAY,function(e){if(e&&e[a]){var t=e[a],i=new Date(t),n=o.default.instance.serverTime;i.getDate()<n.getDate()||i.getMonth()!=n.getMonth()?(e[a]=o.default.instance.serverTime,s.dataCenter.I.send(SAVEKEY.EVERYDAY,e),r(!0)):r(!1)}else(e=e||{})[a]=o.default.instance.serverTime.getTime(),s.dataCenter.I.send(SAVEKEY.EVERYDAY,e),r(!0)})},n.limit=function(e,t){e=Math.min(e,t);var i=(t=Math.max(e,t))-e;return e+Math.random()*i},n.limitInteger=function(e,t){return Math.floor(this.limit(e,t+1))},n.GAME_W=750,n.GAME_H=1334,n.LoGo=null,n.chouqiu=null,n.scene_id=0,n.baseinfo={},n.appid={},n.sharedata={room:{title:"这球能冲吗？在线等，挺急的！",url:"https://xz-cdn.youkongwan.com/game/ballgo/share/1.png"},invite:{title:"球来球往，势不可挡！",url:"https://xz-cdn.youkongwan.com/game/ballgo/share/2.png"},skin:{title:"据说玩这个游戏的都能遇见前前前女友",url:"https://xz-cdn.youkongwan.com/game/ballgo/share/3.png"},battle:{title:"一口气跑了",url:"https://xz-cdn.youkongwan.com/game/ballgo/share/4.png",tail:"分！谁能超越我？"}},n);function n(){}t.GameConfig=i}),define("newfunction/Games2Mag",["require","exports","com/help/GameConfig"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.getGameData=function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},n.outclose=function(){var e=[];this.allclose=this.getGameData();for(var t={},i=0;i<this.count;i++)for(;;){var n=r.GameConfig.limitInteger(0,48),a=this.getGameData();if(!t[n]&&a!=this.allclose){t[n]=this.getGameData();break}}for(i=0;i<49;i++)(a=t[i])?e.push(a):e.push(this.allclose);return console.log("颜色代码",e),e},n.allclose="",n.count=1,n.nowcount=0,n.time=60,n);function n(){}t.Games2Mag=i}),define("newfunction/block",["require","exports","game/utils/SoundUtils","game/scene/GameSystem","newfunction/Games2Mag"],function(e,t,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=(r=ui.main.blockUI,__extends(o,r),Object.defineProperty(o.prototype,"dataSource",{get:function(){return this.closes},set:function(e){this.lb_ok.visible=!1,null==this.sp&&(this.sp=new Laya.Sprite,this.addChildAt(this.sp,0)),this.sp.graphics.clear(),this.closes=e,this.sp.graphics.drawRect(0,0,100,100,e),this.on(Laya.Event.CLICK,this,this.xuanzhong)},enumerable:!0,configurable:!0}),o.prototype.xuanzhong=function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),this.closes!=a.Games2Mag.allclose&&(this.lb_ok.visible=!0,this.off(Laya.Event.CLICK,this,this.xuanzhong),a.Games2Mag.nowcount++,console.log("当前选中数量",a.Games2Mag.nowcount,a.Games2Mag.count),a.Games2Mag.nowcount>=a.Games2Mag.count&&Laya.stage.event("top"))},o.prototype.updateData=function(){},o);function o(){var e=r.call(this)||this;return e.sp=null,e}t.Block=s}),define("newfunction/GameS2",["require","exports","game/utils/SoundUtils","game/scene/GameSystem","newfunction/Games2Mag","game/Ctrl/GameCtrl","newfunction/block"],function(e,t,i,n,a,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,l=(o=ui.main.GameScene2UI,__extends(h,o),h.prototype.enable=function(){this.go_home.on(Laya.Event.CLICK,this,this.goHome),this.list_i.itemRender=s.Block;var e=a.Games2Mag.outclose();this.list_i.array=e,Laya.stage.on("top",this,this.topGame),this.count.text="第"+a.Games2Mag.count+"关",this.startTime()},h.prototype.startTime=function(){var e=this;Laya.timer.clearAll(this),Laya.timer.loop(1e3,this,function(){e.m_time.text=a.Games2Mag.time--+"",a.Games2Mag.time<=0&&(Laya.timer.clearAll(e),e.topGame(2))})},h.prototype.topGame=function(e){void 0===e&&(e=1),1==e&&a.Games2Mag.count++,a.Games2Mag.nowcount=0,a.Games2Mag.time=60;var t=a.Games2Mag.outclose();this.list_i.array=t,this.list_i.refresh(),this.count.text="第"+a.Games2Mag.count+"关",this.startTime()},h.prototype.disable=function(){this.go_home.off(Laya.Event.CLICK,this,this.goHome),Laya.timer.clearAll(this),Laya.stage.off("top",this,this.topGame),this.list_i.array=null,this.list_i.refresh()},h.prototype.goHome=function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),r.GameCtrl.getInstance().runLogic(0)},h);function h(){return o.call(this)||this}t.GameS2=l}),define("com/comp/RoadLineMaterial",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=Laya.BaseMaterial,__extends(a,i),a.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},a.prototype.setTransparent=function(e){void 0===e&&(e=!0),this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=Laya.BaseMaterial.BLENDPARAM_SRC_ALPHA,this.dstBlend=Laya.BaseMaterial.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.srcBlend=1,this.dstBlend=2,this.alphaTest=!0},Object.defineProperty(a.prototype,"diffuseTexture",{get:function(){return this._getTexture(a.DIFFUSETEXTURE)},set:function(e){this._setTexture(a.DIFFUSETEXTURE,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"marginalColor",{set:function(e){this._setColor(a.MARGINALCOLOR,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bendDistance",{set:function(e){this._setNumber(a.BENDDISTANCE,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"specularGloss",{set:function(e){this._setNumber(a.GLOSS,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"color",{set:function(e){this._setColor(a.COLOR,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"specularColor",{set:function(e){this._setColor(a.SPECULAR,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasLight",{set:function(e){e?this._addShaderDefine(a.SHADERDEFINE_ENABLELIGHT):this._removeShaderDefine(a.SHADERDEFINE_ENABLELIGHT)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasLambert",{set:function(e){e?this._addShaderDefine(a.SHADERDEFINE_ENABLELAMBERT):this._removeShaderDefine(a.SHADERDEFINE_ENABLELAMBERT)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasSpecular",{set:function(e){e?this._addShaderDefine(a.SHADERDEFINE_ENABLESPECULAR):this._removeShaderDefine(a.SHADERDEFINE_ENABLESPECULAR)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasFog",{set:function(e){e?this._addShaderDefine(a.SHADERDEFINE_ENABLEFOG):this._removeShaderDefine(a.SHADERDEFINE_ENABLEFOG)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogType",{set:function(e){switch(e){case a.FOGTYPE_LINEAR:this._addShaderDefine(a.SHADERDEFINE_LINEARFOG),this._removeShaderDefine(a.SHADERDEFINE_EXFOG),this._removeShaderDefine(a.SHADERDEFINE_EXPFOG);break;case a.FOGTYPE_EX:this._removeShaderDefine(a.SHADERDEFINE_LINEARFOG),this._addShaderDefine(a.SHADERDEFINE_EXFOG),this._removeShaderDefine(a.SHADERDEFINE_EXPFOG);break;case a.FOGTYPE_EXP:this._removeShaderDefine(a.SHADERDEFINE_LINEARFOG),this._removeShaderDefine(a.SHADERDEFINE_EXFOG),this._addShaderDefine(a.SHADERDEFINE_EXPFOG)}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogColor",{set:function(e){this._setColor(a.FOGCOLOR,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogDensity",{set:function(e){this._setNumber(a.DENSITY,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogGradient",{set:function(e){this._setNumber(a.GRADIENT,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogStart",{set:function(e){this._setNumber(a.FOGSTART,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogEnd",{set:function(e){this._setNumber(a.FOGEND,e)},enumerable:!0,configurable:!0}),a.initShader=function(){var e={a_Position:Laya.VertexElementUsage.POSITION0,a_Normal:Laya.VertexElementUsage.NORMAL0,a_Texcoord:Laya.VertexElementUsage.TEXTURECOORDINATE0},t={u_MvpMatrix:[Laya.Sprite3D.MVPMATRIX,Laya.Shader3D.PERIOD_SPRITE],u_WorldMat:[Laya.Sprite3D.WORLDMATRIX,Laya.Shader3D.PERIOD_SPRITE],u_ViewMatrix:[Laya.BaseCamera.VIEWMATRIX,Laya.Shader3D.PERIOD_CAMERA],u_texture:[a.DIFFUSETEXTURE,Laya.Shader3D.PERIOD_MATERIAL],u_CameraPos:[Laya.BaseCamera.CAMERAPOS,Laya.Shader3D.PERIOD_CAMERA],_Dist:[a.BENDDISTANCE,Laya.Shader3D.PERIOD_MATERIAL],_Color:[a.COLOR,Laya.Shader3D.PERIOD_MATERIAL],_FogColor:[a.FOGCOLOR,Laya.Shader3D.PERIOD_MATERIAL],u_Density:[a.DENSITY,Laya.Shader3D.PERIOD_MATERIAL],u_Gradient:[a.GRADIENT,Laya.Shader3D.PERIOD_MATERIAL],u_FogStart:[a.FOGSTART,Laya.Shader3D.PERIOD_MATERIAL],u_FogEnd:[a.FOGEND,Laya.Shader3D.PERIOD_MATERIAL],_Gloss:[a.GLOSS,Laya.Shader3D.PERIOD_MATERIAL],u_DirectionLight_Direction:[Laya.Scene.POINTLIGHTPOS,Laya.Shader3D.PERIOD_SCENE],u_DirectionLight_Diffuse:[Laya.Scene.POINTLIGHTCOLOR,Laya.Shader3D.PERIOD_SCENE],u_DirectionLight_Ambient:[Laya.Scene.AMBIENTCOLOR,Laya.Shader3D.PERIOD_SCENE]},i=Laya.Shader3D.nameKey.add("RoadLineShader"),n=Laya.ShaderCompile3D.add(i,"attribute vec3 a_Normal;\n\n        attribute vec2 a_Texcoord;\n\n        attribute vec4 a_Position;\n\n        precision highp float;\n\n        uniform mat4 u_MvpMatrix;\n\n        uniform mat4 u_ViewMatrix;\n\n        uniform mat4 u_WorldMat;\n\n        uniform vec4 _QOffset; \n\n        uniform float _Dist; \n\n        uniform vec4 _Color; \n\n        uniform float _Gloss; \n\n        uniform vec4 _Specular; \n\n        uniform vec3 u_CameraPos;\n\n        uniform vec3 u_DirectionLight_Direction;\n\n        uniform vec3 u_DirectionLight_Diffuse;\n\n        uniform vec3 u_DirectionLight_Ambient;\n\n        varying vec4 v_Color;\n\n        varying vec2 v_Texcoord;\n\n        varying vec4 v_EyeSpacePos;\n\n        void main(){\n\n            mat4 mvMatrix = u_ViewMatrix*u_WorldMat;\n\n            highp vec4 vPos =  u_MvpMatrix *a_Position;\n\n            float zOff = vPos.z/_Dist;\n\n            vPos.xyz += a_Normal.xyz*zOff*zOff;\n\n            gl_Position = vPos;\n\n            mat3 worldMat=mat3(u_WorldMat);\n\n            v_EyeSpacePos=mvMatrix*a_Position;\n\n            v_Texcoord=a_Texcoord;\n\n            #ifdef CUSTOM_ENABLELIGHT\n\n            vec3 tempnormal= vec3(0.0,1.0,0.0);\n            vec3 worldNormal=worldMat*tempnormal;\n\n            worldNormal=normalize(worldNormal);\n\n            vec3 m_Position=vec3(u_WorldMat*a_Position);\n\n            vec3 worldLightDir=normalize(u_DirectionLight_Direction-m_Position);\n\n            vec3 ambient=u_DirectionLight_Ambient.xyz*_Color.rgb;\n\n            #ifdef CUSTOM_ENABLELAMBERT\n\n            float lambert=max(0.0, dot(worldNormal, worldLightDir));\n\n            #else\n\n            float lambert=0.5 * dot(worldNormal, worldLightDir) + 0.5;\n\n            #endif\n\n            v_Color = vec4(u_DirectionLight_Diffuse.xyz*_Color.rgb , _Color.a);\n\n            #ifdef CUSTOM_ENABLESPECULAR\n\n            vec3 viewDir=normalize(u_CameraPos-m_Position);\n\n            vec3 halfDir=normalize(viewDir + worldLightDir);\n\n            vec3 specular=u_DirectionLight_Diffuse.xyz*_Specular.rgb*pow(max(dot(worldNormal,halfDir),0.0),_Gloss);\n\n            v_Color+=vec4(v_Color.rgb+specular,v_Color.a);\n\n            #endif\n\n            #else\n\n            v_Color=_Color;\n\n            #endif\n\n        }","precision highp float;\n\n        varying vec4 v_EyeSpacePos;\n\n        varying vec2 v_Texcoord;\n\n        varying vec4 v_Color;\n\n        uniform sampler2D u_texture;\n\n        uniform float u_Density;\n\n        uniform float u_Gradient;\n\n        uniform vec4 _FogColor;\n\n        uniform float u_FogStart;\n\n        uniform float u_FogEnd;\n\n        float ExFog(float distance)\n\n        {\n\n            float fogAlpha=exp(-abs(distance * u_Density));\n\n            fogAlpha=1.0-clamp(fogAlpha,0.0,1.0);\n\n            return fogAlpha;\n\n        }\n\n        float ExpFog(float distance)\n\n        {\n\n            float fogAlpha=exp(-pow( abs(distance * u_Density) , u_Gradient) );\n\n            fogAlpha=1.0-clamp(fogAlpha,0.0,1.0);\n\n            return fogAlpha;\n\n        }\n\n        float LinearFog(float distance)\n\n        {\n\n            float fogAlpha=(distance-u_FogStart)/(u_FogEnd-u_FogStart);\n\n            fogAlpha=clamp(fogAlpha,0.0,1.0);\n\n            return fogAlpha;\n\n        }\n\n        void main(){\n\n            vec4 tex=texture2D(u_texture,v_Texcoord);\n\n            #ifdef CUSTOM_ENABLELIGHT \n\n            vec4 color=v_Color*tex;\n\n            #else \n\n            vec4 color=tex;\n\n            #endif\n\n            \n            #ifdef CUSTOM_ENABLEFOG \n\n            #ifdef CUSTOM_LINEARFOG\n\n            float fogAlpha = LinearFog(abs(v_EyeSpacePos.z/v_EyeSpacePos.w));\n\n            #endif\n\n            #ifdef CUSTOM_EXFOG\nfloat fogAlpha = ExFog(abs(v_EyeSpacePos.z/v_EyeSpacePos.w));\n\n            #endif\n\n            #ifdef CUSTOM_EXPFOG\n\n            float fogAlpha = ExpFog(abs(v_EyeSpacePos.z/v_EyeSpacePos.w));\n\n            #endif\n\n            gl_FragColor=mix(color,_FogColor,fogAlpha);\n\n            #else \n\n            gl_FragColor=color;\n\n            #endif \n\n        }\n",e,t);a.SHADERDEFINE_ENABLELIGHT=n.registerMaterialDefine("CUSTOM_ENABLELIGHT"),a.SHADERDEFINE_ENABLELAMBERT=n.registerMaterialDefine("CUSTOM_ENABLELAMBERT"),a.SHADERDEFINE_ENABLESPECULAR=n.registerMaterialDefine("CUSTOM_ENABLESPECULAR"),a.SHADERDEFINE_ENABLEFOG=n.registerMaterialDefine("CUSTOM_ENABLEFOG"),a.SHADERDEFINE_LINEARFOG=n.registerMaterialDefine("CUSTOM_LINEARFOG"),a.SHADERDEFINE_EXFOG=n.registerMaterialDefine("CUSTOM_EXFOG"),a.SHADERDEFINE_EXPFOG=n.registerMaterialDefine("CUSTOM_EXPFOG")},a.DIFFUSETEXTURE=1,a.MARGINALCOLOR=2,a.BENDDISTANCE=3,a.COLOR=4,a.SPECULAR=5,a.GLOSS=6,a.FOGCOLOR=7,a.DENSITY=8,a.GRADIENT=9,a.FOGSTART=10,a.FOGEND=11,a.FOGTYPE_LINEAR=1,a.FOGTYPE_EX=2,a.FOGTYPE_EXP=3,a);function a(){var e=i.call(this)||this;return e.setShaderName("RoadLineShader"),e.bendDistance=100,e.hasLight=!0,e.color=new Laya.Vector4(1,1,1,1),e.hasLambert=!1,e.hasSpecular=!1,e.specularGloss=1,e.specularColor=new Laya.Vector4(1,1,1,1),e.hasFog=!0,e.fogDensity=.3,e.fogStart=0,e.fogEnd=40,e.fogGradient=0,e.fogType=a.FOGTYPE_LINEAR,e}t.RoadLineMaterial=n}),define("com/comp/RoadMesh",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=Laya.PrimitiveMesh,__extends(a,i),a.prototype.reset=function(e,t,i){void 0===i&&(i=null),this._long=e,this._width=t,this._blendoffs=i,this.activeResource(!0),this._positions=this._getPositions(),this._generateBoundingObject()},a.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},a.prototype.recreateResource=function(){this._numberVertices=4,this._numberIndices=6;for(var e=new Uint16Array(this._numberIndices),t=Laya.VertexPositionNormalTexture.vertexDeclaration,i=t.vertexStride/4,n=new Float32Array(this._numberVertices*i),a=this._long/2,r=this._width/2,s=this._long,o=this._width,l=0,h=0;h<=1;h++)for(var c=0;c<=1;c++)n[l++]=c*s-a,n[l++]=0,n[l++]=h*o-r,n[l++]=this._blendoffs[2*h],n[l++]=this._blendoffs[2*h+1],n[l++]=0,n[l++]=c,n[l++]=h;var u=0;for(h=0;h<1;h++)for(c=0;c<1;c++)e[u++]=2*(h+1)+c,e[u++]=2*h+c,e[u++]=2*(h+1)+c+1,e[u++]=2*h+c,e[u++]=2*h+c+1,e[u++]=2*(h+1)+c+1;this._vertexBuffer=new Laya.VertexBuffer3D(t,this._numberVertices,Laya.WebGLContext.STATIC_DRAW,!0),this._indexBuffer=new Laya.IndexBuffer3D(Laya.IndexBuffer3D.INDEXTYPE_USHORT,this._numberIndices,Laya.WebGLContext.STATIC_DRAW,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(e),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},a.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},a);function a(){var e=i.call(this)||this;return e._long=1,e._width=1,e._blendoffs=[],e.activeResource(),e._positions=e._getPositions(),e._generateBoundingObject(),e}t.RoadMesh=n}),define("com/comp/CustomMaterial",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=Laya.BaseMaterial,__extends(a,i),a.prototype.setTransparent=function(e){void 0===e&&(e=!0),this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,e?(this.srcBlend=Laya.BaseMaterial.BLENDPARAM_SRC_ALPHA,this.dstBlend=Laya.BaseMaterial.BLENDPARAM_DST_ALPHA):(this.srcBlend=Laya.BaseMaterial.BLENDPARAM_SRC_ALPHA,this.dstBlend=Laya.BaseMaterial.BLENDPARAM_ONE_MINUS_SRC_ALPHA)},Object.defineProperty(a.prototype,"diffuseTexture",{get:function(){return this._getTexture(a.DIFFUSETEXTURE)},set:function(e){this._setTexture(a.DIFFUSETEXTURE,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"marginalColor",{set:function(e){this._setColor(a.MARGINALCOLOR,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bendOffset",{get:function(){return this._getColor(a.BENDANGLE)},set:function(e){this._setColor(a.BENDANGLE,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bendDistance",{set:function(e){this._setNumber(a.BENDDISTANCE,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"specularGloss",{set:function(e){this._setNumber(a.GLOSS,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"albedoColor",{get:function(){return this._getColor(a.COLOR)},set:function(e){this._setColor(a.COLOR,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"color",{set:function(e){this._setColor(a.COLOR,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"specularColor",{set:function(e){this._setColor(a.SPECULAR,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasLight",{set:function(e){e?this._addShaderDefine(a.SHADERDEFINE_ENABLELIGHT):this._removeShaderDefine(a.SHADERDEFINE_ENABLELIGHT)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasLambert",{set:function(e){e?this._addShaderDefine(a.SHADERDEFINE_ENABLELAMBERT):this._removeShaderDefine(a.SHADERDEFINE_ENABLELAMBERT)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasSpecular",{set:function(e){e?this._addShaderDefine(a.SHADERDEFINE_ENABLESPECULAR):this._removeShaderDefine(a.SHADERDEFINE_ENABLESPECULAR)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasFog",{set:function(e){e?this._addShaderDefine(a.SHADERDEFINE_ENABLEFOG):this._removeShaderDefine(a.SHADERDEFINE_ENABLEFOG)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogType",{set:function(e){switch(e){case a.FOGTYPE_LINEAR:this._addShaderDefine(a.SHADERDEFINE_LINEARFOG),this._removeShaderDefine(a.SHADERDEFINE_EXFOG),this._removeShaderDefine(a.SHADERDEFINE_EXPFOG);break;case a.FOGTYPE_EX:this._removeShaderDefine(a.SHADERDEFINE_LINEARFOG),this._addShaderDefine(a.SHADERDEFINE_EXFOG),this._removeShaderDefine(a.SHADERDEFINE_EXPFOG);break;case a.FOGTYPE_EXP:this._removeShaderDefine(a.SHADERDEFINE_LINEARFOG),this._removeShaderDefine(a.SHADERDEFINE_EXFOG),this._addShaderDefine(a.SHADERDEFINE_EXPFOG)}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogColor",{set:function(e){this._setColor(a.FOGCOLOR,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogDensity",{set:function(e){this._setNumber(a.DENSITY,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogGradient",{set:function(e){this._setNumber(a.GRADIENT,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogStart",{set:function(e){this._setNumber(a.FOGSTART,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogEnd",{set:function(e){this._setNumber(a.FOGEND,e)},enumerable:!0,configurable:!0}),a.initShader=function(){var e={a_Position:Laya.VertexElementUsage.POSITION0,a_Normal:Laya.VertexElementUsage.NORMAL0,a_Texcoord:Laya.VertexElementUsage.TEXTURECOORDINATE0},t={u_MvpMatrix:[Laya.Sprite3D.MVPMATRIX,Laya.Shader3D.PERIOD_SPRITE],u_WorldMat:[Laya.Sprite3D.WORLDMATRIX,Laya.Shader3D.PERIOD_SPRITE],u_ViewMatrix:[Laya.BaseCamera.VIEWMATRIX,Laya.Shader3D.PERIOD_CAMERA],u_texture:[a.DIFFUSETEXTURE,Laya.Shader3D.PERIOD_MATERIAL],u_CameraPos:[Laya.BaseCamera.CAMERAPOS,Laya.Shader3D.PERIOD_CAMERA],_QOffset:[a.BENDANGLE,Laya.Shader3D.PERIOD_MATERIAL],_Dist:[a.BENDDISTANCE,Laya.Shader3D.PERIOD_MATERIAL],_Color:[a.COLOR,Laya.Shader3D.PERIOD_MATERIAL],_FogColor:[a.FOGCOLOR,Laya.Shader3D.PERIOD_MATERIAL],u_Density:[a.DENSITY,Laya.Shader3D.PERIOD_MATERIAL],u_Gradient:[a.GRADIENT,Laya.Shader3D.PERIOD_MATERIAL],u_FogStart:[a.FOGSTART,Laya.Shader3D.PERIOD_MATERIAL],u_FogEnd:[a.FOGEND,Laya.Shader3D.PERIOD_MATERIAL],_Gloss:[a.GLOSS,Laya.Shader3D.PERIOD_MATERIAL],u_DirectionLight_Direction:[Laya.Scene.POINTLIGHTPOS,Laya.Shader3D.PERIOD_SCENE],u_DirectionLight_Diffuse:[Laya.Scene.POINTLIGHTCOLOR,Laya.Shader3D.PERIOD_SCENE],u_DirectionLight_Ambient:[Laya.Scene.AMBIENTCOLOR,Laya.Shader3D.PERIOD_SCENE]},i=Laya.Shader3D.nameKey.add("CustomShader"),n=Laya.ShaderCompile3D.add(i,"attribute vec3 a_Normal;\n\n        attribute vec2 a_Texcoord;\n\n        attribute vec4 a_Position;\n\n        precision highp float;\n\n        uniform mat4 u_MvpMatrix;\n\n        uniform mat4 u_ViewMatrix;\n\n        uniform mat4 u_WorldMat;\n\n        uniform vec4 _QOffset; \n\n        uniform float _Dist; \n\n        uniform vec4 _Color; \n\n        uniform float _Gloss; \n\n        uniform vec4 _Specular; \n\n        uniform vec3 u_CameraPos;\n\n        uniform vec3 u_DirectionLight_Direction;\n\n        uniform vec3 u_DirectionLight_Diffuse;\n\n        uniform vec3 u_DirectionLight_Ambient;\n\n        varying vec4 v_Color;\n\n        varying vec2 v_Texcoord;\n\n        varying vec4 v_EyeSpacePos;\n\n        void main(){\n\n            mat4 mvMatrix = u_ViewMatrix*u_WorldMat;\n\n            highp vec4 vPos =  u_MvpMatrix *a_Position;\n\n            float zOff = vPos.z/_Dist;\n\n            vPos += _QOffset*zOff*zOff;\n\n            gl_Position = vPos;\n\n            mat3 worldMat=mat3(u_WorldMat);\n\n            v_EyeSpacePos=mvMatrix*a_Position;\n\n            v_Texcoord=a_Texcoord;\n\n            vec3 worldNormal=worldMat*a_Normal;\n\n            worldNormal=normalize(worldNormal);\n\n            vec3 m_Position=vec3(u_WorldMat*a_Position);\n\n            vec3 worldLightDir=normalize(u_DirectionLight_Direction-m_Position);\n\n            vec3 ambient=u_DirectionLight_Ambient.xyz*_Color.rgb;\n\n            #ifdef CUSTOM_ENABLELIGHT\n\n                #ifdef CUSTOM_ENABLELAMBERT\n\n                v_Color=_Color;\n\n                #else\n\n                v_Color = vec4(u_DirectionLight_Diffuse.xyz*_Color.rgb , _Color.a);\n\n                #endif\n\n                #ifdef CUSTOM_ENABLESPECULAR\n\n                float lambert=0.5 * dot(worldNormal, worldLightDir) + 0.5;\n\n                v_Color = vec4(lambert *_Color.rgb + ambient, _Color.a);\n\n                #endif\n\n            #else\n\n                v_Color=_Color;\n\n            #endif\n\n        }","precision highp float;\n\n        varying vec4 v_EyeSpacePos;\n\n        varying vec2 v_Texcoord;\n\n        varying vec4 v_Color;\n\n        uniform sampler2D u_texture;\n\n        uniform float u_Density;\n\n        uniform float u_Gradient;\n\n        uniform vec4 _FogColor;\n\n        uniform float u_FogStart;\n\n        uniform float u_FogEnd;\n\n        float ExFog(float distance)\n\n        {\n\n            float fogAlpha=exp(-abs(distance * u_Density));\n\n            fogAlpha=1.0-clamp(fogAlpha,0.0,1.0);\n\n            return fogAlpha;\n\n        }\n\n        float ExpFog(float distance)\n\n        {\n\n            float fogAlpha=exp(-pow( abs(distance * u_Density) , u_Gradient) );\n\n            fogAlpha=1.0-clamp(fogAlpha,0.0,1.0);\n\n            return fogAlpha;\n\n        }\n\n        float LinearFog(float distance)\n\n        {\n\n            float fogAlpha=(distance-u_FogStart)/(u_FogEnd-u_FogStart);\n\n            fogAlpha=clamp(fogAlpha,0.0,1.0);\n\n            return fogAlpha;\n\n        }\n\n        void main(){\n\n            vec4 tex=texture2D(u_texture,v_Texcoord);\n\n            #ifdef CUSTOM_ENABLELIGHT \n\n            vec4 color=v_Color*tex;\n\n            #else \n\n            vec4 color=tex;\n\n            #endif\n\n            \n            #ifdef CUSTOM_ENABLEFOG \n\n            #ifdef CUSTOM_LINEARFOG\n\n            float fogAlpha = LinearFog(abs(v_EyeSpacePos.z/v_EyeSpacePos.w));\n\n            #endif\n\n            #ifdef CUSTOM_EXFOG\nfloat fogAlpha = ExFog(abs(v_EyeSpacePos.z/v_EyeSpacePos.w));\n\n            #endif\n\n            #ifdef CUSTOM_EXPFOG\n\n            float fogAlpha = ExpFog(abs(v_EyeSpacePos.z/v_EyeSpacePos.w));\n\n            #endif\n\n            gl_FragColor=mix(color,_FogColor,fogAlpha);\n\n            #else \n\n            gl_FragColor=color;\n\n            #endif \n\n        }\n",e,t);a.SHADERDEFINE_ENABLELIGHT=n.registerMaterialDefine("CUSTOM_ENABLELIGHT"),a.SHADERDEFINE_ENABLELAMBERT=n.registerMaterialDefine("CUSTOM_ENABLELAMBERT"),a.SHADERDEFINE_ENABLESPECULAR=n.registerMaterialDefine("CUSTOM_ENABLESPECULAR"),a.SHADERDEFINE_ENABLEFOG=n.registerMaterialDefine("CUSTOM_ENABLEFOG"),a.SHADERDEFINE_LINEARFOG=n.registerMaterialDefine("CUSTOM_LINEARFOG"),a.SHADERDEFINE_EXFOG=n.registerMaterialDefine("CUSTOM_EXFOG"),a.SHADERDEFINE_EXPFOG=n.registerMaterialDefine("CUSTOM_EXPFOG")},a.DIFFUSETEXTURE=1,a.MARGINALCOLOR=2,a.BENDANGLE=3,a.BENDDISTANCE=4,a.COLOR=5,a.SPECULAR=6,a.GLOSS=7,a.FOGCOLOR=8,a.DENSITY=9,a.GRADIENT=10,a.FOGSTART=11,a.FOGEND=12,a.FOGTYPE_LINEAR=1,a.FOGTYPE_EX=2,a.FOGTYPE_EXP=3,a);function a(){var e=i.call(this)||this;return e.setShaderName("CustomShader"),e.bendDistance=100,e.hasLight=!0,e.color=new Laya.Vector4(1,1,1,1),e.hasLambert=!1,e.hasSpecular=!1,e.specularGloss=1,e.specularColor=new Laya.Vector4(1,1,1,1),e.hasFog=!0,e.fogColor=new Laya.Vector4(1,1,1,1),e.fogDensity=.3,e.fogStart=0,e.fogEnd=40,e.fogGradient=0,e.fogType=a.FOGTYPE_LINEAR,e}t.CustomMaterial=n}),define("sheets/vo/Color",["require","exports","sheets/vo/Sheets"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=i.ColorBase,__extends(r,n),r.get=function(e){return this[e]?this[e]:SheetManager.get("Color",e,r)},r.getAllColor=function(){var e=SheetManager.getList("Color"),t=[];for(var i in e)"keys"!=i&&t.push(this.get(i));return t},Object.defineProperty(r.prototype,"fogColor",{get:function(){var e=Laya.Color.create(this.fog);return new Laya.Vector4(e._color[0],e._color[1],e._color[2],1)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lightColor",{get:function(){var e=Laya.Color.create(this.light);return new Laya.Vector3(e._color[0],e._color[1],e._color[2])},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"defColor",{get:function(){for(var e=[],t=0;t<this.color.length;t++){var i=Laya.Color.create(this.color[t]);e.push(new Laya.Vector4(i._color[0],i._color[1],i._color[2],1))}return e},enumerable:!0,configurable:!0}),r.getCurColor=function(e){var t=r.getAllColor();return t[Math.floor(t.length*Math.random())]},r.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},r);function r(){return null!==n&&n.apply(this,arguments)||this}t.Color=a}),define("com/utils/Delay",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.delay=function(t){var i=this;return new Promise(function(e){Laya.timer.once(t,i,function(){e(!0)},null,!1)})},n);function n(){}t.Delay=i}),define("game/obstacle/TweenComp",["require","exports","game/road/RoadPlane"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(Object.defineProperty(n.prototype,"target",{get:function(){return this.mTarget},set:function(e){if(this.mTarget)throw"error";(this.mTarget=e).tween=this},enumerable:!0,configurable:!0}),n.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},n.prototype.tweenScaleLong=function(e,t,i){var n=new r;this.tweens.push(n);var a=this.target.transform.position.x;this.tweenSacleLong1(n,a,e,t,i)},n.prototype.tweenSacleLong1=function(e,t,i,n,a){var r,s=this;r=this.target.transform.position.x<0?.5*-(o.RoadPlane.long-i):.5*(o.RoadPlane.long-i),this.layatween=Laya.Tween.to(this.target,{long:i,x:r},a,Laya.Ease.quadOut,Laya.Handler.create(this,function(){s.layatween=null,s.tweenSacleLong2(e,t,i,n,a)}))},n.prototype.tweenSacleLong2=function(e,t,i,n,a){var r,s=this;r=this.target.transform.position.x<0?.5*-(o.RoadPlane.long-n):.5*(o.RoadPlane.long-n),this.layatween=Laya.Tween.to(this.target,{long:n,x:r},a,Laya.Ease.quadOut,Laya.Handler.create(this,function(){s.layatween=null,s.tweenSacleLong1(e,t,i,n,a)}))},n.prototype.tweenMoveLeftRight=function(e,t,i){var n=new r;this.tweens.push(n),1==GMath.random(0,2)?this.moveLeft(n,e,t,i):this.moveRight(n,e,t,i)},n.prototype.moveLeft=function(e,t,i,n){var a=this;e.start(this.target,{x:t},n,null,function(){isNaN(i)||a.moveRight(e,t,i,n)})},n.prototype.moveRight=function(e,t,i,n){var a=this;e.start(this.target,{x:i},n,null,function(){isNaN(t)||a.moveLeft(e,t,i,n)})},n.prototype.dispose=function(){this.layatween&&(this.layatween.clear(),this.layatween=null),this.mTarget=null;for(var e=0;e<this.tweens.length;e++)this.tweens[e].dispose();this.tweens=null},n);function n(){this.tweens=[]}t.TweenComp=i;var r=(Object.defineProperty(a.prototype,"x",{get:function(){return this.mX},set:function(e){this.mX=e,this.target.transform.position.x=e,this.target.transform.position=this.target.transform.position,this.target.markRectTag()},enumerable:!0,configurable:!0}),a.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},Object.defineProperty(a.prototype,"y",{get:function(){return this.mY},set:function(e){this.mY=e,this.target.transform.position.y=e,this.target.transform.position=this.target.transform.position,this.target.markRectTag()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"z",{get:function(){return this.mZ},set:function(e){this.mZ=e,this.target.transform.position.z=e,this.target.transform.position=this.target.transform.position,this.target.markRectTag()},enumerable:!0,configurable:!0}),a.prototype.start=function(e,t,i,n,a){var r=this;for(var s in this.target=e,t)this[s]=this.target.transform.position[s];this.tween=Laya.Tween.to(this,t,i,n,Laya.Handler.create(this,function(){r.tween=null,a&&a()}))},a.prototype.dispose=function(){this.tween&&(this.tween.clear(),this.tween=null),this.target=null},a);function a(){}t.TweenMove=r}),define("game/obstacle/BaseCollision",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=Laya.Sprite3D,__extends(a,n),a.prototype.updateCollision=function(){var e=this.transform.position;this.collisionRect.x=e.x-.5*this.collisionRect.width,this.collisionRect.y=e.z-.5*this.collisionRect.height},a.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},a.prototype.intersects=function(e){return this.collisionRect.intersects(e.collisionRect)},Object.defineProperty(a.prototype,"fogcolor",{get:function(){return this._fogcolor},set:function(e){this._fogcolor=e},enumerable:!0,configurable:!0}),a.TEMPID=0,a);function a(e,t){var i=n.call(this)||this;return i.ID=0,i.isInCollider=!1,i.ID=a.TEMPID++,i.collisionRect=new Laya.Rectangle(0,0,e,t),i}t.BaseCollision=i}),define("game/obstacle/BaseObstacle",["require","exports","com/comp/CustomMaterial","game/scene/GameSystem"],function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=Laya.MeshSprite3D,__extends(s,a),Object.defineProperty(s.prototype,"collisionRect",{get:function(){return this._rectTag&&(this._rectTag=!1,this.updateCollision()),this._collisionRect},enumerable:!0,configurable:!0}),s.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},s.prototype.updateCollision=function(){var e=this.transform.position;this._collisionRect.width=this.long,this._collisionRect.height=this.width,this._collisionRect.x=e.x-.5*this._collisionRect.width,this._collisionRect.y=e.z-.5*this._collisionRect.height},s.prototype.markRectTag=function(){this._rectTag=!0},Object.defineProperty(s.prototype,"long",{get:function(){return this.transform.localScale.x},set:function(e){this.transform.localScale.x=e,this.transform.localScale=this.transform.localScale,this._rectTag=!0},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"height",{get:function(){return this.transform.localScale.y},set:function(e){this.transform.localScale.y=e,this.transform.localScale=this.transform.localScale,this._rectTag=!0},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"width",{get:function(){return this.transform.localScale.z},set:function(e){this.transform.localScale.z=e,this.transform.localScale=this.transform.localScale,this._rectTag=!0},enumerable:!0,configurable:!0}),s.prototype.initMaterial=function(){this.material=new i.CustomMaterial,this.material.fogEnd=40,this.material.bendOffset=new Laya.Vector4(0,0,1,1),this.meshRender.sharedMaterial=this.material},Object.defineProperty(s.prototype,"skin",{set:function(e){this.material.diffuseTexture=Laya.Texture2D.load(e)},enumerable:!0,configurable:!0}),s.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},Object.defineProperty(s.prototype,"fogcolor",{set:function(e){this.material.fogColor=e},enumerable:!0,configurable:!0}),s.prototype.setBendOffset=function(e,t){this.material.bendOffset=new Laya.Vector4(e,t,1,1)},s.prototype.setFogDistance=function(e){this.material.fogEnd=e},s.prototype.setPosZ=function(e,t){void 0===t&&(t=1);var i=n.GameSystem.getPos(e);this.bendOffY=i.y,this.setBendOffset(i.x,i.y*t)},s.prototype.setPosXY=function(e,t,i){var n=this.transform.localPosition;n.x=e,n.y=t,n.z=i,this.transform.localPosition=n},Object.defineProperty(s.prototype,"tween",{get:function(){return this.mTween},set:function(e){this.mTween=e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"obstacel",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"x",{get:function(){return this.transform.position.x},set:function(e){var t=this.transform.localPosition;t.x=e,this.transform.localPosition=t,this._rectTag=!0},enumerable:!0,configurable:!0}),s.prototype.stopTween=function(){this.mTween&&(this.mTween.dispose(),this.mTween=null)},s.prototype.recovery=function(){this._rectTag=!0,this.isInCollider=!1,this.mTween&&(this.mTween.dispose(),this.mTween=null),this.removeSelf()},s);function s(e,t){var i=a.call(this,e,t)||this;return i._collisionRect=new Laya.Rectangle,i._rectTag=!0,i.isInCollider=!1,i.bendOffY=0,i.initMaterial(),i}t.BaseObstacel=r}),define("utils/ObjectPool",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.prototype.getObject=function(){return 0<this._pool.length?this._pool.pop():new this._objClass},n.prototype.returnObject=function(e){this._pool.push(e)},n.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},n);function n(e){this._objClass=e,this._pool=[]}t.ObjectPool=i}),define("game/road/BaseRecovery",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("game/road/Build",["require","exports","game/road/RoadPlane","game/obstacle/BaseObstacle","utils/ObjectPool"],function(e,t,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=(r=i.BaseObstacel,__extends(o,r),o.prototype.left=function(e,t){var i=this.transform.localPosition;this.long=2,this.width=2,this.height=10+GMath.random(3,10),i.x=e?-(n.RoadPlane.long/2+this.long/2+1.2):n.RoadPlane.long/2+this.long/2+1,i.y=.5*this.height-10,i.z=0,this.transform.localPosition=i,this.skin="res/1.png"},o.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},Object.defineProperty(o.prototype,"skin",{set:function(e){var t=this.meshRender.sharedMaterial;t.color=o.defColor[GMath.random(0,o.defColor.length)],t.diffuseTexture=Laya.Texture2D.load(e)},enumerable:!0,configurable:!0}),o.prototype.setBendOffset=function(e,t){this.meshRender.sharedMaterial.bendOffset=new Laya.Vector4(e,t,1,1)},o.prototype.recovery=function(){r.prototype.recovery.call(this),o.pool.returnObject(this)},o.pool=new a.ObjectPool(o),o.testcolor=new Laya.Vector4(.7,.7,.7,1),o.defColor=[],o);function o(){return r.call(this,new Laya.BoxMesh(1,1,1))||this}t.Build=s}),define("com/comp/TriMesh",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=Laya.BoxMesh,__extends(a,i),a.prototype.recreateResource=function(){this._numberVertices=24,this._numberIndices=36;var e=Laya.VertexPositionNormalTexture.vertexDeclaration,t=(e.vertexStride,new Float32Array([-.5,.5,0,0,1,0,0,0,.5,.5,0,0,1,0,1,0,.5,.5,0,0,1,0,1,1,-.5,.5,0,0,1,0,0,1,-.5,-.5,-.5,0,-1,0,0,1,.5,-.5,-.5,0,-1,0,1,1,.5,-.5,.5,0,-1,0,1,0,-.5,-.5,.5,0,-1,0,0,0,-.5,.5,-0,-1,0,0,0,0,-.5,.5,0,-1,0,0,1,0,-.5,-.5,.5,-1,0,0,1,1,-.5,-.5,-.5,-1,0,0,0,1,.5,.5,-0,1,0,0,1,0,.5,.5,0,1,0,0,0,0,.5,-.5,.5,1,0,0,0,1,.5,-.5,-.5,1,0,0,1,1,-.5,.5,0,0,0,1,0,0,.5,.5,0,0,0,1,1,0,.5,-.5,.5,0,0,1,1,1,-.5,-.5,.5,0,0,1,0,1,-.5,.5,-0,0,0,-1,1,0,.5,.5,-0,0,0,-1,0,0,.5,-.5,-.5,0,0,-1,0,1,-.5,-.5,-.5,0,0,-1,1,1])),i=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new Laya.VertexBuffer3D(e,this._numberVertices,Laya.WebGLContext.STATIC_DRAW,!0),this._indexBuffer=new Laya.IndexBuffer3D(Laya.IndexBuffer3D.INDEXTYPE_USHORT,this._numberIndices,Laya.WebGLContext.STATIC_DRAW,!0),this._vertexBuffer.setData(t),this._indexBuffer.setData(i),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},a);function a(){return null!==i&&i.apply(this,arguments)||this}t.TriMesh=n}),define("game/obstacle/BoxObstacel",["require","exports","game/obstacle/BaseObstacle","utils/ObjectPool","game/road/RoadPlane","com/comp/TriMesh"],function(e,t,i,n,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,o=(s=i.BaseObstacel,__extends(l,s),l.getInstance=function(e,t,i){var n=l.pool.getObject();return n.reset(e,t,i),n},l.prototype.reset=function(e,t,i){this.long=e,this.width=t,this.height=i,this.material.hasLight=!0},l.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},Object.defineProperty(l.prototype,"meshBox",{get:function(){return this.meshFilter.sharedMesh},enumerable:!0,configurable:!0}),l.prototype.startMove=function(e,t,i){void 0===i&&(i=null),this.isMoveLeft=e,this.isMove=!0,this.isStop=!1,this.linkbox=i,this.moveminx=.5*-a.RoadPlane.long+.5*this.long,this.movemaxx=.5*a.RoadPlane.long-.5*this.long,this.upBox=t,i&&(this.movemaxx-=this.long),Laya.timer.frameLoop(1,this,this.onMove)},l.prototype.stopMove=function(e){this.isStop=e},l.prototype.clearMove=function(){this.isMove=!1,Laya.timer.clear(this,this.onMove)},l.prototype.onMove=function(){if(!this.isStop){var e=this.x;this.isMoveLeft?(e-=.02)<this.moveminx&&(e=this.moveminx,this.isMoveLeft=!1):(e+=.03)>this.movemaxx&&(e=this.movemaxx,this.isMoveLeft=!0),this.upBox.x=this.x=e,this.linkbox&&(this.linkbox[0].x=this.linkbox[1].x=e+this.long)}},l.prototype.recovery=function(){s.prototype.recovery.call(this),this.isMove&&this.clearMove(),l.pool.returnObject(this)},l.pool=new n.ObjectPool(l),l);function l(){var e=s.call(this,new Laya.BoxMesh(1,1,1))||this;return e.isMove=!1,e.isStop=!1,e.isMoveLeft=!1,e}t.BoxObstacel=o;var c,u=(c=i.BaseObstacel,__extends(d,c),d.getInstance=function(e,t,i){var n=d.pool.getObject();return n.reset(e,t,i),n},d.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},d.prototype.reset=function(e,t,i){this.long=e,this.width=t,this.height=i},d.prototype.recovery=function(){c.prototype.recovery.call(this),d.pool.returnObject(this)},d.pool=new n.ObjectPool(d),d);function d(){return c.call(this,new r.TriMesh(1,1,1))||this}t.TriObstacel=u}),define("game/obstacle/CubeConfig",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.fullBoxIndex=23,n.baseTypes2=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,26,27,28,29,30,31],n.dorrTypes=[19,20,21,22,23,24,25],n.subarea=[[[0,1,0,1,0]],[[1,0,1,0,1]],[[1,0,0,1,1]],[[1,0,1,0,0]]],n.jumpLib=[[[2,2,1,1,1]],[[1,2,2,1,1]],[[1,1,2,2,1]],[[1,1,1,2,2]],[[2,2,2,1,1]],[[1,2,2,2,1]],[[1,1,2,2,2]],[[2,2,1,2,2]]],n.cubeLib=[[[1,1,1,1,1],[0,1,0,0,0]],[[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],[[1,1,1,1,1],[0,0,1,0,0]],[[1,1,0,0,0],[1,1,0,0,0]],[[1,1,0,0,0],[1,0,0,0,0]],[[1,1,0,0,0],[1,0,0,0,0],[1,1,0,0,0]],[[0,1,0,0,0],[1,1,0,0,0],[1,0,0,0,0]],[[1,0,0,0,0],[1,1,0,0,0],[1,0,0,0,0]],[[0,1,1,0,0],[1,1,0,0,0]],[[1,0,0,0,0],[1,1,0,0,0],[1,0,0,0,0],[1,0,0,0,0]],[[1,0,0,0,0],[1,0,0,0,0]],[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]],[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]],[[0,0,0,0,0],[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0]],[[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]],[[1,1,1,1,1],[1,0,0,0,0]],[[1,1,1,1,1],[1,0,0,0,1]],[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1]],[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],[[0,1,1,1,0],[0,1,0,1,0],[0,1,1,1,0],[0,1,0,1,0]],[[0,1,0,1,0],[0,1,0,1,0],[0,1,1,1,0],[0,1,0,1,0],[0,1,0,1,0]],[[0,1,1,1,0],[0,1,0,1,0],[0,1,0,1,0],[0,1,1,1,0]],[[0,1,1,1,0],[0,1,0,0,0],[0,1,1,1,0],[0,1,0,0,0],[0,1,1,1,0]],[[1,1,1,0,0],[1,1,1,0,0],[1,1,1,0,0]],[[1,1,1,1,1],[0,1,1,0,0],[0,1,1,0,0],[0,1,1,0,0]],[[1,1,1,1,1],[1,0,1,0,0],[1,0,1,0,0]],[[1,0,1,0,0],[1,0,1,0,0],[1,0,1,0,0]],[[0,1,0,1,0],[0,1,0,1,0],[0,1,0,1,0]],[[1,1,0,0,0],[1,1,0,0,0],[1,1,0,0,0]],[[0,1,1,0,0],[0,1,1,0,0],[0,1,1,0,0]],[[1,1,0,0,0],[1,1,0,0,0],[1,1,0,0,0],[1,1,0,0,0]],[[0,1,1,0,0],[0,1,1,0,0],[0,1,1,0,0],[0,1,1,0,0]]],n);function n(){}t.CubeConfig=i}),define("game/road/ArrowPlane",["require","exports","com/comp/CustomMaterial"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=Laya.MeshSprite3D,__extends(r,n),r.prototype.initMaterial=function(){this.material=new i.CustomMaterial,this.meshRender.sharedMaterial=this.material,this.material.hasFog=!1,this.material.cull=0},r.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},r.prototype.setBendOffset=function(e,t){this.bendoff.x=e,this.bendoff.y=t,this.material.bendOffset=this.bendoff},r.prototype.setskin=function(e,t){this.material.diffuseTexture=Laya.Texture2D.load(e),this.material.diffuseTexture.mipmap=t},r.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},r.prototype.setPos=function(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.transform.translate(new Laya.Vector3(0,0,i),!1)},r.prototype.setlocalPos=function(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0);var n=this.transform.localPosition;n.x=e,n.y=t,n.z=i,this.transform.localPosition=n},r);function r(e,t){var i=n.call(this,new Laya.PlaneMesh(e,t,5,5))||this;return i.bendoff=new Laya.Vector4(0,0,1,1),i.plane=i._geometryFilter.sharedMesh,i.initMaterial(),i}t.ArrowPlane=a}),define("game/obstacle/ObstacelIcon",["require","exports","com/comp/CustomMaterial","game/obstacle/BaseCollision","game/scene/GameSystem","game/road/ArrowPlane"],function(e,t,n,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,o,l,c=(s=i.BaseCollision,__extends(u,s),u.prototype.setPos=function(e,t,i,n){this.mZpos=new Laya.Vector3(e,t,i);var a=r.GameSystem.getPos(i+n+2);this.setBendOffset(a.x,a.y)},u.prototype.setBendOffset=function(e,t){this.bendX=e,this.bendY=t},u.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},u.prototype.setColor=function(e,t,i,n){this.color.x=e,this.color.y=t,this.color.z=i,this.color.w=n},u.prototype.createPlane=function(e){this.transform.translate(this.mZpos),this.type==o.SUBSPEED?(this.speedIcon=new a.ArrowPlane(2.9,1.5),this.speedIcon.material.setTransparent(!1),this.speedIcon.setskin(e,!1),this.speedIcon.material.hasLight=!0):(this.speedIcon=new a.ArrowPlane(1,1),this.speedIcon.material.setTransparent(),this.speedIcon.setskin(e,!1),this.speedIcon.material.hasLight=!1),this.speedIcon.material.hasSpecular=!0,this.addChild(this.speedIcon),this.speedIcon.material.cull=0,this.speedIcon.setBendOffset(this.bendX,this.bendY),this.updateCollision()},u.prototype.baoxiangremove=function(){var e=Laya.Sprite3D.load("res/man/kuoshan.lh").clone();this.isbaoxiangtexiao=!0,this.foreachchild(e);var t=e.transform.scale;t.x=t.y=t.z=1,e.transform.scale=t,e.getChildAt(0).getComponentByType(Laya.Animator).play("kuosan"),(t=this.transform.localPosition.clone()).y+=.5,e.transform.localPosition=t,this.parent.addChild(e),Laya.timer.once(200,this,function(){e.removeSelf(),e.destroy(!0)}),this.removeSelf()},u.prototype.load=function(t,i){return void 0===i&&(i="111"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.txt=Laya.Texture2D.load("res/4.png"),this.type==o.JUMP?[3,4]:this.type!=o.BAOXIANG?[3,2]:[4,this.asyncLoader("res/man/kuoshan.lh")];case 1:e.sent(),e.label=2;case 2:return[4,this.asyncLoader(t,i)];case 3:e.sent().cloneTo(this),e.label=4;case 4:return this.transform.translate(this.mZpos),this.transform.scale=new Laya.Vector3(.3,.3,.3),this.transform.rotate(new Laya.Vector3(0,90),!0,!1),this.foreachchild(this),this.updateCollision(),[2]}})})},u.prototype.creatematerial=function(e,t){var i=new n.CustomMaterial;return this.isbaoxiangtexiao?(i.hasLight=!0,i.hasSpecular=!0,i.setTransparent(),(e=e.clone()).x*=10,e.y*=10,e.z*=10):(i.hasLight=!0,i.hasLambert=!0),i.color=e,i.diffuseTexture=t,i.bendOffset=new Laya.Vector4(this.bendX,this.bendY,1,1),i.fogColor=this.fogcolor,i},u.prototype.foreachchild=function(e){if(e instanceof Laya.MeshSprite3D){n=e.meshRender.sharedMaterials.length;var t=[];if(this.isbaoxiangtexiao)for(a=0;a<n;a++){var i=e.meshRender.sharedMaterials[a];t[a]=this.creatematerial(i.albedoColor,i.albedoTexture)}else for(a=0;a<n;a++)i=e.meshRender.sharedMaterials[a],t[a]=this.creatematerial(i.albedoColor,this.txt);e.meshRender.sharedMaterials=t}for(var n=e.numChildren,a=0;a<n;a++)this.foreachchild(e.getChildAt(a))},u.prototype.asyncLoader=function(i,n){var a=this;return void 0===n&&(n="111"),new Promise(function(t){Laya.loader.create(i,Laya.Handler.create(a,function(){if(a.type==o.BAOXIANG)t(Laya.loader.getRes(i));else{var e=Laya.loader.getRes(i).getChildByName(n);t(e)}}))})},u.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},Object.defineProperty(u.prototype,"colliders",{get:function(){if(0==this.boxColliders.length)for(var e=0;e<this.numChildren;e++){var t=this.getChildAt(e);this.boxColliders.push(t._colliders[0])}return this.boxColliders},enumerable:!0,configurable:!0}),u.prototype.dispose=function(){this.isInCollider=!1,this.markTag=!1,this.removeSelf(),this.destroy(!0)},u);function u(e,t){void 0===t&&(t=.6);var i=s.call(this,t,.6)||this;return i.type=0,i.markTag=!1,i.color=new Laya.Vector4(1,0,0,1),i.isbaoxiangtexiao=!1,i.boxColliders=[],i.type=e,i}t.ObstacelIcon=c,(l=o=t.ICON_TYPE||(t.ICON_TYPE={}))[l.SPEED=1]="SPEED",l[l.JUMP=2]="JUMP",l[l.BAOXIANG=3]="BAOXIANG",l[l.SUBSPEED=4]="SUBSPEED"}),define("game/model/GameModel",["require","exports","wx/dataCenter"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=(i=Laya.EventDispatcher,__extends(r,i),Object.defineProperty(r,"isntance",{get:function(){return this.mInstance||(this.mInstance=new r)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"count",{get:function(){return this.mCount},set:function(e){this.mCount=e,this.mCount=this.mCount<0?0:this.mCount,this.event(Laya.Event.CHANGE)},enumerable:!0,configurable:!0}),r.prototype.saveScore=function(t,i){n.dataCenter.I.get(SAVEKEY.SCORE,function(e){e?e<t?n.dataCenter.I.send(SAVEKEY.SCORE,t,i):i():n.dataCenter.I.send(SAVEKEY.SCORE,t,i)})},r.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},Object.defineProperty(r.prototype,"stepcount",{get:function(){return this._stepcount},set:function(e){this._stepcount=e,this.event(Laya.Event.CHANGE)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"savecount",{get:function(){return this.mCount+1e-6*Math.floor(this._stepcount)},enumerable:!0,configurable:!0}),r);function r(){var e=null!==i&&i.apply(this,arguments)||this;return e.mCount=0,e._stepcount=0,e}t.GameModel=a}),define("game/obstacle/ObstacelFactory2",["require","exports","game/road/RoadPlane","game/obstacle/BoxObstacel","game/obstacle/CubeConfig","game/obstacle/ObstacelIcon","game/model/GameModel"],function(e,t,o,l,a,_,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.checkIsLastIndex=function(){return 2==this.ruleindex},n.checkIsSubArea=function(){return 6==this.ruleindex},n.reset=function(){this.ruleindex=0,this.ruleNum=GMath.random(7,11,!0)},n.ramdomRule=function(){var e,t=r.GameModel.isntance.count;for(e=t<45?3:t<80?4:t<100?5:t<150?6:7;;){var i=Math.floor(Math.random()*e);if(i!=this.ruleindex){this.ruleindex=i;break}}this.ruleNum=this.getRuleNum(this.ruleindex)},n.getRuleNum=function(e){var t,i=r.GameModel.isntance.count,n=!1;return(150<i||1.8<i/(.001*this.gettime()))&&(n=!0),0==e?(t=1-Math.min(1,i/100),GMath.random(3,5+6*t,!0)):1==e?GMath.random(3,8,!0):2==e?GMath.random(2,8,!0):3==e?GMath.random(4,8,!0)+(n?2:0):4==e?GMath.random(2,5,!0)+(n?2:0):5==e?GMath.random(3,6,!0)+(n?2:0):6==e?GMath.random(8,12,!0):0},n.createObstacel=function(e,t){return this.ruleNum<=0&&this.ramdomRule(),this.ruleNum--,this.createcubefuncs[this.ruleindex].call(this,e,t)},n.createRule0=function(e,t){var i=a.CubeConfig.baseTypes2,n=Math.floor(Math.random()*i.length);return n=i[n],this.createCubes(e,t,a.CubeConfig.cubeLib[n])},n.createRule1=function(e,t){return this.createSimple(e,t,!1,!1)},n.createRule2=function(e,t){return this.createSimple(e,t,!1,!0)},n.createRule3=function(e,t){return this.createSimple(e,t,!0,!0)},n.createRule4=function(e,t){var i=a.CubeConfig.dorrTypes,n=Math.floor(Math.random()*i.length);return n=i[n],this.createCubes(e,t,a.CubeConfig.cubeLib[n])},n.createRule5=function(e,t){var i=a.CubeConfig.jumpLib.length;return i=Math.floor(Math.random()*i),this.createCubes(e,t,a.CubeConfig.jumpLib[i],!0)},n.createRule6=function(e,t){var i=a.CubeConfig.subarea.length;return i=Math.floor(Math.random()*i),this.createCubes(e,t,a.CubeConfig.subarea[i])},n.createCubes=function(e,t,i,n){void 0===n&&(n=!1);for(var a,r,s=.5<Math.random(),o=[],l=i.length-1,h=0;h<=l;h++)for(var c=0;c<5;c++){var u=i[h][c];if(0<u&&(a=1==u?"res/88888.png":"res/arrow2.jpg",r=this.createCube(s?c:4-c,l-h,e,t,a,2==u),h==l&&o.push(r),2==u)){var d=new _.ObstacelIcon(_.ICON_TYPE.JUMP);t.addObjstacle(d),d.setPos(r.x,.1,-2.5,e),d.load("res/test/123.lh","111"),o.unshift(d)}}return o},n.createCube=function(e,t,i,n,a,r){var s;return void 0===r&&(r=!1),(s=r?l.TriObstacel.getInstance(this.cubesize,this.cubesize,this.cubesize):l.BoxObstacel.getInstance(this.cubesize,this.cubesize,this.cubesize)).setPosZ(i,1),s.setPosXY(.5*-o.RoadPlane.long+(e+.5)*this.cubesize,(t+.5)*this.cubesize+s.bendOffY/200*.05,0),s.skin=a,n.addObjstacle(s),s},n.createSimple=function(e,t,i,n){i&&(n=!0);var a,r=n?"res/77777.png":"res/88888.png",s=[];if(i){var o=GMath.random(0,4,!0);(a=this.createCube(o,0,e,t,r)).material.hasLight=!1,(c=this.createCube(o,1,e,t,r)).material.hasLight=!1,s.push(a);var l=this.createCube(o+1,0,e,t,r);l.material.hasLight=!1,s.push(l);var h=this.createCube(o+1,1,e,t,r);h.material.hasLight=!1,a.startMove(.5<Math.random(),c,[l,h])}else{var c;n?(o=GMath.random(0,5,!0),a=this.createCube(o,0,e,t,r),(c=this.createCube(o,1,e,t,r)).material.hasLight=!1,a.startMove(.5<Math.random(),c),a.material.hasLight=!1):a=this.createCube(GMath.random(1,4,!0),0,e,t,r),s.push(a)}return s},n.createSpeed=function(e,t){var i=new _.ObstacelIcon(_.ICON_TYPE.SPEED);t.addObjstacle(i);var n,a=GMath.random(0,5,!0);return n=0==a?.5*-o.RoadPlane.long+.4:4==a?.5*o.RoadPlane.long-.4:.5*-o.RoadPlane.long+(a+.5)*this.cubesize,i.setPos(n,.1,0,e),i.createPlane("res/arrow.png"),i},n.createSubSpeed=function(e,t){var i=new _.ObstacelIcon(_.ICON_TYPE.SUBSPEED,3);return t.addObjstacle(i),i.setPos(0,.1,0,e),i.createPlane("res/subspeed.png"),i},n.createBaoxiang=function(e,t){var i=new _.ObstacelIcon(_.ICON_TYPE.BAOXIANG);t.addObjstacle(i);var n,a=GMath.random(0,5,!0);return n=0==a?.5*-o.RoadPlane.long+.4:4==a?.5*o.RoadPlane.long-.4:.5*-o.RoadPlane.long+(a+.5)*this.cubesize,i.setPos(n,.3,0,e),i.setColor(3,3,3,1),i.load("res/man/baoxiang.lh","baoxiang"),i},n.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},n.gettime=function(){return Laya.timer.currTimer-this.starttime},n.starttime=0,n.blendType=0,n.ruleindex=0,n.ruleNum=0,n.createcubefuncs=[n.createRule0,n.createRule1,n.createRule5,n.createRule2,n.createRule3,n.createRule4,n.createRule6],n.cubesize=.6,n);function n(){}t.ObstacelFactory=i}),define("com/comp/WindMesh2",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=Laya.PrimitiveMesh,__extends(a,i),a.prototype.reset=function(e,t,i){this._num=i,this._long=e,this._width=t,this.activeResource(!0),this._positions=this._getPositions(),this._generateBoundingObject()},a.prototype.writevertices=function(e,t,i,n,a,r){var s=8*t;e[s++]=i,e[s++]=0,e[s++]=n,e[s++]=0,e[s++]=1,e[s++]=0,e[s++]=a,e[s++]=r},a.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},a.prototype.recreateResource=function(){var e,t;0==this._num?(t=e=1,this._num=1):(e=1,t=10),this._numberVertices=(e+1)*(t+1)*this._num,this._numberIndices=e*t*2*3*this._num;for(var i,n,a,r=new Uint16Array(this._numberIndices),s=Laya.VertexPositionNormalTexture.vertexDeclaration,o=s.vertexStride/4,l=new Float32Array(this._numberVertices*o),h=(this._long,this._width,this._long,this._width/t),c=0,u=.5*t,d=Math.PI/180*1,_=0;_<this._num;_++){var p=GMath.random(-40,220,!0),f=Math.PI/180*p*2;n=Math.random()<.5?(i=1.2,0):1-(i=Math.random()),a=5*-Math.random();for(var m=0;m<=t;m++)for(var g=1-Math.abs(m-u)/u,v=0;v<=e;v++)l[c++]=0,l[c++]=0,l[c++]=a-m*h,l[c++]=0==v?f-d*g:f+d*g,l[c++]=i,l[c++]=n,l[c++]=1*v/e,l[c++]=1*m/t}var y=0;for(_=0;_<this._num;_++)for(g=_*(e+1)*(t+1),m=0;m<t;m++)for(v=0;v<e;v++)r[y++]=g+(m+1)*(e+1)+v,r[y++]=g+m*(e+1)+v,r[y++]=g+(m+1)*(e+1)+v+1,r[y++]=g+m*(e+1)+v,r[y++]=g+m*(e+1)+v+1,r[y++]=g+(m+1)*(e+1)+v+1;this._vertexBuffer=new Laya.VertexBuffer3D(s,this._numberVertices,Laya.WebGLContext.STATIC_DRAW,!0),this._indexBuffer=new Laya.IndexBuffer3D(Laya.IndexBuffer3D.INDEXTYPE_USHORT,this._numberIndices,Laya.WebGLContext.STATIC_DRAW,!0),this._vertexBuffer.setData(l),this._indexBuffer.setData(r),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},a.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},a);function a(){var e=i.call(this)||this;return e._long=0,e._width=0,e._num=0,e.activeResource(),e._positions=e._getPositions(),e._generateBoundingObject(),e}t.WindMesh2=n}),define("com/comp/WindMaterial",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=Laya.BaseMaterial,__extends(a,i),a.prototype.setTransparent=function(e){void 0===e&&(e=!0),this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=Laya.BaseMaterial.BLENDPARAM_SRC_ALPHA,this.dstBlend=Laya.BaseMaterial.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.alphaTest=!0},a.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},Object.defineProperty(a.prototype,"diffuseTexture",{get:function(){return this._getTexture(a.DIFFUSETEXTURE)},set:function(e){this._setTexture(a.DIFFUSETEXTURE,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bendOffset",{get:function(){return this._getColor(a.BENDANGLE)},set:function(e){this._setColor(a.BENDANGLE,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bendDistance",{set:function(e){this._setNumber(a.BENDDISTANCE,e)},enumerable:!0,configurable:!0}),a.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},Object.defineProperty(a.prototype,"color",{set:function(e){this._setColor(a.COLOR,e)},enumerable:!0,configurable:!0}),a.initShader=function(){var e={a_Position:Laya.VertexElementUsage.POSITION0,a_Normal:Laya.VertexElementUsage.NORMAL0,a_Texcoord:Laya.VertexElementUsage.TEXTURECOORDINATE0},t={u_MvpMatrix:[Laya.Sprite3D.MVPMATRIX,Laya.Shader3D.PERIOD_SPRITE],u_WorldMat:[Laya.Sprite3D.WORLDMATRIX,Laya.Shader3D.PERIOD_SPRITE],u_ViewMatrix:[Laya.BaseCamera.VIEWMATRIX,Laya.Shader3D.PERIOD_CAMERA],u_texture:[a.DIFFUSETEXTURE,Laya.Shader3D.PERIOD_MATERIAL],_QOffset:[a.BENDANGLE,Laya.Shader3D.PERIOD_MATERIAL],_Dist:[a.BENDDISTANCE,Laya.Shader3D.PERIOD_MATERIAL],_Color:[a.COLOR,Laya.Shader3D.PERIOD_MATERIAL]},i=Laya.Shader3D.nameKey.add("WindShader");Laya.ShaderCompile3D.add(i,"attribute vec3 a_Normal;\n\n        attribute vec2 a_Texcoord;\n\n        attribute vec4 a_Position;\n\n        precision highp float;\n\n        uniform mat4 u_MvpMatrix;\n\n        uniform mat4 u_ViewMatrix;\n\n        uniform mat4 u_WorldMat;\n\n        uniform vec4 _QOffset; \n\n        uniform float _Dist; \n\n        uniform vec4 _Color; \n\n        varying vec4 v_Color;\n\n        varying vec2 v_Texcoord;\n\n        varying vec4 v_EyeSpacePos;\n\n        void main(){\n\n            highp vec4 vPos = a_Position;\n\n            vPos =  u_MvpMatrix *vPos;\n\n            float zOff = (1.0-vPos.z/15.0);\n\n            float alpha =zOff;\n \n            vPos = a_Position;\n\n            vec2 radius =vec2(cos(a_Normal.x),sin(a_Normal.x));\n\n            zOff =zOff*a_Normal.z +a_Normal.y;\n\n            vPos.xy = radius.xy*zOff\n;\n            mat4 mvMatrix = u_ViewMatrix*u_WorldMat;\n\n            vPos =  u_MvpMatrix *vPos;\n\n            zOff = vPos.z/_Dist;\n\n            \n            vPos += _QOffset*zOff*zOff;\n\n            gl_Position = vPos;\n\n            mat3 worldMat=mat3(u_WorldMat);\n\n            v_EyeSpacePos=mvMatrix*a_Position;\n\n            v_Texcoord=a_Texcoord;\n\n            v_Color=_Color;\n\n            v_Color.a=alpha;\n\n        }","precision highp float;\n\n        varying vec2 v_Texcoord;\n\n        uniform sampler2D u_texture;\n\n        varying vec4 v_Color;\n\n        void main(){\n\n            vec4 tex=texture2D(u_texture,v_Texcoord);\n\n            vec4 color=v_Color*tex;\n\n            gl_FragColor=color;\n\n        }\n",e,t)},a.DIFFUSETEXTURE=1,a.BENDANGLE=2,a.BENDDISTANCE=3,a.COLOR=4,a);function a(){var e=i.call(this)||this;return e.setShaderName("WindShader"),e.bendDistance=100,e.color=new Laya.Vector4(1,1,1,1),e}t.WindMaterial=n}),define("game/road/WindPlane",["require","exports","game/scene/GameSystem","utils/ObjectPool","com/comp/WindMesh2","com/comp/WindMaterial"],function(e,t,s,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=(r=Laya.MeshSprite3D,__extends(l,r),l.prototype.initMaterial=function(e){void 0===e&&(e=!0),this.material=new a.WindMaterial,this.meshRender.sharedMaterial=this.material,this.material.cull=0},l.prototype.setBendOffset=function(e,t){this.bendoff.x=e,this.bendoff.y=t,this.material.bendOffset=this.bendoff},Object.defineProperty(l.prototype,"skin",{set:function(e){this.material.diffuseTexture=Laya.Texture2D.load(e)},enumerable:!0,configurable:!0}),l.prototype.setPos=function(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.transform.translate(new Laya.Vector3(0,0,i),!1)},l);function l(){var e=r.call(this,new n.WindMesh2)||this;return e.bendoff=new Laya.Vector4(0,0,1,1),e.windmesh=e._geometryFilter.sharedMesh,e}t.WindPlane=o;var c,u=(c=Laya.Sprite3D,__extends(d,c),d.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},d.prototype.random=function(e,t,i,n){this.windPlane.windmesh.reset(1,5.5,e),this.orgx=0,this.orgy=-.3;var a=this.transform.position;a.x=this.orgx,a.y=this.orgy,a.z=n,this.transform.position=a;var r=s.GameSystem.getPos(n);this.windPlane.setBendOffset(r.x,r.y)},Object.defineProperty(d.prototype,"r",{set:function(e){this._r=e;var t=this.transform.position;t.x=this.orgx+this.cos*e,t.y=this.orgy+this.sin*e,this.transform.position=t},enumerable:!0,configurable:!0}),d.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},d.prototype.move=function(e){},d.prototype.recovery=function(){this.removeSelf(),d.pool.returnObject(this)},d.pool=new i.ObjectPool(d),d);function d(){var e=c.call(this)||this;return e.orgx=0,e.orgy=0,e.windPlane=new o,e.windPlane.initMaterial(!1),e.windPlane.skin="res/wind.png",e.windPlane.material.setTransparent(),e.addChild(e.windPlane),e}t.WindBox=u}),define("game/road/RoadLine",["require","exports","game/obstacle/BaseObstacle","game/obstacle/ObstacelFactory2","game/road/Build","game/road/RoadPlane","game/road/WindPlane"],function(e,t,r,s,a,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,l=(i=Laya.Sprite3D,__extends(c,i),c.onceVecter3=function(e,t,i){return this.tempVecter3.x=e,this.tempVecter3.y=t,this.tempVecter3.z=i,this.tempVecter3},c.prototype.drawLine=function(){0<this.windCoe&&this.drawWind(this.windCoe);var e=n.RoadBox.pool.getObject();this.addChild(e),this.lines.push(e);var t=[];if(t[0]=this.xpos,t[1]=this.ypos,this.xpos>this.targetposx?this.xpos=Math.max(this.xpos-5,this.targetposx):this.xpos<this.targetposx&&(this.xpos=Math.min(this.xpos+5,this.targetposx)),this.ypos>this.targetposy?this.ypos=Math.max(this.ypos-5,this.targetposy):this.ypos<this.targetposy&&(this.ypos=Math.min(this.ypos+5,this.targetposy)),t[2]=this.xpos,t[3]=this.ypos,e.reset(this,this.zpos,t),this.createBoxCount--,this.createBoxCount<=0&&(this.cancreateBaoxiang=!0,this.createBoxCount=GMath.random(100,120,!0)),this.is2D||(this.count%1==0&&(this.drawBuild(!0,0,e),this.drawBuild(!1,0,e)),this.count%this.speedspace==0?s.ObstacelFactory.checkIsLastIndex()||s.ObstacelFactory.checkIsSubArea()||0==this.count?this.drawObstacle(this.zpos,e):this.drawObstacle(this.zpos,e,7):this.drawObstacle(this.zpos,e)),this.zpos+=n.RoadPlane.width,this.count++,!this.is2D)if(0==this.continue){for(var i;;)if((i=Math.floor(Math.random()*this.randomblends.length))!=this.lastblendIndex){this.lastblendIndex=i;break}s.ObstacelFactory.blendType=i,this.targetposx=this.randomblends[i][0],this.targetposy=this.randomblends[i][1],this.continue=GMath.random(60,100)}else this.continue--},c.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},c.prototype.drawWind=function(e){var t=Math.floor(13*e);0<t&&this._drawWind(this.ownerZ,t)},c.prototype._drawWind=function(e,t){var i=o.WindBox.pool.getObject();this.addChild(i),this.winds.push(i),i.random(t,this.fogColor,this.ownerX,e+this.maxwinddistance)},c.prototype.loop=function(e,t){},c.prototype.removeCollider=function(e){if(e.isInCollider){e.isInCollider=!1;var t=this.colliderList.indexOf(e);0<=t&&this.colliderList.splice(t,1)}},c.prototype.addCollider=function(e){e.isInCollider=!0,this.colliderList.push(e)},c.prototype.drawObstacle=function(e,t,i){var n;if(void 0===i&&(i=-1),7!==i){if(0<this.nextObstacle&&this.nextObstacle--,this.nextObstacle<=0)if(console.log("添加一个宝箱"),n=this.cancreateBaoxiang?(this.cancreateBaoxiang=!1,s.ObstacelFactory.createBaoxiang(e,t)):s.ObstacelFactory.createObstacel(e,t),s.ObstacelFactory.checkIsLastIndex?this.nextObstacle=this.speedspace+2:s.ObstacelFactory.checkIsSubArea?this.nextObstacle=this.speedspace-3:this.nextObstacle=GMath.random(this.speedspace-1,this.speedspace+1,!0),n instanceof Array)for(var a=0,r=n.length;a<r;a++)this.addCollider(n[a]);else this.addCollider(n)}else this.addCollider(s.ObstacelFactory.createSpeed(e,t))},c.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},c.prototype.drawBuild=function(e,t,i){var n=a.Build.pool.getObject();n.left(e,t),n.setBendOffset(this.xpos,this.ypos),i.addObjstacle(n)},c.prototype.linjie=function(){var e=this.xpos,t=this.ypos;200<Math.abs(e)&&(this.xpos=0<this.xpos?200:-200),150<t?this.ypos=150:t<-150&&(this.ypos=-150)},c.prototype.stopAll=function(e){for(var t=0;t<this.numChildren;t++)for(var i=this.getChildAt(t),n=0;n<i.numChildren;n++){var a=i.getChildAt(n);a instanceof r.BaseObstacel&&a.stopTween()}},c.prototype.clearChildren=function(e){for(var t=e.length-1;0<=t;t--)e[t].recovery();e.length=0},c.prototype.reset=function(){s.ObstacelFactory.reset(),this.createBoxCount=15,this.clearChildren(this.lines),this.clearChildren(this.winds),this.count=0,this.ypos=0,this.xpos=0,this.zpos=0,this.windCoe=0,this.continue=GMath.random(8,8),this.targetposx=0,this.targetposy=0,this.firstLineIndex=0,this.winds.length=0,this.lines.length=0,this.colliderList.length=0,this.nextObstacle=12,this.lastblendIndex=0},c.prototype.dispose=function(){for(;this.numChildren;){var e=this.removeChildAt(0);e.dispose&&e.dispose()}},c.prototype.clearLine=function(e){e-=2*n.RoadPlane.width,this._clearLine(e,this.lines),this.firstLineIndex=Math.max(0,Math.ceil(e/n.RoadPlane.width)),this._clearLine(e,this.winds)},c.prototype.clearbycontinue=function(){this.clearChildren(this.winds),this.winds.length=0;for(var e=this.lines.length-5,t=0;t<e;t++)this.lines[t].clearchildren()},c.prototype._clearLine=function(e,t){for(;0<t.length;){var i=t[0];if(!(i.transform.localPosition.z<e))break;i.recovery(),t.shift()}},c.tempVecter3=new Laya.Vector3,c);function c(){var e=i.call(this)||this;return e.count=0,e.ypos=0,e.xpos=0,e.zpos=0,e.targetposx=0,e.targetposy=0,e.continue=30,e.planes=[],e.lines=[],e.firstLineIndex=0,e.windCoe=0,e.ownerZ=0,e.ownerX=0,e.cancreateBaoxiang=!1,e.res="res/roadA.png",e.speedspace=4,e.lastblendIndex=0,e.createBoxCount=10,e.randomblends=[[0,0],[200,0],[-200,0],[200,200],[-200,200]],e.winds=[],e.maxwinddistance=15,e.nextObstacle=12,e.colliderList=[],e}t.RoadLine=l}),define("game/road/RoadPlane",["require","exports","com/comp/RoadLineMaterial","com/comp/RoadMesh","game/road/Build","utils/ObjectPool","game/obstacle/BaseObstacle","game/obstacle/BaseCollision"],function(e,t,i,n,a,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,c=(l=Laya.MeshSprite3D,__extends(u,l),u.prototype.reset=function(e,t,i,n){void 0===i&&(i=u.long),void 0===n&&(n=u.width),this.roadMesh.reset(i,n,t),this.z1=e,this.blendsoffs=t},u.prototype.initMaterial=function(){this.material=new i.RoadLineMaterial,this.meshRender.sharedMaterial=this.material,this.material.cull=0},u.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},u.prototype.getBendOffset=function(e,t){var i=(e-this.z1)/u.width,n=1-i;t.x=this.blendsoffs[2]*i+this.blendsoffs[0]*n,t.y=this.blendsoffs[3]*i+this.blendsoffs[1]*n},Object.defineProperty(u.prototype,"skin",{set:function(e){this.material.diffuseTexture=Laya.Texture2D.load(e)},enumerable:!0,configurable:!0}),u.prototype.setPos=function(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.transform.translate(new Laya.Vector3(0,0,i),!1)},u.long=3,u.halflong=1.5,u.width=4,u.halfWidth=2,u);function u(){var e=l.call(this,new n.RoadMesh)||this;return e.roadMesh=e._geometryFilter.sharedMesh,e}t.RoadPlane=c;var d,_=(d=Laya.Sprite3D,__extends(p,d),p.prototype.addObjstacle=function(e){this.addChild(e),e instanceof o.BaseCollision?e.fogcolor=this.roadLine.fogColor:e instanceof a.Build?e.fogcolor=this.roadLine.fogColor:e instanceof s.BaseObstacel&&(e.fogcolor=this.roadLine.fogColor),this.obstacles.push(e)},p.prototype.reset=function(e,t,i){this.roadLine=e,this.plane.material.fogColor=e.fogColor,this.plane.skin=e.res;var n=this.transform.localPosition;n.z=t,this.transform.localPosition=n,this.plane.reset(t,i)},p.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},p.prototype.clearchildren=function(){var e=0;for(e=this.obstacles.length-1;0<=e;e--){var t=this.obstacles[e];t instanceof a.Build||(t.collisionRect&&this.roadLine.removeCollider(t),t.recovery?t.recovery():t.removeSelf(),this.obstacles.splice(e,1))}},p.prototype.recovery=function(){for(var e=0,t=this.obstacles.length;e<t;e++){var i=this.obstacles[e];i.collisionRect&&this.roadLine.removeCollider(i),i.recovery?i.recovery():i.removeSelf()}this.obstacles.length=0,this.roadLine=null,this.removeSelf(),p.pool.returnObject(this)},p.pool=new r.ObjectPool(p),p);function p(){var e=d.call(this)||this;return e.obstacles=[],e.plane=new c,e.plane.initMaterial(),e.addChild(e.plane),e}t.RoadBox=_}),define("com/comp/NewTrailMaterial",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=Laya.GlitterMaterial,__extends(a,i),Object.defineProperty(a.prototype,"bendOffset",{get:function(){return this._getColor(a.BENDANGLE)},set:function(e){this._setColor(a.BENDANGLE,e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bendDistance",{set:function(e){this._setNumber(a.BENDDISTANCE,e)},enumerable:!0,configurable:!0}),a.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},a.initShader=function(){var e={u_Texture:[1,1],u_Albedo:[2,1],u_Color:[3,1],_QOffset:[a.BENDANGLE,Laya.Shader3D.PERIOD_MATERIAL],_Dist:[a.BENDDISTANCE,Laya.Shader3D.PERIOD_MATERIAL],u_CurrentTime:[2,2],u_Duration:[3,2],u_MvpMatrix:[1,2]},t=Laya.Shader3D.nameKey.add(a.Name);Laya.ShaderCompile3D.add(t,"attribute vec4 a_Position;\n\n        attribute vec2 a_Texcoord0;\n\n        attribute float a_Time;\n\n        precision highp float;\n\n        uniform float _Dist; \n\n        uniform vec4 _QOffset; \n\n        uniform mat4 u_MvpMatrix;\n\n        uniform  float u_CurrentTime;\n\n        uniform  vec4 u_Color;\n\n        uniform float u_Duration;\n\n        \n\n        varying vec2 v_Texcoord;\n\n        varying vec4 v_Color;\n\n        \n\n        \n\n        void main()\n\n        {\n\n            highp vec4 vPos  = u_MvpMatrix * a_Position;\n\n            float zOff = vPos.z/_Dist;\n\n            vPos += _QOffset*zOff*zOff;\n\n            gl_Position = vPos;\n\n            \n\n            float age = u_CurrentTime-a_Time;\n\n            float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n\n            \n  \n            v_Texcoord=a_Texcoord0;\n\n            \n\n            v_Color=u_Color;\n\n            v_Color.a*=1.0-normalizedAge;\n\n            }\n ","#ifdef HIGHPRECISION\n\n            precision highp float;\n\n        #else\n\t\n            precision mediump float;\n\n        #endif\n\n        \n\n        uniform vec4 u_Albedo;\n\n        uniform sampler2D u_Texture;\n\n        \n\n        varying vec2 v_Texcoord;\n\n        varying vec4 v_Color;\n\n        \n\n        \n\n        void main()\n\n        {\t\n\n              gl_FragColor=texture2D(u_Texture, v_Texcoord);\n\n            gl_FragColor=gl_FragColor*v_Color;\n\n        }\n\n        \n",{a_Position:0,a_Texcoord0:2,a_Time:33},e)},a.Name="NewTrailShader",a.DIFFUSETEXTURE=0,a.ALBEDO=1,a.CURRENTTIME=2,a.UNICOLOR=3,a.DURATION=3,a.BENDANGLE=4,a.BENDDISTANCE=5,a);function a(){var e=i.call(this)||this;return e.setShaderName(a.Name),e.bendDistance=100,e.bendOffset=new Laya.Vector4(0,0,1,1),e}t.NewTrailMaterial=n}),define("game/road/Road",["require","exports","game/road/RoadPlane","game/road/RoadLine","game/scene/GameSystem"],function(e,t,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=(r=Laya.Sprite3D,__extends(o,r),o.prototype.initRoad=function(){for(var e=0;e<this.cacheRoadNum;e++)this.createRoad()},o.prototype.changeFog=function(e){this.curLine.fogColor=e},o.prototype.createRoad=function(){this.curLine.drawLine()},o.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},o.prototype.scroll=function(e,t,i,n){for(this.nowz+=e,this.curLine.clearLine(this.nowz),this.curLine.ownerZ=n,this.curLine.ownerX=i;this.curLine.lines.length<this.cacheRoadNum;)this.createRoad();this.curLine.loop(e,t)},Object.defineProperty(o.prototype,"allCollison",{get:function(){return this.curLine.colliderList},enumerable:!0,configurable:!0}),o.prototype.getPos=function(e){e=Math.abs(e);var t=Math.floor(e/i.RoadPlane.width);return 0<=(t-=this.curLine.firstLineIndex)&&t<this.curLine.lines.length?(this.curLine.lines[t].getChildAt(0).getBendOffset(e,this.tempPos),this.tempPos):null},o.prototype.stopAll=function(e){this.curLine&&this.curLine.stopAll(e)},o.prototype.reset=function(e){this.changeFog(e),this.nowz=0;var t=this.transform.position;t.toDefault(),this.transform.position=t,this.curLine.reset(),this.initRoad()},o.prototype.drawWind=function(e){this.curLine&&(this.curLine.windCoe=e)},o);function o(e){var t=r.call(this)||this;return t.cacheRoadNum=17,t.nowz=0,t.tempPos={x:0,y:0},t.is2d=e,t.layer=Laya.Layer.getLayerByNumber(12),e||(a.GameSystem.road=t),t.curLine=new n.RoadLine,t.curLine.is2D=t.is2d,t.addChild(t.curLine),t}t.Road=s}),define("game/ball/Ball",["require","exports","com/comp/CustomMaterial","com/comp/NewTrailMaterial","game/obstacle/BaseCollision"],function(e,t,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=(r=a.BaseCollision,__extends(o,r),o.prototype.setactivie=function(e){this.active=e,this.weiba.active=e},o.prototype.updateCollision=function(){var e=this.transform.position;this.collisionRect.height=.5+.5*this.speedCoe,this.collisionRect.x=e.x-.5*this.collisionRect.width,this.collisionRect.y=e.z-.5*this.collisionRect.height},o.prototype.addAfter=function(e){this.weiba=new Laya.Glitter,e.addChild(this.weiba);var t=this.weiba.templet;this.weibaMaterial=new n.NewTrailMaterial;var i=this.weiba.glitterRender.sharedMaterial=this.weibaMaterial;i.renderMode=Laya.GlitterMaterial.RENDERMODE_TRANSPARENTDOUBLEFACE,i.diffuseTexture=Laya.Texture2D.load("res/trail.png"),i.albedo=new Laya.Vector4(1.3,1.3,1.3,1),t.minSegmentDistance=0,t.minInterpDistance=.1,t.maxSlerpCount=32,t.maxSegments=128,this.setweibaStyle(1)},o.prototype.setweibaStyle=function(e){var t=this.weiba.templet;switch(e){case 1:t.lifeTime=.2,this.weibaoffx=.1,this.weibaoffy=-.2,this.weibaoffz=.8;break;case 2:t.lifeTime=1.5,this.weibaoffx=.1,this.weibaoffy=-.2,this.weibaoffz=.4;break;case 3:t.lifeTime=1.5,this.weibaoffx=.1,this.weibaoffy=-.2,this.weibaoffz=.1}},Object.defineProperty(o.prototype,"shaderMesh",{get:function(){return this.b.meshFilter.sharedMesh},enumerable:!0,configurable:!0}),o.prototype.shadowRotationX=function(e){var t=this.shadow.transform.localRotationEuler;t.x=e,this.shadow.transform.localRotationEuler=t},o.prototype.onloaded=function(){if(!this.destroyed){var e=this.shadow=this.tempshadow.clone();this.addChild(e);var t=e.transform.localPosition;t.y=-.13,t.z=0,e.transform.localPosition=t,e.transform.scale=new Laya.Vector3(.12,.12,.12),this.shadowRotationX(80),e.getChildAt(0).meshRender.sharedMaterial=this.shadowMaterial}},o.prototype.setBendOffset=function(e,t){this.blendoff.x=e,this.blendoff.y=t,this.material.bendOffset=this.blendoff,this.shadowMaterial.bendOffset=this.blendoff,this.weibaMaterial&&(this.weibaMaterial.bendOffset=this.blendoff)},Object.defineProperty(o.prototype,"fogcolor",{set:function(e){this.material.fogColor=e,this.shadowMaterial.fogColor=e},enumerable:!0,configurable:!0}),o.prototype.initMaterial=function(){this.material=new i.CustomMaterial,this.material.hasLight=!0,this.material.hasSpecular=!0,this.b.meshRender.sharedMaterial=this.material,this.shadowMaterial=new i.CustomMaterial,this.shadowMaterial.setTransparent(!1),this.shadowMaterial.diffuseTexture=Laya.Texture2D.load("res/10.png")},o.prototype.scroll=function(e){var t=this.transform.position;t.z+=e,this.transform.position=t;var i=this.parent.getPos(this.transform.localPosition.z);i&&this.setBendOffset(i.x,i.y),this.roll(e)},o.prototype.roll=function(e){o.tempVec.z=-(e+.2),this.b.transform.rotate(o.tempVec),this.loop()},o.prototype.changeBallRotate=function(e,t){this.b.transform.rotation=new Laya.Quaternion,this.b.transform.rotate(new Laya.Vector3(180,t,180),!1,!1)},o.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},o.prototype.setPos=function(e,t,i){this.MIN_Y=0,this.transform.localPosition.x+=e,this.transform.localPosition.y+=t,this.transform.localPosition.z+=i,this.transform.localPosition=this.transform.localPosition,this.updateCollision()},Object.defineProperty(o.prototype,"skin",{get:function(){return this.mSkin},set:function(e){this.mSkin=e,this.b.meshRender.sharedMaterial.diffuseTexture=Laya.Texture2D.load(e)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"afterSkin",{get:function(){return this.mAfterSkin},set:function(e){this.mAfterSkin=e,this.weibaMaterial&&(this.weibaMaterial.diffuseTexture=Laya.Texture2D.load(e))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"jump",{get:function(){return this.mJump},set:function(e){this.mJump=e,this.startJump()},enumerable:!0,configurable:!0}),o.prototype.startJump=function(){this.jumping||(this.jumping=!0,this.up=!0)},o.prototype.loop=function(){if(this.jumpLoop(),this.weiba){var e=this.b.transform.position;this._pos1.elements[0]=e.x-this.weibaoffx,this._pos2.elements[0]=e.x+this.weibaoffx,this._pos1.elements[1]=e.y-.15,this._pos2.elements[1]=e.y-.15,this._pos1.elements[2]=e.z+0,this._pos2.elements[2]=e.z+0,this.weiba.addGlitterByPositionsVelocitys(this._pos1,o.zerov,this._pos2,o.zerov)}},o.prototype.jumpLoop=function(){if(this.jumping){var e=this.b.transform.localPosition;this.up?(this.lv+=.025,e.y+=this.lv,e.y>=this.MAX_Y&&(this.up=!1)):(this.lv-=.025,e.y+=this.lv,e.y<=this.MIN_Y&&(e.y=this.MIN_Y,this.jumping=!1,this.mJump=!1,this.lv=0)),this.b.transform.localPosition=e}},o.prototype.dispose=function(){if(!this.destroyed)for(this.b.meshFilter.sharedMesh.dispose();this.numChildren;)this.removeChildAt(0)},o.prototype.getZ=function(){return this.transform.localPosition.z},o.prototype.setZ=function(e){var t=this.transform.localPosition;t.z=e,this.transform.localPosition=t},o.prototype.setX=function(e){this.transform.localPosition.x=e,this.transform.localPosition=this.transform.localPosition},o.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},o.radius=.15,o.radius2=.3,o.tempVec=new Laya.Vector3,o.zerov=new Laya.Vector3(0,0,0),o);function o(){var e=r.call(this,o.radius2-.2,o.radius2-.2)||this;return e.speedCoe=0,e.b=new Laya.MeshSprite3D(new Laya.SphereMesh(o.radius)),e.isuser=!1,e.blendoff=new Laya.Vector4(0,0,1,1),e.mJump=!1,e.jumping=!1,e.MAX_Y=.5,e.MIN_Y=0,e.up=!1,e.lv=0,e._pos1=new Laya.Vector3(0,0,-.5),e._pos2=new Laya.Vector3(0,0,.5),e.addChild(e.b),e.initMaterial(),e.tempshadow=Laya.Sprite3D.load("res/test/11_3.lh"),e.tempshadow.loaded?e.onloaded():e.tempshadow.once(Laya.Event.HIERARCHY_LOADED,e,e.onloaded),e}t.Ball=s}),define("newfunction/gamecore/util/RunData",["require","exports","newfunction/gamecore/deer/DeerSDK"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(a.getServiceData=function(t){var i=this;null!=this.word_rank?t(this.word_rank):n.default.instance.game_getGlobalRankingData(function(e){i.word_rank=e,t(e)},function(){t(null)})},a.saveWordScore=function(e){var t=this;n.default.instance.game_saveScoreToService(e,function(e){console.log("世界排行榜分数提交成功"),t.word_rank=null},function(e){console.log("世界排行榜分数提交失败")})},a.getBaoGameData=function(t){var i=this;null!=this.bao_game?t(this.bao_game):n.default.instance.ad_getAdData(n.DeerAdType.BOARD,function(e){i.bao_game=e,t(i.bao_game)})},a.getLoveGameData=function(t){var i=this;null!=this.love_game?t(this.love_game):n.default.instance.ad_getAdData(n.DeerAdType.RECOMMEND,function(e){i.love_game=e,t(i.love_game)})},a.getAniAd=function(t){var i=this;null!=this.aniads?t(this.aniads):n.default.instance.ad_getAdData(n.DeerAdType.ANIMATION,function(e){i.aniads=e,t(i.aniads)})},a.getOverData=function(t){var i=this;null!=this.over_data?t(this.over_data):n.default.instance.ad_getAdData(n.DeerAdType.GAME_OVER,function(e){i.over_data=e,t(i.over_data)})},a.getBannerData=function(t){var i=this;null!=this.banner_data?t(this.banner_data):n.default.instance.ad_getAdData(n.DeerAdType.BANNER,function(e){i.banner_data=e,t(i.banner_data)})},a.word_rank=null,a.bao_game=null,a.love_game=null,a.aniads=null,a.over_data=null,a.banner_data=null,a);function a(){}t.RunData=i}),define("sheets/vo/PConfig",["require","exports","sheets/vo/Sheets"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=i.PConfigBase,__extends(r,n),r.get=function(e){return this[e]?this[e]:SheetManager.get("pConfig",e,r)},r.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},r);function r(){return null!==n&&n.apply(this,arguments)||this}t.PConfig=a}),define("game/ball/RobotBall",["require","exports","sheets/vo/PConfig","game/obstacle/BaseObstacle","game/obstacle/ObstacelIcon","com/utils/Delay","game/road/RoadPlane","game/ball/Ball","utils/ObjectPool","game/utils/SoundUtils","game/scene/GameSystem"],function(e,t,i,g,v,n,y,C,a,E,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=(r=Laya.Sprite3D,__extends(o,r),Object.defineProperty(o.prototype,"fogcolor",{set:function(e){this.ball.fogcolor=e},enumerable:!0,configurable:!0}),o.prototype.init=function(){this.resetSpeed()},o.prototype.resetSpeed=function(){var e=i.PConfig.get(1005).value.split("|");this.speed=GMath.random(~~e[0],~~e[1])},o.prototype.setParent=function(e,t){this.road=e,t.addChild(this)},o.prototype.changeBallRotate=function(e,t){this.ball.changeBallRotate(0,t)},o.prototype.setPos=function(i,n,a){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return(t=this.transform.localPosition).x=i,t.y=n,t.z=a,this.transform.localPosition=t,this.targetmoveX=i,[2]})})},Object.defineProperty(o.prototype,"skin",{set:function(e){this.ball.skin=e},enumerable:!0,configurable:!0}),o.prototype.loopMove=function(){if(!this.isDead&&!this.isDead&&this.transform&&!this.isDead&&this.transform){var e=this.speed/50,t=this.road.getPos(this.transform.localPosition.z);t&&this.ball.setBendOffset(t.x,t.y);var i=this.transform.localPosition,n=i.x;this.targetmoveX!=n&&(n=this.targetmoveX>n?Math.min(this.targetmoveX,n+.23*e):Math.max(this.targetmoveX,n-.23*e),i.x=n),i.z+=e,this.transform.localPosition=i,this.ball.roll(e),this.ball.jump||this.hit(),this.updateTxt()}},o.prototype.updateTxt=function(){},o.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},o.prototype.clearSpeed=function(){},o.prototype.pushLine=function(e){for(var t=0,i=this.targetLines.length,n=!1,a=-1;t<i;t++){var r=this.targetLines[t];if(r.compare(e)){n=!0;break}-1==a&&e.min<r.min&&(a=t)}0==n&&(-1==a?this.targetLines.push(e):this.targetLines.splice(a,0,e))},o.prototype.hit=function(){if(!this.isDead&&this.transform){this.ball.updateCollision();for(var e=this.road.allCollison,t=this.transform.localPosition,i=t.z,n=t.x,a=!1,r=(C.Ball.radius2,Math.abs(this.targetmoveX-n)<.1),s=0;s<e.length;s++){var o=e[s],l=o.transform.position.z-i;if(8<l)break;if(!(l<-1))if(o instanceof v.ObstacelIcon){if(o.type==v.ICON_TYPE.JUMP){l<3&&(this.ball.jump=!0),this.targetmoveX=o.transform.localPosition.x;break}}else if(o instanceof g.BaseObstacel){if(this.ball.intersects(o)){i=o.transform.position.z-.5*o.width-C.Ball.radius,t.z=i,this.transform.localPosition=t,E.SoundUtils.instance.playSound(S.GameSystem.MUSIC_HITROBOT),this.dispose();break}if(r&&0<l){var h=o.long,c=o.transform.position.x,u=c-h/2,d=c+h/2;n+C.Ball.radius>u&&n-C.Ball.radius<d&&(a=!0),this.pushLine(x.getInstance(u,d))}}}if(a){this.targetmoveX=0;for(var _=x.getInstance(.5*-y.RoadPlane.long,.5*y.RoadPlane.long),p=(s=0,this.targetLines.length);s<p;s++)this.targetLines[s].clip(_,this.clipLines),this.targetLines[s].recovery();if(_.max-_.min>C.Ball.radius2&&this.clipLines.push(_),0<(p=this.clipLines.length)){var f=NaN;for(s=0;s<p;s++){var m=this.clipLines[s].getDistance(n);isNaN(f)?(_=this.clipLines[s],f=m):m<f-.01&&(_=this.clipLines[s],f=m)}this.targetmoveX=_.center}for(s=0;s<p;s++)this.clipLines[s].recovery()}this.targetLines.length=0,this.clipLines.length=0}},o.prototype.dispose=function(t){return void 0===t&&(t=!0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.isDead=!0,t?[4,n.Delay.delay(1500)]:[3,2];case 1:return e.sent(),this.remove(),[3,3];case 2:this.remove(),e.label=3;case 3:return[2]}})})},o.prototype.remove=function(){this.removeSelf(),this.ball.dispose(),this.destroy(!0)},o);function o(){var e=r.call(this)||this;return e.vec3=new Laya.Vector3,e.isOver=!1,e.speed=0,e.oldTime=0,e.x=0,e.y=0,e.targetLines=[],e.clipLines=[],e.isDead=!1,e.ball=new C.Ball,e.ball.setPos(0,0,0),e.addChild(e.ball),e.init(),e}t.RobotBall=s;var x=(l.getInstance=function(e,t){var i=this.pool.getObject();return i.reset(e,t),i},l.prototype.reset=function(e,t){this.min=e,this.max=t},l.prototype.getDistance=function(e){return Math.abs(this.center-e)},Object.defineProperty(l.prototype,"center",{get:function(){return(this.min+this.max)/2},enumerable:!0,configurable:!0}),l.prototype.compare=function(e){return e.min-.1<this.max&&e.max+.1>this.min&&(this.max=Math.max(this.max,e.max),this.min=Math.min(this.min,e.min),!0)},l.prototype.clip=function(e,t){var i=e.min,n=this.min;n-i>C.Ball.radius2&&t.push(l.getInstance(i,n)),e.min=this.max},l.prototype.recovery=function(){l.pool.returnObject(this)},l.pool=new a.ObjectPool(l),l);function l(){}}),define("game/ai/BallAI",["require","exports","game/ball/RobotBall","sheets/vo/BallSkin","com/utils/Delay","game/model/GameModel","game/scene/GameScene","sheets/vo/PConfig"],function(e,t,s,o,n,a,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(c.prototype.reset=function(){for(;this.robots.length;)this.robots.pop().dispose(!1);this.upBalls.length=0,this.robots.length=0,this.backBalls.length=0,this.createAIBall()},c.prototype.dispose=function(){for(;this.robots.length;)this.robots.pop().dispose(!1);this.upBalls.length=0,this.robots.length=0,this.backBalls.length=0},c.prototype.createAIBall=function(){for(var e=0;e<this.MAX_BALL;e++){var t,i,n=new s.RobotBall,a=1e3+GMath.random(1,o.BallSkin.getAllSkin().length),r=o.BallSkin.get(a);n.skin=r.skin,n.setParent(this.road,this.road),n.changeBallRotate(0,90),i=(e+1)%2==0?(t=-.5,e+.5*e+4.5):e+(t=.5)*e+2+5.5,n.setPos(t,.25,i),this.robots.push(n),this.upBalls.push(n)}},c.prototype.createSingleAIBall=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(e){switch(e.label){case 0:return(t=new s.RobotBall).fogcolor=this.road.curLine.fogColor,i=o.BallSkin.get(1e3+GMath.random(1,o.BallSkin.getAllSkin().length)),t.skin=i.skin,t.changeBallRotate(-90,90),[4,n.Delay.delay(50)];case 1:return e.sent(),this.robots.push(t),t.setParent(this.road,this.road),.05<Math.random()?(this.upBalls.push(t),t.setPos(GMath.random(-1,1,!1),.25,this.road.nowz+GMath.random(30,30))):(this.backBalls.push(t),t.speed=~~l.PConfig.get(1006).value,t.setPos(GMath.random(-1,1,!1),.25,this.road.nowz-3)),[2]}})})},c.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},c.prototype.loop=function(){for(var e=this.robots.length-1;0<=e;e--)(i=this.robots[e]).isDead?(this.robots.splice(e,1),this.robots.length<5&&this.createSingleAIBall(!0)):(this.road,!i.isDead&&Math.abs(i.transform.localPosition.z)<Math.abs(this.road.nowz)+35?i.loopMove():i.destroyed||(i.oldTime=getTimer()),!i.isDead&&Math.abs(i.transform.localPosition.z)+5<Math.abs(this.road.nowz)&&i.dispose(!1),!i.isDead&&Math.abs(i.transform.localPosition.z)-40>Math.abs(this.road.nowz)&&(console.log(this.road.nowz,Math.abs(i.transform.localPosition.z)-21),i.dispose(!1)));for(e=this.upBalls.length-1;0<=e;e--)if(i=this.upBalls[e])if(i.isDead&&i.destroyed)this.upBalls.splice(e,1);else{var t=Math.abs(r.GameS1.instance.m_ballskin.getZ())+.5;Math.abs(i.transform.localPosition.z)<t&&!i.isOver&&(i.isOver=!0,a.GameModel.isntance.count++,this.upBalls.splice(e,1),i.isDead||this.backBalls.push(i))}for(e=this.backBalls.length-1;0<=e;e--){var i;(i=this.backBalls[e])&&(i.isDead&&i.destroyed?this.backBalls.splice(e,1):(t=Math.abs(r.GameS1.instance.m_ballskin.getZ()))<Math.abs(i.transform.localPosition.z)+.5&&i.isOver&&(i.isOver=!1,a.GameModel.isntance.count--,this.backBalls.splice(e,1),i.isDead||this.upBalls.push(i)))}},c);function c(e,t){this.MAX_BALL=10,this.robots=[],this.upBalls=[],this.backBalls=[],this.road=e,this.mParent=t}t.BallAI=i}),define("game/utils/TweenColor",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(Object.defineProperty(n.prototype,"startstr",{set:function(e){var t=parseInt(e.substr(1),16);this.targetB=this.startB=t%256/255,t>>=8,this.targetG=this.startG=t%256/255,t>>=8,this.targetR=this.startR=t%256/255,this.per=0},enumerable:!0,configurable:!0}),n.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},n.prototype.tween=function(e,t){this.startB=this.curB,this.startG=this.curG,this.startR=this.curR,this.lasttime=Laya.timer.currTimer,this.duration=t,this._per=0;var i=parseInt(e.substr(1),16);this.targetB=i%256/255,i>>=8,this.targetG=i%256/255,i>>=8,this.targetR=i%256/255},n.prototype.loop=function(){if(1!=this._per&&0!=this.lasttime){var e=Laya.timer.currTimer;this.per=Math.min(1,(e-this.lasttime)/this.duration)}},Object.defineProperty(n.prototype,"per",{get:function(){return this._per},set:function(e){this._per=e,this.render(this._per)},enumerable:!0,configurable:!0}),n.prototype.render=function(e){var t=1-e;this.curB=this.startB*t+e*this.targetB,this.curG=this.startG*t+e*this.targetG,this.curR=this.startR*t+e*this.targetR,this.cb()},n);function n(e){this.targetR=0,this.targetG=0,this.targetB=0,this.startR=0,this.startG=0,this.startB=0,this._per=0,this.lasttime=0,this.cb=e}t.TweenColor=i}),define("newfunction/game/Game1",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=Laya.Scene,__extends(a,i),a.prototype.leftMoveBall=function(){if(this.m_is2ds){var e=this.m_ballskin.transform.localPosition;this.m_aleme+=2;var t=this.m_aleme*Math.PI/180;this.m_2dskin?e.x=.5*Math.sin(t)-.2:e.x=.8*Math.sin(t),this.m_ballskin.transform.localPosition=e}},a.prototype.m_up=function(){this.mouseisdn=!1,Laya.stage.off(Laya.Event.MOUSE_UP,this,this.m_up),Laya.stage.off(Laya.Event.MOUSE_OUT,this,this.m_up)},a.m_orpler=0,a.m_pc=0,a.m_atcrroton=new Laya.Vector3(-3,180,0),a);function a(){var e=null!==i&&i.apply(this,arguments)||this;return e.m_is2ds=!1,e.m_iadvrot=0,e.m_2dskin=!1,e.m_off2dskin=-1.5,e.m_off2dskx=-2,e.m_camdfltz=1,e.m_aleme=0,e.iscgcltm=0,e.m_fgcr=new Laya.Vector4(104/255,.8,.8,1),e.m_isupgo=0,e.is_addspedt=0,e.is_addspedtgett=0,e.is_soundped=!1,e.is_carmecoe=1,e.is_mover=!1,e.m_bxnum=0,e.m_isgeing=!1,e.m_waittm=3,e.m_dfcamay=0,e.m_bfte=0,e.m_ligtcolr=new Laya.Vector3(1,1,1),e.m_dfbaz=4,e.mouseisdn=!1,e}t.Game1=n}),define("newfunction/game/Game2",["require","exports","newfunction/game/Game1"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=i.Game1,__extends(r,n),r);function r(){return n.call(this)||this}t.Game2=a}),define("newfunction/game/Game3",["require","exports","newfunction/game/Game2"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=i.Game2,__extends(r,n),r);function r(){return n.call(this)||this}t.Game3=a}),define("newfunction/game/Game4",["require","exports","game/road/RoadPlane","game/obstacle/ObstacelFactory2","game/model/GameModel","game/road/Build","sheets/vo/Color","game/scene/GameScene","newfunction/game/Game3","sheets/vo/PConfig"],function(e,t,o,i,n,a,r,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u,d=(u=l.Game3,__extends(_,u),_.prototype.m_itsgame=function(){this.m_clidex=this.getConfigData(1015),this.m_itlight(),this.m_cgcolor(),this.is_maxsped=this.getConfigData(1003),this.is_minsped=this.getConfigData(1001),this.is_addspedt=this.getConfigData(1004),s.GameS1.m_pc=this.getConfigData(1011),s.GameS1.m_orpler=this.getConfigData(1012)},_.prototype.getConfigData=function(e){return c.PConfig.get(e).value},_.prototype.m_itlight=function(){var e=new Laya.PointLight;this.m_poit=this.m_ca.addChild(e),this.m_poit.intensity=1.2;var t=new Laya.Vector3(0,200,-10);this.m_poit.transform.translate(t)},_.prototype.m_cgcolor=function(){this.m_twfogcr.startstr=r.Color.getCurColor(this.m_clidex).fog,this.m_tweligcr.startstr=r.Color.getCurColor(this.m_clidex).light,this.m_is2ds||(a.Build.defColor=r.Color.getCurColor(this.m_clidex).defColor),this.m_rd.curLine.res=r.Color.getCurColor(this.m_clidex).skin},_.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},_.prototype.m_ready=function(e){if(void 0===e&&(e=!0),this.m_bxnum=0,this.m_ballskin.setactivie(!0),this.m_is2ds){var t=GMath.random(0,5,!0);this.m_clidex=t}else n.GameModel.isntance.stepcount=0;1==e&&this.m_cgcolor(),this.m_clidex++,i.ObstacelFactory.starttime=Laya.timer.currTimer,this.m_sizemax=this.getConfigData(1009)},_.prototype.m_scroll=function(e,t,i){this.m_ballskin.scroll(e);var n=this.m_ballskin.transform.position.x,a=this.m_ballskin.transform.position.z;this.m_rd.scroll(e,t,n,a),this.m_ballskinai&&this.m_ballskinai.loop();var r,s=this.m_ca.transform.localPosition;this.m_is2ds?(r=a-3,this.m_2dskin?s.z=this.m_ballskin.transform.position.z+this.m_off2dskin:(s.y=-.2,s.z=.93*s.z+.07*r)):(s.x=1.4*n/o.RoadPlane.long,t*=.8,this.is_carmecoe=.91*this.is_carmecoe+.09*t,s.z=s.z*this.is_carmecoe+(a-3)*(1-this.is_carmecoe)),this.m_ca.transform.localPosition=s},_.prototype.m_itevent=function(){this.iscgcltm=0,this.is_addspedtgett=0,this.m_addsped=!1,this.is_odtime=getTimer()},_.prototype.m_conit=function(){this.m_iadvrot++,this.m_waittm=3,this.m_rd.curLine.clearbycontinue(),this.m_ballskin.setactivie(!0),Laya.stage.addChild(this.text_time),this.m_ballskin.setX(0);var e=this.m_ca.transform.localPosition,t=this.m_ballskin.transform.position.z;e.x=0,e.z=t-3,this.m_ca.transform.localPosition=e;var i=this.m_ca.transform.localRotationEuler;i.z=0,this.m_ca.transform.localRotationEuler=i},_);function _(){var e=u.call(this)||this;return e.m_itsgame(),e}t.Game4=d}),define("game/scene/GameScene",["require","exports","newfunction/game/Game4","sheets/vo/BallSkin","game/obstacle/ObstacelFactory2","game/scene/GameSystem","game/utils/SoundUtils"],function(e,t,i,n,a,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,l=(o=i.Game4,__extends(c,o),Object.defineProperty(c,"instance",{get:function(){return this.mInstance||(this.mInstance=new c(!1)),this.mInstance},enumerable:!0,configurable:!0}),c.prototype.startGame=function(){"undefined"!=typeof wx&&this.m_gyro(),"undefined"!=typeof wx&&wx.onGyroscopeChange(function(e){}),0==this.m_is2ds&&s.SoundUtils.instance.playBGM(r.GameSystem.MUSIC_BG1),this.is_mover=!1,this.m_isgeing=!0,this.m_iadvrot=0,a.ObstacelFactory.starttime=Laya.timer.currTimer},c.prototype.m_gyro=function(){var e=this;"undefined"!=typeof wx&&wx.startGyroscope({interval:"game",success:function(){},fail:function(){e.m_gyro()}})},c.prototype.m_swskin=function(){var e=new Laya.Vector3(0,.25,this.m_dfbaz),t=new Laya.Vector3(0,0,0);this.m_ballskin.transform.localPosition=e,this.m_rd.transform.position=t},c.prototype.m_gtball=function(){var e=new n.BallSkin;return e.skin=this.m_ballskin.skin,e.afterSin=this.m_ballskin.afterSkin,e},c.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},c.prototype.m_swshopsk=function(){this.m_2dskin=!0;var e=new Laya.Vector3(0,.25,this.m_dfbaz),t=new Laya.Vector3(0,0,0);this.m_ballskin.transform.localPosition=e,this.m_rd.transform.position=t,this.m_ready(),this.startGame(),this.m_ballskin.setweibaStyle(3);var i=this.m_ca.transform.localPosition,n=this.m_ballskin.transform.position.z+this.m_off2dskin;i.x=this.m_off2dskx,i.y=1.5,i.z=n,this.m_ca.transform.localPosition=i,this.m_ca.fieldOfView=20,(i=this.m_ballskin.transform.position.clone()).x-=0,i.z+=0,this.m_ca.transform.lookAt(i,Laya.Vector3.UnitY,!1);var a=120*Laya.stage.clientScaleY,r=750*Laya.stage.clientScaleX,s=340*Laya.stage.clientScaleY;this.m_ca.viewport=new Laya.Viewport(0,a,r,s),Laya.Browser.onPC?this.m_ca.viewport=new Laya.Viewport(0,50,750,200):Laya.Browser.onMobile&&(this.m_ca.viewport=new Laya.Viewport(0,128,750,360)),this.m_up(),Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.m_down)},c.prototype.m_cgskin=function(e){this.m_ballskin.skin=e.skin,this.m_ballskin.afterSkin=e.afterSin},c.prototype.m_stop=function(){this.m_rmevent(),this.m_ballskin.dispose(),this.m_rd.curLine.dispose(),this.destroy(!0)},c.mInstance=null,c);function c(e){var t=o.call(this)||this,i=e;return t.m_is2ds=i,t}t.GameS1=l}),define("newfunction/ChouQiu",["require","exports","game/scene/GameScene","game/scene/GameSystem","com/help/GameConfig","game/Ctrl/GameCtrl","game/utils/SoundUtils","wx/dataCenter"],function(e,t,i,n,a,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,h=(l=ui.main.drawUI,__extends(c,l),c.prototype.onOpened=function(){this.isbool=!1,Laya.timer.frameLoop(20,this,this.changeValue),this.box_dianji.on(Laya.Event.CLICK,this,this.addBar),this.removeChild(this.box_dianji),this.box_dianji.y=Laya.stage.height-this.box_dianji.height-150,this.box_dianji.x=Laya.stage.width/2-this.box_dianji.width/2,Laya.stage.addChild(this.box_dianji),this.box_dianji.zOrder=1001,this.close_bt.on(Laya.Event.CLICK,this,this.onClose),a.GameConfig.chouqiu.x=this.chou_bg.width/2,a.GameConfig.chouqiu.y=this.chou_bg.height/2,this.chou_bg.addChild(a.GameConfig.chouqiu)},c.prototype.addBar=function(){var e=this;s.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),.005<this.reduce_bar&&(this.reduce_bar-=.005),this.chou_bar.value+=this.chang_bar,.05<this.chang_bar-.001?this.chang_bar-=.001:this.chang_bar=.05,.8<=this.chou_bar.value&&0==this.isbool&&(Laya.stage.event("show"),Laya.timer.once(1e3,this,function(){Laya.stage.event("hind")}),this.isbool=!0,a.GameConfig.chouqiu.play("idle",!1),Laya.timer.once(3e3,this,function(){e.onClose()}),playerCenter.Dionum.sapphire+=a.GameConfig.limitInteger(5,10),Laya.stage.event("updata_dia"),o.dataCenter.I.send("diamond",JSON.stringify(playerCenter.Dionum)))},c.prototype.onClose=function(){s.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),0<i.GameS1.instance.m_bxnum?r.GameCtrl.getInstance().runLogic(11):r.GameCtrl.getInstance().runLogic(6),this.close()},c.prototype.onClosed=function(){Laya.timer.clearAll(this),this.box_dianji.off(Laya.Event.CLICK,this,this.addBar),Laya.stage.removeChild(this.box_dianji),this.chou_bar.value=0,this.chou_bg.removeChild(a.GameConfig.chouqiu)},c.prototype.changeValue=function(){0<=this.chou_bar.value-this.reduce_bar?(this.chou_bar.value-=this.reduce_bar,this.reduce_bar+=.005):(this.chou_bar.value=0,this.reduce_bar=.001,this.chang_bar=.1)},c);function c(){var e=l.call(this)||this;return e.chang_bar=.4,e.reduce_bar=.001,e.isbool=!1,e}t.ChouQiu=h}),define("newfunction/Setting",["require","exports","game/scene/GameSystem","wx/wxInterface","game/utils/SoundUtils"],function(e,t,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=(r=ui.main.settingUI,__extends(o,r),o.prototype.onOpened=function(){this.close_bt.on(Laya.Event.CLICK,this,this.closeView),this.cotr_sound.on(Laya.Event.CLICK,this,this.cotrSound),this.cotr_music.on(Laya.Event.CLICK,this,this.cotrMusci),this.share_bt.on(Laya.Event.CLICK,this,this.onShare),this.inin(),Laya.stage.event("show")},o.prototype.onShare=function(){a.SoundUtils.instance.playSound(i.GameSystem.MUSIC_DIANJI),n.wxInterface.I.share("skin")},o.prototype.inin=function(){a.SoundUtils.instance.mCloseSound?this.switchImg(this.set_close,1):this.switchImg(this.set_open,1),a.SoundUtils.instance.mcloseBgm?(this.switchImg(this.set_close,2),a.SoundUtils.instance.stopBGM()):(this.switchImg(this.set_open,2),a.SoundUtils.instance.startBGM())},o.prototype.cotrSound=function(){a.SoundUtils.instance.playSound(i.GameSystem.MUSIC_DIANJI),a.SoundUtils.instance.mCloseSound?(a.SoundUtils.instance.mCloseSound=!1,this.switchImg(this.set_open,1)):(a.SoundUtils.instance.mCloseSound=!0,this.switchImg(this.set_close,1))},o.prototype.cotrMusci=function(){a.SoundUtils.instance.playSound(i.GameSystem.MUSIC_DIANJI),a.SoundUtils.instance.mcloseBgm?(a.SoundUtils.instance.startBGM(),this.switchImg(this.set_open,2)):(this.switchImg(this.set_close,2),a.SoundUtils.instance.stopBGM())},o.prototype.switchImg=function(e,t){switch(t){case 1:this.cotr_sound.graphics.clear(),this.cotr_sound.loadImage(e);break;case 2:this.cotr_music.graphics.clear(),this.cotr_music.loadImage(e)}},o.prototype.disable=function(){},o.prototype.enable=function(){},o.prototype.closeView=function(){a.SoundUtils.instance.playSound(i.GameSystem.MUSIC_DIANJI),this.close()},o.prototype.onClosed=function(){Laya.stage.event("hind"),this.close_bt.off(Laya.Event.CLICK,this,this.closeView)},o);function o(){var e=r.call(this)||this;return e.set_open="res/setting_open.png",e.set_close="res/setting_close.png",e}t.Setting=s}),define("newfunction/Welfare",["require","exports","game/scene/GameSystem","com/help/GameConfig","wx/dataCenter","game/utils/SoundUtils"],function(e,t,n,a,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=(i=ui.main.welfareUI,__extends(l,i),l.prototype.onOpened=function(){this.close_bt.on(Laya.Event.CLICK,this,this.closeView),this.get_award.on(Laya.Event.CLICK,this,this.onGetAward),Laya.stage.event("show")},l.prototype.onGetAward=function(){s.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI);var i=this;1104==a.GameConfig.scene_id?a.GameConfig.isNewDay("welfare",function(e){e?r.dataCenter.I.get("diamond",function(e){var t=0;null!=e&&null!=e.chest&&(t=e.chest),playerCenter.Dionum.chest=t+100,r.dataCenter.I.send("diamond",playerCenter.Dionum),Laya.stage.event("updata_dia"),i.closeView()}):Laya.stage.event("Tip",[{title:"今日已领取"}])}):Laya.stage.event("Tip",[{title:"请从我的小程序进入"}])},l.prototype.disable=function(){},l.prototype.enable=function(){},l.prototype.closeView=function(){s.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),Laya.stage.event("hind"),this.close()},l.prototype.onClosed=function(){this.close_bt.off(Laya.Event.CLICK,this,this.closeView),this.get_award.off(Laya.Event.CLICK,this,this.onGetAward)},l);function l(){return i.call(this)||this}t.Welfare=o}),define("game/View/FriendRankItem",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=ui.main.FriendRankItemUI,__extends(a,i),Object.defineProperty(a.prototype,"dataSource",{get:function(){return this.mData},set:function(e){e&&(this.mData=e,this.updateData())},enumerable:!0,configurable:!0}),a.prototype.updateData=function(){this.txt_name.text=this.mData.nickname,this.txt_score.text=this.mData.amount+"",this.mData.index<=3?(this.rank_img.visible=!0,this.txt_rank.visible=!1,this.rank_img.skin=this.urls[this.mData.index-1]):(this.txt_rank.text=this.mData.index+"",this.rank_img.visible=!1,this.txt_rank.visible=!0),this.icon.skin=this.mData.avatar},a.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},a);function a(){var e=i.call(this)||this;return e.urls=["comp/rank_one.png","comp/rank_two.png","comp/rank_three.png"],e}t.FriendRankItem=n}),define("game/View/FriendRankPanel",["require","exports","game/utils/SoundUtils","game/scene/GameSystem","newfunction/gamecore/util/RunData","utils/GameSetting","game/View/FriendRankItem","wx/wxInterface"],function(e,t,i,n,a,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,c=(l=ui.main.FriendRanlkUI,__extends(u,l),u.prototype.createChildren=function(){l.prototype.createChildren.call(this),this.word_list.itemRender=s.FriendRankItem,this.word_list.vScrollBarSkin="",this.word_list.scrollBar.elasticBackTime=500,this.word_list.scrollBar.elasticDistance=200,r.GameSetting.ismingame&&(this._listsp=new Laya.Sprite,this._listsp.size(750,1334),this.addChild(this._listsp))},u.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},u.prototype.onOpened=function(){if(r.GameSetting.ismingame){if(this._listsp.graphics.clear(),null!=typeof wx)var e=new Laya.Texture(Laya.Browser.window.sharedCanvas);e.bitmap.alwaysChange=!0,this._listsp.graphics.drawTexture(e,0,0,e.width,e.height)}this.switchImg(2),l.prototype.onOpened.call(this),this.enable(),this.getServiceData(),Laya.stage.event("show")},u.prototype.getServiceData=function(){var n=this;a.RunData.getServiceData(function(e){if(e){var t=e.score_rank,i=e.my_score;n.word_data=t,n.my_data=i,n.word_list.array=n.word_data,n.myDataInfo()}})},u.prototype.myDataInfo=function(){this.my_head.skin=this.my_data.avatar,this.my_name.text=this.my_data.nickname,this.my_score.text=this.my_data.amount+"",this.my_data.index<=3?this.my_rankimg.skin=this.urls[this.my_data.index-1]:this.my_rank.text=this.my_data.index+""},u.prototype.closeView=function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),this.close(),this.disable(),o.wxInterface.I.postMessage({type:"close_r"})},u.prototype.enable=function(){this.btn_close.on(Laya.Event.MOUSE_UP,this,this.closeView),this.my_bt.on(Laya.Event.CLICK,this,this.showFried),this.word_bt.on(Laya.Event.CLICK,this,this.showWord)},u.prototype.showFried=function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),this.switchImg(2)},u.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},u.prototype.showWord=function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),this.switchImg(1)},u.prototype.switchImg=function(e){switch(this.my_bt.graphics.clear(),this.word_bt.graphics.clear(),e){case 1:this.my_bt.loadImage(this.rank_myok),this.word_bt.loadImage(this.rank_wordno),this.my_infobox.visible=!0,this._listsp.visible=!1,this.word_list.visible=!0;break;case 2:this.my_bt.loadImage(this.rank_myno),this.word_bt.loadImage(this.rank_wordok),this.my_infobox.visible=!1,this._listsp.visible=!0,this.word_list.visible=!1}},u.prototype.disable=function(){this.btn_close.off(Laya.Event.MOUSE_UP,this,this.closeView),this.my_bt.off(Laya.Event.CLICK,this,this.showFried),this.word_bt.off(Laya.Event.CLICK,this,this.showWord),this.word_list.array=null,this._listsp.graphics.clear(),Laya.stage.event("hind")},u);function u(){var e=null!==l&&l.apply(this,arguments)||this;return e.word_data=[],e.my_data=null,e.urls=["comp/rank_one.png","comp/rank_two.png","comp/rank_three.png"],e.rank_myok="comp/rank_myok.png",e.rank_myno="comp/rank_myno.png",e.rank_wordok="comp/rank_wordok.png",e.rank_wordno="comp/rank_wordno.png",e}t.FriendRankPanel=c}),define("game/View/GameGuide",["require","exports","game/scene/GameScene"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=ui.main.GameGuideUI,__extends(r,n),r.prototype.enable=function(){this.endTime=Math.floor(9*Math.random()+11),this.timeNum=0,this.text_time.value=this.timeNum+"/"+this.endTime,this.move.play(),Laya.stage.event("close_txt",!1);var e=Math.round(3*Math.random());this.tweenHandler=new Laya.Handler(this,function(){this.text_time.value=Math.floor(this.timeNum)+"/"+this.endTime}),Laya.Tween.to(this,{timeNum:this.endTime,update:this.tweenHandler},3e3,r.easeType[e],Laya.Handler.create(this,this.gamestart))},r.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},r.prototype.gamestart=function(){Laya.timer.once(500,this,function(){this.tweenHandler.recover(),Laya.stage.event("close_txt",!0),i.GameS1.instance.startGame(),this.removeSelf(),this.disable()})},r.prototype.disable=function(){this.move.stop()},r.easeType=[Laya.Ease.quartInOut,Laya.Ease.strongOut,Laya.Ease.circIn,Laya.Ease.linearIn,Laya.Ease.expoInOut],r);function r(){var e=n.call(this)||this;return e.timeNum=0,e.endTime=3,e}t.GameGuide=a}),define("game/View/GameOver",["require","exports","game/utils/SoundUtils","game/scene/GameSystem","game/model/GameModel","utils/GameSetting","game/scene/GameScene","game/Ctrl/GameCtrl","wx/dataCenter","wx/wxInterface","newfunction/gamecore/deer/DeerSDK","com/help/GameConfig"],function(e,t,i,n,a,r,s,o,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _,p=(_=ui.main.GameOvUI,__extends(f,_),f.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},f.prototype.onOpened=function(){this.ft_num=d.GameConfig.baseinfo.revive,this.enable()},f.prototype.onClosed=function(){this.disable()},f.prototype.timeLoop=function(){this.time--,this.time<1?this.closeView():this.text_time.text=this.time.toString()},f.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},f.prototype.enable=function(){var t=this;this.isDown=0,this.btn_reborn.on(Laya.Event.CLICK,this,this.m_rebornd),this.btn_close.on(Laya.Event.CLICK,this,this.closeView),this.btn_video.on(Laya.Event.CLICK,this,this.m_videro),this.time=10,this.text_time.text=this.time.toString(),Laya.timer.loop(1e3,this,this.timeLoop),a.GameModel.isntance.saveScore(Math.round(a.GameModel.isntance.stepcount),function(){l.dataCenter.I.get(SAVEKEY.SCORE,function(e){t.text_score.text=e+""})}),r.GameSetting.ismingame&&l.dataCenter.I.get("diamond",function(e){e&&(playerCenter.Dionum=e)}),Laya.timer.loop(260,this,this.m_stloop),Laya.stage.event("show"),Laya.timer.frameLoop(1,this,this.m_isscale),this.m_isscale()},f.prototype.m_isscale=function(){this.img_scale.scaleX<=.9?this.m_isbi=1:1<=this.img_scale.scaleX&&(this.m_isbi=-1),this.img_scale.scaleX+=.004*this.m_isbi,this.img_scale.scaleY+=.004*this.m_isbi},f.prototype.m_stloop=function(){450<=90+this.m_agle&&(Laya.timer.clear(this,this.m_stloop),console.log("clear all")),this.huan_por.graphics.drawPie(200,200,310,70,90+this.m_agle,"#ff0000","#ff0000"),this.m_agle+=10},f.prototype.m_videro=function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),r.GameSetting.ismingame&&!s.GameS1.instance.m_iadvrot&&(this.isDown||(this.isDown=1,Laya.timer.clear(this,this.timeLoop),c.wxInterface.I.createVideo(function(e){1==e?(s.GameS1.instance.m_conit(),this.closeView(!1)):(Laya.stage.event("Tip",[{title:"广告调取失败"}]),Laya.timer.loop(1e3,this,this.timeLoop),this.isDown=0)}.bind(this))))},f.prototype.disable=function(){this.btn_reborn.off(Laya.Event.MOUSE_DOWN,this,this.m_rebornd),this.btn_close.off(Laya.Event.MOUSE_DOWN,this,this.closeView),this.btn_video.off(Laya.Event.MOUSE_DOWN,this,this.m_videro),Laya.timer.clearAll(this),this.huan_por.graphics.clear(),this.m_agle=0},f.prototype.m_rebornd=function(){if(i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),!this.isDown){this.isDown=1;var t=this;r.GameSetting.ismingame?l.dataCenter.I.get("diamond",function(e){e&&(playerCenter.Dionum=e,playerCenter.Dionum.chest>=parseInt(t.ft_num)?(playerCenter.Dionum.chest-=parseInt(t.ft_num),r.GameSetting.ismingame&&l.dataCenter.I.send("diamond",JSON.stringify(playerCenter.Dionum)),s.GameS1.instance.m_conit(),t.closeView(!1)):Laya.stage.event("Tip",[{title:"您的余额不足",cb:t.closeView.bind(t)}]))}):playerCenter.Dionum.chest>=parseInt(t.ft_num)?(playerCenter.Dionum.chest-=parseInt(t.ft_num),s.GameS1.instance.m_conit(),t.closeView(!1)):Laya.stage.event("Tip",[{title:"您的余额不足",cb:t.closeView.bind(t)}])}},f.prototype.closeView=function(e){void 0===e&&(e=!0),i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),e&&(u.default.instance.canUseEasingPolicy?o.GameCtrl.getInstance().runLogic(14):0<s.GameS1.instance.m_bxnum?o.GameCtrl.getInstance().runLogic(11):o.GameCtrl.getInstance().runLogic(6)),this.removeSelf(),this.close(),this.disable(),Laya.stage.event("hind")},f);function f(){var e=_.call(this)||this;return e.time=10,e.isDown=0,e.m_agle=0,e.size(Laya.stage.width,Laya.stage.height),e.text_time.text=e.time.toString(),e}t.GameOver=p}),define("game/utils/Global",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.curSkin="1.png",n);function n(){}t.Global=i}),define("game/View/BallSkinItem",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=ui.main.BallSkinItemUI,__extends(a,i),Object.defineProperty(a.prototype,"dataSource",{get:function(){return this.m_ballskin},set:function(e){e&&(this.img_lock.alpha=1,this.m_ballskin=e,this.img_skin.skin=this.m_ballskin.skin1,this.m_ballskin.had?this.img_lock.visible=!1:this.img_lock.visible=!0,this.choise.visible=this.m_ballskin.isSelect,this.m_ballskin.isSelect?this.img_bg.skin="comp/img_select.png":this.img_bg.skin="comp/img_noSelect.png")},enumerable:!0,configurable:!0}),a.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},a.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},a);function a(){return i.call(this)||this}t.BallSkinItem=n}),define("game/View/GameSkinWin",["require","exports","utils/GameSetting","game/scene/GameScene","game/utils/Global","game/View/BallSkinItem","wx/dataCenter","game/scene/GameSystem","game/utils/SoundUtils"],function(e,t,i,n,a,r,s,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c,u=(c=ui.main.GameSkinWinUI,__extends(d,c),d.prototype.createChildren=function(){c.prototype.createChildren.call(this),this.list.itemRender=r.BallSkinItem,this.list.vScrollBarSkin="",this.list.scrollBar.elasticBackTime=500,this.list.scrollBar.elasticDistance=200,this.size(Laya.stage.width,Laya.stage.height),this._tab.getChildAt(0)._labelColors[1]="#ffffff",this._tab.getChildAt(1)._labelColors[1]="#ffffff"},d.prototype.onOpened=function(){c.prototype.onOpened.call(this),this.m_playscene(),this.enable()},d.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},d.prototype.m_playscene=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.m_skscen||(this.m_skscen=new n.GameS1(!0)),this.addChild(this.m_skscen),this.m_skscen.m_swshopsk(),n.GameS1.instance.removeSelf(),[2]})})},d.prototype.closeView=function(){this.close(),this.disable(),Laya.stage.addChildAt(n.GameS1.instance,0),this.m_skscen.removeSelf(),this.m_skscen.m_stop(),this.m_skscen=null},d.prototype.m_onltcghandler=function(){this.m_slitm=this.list.array[this.list.selectedIndex],this.m_odim&&(this.m_odim.isSelect=!1),this.m_odim=this.m_slitm,this.m_skscen.m_cgskin(this.m_slitm),n.GameS1.instance.m_cgskin(this.m_slitm),this.m_odim.isSelect=!0,this.list.refresh(),this.m_slitm.had?(this.btn_buy.visible=!1,this.btn_sure.visible=!0):(this.font_price.value=this.m_slitm.price+"",this.btn_buy.visible=!0,this.btn_sure.visible=!1)},d.prototype.enable=function(){this.m_nowskin=n.GameS1.instance.m_gtball(),this.m_skscen.m_cgskin(this.m_nowskin),n.GameS1.instance.m_cgskin(this.m_nowskin);var t=this;0==this.m_tbinx?this.list.array=playerCenter.skinHad.slice(0,o.GameSystem.normalskinnum+1):this.list.array=playerCenter.skinHad.slice(o.GameSystem.normalskinnum+1,playerCenter.skinHad.length),this.list.selectEnable=!0,this.list.selectHandler=Laya.Handler.create(this,this.m_onltcghandler,null,!1),this._tab.selectHandler=Laya.Handler.create(this,this.m_onlttabcg,null,!1),i.GameSetting.ismingame?s.dataCenter.I.get("diamond",function(e){e&&(playerCenter.Dionum=e,t.txt_score.text=playerCenter.Dionum.chest.toString())}):(this.txt_score.text=playerCenter.Dionum.chest.toString(),this.btn_back.on(Laya.Event.MOUSE_UP,this,this.m_quit),this.btn_sure.on(Laya.Event.CLICK,this,this.m_stskin),this.btn_buy.on(Laya.Event.MOUSE_DOWN,this,this.m_shopsk))},d.prototype.m_quit=function(){this.m_skscen.m_cgskin(this.m_nowskin),n.GameS1.instance.m_cgskin(this.m_nowskin),this.closeView()},d.prototype.disable=function(){Laya.stage.event("showClub"),this.btn_sure.off(Laya.Event.CLICK,this,this.m_stskin),this.btn_back.off(Laya.Event.MOUSE_UP,this,this.m_quit),this.btn_buy.off(Laya.Event.MOUSE_DOWN,this,this.m_shopsk),this.list.selectHandler.recover(),this.list.selectHandler=null,this._tab.selectHandler.recover(),this._tab.selectHandler=null,this._tab.selectedIndex=0,this.list.array=null,this.m_tbinx=0},d.prototype.m_shopsk=function(){l.SoundUtils.instance.playSound(o.GameSystem.MUSIC_DIANJI);var t=this;i.GameSetting.ismingame?s.dataCenter.I.get("diamond",function(e){e&&(playerCenter.Dionum=e,playerCenter.Dionum.chest>=t.m_slitm.price?(playerCenter.Dionum.chest-=t.m_slitm.price,playerCenter.skinArr[t.m_slitm.num]=1,s.dataCenter.I.send("diamond",JSON.stringify(playerCenter.Dionum),function(){s.dataCenter.I.send("skinArr",JSON.stringify(playerCenter.skinArr))}),t.m_slitm.had=1,t.list.refresh(),t.btn_buy.visible=!1,t.btn_sure.visible=!0,t.txt_score.text=playerCenter.Dionum.toString(),Laya.stage.event("Tip",[{title:"购买成功"}])):Laya.stage.event("Tip",[{title:"您的余额不足"}]))}):playerCenter.Dionum>=this.m_slitm.price?(playerCenter.Dionum-=this.m_slitm.price,this.m_slitm.had=1,this.list.refresh(),this.btn_buy.visible=!1,this.btn_sure.visible=!0,this.txt_score.text=playerCenter.Dionum.toString(),Laya.stage.event("Tip",[{title:"购买成功"}])):Laya.stage.event("Tip",[{title:"您的余额不足"}])},d.prototype.m_stskin=function(){l.SoundUtils.instance.playSound(o.GameSystem.MUSIC_DIANJI),this.m_slitm&&this.m_slitm.skin&&(a.Global.curSkin=this.m_slitm.skin),this.closeView()},d.prototype.m_onlttabcg=function(){this.m_tbinx=this._tab.selectedIndex,0==this.m_tbinx?this.list.array=playerCenter.skinHad.slice(0,o.GameSystem.normalskinnum+1):this.list.array=playerCenter.skinHad.slice(o.GameSystem.normalskinnum+1,playerCenter.skinHad.length)},d);function d(){var e=null!==c&&c.apply(this,arguments)||this;return e.m_tbinx=0,e}t.GameSkinWin=u}),define("game/View/GameSmallRank",["require","exports","game/scene/GameSystem","com/help/GameConfig","newfunction/gamecore/util/RunData","wx/dataCenter","utils/GameSetting","game/Ctrl/GameCtrl","game/scene/GameScene","game/model/GameModel","wx/wxInterface","game/utils/SoundUtils"],function(e,t,a,r,i,n,s,o,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _,p=(_=ui.main.endRankUI,__extends(f,_),f.prototype.onOpened=function(){var t=this;s.GameSetting.ismingame&&(this._texture=new Laya.Texture(Laya.Browser.window.sharedCanvas),this._texture.bitmap.alwaysChange=!0,Laya.timer.once(1e3,this,function(e){e.bitmap.alwaysChange=!1},[this._texture]),this._listsp.graphics.drawTexture(this._texture,0,0,this._texture.width,this._texture.height),this.addChild(this._listsp)),Laya.stage.event("close_txt",!1),n.dataCenter.I.get(SAVEKEY.SCORE,function(e){t.text_score.text=e+""}),this.enable(),this.m_setoverda(),Laya.stage.event("show")},f.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},f.prototype.m_upitem=function(e,t){var i=e.getChildByName("over_icon"),n=e.getChildByName("over_name"),a=e.getChildByName("over_count");i.skin=this.over_data[t].icon,n.text=this.over_data[t].name,a.text=r.GameConfig.limitInteger(1e4,1e5)+"人玩过"},f.prototype.m_setoverda=function(){var t=this;console.log("调用次数"),i.RunData.getOverData(function(e){t.over_data=e,t.list.array=t.over_data,t.list.renderHandler=new Laya.Handler(t,t.m_upitem),t.m_stonclk()})},f.prototype.m_stonclk=function(){for(var t=this,e=function(e){i.list.cells[e].on(Laya.Event.CLICK,i,function(){d.SoundUtils.instance.playSound(a.GameSystem.MUSIC_DIANJI),u.wxInterface.I.goOtherGame(t.over_data[e].appID,function(){Laya.stage.event("Tip",[{title:"小游戏打开失败"}])})})},i=this,n=0;n<this.list.cells.length;n++)e(n)},f.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},f.prototype.enable=function(){this.btn_again.on(Laya.Event.MOUSE_DOWN,this,this.m_gegain),this.btn_rank.on(Laya.Event.MOUSE_DOWN,this,this.m_rankfried),this.btn_xy.on(Laya.Event.MOUSE_DOWN,this,this.fx),this.btn_home.on(Laya.Event.MOUSE_DOWN,this,this.m_gohome),Laya.timer.frameLoop(1,this,this.m_iscale)},f.prototype.m_gohome=function(){d.SoundUtils.instance.playSound(a.GameSystem.MUSIC_DIANJI),c.GameModel.isntance.count=0,o.GameCtrl.getInstance().runLogic(0),this.m_spgyrosc(),this.closeView()},f.prototype.m_spgyrosc=function(){var e=this;"undefined"!=typeof wx&&wx.stopGyroscope({success:function(){console.log("重力监听关闭成功")},fail:function(){e.m_spgyrosc()}})},f.prototype.disable=function(){this.btn_again.off(Laya.Event.MOUSE_DOWN,this,this.m_gegain),this.btn_rank.off(Laya.Event.MOUSE_DOWN,this,this.m_rankfried),this.btn_xy.off(Laya.Event.MOUSE_DOWN,this,this.fx),this.btn_home.off(Laya.Event.MOUSE_DOWN,this,this.m_gohome),Laya.timer.clear(this,this.m_iscale)},f.prototype.closeView=function(){s.GameSetting.ismingame&&(this._listsp.graphics.clear(),this._texture.destroy()),this.close(),this.disable(),u.wxInterface.I.postMessage({type:"close_sr"}),Laya.stage.event("hind"),this.m_setoffks()},f.prototype.m_setoffks=function(){for(var e=0;e<this.list.cells.length;e++)this.list.cells[e].offAll()},f.prototype.m_iscale=function(){this.btn_xy.scaleX<=.9?this.big=1:1<=this.btn_xy.scaleX&&(this.big=-1),this.btn_xy.scaleX+=.003*this.big,this.btn_xy.scaleY+=.003*this.big},f.prototype.m_gegain=function(){d.SoundUtils.instance.playSound(a.GameSystem.MUSIC_DIANJI),c.GameModel.isntance.count=0,l.GameS1.instance.m_ready(),o.GameCtrl.getInstance().runLogic(7),this.closeView()},f.prototype.m_rankfried=function(){d.SoundUtils.instance.playSound(a.GameSystem.MUSIC_DIANJI),s.GameSetting.ismingame&&(this._texture.bitmap.alwaysChange=!1),s.GameSetting.ismingame&&(u.wxInterface.I.initWxFun(),u.wxInterface.I.postMessage({type:"rank"})),o.GameCtrl.getInstance().runLogic(3)},f.prototype.fx=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return d.SoundUtils.instance.playSound(a.GameSystem.MUSIC_DIANJI),u.wxInterface.I.share("battle",c.GameModel.isntance.count),[2]})})},f);function f(){var e=_.call(this)||this;return e.over_data=null,s.GameSetting.ismingame&&(e._listsp=new Laya.Sprite,e._listsp.size(615,543),e._listsp.pos(70,257)),e}t.GameSmallRank=p}),define("game/View/GetSkinWin",["require","exports","utils/GameSetting","game/scene/GameScene","game/Ctrl/GameCtrl","game/model/GameModel","wx/dataCenter","wx/wxInterface","sheets/vo/PConfig"],function(e,t,n,i,a,r,s,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h,c=(h=ui.main.GetSkinWinUI,__extends(u,h),u.prototype.createChildren=function(){h.prototype.createChildren.call(this)},u.prototype.video=function(){if(!this.isDown){this.isDown=1;var i=this;n.GameSetting.ismingame?o.wxInterface.I.createVideo(function(e,t){1==e?(playerCenter.Dionum.sapphire+=i.value,i.closeView()):-1==e&&Laya.stage.event("Tip",[{title:"广告拉取失败"}]),i.isDown=0}):(playerCenter.Dionum.sapphire+=this.value,this.closeView())}},u.prototype.onOpened=function(){this.isDown=0,playerCenter.Dionum.chest+=i.GameS1.instance.m_bxnum,this.value=Math.round(Math.random()*this.minBlue)+(this.maxBlue-this.minBlue),this.text_num.text="X"+this.value.toString(),h.prototype.onOpened.call(this),this.enable()},u.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},u.prototype.closeView=function(){var e=this;Laya.stage.event("updata_dia"),s.dataCenter.I.send("diamond",JSON.stringify(playerCenter.Dionum),function(){e.close(),e.disable(),r.GameModel.isntance.count=0})},u.prototype.onClosed=function(){a.GameCtrl.getInstance().runLogic(6)},u.prototype.enable=function(){this.btn_cancel.on(Laya.Event.MOUSE_UP,this,this.closeView),this.btn_video.on(Laya.Event.MOUSE_UP,this,this.video)},u.prototype.disable=function(){this.btn_cancel.off(Laya.Event.MOUSE_UP,this,this.closeView),this.btn_video.off(Laya.Event.MOUSE_UP,this,this.video)},u);function u(){var e=h.call(this)||this;return e.minBlue=0,e.maxBlue=0,e.getSkin=0,e.isDown=0,e.value=0,e.minBlue=~~l.PConfig.get(1018).value,e.maxBlue=~~l.PConfig.get(1017).value,e}t.GetSkinWin=c}),define("game/View/Loading",["require","exports","com/help/GameConfig","game/scene/GameSystem","utils/GameSetting","com/utils/Delay","game/scene/GameScene","game/Ctrl/GameCtrl","wx/dataCenter","GameMain","game/utils/SoundUtils","newfunction/gamecore/deer/DeerSDK"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _,p=(_=ui.main.LoadingUI,__extends(f,_),f.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},f.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},f.prototype.enable=function(){s.GameSetting.ismingame||this.startload(),this.isOpen=1,this.btn_restart.on(Laya.Event.MOUSE_DOWN,this,this.reStart),Laya.stage.on("readyGame",this,this.readlyStartGame);var e=new Laya.Skeleton;e.load(n.GameSystem.SPINE_LOGO),i.GameConfig.LoGo=e,i.GameConfig.LoGo.y=300,i.GameConfig.LoGo.x=(this.width-i.GameConfig.LoGo.width)/2,this.addChild(i.GameConfig.LoGo);var t=new Laya.Skeleton;t.load(n.GameSystem.SPINE_CHOUQ,new Laya.Handler(this,function(){t.play("idle",!1)})),i.GameConfig.chouqiu=t},f.prototype.startload=function(){var t=this;this.img_tip.visible=!0,this.pro_bg.visible=!0,this.bar.visible=!0,this.proTxt.visible=!0,this.btn_restart.visible=!0,this.load_text.visible=!0,this.box_select.visible=!1,d.default.instance.isOnline?(this.s3_label.visible=!1,this.s3_loding.visible=!0):(this.s3_loding.visible=!1,this.s3_label.visible=!0);var i=this.totalW=this.bar.width;this.bar.scrollRect=new Laya.Rectangle(0,0,20,300),Laya.Tween.to(this.bar.scrollRect,{width:i},1e3*this.time,null,Laya.Handler.create(this,this.startGame)).update=Laya.Handler.create(this,function(){var e=t.bar.scrollRect.width/i;e<=.98&&(t.proTxt.text=(100*e).toFixed(0)+"%",console.log("=====**********============"+(100*e).toFixed(0)+"%"))},null,!1)},f.prototype.reStart=function(){u.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),s.GameSetting.ismingame?Laya.Browser.window.wx.exitMiniProgram():Laya.Browser.window.location.reload()},f.prototype.setPro=function(){Laya.Tween.clearAll(this.bar.scrollRect),this.bar.scrollRect=this.bar.scrollRect=new Laya.Rectangle(0,0,this.totalW,300),this.proTxt.text="99%",this.pro_bg.visible=!1,this.bar.visible=!1,this.proTxt.visible=!1},f.prototype.startGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return console.log("开始游戏"),this.readlyStartGame(),[2]})})},f.prototype.readlyStartGame=function(){c.GameMain.isReady?(s.GameSetting.ismingame,console.log("开始游戏1"),this.start(),Laya.timer.clear(this,this.readlyStartGame)):Laya.timer.frameLoop(1,this,this.readlyStartGame)},f.prototype.start=function(){console.log("开始游戏2"),this.disable(),d.default.instance.isOnline&&Laya.stage.addChild(r.GameS1.instance),o.GameCtrl.getInstance().runLogic(0)},f.prototype.fromFX=function(r){1044!=r.scene&&1008!=r.scene||Laya.Browser.window.wx.postMessage({type:"shareTicket",data:r.shareTicket}),r.query&&"{}"!=JSON.stringify(r.query)?l.dataCenter.I.get("isShare",function(e){if(!e.code&&e.data){var t;for(var i in r.query)if(i!=playerCenter.openId)if(e.data.isShare){var n=new Date(e.data.isShare),a=d.default.instance.serverTime;n.getDay()==a.getDay()&&n.getMonth()==a.getMonth()||(l.dataCenter.I.sendOther(r.query[i]),t=1)}else l.dataCenter.I.sendOther(r.query[i]),t=1;t||this.isOpen&&this.readlyStartGame()}}.bind(this)):this.isOpen&&this.readlyStartGame()},f.prototype.disable=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.isOpen=0,this.btn_restart.off(Laya.Event.MOUSE_DOWN,this,this.reStart),Laya.stage.off("readyGame",this,this.readlyStartGame),Laya.Tween.clearAll(this.bar.scrollRect),this.bar.scrollRect=this.bar.scrollRect=new Laya.Rectangle(0,0,this.totalW,300),this.proTxt.text="100%",[4,a.Delay.delay(300)];case 1:return e.sent(),this.removeSelf(),[2]}})})},f);function f(){var t=_.call(this)||this;t.isOpen=0,t.time=3;var e=Math.max(Laya.stage.width/t.bg.width,Laya.stage.height/t.bg.height),i=t.bg.width*e,n=t.bg.height*e;if(t.bg.size(i,n),t.bg.x=.5*(Laya.stage.width-i),t.bg.y=Laya.stage.height-n,t.size(Laya.stage.width,Laya.stage.height),s.GameSetting.ismingame){t.pro_bg.visible=!1,t.bar.visible=!1,t.proTxt.visible=!1,t.img_tip.visible=!1,t.btn_restart.visible=!1,t.load_text.visible=!1,t.s3_label.visible=!1;var a=Laya.Browser.clientWidth/Laya.stage.width,r=Laya.Browser.clientHeight/Laya.stage.height;n=Laya.Browser.clientHeight;t.box_select.y=n/r-350-54-t.box_select.height/2,l.dataCenter.I.init(),t.btn=Laya.Browser.window.wx.createUserInfoButton({type:"img",image:"tex/startgame.png",style:{left:.5*(Laya.Browser.clientWidth-249*a),top:n-350*r,width:249*a,height:69*r}}),t.btn.onTap(function(e){e&&e.userInfo&&(playerCenter.userInfo=e.userInfo,t.btn.hide(),t.btn.offTap(),t.btn.destroy(),t.btn=null,t.box_select.visible=!1,t.startload())}),Laya.stage.on("GameStart",t,t.startGame)}else t.startload();return t}t.Loading=p}),define("game/View/Doubling",["require","exports","game/utils/SoundUtils","game/scene/GameSystem","utils/GameSetting","game/scene/GameScene","wx/dataCenter","wx/wxInterface","game/Ctrl/GameCtrl"],function(e,t,i,n,a,r,s,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c,u=(c=ui.main.diamond_fbUI,__extends(d,c),d.prototype.enable=function(){this.isDown=0,this.text_dia.text=r.GameS1.instance.m_bxnum.toString(),this.btn_fb.on(Laya.Event.MOUSE_DOWN,this,this.m_douaward),this.btn_get.on(Laya.Event.MOUSE_DOWN,this,this.m_getdia),Laya.stage.event("show")},d.prototype.m_douaward=function(){if(i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),a.GameSetting.ismingame){if(this.isDown)return;this.isDown=1,o.wxInterface.I.createVideo(function(e){1==e?this.sendDiam(2*r.GameS1.instance.m_bxnum):Laya.stage.event("Tip",[{title:"广告调取失败"}]),this.isDown=0}.bind(this))}else this.m_savediam(2*r.GameS1.instance.m_bxnum)},d.prototype.m_getdia=function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),this.isDown||(this.isDown=1,this.m_savediam(r.GameS1.instance.m_bxnum))},d.prototype.disable=function(){this.isDown=0,this.btn_fb.off(Laya.Event.MOUSE_DOWN,this,this.m_douaward),this.btn_get.off(Laya.Event.MOUSE_DOWN,this,this.m_getdia)},d.prototype.onOpened=function(){this.enable(),c.prototype.onOpened.call(this)},d.prototype.m_savediam=function(e){playerCenter.Dionum.chest+=e,Laya.stage.event("updata_dia");var t=this;a.GameSetting.ismingame?s.dataCenter.I.send("diamond",JSON.stringify(playerCenter.Dionum),function(){t.disable(),t.closeView()}):(this.disable(),this.closeView())},d.prototype.closeView=function(){l.GameCtrl.getInstance().runLogic(6),this.close()},d.prototype.close=function(e){void 0===e&&(e=null),"side"!=e&&(c.prototype.close.call(this),Laya.stage.event("hind"))},d.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},d);function d(){var e=c.call(this)||this;return e.isDown=0,e}t.Doubling=u}),define("game/Ctrl/GameCtrl",["require","exports","newfunction/GameS3","newfunction/GameS2","newfunction/ChouQiu","newfunction/Setting","newfunction/Welfare","game/View/FriendRankPanel","game/View/GameGuide","game/View/GameOver","game/View/GameSkinWin","game/View/GameSmallRank","game/View/GameStartView","game/View/GetSkinWin","game/View/InviteWin","game/View/Loading","game/View/SignWin","game/View/Doubling"],function(e,t,i,n,a,r,s,o,l,c,u,d,_,p,f,m,g,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=(C.getInstance=function(){return C._instance||(C._instance=new C,Laya.stage.addChild(C._instance.sp=new Laya.Sprite)),C._instance},C.prototype.runLogic=function(e){switch(e){case 0:this.openView(_.GameStartView,1);break;case 4:this.openView(null,2);break;case 5:this.openView(c.GameOver,3);break;case 1:this.openView(u.GameSkinWin,4);break;case 2:this.openView(f.InviteWin,5);break;case 3:this.openView(o.FriendRankPanel,6);break;case 6:this.openView(d.GameSmallRank,7);break;case 7:this.openView(l.GameGuide,8);break;case 8:this.openView(p.GetSkinWin,9);break;case 9:this.openView(m.Loading,10);break;case 10:this.openView(g.SignWin,11);break;case 11:this.openView(v.Doubling,12);break;case 12:this.openView(s.Welfare,13);break;case 13:this.openView(r.Setting,14);break;case 14:this.openView(a.ChouQiu,15);break;case 15:this.openView(n.GameS2,16);case 16:this.openView(i.GameS3,17);break;default:new Error("not such this game type:"+e)}},C.prototype.getView=function(e){if(this._view[e])return this._view[e]},C.prototype.openView=function(e,t){var i=this._view[t];(i=i||(this._view[t]=new e))instanceof u.GameSkinWin||i instanceof f.InviteWin||i instanceof o.FriendRankPanel||i instanceof d.GameSmallRank||i instanceof p.GetSkinWin||i instanceof g.SignWin||i instanceof v.Doubling||i instanceof s.Welfare||i instanceof r.Setting||i instanceof c.GameOver||i instanceof a.ChouQiu?i.popup():(this._openView&&(this._openView.disable(),this.sp.removeChild(this._openView),this._openView=null),(this._openView=i).enable(),this.sp.addChild(i),this.sp.parent&&this.sp.parent.setChildIndex(this.sp,this.sp.parent.numChildren-2))},C.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},C.prototype.closeView=function(e){var t=this._view[e];t&&t.disable()},C.prototype.getClassName=function(e){return e.toString().match(/function (\w*)/)[1]},C);function C(){this._view={}}t.GameCtrl=y}),define("newfunction/GameS3",["require","exports","sheets/vo/BallSkin","com/help/GameConfig","game/Ctrl/GameCtrl","game/scene/GameSystem","game/utils/SoundUtils"],function(e,t,a,s,i,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,l=(o=ui.main.GameS3UI,__extends(h,o),h.prototype.enable=function(){this.to_home.on(Laya.Event.CLICK,this,this.goHome),this.initGame(),this.left.on(Laya.Event.CLICK,this,this.leftjump),this.right.on(Laya.Event.CLICK,this,this.rightjump)},h.prototype.initGame=function(){console.log("index",this._zOrder),this.scene=Laya.stage.addChild(new Laya.Scene);var e=this.scene.addChild(new Laya.Camera(0,.1,100));e.transform.translate(new Laya.Vector3(0,.5,5)),e.transform.rotate(new Laya.Vector3(-15,0,0),!0,!1),e.clearFlag=Laya.BaseCamera.CLEARFLAG_SKY;var t=this.scene.addChild(new Laya.DirectionLight);t.direction=new Laya.Vector3(0,-.8,-1),t.color=new Laya.Vector3(1,1,1),this.earth2=this.scene.addChild(new Laya.MeshSprite3D(new Laya.SphereMesh(this.radius))),this.earth1=this.earth2.clone(),this.scene.addChild(this.earth1);var i=new Laya.StandardMaterial;i.diffuseTexture=Laya.Texture2D.load("tex/A1.png"),this.earth2.meshRender.sharedMaterial=i;var n=new Laya.StandardMaterial;n.diffuseTexture=Laya.Texture2D.load("tex/A4.png"),this.earth1.meshRender.sharedMaterial=n,this.mininitY=this.maxinitY-this.radius*(1-this.minscale),this.jumphight=this.radius*this.minscale+this.radius*this.maxscale+.4,console.log("数据",this.mininitY,this.jumphight),this.settingScale(1),this.startGame(),console.log("皮肤数据",h.nowskin)},h.prototype.startGame=function(){this.score=-1,this.leftloca=0,this.isover=!1,this.isclick=!1,this.isjump=!1,this.moveLeft()},h.prototype.settingScale=function(e){if(1==e){this.earth1.transform.scale=new Laya.Vector3(this.maxscale,this.maxscale,this.maxscale),this.earth2.transform.scale=new Laya.Vector3(this.minscale,this.minscale,this.minscale),this.earth1.transform.position=new Laya.Vector3(-this.initX,this.maxinitY,this.initZ),this.earth2.transform.position=new Laya.Vector3(this.initX,this.mininitY,this.initZ),(n=this.earth1.meshRender.sharedMaterial).diffuseTexture=Laya.Texture2D.load(h.nowskin),this.earth1.meshRender.sharedMaterial=n;var t=this.earth2.meshRender.sharedMaterial,i=a.BallSkin.getAllSkin()[s.GameConfig.limitInteger(0,a.BallSkin.getAllSkin().length-1)];console.log("随机皮肤",i.skin),t.diffuseTexture=Laya.Texture2D.load(i.skin),this.earth2.meshRender.sharedMaterial=t}else{var n;this.earth2.transform.scale=new Laya.Vector3(this.maxscale,this.maxscale,this.maxscale),this.earth1.transform.scale=new Laya.Vector3(this.minscale,this.minscale,this.minscale),this.earth2.transform.position=new Laya.Vector3(-this.initX,this.maxinitY,this.initZ),this.earth1.transform.position=new Laya.Vector3(this.initX,this.mininitY,this.initZ),(n=this.earth2.meshRender.sharedMaterial).diffuseTexture=Laya.Texture2D.load(h.nowskin),this.earth2.meshRender.sharedMaterial=n,t=this.earth1.meshRender.sharedMaterial,i=a.BallSkin.getAllSkin()[s.GameConfig.limitInteger(0,a.BallSkin.getAllSkin().length-1)],t.diffuseTexture=Laya.Texture2D.load(i.skin),console.log("随机皮肤",i.skin),this.earth1.meshRender.sharedMaterial=t}this.isover||(this.score++,this.mscore.text="分数:"+this.score)},h.prototype.moveLeft=function(){var t=this,i=2,n=-2,a=!1,r=!1;Laya.timer.frameLoop(1,this,function(){if(i<=-2){if(!r)return;a=!(r=!1);var e=s.GameConfig.limitInteger(1,2);t.settingScale(e)}else 2<=i&&(r||(e=s.GameConfig.limitInteger(1,2),t.settingScale(e)),a=!(r=!0),t.isclick=!1);a?(i+=.021,n-=.021,t.earth2.transform.rotate(new Laya.Vector3(0,0,-.04)),t.earth1.transform.rotate(new Laya.Vector3(0,0,.04)),t.leftloca=1):(i-=.021,n+=.021,t.earth2.transform.rotate(new Laya.Vector3(0,0,.04)),t.earth1.transform.rotate(new Laya.Vector3(0,0,-.04)),t.leftloca=0),t.earth2.transform.localPosition.x=i,t.earth1.transform.localPosition.x=n,t.isOver(),t.isclick&&t.settjump()})},h.prototype.isOver=function(){var e=this,t=this.earth1.transform.localPosition.x,i=this.earth1.transform.localPosition.y,n=this.earth2.transform.localPosition.x,a=this.earth2.transform.localPosition.y,r=Math.pow(t-n,2),s=Math.pow(i-a,2);Math.sqrt(r+s)<=this.radius*this.minscale+this.radius&&(this.isover=!0,Laya.timer.clearAll(this),this.settingScale(1),Laya.stage.event("Tip",[{title:"死亡!是否重新开始",cb:function(){e.startGame()}}]))},h.prototype.leftjump=function(){this.isclick||(0==this.leftloca?(this.nowstartY=this.earth1.transform.localPosition.y,this.nowearth=this.earth1):(this.nowstartY=this.earth2.transform.localPosition.y,this.nowearth=this.earth2),this.isclick=!0)},h.prototype.rightjump=function(){this.isclick||(0==this.leftloca?(this.nowstartY=this.earth2.transform.localPosition.y,this.nowearth=this.earth2):(this.nowstartY=this.earth1.transform.localPosition.y,this.nowearth=this.earth1),this.isclick=!0)},h.prototype.settjump=function(){this.isjump?(this.nowearth.transform.localPosition.y-=.055,this.nowearth.transform.localPosition.y<=this.nowstartY&&(this.isclick=!1,this.isjump=!1)):(this.nowearth.transform.localPosition.y+=.055,this.nowearth.transform.localPosition.y-this.nowstartY>=this.jumphight&&(this.isjump=!0))},h.prototype.disable=function(){this.to_home.off(Laya.Event.CLICK,this,this.goHome),Laya.stage.removeChild(this.scene),Laya.timer.clearAll(this),this.left.off(Laya.Event.CLICK,this,this.leftjump),this.right.off(Laya.Event.CLICK,this,this.rightjump)},h.prototype.goHome=function(){r.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),i.GameCtrl.getInstance().runLogic(0)},h.nowskin=null,h);function h(){var e=o.call(this)||this;return e.earth2=null,e.earth1=null,e.scene=null,e.initX=2,e.maxinitY=-1.5,e.mininitY=0,e.initZ=0,e.minscale=.5,e.maxscale=1,e.radius=.3,e.jumphight=-1,e.leftloca=0,e.score=-1,e.isover=!1,e.isjump=!1,e.nowstartY=0,e.nowearth=null,e.isclick=!1,e}t.GameS3=l}),define("newfunction/BaoGame",["require","exports","game/utils/SoundUtils","game/scene/GameSystem","wx/wxInterface","com/help/GameConfig","newfunction/gamecore/util/RunData"],function(e,t,o,l,h,c,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=ui.main.baogameUI,__extends(r,n),r.prototype.init=function(){var e=(Laya.stage.height-this.bao_bg.height)/2+50,t=-this.bao_bg.width;this.x=t,this.y=e,this.bao_cotr.on(Laya.Event.CLICK,this,this.control),this.settingData()},r.prototype.settingData=function(){var t=this;i.RunData.getBaoGameData(function(e){t.bao_data=e,t.bao_list.array=t.bao_data,t.bao_list.renderHandler=new Laya.Handler(t,t.updateItem),t.showappid(e)})},r.prototype.showappid=function(e){for(var t="",i=0;i<e.length;i++)0==i?t='["'+e[i].appID+'",':i==e.length-1?t+='"'+e[i].appID+'"]':t+='"'+e[i].appID+'",';console.log("=============appid========================",t)},r.prototype.updateItem=function(r,s){return __awaiter(this,void 0,void 0,function(){var t,i,n,a=this;return __generator(this,function(e){return console.log("列表渲染",s,r),t=r.getChildByName("bao_name"),i=r.getChildByName("bao_count"),n=r.getChildByName("bao_icon"),t.text=this.bao_data[s].name,i.text=c.GameConfig.limitInteger(1e4,1e5)+"人玩过",n.skin=this.bao_data[s].icon,r.on(Laya.Event.CLICK,this,function(){o.SoundUtils.instance.playSound(l.GameSystem.MUSIC_DIANJI),h.wxInterface.I.goOtherGame(a.bao_data[s].appID,function(e){Laya.stage.event("Tip",[{title:"小游戏打开失败"}])})}),[2]})})},r.prototype.control=function(){var e=this;o.SoundUtils.instance.playSound(l.GameSystem.MUSIC_DIANJI),this.viewstate?(this.removeChild(this.back_bg),this.back_bg.off(Laya.Event.CLICK,this,this.control),Laya.Tween.clearAll(this),Laya.Tween.to(this,{x:-this.bao_bg.width,y:this.y},100,null),this.viewstate=!1,this.left_right.rotation=0,Laya.stage.event("hind")):(this.back_bg||(this.back_bg=new Laya.Image,this.back_bg.loadImage("comp/gametwo_bg.png",0,-this.y,Laya.stage.width,Laya.stage.height),this.back_bg.alpha=.8),Laya.Tween.clearAll(this),Laya.Tween.to(this,{x:0,y:this.y},100,null,new Laya.Handler(this,function(){e.addChildAt(e.back_bg,0)})),this.viewstate=!0,this.left_right.rotation=180,this.back_bg.on(Laya.Event.CLICK,this,this.control),Laya.stage.event("show"))},r);function r(){var e=n.call(this)||this;return e.bao_data=null,e.viewstate=!1,e.back_bg=null,e.init(),e}t.BaoGame=a}),define("newfunction/LoveGame",["require","exports","game/utils/SoundUtils","game/scene/GameSystem","wx/wxInterface","newfunction/gamecore/util/RunData"],function(e,t,a,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=(n=ui.main.lovegameUI,__extends(l,n),l.prototype.init=function(){this.y=Laya.stage.height-(this.height+10),this.m_list.hScrollBarSkin="",this.m_list.scrollBar.elasticBackTime=200,this.m_list.scrollBar.elasticDistance=50,this.settingData()},l.prototype.settingData=function(){var t=this;i.RunData.getLoveGameData(function(e){t.love_data=e,t.m_list.array=t.love_data,t.m_list.renderHandler=new Laya.Handler(t,t.updateItem),t.setOnCliCks(),t.startPlay()})},l.prototype.setOnCliCks=function(){for(var t=this,e=function(e){i.m_list.cells[e].on(Laya.Event.CLICK,i,function(){a.SoundUtils.instance.playSound(r.GameSystem.MUSIC_DIANJI),s.wxInterface.I.goOtherGame(t.love_data[e].appID,function(){Laya.stage.event("Tip",[{title:"小游戏打开失败"}])})})},i=this,n=0;n<this.m_list.cells.length;n++)e(n)},l.prototype.updateItem=function(e,t){e.getChildByName("love_icon").skin=this.love_data[t].icon},l.prototype.startPlay=function(){var t=this,i=this.m_list.startIndex,n=this.love_data.length-this.m_list.repeatX;Laya.timer.loop(3e3,this,function(){var e=i++;n<e&&(i=t.m_list.startIndex,e=0),t.m_list.tweenTo(e)})},l);function l(){var e=n.call(this)||this;return e.love_data=null,e.init(),e}t.LoveGame=o}),define("newfunction/MyMinGame",["require","exports","game/scene/GameSystem","game/utils/SoundUtils","com/help/GameConfig","game/Ctrl/GameCtrl"],function(e,t,i,s,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=ui.main.my_mingameUI,__extends(l,a),l.prototype.init=function(){if("undefined"!=typeof wx){var e=wx.getSystemInfoSync(),t=Laya.stage.width/e.screenWidth,i=Laya.stage.height/e.screenHeight,n=(r=wx.getMenuButtonBoundingClientRect()).left*t-this.width,a=r.top*i;this.x=n,this.y=a}if(this.rightMove(),this.on(Laya.Event.CLICK,this,this.showView),"undefined"!=typeof wx){var r=wx.getLaunchOptionsSync();o.GameConfig.scene_id=r.scene,wx.onShow(function(e){o.GameConfig.scene_id=e.scene,s.SoundUtils.instance.playBGM(s.SoundUtils.instance.nowurl,!0)})}},l.prototype.showView=function(){s.SoundUtils.instance.playSound(i.GameSystem.MUSIC_DIANJI),n.GameCtrl.getInstance().runLogic(12)},l.prototype.rightMove=function(){var e=this;Laya.Tween.to(this,{x:this.x-20,y:this.y},1e3,null,new Laya.Handler(this,function(){e.leftMove()}))},l.prototype.leftMove=function(){var e=this;Laya.Tween.to(this,{x:this.x+20,y:this.y},500,Laya.Ease.bounceIn,new Laya.Handler(this,function(){e.rightMove()}))},l);function l(){var e=a.call(this)||this;return e.init(),e}t.MyMinGame=r}),define("game/View/ChooseBallScene",["require","exports","game/View/GameStartView","game/utils/SoundUtils","sheets/vo/BallSkin","game/scene/GameScene","com/comp/CustomMaterial","game/scene/GameSystem","newfunction/gamecore/deer/DeerSDK"],function(e,t,s,i,o,a,r,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c,u=(c=Laya.Scene,__extends(d,c),Object.defineProperty(d,"instance",{get:function(){return this.mInstance||(this.mInstance=new d)},enumerable:!0,configurable:!0}),d.prototype.init=function(){this.ballsprites=new Laya.Sprite3D,this.addChild(this.ballsprites);var e=o.BallSkin.getAllSkin(),t=s.GameStartView.skin.length,i=0;for(playerCenter.skinHad;i<t;i++){var n=e[i],a=new p(n),r=a.transform.localPosition;r.x=i*p.size*3,a.transform.localPosition=r,this.ballsprites.addChild(a),this._allball.push(a)}this._allnum=t,this._allwidth=t*p.spacesize,this.selectedIndex=0},d.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},d.prototype.show=function(e){var t=0;this.playerdata=playerCenter.skinHad;for(var i=this._allnum,n=0;t<i;t++)if(this._allball[t].data=this.playerdata[t],this.playerdata[t].isSelect){n=t;break}this.oldSelectdata=this.playerdata[n],this.selectedValue=n*p.spacesize,this.mouseproxy=e,this.mouseproxy.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),l.default.instance.isOnline?Laya.stage.addChildAt(this,Laya.stage.getChildIndex(a.GameS1.instance)+1):Laya.stage.addChild(this)},d.prototype.selectedBallStyle=function(){this.oldSelectdata&&(this.oldSelectdata.isSelect=!1),this.oldSelectdata=this.playerdata[this._selectedIndex],this.oldSelectdata&&(this.oldSelectdata.isSelect=!0)},d.prototype.hide=function(){this.removeSelf()},d.prototype.onMouseDown=function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),this.mousedown=!0,this.startSelectedValue=this._selectedValue,this.startMouseX=Laya.stage.mouseX,Laya.timer.frameLoop(1,this,this.onMouseLoop),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onMouseUp)},d.prototype.onMouseUp=function(){this.mousedown=!1,Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onMouseUp),Laya.timer.clear(this,this.onMouseLoop),Laya.Tween.to(this,{selectedValue:this._tempselctedIndex*p.spacesize},300)},d.prototype.onMouseLoop=function(){this.selectedValue=this.startSelectedValue-.01*(Laya.stage.mouseX-this.startMouseX)/Laya.stage.clientScaleX},Object.defineProperty(d.prototype,"selectedValue",{get:function(){return this._selectedValue},set:function(e){this._selectedValue=e,e+=1.5*p.size,this._tempselctedIndex=Math.floor(e/p.spacesize);var t=Math.floor(e/p.spacesize),i=e-t*p.spacesize;(t%=this._allnum)<0&&(t+=this._allnum),t=t*p.spacesize+i;var n=this.ballsprites.transform.localPosition;n.x=-t,this.ballsprites.transform.localPosition=n,this.selectedIndex=Math.floor(t/p.spacesize)},enumerable:!0,configurable:!0}),d.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},Object.defineProperty(d.prototype,"selectedIndex",{get:function(){return this._selectedIndex},set:function(e){if(e<0?e=0:e>=this._allnum&&(e%=this._allnum),this._selectedIndex!=e){var t=this._allnum;this._selectedIndex=e,this.selectedball=this._allball[e];for(var i,n=e-3,a=e+3;n<a;n++){(i=n)<0?i+=t:t<=n&&(i-=t);var r=this._allball[i],s=r.transform.localPosition;s.x=n*p.size*3,r.transform.localPosition=s}this.event(Laya.Event.CHANGE)}},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"selectedball",{get:function(){return this._selectedball},set:function(e){this._selectedball&&(this._selectedball.selected=!1),this._selectedball=e,this._selectedball&&(this._selectedball.selected=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"selectedvo",{get:function(){return this._selectedball.vo},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"selectedData",{get:function(){return this._selectedball.data},enumerable:!0,configurable:!0}),d);function d(){var e=c.call(this)||this;e._allball=[],e.startMouseX=0,e.startSelectedValue=0,e.mousedown=!1,e._selectedValue=0,e._tempselctedIndex=0,e._selectedIndex=-1,e.camera=new Laya.Camera(0,.01,40),e.camera.clearFlag=Laya.Camera.CLEARFLAG_NONE,e.camera.orthographic=!0;Laya.stage;var t=e.camera.transform.localPosition;return t.z=10,t.y=-1.2,e.camera.transform.localPosition=t,e.camera.transform.lookAt(new Laya.Vector3(0,t.y,0),Laya.Vector3.Up),e.addChild(e.camera),e.pointLight=e.camera.addChild(new Laya.PointLight),e.pointLight.color=new Laya.Vector3(1,1,1),e.pointLight.transform.translate(new Laya.Vector3(0,100,100)),e.addChild(e.pointLight),e.init(),e}t.ChooseBallScene=u;var _,p=(_=Laya.Sprite3D,__extends(f,_),Object.defineProperty(f.prototype,"selected",{set:function(e){if(this._selected!=e)if(this._selected=e,this._selected)Laya.Tween.to(this,{scaleball:1.3},200,Laya.Ease.circInOut),Laya.timer.frameLoop(1,this,this.onLoop);else{Laya.timer.clear(this,this.onLoop),Laya.Tween.to(this,{scaleball:1},200);var t=this.ball.transform.localRotationEuler;t.x=t.z=0,t.y=90,this.ball.transform.localRotationEuler=t}},enumerable:!0,configurable:!0}),f.prototype.onLoop=function(){this.roll(.1)},Object.defineProperty(f.prototype,"scaleball",{get:function(){return this._scale},set:function(e){this._scale=e;var t=this.ball.transform.scale;t.z=t.y=t.x=e,this.ball.transform.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"skin",{set:function(e){this.ball.meshRender.sharedMaterial.diffuseTexture=Laya.Texture2D.load(e)},enumerable:!0,configurable:!0}),f.prototype.roll=function(e){f.tempVec.z=-e,this.ball.transform.rotate(f.tempVec)},f.spacesize=3*(f.size=.4),f.tempVec=new Laya.Vector3,f);function f(e){var t=_.call(this)||this;t._selected=!1,t._scale=1,t.vo=e,t.ball=new Laya.MeshSprite3D(new Laya.SphereMesh(f.size));var i,n=new r.CustomMaterial;return n.hasLight=!0,n.hasSpecular=!0,t.ball.meshRender.sharedMaterial=n,t.addChild(t.ball),console.log("添加小球",t.ball,e.skin),(i=t.ball.transform.localRotationEuler).y=90,t.ball.transform.localRotationEuler=i,(i=t.ball.transform.localPosition).x=1.5*f.size,t.ball.transform.localPosition=i,t.skin=e.skin,t}t.ChooseBall=p}),define("game/View/AlertView",["require","exports","game/scene/GameSystem","game/utils/SoundUtils"],function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=ui.main.AlertUI,__extends(s,a),Object.defineProperty(s,"instance",{get:function(){return this._instance||(this._instance=new s)},enumerable:!0,configurable:!0}),s.prototype.showAlert=function(e){this._okhandle=e,this.popup(!0,!0)},s.prototype.close2=function(){n.SoundUtils.instance.playSound(i.GameSystem.MUSIC_DIANJI),this._okhandle&&this._okhandle.run(),this.close()},s.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},s);function s(){var e=a.call(this)||this;return e.btn_sure.on(Laya.Event.MOUSE_DOWN,e,e.close2),e}t.AlertView=r}),define("newfunction/Bunner",["require","exports","game/utils/SoundUtils","game/scene/GameSystem","newfunction/gamecore/util/RunData","wx/wxInterface"],function(e,t,i,n,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,o=(s=ui.main.bannerUI,__extends(l,s),l.prototype.init=function(){var t=this;a.RunData.getBannerData(function(e){t.bunner_data=e,t.setBunner()}),this.settingLoca(),this.hind(),Laya.stage.on("show",this,this.show),Laya.stage.on("hind",this,this.hind)},l.prototype.show=function(){this.banner.visible=!0},l.prototype.hind=function(){this.banner.visible=!1},l.prototype.settingLoca=function(){l.isIphoneX&&(this.mscale=1,this.moveto=20),this.scale(this.mscale,this.mscale),this.width=this.width*this.mscale,this.height=this.height*this.mscale,this.y=Laya.stage.height-this.height-this.moveto,this.x=Laya.stage.width/2-this.width/2},Object.defineProperty(l,"isIphoneX",{get:function(){try{return/iphone/gi.test(Laya.Browser.userAgent)&&812==screen.height&&375==screen.width}catch(e){}return!1},enumerable:!0,configurable:!0}),l.prototype.setBunner=function(){null!=this.bunner_data&&(this.settingiMG(),Laya.timer.loop(4e3,this,this.settingiMG),this.banner.on(Laya.Event.CLICK,this,this.opneGame))},l.prototype.opneGame=function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),r.wxInterface.I.goOtherGame(this.now_appid,function(){Laya.stage.event("Tip",[{title:"小游戏打开失败"}])})},l.prototype.settingiMG=function(){this.index>=this.bunner_data.length&&(this.index=0),this.banner.skin=this.bunner_data[this.index].bannerImg,this.now_appid=this.bunner_data[this.index].appID,this.index++},l);function l(){var e=s.call(this)||this;return e.bunner_data=null,e.mscale=.8,e.moveto=0,e.index=0,e.now_appid="",e.init(),e}t.Bunner=o}),define("game/View/GameStartView",["require","exports","sheets/vo/BallSkin","newfunction/GameS3","newfunction/gamecore/deer/DeerSDK","newfunction/gamecore/util/RunData","com/help/GameConfig","newfunction/BaoGame","newfunction/LoveGame","newfunction/MyMinGame","game/scene/GameSystem","utils/GameSetting","game/Ctrl/GameCtrl","game/scene/GameScene","game/model/GameModel","wx/wxInterface","wx/dataCenter","game/View/SignWin","game/View/ChooseBallScene","game/View/AlertView","sheets/vo/PConfig","game/utils/SoundUtils","newfunction/Bunner"],function(e,t,i,n,a,r,s,o,l,c,u,d,_,p,f,m,g,v,y,C,E,S,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var T,M=(T=ui.main.GameStartViewUI,__extends(b,T),b.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},b.getJson=function(t){Laya.loader.load(t,Laya.Handler.create(this,function(){var e=Laya.loader.getRes(t);b.skin=e,console.log("皮肤价格数据",b.skin)}),null,Laya.Loader.JSON)},b.prototype.enable=function(){var t=this;s.GameConfig.LoGo.y=200,this.addChild(s.GameConfig.LoGo),a.default.instance.isOnline?this.btn_invite.visible=!0:this.btn_invite.visible=!1,S.SoundUtils.instance.playBGM(u.GameSystem.MUSIC_BG),this.stepbox.parent!=Laya.stage&&Laya.stage.addChild(this.stepbox),this.isShiwan&&(this.isShiwan=!1,y.ChooseBallScene.instance.selectedIndex=0),this.getChildAt(13),this.btn_start.scaleX=1,this.btn_start.scaleY=1,y.ChooseBallScene.instance.on(Laya.Event.CHANGE,this,this.updateBugButton),y.ChooseBallScene.instance.show(this.chooseballproxy),this.updateBugButton(),this.changeCount(),this.btn_rank.on(Laya.Event.CLICK,this,this.openRank),this.btn_start.on(Laya.Event.CLICK,this,this.StartGame),this.btn_invite.on(Laya.Event.CLICK,this,this.openGift),this.btn_7d.on(Laya.Event.MOUSE_DOWN,this,this.show7D),this.btn_try.on(Laya.Event.MOUSE_DOWN,this,this.haveAtry),this.setting_home.on(Laya.Event.CLICK,this,this.openSetting),this.btn_buy.on(Laya.Event.MOUSE_DOWN,this,this.buySkin),Laya.timer.frameLoop(1,this,this.scaleBig),Laya.stage.on("showClub",this,this.showClub),Laya.stage.on("updata_dia",this,this.changeDiamond),a.default.instance.isOnline&&p.GameS1.instance.m_ready(),f.GameModel.isntance.on(Laya.Event.CHANGE,this,this.changeCount),this.stepbox.visible=!1,Laya.stage.on("close_txt",this,this.onCloseTxt),this.gameclubbutton&&this.gameclubbutton.show(),this.label&&(this.label.visible=!0);var i=this;if(d.GameSetting.ismingame?g.dataCenter.I.get("diamond",function(e){e&&(playerCenter.Dionum=e,i.changeDiamond())}):this.changeDiamond(),v.SignWin.overDay&&Laya.timer.once(500,this,function(){_.GameCtrl.getInstance().runLogic(10)}),this.spric||(this.spric=new Laya.Sprite,this.lovegame=new l.LoveGame,this.spric.addChild(this.lovegame),this.myminGame=new c.MyMinGame,this.spric.addChild(this.myminGame),this.spric.addChild(new o.BaoGame)),!this.bunner){this.bunner=new Laya.Sprite;var e=new x.Bunner;this.bunner.addChild(e)}Laya.stage.addChild(this.bunner),this.bunner.zOrder=2e3,this.bunner.mouseThrough=!0,Laya.stage.addChild(this.spric),r.RunData.getAniAd(function(e){t.ani_ads=e,t.settingAniAd()}),m.wxInterface.I.initWxFun()},b.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},b.prototype.settingAniAd=function(){null!=this.ani_ads&&(null==this.sk&&(this.sk=new Laya.Skeleton),this.settingiMG(),Laya.timer.loop(4e3,this,this.settingiMG),this.ani_ad.on(Laya.Event.CLICK,this,this.opneGame))},b.prototype.settingiMG=function(){var e=this,t="https://xz-cdn.youkongwan.com/game/ballgo/spine/";this.index>=this.ani_ads.length&&(this.index=0);var i=this.ani_ads[this.index].laya_spine;i?t=i.laya_sk:t+=s.GameConfig.appid[this.ani_ads[this.index].appID],this.sk.load(t,new Laya.Handler(this,function(){e.sk.scale(e.ani_ad.width/256,e.ani_ad.height/256),e.sk.x=e.ani_ad.width/2,e.sk.y=e.ani_ad.height/2,e.ani_ad.addChild(e.sk)})),this.now_appid=this.ani_ads[this.index].appID,this.index++},b.prototype.opneGame=function(){S.SoundUtils.instance.playSound(u.GameSystem.MUSIC_DIANJI),m.wxInterface.I.goOtherGame(this.now_appid,function(){Laya.stage.event("Tip",[{title:"小游戏打开失败"}])})},b.prototype.openSetting=function(){S.SoundUtils.instance.playSound(u.GameSystem.MUSIC_DIANJI),_.GameCtrl.getInstance().runLogic(13)},b.prototype.disable=function(){y.ChooseBallScene.instance.hide(),this.btn_rank.off(Laya.Event.CLICK,this,this.openRank),this.btn_start.off(Laya.Event.CLICK,this,this.StartGame),this.btn_invite.off(Laya.Event.CLICK,this,this.openGift),this.btn_7d.off(Laya.Event.MOUSE_DOWN,this,this.show7D),this.btn_try.off(Laya.Event.MOUSE_DOWN,this,this.haveAtry),this.setting_home.off(Laya.Event.CLICK,this,this.openSetting),this.spric&&Laya.stage.removeChild(this.spric),Laya.timer.clear(this,this.settingiMG),Laya.stage.off("showClub",this,this.showClub),Laya.stage.off("updata_dia",this,this.changeDiamond),this.gameclubbutton&&this.gameclubbutton.hide(),this.label&&(this.label.visible=!0),Laya.timer.clear(this,this.scaleBig)},b.prototype.updateBugButton=function(){y.ChooseBallScene.instance.selectedData.had?(this.btn_buy.visible=!1,this.btn_start.visible=!0,this.btn_try.visible=!1):(this.btn_try.visible=!0,this.btn_start.visible=!1,this.btn_buy.visible=!0),n.GameS3.nowskin=i.BallSkin.getAllSkin()[y.ChooseBallScene.instance.selectedIndex].skin,this.selectSkin()},b.prototype.buysuccessEffect=function(){this.buysuccessIcon.visible=!0,this.buysuccessIcon.alpha=1,Laya.Tween.to(this.buysuccessIcon,{alpha:0},1e3,null,Laya.Handler.create(this,this.effectEnd),2e3)},b.prototype.haveAtry=function(){if(S.SoundUtils.instance.playSound(u.GameSystem.MUSIC_DIANJI),d.GameSetting.ismingame){if(this.isDown)return;this.isDown=1,m.wxInterface.I.createVideo(function(e){1==e?this.StartGame(!0):Laya.stage.event("Tip",[{title:"广告调取失败"}]),this.isDown=0}.bind(this))}else this.StartGame(!0)},b.prototype.effectEnd=function(){this.buysuccessIcon.visible=!1},b.prototype.selectSkin=function(){if(b.skin&&b.skin[y.ChooseBallScene.instance.selectedIndex]){var e=b.skin[y.ChooseBallScene.instance.selectedIndex];0==e.unlocktype?(this.btn_buy.skin="comp/bugbtn.png",this.buysuccessIcon.skin="comp/bugsuccess.png"):(this.btn_buy.skin="comp/img_bluebuy.png",this.buysuccessIcon.skin="comp/img_bluebuyS.png"),this.font_price.text="x"+e.unlockprice}else{y.ChooseBallScene.instance.selectedIndex<this.blue?(this.btn_buy.skin="comp/bugbtn.png",this.buysuccessIcon.skin="comp/bugsuccess.png"):(this.btn_buy.skin="comp/img_bluebuy.png",this.buysuccessIcon.skin="comp/img_bluebuyS.png");var t=y.ChooseBallScene.instance.selectedData;this.font_price.text="x"+t.price}a.default.instance.isOnline&&p.GameS1.instance.m_cgskin(y.ChooseBallScene.instance.selectedvo),y.ChooseBallScene.instance.selectedBallStyle()},b.prototype.buySkin=function(){S.SoundUtils.instance.playSound(u.GameSystem.MUSIC_DIANJI),C.AlertView.instance.showAlert(Laya.Handler.create(this,this.dobuyskin))},b.prototype.dobuyskin=function(){var t=0,i=y.ChooseBallScene.instance.selectedData,n=this,a="";if(b.skin&&b.skin[y.ChooseBallScene.instance.selectedIndex]){var e=b.skin[y.ChooseBallScene.instance.selectedIndex];a=0==e.unlocktype?"chest":"sapphire",t=e.unlockprice}else a=y.ChooseBallScene.instance.selectedIndex<this.blue?"chest":"sapphire",t=i.price;d.GameSetting.ismingame?g.dataCenter.I.get("diamond",function(e){e&&(playerCenter.Dionum=e,playerCenter.Dionum[a]>=t?(playerCenter.Dionum[a]-=t,playerCenter.skinArr[i.num]=1,g.dataCenter.I.send("diamond",JSON.stringify(playerCenter.Dionum),function(){g.dataCenter.I.send("skinArr",JSON.stringify(playerCenter.skinArr))}),i.had=1,n.updateBugButton(),n.changeDiamond(),n.buysuccessEffect(),Laya.stage.event("Tip",[{title:"购买成功"}])):Laya.stage.event("Tip",[{title:"您的余额不足"}]))}):playerCenter.Dionum[a]>=t?(playerCenter.Dionum[a]-=t,i.had=1,this.updateBugButton(),this.changeDiamond(),this.buysuccessEffect()):Laya.stage.event("Tip",[{title:"您的余额不足"}])},b.prototype.show7D=function(){S.SoundUtils.instance.playSound(u.GameSystem.MUSIC_DIANJI),d.GameSetting.ismingame&&_.GameCtrl.getInstance().runLogic(10)},b.prototype.showClub=function(){this.gameclubbutton&&this.gameclubbutton.show(),this.label&&(this.label.visible=!0)},b.prototype.onCloseTxt=function(e){this.stepbox.visible=e},b.prototype.openGift=function(){S.SoundUtils.instance.playSound(u.GameSystem.MUSIC_DIANJI),this.gameclubbutton&&this.gameclubbutton.hide(),this.label&&(this.label.visible=!1),a.default.instance.isOnline?_.GameCtrl.getInstance().runLogic(2):Laya.stage.event("Tip",[{title:"暂未开放"}])},b.prototype.openRank=function(){S.SoundUtils.instance.playSound(u.GameSystem.MUSIC_DIANJI),_.GameCtrl.getInstance().runLogic(3),d.GameSetting.ismingame&&m.wxInterface.I.postMessage({type:"rank"})},b.prototype.openShare=function(){d.GameSetting.ismingame&&m.wxInterface.I.share("room")},b.prototype.changeCount=function(){var e=f.GameModel.isntance.count+"";this.text_score.value=e,e=Math.floor(f.GameModel.isntance.stepcount)+"",this.text_step.value=e},b.prototype.StartGame=function(t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return S.SoundUtils.instance.playSound(u.GameSystem.MUSIC_DIANJI),"boolean"==typeof t&&(this.isShiwan=t),this.stepbox.visible=!0,a.default.instance.isOnline?_.GameCtrl.getInstance().runLogic(7):_.GameCtrl.getInstance().runLogic(16),this.changeCount(),this.removeSelf(),this.disable(),[2]})})},b.prototype.scaleBig=function(){this.box_scale.scaleX<=.9?this.big=1:1<=this.box_scale.scaleX&&(this.big=-1),this.box_scale.scaleX+=.004*this.big,this.box_scale.scaleY+=.004*this.big},b.prototype.changeDiamond=function(){this.txt_score.text=playerCenter.Dionum.chest.toString(),this.txt_blue.text=playerCenter.Dionum.sapphire.toString()},b.skin=null,b);function b(){var e=T.call(this)||this;if(e.isDown=0,e.blue=0,e.bunner=null,e.ani_ads=null,e.now_appid="",e.sk=null,e.index=0,e.myminGame=null,e.lovegame=null,e.spric=null,e.isShiwan=!1,e.buysuccessIcon.visible=!1,e.size(Laya.stage.width,Laya.stage.height),e.blue=~~E.PConfig.get(1014).value,812==Laya.Browser.clientHeight&&375==Laya.Browser.clientWidth&&(e.y=120,Laya.Browser.onIPhoneX=!0),d.GameSetting.ismingame){var t=Laya.stage.height/Laya.Browser.clientHeight,i=Laya.stage.width/Laya.Browser.clientWidth,n={icon:"white"},a=Laya.Browser.onIPhoneX?Laya.Browser.clientHeight/2-20:600/t;n.style={left:15,top:a,width:30,height:30};try{e.label.x=45*i-60,e.label.y=t*(30+a)+10-e.y,e.label.bold=!0}catch(e){}}return e}t.GameStartView=M}),define("game/View/GameTip",["require","exports","game/utils/SoundUtils","game/scene/GameSystem"],function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=ui.main.TipUI,__extends(s,a),s.prototype.close=function(){this._cb&&(this._cb(!0),this._cb=null),a.prototype.close.call(this)},Object.defineProperty(s,"I",{get:function(){return s.instance||(s.instance=new s),s.instance},enumerable:!0,configurable:!0}),s.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},s.prototype.tip=function(e){this.popup(),this.text_tip.text=e.title,e.cb&&(this._cb=e.cb)},s);function s(){var e=a.call(this)||this;return Laya.stage.on("Tip",e,e.tip),e.btn_true.on(Laya.Event.MOUSE_DOWN,e,function(){i.SoundUtils.instance.playSound(n.GameSystem.MUSIC_DIANJI),this.close()}),e}t.GameTip=r}),define("GameMain",["require","exports","game/View/GameStartView","game/View/InviteWin","utils/GameSetting","game/scene/GameSystem","com/comp/CustomMaterial","game/Ctrl/GameCtrl","com/comp/NewTrailMaterial","com/comp/RoadLineMaterial","game/View/GameTip","sheets/vo/BallSkin","wx/dataCenter","wx/wxInterface","com/comp/WindMaterial","game/View/SignWin","com/help/GameConfig","newfunction/gamecore/deer/DeerSDK","newfunction/gamecore/deer/DeerSDKEventNames","newfunction/gamecore/base/GameValues"],function(e,t,i,n,a,r,s,o,l,c,u,d,_,p,f,m,g,v,y,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=(S.prototype.initrun=function(){v.default.instance.isReady?(console.log("===========握手成功。============"),this.init()):v.default.instance.addEventListener(y.default.READY,this.init,this)},S.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},S.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},S.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},S.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return v.default.instance.isReady?console.log("===========握手成功。============"):console.log("===========握手失败。============"),Laya.MiniAdpter.init(!0,!1),Laya3D.init(750,1334,!0),this.now=Laya.Browser.now(),Laya.Browser.onMobile?Laya.stage.scaleMode=Laya.Stage.SCALE_FIXED_WIDTH:Laya.stage.scaleMode=Laya.Stage.SCALE_SHOWALL,Laya.MouseManager.multiTouchEnabled=!1,Laya.stage.alignH=Laya.Stage.ALIGN_CENTER,Laya.stage.alignV=Laya.Stage.ALIGN_MIDDLE,Laya.MiniAdpter.getUrlEncode=S.getEncode,[4,this.loaderRes("loading/bg.jpg")];case 1:return e.sent(),[4,this.loaderRes("res/atlas/loading.atlas")];case 2:return e.sent(),o.GameCtrl.getInstance().runLogic(9),m.SignWin.getJson(r.GameSystem.DATA_JSON_SIGIN),n.InviteWin.getJson(r.GameSystem.DATA_JSON_INIVE),i.GameStartView.getJson(r.GameSystem.DATA_JSON_SKIN),Laya.loader.load(r.GameSystem.DATA_JSON_BASE,Laya.Handler.create(this,function(){var e=Laya.loader.getRes(r.GameSystem.DATA_JSON_BASE);g.GameConfig.baseinfo=e,console.log("公共数据",g.GameConfig.baseinfo)}),null,Laya.Loader.JSON),Laya.loader.load(r.GameSystem.DATA_JSON_APPID,Laya.Handler.create(this,function(){var e=Laya.loader.getRes(r.GameSystem.DATA_JSON_APPID);g.GameConfig.appid=e,console.log("Appid数据",g.GameConfig.appid)}),null,Laya.Loader.JSON),p.wxInterface.shareObj=g.GameConfig.sharedata,a.GameSetting.ismingame||(t="data/cfg.json"),t="data/cfg.json",[4,SheetManager.loadDB(t)];case 3:return e.sent(),a.GameSetting.ismingame?(p.wxInterface.I.login(),Laya.MiniAdpter.downLoadFile(r.GameSystem.MUSIC_BG,"sound",Laya.Handler.create(this,function(e){Laya.MiniAdpter.downLoadFile(r.GameSystem.MUSIC_BG1,"sound",Laya.Handler.create(this,function(e){Laya.MiniAdpter.downLoadFile(r.GameSystem.MUSIC_HIT,"sound",Laya.Handler.create(this,function(e){console.log("downLoadFile 完成"),this.verComplete()}))}))}))):this.verComplete(),[2]}})})},S.prototype.verComplete=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=[{url:r.GameSystem.UI_IMG,type:Laya.Loader.ATLAS},{url:"res/atlas/nums.atlas",type:Laya.Loader.ATLAS},{url:"res/33333.png",type:Laya.Loader.IMAGE},{url:"res/77777.png",type:Laya.Loader.IMAGE},{url:"res/88888.png",type:Laya.Loader.IMAGE},{url:"res/999999.png",type:Laya.Loader.IMAGE},{url:"res/444444.png",type:Laya.Loader.IMAGE},{url:"res/arrow.png",type:Laya.Loader.IMAGE},{url:"res/arrow2.jpg",type:Laya.Loader.IMAGE},{url:"res/atlas/ani.atlas",type:Laya.Loader.ATLAS}],Laya.loader.load(t,Laya.Handler.create(this,this.loadCfgComplete),null,null,null,null,null,!0),[2]})})},S.prototype.loaderRes=function(t){var i=this;return new Promise(function(e){Laya.loader.load(t,Laya.Handler.create(i,function(){e()}),null)})},S.prototype.loadCfgComplete=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return v.default.instance.isOnline&&(f.WindMaterial.initShader(),c.RoadLineMaterial.initShader(),l.NewTrailMaterial.initShader()),s.CustomMaterial.initShader(),u.GameTip.I,S.isReady=1,_.dataCenter.I.get("skinArr",function(e){if(e){for(var t=d.BallSkin.getAllSkin(),i=0,n=[],a=0;a<t.length;a++)i=0==a||1==parseInt(e[a])?1:0,n.push(i),t[a].had=i,t[a].num=a;playerCenter.skinHad=t,console.log("皮肤数据",t),playerCenter.skinArr=n}else{for(t=d.BallSkin.getAllSkin(),a=i=0;a<t.length;a++)i=0==a?1:0,t[a].had=i,t[a].num=a;playerCenter.skinHad=t,playerCenter.skinArr=[]}}),_.dataCenter.I.get("diamond",function(e){if(null==e){var t={chest:500,sapphire:100};playerCenter.Dionum=t,_.dataCenter.I.send("diamond",JSON.stringify(playerCenter.Dionum))}}),[2]})})},S.isReady=0,S.isShare=!1,S.getEncode=function(e,t){return-1!=e.indexOf(".fnt")||-1!=e.indexOf("share.json")||-1!=e.indexOf("reward.json")?"utf8":"arraybuffer"==t?"":"ascii"},S);function S(){this.verson="1.0.1",v.default.initSDK("wxcc797d4eff1f6ad4",24,40),a.GameSetting.ismingame=!0,C.default.enableLog=!1,UIConfig.popupBgAlpha=.8,C.default.gameVersion="1.1",console.log("游戏环境状态",a.GameSetting.ismingame),this.initrun()}new(t.GameMain=E)}),requirejs(["GameMain"]),define("com/comp/After3D",["require","exports","game/road/WindPlane"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=Laya.MeshSprite3D,__extends(r,n),r.prototype.init=function(){for(var e=0;e<this.count;e++){var t=new i.WindPlane;this.addChild(t),t.initMaterial(),this.planes.push(t),t.transform.position=t.transform.position}},r.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},Object.defineProperty(r.prototype,"bendOffest",{set:function(e){e.x=-e.x;for(var t=0;t<this.count;t++)this.planes[t].material.bendOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skin",{set:function(e){for(var t=0;t<this.count;t++)this.planes[t].skin=e},enumerable:!0,configurable:!0}),r.prototype.changeWeiba=function(e){var t,i=this.planes[0].transform.position;i.x+=(e-i.x)/2,this.planes[0].transform.position=i;for(var n=1;n<this.planes.length;n++)i=this.planes[n].transform.position,t=this.planes[n-1].transform.position,i.x+=(t.x-i.x)/1.1,this.planes[n].transform.position=i},r.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},r);function r(){var e=n.call(this)||this;return e.count=1,e.startZ=0,e.planes=[],e.init(),e}t.After3D=a}),define("com/comp/Afterimage",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=Laya.Sprite,__extends(a,i),a.prototype.addAfter=function(e,t,i){if(this.moveIndex<this.MAX_MOVE)this.moveIndex++;else{var n=new Laya.Sprite;n.x=e,n.y=t,n.texture=i,n.pivotX=i.width/2,n.pivotY=i.height/2,this.moveIndex=0,this.addChild(n),this.resetAfter()}},a.prototype.resetAfter=function(){for(;this.numChildren>this.MAX;)this.removeChildAt(0).destroy();for(var e=this.MAX_SACALE/this.MAX,t=1,i=this.MAX_ALPHA/this.MAX,n=1,a=this.numChildren-1;0<=a;a--){var r=this.getChildAt(a);r.scale(t,t),t-=e,r.alpha=n,n-=i}},a.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},a.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},a.prototype.dispose=function(){this.removeSelf(),this.destroy(!0)},a);function a(){var e=null!==i&&i.apply(this,arguments)||this;return e.MAX=14,e.MAX_SACALE=.2,e.MAX_MOVE=3,e.MAX_ALPHA=.8,e.moveIndex=0,e}t.Afterimage=n}),define("com/comp/CustomizeTexture",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(c.prototype.saveArgs=function(e){this.args=e},c.prototype.setTexture=function(e,t,i,n){this.texture=e,this.id=t,this.x=i,this.y=n},c.prototype.tweenTo=function(e,t,i,n){return void 0===n&&(n=null),Laya.Tween.to(e,t,i,n)},c.prototype.dispose=function(){this.id=0,this.x=0,this.y=0,this.texture=null,this.args=null,Laya.Pool.recover("DropTexturem",this)},c.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},c.asyncGetTextureByUrl=function(a,r,s,o){var l=this;return new Promise(function(e,t){var i=Laya.Loader.getRes(a),n=Laya.Pool.getItemByClass("DropTexturem",c);i?(n.setTexture(i,r,s,o),e(n)):Laya.loader.load(a,Laya.Handler.create(l,function(){n.setTexture(Laya.Loader.getRes(a),r,s,o),e(n)}))})},c.getTextureByUrl=function(e,t,i,n){var a=Laya.Loader.getRes(e),r=Laya.Pool.getItemByClass("DropTexturem",c);return r.setTexture(a,t,i,n),r},c);function c(){}t.CustomizeTexture=i}),define("com/comp/HtmlUtils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(l.setHtml=function(e,t,i,n,a){void 0===t&&(t=6),void 0===i&&(i=16),void 0===n&&(n="left"),void 0===a&&(a="top"),window&&window.navigator&&-1<window.navigator.userAgent.indexOf("iPhone")?e.font=i+"px 黑体-简":e.font=i+"px 黑体",e.fontSize=i,e.align=n,e.valign=a,e.leading=t},l.addColor=function(e,t,i,n,a){return void 0===i&&(i=24),void 0===n&&(n="黑体"),void 0===a&&(a=""),"<span "+(a?"href='"+a+"' ":"")+"style='color:"+t+";font-size:"+i+"px;"+(window&&window.navigator&&-1<window.navigator.userAgent.indexOf("iPhone")?"font-family:"+n+"-简":"font-family:"+n)+"'>"+e+"</span>"},l.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},l.addImage=function(e,t,i){return void 0===t&&(t=24),void 0===i&&(i=23),"<img src='"+e+".png' style='vertical-align:middle;width:"+t+"px;height:"+i+"px;'></img>"},l.showReplaceTips=function(e){var t="";if(-1!=e.indexOf("#"))for(var i=e.split("#"),n=0;n<i.length;n++){var a=i[n],r=a.charAt(0);if("a"<=r&&r<="z"){var s="#"+a.substr(0,6),o=a.substr(6,a.length+1);t+=l.addColor(o,s,20)}else t+=a}return t||e},l.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},l.getColor=function(e){var t;switch(e){case 1:t="#ffffff";break;case 2:t="#04681c";break;case 3:t="#00fff0";break;case 4:t="#800080";break;case 5:t="#ffa500";break;case 6:t="#ff0000";break;default:t="#ffffff"}return t},l);function l(){}t.HtmlUtils=i}),define("com/comp/TextLayer",["require","exports","com/comp/CustomizeTexture"],function(e,t,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=Laya.Sprite,__extends(a,i),a.prototype.showText=function(t,i,n,a,r){return void 0===a&&(a=0),void 0===r&&(r=0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return Laya.Loader.getAtlas(i)?[3,2]:[4,this.loaderBattler(i)];case 1:return e.sent(),this.createText(t,i,n,a,r),[3,3];case 2:this.createText(t,i,n,a,r),e.label=3;case 3:return[2]}})})},a.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},a.prototype.createText=function(o,e,l,h,c){return void 0===h&&(h=0),void 0===c&&(c=0),__awaiter(this,void 0,void 0,function(){var t,i,n,a,r,s;return __generator(this,function(e){for(this.clear(),n=i=t=0;n<o.length;n++)a=o.charAt(n),r=u.CustomizeTexture.getTextureByUrl(""+l+a+".png",0,0,0),this.textures.push(r),s=this.getTextures(r,t,0),t+=r.texture.sourceWidth,0==i&&(i=r.texture.sourceHeight),this.graphics._saveToCmd(Laya.Render._context._drawTexture,s);return this.width=t,this.height=i,this.x=h,this.y=c,[2]})})},a.prototype.clear=function(){for(;this.textures.length;)this.textures.pop().dispose();this.graphics.clear()},a.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},a.prototype.getTextures=function(e,t,i){var n=[];return n[0]=e.texture,n[1]=t,n[2]=0,n[3]=0,n[4]=0,n[5]=null,n[6]=1,e.saveArgs(n),n},a.prototype.loaderBattler=function(t){var i=this;return new Promise(function(e){Laya.loader.load(t,Laya.Handler.create(i,function(){e()}),null,Laya.Loader.ATLAS)})},a);function a(){var e=i.call(this)||this;return e.textures=[],e.mouseEnabled=!0,e}t.TextLayer=n}),define("com/comp/WindMesh",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=Laya.PrimitiveMesh,__extends(a,n),a.prototype.writevertices=function(e,t,i,n,a,r){var s=8*t;e[s++]=i,e[s++]=0,e[s++]=n,e[s++]=0,e[s++]=1,e[s++]=0,e[s++]=a,e[s++]=r},a.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},a.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},a.prototype.recreateResource=function(){this._numberVertices=22,this._numberIndices=60;for(var e=new Uint16Array(this._numberIndices),t=Laya.VertexPositionNormalTexture.vertexDeclaration,i=t.vertexStride/4,n=new Float32Array(this._numberVertices*i),a=this._width/2,r=(this._long,this._width/10),s=0,o=0;o<=10;o++)for(var l=this._long*(.5-.5*Math.abs(o-5)/5),h=0;h<=1;h++)n[s++]=0==h?-l:l,n[s++]=0,n[s++]=o*r-a,n[s++]=1,n[s++]=4,n[s++]=1,n[s++]=1*h/1,n[s++]=1*o/10;var c=0;for(o=0;o<10;o++)for(h=0;h<1;h++)e[c++]=2*(o+1)+h,e[c++]=2*o+h,e[c++]=2*(o+1)+h+1,e[c++]=2*o+h,e[c++]=2*o+h+1,e[c++]=2*(o+1)+h+1;this._vertexBuffer=new Laya.VertexBuffer3D(t,this._numberVertices,Laya.WebGLContext.STATIC_DRAW,!0),this._indexBuffer=new Laya.IndexBuffer3D(Laya.IndexBuffer3D.INDEXTYPE_USHORT,this._numberIndices,Laya.WebGLContext.STATIC_DRAW,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(e),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},a);function a(e,t){var i=n.call(this)||this;return i._long=e,i._width=t,i.activeResource(),i._positions=i._getPositions(),i._generateBoundingObject(),i}t.WindMesh=i});var BaseControl=function(){function e(){this.notice=new Notice,this.notice.facade.registCommand(this)}return e.prototype.hasEvent=function(e){return-1!=this.getEvent.indexOf(e)},e.prototype.send=function(e){this.notice.facade.send(e)},Object.defineProperty(e.prototype,"getEvent",{get:function(){return[]},enumerable:!0,configurable:!0}),e.prototype.excuting=function(e){},e.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"});s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update);document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}},Object.defineProperty(e.prototype,"panel",{get:function(){return this.mPanel},set:function(e){this.mPanel=e},enumerable:!0,configurable:!0}),e.prototype.openView=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.closeView=function(){},e.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},e.prototype.close=function(e){e=null==e?this.index:e,UIManager.instance.closeUI(e)},e}(),ControlManager=function(){function e(){this.cmdDic=[]}return e.prototype.registCommand=function(e){-1==this.cmdDic.indexOf(e)&&this.cmdDic.push(e)},e.prototype.excuting=function(e){for(var t=0;t<this.cmdDic.length;t++)this.cmdDic[t].hasEvent(e.event)&&this.cmdDic[t].excuting(e);e.recover()},e}(),Facade=function(){function e(){this.ctrMsg=new ControlManager}return Object.defineProperty(e,"instance",{get:function(){return e.mInstance||(e.mInstance=new e)},enumerable:!0,configurable:!0}),e.prototype.registCommand=function(e){this.ctrMsg.registCommand(e)},e.prototype.send=function(e){this.ctrMsg.excuting(e)},e}();define("com/help/GameInit",["require","exports","com/help/GameConfig"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(a.prototype.init=function(){Laya.init(i.GameConfig.GAME_W,i.GameConfig.GAME_H,Laya.WebGL),Laya.Browser.onMobile?Laya.stage.scaleMode=Laya.Stage.SCALE_FIXED_WIDTH:Laya.stage.scaleMode=Laya.Stage.SCALE_SHOWALL,Laya.stage.frameRate=Laya.Stage.FRAME_SLOW,Laya.stage.alignH=Laya.Stage.ALIGN_CENTER},a);function a(){this.init()}t.GameInit=n}),define("com/help/GameLoader",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.preLoader=function(i){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(e){Laya.loader.load(i,Laya.Handler.create(t,function(){e()}))})]})})},n);function n(){}t.GameLoader=i});var SheetManager=function(){function e(){}return e.loadDB=function(i){var e=this;return new Promise(function(t){Laya.loader.load(i,Laya.Handler.create(e,function(){var e=Laya.loader.getRes(i);this.data=e,console.log("皮肤数据数据",this.data),Laya.loader.clearRes(i),t()}),null,Laya.Loader.JSON)})},e.get=function(e,t,i){var n=this.data[e][t];if(n){for(var a,r=this.getKeys(this.data[e].keys),s=new i,o=0;o<r.length;o++)a=this.data.dic[n[o]],s[r[o]]="null"!==a?a:null;return i[t]=s}},e.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"});s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update);document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}},e.getKeys=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];t.push(this.data.dic[n])}return t},e.getKey=function(e){return this.data.dic[e]},e.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},e.getList=function(e){return this.data[e]},e.getComplexLength=function(e,t){return this.data[e][t].length},e}(),Notice=function(){function e(){this.facade=Facade.instance}return e.prototype.send=function(e){this.facade.send(e)},e}(),NotityData=function(){function a(){}return a.create=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null);var n=Laya.Pool.getItemByClass("NotityData",a);return n.event=e,n.data=t,n.type=i,n},a.prototype.recover=function(){this.data=null,this.event=null,this.event=null,Laya.Pool.recover("NotityData",this)},a}();define("com/ui/UIBase",["require","exports","game/scene/GameSystem","game/utils/SoundUtils"],function(e,t,i,n){"use strict";var a,r,s,o;function l(){var e=s.call(this)||this;return e.isJudgeOpen=!1,e.mSameLevelEliminate=!0,e.closeTime=0,e}Object.defineProperty(t,"__esModule",{value:!0}),r=a=a||{},s=Laya.View,__extends(l,s),Object.defineProperty(l.prototype,"Title",{get:function(){return this.title},set:function(e){this.title=e,this.isShowBg&&this.bg&&this.title&&(this.bg.title=this.title)},enumerable:!0,configurable:!0}),l.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},l.prototype.createView=function(e){void 0===e&&(e=null),this.isOpen&&s.prototype.createView.call(this,e)},l.prototype.initEvent=function(){},l.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},l.prototype.removeEvent=function(){},l.prototype.initComp=function(){this.addMask(),this.createView()},Object.defineProperty(l.prototype,"resouce",{get:function(){return this.mResouce},enumerable:!0,configurable:!0}),l.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isOpen=!0,this.checkState()},l.prototype.checkState=function(){this.isOpen&&0==this.numChildren?(this.initComp(),this.addMouseEnable(),Laya.timer.frameOnce(1,this,this.setCloseButton)):this.update(),this.initEvent()},l.prototype.setCloseButton=function(){this.isShowBg&&this.bg&&this.bg.addBtn(this)},l.prototype.initWindow=function(e,t,i,n,a,r){void 0===r&&(r=0),this.isShowMask=e,this.isShowBg=t,this.title=i,this.bgSize(n,a,r)},l.prototype.addMask=function(){this.isShowMask&&(this.maskSp=new Laya.Sprite,this.maskSp.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),this.maskSp.name="mask",this.addChild(this.maskSp),this.maskSp.alpha=.7,this.maskSp.width=Laya.stage.width,this.maskSp.height=Laya.stage.height,this.maskSp.on(Laya.Event.CLICK,this,this.onClose))},l.prototype.bgSize=function(e,t,i){this._w=e,this._h=t,this._paddingTop=i},l.prototype.addMouseEnable=function(){this.isShowMask&&Laya.timer.frameOnce(1,this,function(){this.childList=this._childs;for(var e=0;e<this.childList.length;e++)this.childList[e].mouseEnabled=!0})},l.prototype.onClose=function(){n.SoundUtils.instance.playSound(i.GameSystem.MUSIC_DIANJI),this.closeBtn&&this.closeBtn.offAll(),this.closeBtn=null,UIManager.instance.closeUI(this.index)},l.prototype.update=function(){},Object.defineProperty(l.prototype,"sameLevelEliminate",{get:function(){return this.mSameLevelEliminate},set:function(e){this.mSameLevelEliminate=e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"index",{get:function(){return this._index},set:function(e){this._index=e,this.bg&&(this.bg.index=this.index)},enumerable:!0,configurable:!0}),l.prototype.close=function(){this.closeTime=Laya.Browser.now(),this.isOpen=!1,this.removeEvent(),this.removeSelf(),UIManager.instance.closeUI(this.index)},o=l,r.UIBase=o});var UILoadManager=function(){function e(){this.time=5e3,this.resouceDic=new Laya.Dictionary,Laya.timer.loop(this.time,this,this.checkMemory)}return e.prototype.checkMemory=function(){for(var e=this.resouceDic.keys,t=this.shieldRes(),i=e.length-1;0<=i;i--){if(!(UIManager.instance.getUICloseTimer(e[i])<this.time))for(var n=this.resouceDic.values[i],a=0;a<n.length;a++){var r=n[a].url;-1==t.indexOf(r)&&Laya.Loader.clearTextureRes(r),this.resouceDic.remove(e[i])}}},e.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"});s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update);document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}},e.prototype.shieldRes=function(){return["res/atlas/comp.atlas"]},Object.defineProperty(e,"instance",{get:function(){return e.mInstance||(e.mInstance=new e)},enumerable:!0,configurable:!0}),e.prototype.load=function(e,t,i){t?(this.resouceDic.set(e,t),Laya.loader.load(t,Laya.Handler.create(this,function(){this.upLoadToGpu(i,t)}))):i.run()},e.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},e.prototype.upLoadToGpu=function(e,t){for(var i=0;i<t.length;i++){var n=t[i],a=Laya.Loader.getAtlas(n.url),r=a&&0<a.length?Laya.Loader.getRes(a[0]):Laya.Loader.getRes(n.url);r&&r.bitmap&&!r.source?(r.bitmap.once(Laya.Event.RECOVERED,this,function(){e.run()}),r.active()):e.run()}},e}(),UIManager=function(){function e(){this.layerDic=null,this.uiClsDic=null,this.layerDic={},this.uiClsDic=new Laya.Dictionary,this.viewDic=[]}return Object.defineProperty(e,"instance",{get:function(){return e.mInstance||(e.mInstance=new e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uiLayer",{get:function(){return this.mUILayer},set:function(e){this.mUILayer=e},enumerable:!0,configurable:!0}),e.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"});s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update);document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}},e.prototype.openUI=function(t,i){void 0===i&&(i=UILEVEL.POP_1);for(var n=[],e=2;e<arguments.length;e++)n[e-2]=arguments[e];var a=this.getLayerSp(i),r=this.getViewObj(t);if(!this.hasOpenUI(t)){Laya.MouseManager.enabled=!1;var s=this;r.closeTime=0,UILoadManager.instance.load(t,r.resouce,Laya.Handler.create(this,function(){Laya.MouseManager.enabled=!0,r.index=t,r.layer=i,s.viewDic.push(r),a.addChild(r),r.open.apply(r,n);var e=this.getViewControl(t);e.index=t,e.openView.apply(e,n),s.sameLevelEliminate(t,r,a)}))}},e.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},e.prototype.closeUI=function(e){var t=this.getViewObj(e);this.closeUIByObj(e,t)},e.prototype.closeUIByObj=function(e,t){var i=this.viewDic.indexOf(t);-1!=i&&(this.getViewControl(t.index).closeView(),this.viewDic.splice(i,1),t.close())},e.prototype.getUICloseTimer=function(e){try{var t=this.getViewObj(e)}catch(e){return-1}return 0==t.closeTime?-1:Laya.Browser.now()-t.closeTime},e.prototype.hasOpenUI=function(e){var t=this.getViewObj(e);return-1!=this.viewDic.indexOf(t)&&!(!t.isOpen||!t.parent)},e.prototype.sameLevelEliminate=function(e,t,i){if(t.sameLevelEliminate&&0<i.numChildren)for(var n,a=i._childs,r=0;r<a.length;r++)(n=a[r])!=t&&this.closeUIByObj(e,n)},e.prototype.getLayerSp=function(e){var t=this.layerDic[e];if(!t)for(var i in t=new Laya.Sprite,this.layerDic[e]=t,this.layerDic)this.mUILayer.addChild(this.layerDic[i]);return t},e.prototype.getViewControl=function(e){var t=this.uiClsDic.get(e);return t instanceof BaseControl||(t=new t,this.uiClsDic.set(e,t)),t},e.prototype.getViewObj=function(e){return this.getViewControl(e).panel},e.prototype.registUIClass=function(e,t){this.uiClsDic.set(e,t)},e.prototype.addFromLayer=function(e,t){this.getLayerSp(t).addChild(e)},e.prototype.removeFromeLayer=function(e){e&&e.removeSelf()},e}();define("com/utils/AStar1",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var f,t,m,i,u=function(e,t){this.x=e,this.y=t};(t=f=e.WorkMode||(e.WorkMode={}))[t.D4=4]="D4",t[t.D8=8]="D8",(i=m=e.NodeValue||(e.NodeValue={}))[i.MT_None=0]="MT_None",i[i.MT_Obstacle=1]="MT_Obstacle",i[i.MT_Shade=2]="MT_Shade",i[i.MT_Danger=3]="MT_Danger",i[i.MT_Safe=4]="MT_Safe",i[i.MT_Ring=5]="MT_Ring";var n=(Object.defineProperty(g.prototype,"WORKMODE",{set:function(e){if(e!=f.D4&&e!=f.D8)throw new Error("仅支持8方向或4方向寻路")},enumerable:!0,configurable:!0}),g.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},g.prototype.find=function(e,t,i,n){return i=Math.min(i,this._grid.numCols-1),n=Math.min(n,this._grid.numRows-1),i=Math.max(i,0),n=Math.max(n,0),this._grid.nodeValuable(i,n)?(this._grid.setEndNode(i,n),e=Math.min(e,this._grid.numCols-1),t=Math.min(t,this._grid.numRows-1),e=Math.max(e,0),t=Math.max(t,0),this._grid.nodeValuable(e,t)?(this._grid.setStartNode(e,t),this._astar.findPath()?(this._index=0,this._astar.floyd(),this._path=this._astar.floydPath,this._path):null):null):null},g.prototype.decoder=function(e){var t=util.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var i,n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),r=a.resolvedType instanceof Enum?"int32":a.type,s="m"+util.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",s)("%s={}",s)("k=r.%s()",a.keyType)("r.pos++"),void 0!==types.long[a.keyType]?void 0===types.basic[r]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,r):void 0===types.basic[r]?t("%s[k]=types[%i].decode(r,r.uint32())",s,n):t("%s[k]=r.%s()",s,r)):a.repeated?(t("if(!(%s&&%s.length))",s,s)("%s=[]",s),void 0!==types.packed[r]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),void 0===types.basic[r]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,n):t("%s.push(r.%s())",s,r)):void 0===types.basic[r]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):t("%s=r.%s()",s,r),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var o=e._fieldsArray[n];o.required&&t("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",missing(o))}commentType=source.charAt(start++),commentLine=line,commentLineEmpty=!1,i=alternateCommentMode?2:3;var l,h=start-i;do{if(--h<0||"\n"===(l=source.charAt(h))){commentLineEmpty=!0;break}}while(" "===l||"\t"===l);var c=source.substring(start,end).split(setCommentSplitRe);for(n=0;n<c.length;++n)c[n]=c[n].replace(alternateCommentMode?setCommentAltRe:setCommentRe,"").trim();return commentText=c.join("\n").trim(),t("return m")},g.prototype.makeGrid=function(e,t,i,n,a){this._grid=new y,this._grid._numCols=t*n,this._grid._numRows=i*n;for(var r=this._grid._nodes,s=i-1;0<=s;--s)for(var o=t-1;0<=o;--o)for(var l=e[a+"_"+((s+1)*t-(o+1))][0].Grid,h=n-1;0<=h;h--)for(var c=l.splice(h*n,n),u=0;u<c.length;u++){var d=(t-o-1)*n+u,_=(i-s-1)*n+(n-h-1);r[d]||(r[d]=[]);var p=r[d][_]=new C(d,_);p.walkable=this.getValue(c[u],m.MT_Obstacle)!=m.MT_Obstacle,p.alphable=this.getValue(c[u],m.MT_Shade)==m.MT_Shade,p.danger=this.getValue(c[u],m.MT_Danger)==m.MT_Danger,p.safe=this.getValue(c[u],m.MT_Safe)==m.MT_Safe,p.ring=this.getValue(c[u],m.MT_Ring)==m.MT_Ring}g.Mode==f.D4?this._grid.calculateLinks(1):this._grid.calculateLinks(),this._astar=new v(this._grid)},g.prototype.getValue=function(e,t){return e&t},g.Mode=f.D8,g);function g(){}e.SilzAstar=n;var v=(a.prototype.justMin=function(e,t){return e.f<t.f},a.prototype.findPath=function(){return this._endNode=this._grid.endNode,this.nowversion++,this._startNode=this._grid.startNode,this._open=new r(this.justMin),this._startNode.g=0,this.search()},a.prototype.floyd=function(){if(null!=this.path){this._floydPath=this.path.concat();var e=this._floydPath.length;if(2<e){var t=new C(0,0),i=new C(0,0);this.floydVector(t,this._floydPath[e-1],this._floydPath[e-2]);for(var n=this._floydPath.length-3;0<=n;n--)this.floydVector(i,this._floydPath[n+1],this._floydPath[n]),t.x==i.x&&t.y==i.y?this._floydPath.splice(n+1,1):(t.x=i.x,t.y=i.y)}for(n=(e=this._floydPath.length)-1;0<=n;n--)for(var a=0;a<=n-2;a++)if(this.floydCrossAble(this._floydPath[n],this._floydPath[a])){for(var r=n-1;a<r;r--)this._floydPath.splice(r,1);n=a,e=this._floydPath.length;break}}},a.prototype.floydCrossAble=function(e,t){for(var i=this.bresenhamNodes(new u(e.x,e.y),new u(t.x,t.y)),n=i.length-2;0<n;n--)if(!this._grid.getNode(i[n].x,i[n].y).walkable)return!1;return!0},a.prototype.bresenhamNodes=function(e,t){var i=Math.abs(t.y-e.y)>Math.abs(t.x-e.x);if(i){var n=e.x;e.x=e.y,e.y=n,n=t.x,t.x=t.y,t.y=n}var a=t.x>e.x?1:t.x<e.x?-1:0,r=(t.y>e.y||(t.y,e.y),(t.y-e.y)/Math.abs(t.x-e.x)),s=[],o=e.x+a,l=e.y+r;for(i?s.push(new u(e.y,e.x)):s.push(new u(e.x,e.y));o!=t.x;){var h=Math.floor(l),c=Math.ceil(l);i?s.push(new u(h,o)):s.push(new u(o,h)),h!=c&&(i?s.push(new u(c,o)):s.push(new u(o,c))),o+=a,l+=r}return i?s.push(new u(t.y,t.x)):s.push(new u(t.x,t.y)),s},a.prototype.floydVector=function(e,t,i){e.x=t.x-i.x,e.y=t.y-i.y},a.prototype.search=function(){var e=this._startNode;for(e.version=this.nowversion;e!=this._endNode;){for(var t=e.links.length,i=0;i<t;i++){var n=e.links[i].node,a=e.links[i].cost,r=e.g+a,s=this.heuristic(n),o=r+s;n.version==this.nowversion?n.f>o&&(n.f=o,n.g=r,n.h=s,n.parent=e):(n.f=o,n.g=r,n.h=s,n.parent=e,this._open.ins(n),n.version=this.nowversion)}if(1==this._open.a.length)return!1;e=this._open.pop()}return this.buildPath(),!0},a.prototype.buildPath=function(){this._path=[];var e=this._endNode;for(this._path.push(e);e!=this._startNode;)e=e.parent,this._path.unshift(e)},Object.defineProperty(a.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"floydPath",{get:function(){return this._floydPath},enumerable:!0,configurable:!0}),a.prototype.manhattan=function(e){return Math.abs(e.x-this._endNode.x)+Math.abs(e.y-this._endNode.y)},a.prototype.manhattan2=function(e){var t=Math.abs(e.x-this._endNode.x),i=Math.abs(e.y-this._endNode.y);return t+i+Math.abs(t-i)/1e3},a.prototype.euclidian=function(e){var t=e.x-this._endNode.x,i=e.y-this._endNode.y;return Math.sqrt(t*t+i*i)},a.prototype.chineseCheckersEuclidian2=function(e){var t=e.y/this.TwoOneTwoZero,i=e.x+e.y/2-this._endNode.x-this._endNode.y/2,n=t-this._endNode.y/this.TwoOneTwoZero;return this.sqrt(i*i+n*n)},a.prototype.sqrt=function(e){return Math.sqrt(e)},a.prototype.euclidian2=function(e){var t=e.x-this._endNode.x,i=e.y-this._endNode.y;return t*t+i*i},a.prototype.diagonal=function(e){var t=Math.abs(e.x-this._endNode.x),i=Math.abs(e.y-this._endNode.y),n=Math.min(t,i),a=t+i;return this._diagCost*n+this._straightCost*(a-2*n)},a);function a(e){this._straightCost=1,this._diagCost=Math.SQRT2,this.nowversion=1,this.TwoOneTwoZero=2*Math.cos(Math.PI/3),this._grid=e,this.heuristic=this.euclidian2}var r=(s.prototype.ins=function(e){var t=this.a.length;this.a[t]=e;for(var i=t>>1;1<t&&this.justMinFun(this.a[t],this.a[i]);){var n=this.a[t];this.a[t]=this.a[i],this.a[i]=n,i=(t=i)>>1}},s.prototype.pop=function(){var e=this.a[1];this.a[1]=this.a[this.a.length-1],this.a.pop();for(var t=1,i=this.a.length,n=t<<1,a=n+1;n<i;){if(a<i)var r=this.justMinFun(this.a[a],this.a[n])?a:n;else r=n;if(!this.justMinFun(this.a[r],this.a[t]))break;var s=this.a[t];this.a[t]=this.a[r],this.a[r]=s,a=1+(n=(t=r)<<1)}return e},s);function s(e){void 0===e&&(e=null),this.a=[],this.justMinFun=function(e,t){return this.x<this.y},this.a.push(-1),null!=e&&(this.justMinFun=e)}var y=(o.prototype.calculateLinks=function(e){void 0===e&&(e=0),this.type=e;for(var t=0;t<this._numCols;t++)for(var i=0;i<this._numRows;i++)this.initNodeLink(this._nodes[t][i],e)},o.prototype.getType=function(){return this.type},o.prototype.initNodeLink=function(e,t){var i=Math.max(0,e.x-1),n=Math.min(this.numCols-1,e.x+1),a=Math.max(0,e.y-1),r=Math.min(this.numRows-1,e.y+1);e.links=[];for(var s=i;s<=n;s++)for(var o=a;o<=r;o++){var l=this.getNode(s,o);if(l!=e&&l.walkable){if(2!=t&&s!=e.x&&o!=e.y){var h=this.getNode(e.x,o);if(!h.walkable)continue;if(!(h=this.getNode(s,e.y)).walkable)continue}var c=this._straightCost;if(e.x!=l.x&&e.y!=l.y){if(1==t)continue;if(2==t&&(e.x-l.x)*(e.y-l.y)==1)continue;c=2==t?this._straightCost:this._diagCost}e.links.push(new d(l,c))}}},o.prototype.nodeValuable=function(e,t){return!!(this._nodes&&this._nodes[e]&&this._nodes[e][t])},o.prototype.getNode=function(e,t){return this._nodes[e][t]},o.prototype.setEndNode=function(e,t){this._endNode=this._nodes[e][t]},o.prototype.setStartNode=function(e,t){this._startNode=this._nodes[e][t]},o.prototype.setWalkable=function(e,t,i){this._nodes[e][t].walkable=i},o.prototype.setAlphable=function(e,t,i){this._nodes[e][t].alphable=i},o.prototype.setWalkType=function(e,t,i){this._nodes[e][t].walkType=i},Object.defineProperty(o.prototype,"endNode",{get:function(){return this._endNode},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"numCols",{get:function(){return this._numCols},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"numRows",{get:function(){return this._numRows},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"startNode",{get:function(){return this._startNode},enumerable:!0,configurable:!0}),o);function o(){this._straightCost=1,this._diagCost=Math.SQRT2,this._nodes=new Array}var d=function(e,t){this.node=e,this.cost=t},C=(l.prototype.toString=function(){return"x:"+this.x+" y:"+this.y},l);function l(e,t){this.walkable=!0,this.alphable=!1,this.danger=!1,this.safe=!1,this.ring=!1,this.version=1,this.x=e,this.y=t}}(t.wk||(t.wk={}))}),define("com/utils/Astar",["require","exports","com/utils/AStar1"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(Object.defineProperty(a,"instance",{get:function(){return a.mInstance||(a.mInstance=new a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"data",{set:function(e){this.MapSplitSize=~~e.MapSplitSize,this.GridSize=~~e.GridSize,this.MapWidth=~~e.MapWidth,this.MapHeight=~~e.MapHeight,this.PIVOTY=this.MapSplitSize-(this.MapHeight-Math.floor(this.MapHeight/this.MapSplitSize)*this.MapSplitSize),this.PIVOTX=this.MapSplitSize-(this.MapWidth-Math.floor(this.MapWidth/this.MapSplitSize)*this.MapSplitSize);var t=Math.ceil(this.MapWidth/this.MapSplitSize),i=Math.ceil(this.MapHeight/this.MapSplitSize);this.MapHeight=this.MapHeight+this.PIVOTY,this.MapWidth=this.MapWidth+this.PIVOTX;var n=e.MapId;(this.TransferPoint=null)!=e.TransferPoint&&(this.TransferPoint={x:e.TransferPoint[0],y:e.TransferPoint[1]});var a=this.MapSplitSize/this.GridSize;if(this.silzAstar.makeGrid(e.SplitData,t,i,a,n),null!=e.WalkPathCount){null==this.WalkPaths?this.WalkPaths=new Array:this.WalkPaths.splice(0,this.WalkPaths.length);for(var r=~~e.WalkPathCount,s=1;s<=r;s++){var o=e.WalkPaths["path_"+s];if(null!=o){for(var l=new Array,h=0;h<o.length;h++){var c=o[h],u={x:c[0],y:this.MapHeight-c[1]};l.push(u)}this.WalkPaths.push(l)}}}},enumerable:!0,configurable:!0}),a.prototype.getGrid=function(){return this.silzAstar._grid},a.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},a.prototype.find=function(e,t,i,n,a){void 0===a&&(a=16);try{for(var r,s=this.silzAstar.find(Math.floor(e/a),Math.floor(t/a),Math.floor(i/a),Math.floor(n/a)),o=[{x:e,y:t}],l=1;l<s.length;l++){r=s[l],o[l]={};var h=s[l].x*a,c=s[l].y*a;o[l].x=h,o[l].y=c,o[l].alphable=r.alphable}return o[s.length-1].x=i,o[s.length-1].y=n,1<o.length&&o.shift(),o}catch(e){return null}},a.prototype.isWalkable=function(e,t,i){void 0===i&&(i=16);try{return this.silzAstar._grid.getNode(Math.floor(e/i),Math.floor(t/i)).walkable}catch(e){return!1}},a.prototype.walkType=function(e,t,i){void 0===i&&(i=16);try{return this.silzAstar._grid.getNode(Math.floor(e/i),Math.floor(t/i)).walkType}catch(e){return 0}},a.prototype.isAlpha=function(e,t,i){void 0===i&&(i=16);try{return this.silzAstar._grid.getNode(Math.floor(e/i),Math.floor(t/i)).alphable}catch(e){return!1}},a);function a(){this.silzAstar=new i.wk.SilzAstar}t.Astar=n});var Point=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}return e.create=function(e,t){return{x:e,y:t}},e}(),GMath=function(){function t(){}return t.random=function(e,t,i){void 0===i&&(i=!0);var n=t-e;return n=Math.random()*n+e,i&&(n=Math.floor(n)),n},t.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"});s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update);document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}document.getElementById("pcm-info");_N;for(c=0;c<_N;c++){"<TR>";for(a=0;a<c;a++)"<TD>","--","</TD>";for(a=c;a<_N;a++)"<TD>",""+_PCM.at(c,a),"</TD>";"</TR>"}},t.getPointRadian=function(e,t){return Math.atan2(t,e)},t.polar=function(e,t){return{x:Math.floor(e*Math.cos(t)),y:Math.floor(e*Math.sin(t))}},t.R2A=function(e){return Math.floor(e*t.K_R2A)},t.A2R=function(e){return void 0===e&&(e=0),e*t.K_A2R},t.getAngle=function(e,t,i,n){var a=this.getPointRadian(e-i,t-n),r=this.R2A(a);return r<0?360+r:r},t.getAngle1=function(e,t,i,n){var a=this.getPointRadian(i-e,n-t);return this.R2A(a)},t.getDirection=function(e){var t=e<0?360+e+22.5:e+22.5,i=Math.floor(t/45);return i<8?i:0},t.randRange=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},t.getPath=function(e){return 0<=e?0:1},t.K_R2A=180/Math.PI,t.K_A2R=Math.PI/180,t}(),GameEvent,UILEVEL,UIID,SAVEKEY;function getTimer(){return(new Date).getTime()}function fullOverlap(e,t,i,n){return e==i&&t==n}function distance(e,t,i,n){var a=Math.abs(e-i)>>0,r=Math.abs(t-n)>>0,s=a*a+r*r>>0;return Math.sqrt(s)}define("com/utils/ResUtils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.preLoad=[],n);function n(){}t.ResUtils=i}),function(e){e[e.RESET=1]="RESET",e[e.STARTING=2]="STARTING",e[e.EXIT=3]="EXIT",e[e.TIPS=4]="TIPS",e[e.NEXT_LEVEL=5]="NEXT_LEVEL",e[e.SET_LEVEL=6]="SET_LEVEL",e[e.SET_SOUND=7]="SET_SOUND",e[e.SET_MSG=8]="SET_MSG"}(GameEvent=GameEvent||{}),function(e){e[e.POP_1=0]="POP_1"}(UILEVEL=UILEVEL||{}),function(e){e[e.INDEX=1]="INDEX",e[e.SELECT=2]="SELECT",e[e.GAME_VIEW=3]="GAME_VIEW",e[e.MENU=4]="MENU"}(UIID=UIID||{}),function(e){e.SCORE="1",e.EVERYDAY="2"}(SAVEKEY=SAVEKEY||{});var playerCenter=function(){function e(){}return e.lastLogin=0,e}();define("sheets/vo/RandomBall",["require","exports","sheets/vo/Sheets"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=i.RandomBallBase,__extends(r,n),r.get=function(e){return this[e]?this[e]:SheetManager.get("randomBall",e,r)},Object.defineProperty(r.prototype,"randomObstacel",{get:function(){var e=GMath.random(0,this.types.length);return this.types[e]-1},enumerable:!0,configurable:!0}),r.prototype.getRandomObstacel=function(e){var t=[];Laya.Utils.concatArray(t,this.types);for(var i=e.length-1;0<=i;i--){var n,a=e[i];-1!=(n=t.indexOf(a))&&t.splice(n,1)}return t[n=GMath.random(0,t.length)]-1},Object.defineProperty(r,"len",{get:function(){var e=SheetManager.getList("randomBall"),t=0;for(var i in e)"keys"!=i&&t++;return t},enumerable:!0,configurable:!0}),r.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},r);function r(){return null!==n&&n.apply(this,arguments)||this}t.RandomBall=a});var View=laya.ui.View,Dialog=laya.ui.Dialog,ui;!function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.AlertUI.uiView)},a.uiView={type:"Dialog",props:{width:600,height:400},child:[{type:"Image",props:{top:0,skin:"comp/pop_bg1.png",right:0,left:0,bottom:0}},{type:"Image",props:{y:5,x:48,skin:"comp/tiptip.png"}},{type:"Label",props:{width:470,var:"tiptxt",text:"是否确认购买？",height:89,fontSize:50,font:"Microsoft YaHei",color:"#ffffff",centerY:-19,centerX:14,bold:!0,align:"center"}},{type:"Button",props:{y:264,x:315,stateNum:1,skin:"comp/cacne.png",name:"no"}},{type:"Button",props:{y:262,x:42,var:"btn_sure",stateNum:1,skin:"comp/queding.png",name:"ok"}}]},n=a,t.AlertUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.BallSkinItemUI.uiView)},a.uiView={type:"View",props:{width:142,height:160},child:[{type:"Image",props:{y:0,x:0,width:143,var:"img_bg",skin:"comp/img_noSelect.png",height:141}},{type:"Image",props:{y:72,width:127,var:"img_skin",pivotY:65,pivotX:65,height:127,centerX:0}},{type:"Box",props:{y:1,x:-4,var:"img_lock"},child:[{type:"Box",props:{alpha:.5},child:[{type:"Rect",props:{y:6,x:12,width:127,lineWidth:1,height:127,fillColor:"#454545"}}]},{type:"Image",props:{y:32,x:50,skin:"comp/img_lock.png"}}]},{type:"Box",props:{y:110,x:45,visible:!1,var:"choise"},child:[{type:"Image",props:{skin:"comp/img_rect.png"}},{type:"Image",props:{skin:"comp/img_choice.png",centerY:0,centerX:0}}]}]},n=a,t.BallSkinItemUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.bannerUI.uiView)},a.uiView={type:"View",props:{width:750,mouseThrough:!0,height:250},child:[{type:"Image",props:{width:750,var:"banner",height:250}}]},n=a,t.bannerUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.baogameUI.uiView)},a.uiView={type:"View",props:{width:540,mouseThrough:!0,height:780},child:[{type:"Image",props:{y:218,x:532,var:"bao_cotr",skin:"comp/bao_ctor.png"},child:[{type:"Image",props:{y:40,x:42,var:"left_right",skin:"comp/bao_trs.png",rotation:0,anchorY:.45,anchorX:.35}}]},{type:"Image",props:{var:"bao_bg",skin:"comp/bao_bg.png"}},{type:"List",props:{y:69,x:14,width:520,var:"bao_list",spaceY:15,spaceX:20,repeatY:5,repeatX:2,height:650},child:[{type:"Box",props:{var:"bao_start",renderType:"render"},child:[{type:"Image",props:{y:0,x:0,width:116,name:"bao_icon",height:117}},{type:"Image",props:{skin:"comp/bao_kuang.png",sizeGrid:"38,35,30,29"}},{type:"Image",props:{y:73,x:122,skin:"comp/bao_start.png"}},{type:"Label",props:{y:9,x:130,width:110,text:"飞跃战机",overflow:"scroll",name:"bao_name",fontSize:22,color:"#ffffff"}},{type:"Label",props:{y:42,x:129,text:"130000玩过",name:"bao_count",fontSize:19,color:"#8a8a8a"}}]}]}]},n=a,t.baogameUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.blockUI.uiView)},a.uiView={type:"View",props:{width:100,height:100},child:[{type:"Label",props:{y:28,x:26,var:"lb_ok",text:"OK",fontSize:40,font:"SimSun",color:"#ffffff",bold:!0}}]},n=a,t.blockUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.CountViewUI.uiView)},a.uiView={type:"View",props:{width:750,height:1334}},n=a,t.CountViewUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),i.prototype.createChildren.call(this),this.createView(e.main.diamond_fbUI.uiView)},a.uiView={type:"Dialog",props:{width:750,height:1334},child:[{type:"Image",props:{y:116,x:0,skin:"comp/award_ling.png"}},{type:"Image",props:{y:322,x:117,skin:"comp/pop_bg1.png"}},{type:"Image",props:{y:721,var:"btn_fb",skin:"comp/yellow_bt.png",centerX:0},child:[{type:"Image",props:{skin:"comp/shuangbei.png"}}]},{type:"Image",props:{y:958,var:"btn_get",skin:"comp/putonglingqu.png",centerX:0}},{type:"Label",props:{y:483,x:465,width:101,var:"text_dia",text:"100",height:39,fontSize:30,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Image",props:{y:365,x:193,skin:"comp/award_huode.png"}},{type:"Image",props:{y:582,x:249,skin:"comp/award_title.png"}},{type:"Image",props:{y:445,x:211,skin:"comp/max_box.png",scaleY:1.2,scaleX:1.2}},{type:"Text",props:{y:470,x:413,text:"×",fontSize:60,color:"#ffffff"}}]},n=a,t.diamond_fbUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.drawUI.uiView)},a.uiView={type:"Dialog",props:{width:750,height:1334},child:[{type:"Image",props:{y:284,x:19,skin:"comp/award_ling.png"}},{type:"Image",props:{y:118,x:82,skin:"comp/chou_title.png"}},{type:"ProgressBar",props:{y:1021,x:54,width:725,var:"chou_bar",value:0,skin:"comp/chou_por.png",sizeGrid:"0,0,0,0",rotation:270,height:54}},{type:"Box",props:{y:421,x:194,width:400,var:"chou_bg",height:500}},{type:"Image",props:{y:133,x:12,var:"close_bt",skin:"comp/close.png"}},{type:"Box",props:{x:177,width:430,var:"box_dianji",height:180,bottom:50},child:[{type:"Image",props:{y:0,x:0,skin:"comp/chou_niuniu.png"}},{type:"Image",props:{y:26,x:362,skin:"comp/chou_shou.png"}}]}]},n=a,t.drawUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.endRankUI.uiView)},a.uiView={type:"Dialog",props:{width:750,height:1334},child:[{type:"Image",props:{y:133,skin:"comp/end_baobg.png",centerX:0}},{type:"Animation",props:{y:101,x:45,wrapMode:"0",width:0,source:"main/overain.ani",scaleY:1.1,scaleX:.95,pivotY:-5,height:0,autoPlay:!0}},{type:"List",props:{y:230,x:96,width:550,var:"list",spaceY:15,spaceX:10,repeatY:2,repeatX:3,height:480},child:[{type:"Box",props:{renderType:"render"},child:[{type:"Image",props:{y:0,x:0,width:175,name:"over_icon",height:140}},{type:"Image",props:{skin:"comp/end_baoitembg.png"}},{type:"Label",props:{y:149,x:9,width:92,text:"飞跃战记",name:"over_name",height:23,fontSize:23,color:"#ffffff"}},{type:"Label",props:{y:183,x:9,text:"113423人正在玩",name:"over_count",fontSize:19,color:"#8a8a8a"}}]}]},{type:"Image",props:{y:921,var:"btn_xy",skin:"comp/yellow_bt.png",centerX:0},child:[{type:"Image",props:{y:2,x:4,skin:"comp/end_tiaofried.png"}}]},{type:"Image",props:{y:1048,var:"btn_again",skin:"comp/con_game.png",centerX:0}},{type:"Label",props:{y:814,var:"text_score",fontSize:60,font:"Microsoft YaHei",color:"#ffffff",centerX:0,align:"center"}},{type:"Button",props:{y:897,var:"btn_home",stateNum:1,skin:"comp/main_home.png",centerX:232}},{type:"Image",props:{y:897,x:93,var:"btn_rank",skin:"comp/btn_cup.png"}},{type:"Image",props:{y:773,skin:"comp/endmax.png",centerX:0}}]},n=a,t.endRankUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.endRankItemUI.uiView)},a.uiView={type:"View",props:{width:220,height:380},child:[{type:"Label",props:{y:16,width:109,var:"text_rank",text:"99",height:83,fontSize:60,font:"Microsoft YaHei",color:"#F9A42A",centerX:-1,bold:!0,align:"center"}},{type:"Image",props:{width:129,var:"img_icon",skin:"comp/rank_icon.png",height:129,centerY:-10,centerX:0}},{type:"Label",props:{y:254,width:200,var:"text_name",text:"史莱姆",styleSkin:"comp/label.png",overflow:"hidden",height:44,fontSize:25,font:"Microsoft YaHei",color:"#ffffff",centerX:0,align:"center"}},{type:"Label",props:{y:289,width:138,var:"text_score",text:"100",styleSkin:"comp/label.png",height:74,fontSize:45,font:"Microsoft YaHei",color:"#ffffff",centerX:0,bold:!1,align:"center"}}]},n=a,t.endRankItemUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),i.prototype.createChildren.call(this),this.createView(e.main.FriendRankItemUI.uiView)},a.uiView={type:"View",props:{width:519,height:79},child:[{type:"Image",props:{y:0,x:0,width:519,height:79}},{type:"Image",props:{y:0,x:101,width:80,var:"icon",skin:"comp/img_friendIcon.png",height:80}},{type:"Text",props:{y:1,x:193,width:216,var:"txt_name",valign:"middle",text:"史莱姆",height:76,fontSize:28,font:"黑体",color:"#ffffff",align:"left"}},{type:"Text",props:{y:1,x:390,width:146,var:"txt_score",valign:"middle",text:"0",height:76,fontSize:28,font:"黑体",color:"#ffffff",align:"center"}},{type:"Label",props:{y:37,x:41,var:"txt_rank",text:"1",fontSize:28,color:"#ffffff",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:2,x:15,var:"rank_img"}}]},n=a,t.FriendRankItemUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),i.prototype.createChildren.call(this),this.createView(e.main.FriendRanlkUI.uiView)},a.uiView={type:"Dialog",props:{width:750,height:1334},child:[{type:"Image",props:{y:116,width:589,skin:"comp/pop_bg.png",height:863,centerX:0,sizeGrid:"196,0,333,0"}},{type:"Image",props:{y:142,x:218,skin:"comp/rank.png"}},{type:"Image",props:{y:235,x:133,var:"my_bt"}},{type:"Image",props:{y:235,x:396,var:"word_bt"}},{type:"Box",props:{y:129,x:620,var:"btn_close"},child:[{type:"Button",props:{stateNum:1,skin:"comp/close.png",centerY:7,centerX:-22}}]},{type:"List",props:{y:402,x:111,width:520,visible:!1,var:"word_list",spaceY:10,repeatY:6,height:530}},{type:"Text",props:{y:346,x:136,text:"排名",fontSize:28,color:"#515151"}},{type:"Text",props:{y:346,x:303,text:"玩家",fontSize:28,color:"#515151"}},{type:"Text",props:{y:346,x:545,text:"分数",fontSize:28,color:"#515151"}},{type:"Box",props:{y:402,x:111,width:520,var:"fried_view",height:530}},{type:"Image",props:{y:1027,x:92,skin:"comp/rank_myinfo.png"}},{type:"Box",props:{y:1025,var:"my_infobox",centerX:0},child:[{type:"Image",props:{y:1,x:108,width:80,var:"my_head",skin:"comp/img_friendIcon.png",height:80}},{type:"Text",props:{y:1,x:198,width:216,var:"my_name",valign:"middle",text:"史莱姆",height:76,fontSize:28,font:"黑体",color:"#ffffff",align:"left"}},{type:"Text",props:{y:1,x:392,width:146,var:"my_score",valign:"middle",text:"0",height:76,fontSize:28,font:"黑体",color:"#ffffff",align:"center"}},{type:"Text",props:{y:29,x:44,var:"my_rank",fontSize:28,color:"#ffffff"}},{type:"Image",props:{y:2,x:15,var:"my_rankimg"}}]}]},n=a,t.FriendRanlkUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.GameGuideUI.uiView)},a.uiView={type:"View",props:{width:750,top:0,right:0,left:0,height:1334,bottom:0},child:[{type:"Image",props:{y:0,x:0,width:750,skin:"comp/gui_r1.png",height:2e3}},{type:"Image",props:{y:181,skin:"comp/pipe_title.png",centerX:0}},{type:"Box",props:{y:982,right:0,left:0,height:109},child:[{type:"Image",props:{y:0,x:90,skin:"comp/writ_line.png"}},{type:"Image",props:{y:-16,x:101,skin:"comp/chou_shou.png"},compId:6}]},{type:"Image",props:{y:516,skin:"comp/pipe_jiao.png",centerX:0}},{type:"FontClip",props:{y:314,x:384,var:"text_time",value:"14/13",skin:"comp/baizi.png",sheet:"0123456789/",anchorY:.5,anchorX:.5}}],animations:[{nodes:[{target:6,keyframes:{x:[{value:98,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:0},{value:589,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:95},{value:98,tweenMethod:"linearNone",tween:!0,target:6,key:"x",index:170}]}}],name:"move",id:2,frameRate:60,action:0}]},n=a,t.GameGuideUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),i.prototype.createChildren.call(this),this.createView(e.main.GameOvUI.uiView)},a.uiView={type:"Dialog",props:{width:750,height:1334},child:[{type:"Image",props:{y:994,var:"btn_close",skin:"comp/over_tipbt.png",centerX:0}},{type:"Image",props:{y:731,var:"btn_video",skin:"comp/yellow_bt.png",centerX:0},child:[{type:"Image",props:{y:1,x:1,skin:"comp/jixuyouxi.png"}}]},{type:"Image",props:{y:851,var:"btn_reborn",skin:"comp/yellow_bt.png",centerX:0},child:[{type:"Image",props:{y:-1,x:2,skin:"comp/over_fuhuo.png"}},{type:"Text",props:{y:37,x:145,text:"x50",fontSize:28,color:"#ffffff"}}]},{type:"Image",props:{y:528,x:376,var:"img_scale",skin:"comp/over_aixin.png",anchorY:.5,anchorX:.5}},{type:"Label",props:{y:526,x:373,var:"text_time",text:"10",styleSkin:"comp/label.png",fontSize:60,font:"Microsoft YaHei",color:"#ffffff",bold:!1,anchorY:.5,anchorX:.5,align:"center"}},{type:"Label",props:{y:277,x:368,var:"text_score",fontSize:60,color:"#ffffff",anchorY:.5,anchorX:.5}},{type:"Image",props:{y:189,skin:"comp/over_max.png",centerX:0}},{type:"Box",props:{y:368,x:220,width:310,var:"huan_por",height:309},child:[{type:"Image",props:{y:0,x:0,skin:"comp/over_yuan.png",renderType:"mask"}}]}]},n=a,t.GameOvUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.GameS3UI.uiView)},a.uiView={type:"View",props:{width:750,height:1334},child:[{type:"Image",props:{y:-32,x:-28,width:800,skin:"comp/gametwo_bg.png",height:2e3}},{type:"Image",props:{y:125,x:62,var:"to_home",skin:"comp/main_home.png"}},{type:"Box",props:{width:375,var:"left",left:2,height:400,bottom:-2},child:[{type:"Label",props:{y:230,x:40,text:"左边跳跃",fontSize:60,color:"#ffffff",bold:!0}}]},{type:"Box",props:{width:375,var:"right",right:-11,height:400,bottom:0},child:[{type:"Label",props:{y:230,x:48,text:"右边跳跃",fontSize:60,color:"#ffffff",bold:!0}}]},{type:"Label",props:{y:165,x:321,var:"mscore",text:"分数",fontSize:40,color:"#ffffff"}}]},n=a,t.GameS3UI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.GameScene2UI.uiView)},a.uiView={type:"View",props:{width:750,height:1334},child:[{type:"Image",props:{y:-2,x:-2,width:750,skin:"comp/gametwo_bg.png",height:2e3}},{type:"Image",props:{y:115,x:52,var:"go_home",skin:"comp/main_home.png"}},{type:"Label",props:{y:157,x:275,var:"count",text:"第三关",fontSize:60,font:"SimSun",color:"#ffffff",bold:!0}},{type:"Label",props:{y:274,x:58,text:"？请在倒计时结束之前选完不同颜色块",fontSize:28,color:"#ffffff"}},{type:"List",props:{y:460,x:20,var:"list_i",spaceY:2,spaceX:2,repeatY:7,repeatX:7}},{type:"Label",props:{y:274,x:592,var:"m_time",text:"time",fontSize:28,color:"#ffffff"}}]},n=a,t.GameScene2UI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),i.prototype.createChildren.call(this),this.createView(e.main.GameSkinWinUI.uiView)},a.uiView={type:"Dialog",props:{width:750,height:1334},child:[{type:"Image",props:{width:750,top:0,skin:"comp/shop_tip.png",right:0,left:0,height:1079,bottom:0}},{type:"Box",props:{y:0,right:0,left:0},child:[{type:"Rect",props:{y:0,x:0,width:750,lineWidth:1,height:108,fillColor:"#372F5A"}}]},{type:"Box",props:{right:0,left:0,bottom:0},child:[{type:"Rect",props:{width:750,lineWidth:1,height:166,fillColor:"#372F5A"}}]},{type:"Box",props:{y:573,x:0,width:750,height:612},child:[{type:"Rect",props:{y:0,x:0,width:750,lineWidth:1,height:592,fillColor:"#4D437B"}}]},{type:"Image",props:{y:30,skin:"comp/img_skinWord.png",centerX:0}},{type:"Image",props:{y:500,x:377,skin:"comp/img_smallIcon.png"}},{type:"Text",props:{y:507,x:226,width:119,text:"当前拥有",height:34,fontSize:30,font:"黑体",color:"#ffffff"}},{type:"Text",props:{y:506,x:459,width:119,var:"txt_score",text:"0",height:34,fontSize:30,font:"黑体",color:"#ffffff"}},{type:"Button",props:{var:"btn_sure",stateNum:1,skin:"comp/btn_select.png",centerX:-18,bottom:-148},child:[{type:"Image",props:{y:32,x:104,skin:"comp/img_slfont.png"}}]},{type:"List",props:{y:607,x:17,width:717,var:"list",spaceY:20,spaceX:35,repeatY:3,repeatX:4,height:488,centerX:0}},{type:"Button",props:{var:"btn_buy",stateNum:1,skin:"comp/btn_select.png",centerX:0,bottom:26},child:[{type:"Image",props:{y:26,x:76,skin:"comp/dio_icon.png"}},{type:"FontClip",props:{y:30,var:"font_price",value:"10",skin:"comp/font_clip.png",sheet:"0123456789",centerX:86}},{type:"Image",props:{y:30,x:171,skin:"comp/over_x.png"}}]},{type:"Tab",props:{y:495,x:0,width:750,var:"_tab",selectedIndex:0,height:78},child:[{type:"Button",props:{y:0,x:0,width:154,stateNum:2,skin:"comp/shop_tab.png",name:"item0",labelSize:25,labelFont:"Microsoft YaHei",labelColors:"#000000",labelBold:!0,labelAlign:"center",label:"数字皮肤",height:78}},{type:"Button",props:{y:0,x:597,width:154,visible:!1,stateNum:2,skin:"comp/shop_tab.png",name:"item1",labelSize:25,labelFont:"Microsoft YaHei",labelColors:"#000000",labelBold:!0,labelAlign:"center",label:"炫酷皮肤",height:78}}]},{type:"Box",props:{y:32,x:50,width:70,var:"btn_back",height:68},child:[{type:"Image",props:{skin:"comp/img_back.png"}}]}]},n=a,t.GameSkinWinUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),i.prototype.createChildren.call(this),this.createView(e.main.GameStartViewUI.uiView)},a.uiView={type:"View",props:{y:0,x:0,width:750,mouseThrough:!1,mouseEnabled:!0,height:1334},child:[{type:"Image",props:{top:-2,right:0,left:-2,bottom:0,alpha:.05}},{type:"Image",props:{y:869,x:582,width:95,var:"btn_7d",skin:"comp/img_7d.png",height:132}},{type:"Button",props:{y:770,x:47,width:95,var:"btn_rank",stateNum:1,skin:"comp/btn_cup.png",height:132}},{type:"Image",props:{y:943,var:"btn_invite",skin:"comp/img_inviteGift.png",centerX:0},child:[{type:"Image",props:{y:-8,x:337,skin:"comp/point_home.png"}},{type:"Image",props:{y:-7,x:-79,skin:"comp/pk.png"}}]},{type:"Image",props:{y:431,var:"chooseballproxy",right:0,left:0,height:200},child:[{type:"Image",props:{skin:"comp/title_home.png",centerY:-140,centerX:0}}]},{type:"Button",props:{y:653,var:"btn_buy",stateNum:1,skin:"comp/bugbtn.png",scaleY:1.1,scaleX:1.1,centerX:0},child:[{type:"Label",props:{y:5,x:80,width:78,var:"font_price",text:"x100",height:32,fontSize:30,color:"#ffffff",align:"center"}}]},{type:"Box",props:{y:70,width:784,var:"stepbox",height:208,centerX:2},child:[{type:"Image",props:{y:3,x:437,var:"txt_p2",skin:"nums/f_min.png"}},{type:"Image",props:{y:3,x:154,var:"txt_p1",skin:"nums/f_pao.png"}},{type:"FontClip",props:{y:150,x:362,var:"text_score",value:"2",skin:"nums/fontclip_num1.png",sheet:"0123456789",anchorY:.5,anchorX:.5,align:"center"}},{type:"FontClip",props:{y:35,x:352,var:"text_step",value:"999",skin:"nums/fontclip_num2.png",sheet:"0123456789",anchorY:.5,anchorX:.5,align:"center"}},{type:"Image",props:{y:116,x:75,var:"txt_s1",skin:"nums/f_chao.png"}},{type:"Image",props:{y:116,x:473,var:"txt_s2",skin:"nums/f_ming.png"}}]},{type:"Image",props:{var:"buysuccessIcon",skin:"comp/bugsuccess.png",centerY:13,centerX:4}},{type:"Box",props:{y:864,var:"box_scale",centerX:0,anchorY:.5,anchorX:.5},child:[{type:"Button",props:{var:"btn_start",stateNum:1,skin:"comp/btn_start.png",centerX:1}},{type:"Image",props:{y:0,x:0,var:"btn_try",skin:"comp/img_try.png"}}]},{type:"Image",props:{y:87,x:55,skin:"comp/dimond_home.png"},child:[{type:"Text",props:{y:4,x:70,width:69,var:"txt_blue",valign:"middle",text:"501",overflow:"visible",height:30,fontSize:30,font:"黑体",color:"#ffffff",bold:!0,align:"center"}}]},{type:"Image",props:{y:27,x:57,skin:"comp/mbox_home.png"},child:[{type:"Text",props:{y:4,x:72,width:69,var:"txt_score",valign:"middle",text:"501",height:30,fontSize:30,font:"黑体",color:"#ffffff",bold:!0,align:"center"}}]},{type:"Image",props:{y:964,x:54,var:"setting_home",skin:"comp/setting_home.png"}},{type:"Image",props:{y:356,x:675,width:135,var:"ani_ad",height:135,anchorY:.5,anchorX:.5}},{type:"Image",props:{y:281,x:601,width:149,skin:"comp/home_kuang.png",height:149}}]},n=a,t.GameStartViewUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.GetSkinWinUI.uiView)},a.uiView={type:"Dialog",props:{width:750,height:1334},child:[{type:"Image",props:{y:0,x:0,width:750,skin:"comp/blank.png",height:1334,alpha:.2,sizeGrid:"2,2,2,2"}},{type:"Image",props:{skin:"comp/get_bg.png",centerY:-108,centerX:0},child:[{type:"Image",props:{y:429,x:24,var:"btn_cancel",skin:"comp/get_btncan.png"}},{type:"Image",props:{y:429,x:220,var:"btn_video",skin:"comp/get_btnture.png"}},{type:"Label",props:{y:362,x:340,width:90,var:"text_num",text:"X10",height:43,fontSize:40,color:"#ffffff"}}]}]},n=a,t.GetSkinWinUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.InviteItemUI.uiView)},a.uiView={type:"View",props:{width:519,visible:!0,height:79,centerX:0},child:[{type:"Image",props:{y:0,x:0,width:519,height:79}},{type:"Button",props:{x:95,width:68,var:"btn_add",stateNum:1,skin:"comp/btn_addFriend.png",height:68,centerY:0}},{type:"Image",props:{x:201,var:"icon",centerY:0},child:[{type:"Label",props:{y:16,x:81,text:"×",fontSize:40,color:"#ffffff",bold:!0}},{type:"Label",props:{y:16,x:109,var:"fnt_price",text:"25",fontSize:40,color:"#ffffff",bold:!0}}]},{type:"Image",props:{x:313,var:"btn_getdia",skin:"comp/lingqu.png",scaleY:.7,scaleX:.7,centerY:2}},{type:"Label",props:{y:18,x:36,var:"fnt_num",text:"0",fontSize:40,color:"#ffffff",bold:!0}},{type:"Image",props:{x:96,width:68,var:"share_bt",skin:"comp/invite_kuang.png",height:68,centerY:0},child:[{type:"Image",props:{width:63,var:"img_head",height:63,centerY:0,centerX:-1}}]},{type:"Image",props:{y:0,x:0,visible:!1}}]},n=a,t.InviteItemUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.InviteWinUI.uiView)},a.uiView={type:"Dialog",props:{width:720,mouseThrough:!1,mouseEnabled:!0,height:1280},child:[{type:"Image",props:{y:181,x:61,width:612,var:"_bg",skin:"comp/pop_bg.png",height:627,sizeGrid:"196,0,333,0"},child:[{type:"List",props:{y:117,x:24,width:570,var:"list",spaceY:22,repeatY:5,height:480}},{type:"Image",props:{y:30,x:146,skin:"comp/yaoqinfried.png"}},{type:"Button",props:{y:23,x:534,var:"btn_close",stateNum:1,skin:"comp/close.png"}}]},{type:"Button",props:{y:867,var:"btn_invite",stateNum:1,skin:"comp/yellow_bt.png",centerX:0},child:[{type:"Image",props:{y:0,x:-1,skin:"comp/yaoqing.png"}}]},{type:"Image",props:{y:989,skin:"comp/yaoqin_title.png",centerX:0}}]},n=a,t.InviteWinUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),i.prototype.createChildren.call(this),this.createView(e.main.LoadingUI.uiView)},a.uiView={type:"Dialog",props:{y:0,x:0,width:750,height:1334},child:[{type:"Image",props:{y:0,x:0,var:"bg",skin:"loading/bg.jpg"}},{type:"Box",props:{y:797,visible:!0,var:"s3_loding",centerX:0},child:[{type:"Image",props:{y:45,width:603,var:"pro_bg",skin:"loading/bg_bar.png",height:40,centerX:0,anchorY:.5},child:[{type:"Text",props:{y:-57,x:277,var:"proTxt",text:"0%",strokeColor:"#000000",stroke:3,fontSize:36,font:"黑体",color:"#ffffff",bold:!0}}]},{type:"Image",props:{y:23,width:603,var:"bar",skin:"loading/bar.png",height:45,centerX:0}},{type:"Image",props:{y:206,visible:!0,var:"img_tip",skin:"loading/load_font2.png",centerX:0}},{type:"Image",props:{y:98,visible:!0,var:"btn_restart",skin:"loading/load_btn.png",centerX:0}}]},{type:"Box",props:{y:694,var:"box_select",height:52,centerX:0},child:[{type:"Image",props:{y:8,x:21,skin:"loading/load_slbg.png"},child:[{type:"Image",props:{y:0,x:0,skin:"loading/load_select.png"}}]},{type:"Image",props:{x:28,skin:"loading/load_font.png"}}]},{type:"Image",props:{y:1088,var:"load_text",skin:"loading/load_text.png",scaleY:.8,scaleX:.8,centerX:0}},{type:"Label",props:{y:960,var:"s3_label",text:"正在加载......",fontSize:40,color:"#ffffff",centerX:0}}]},n=a,t.LoadingUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.lovegameUI.uiView)},a.uiView={type:"View",props:{width:750,mouseThrough:!0,height:206},child:[{type:"Image",props:{y:0,skin:"comp/lovegame.png",centerX:0}},{type:"List",props:{y:24,x:77,width:650,var:"m_list",spaceX:15,repeatY:1,repeatX:4,height:150},child:[{type:"Box",props:{width:149,renderType:"render",height:149},child:[{type:"Image",props:{y:0,x:0,name:"love_icon"}},{type:"Image",props:{width:149,skin:"comp/lovegameitem.png",height:149}}]}]}]},n=a,t.lovegameUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.my_mingameUI.uiView)},a.uiView={type:"View",props:{width:293,height:72},child:[{type:"Image",props:{var:"var_img",top:0,skin:"comp/my_mingame.png",right:0,left:0,bottom:0}}]},n=a,t.my_mingameUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.settingUI.uiView)},a.uiView={type:"Dialog",props:{width:750,height:1334},child:[{type:"Image",props:{y:339,x:139,skin:"comp/setting_bg.png"}},{type:"Image",props:{y:619,x:324,width:226,var:"cotr_sound",height:89}},{type:"Image",props:{y:492,x:324,width:226,var:"cotr_music",height:89}},{type:"Image",props:{y:365,x:220,skin:"comp/setting.png"}},{type:"Image",props:{y:844,x:206,var:"share_bt",skin:"comp/yellow_bt.png"},child:[{type:"Image",props:{skin:"comp/share.png"}}]},{type:"Image",props:{y:637,x:211,skin:"comp/sound_home.png"}},{type:"Image",props:{y:517,x:210,skin:"comp/musci_home.png"}},{type:"Image",props:{y:360,x:541,var:"close_bt",skin:"comp/close.png"}}]},n=a,t.settingUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=View),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.sginItemUI.uiView)},a.uiView={type:"View",props:{width:119,height:200},child:[{type:"Image",props:{y:0,x:0,skin:"comp/sign_dbg.png",sizeGrid:"35,25,43,35"}},{type:"Image",props:{var:"img_gift",skin:"comp/img_blue.png",centerY:13,centerX:0}},{type:"Label",props:{y:12,width:128,var:"text_day",text:"第几天",height:47,fontSize:25,font:"Microsoft YaHei",color:"#ffffff",centerX:0,align:"center"}},{type:"Label",props:{y:148,width:107,var:"img_tip",text:"描述",height:49,fontSize:28,font:"Microsoft YaHei",color:"#ffffff",centerX:-2,align:"center"}},{type:"Box",props:{y:0,x:0,var:"box_got"},child:[{type:"Image",props:{y:0,x:0,skin:"comp/back_bg.png",sizeGrid:"85,28,82,39"}},{type:"Image",props:{skin:"comp/gou.png"}}]}]},n=a,t.sginItemUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){View.regComponent("ui.main.sginItemUI",e.main.sginItemUI),i.prototype.createChildren.call(this),this.createView(e.main.SignWinUI.uiView)},a.uiView={type:"Dialog",props:{width:750,height:1334},child:[{type:"Image",props:{y:194,skin:"comp/pop_bg.png",height:650,centerX:4,sizeGrid:"196,0,333,0"}},{type:"List",props:{y:370,x:112,width:550,var:"_list",spaceY:20,spaceX:20,repeatY:2,repeatX:4,height:432},child:[{type:"sginItem",props:{y:0,x:0,renderType:"render",runtime:"ui.main.sginItemUI"}}]},{type:"Image",props:{y:589,x:389,width:260,var:"img_7d",skin:"comp/sigin_maxbg1.png",height:200},child:[{type:"Label",props:{y:10,x:69,width:111,text:"第7天",height:39,fontSize:25,font:"Microsoft YaHei",color:"#ffffff",align:"center"}},{type:"Box",props:{y:58,width:87,var:"box_dia",centerX:5},child:[{type:"Image",props:{y:12,x:9,var:"img_dia",skin:"comp/dio_icon.png"}},{type:"Label",props:{y:82,x:-13,width:92,var:"text_dia",text:"+30",height:41,fontSize:30,font:"Microsoft YaHei",color:"#ffffff",align:"center"}}]},{type:"Box",props:{y:0,x:0,width:260,var:"box_got",height:200},child:[{type:"Image",props:{y:0,x:0,width:260,skin:"comp/sigin_maxbg.png",height:200}}]}]},{type:"Image",props:{y:219,width:489,skin:"comp/siging.png",height:58,centerX:-14}},{type:"Button",props:{y:213,x:602,var:"btn_close",stateNum:1,skin:"comp/close.png"}},{type:"Image",props:{y:885,var:"btn_double",skin:"comp/yellow_bt.png",centerX:-11},child:[{type:"Image",props:{y:0,x:0,skin:"comp/shuangbei.png"}}]},{type:"Image",props:{y:1003,var:"btn_getRw",skin:"comp/putonglingqu.png",centerX:-10}},{type:"Image",props:{y:328,skin:"comp/siging_title.png",centerX:0}}]},n=a,t.SignWinUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(e.main.TipUI.uiView)},a.uiView={type:"Dialog",props:{width:588,height:411},child:[{type:"Image",props:{y:0,x:0,width:588,skin:"comp/pop_bg1.png",height:411}},{type:"Image",props:{y:13,x:48,skin:"comp/tiptip.png"}},{type:"Label",props:{width:453,var:"text_tip",text:"您的余额不足",height:89,fontSize:50,font:"Microsoft YaHei",color:"#ffffff",centerY:-18,centerX:0,bold:!0,align:"center"}},{type:"Image",props:{y:266,var:"btn_true",skin:"comp/queding.png",centerX:0}}]},n=a,t.TipUI=n}(ui=ui||{}),function(e){var t,i,n;function a(){return i.call(this)||this}t=e.main||(e.main={}),__extends(a,i=Dialog),a.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),i.prototype.createChildren.call(this),this.createView(e.main.welfareUI.uiView)},a.uiView={type:"Dialog",props:{width:750,height:1334,centerX:375},child:[{type:"Image",props:{y:187,x:87,width:589,skin:"comp/pop_bg.png",height:750,sizeGrid:"196,0,333,0"}},{type:"Image",props:{y:308,x:109,skin:"comp/welfart.png"}},{type:"Image",props:{y:211,x:591,var:"close_bt",skin:"comp/close.png"}},{type:"Image",props:{y:967,x:189,var:"get_award",skin:"comp/yellow_bt.png"},child:[{type:"Image",props:{y:1,x:3,skin:"comp/lingqu.png"}}]},{type:"Image",props:{y:212,x:213,skin:"comp/welfare_title.png"}},{type:"Text",props:{y:839,x:569,var:"get_value",text:"100",fontSize:30,color:"#ffffff"}}]},n=a,t.welfareUI=n}(ui=ui||{}),define("utils/NameUtils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(Object.defineProperty(n,"randomName",{get:function(){this.lists||(this.lists=this.nameStr.split(","));var e=this.lists.length,t=this.randRange(0,e);return this.lists[t]},enumerable:!0,configurable:!0}),n.randRange=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},n.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},n.nameStr="孤独式悲伤,疯狂的勇敢、,折旧记忆,不入格的情,呼吸,切記,迷迭香,清烟往事,无泪,夜乄,習慣。,花落亦莫离,◇顶尖,Man,默默等待。,◆異℃空間,陽光旳夶菽ヽ,不醒的六月,如此、珍贵,ヽ?朵无言花,蓅哖の笑笑サザ,丶炽夏\t爱你。,离开你,、失念,忘了の殇,故作暧昧╮,海誓山盟罢了,那?夜、梦碎,无法继续的回忆,拼命的装,刻画你的容颜,ゆ,玩命小姐,又見、嶨飘過,罂粟绽放的瞬间,太慌张的拥抱,爱、那么伤,原来是幻想,怎么都行,指尖的温柔沙,①嗰亼、過咚,凊為哬嬑み,伱媞峩吢厎の陽茪,凝结的爱,陽光旳夶菽ヽ,不醒的六月,在线,LOVE--,華麗旳沈默 ? ,曲缠绵歌ゝ,祭奠哀伤,溪影连云,微笑の訁淚,ぃ羊咩む,多此 ? 举,自命不凡,独守 ? 座城丶,埋葬♀过去式,っ骄傲点,等待很遥远, 新势力`,_黑鹰,铁骑公子,o丨傲剑丶魂灬,Win丶9的等待,血洗青铜坑,FJ_Re/Clanr,飞天魔痕,Smileヾ淡莣,Travelers过客,Moment ° ,彻底的绝望℡,career［经历］,太委屈,grievance,怀念°ispief,Autism（孤独症）,Await［期待］,skyblue°天空,失忆 Dreams▼,Shine（光芒）,Spring, ‘ 初心,玻璃猫-charming.*,扑倒EXO!,bewitch,［蛊惑］,Heart tired゛,哀伤之后,After,sad,oxygen.（氧气）,゜vitamin维他命,Do not weak（别软弱）,超級Fun,食尸鬼つGhouls,Summer° 初夏,shoulder,（依靠）,\tMazyCity,chum［挚友］,Attract,［吸引］,纽约迷情°, Provence,神精榜.Traveler,Ambition,（野心）,Ｒemix．,恍惚,BABY follow me!!,失夜, Sakitama,\tEscape, [逃脱],\t你比猫还sexy,Christmas丶幻镜,Follow Me,Lie 说谎家,Poison★弑神,Mofa★礼物,smile,你會嗎,Ｓmile.過期℡,cling［纠缠］,白日悠梦人,诡迹！,陪衬,情殇,心疼.,玖生.,心震,花塚ミ,烟瘾*,心累i,暂别,傲骨i,\t心鸢,心亡,荒坡。,酔念 i,菰島。,难捱,溺毙,奢求,裤裆里散着霸气,我是流氓我怕谁",n);function n(){}t.NameUtils=i}),define("wx/GamePlaySoundMag",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.prototype.init=function(e,t,i,n){"undefined"!=typeof wx&&(wx.setInnerAudioOption({mixWithOther:i,obeyMuteSwitch:n,success:e,fail:t}),wx.createInnerAudioContext())},n.prototype.lklsjdfkjs=function(){pScene=new THREE.Scene,pCamera=new THREE.OrthographicCamera(-1.2*_unitLength/1.4142,1.2*_unitLength/1.4142,2.1*_unitLength/1.4142,-1.2*_unitLength/1.4142/4,10,100),pCamera.position.set(-_unitLength,-_unitLength,2*_unitLength),pCamera.lookAt(mat2Vector3(p12Center)),pRenderer=new THREE.WebGLRenderer,pRenderer.setClearColor(new THREE.Color(16777215)),pRenderer.setSize(frameLength,frameLength);var e=new THREE.AmbientLight(16777215);pScene.add(e),document.getElementById("plane").appendChild(pRenderer.domElement),triVsOnPlane=new THREE.Geometry,triVsOnPlane.vertices.push(mat2Vector3(p1)),triVsOnPlane.vertices.push(mat2Vector3(p2)),triVsOnPlane.vertices.push(v03),triVsOnPlane.vertices.push(mat2Vector3(p1));var t=new THREE.LineBasicMaterial({color:new THREE.Color(0),linewidth:1,linejoin:"miter"}),i=new THREE.Line(triVsOnPlane,t);function n(e,t,i){var n=new THREE.Geometry;n.vertices.push(mat2Vector3(e)),n.vertices.push(mat2Vector3(t));var a=new THREE.LineBasicMaterial({color:new THREE.Color(i),linewidth:1,linejoin:"miter"});return new THREE.Line(n,a)}pScene.add(i),lineR12=n(p03,p12,r12Color),lineR01=n(p01,p2,r01Color),lineR02=n(p02,p1,r02Color),lineR13=n(p13,p2,r13Color),lineR23=n(p12,p1,r23Color),pScene.add(lineR12),pScene.add(lineR01),pScene.add(lineR02),pScene.add(lineR13),pScene.add(lineR23),psC1=makeSlicePoints(matPsofC1,c1Color),psC2=makeSlicePoints(matPsofC2,c2Color),psC3=makeSlicePoints(matPsofC3,c3Color);for(var a=0;a<psC3.length;a++)psC1[a].visible=!1,psC2[a].visible=!1,psC3[a].visible=!1,pScene.add(psC1[a]),pScene.add(psC2[a]),pScene.add(psC3[a]);pConv1=makePConv(),pConv2=makePConv(),pConv3=makePConv(),pConv1Mesh=makePConvMesh(pConv1,c1Color),pConv2Mesh=makePConvMesh(pConv2,c2Color),pConv3Mesh=makePConvMesh(pConv3,c3Color),pScene.add(pConv1Mesh),pScene.add(pConv2Mesh),pScene.add(pConv3Mesh),pGMp=makePoint(mat2Vector3(pGM),5,1,0),pGMp.visible=!1,pScene.add(pGMp),pEigenp=makePoint(mat2Vector3(pEigen),5,1,16711680),pEigenp.visible=!1,pScene.add(pEigenp),makeText(pScene,"  2",p1),makeText(pScene,"3",p2),updateM(),monkey1Res=Laya.loader.getRes(monkey1Str),monkey2Res=Laya.loader.getRes(monkey2Str),this.ape=new Laya.Sprite,Laya.stage.addChild(this.ape),this.ape.pivot(55,72),this.ape.pos(Laya.stage.width/2,Laya.stage.height/2),this.switchTexture(),this.ape.on(Laya.Event.CLICK,this,this.switchTexture);var r=(this.flag=!this.flag)?monkey1Res:monkey2Res;this.ape.graphics.clear(),this.ape.graphics.drawTexture(r,0,0),this.ape.size(r.width,r.height);var s=Laya.Sprite;if(gameContainer=new s,Laya.stage.addChild(gameContainer),gameContainer.loadImage("res/guide/crazy_snowball.png"),gameContainer.on(Laya.Event.CLICK,this,this.nextStep),guideContainer=new s,Laya.stage.addChild(guideContainer),guideContainer.cacheAs="bitmap",maskArea=new s,guideContainer.addChild(maskArea),maskArea.alpha=.5,maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),interactionArea=new s,guideContainer.addChild(interactionArea),interactionArea.blendMode="destination-out",hitArea=new Laya.HitArea,hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000"),guideContainer.hitArea=hitArea,guideContainer.mouseEnabled=!0,tipContainer=new s,Laya.stage.addChild(tipContainer),this.nextStep(),guideStep===guideSteps.length)return Laya.stage.removeChild(guideContainer),void Laya.stage.removeChild(tipContainer);var o=guideSteps[guideStep++];hitArea.unHit.clear(),hitArea.unHit.drawCircle(o.x,o.y,o.radius,"#000000"),interactionArea.graphics.clear(),interactionArea.graphics.drawCircle(o.x,o.y,o.radius,"#000000"),tipContainer.graphics.clear(),tipContainer.loadImage(o.tip),tipContainer.pos(o.tipx,o.tipy);var l=new Laya.Sprite;Laya.stage.addChild(l),l.graphics.drawLine(10,58,146,58,"#ff0000",3),l.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),l.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),l.graphics.drawRect(10,166,166,90,"#ffff00"),l.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),l.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),l.graphics.drawCircle(98,332,50,"#00ffff"),l.graphics.drawPie(240,290,100,10,60,"#00ffff"),l.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"}),s=Laya.Sprite;for(var c=0;c<starCount;c++){var u=new s;u.loadImage("res/pixi/bubble_32x32.png"),u.x=Math.random()*w-slideX,u.y=Math.random()*h-slideY,u.pivot(16,16),stars.push({sprite:u,x:u.x,y:u.y}),Laya.stage.addChild(u)}for(Laya.stage.on("click",this,this.newWave),speedInfo.text="SX: "+sx+"\nSY: "+sy,this.resize(),Laya.timer.frameLoop(1,this,this.update),document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}for(document.getElementById("pcm-info"),_N,c=0;c<_N;c++){for(a=0;a<c;a++);for(a=c;a<_N;a++)_PCM.at(c,a)}},n);function n(){}t.GamePlaySoundMag=i});